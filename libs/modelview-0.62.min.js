/**
*
*   ModelView.js
*   @version: 0.62
*   @built on 2015-07-11 23:53:22
*
*   A simple/extendable MV* (MVVM) framework
*   optionaly integrates into both jQuery as MVVM plugin and jQueryUI as MVC widget
*   https://github.com/foo123/modelview.js
*
**/!function(e,t,n){"use strict";var r,i="object"==typeof module&&module.exports,o="function"==typeof define&&define.amd;i?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||n.call(e,{NODE:module})||1:o&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,r,i){return n.call(e,{AMD:i})}):t in e||(e[t]=r=n.call(e,{})||1)&&o&&define(t,[],function(){return r})}(this,"ModelView",function(e){"use strict";function t(e,t){var n=[e||"",Yt];return t&&(n=n.concat(t)),n.join(".")}function n(e){return-1<Xt.indexOf(e)}function r(e,t){return e===t}function i(e,t){return e.toLowerCase()===t.tagName.toLowerCase()}function o(e,t){return e===t.id}function l(e,t){return t[xt](e)}function a(e){var t=this;return t instanceof a?(e&&t.element(e),void(t.$handle=a.Handler.bind(t))):new a(e)}var u=void 0,s=function(e,t){return e.bind(t)},f="prototype",d=Array,h=d[f],p=RegExp,g=Number,v=Object,m=v[f],$=v.create,b=v.keys,y=Function,w=(y[f],String),_=w[f],E=m.toString,k=h.slice,S=function(e){return w(e)},M=function(e,t){return new y(e,t)},D=function(e,t){return e instanceof t},x=1/0,C=(Math.random,/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g),O=function(e){return e.replace(C,"\\$&")},A=function(e,t,n){return e[t]=u,n||delete e[t],e},L=2,N=3,j=4,P=8,V=9,z=16,I=32,R=64,H=128,F=256,U=512,Y=1024,B=2048,W=z|I,J=z|P,X={"[object Array]":z,"[object RegExp]":H,"[object Date]":F,"[object Number]":L,"[object String]":P,"[object Function]":R,"[object Object]":I},q=function(e){var t;return null===e?U:!0===e||!1===e?j:u===e?Y:(t=E.call(e),t=X[t]||B,L===t||e instanceof g?isNaN(e)?N:L:P===t||e instanceof w?1===e.length?V:P:z===t||e instanceof d?z:H===t||e instanceof p?H:F===t||e instanceof Date?F:R===t||e instanceof y?R:I===t?I:B)},Z=function(e,t){return!!(t&q(e))},K=function(e){return!isNaN(parseFloat(e,10))&&isFinite(e)},Q=function(e){return K(e)&&(e=+e,0===e%1&&e>=0)?!0:!1},G=function(){var e,t,n,r,i,o,l,a=arguments;for(t=a[0]||{},e=a.length,o=1;e>o;o++)if(n=a[o],I===q(n))for(i in n)r=n[i],l=q(r),t[i]=L&l?0+r:J&l?r.slice(0):r;return t},et="hasOwnProperty",tt="getAttribute",nt="setAttribute",rt="checked",it="disabled",ot="selected",lt="name",at="tagName",ut="type",st="value",ct="options",ft="selectedIndex",dt="parentNode",ht="style",pt="innerHTML",gt="innerText",vt="textContent",mt=JSON.parse,$t=JSON.stringify,bt=_.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s+|\s+$/g,"")},yt=_.startsWith?function(e,t,n){return e.startsWith(t,n||0)}:function(e,t,n){return t===e.slice(n||0,t.length)},wt=Date.now?Date.now:function(){return(new Date).getTime()},_t=function(){var e,t,n,r,i,o,l,a,u,s,c,f,d=arguments,h=d.length,p="|^",g="|v";if(h){for(r=1,f=[],u=[],a=[],e=h-1;e>=0;e--)l=d[e],a.unshift("f"+e),l.push?(u.unshift(l[1]),l=l[0]):u.unshift(null),c=l.slice(-2),g===c?(s=!0,l=l.slice(0,-2)):p===c?(s=!1,l=l.slice(0,-2)):s=!1,l=l.length?'["'+l.split(".").join('"]["')+'"]':"",t="a"+l,n="b"+l,u[0]&&(t=a[0]+"("+t+")",n=a[0]+"("+n+")"),i=s?""+r:"-"+r,o=s?"-"+r:""+r,f.unshift("("+t+" < "+n+" ? "+i+" : ("+t+" > "+n+" ? "+o+" : 0))"),r<<=1;return M(a.join(","),"return function(a,b) { return ("+f.join(" + ")+"); };").apply(null,u)}return t="a",n="b",i="-1",o="1",f=""+t+" < "+n+" ? "+i+" : ("+t+" > "+n+" ? "+o+" : 0)",M("a,b","return ("+f+");")},Et=function(e){for(var t=0;e=e.previousSibling;)t++;return t},Tt=function(e,t){var n=e;if(t)for(;n[dt]&&n[dt]!==t;)n=n[dt];return Et(n)},kt=function(e,t,n){var r,i=e.childNodes,o=i.length,l=null,a=0,u=0;for(n=n||1;o>a&&(r=i[a++],t!==r.nodeType||(l=r,++u!==n)););return l},St=function(e,t){return k.call((t||document).getElementsByTagName(e),0)},Mt=function(e,t,n){return!0===n?[(t||document).querySelector(e)]:k.call((t||document).querySelectorAll(e),0)},Dt=function(e,t){return yt(t,"$this::")?Mt(t.slice(7),e):Mt(t,null)},xt=(function(){var e=document.createElement("div");return"outerHTML"in e?function(e){return e.outerHTML}:function(t){var n=e.cloneNode();return n.appendChild(t.cloneNode(!0)),n.innerHTML}}(),function(e){return!e||e.matches?"matches":e.matchesSelector?"matchesSelector":e.webkitMatchesSelector?"webkitMatchesSelector":e.mozMatchesSelector?"mozMatchesSelector":e.msMatchesSelector?"msMatchesSelector":e.oMatchesSelector?"oMatchesSelector":void 0}(this.Element?this.Element[f]:null)),Ct="undefined"!=typeof window&&window.getComputedStyle?function(e){return window.getComputedStyle(e,null)}:function(e){return e.currentStyle},Ot=function(e){e._displayCached||(e._displayCached=Ct(e).display||"block"),e[ht].display="none"!==e._displayCached?e._displayCached:"block",e._displayCached=u},At=function(e){e._displayCached||(e._displayCached=Ct(e).display||"block"),e[ht].display="none"},Lt=function(e){var t=e.attributes[st];return!t||t.specified?e[st]:e.text},Nt=function(e){for(var t,n,r=e[ct],i=e[ft],o="select-one"===e[ut]||0>i,l=o?null:[],a=o?i+1:r.length,u=0>i?a:o?i:0;a>u;u++)if(n=r[u],!(!n[ot]&&u!==i||n[it]||n[dt][it]&&"OPTGROUP"===n[dt][at])){if(t=Lt(n),o)return t;l.push(t)}return l},jt=function(e,t){var n,r,i=[].concat(t).map(S),o=e[ct];for(r=0;r<o.length;r++)n=o[r],n[ot]=-1<i.indexOf(Lt(n));i.length||(e[ft]=-1)},Pt=function(e){if(e)switch(e[at]){case"TEXTAREA":case"INPUT":return e[st];case"SELECT":return Nt(e);default:return vt in e?e[vt]:e[gt]}},Vt=function(e,t){if(e)switch(e[at]){case"TEXTAREA":case"INPUT":e[st]=w(t);break;case"SELECT":jt(e,t);break;default:vt in e?e[vt]=w(t):e[gt]=w(t)}},zt=function(e){return e.length>0},It=/\s+/g,Rt=function(e){var t=e.split("."),n=t[0];return t=t.slice(1).filter(zt),[n,t.sort()]},Ht=function(e){return e.length?new p("(^|\\.)"+e.join("\\.(?:.*\\.|)")+"(\\.|$)"):!1},Ft=function(e,t){this.v=e||null,this.n=t||{}},Ut="*",Yt="modelview",Bt=0,Wt=function(e){return[e||"UUID",++Bt,wt()].join("_")};this.Element&&!this.Element[f].addEventListener&&!function(){function e(e,t){Window[f][e]=HTMLDocument[f][e]=Element[f][e]=t}e("addEventListener",function(e,t){var n=this,r=n.addEventListener.listeners=n.addEventListener.listeners||{},i=r[e]=r[e]||[];i.length||(i.event=function(e){var t=n.document&&n.document.documentElement||n.documentElement||{scrollLeft:0,scrollTop:0};e.currentTarget=n,e.pageX=e.clientX+t.scrollLeft,e.pageY=e.clientY+t.scrollTop,e.preventDefault=function(){e.returnValue=!1},e.relatedTarget=e.fromElement||null,e.stopImmediatePropagation=function(){a=!1,e.cancelBubble=!0},e.stopPropagation=function(){e.cancelBubble=!0},e.target=e.srcElement||n,e.timeStamp=+new Date;for(var r,o=0,l=[].concat(i),a=!0;a&&(r=l[o]);++o)for(var u,s=0;u=i[s];++s)if(u==r){u.call(n,e);break}},n.attachEvent?n.attachEvent("on"+e,i.event):n["on"+e]=i.event),i.push(t)}),e("removeEventListener",function(e,t){for(var n,r=this,i=r.addEventListener.listeners=r.addEventListener.listeners||{},o=i[e]=i[e]||[],l=o.length-1;n=o[l];--l)if(n==t){o.splice(l,1);break}!o.length&&o.event&&(r.detachEvent?r.detachEvent("on"+e,o.event):r["on"+e]=!1)}),e("dispatchEvent",function(e){var t=this,n=e.type,r=t.addEventListener.listeners=t.addEventListener.listeners||{},i=r[n]=r[n]||[];try{return t.fireEvent("on"+n,e)}catch(o){return void(i.event&&i.event(e))}})}();var Jt="DOMEVENT_STOPPED",Xt=["blur","error","focus","focusin","focusout","load","resize","scroll"];a.Handler=function(e){if(!e[Jt]){var t,n,r,i,o,l,a,u=this,s=e.type,c=e.target,f=[];switch(c&&3===c.nodeType&&(c=c.parentNode),i=u.$element,r=i.$listeners,o=e.eventPhase||(e.target!==e.currentTarget?3:2)){case 1:f=r[1][s];break;case 2:r[0]&&r[0][s]&&(f=f.concat(r[0][s])),r[1]&&r[1][s]&&(f=f.concat(r[1][s]));break;case 3:f=r[0][s]}if(f)for(n=f.length;n&&c;){for(t=0;n>t;t++){if(!f)return;if(l=f[t],!l)break;if(l.matcher(l.matcherParam,c)&&(a=l.handler.call(c,e,c)),!1===a||!1===e.returnValue)return e[Jt]=!0,void e.preventDefault()}if(i===c)break;n=f.length,c=c.parentElement}}},a[f]={constructor:a,$element:null,$handle:null,dispose:function(){var e=this;return e.off().element(),e.$element=null,e.$handle=null,e},element:function(e){var t,n,r,i=this,o=i.$element;if(o){for(t=o.$listeners,n=b(t[1]),r=0;r<n.length;r++)o.removeEventListener(n[r],i.$handle,!0);for(n=b(t[0]),r=0;r<n.length;r++)o.removeEventListener(n[r],i.$handle,!1);o.$listeners=u}return e&&e.addEventListener?(i.$element=e,e.$listeners=e.$listeners||[{},{}],i):(i.$element=null,i)},on:function(e,t,a,s){var c,f,d,h,p,g,v,m,$=this;if(c=$.$element,!c)return $;if(!e)throw new TypeError("Invalid event type: "+e);if(v=e.split(It).map(Rt),!v.length)return $;if("function"==typeof t&&(s=a,a=t,t=null),"function"!=typeof a)throw new TypeError("Handler must be a type of Function");for(h=0,p=v.length;p>h;h++)m=u===s?n(v[h][0]):!!s,f=c.$listeners[m?1:0],f[v[h][0]]||(f[v[h][0]]=[],c.addEventListener(v[h][0],$.$handle,m)),t?/^[a-z]+$/i.test(t)?(g=t,d=i):/^#[a-z0-9\-_]+$/i.test(t)?(g=t.slice(1),d=o):(g=t,d=l):(g=c,d=r),f[v[h][0]].push({selector:t,handler:a,matcher:d,matcherParam:g,namespace:v[h][1].join(".")});return $},off:function(e,t,n,r){var i,o,l,a,s,c,f,d,h,p,g=this,v=g.$element,m=!1;if(!v)return g;if("function"==typeof t&&(r=n,n=t,t=null),m=u===r?[0,1]:r?[1]:[0],p=e?e.split(/\s+/g).map(Rt):[],p.length){for(c=0;c<m.length;c++)for(l=v.$listeners[m[c]],s=0;s<p.length;s++)if(d=p[s][1],f=p[s][0],h=Ht(d),f.length){if(a=l[f],!a||!a.length)continue;for(i=a.length-1;i>=0;i--)o=a[i],t&&t!==o.selector||n&&n!==o.handler||h&&!h.test(o.namespace)||a.splice(i,1);a.length||(delete l[f],v.removeEventListener(f,g.$handle,!!m[c]))}else for(f in l)if(a=l[f],a&&a.length){for(i=a.length-1;i>=0;i--)o=a[i],t&&t!==o.selector||n&&n!==o.handler||h&&!h.test(o.namespace)||a.splice(i,1);a.length||(delete l[f],v.removeEventListener(f,g.$handle,!!m[c]))}}else for(c=0;c<m.length;c++){l=v.$listeners[m[c]];for(f in l)if(a=l[f],a&&a.length){for(i=a.length-1;i>=0;i--)o=a[i],t&&t!==o.selector||n&&n!==o.handler||a.splice(i,1);a.length||(delete l[f],v.removeEventListener(f,g.$handle,!!m[c]))}}return g}};var qt=2,Zt=function(e,t,n){var r=this;return r instanceof Zt?(r.type=e,r.target=t,r.currentTarget=t,r.timeStamp=wt(),r.eventPhase=qt,void(r.namespace=n||null)):new Zt(e,t,n)};Zt[f]={constructor:Zt,type:null,target:null,currentTarget:null,timeStamp:null,eventPhase:qt,bubbles:!1,cancelable:!1,namespace:null,stopPropagation:function(){this.bubbles=!1},preventDefault:function(){}};var Kt={$PB:null,namespace:null,initPubSub:function(){var e=this;return e.$PB={},e},disposePubSub:function(){var e=this;return e.$PB=null,e},trigger:function(e,t){var n,r,i,o,l,a,u=this,s=u.$PB;if(l=Rt(e),e=l[0],a="evt_"+e,s[et](a)&&(n=s[a])&&(o=n.length)){for(r=n.slice(0),l=l[1].join("."),e=new Zt(e,u,l),i=0;o>i&&(r[i][3]=1,!1!==r[i][0](e,t));i++);if(s[et](a)&&(n=s[a])&&(o=n.length))if(n.oneOffs>0)for(i=o-1;i>=0;i--)r=n[i],r[2]&&r[3]&&(n.splice(i,1),n.oneOffs=n.oneOffs>0?n.oneOffs-1:0);else n.oneOffs=0}return u},on:function(e,t,n){var r,i,o,l,a,u=this,s=u.$PB;if(e&&e.length&&Z(t,R)){if(n=!!n,i=e.split(It).map(Rt),!(a=i.length))return u;for(l=0;a>l;l++)e=i[l][0],r=i[l][1].join("."),o="evt_"+e,s[et](o)||(s[o]=[],s[o].oneOffs=0),s[o].push([t,r,n,0]),n&&s[o].oneOffs++}return u},onTo:function(e,t,n,r){var i=this;return Z(n,R)&&(n=s(n,i)),e.on(t,n,r),i},off:function(e,t){var n,r,i,o,l,a,u,s,c,f,d,h=this,p=h.$PB;if(e&&e.length){for(u=Z(t,R),s=e.split(It).map(Rt),c=0,f=s.length;f>c;c++)if(e=s[c][0],a=Ht(s[c][1]),e.length){if(d="evt_"+e,p[et](d)&&(n=p[d])&&(o=n.length))for(i=o-1;i>=0;i--)l=n[i],u&&t!==l[0]||a&&!a.test(l[1])||(l[2]&&(n.oneOffs=n.oneOffs>0?n.oneOffs-1:0),n.splice(i,1))}else if(u||a)for(r in p)if(p[et](r)){if(n=p[r],!n||!(o=n.length))continue;for(i=o-1;i>=0;i--)l=n[i],u&&t!==l[0]||a&&!a.test(l[1])||(l[2]&&(n.oneOffs=n.oneOffs>0?n.oneOffs-1:0),n.splice(i,1))}}else for(r in p)p[et](r)&&delete p[r];return h},offFrom:function(e,t,n){var r=this;return e.off(t,n),r}};Kt.publish=Kt.trigger;var Qt=function(e,t){var n=this,r=arguments.length;n.$store={},n.$size=x,n.$interval=x,r>0&&e>0&&(n.$size=e),r>1&&t>0&&(n.$interval=t)};Qt[f]={constructor:Qt,$store:null,$size:null,$interval:null,dispose:function(){var e=this;return e.$store=null,e.$size=null,e.$interval=null,e},reset:function(){return this.$store={},this},size:function(e){return arguments.length?(e>0&&(this.$size=e),this):this.$size},interval:function(e){return arguments.length?(e>0&&(this.$interval=e),this):this.$interval},has:function(e){var t=this,n=e?t.$store["_"+e]:null;return!!(n&&wt()-n.time<=t.$interval)},get:function(e){if(e){var t,n=this,r=n.$store,i="_"+e;if(r[et](i))return t=r[i],wt()-t.time>n.$interval?(delete r[i],u):t.data}return u},set:function(e,t){var n,r,i,o,l=this;if(e){for(o="_"+e,n=l.$store,r=l.$size,i=b(n);i.length>=r;)delete n[i.shift()];n[o]={key:e,data:t,time:wt()}}return l},del:function(e){var t=e?"_"+e:null;return t&&this.$store[et](t)&&delete this.$store[t],this},toString:function(){return"[ModelView.Cache]"}};var Gt=function(e){return D(this,Gt)?void(this.f=e||null):new Gt(e)},en=function(e){return D(this,en)?void(this.f=e||null):new en(e)},tn=function(e){var t,n;for(t in e)e[et](t)&&(n=e[t],D(n,en)?(e[t]=n.f,e[t].fEach=1):e[t]=n);return e},nn=Math.floor,rn=Math.round,on=Math.abs,ln=function(e,t){return t.length-e.length},an=function(e,t,n){var r=e.toString(),i=t-r.length;return i>0?new Array(i+1).join(n||" ")+r:r},un=function(e){return e.sort(ln).map(O).join("|")},sn={meridian:{am:"am",pm:"pm",AM:"AM",PM:"PM"},ordinal:{ord:{1:"st",2:"nd",3:"rd"},nth:"th"},timezone:["UTC","EST","MDT"],timezone_short:["UTC","EST","MDT"],day:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},cn=function(){var e,t=arguments.length?arguments[0]:sn,n={d:"(31|30|29|28|27|26|25|24|23|22|21|20|19|18|17|16|15|14|13|12|11|10|09|08|07|06|05|04|03|02|01)",D:"("+un(t.day_short)+")",j:"(31|30|29|28|27|26|25|24|23|22|21|20|19|18|17|16|15|14|13|12|11|10|9|8|7|6|5|4|3|2|1)",l:"("+un(t.day)+")",N:"([1-7])",S:"",w:"([0-6])",z:"([0-3]?[0-9]{1,2})",W:"([0-5][0-9])",F:"("+un(t.month)+")",m:"(12|11|10|09|08|07|06|05|04|03|02|01)",M:"("+un(t.month_short)+")",n:"(12|11|10|9|8|7|6|5|4|3|2|1)",t:"(31|30|29|28)",L:"([01])",o:"(\\d{2,4})",Y:"([1-9][0-9]{3})",y:"([0-9]{2})",a:"("+un([t.meridian.am||sn.meridian.am,t.meridian.pm||sn.meridian.pm])+")",A:"("+un([t.meridian.AM||sn.meridian.AM,t.meridian.PM||sn.meridian.PM])+")",B:"([0-9]{3})",g:"(12|11|10|9|8|7|6|5|4|3|2|1)",G:"(23|22|21|20|19|18|17|16|15|14|13|12|11|10|9|8|7|6|5|4|3|2|1|0)",h:"(12|11|10|09|08|07|06|05|04|03|02|01)",H:"(23|22|21|20|19|18|17|16|15|14|13|12|11|10|09|08|07|06|05|04|03|02|01|00)",i:"([0-5][0-9])",s:"([0-5][0-9])",u:"([0-9]{6})",e:"("+un(t.timezone||sn.timezone)+")",I:"([01])",O:"([+-][0-9]{4})",P:"([+-][0-9]{2}:[0-9]{2})",T:"("+un(t.timezone_short||sn.timezone_short)+")",Z:"(-?[0-9]{5})",U:"([0-9]{1,8})",c:"",r:""},r=t.ordinal.ord,i=[];for(e in lordinal.ord)r[et](e)&&i.push(e);return i.push(t.ordinal.nth),n.S="("+un(i)+")",n.c=n.Y+"-"+n.m+"-"+n.d+"\\"+n.T+n.H+":"+n.i+":"+n.s+n.P,n.r=n.D+",\\s"+n.d+"\\s"+n.M+"\\s"+n.Y+"\\s"+n.H+":"+n.i+":"+n.s+"\\s"+n.O,n},fn=function(e,t){var n,r,i="",o=e.length,l=cn(t||sn);for(r=0;o>r;r++)n=e.charAt(r),i+=l[et](n)?l[n]:O(n);return new p("^"+i+"$","")},dn={d:function(e){return an(e.getDate(),2,"0")},D:function(e,t){return t.day_short[e.getDay()]},j:function(e){return e.getDate()},l:function(e,t){return t.day[e.getDay()]},N:function(e){return e.getDay()||7},S:function(e,t){var n=e.getDate(),r=n%10;return t.ordinal.ord[n-1]?t.ordinal.ord[n-1]:t.ordinal.ord[r-1]?t.ordinal.ord[r-1]:t.ordinal.nth},w:function(e){return e.getDay()},z:function(e){var t=e.getFullYear(),n=new Date(t,e.getMonth(),e.getDate()),r=new Date(t,0,1);return rn((n-r)/864e5)},W:function(e){var t=e.getFullYear(),n=e.getDay()||7,r=new Date(t,e.getMonth(),e.getDate()-n+3),i=new Date(r.getFullYear(),0,4);return an(1+rn((r-i)/864e5/7),2,"0")},F:function(e,t){return t.month[e.getMonth()]},m:function(e){return an(e.getMonth()+1,2,"0")},M:function(e,t){return t.month_short[e.getMonth()]},n:function(e){return e.getMonth()+1},t:function(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()},L:function(e){var t=e.getFullYear();return t%4===0&t%100!==0|t%400===0},o:function(e,t){var n=e.getMonth()+1,r=dn.W(e,t),i=e.getFullYear();return i+(12===n&&9>r?1:1===n&&r>9?-1:0)},Y:function(e){return e.getFullYear()},y:function(e){return e.getFullYear().toString().slice(-2)},a:function(e,t){return e.getHours()>11?t.meridian.pm:t.meridian.am},A:function(e,t){return e.getHours()>11?t.meridian.PM:t.meridian.AM},B:function(e){var t=3600*e.getUTCHours(),n=60*e.getUTCMinutes(),r=e.getUTCSeconds();return an(nn((t+n+r+3600)/86.4)%1e3,3,"0")},g:function(e){return e.getHours()%12||12},G:function(e){return e.getHours()},h:function(e){return an(e.getHours()%12||12,2,"0")},H:function(e){return an(e.getHours(),2,"0")},i:function(e){return an(e.getMinutes(),2,"0")},s:function(e){return an(e.getSeconds(),2,"0")},u:function(e){return an(1e3*e.getMilliseconds(),6,"0")},e:function(){throw"Not supported (see source code of date() for timezone on how to add support)"},I:function(e){var t=e.getFullYear(),n=new Date(t,0),r=Date.UTC(t,0),i=new Date(t,6),o=Date.UTC(t,6);return n-r!==i-o?1:0},O:function(e){var t=e.getTimezoneOffset(),n=on(t);return(t>0?"-":"+")+an(100*nn(n/60)+n%60,4,"0")},P:function(e,t){var n=dn.O(e,t);return n.substr(0,3)+":"+n.substr(3,2)},T:function(){return"UTC"},Z:function(e){return 60*-e.getTimezoneOffset()},c:function(e,t){var n=dn;return[n.Y(e,t),"-",n.m(e,t),"-",n.d(e,t),"\\",n.T(e,t),n.H(e,t),":",n.i(e,t),":",n.s(e,t),n.P(e,t)].join("")},r:function(e,t){var n=dn;return[n.D(e,t),", ",n.d(e,t)," ",n.M(e,t)," ",n.Y(e,t)," ",n.H(e,t),":",n.i(e,t),":",n.s(e,t)," ",n.O(e,t)].join("")},U:function(e){return e/1e3|0}},hn=function(e,t,n){var r,i,o,l=dn,a="",u=t.length,s=q(e);if(P&s)return e;for((U|Y)&s?o=new Date:F&s?o=new Date(e):L&s&&(o=new Date(e)),n=n||sn,i=0;u>i;i++)r=t.charAt(i),a+=l[et](r)?l[r](o,n):r;return a},pn=/\$0/g,gn=function lr(e){return e.NOT=function(){return lr(function(t,n){return!e.call(this,t,n)})},e.AND=function(t){return lr(function(n,r){var i=this;return e.call(i,n,r)&&t.call(i,n,r)})},e.OR=function(t){return lr(function(n,r){var i=this;return e.call(i,n,r)||t.call(i,n,r)})},e.XOR=function(t){return lr(function(n,r){var i=this,o=e.call(i,n,r),l=t.call(i,n,r);return o&&!l||l&&!o})},e.EQ=function(t){return lr(function(n,r){var i=this,o=e.call(i,n,r),l=t.call(i,n,r);return o==l})},e.NEQ=function(t){return lr(function(n,r){var i=this,o=e.call(i,n,r),l=t.call(i,n,r);return o!=l})},e},vn={TypeCaster:function(e){return e},Cast:{COMPOSITE:function(){var e=arguments;return Z(e[0],z)&&(e=e[0]),function(t,n){for(var r=e.length;r--;)t=e[r].call(this,t,n);return t}},EACH:en,FIELDS:function(e){return e=tn(G({},e||{})),function(t){var n,r,i,o,l,a=this;for(n in e)if(e[et](n))if(r=e[n],i=t[n],r.fEach&&Z(i,z)){for(o=i.length,l=0;o>l;l++)i[l]=r.call(a,i[l]);t[n]=i}else t[n]=r.call(a,i);return t}},DEFAULT:function(e){return function(t){var n=q(t);return(Y&n||P&n&&!bt(t).length)&&(t=e),t}},BOOL:function(e){if(Z(e,P)&&e.length){var t=e.toLowerCase();return"true"===t||"on"===t||"1"===t}return!!e},INT:function(e){return parseInt(e,10)||0},FLOAT:function(e){return parseFloat(e,10)||0},MIN:function(e){return function(t){return e>t?e:t}},MAX:function(e){return function(t){return t>e?e:t}},CLAMP:function(e,t){if(e>t){var n=t;t=e,e=n}return function(n){return e>n?e:n>t?t:n}},TRIM:function(e){return bt(w(e))},LCASE:function(e){return w(e).toLowerCase()},UCASE:function(e){return w(e).toUpperCase()},PAD:function(e,t,n){return n=n||"L",function(r){var i,o,l=w(r),a=l.length,u=t-a;return c>0&&("LR"===n?(o=~~(u/2),i=u-o,l=new Array(i+1).join(e)+l+new Array(o+1).join(e)):"R"===n?l+=new Array(u+1).join(e):"L"===n&&(l=new Array(u+1).join(e)+l)),l}},STR:function(e){return""+e},DATETIME:function(e,t){return e=e||"Y-m-d",t=t||sn,function(n){return hn(n,e,t)}},FORMAT:function(e){return Z(e,P)?(e=new Jn(e,pn),function(t){return e.render({$0:t})}):e instanceof Jn?function(t){return e.render(t)}:Z(e,R)?function(t){return e(t)}:function(e){return w(e)}}},add:function(e,t){return Z(e,P)&&Z(t,R)&&(vn.Cast[e]=t),vn},del:function(e){return Z(e,P)&&vn.Cast[et](e)&&delete vn.Cast[e],vn},toString:function(){return"[ModelView.Type]"}},mn={Validator:gn,Validate:{EACH:en,FIELDS:function(e){return e=tn(G({},e||{})),gn(function(t){var n,r,i,o,l,a=this;for(n in e)if(e[et](n))if(r=e[n],i=t[n],r.fEach&&Z(i,z)){for(o=i.length,l=0;o>l;l++)if(!r.call(a,i[l]))return!1}else if(!r.call(a,i))return!1;return!0})},NUMERIC:gn(function(e){return K(e)}),EMPTY:gn(function(e){return!e||!bt(w(e)).length}),NOT_EMPTY:gn(function(e){return!!(e&&0<bt(w(e)).length)}),MAXLEN:function(e){return gn(M("v","return v.length <= "+(e||0)+";"))},MINLEN:function(e){return gn(M("v","return v.length >= "+(e||0)+";"))},MATCH:function(e){return gn(function(t){return e.test(t)})},NOT_MATCH:function(e){return gn(function(t){return!e.test(t)})},EQUAL:function(e,t){return gn(D(e,Gt)?M("v","return this.$data."+e.f+" "+(!1!==t?"===":"==")+" v;"):!1!==t?function(t){return e===t}:function(t){return e==t})},NOT_EQUAL:function(e,t){return gn(D(e,Gt)?M("v","return this.$data."+e.f+" "+(!1!==t?"!==":"!=")+" v;"):!1!==t?function(t){return e!==t}:function(t){return e!=t})},GREATER_THAN:function(e,t){return D(e,Gt)?e="this.$data."+e.f:Z(e,P)&&(e='"'+e+'"'),gn(M("v","return "+e+" "+(!1!==t?"<":"<=")+" v;"))},LESS_THAN:function(e,t){return D(e,Gt)?e="this.$data."+e.f:Z(e,P)&&(e='"'+e+'"'),gn(M("v","return "+e+" "+(!1!==t?">":">=")+" v;"))},BETWEEN:function(e,t,n){Z(e,z)&&(n=t,t=e[1],e=e[0]);var r,i=D(e,Gt),o=D(t,Gt);return!i&&!o&&e>t&&(r=t,t=e,e=r),e=i?"this.$data."+e.f:Z(e,P)?'"'+e+'"':e,t=o?"this.$data."+t.f:Z(t,P)?'"'+t+'"':t,gn(!1!==n?M("v","return ( "+e+" < v ) && ( "+t+" > v );"):M("v","return ( "+e+" <= v ) && ( "+t+" >= v );"))},NOT_BETWEEN:function(e,t,n){Z(e,z)&&(n=t,t=e[1],e=e[0]);var r,i=D(e,Gt),o=D(t,Gt);return!i&&!o&&e>t&&(r=t,t=e,e=r),e=i?"this.$data."+e.f:Z(e,P)?'"'+e+'"':e,t=o?"this.$data."+t.f:Z(t,P)?'"'+t+'"':t,gn(!1!==n?M("v","return ( "+e+" > v ) || ( "+t+" < v );"):M("v","return ( "+e+" >= v ) || ( "+t+" <= v );"))},IN:function(){var e=k.call(arguments);return Z(e[0],z)&&(e=e[0]),gn(function(t){return-1<e.indexOf(t)})},NOT_IN:function(){var e=k.call(arguments);return Z(e[0],z)&&(e=e[0]),gn(function(t){return 0>e.indexOf(t)})},MIN_ITEMS:function(e,t){return e=parseInt(e,10),gn(R===q(t)?function(n){return n.length>=e&&n.filter(t).length>=e}:function(t){return t.length>=e})},MAX_ITEMS:function(e,t){return e=parseInt(e,10),gn(R===q(t)?function(n){return n.filter(t).length<=e}:function(t){return t.length<=e})},EMAIL:function(e){return gn(function(t){return e.test(t)})}(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),URL:function(e){return gn(function(t){return e.test(t)})}(new p("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i")),DATETIME:function(e,t){var n=fn(e||"Y-m-d",t||sn);return gn(function(e){return n.test(e)})}},add:function(e,t){return Z(e,P)&&Z(t,R)&&(mn.Validate[e]=Z(t.XOR,R)?t:gn(t)),mn},del:function(e){return Z(e,P)&&mn.Validate[et](e)&&delete mn.Validate[e],mn},toString:function(){return"[ModelView.Validation]"}},$n=function(e,t){if(!e)return null;var n,r,i=[],o=e.length;for(n=0;o>n;n++)r=e[n],r&&(r[et](t)&&i.push(r[t].n),r[et](Ut)&&i.push(r[Ut].n));return i.length?i:null},bn=function(e,t){if(!e)return null;var n,r,i=e.length;if(t){for(n=0;i>n;n++)if(r=e[n]){if(r[et](t)&&r[t].v)return r[t].v;if(r[et](Ut)&&r[Ut].v)return r[Ut].v}}else for(n=0;i>n;n++)if(r=e[n],r&&r.v)return r.v;return null},yn=function(e,t,n,r){for(var i,o=n,l=0,a=t.length;a>l;)i=t[l++],o[et](i)||(o[i]=new Ft),o=o[i],a>l?o=o.n:r?(o.n[et](Ut)||(o.n[Ut]=new Ft),o.n[Ut].v=e):o.v=e;return n},wn=function(e,t,n,r){for(var i,o,l=t,a=n?[n]:null,u=0,s=e.length;s>u;){if(i=e[u++],o=q(l),!(s>u))return a&&bn(a,i)?!0:o&W&&l[et](i)?!0:I===o&&"length"==i?!0:!1;if(o&W&&l[et](i)){if(l=l[i],l instanceof r)return[r,l,e.slice(u)];a&&(a=$n(a,i))}else if(!a||!(a=$n(a,i)))return!1}return!1},_n=function(e,t,n,r){for(var i,o,l=t,a=n?[n]:null,u=0,s=e.length;s>u;){if(i=e[u++],o=q(l),!(s>u))return a&&(a=bn(a,i))?[!1,a]:o&W&&l[et](i)?[!0,l[i]]:I===o&&"length"==i?[!0,b(l).length]:!1;if(o&W&&l[et](i)){if(l=l[i],l instanceof r)return[r,l,e.slice(u)];a&&(a=$n(a,i))}else if(!a||!(a=$n(a,i)))return!1}return!1},En=function(e,t,n,r){for(var i,o,l=t,a=n,u=0,s=e.length;s>u;){if(i=e[u++],o=q(l),!(s>u))return l[i]instanceof r?[r,l[i],e.slice(u)]:a&&o&W&&l[et](i)?[!0,l,i,a]:!1;if(!(o&W&&l[et](i)))return!1;if(l=l[i],l instanceof r)return[r,l,e.slice(u)];if(!a||!(a=$n(a,i)))return!1}return!1},Tn=function(e,t,n,r,i,o,l){var a,u,s=t,c=null,f=null,d=null,h=0,p=e.length;for(l=!1!==l,l&&(c=[n],f=[r],d=[i]);p>h;)if(a=e[h++],u=q(s),p>h)if(u&W&&s[et](a)){if(s=s[a],s instanceof o)return[o,s,e.slice(h),0,null,null,null];l&&(c=$n(c,a),f=$n(f,a),d=$n(d,a))}else{if(!(l&&d&&(d=$n(d,a))))return[!1,s,a,e,null,null,null];c=$n(c,a),f=$n(f,a)}else if(u&W)return s[a]instanceof o?[o,s[a],e.slice(h),0,null,null,null]:s[et](a)?[!0,s,a,e.slice(h),c,f,d]:[!1,s,a,e.slice(h),c,f,d];return[!1,s,a,e.slice(h),null,null,null]},kn=function(e){return e.replace(/\[([^\]]*)\]/g,".$1").replace(/^\.+/,"").replace(/\.+$/,"")},Sn=function(e){return"["+e.split(".").join("][")+"]"},Mn=function(e){var t=new p("^"+e+"([\\.|\\[])");return function(e,n){var r=e.replace(t,"$1");return n?kn(r):r}},Dn=function ar(e,t,n,r){var i,o,l=!1;if(o=q(n),R&o)l=D(n,en),l&&(n=n.f),yn(n,-1<t.indexOf(".")?t.split("."):[t],r,l);else if(W&o)for(i in n)n[et](i)&&ar(e,t+"."+i,n[i],r)},xn=function ur(e,t,n,r){var i,o;if(o=q(n),R&o)yn(n,-1<t.indexOf(".")?t.split("."):[t],r);else if(W&o)for(i in n)n[et](i)&&ur(e,t+"."+i,n[i],r)},Cn=function sr(e,t,n,r){var i,o;for(arguments.length<3&&(n=e.$data);n instanceof t;)n=n.data();if(o=r||q(n),n=I&o?G({},n):z&o?n.slice(0):n,W&o)for(i in n)n[et](i)&&(n[i]instanceof t?n[i]=sr(n[i],t,G({},n[i].data())):W&(o=q(n[i]))&&(n[i]=sr(e,t,n[i],o)));return n},On=function cr(e,t,n,r,i,o){var l,a,u,s,c,f,d,h,p,g={isValid:!0,errors:[]};if(i=i||e.$data,o=o||[e.$validators],o&&o.length)if(r){if(p=function(e){return d?d+"."+e:e},c=En(h=r.split("."),l=i,o,t))if(l=c[1],a=c[2],t===c[0]){if(d=h.slice(0,h.length-a.length).join("."),f=cr(l,t,n,a.length?a.join("."):null),f.isValid||(g.errors=g.errors.concat(f.errors.map(p)),g.isValid=!1),!g.isValid&&n)return g}else{if(d=h.slice(0,-1).join("."),u=l[a],s=bn(c[3],a),s&&!s.call(e,u,r)&&(g.errors.push(r),g.isValid=!1,n))return g;if(W&q(u)&&(o=$n(c[3],a))&&o.length){d+=d?"."+a:a;for(a in u)if(u[et](a)&&(f=cr(e,t,n,a,u,o),f.isValid||(g.errors=g.errors.concat(f.errors.map(p)),g.isValid=!1),n&&!g.isValid))return g}}}else if(W&q(i))for(a in i)if(i[et](a)&&(f=cr(e,t,n,a,i,o),f.isValid||(g.errors=g.errors.concat(f.errors),g.isValid=!1),n&&!g.isValid))return g;return g},An=function(e,t){var n,r,i,o,l,a,u,s,c,f,d,h,p,g,v,m=e.target,$=m.$syncTo,y=t.key;if(y){for(r=y+".",i=b($),o=i.length,p=m.atomic,g=m.$atom,m.atomic=!0,m.$atom=y,s=0;o>s;s++)if(c=i[s],c===y||yt(c,r))for(f=$[c],n=m.get(c),d=0,h=f.length;h>d;d++)a=f[d][0],l=f[d][1],m.__syncing[a.$id]=m.__syncing[a.$id]||[],v=m.__syncing[a.$id],0>v.indexOf(l)&&(v.push(l),(u=f[d][2])?u.call(a,l,n,c,m):a.set(l,n,1),v.pop());m.$atom=g,m.atomic=p}},Ln=function fr(e,t,n,r,i,o,l){var a=this;return a instanceof fr?(a.$id=Wt("Model"),a.namespace=a.id=e||a.$id,a.key=Mn(a.id),a.$view=null,a.atomic=!1,a.$atom=null,a.$autovalidate=!0,a.$types={},a.$validators={},a.$getters={},a.$setters={},a.$idependencies={},a.$syncTo={},void a.data(t||{}).types(n).validators(r).getters(i).setters(o).dependencies(l).initPubSub()):new fr(e,t,n,r,i,o,l)};Ln.count=function(e){if(!arguments.length)return 0;var t=q(e);return I===t?b(e).length:z===t?e.length:Y!==t?1:0},Ln.Sorter=_t,Ln.Field=Gt,Ln[f]=G($(v[f]),Kt,{constructor:Ln,id:null,$id:null,$view:null,$data:null,$types:null,$idependencies:null,$validators:null,$getters:null,$setters:null,atomic:!1,$atom:null,$autovalidate:!0,$syncTo:null,$syncHandler:null,__syncing:null,dispose:function(){var e=this;return e.disposePubSub().$view=null,e.$data=null,e.$types=null,e.$idependencies=null,e.$validators=null,e.$getters=null,e.$setters=null,e.atomic=!1,e.$atom=null,e.key=null,e.$autovalidate=!1,e.$syncTo=null,e.$syncHandler=null,e.__syncing=null,e},view:function(e){var t=this;return arguments.length?(t.$view=e,t):t.$view},data:function(e){var t=this;return arguments.length?(t.$data=e,t):t.$data},dependencies:function(e){var t,n,r,i,o,l,a=this,u=a.$idependencies;if(Z(e,I))for(t in e)if(e[et](t))for(n=e[t]?[].concat(e[t]):[],r=0;r<n.length;r++)for(o=n[r].split("."),i=o[0],u[et](i)||(u[i]=[]),0>u[i].indexOf(t)&&u[i].push(t),l=1;l<o.length;l++)i+="."+o[l],u[et](i)||(u[i]=[]),0>u[i].indexOf(t)&&u[i].push(t);return a},types:function(e){var t,n=this;if(Z(e,I))for(t in e)e[et](t)&&Dn(n,t,e[t],n.$types);return n},validators:function(e){var t,n=this;if(Z(e,I))for(t in e)e[et](t)&&Dn(n,t,e[t],n.$validators);return n},getters:function(e){var t,n=this;if(Z(e,I))for(t in e)e[et](t)&&xn(n,t,e[t],n.$getters);return n},setters:function(e){var t,n=this;if(Z(e,I))for(t in e)e[et](t)&&xn(n,t,e[t],n.$setters);return n},serialize:function(){return Cn(this,Ln)},validate:function(e,t){return On(this,Ln,!!e,t)},autovalidate:function(e){var t=this;return arguments.length?(t.$autovalidate=!!e,t):t.$autovalidate},toJSON:function(e){var t,n,r,i=this;n=arguments.length?i.get(e):i.data();try{t=$t(Cn(i,Ln))}catch(r){throw r}return t},fromJSON:function(e,t,n){var r,i,o=this;if(e){try{r=mt(e)}catch(i){throw i}t?o.set(t,r,!0===n):o.data(r)}return o},has:function(e,t){var n,r=this,i=r.$data,o=r.$getters;return 0>e.indexOf(".")&&(i[et](e)||!t&&(n=o[e]||o[Ut])&&n.v)?!0:(n=wn(e.split("."),i,t?null:o,Ln))?!0===n?!0:n[1].has(n[2].join(".")):!1},get:function(e,t){var n,r=this,i=r.$data,o=r.$getters;return 0>e.indexOf(".")?!t&&(n=o[e]||o[Ut])&&n.v?n.v.call(r,e):i[e]:(n=_n(e.split("."),i,t?null:o,Ln))?Ln===n[0]?n[1].get(n[2].join("."),t):!1===n[0]?n[1].call(r,e):n[1]:u},set:function(e,t,n,r){var i,o,l,a,u,s,c,f,d,h,p,g=this,v=!1,m=g.$autovalidate;if(g.atomic&&yt(e,g.$atom))return g;if(o=g.$data,c=g.$types,f=g.$validators,d=g.$setters,h=g.$idependencies,0>e.indexOf("."))l=e,s=(i=d[l])?i.v:null,a=(i=c[l]||c[Ut])?i.v:null,u=m&&(i=f[l]||f[Ut])?i.v:null,v=!0;else if(i=Tn(e.split("."),o,c,m?f:null,d,Ln)){if(o=i[1],l=i[2],a=bn(i[4],l),u=bn(i[5],l),s=bn(i[6],l),Ln===i[0])return l.length?(l=l.join("."),p=o.get(l),p!==t?o.set(l,t,n,r):n=!1):(p=o.data(),p!==t?o.data(t):n=!1),n&&(g.publish("change",{key:e,value:t,action:"set",valuePrev:p,$callData:r}),h[et](e)&&g.notify(h[e])),g;if(!s&&!1===i[0]&&i[3].length)return g;v=!0}if(v){if(a&&(t=a.call(g,t,e)),u&&!u.call(g,t,e))return n&&(r&&(r.error=!0),g.publish("error",{key:e,value:o[l],action:"set",$callData:r})),g;if(s)return!1!==s.call(g,e,t,n)&&(n&&(g.publish("change",{key:e,value:t,action:"set",$callData:r}),h[et](e)&&g.notify(h[e])),g.$atom&&e===g.$atom&&(g.atomic=!0)),g;p=o[l],p!==t&&(o[l]=t,n&&(g.publish("change",{key:e,value:t,valuePrev:p,action:"set",$callData:r}),h[et](e)&&g.notify(h[e])),g.$atom&&e===g.$atom&&(g.atomic=!0))}return g},append:function(e,t,n,r){var i,o,l,a,s,c,f,d,h,p,g=this,v=-1,m=!1,$=g.$autovalidate;if(g.atomic&&yt(e,g.$atom))return g;if(o=g.$data,f=g.$types,d=g.$validators,h=g.$setters,p=g.$idependencies,0>e.indexOf("."))l=e,c=(i=h[l])&&i.n[Ut]?i.n[Ut].v:null,a=(i=f[l]||f[Ut])&&i.n[Ut]?i.n[Ut].v:null,s=$&&(i=d[l]||d[Ut])&&i.n[Ut]?i.n[Ut].v:null,m=!0;
else if(i=Tn(e.split("."),o,f,$?d:null,h,Ln)){if(o=i[1],l=i[2],a=bn($n(i[4],l),Ut),s=bn($n(i[5],l),Ut),c=bn($n(i[6],l),Ut),Ln===i[0])return l.length?(l=l.join("."),o.add(l,t,n,r)):(v=0,o.data(t)),n&&(g.publish("change",{key:e,value:t,action:"append",index:v,$callData:r}),p[et](e)&&g.notify(p[e])),g;if(!c&&!1===i[0]&&i[3].length)return g;m=!0}if(m){if(a&&(t=a.call(g,t,e)),s&&!s.call(g,t,e))return n&&(r&&(r.error=!0),g.publish("error",{key:e,value:u,action:"append",index:-1,$callData:r})),g;if(c)return!1!==c.call(g,e,t,n)&&(n&&(z===q(o[l])&&(v=o[l].length),g.publish("change",{key:e,value:t,action:"append",index:v,$callData:r}),p[et](e)&&g.notify(p[e])),g.$atom&&e===g.$atom&&(g.atomic=!0)),g;z===q(o[l])?(v=o[l].length,o[l].push(t)):(v=-1,o[l]=t),n&&(g.publish("change",{key:e,value:t,action:"append",index:v,$callData:r}),p[et](e)&&g.notify(p[e])),g.$atom&&e===g.$atom&&(g.atomic=!0)}return g},insert:function(e,t,n,r,i){var o,l,a,s,c,f,d,h,p,g,v=this,m=!1,$=v.$autovalidate;if(v.atomic&&yt(e,v.$atom))return v;if(l=v.$data,d=v.$types,h=v.$validators,p=v.$setters,g=v.$idependencies,0>e.indexOf("."))a=e,f=(o=p[a])&&o.n[Ut]?o.n[Ut].v:null,s=(o=d[a]||d[Ut])&&o.n[Ut]?o.n[Ut].v:null,c=$&&(o=h[a]||h[Ut])&&o.n[Ut]?o.n[Ut].v:null,m=!0;else if(o=Tn(e.split("."),l,d,$?h:null,p,Ln)){if(l=o[1],a=o[2],s=bn($n(o[4],a),Ut),c=bn($n(o[5],a),Ut),f=bn($n(o[6],a),Ut),Ln===o[0])return a.length?(a=a.join("."),l.insert(a,t,n,r,i)):l.data(t),r&&(v.publish("change",{key:e,value:t,action:"insert",index:n,$callData:i}),g[et](e)&&v.notify(g[e])),v;if(!f&&!1===o[0]&&o[3].length)return v;m=!0}if(m){if(s&&(t=s.call(v,t,e)),c&&!c.call(v,t,e))return r&&(i&&(i.error=!0),v.publish("error",{key:e,value:u,action:"append",index:-1,$callData:i})),v;if(f)return!1!==f.call(v,e,t,r)&&(r&&(v.publish("change",{key:e,value:t,action:"insert",index:n,$callData:i}),g[et](e)&&v.notify(g[e])),v.$atom&&e===v.$atom&&(v.atomic=!0)),v;z===q(l[a])?l[a].splice(n,0,t):(n=-1,l[a]=t),r&&(v.publish("change",{key:e,value:t,action:"insert",index:n,$callData:i}),g[et](e)&&v.notify(g[e])),v.$atom&&e===v.$atom&&(v.atomic=!0)}return v},del:function(e,t,n,r){var i,o,l,a,s=this,c=-1,f=!1;if(s.atomic&&yt(e,s.$atom))return s;if(n=!1!==n,o=s.$data,0>e.indexOf("."))l=e,f=!0;else if(i=Tn(e.split("."),o,null,null,null,Ln,!1)){if(o=i[1],l=i[2],Ln===i[0]&&l.length)return l=l.join("."),a=o.get(l),o.del(l,n,t,r),t&&s.publish("change",{key:e,value:a,action:"delete",index:c,rearrange:n,$callData:r}),s.$atom&&e===s.$atom&&(s.atomic=!0),s;if(i[3].length)return s;f=!0}return f&&(a=o[l],n?(o[l]=u,T=q(o),z==T&&Q(l)?(c=+l,o.splice(c,1)):I==T&&delete o[l]):delete o[l],t&&s.publish("change",{key:e,value:a,action:"delete",index:c,rearrange:n,$callData:r}),s.$atom&&e===s.$atom&&(s.atomic=!0)),s},sync:function(e,t){var n,r,i,o,l,a,u=this;for(n in t)if(t[et](n)){for(r=t[n],u.$syncTo[n]=u.$syncTo[n]||[],i=null,z===q(r)&&(i=r[1]||null,r=r[0]),o=u.$syncTo[n],a=1,l=o.length-1;l>=0;l--)if(e===o[l][0]&&r===o[l][1]){o[l][2]=i,a=0;break}a&&o.push([e,r,i])}return u.$syncHandler||(u.__syncing=u.__syncing||{},u.on("change",u.$syncHandler=An)),u},unsync:function(e){var t,n,r,i=this,o=i.$syncTo;for(t in o)if(o[et](t)){if(!(n=o[t])||!n.length)continue;for(r=n.length-1;r>=0;r--)e===n[r][0]&&(i.__syncing&&i.__syncing[e.$id]&&A(i.__syncing,e.$id),n.splice(r,1))}return i},notify:function(e,t,n){var r,i,o,l,a,u,s=this,c=s.$idependencies,f=[],d={};if(e){if(a=q(e),t=t||"change",o={key:"",action:"set"},n&&(n[et]("value")&&(o.value=n.value),n[et]("action")&&(o.action=n.action),n[et]("index")&&(o.index=n.index),n[et]("rearrange")&&(o.rearrange=n.rearrange),n[et]("$callData")&&(o.$callData=n.$callData)),P===a)o.key=e,d["_"+e]=1,c[et](e)&&(f=f.concat(c[e])),s.publish(t,o);else if(z===a)for(i=e.length,r=0;i>r;r++)o.key=l=e[r],d[et]("_"+l)||(d["_"+l]=1,c[et](l)&&(f=f.concat(c[l])),s.publish(t,o));for(;i=f.length;){for(u=[],o={key:"",action:"set"},r=0;i>r;r++)l=f[r],d[et]("_"+l)||(d["_"+l]=1,c[et](l)&&(u=u.concat(c[l])),o.key=l,s.publish("change",o));f=u}}return s},atom:function(e){var t=this;return u!==e&&(!1===e?(t.atomic=!1,t.$atom=null):(t.atomic=!1,t.$atom=e)),t},toString:function(){return"[ModelView.Model id: "+this.id+"]"}}),Ln[f].add=Ln[f].append,Ln[f].ins=Ln[f].insert,Ln[f].rem=Ln[f].del;var Nn="lastIndexOf",jn="match",Pn="nodeValue",Vn="nodeType",zn="parentNode",In="global",Rn="ignoreCase",Hn=/[a-zA-Z0-9_\-]/,Fn=function(e){return parseInt(e,10)},Un=function(e,t,n){for(var r,i,o,l,a,s,c,f,d,h,p=[],g=0,v=!1,m=-1,$=0,b=!1,y={};r=t.exec(e);){if(i=t.lastIndex-r[0].length,o=e.slice(g,i),d=-1,n&&(c=o[Nn]("<"),f=o[Nn](">"),c>f?(d=-1,b=!0):f>c&&(d=f+1,b=!1)),p.push([1,b,o,d]),b)if(-1<(a=o[Nn]("="))){for(v="",s=a;a>-1&&Hn.test(l=o.charAt(--a));)v=l+v;m=i-g-s-2,$=m+r[0].length}else v&&(m=$+i-g-2-1,$+=m+r[0].length);else v=!1,$=0,m=-1;h=r[1]?r[1]:r[0],y[et](h)?y[h].push(p.length):y[h]=[p.length],p.push([0,b,h,u,v,m]),g=t.lastIndex}return o=e.slice(g),d=-1,n&&(c=o[Nn]("<"),f=o[Nn](">"),c>f?(d=-1,b=!0):f>c&&(d=f+1,b=!1)),p.push([1,b,o,d]),[y,p]},Yn=function(e,t,n){var r,i,o,l,a,u,s,c,f,d,h,p,g,v,m,$,b,y,w,_,E;if(i=[],o=[],d=e,d.attributes&&(a=d.attributes.length))if(n&&d.firstChild&&8===d.firstChild[Vn]&&"att:"===d.firstChild[Pn].slice(0,4))for(c=d.firstChild[Pn].split("\n"),a=c.length,v={},l=0;a>l;l++)u=c[l].split("|"),b=u[0].slice(4),h=d.attributes[b],v[et](b)||(v[b]=[1,[]],o.push([h,v[b],d])),v[b][1].push([u[1].slice(4),u[2].split(",").map(Fn)]);else for(l=0;a>l;l++)h=d.attributes[l],(u=h[Pn][jn](t))&&o.push([0,h,u,d]);if(3===d[Vn])n&&d.previousSibling&&d.nextSibling&&8===d.previousSibling[Vn]&&8===d.nextSibling[Vn]&&"key:"===(p=d.previousSibling[Pn]).slice(0,4)&&"/key"===d.nextSibling[Pn]?(u=[d[Pn],p.slice(4)],i.push([d,u,d[zn]])):(u=d[Pn][jn](t))&&i.push([d,u,d[zn]]);else if(d.firstChild)for(E=[d=d.firstChild];E.length;){if(d.attributes&&(a=d.attributes.length))if(n&&d.firstChild&&8===d.firstChild[Vn]&&"att:"===d.firstChild[Pn].slice(0,4))for(c=d.firstChild[Pn].split("\n"),a=c.length,v={},l=0;a>l;l++)u=c[l].split("|"),b=u[0].slice(4),h=d.attributes[b],v[et](b)||(v[b]=[1,[]],o.push([h,v[b],d])),v[b][1].push([u[1].slice(4),u[2].split(",").map(Fn)]);else for(l=0;a>l;l++)h=d.attributes[l],(u=h[Pn][jn](t))&&o.push([h,u,d]);if(d.firstChild)E.push(d=d.firstChild);else{for(3===d[Vn]&&(n&&d.previousSibling&&d.nextSibling&&8===d.previousSibling[Vn]&&8===d.nextSibling[Vn]&&"key:"===(p=d.previousSibling[Pn]).slice(0,4)&&"/key"===d.nextSibling[Pn]?(u=[d[Pn],p.slice(4)],i.push([d,u,d[zn]])):(u=d[Pn][jn](t))&&i.push([d,u,d[zn]])),d=E.pop();E.length&&!d.nextSibling;)d=E.pop();d.nextSibling&&E.push(d=d.nextSibling)}}for(r={},l=0,a=i.length;a>l;l++)if(s=i[l],_=s[0],u=s[1],d=s[2],$=_[Pn],$.length>u[0].length){do p=u[1]?u[1]:u[0],g=_.splitText(u.index),_=g.splitText(u[0].length),r[et](p)?r[p][0].push([g,d]):r[p]=[[[g,d]],[]],u=_[Pn][jn](t);while(u)}else p=u[1]?u[1]:u[0],g=_,r[et](p)?r[p][0].push([g,d]):r[p]=[[[g,d]],[]];for(l=0,a=o.length;a>l;l++)if(s=o[l],h=s[0],u=s[1],d=s[2],$=h[Pn],_=document.createTextNode($||""),m=[[],[_]],1===u[0])for(c=u[1],f=c.length,w=0,l=0;f>l;l++)y=c[l],p=y[0],g=_.splitText(y[1][0]-w),_=g.splitText(y[1][1]),m[0].push(p),m[1].push(g,_),r[et](p)?(r[p][0].push([g,d]),r[p][1].push([h,m[1],$,d])):r[p]=[[[g,d]],[[h,m[1],$,d]]],w+=y[1][1]+y[1][0];else if($.length>u[0].length){do p=u[1]?u[1]:u[0],g=_.splitText(u.index),_=g.splitText(u[0].length),m[0].push(p),m[1].push(g,_),r[et](p)?(r[p][0].push([g,d]),r[p][1].push([h,m[1],$,d])):r[p]=[[[g,d]],[[h,m[1],$,d]]],u=_[Pn][jn](t);while(u)}else g=_,p=u[1]?u[1]:u[0],m[0].push(p),r[et](p)?(r[p][0].push([g,d]),r[p][1].push([h,m[1],$,d])):r[p]=[[[g,d]],[[h,m[1],$,d]]];return[r,e]},Bn=function(e){var t,n,r,i,o,l=this.$tpl[1],a=this.$revivable,u=l.length,s=[],c="";for(n=0;u>n;n++)t=l[n],r=t[0],o=t[1],i=t[2],r?(a&&!o&&t[3]>-1&&s.length&&(i=i.slice(0,t[3])+"<!--"+s.join("\n")+"-->"+i.slice(t[3]),s=[]),c+=i):(e[et](i)&&(t[3]=String(e[i])),a?o?(c+=t[3],t[4]&&s.push("att:"+t[4]+"|key:"+i+"|"+[t[5],t[3].length].join(","))):c+="<!--key:"+i+"-->"+t[3]+"<!--/key-->":c+=t[3]);return c},Wn=function(e){var t,n,r,i,o,l,a,u,s,c,f,d,h,p,g=this.$tpl[0];for(i=b(e),a=i.length,l=0;a>l;l++)if(o=i[l],u=String(e[o]),g[et](o)){for(s=g[o][0],n=0,r=s.length;r>n;n++)s[n][0][Pn]=u;for(c=g[o][1],n=0,r=c.length;r>n;n++){if(t=c[n],f=t[1],h=f.length,p=h?f[0][Pn]:"",h>1)for(d=1;h>d;d++)p+=f[d][Pn];t[0][Pn]=p}}return this},Jn=function dr(e,t,n){var r=this;return r instanceof dr?(r.initPubSub(),r.$revivable=!0===n,void(e.substr&&e.substring?(r.$key=t[In]?t:new RegExp(t.source,t[Rn]?"gi":"g"),r.$tpl=dr.multisplit_string(e,r.$key,r.$revivable),r.render=Bn):(r.$key=t[In]?new RegExp(t.source,t[Rn]?"i":""):t,r.$tpl=Yn(e,r.$key,r.$revivable),r.render=Wn))):new dr(e,t,n)};Jn.multisplit_string=Un,Jn.multisplit_node=Yn,Jn[f]=G($(v[f]),Kt,{constructor:Jn,id:null,$tpl:null,$key:null,$revivable:!1,dispose:function(){var e=this;return e.disposePubSub(),e.$key=null,e.$tpl=null,e.$revivable=null,e},keys:function(){return b(this.$tpl[0])},render:function(){},bind:function(e){var t=this;if(e){var n,r=t.$tpl[0],i=Yn(e,t.$key,!1)[0];for(n in i)i[et](n)&&(r[et](n)?(r[n][0]=r[n][0].concat(i[n][0]),r[n][1]=r[n][1].concat(i[n][1])):r[n]=i[n])}return t},free:function(e){var t=this;if(e){var n,r,i,o,l,a,u,s=t.$tpl[0],c=b(s),f=c.length;for(o=0;f>o;o++){for(n=c[o],l=s[n],a=l[0],i=a.length,r=i-1;r>=0;r--)e.contains(a[r][1])&&a.splice(r,1);for(u=l[1],i=u.length,r=i-1;r>=0;r--)e.contains(u[r][3])&&u.splice(r,1)}}return t},toString:function(){return"[ModelView.Tpl id: "+this.id+"]"}});var Xn="mv_namedkey",qn=function(e,t){return new p(O(e).replace("__MODEL__",O(t||"")).replace("__KEY__","(\\S+?)"),"")},Zn=function(e,t,n){return[e?"["+e+"]":null,t?t[1]?"["+t[0]+'*="|'+t[1]+'"]':"["+t[0]+"]":null,n?n[1]?'input[name="'+n[0]+'"],textarea[name="'+n[0]+'"],select[name="'+n[0]+'"]':'input[name^="'+n[0]+'"],textarea[name^="'+n[0]+'"],select[name^="'+n[0]+'"]':null]},Kn=function(e,t){return t&&t[e]?(Z(t[e],P)&&(t[e]={action:t[e]}),t[e]):void 0},Qn=function(e,t,n,r){var i,o,l,a,u,s,c=e.$model,f="sync"==t.type,d=f?"change":t.type,h=n.length,p=r&&r.key?r.key:null,g=!p,v=p?p+".":null,m=c.atomic,$=c.$atom,b=m?$+".":null;for(i=0;h>i;i++)o=n[i],o&&(l=Kn(d,e.attr(o,"bind")),l&&l[et]("action")&&(a="do_"+l.action,Z(e[a],R)&&(u=o[lt],s=l.key,s||(!o[Xn]&&u&&(o[Xn]=c.key(u,1)),s=o[Xn]),m&&s&&($===s||yt(s,b))||p&&!s||(g||s===p||yt(s,v))&&e[a](t,o,l))))},Gn=function(e,t,n){var r,i,o,l,a,u,s=e.$model,c={},f=n.length;for(r=0;f>r;r++)if(i=n[r],i&&(o=i[lt],l=0,!i[Xn]&&o&&(i[Xn]=s.key(o,1)),l=i[Xn])){if(a="_"+l,c[et](a))u=c[a][0];else{if(!s.has(l))continue;c[a]=[u=s.get(l)]}e.do_bind(t,i,{name:o,key:l,value:u})}},er=function(e,t,n){var r,i,o,l,a=e.$model,u="sync"==t.type,s=!1,c=e.$tpl.keys(),f=c.length,d={};if(u)for(o=0;f>o;o++)l=c[o],d[l]=a.get(l),s=!0;else if(n&&n.key)for(r=n.key,i=r+".",o=0;f>o;o++)l=c[o],(r===l||yt(l,i))&&(d[l]=a.get(l),s=!0);s&&e.$tpl.render(d)},tr={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},nr={27:"escape",9:"tab",32:"space",13:"enter",8:"backspace",145:"scrolllock",20:"capslock",144:"numlock",19:"pause",45:"insert",36:"home",46:"delete",35:"end",33:"pageup",34:"pagedown",37:"left",38:"up",39:"right",40:"down",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12"},rr=/\[\s*\]$/,ir=function(e,t){return function(n){return e[t](n,{el:this})}},or=function hr(e,t,n,r,i){var o=this;return o instanceof hr?(o.namespace=o.id=e||Wt("View"),(n=n||{})[et]("bind")||(n.bind="data-bind"),o.$atts=n,r=r||hr._CACHE_SIZE,i=i||hr._REFRESH_INTERVAL,o.$memoize=new Qt(r,x),o.$selectors=new Qt(r,i),o.$atbind=o.attribute("bind"),o.$shortcuts={},o.$num_shortcuts=0,void o.model(t||new Ln).initPubSub()):new hr(e,t,n,r,i)};return or._CACHE_SIZE=600,or._REFRESH_INTERVAL=x,or.node=kt,or.index=Et,or.indexClosest=Tt,or.getDomRef=Dt,or[f]=G($(v[f]),Kt,{constructor:or,id:null,$dom:null,$tpl:null,$model:null,$livebind:null,$autobind:!1,$isomorphic:!1,$bindbubble:!1,$template:null,$atts:null,$memoize:null,$selectors:null,$atbind:null,$shortcuts:null,$num_shortcuts:null,dispose:function(){var e=this;return e.unbind().disposePubSub(),e.$model&&e.$model.dispose(),e.$model=null,e.$dom=null,e.$tpl&&e.$tpl.dispose(),e.$tpl=null,e.$template=null,e.$atts=null,e.$memoize.dispose(),e.$memoize=null,e.$selectors.dispose(),e.$selectors=null,e.$livebind=null,e.$isomorphic=null,e.$atbind=null,e.$shortcuts=null,e.$num_shortcuts=null,e},model:function(e){var t=this;return arguments.length?(t.$model&&t.$model.dispose(),t.$model=e.view(t),t):t.$model},attribute:function(e,t){var n=this;return arguments.length>1?(n.$atts[e]=t,n.$atbind=n.$atts.bind,n.$atkeys=n.$atts.keys,n):e?n.$atts[e]||u:u},template:function(e){var t=this;return arguments.length?(Z(e,R)&&(t.$template=e),t):t.$template},events:function(e){var t,n=this;if(Z(e,I))for(t in e)e[et](t)&&Z(e[t],R)&&(n["on_"+t.split(":").join("_")]=e[t]);return n},shortcuts:function(e){var t,n,r,i,o,l=this,a=l.$shortcuts;if(Z(e,I))for(t in e)if(e[et](t)){for(i=[],r=t.toLowerCase().split("+").map(bt),o=r.length-1;o>=0;o--)n=r[o],("alt"===n||"ctrl"===n||"shift"===n||"meta"===n)&&(i.push(n),r.splice(o,1));n=i.sort().concat(r).join("+"),!1===e[t]?a[et](n)&&(A(a,n),l.$num_shortcuts--):(a[et](n)||l.$num_shortcuts++,a[n]=e[t])}return l},actions:function(e){var t,n=this;if(Z(e,I))for(t in e)e[et](t)&&Z(e[t],R)&&(n["do_"+t]=e[t]);return n},autovalidate:function(e){return arguments.length?(this.$model.autovalidate(e),this):this.$model.autovalidate()},livebind:function(e){var t=this;return arguments.length?(t.$livebind=e?qn(e,t.$model?t.$model.id:""):null,t):t.$livebind},isomorphic:function(e){var t=this;return arguments.length?(t.$isomorphic=!!e,t):t.$isomorphic},autobind:function(e){var t=this;return arguments.length?(t.$autobind=!!e,t):t.$autobind},bindbubble:function(e){var t=this;return arguments.length?(t.$bindbubble=!!e,t):t.$bindbubble},get:function(e,t,n,r){var i,o=this,l=o.$selectors;return t=t||o.$dom,(r||!(i=l.get(e)))&&(i=Mt(e,t),n&&t[xt](e)&&i.push(t),r||l.set(e,i)),i},attr:function(e,t){var n,r,i=this,o=i.$atts[t],l=i.$memoize;return(o=e[tt](o))?(n=l.get(o),u===n&&(n=mt(o),n.set&&(n.click=n.set,n.click.action="set",A(n,"set")),n.each&&(n.change={action:"each",key:n.each},A(n,"each")),n.show&&(n.change={action:"show",key:n.show},A(n,"show")),n.hide&&(n.change={action:"hide",key:n.hide},A(n,"hide")),n.html?(n.change={action:"html",key:n.html},A(n,"html"),A(n,"text")):n.text&&(n.change={action:"html",key:n.text,text:1},A(n,"text")),n.css&&(n.change={action:"css",css:n.css},A(n,"css")),n.value&&(n.change&&"prop"==n.change.action?n.change.prop.value=n.value:n.change={action:"prop",prop:{value:n.value}},A(n,"value")),n.checked&&(n.change&&"prop"==n.change.action?n.change.prop.checked=n.checked:n.change={action:"prop",prop:{checked:n.checked}},A(n,"checked")),n.disabled&&(n.change&&"prop"==n.change.action?n.change.prop.disabled=n.disabled:n.change={action:"prop",prop:{disabled:n.disabled}},A(n,"disabled")),n.options&&(n.change&&"prop"==n.change.action?n.change.prop.options=n.options:n.change={action:"prop",prop:{options:n.options}},A(n,"options")),(r=n.change)&&!r.key&&n.key&&(r.key=n.key),l.set(o,n)),n):u},add:function(e,t){var n=this;return e&&(n.$tpl&&n.$tpl.bind(e),!1!==t&&n.sync(null,e)),n},remove:function(e,t){var n=this;return e&&(n.$tpl&&n.$tpl.free(e),!1!==t&&n.$selectors.reset()),n},bind:function(e,n){var r,i,o,l=this,u=l.$model,s=Zn(l.$atbind,null,[u.id+"["]),c=s[0],f=s[2],d=l.$autobind,h=!!l.$livebind,p="undefined"!=typeof document;e=e||["change","click"],l.$dom=n||(p?document.body:null),o=function(e){return t(e,l.namespace)},h&&(l.$tpl=Jn(l.$dom,l.$livebind,l.$isomorphic)),p&&l.on_view_change&&e.length&&a(l.$dom).on(e.map(o).join(" "),d?[f,c].join(","):c,function(e){var t=this,n=!1,r=!1,i=l.$bindbubble?l.attr(t,"bind"):null;return(e.target===t||i&&i.bubble)&&(r=l.$bindbubble?!!i:t[xt](c),n=d&&"change"==e.type&&t[xt](f),(r||n)&&l.on_view_change(e,{el:t,isBind:r,isAutoBind:n})),!0});for(r in l)Z(l[r],R)&&(yt(r,"on_model_")?(i=r.slice(9),i.length&&l.onTo(u,i,l[r])):p&&(yt(r,"on_document_")?(i=r.slice(12),i.length&&a(document.body).on(o(i),ir(l,r))):yt(r,"on_view_")&&"on_view_change"!==r?(i=r.slice(8),i.length&&a(l.$dom).on(o(i),d?[f,c].join(","):c,ir(l,r))):yt(r,"on_dom_")&&(i=r.slice(7),i.length&&a(l.$dom).on(o(i),ir(l,r)))));return l},unbind:function(e,n){var r,i,o=this,l=o.$model,u=Zn(o.$atbind,null,[l.id+"["]),s=t("",o.namespace),c=o.$autobind,f=(!!o.$livebind,"undefined"!=typeof document);return e=e||null,i=n||o.$dom,r=function(e){return t(e,o.namespace)},f&&o.on_view_change&&a(i).off(e&&e.length?e.map(r).join(" "):s,c?[u[2],u[0]].join(","):u[0]),o.offFrom(l),f&&(a(i).off(s),a(document.body).off(s)),o.$tpl&&(o.$tpl.dispose(),o.$tpl=null),o},rebind:function(e,t){var n=this;return n.$memoize.reset(),n.$selectors.reset(),n.unbind().bind(e,t)},sync:function(e,t){var n,r,i,o=this,l=o.$autobind,a=!!o.$livebind,u=Zn(o.$atbind,null,l?[o.$model.id+"["]:0),s=Zt("sync",o),c="undefined"!=typeof document;return o.$selectors.reset(),t?(s.currentTarget=t,c&&(n=o.get(u[0],t,0,1),l&&(r=o.get(u[2],t,0,1)))):c&&(e=e||o.$dom,i=!(e===o.$dom),n=o.get(u[0],e,0,i),l&&(r=o.get(u[2],e,0,i))),c&&n.length&&Qn(o,s,n),c&&l&&r.length&&Gn(o,s,r),a&&o.$tpl&&er(o,s),o},reset:function(){var e=this;return e.$memoize.reset(),e.$selectors.reset(),e},on_view_change:function(e,t){var n,r,i,o,l,a,u,s=this,c=s.$model,f=t.el,d={};t.isAutoBind&&(n=f[lt])&&(f[Xn]||(f[Xn]=c.key(n,1)),r=f[Xn],r&&c.has(r)&&(a=f[ut].toLowerCase(),"checkbox"===a?(l=rr.test(n),o=s.get('input[type="checkbox"][name="'+n+'"]'),l?(i=[],o.forEach(function(e){e[rt]&&i.push(e[st])})):o.length>1?(i=[],o.forEach(function(e){i.push(e[rt]?e[st]:(u=e[tt]("data-else"))?u:"")})):i=f[rt]?f[st]:(u=f[tt]("data-else"))?u:""):i=Pt(f),d.$trigger=f,c.set(r,i,1,d))),!d.error&&t.isBind&&Qn(s,e,[f]),s.publish("change",t)},on_document_keydown:function(e,t){var n,r,i,o,l,a,u=this,s=u.$shortcuts,c=t.el;if(u.$num_shortcuts&&"TEXTAREA"!==c.tagName&&"INPUT"!==c.tagName)return o=e.keyCode||e.which,a=[],e.altKey&&a.push("alt"),e.ctrlKey&&a.push("ctrl"),e.metaKey&&a.push("meta"),e.shiftKey&&a.push("shift"),nr[et](o)?i=nr[o]:(l=188===o?",":190===o?".":w.fromCharCode(o).toLowerCase(),e.shiftKey&&tr[et](l)&&(l=tr[l]),i=l),i=a.concat(i).join("+"),i&&s[et](i)&&s[i]&&(n=s[i],r=!0,n.substr?Z(u["do_"+n],R)&&(u["do_"+n](e,c,{}),r=!1):r=n.call(u,e,c,{}),!1===r)?(e.stopPropagation(),e.preventDefault(),!1):void 0},on_model_change:function(e,t){var n,r,i,o=this,l=o.$model,a=o.$autobind,u=!!o.$livebind,s=Zn(o.$atbind,null,a?[l.id+Sn(t.key)]:0),c="undefined"!=typeof document;c&&(n=o.get(s[0]),a&&(r=o.get(s[2])),t.$callData&&t.$callData.$trigger&&(i=function(e){return e!==t.$callData.$trigger},n=n.filter(i),a&&(r=r.filter(i)),t.$callData=null)),c&&n.length&&Qn(o,e,n,t),c&&a&&r.length&&Gn(o,e,r,t),u&&o.$tpl&&er(o,e,t)},on_model_error:function(e,t){var n,r,i=this,o=i.$model,l=i.$autobind,a=!!i.$livebind,u=Zn(i.$atbind,null,l?[o.id+Sn(t.key)]:0),s="undefined"!=typeof document;s&&(n=i.get(u[0])).length&&Qn(i,e,n,t),s&&l&&(r=i.get(u[2])).length&&Gn(i,e,r,t),a&&i.$tpl&&er(i,e,t)},do_nop:null,do_each:function(){},do_prop:function(e,t,n){if(Z(n.prop,I)){var r,i,o,l,a,u=this,s=u.$model,c=n.prop;t=(a=t[tt]("data-domref"))?or.getDomRef(t,a):[t],t&&t.length&&t.forEach(function(e){if(e)for(r in c)if(c[et](r)){if(i=c[r],!s.has(i))continue;switch(o=s.get(i),l=q(o),r){case"value":Vt(e,o);break;case"checked":case"disabled":e[r]=j===l?o:w(o)==e[st];break;case"options":if("SELECT"===e[at]&&z===l){var t,n,a=o.length,u="",f=St("optgroup",e);for(t=Nt(e),f=f.length?f[0]:e,St("option",f).forEach(function(e){f.removeChild(e)}),n=0;a>n;n++)u+=o[n]&&o[n].label?'<option value="'+o[n].value+'">'+o[n].label+"</option>":'<option value="'+o[n]+'">'+o[n]+"</option>";f[pt]=u,jt(e,t)}break;default:e[nt](r,o)}}})}},do_html:function(e,t,n){if(n.key){var r,i=this,o=i.$model,l=n.key;t=(r=t[tt]("data-domref"))?or.getDomRef(t,r):[t],t&&t.length&&l&&o.has(l)&&t.forEach(function(e){e&&(e[n.text?vt in e?vt:gt:pt]=o.get(l))})}},do_css:function(e,t,n){if(Z(n.css,I)){var r,i,o,l,a=this,u=a.$model,s=n.css;t=(l=t[tt]("data-domref"))?or.getDomRef(t,l):[t],t&&t.length&&t.forEach(function(e){if(e)for(i in s)s[et](i)&&(r=s[i],o=u.get(r),o&&(e.style[i]=o))})}},do_set:function(e,t,n){var r,i,o=this,l=o.$model,a=null;n.key?a=n.key:t[lt]&&(t[Xn]||(t[Xn]=l.key(t[lt],1)),a=t[Xn]),a&&(n[et]("value")?r=n.value:((i=t[tt]("data-domref"))&&(t=or.getDomRef(t,i)[0]),r=Pt(t)),l.set(a,r,1))},do_tpl:function(e,t,n){var r,i,o,l,a=this,u=n.key,s=n.tpl;a.$template&&u&&s&&(r=a.$model,u&&r.has(u)&&(t=(l=t[tt]("data-domref"))?or.getDomRef(t,l):[t],t&&t.length&&(i=n.mode||"replace",o=a.$template(s,r.get(u)),t.forEach(function(e){e&&("replace"==i&&(e[pt]=""),o&&(e[pt]+=o))}))))},do_show:function(e,t,n){var r,i,o,l=this,a=l.$model,u=n.key;u&&(t=(i=t[tt]("data-domref"))?or.getDomRef(t,i):[t],t&&t.length&&(r=a.get(u),o=n[et]("value")?n.value===r:!!r,t.forEach(function(e){e&&(o?Ot(e):At(e))})))},do_hide:function(e,t,n){var r,i,o,l=this,a=l.$model,u=n.key;u&&(t=(i=t[tt]("data-domref"))?or.getDomRef(t,i):[t],t&&t.length&&(r=a.get(u),o=n[et]("value")?n.value===r:!!r,t.forEach(function(e){e&&(o?At(e):Ot(e))})))},do_bind:function(e,t,n){var r,i,o,l=this,a=(l.$model,n.name),u=n.key,s=t[ut].toLowerCase();u&&(r=n.value,i=q(r),"radio"===s?w(r)==t[st]&&(l.get('input[name="'+a+'"]').forEach(function(e){t!==e&&(e[rt]=!1)}),t[rt]=!0):"checkbox"===s?(o=rr.test(a),o?(r=z===i?r:[r],t[rt]=-1<r.indexOf(t[st])):t[rt]=z===i?-1<r.indexOf(t[st]):j===i?r:w(r)==t[st]):Vt(t,r))},toString:function(){return"[ModelView.View id: "+this.id+"]"}}),e.ModelView={VERSION:"0.62",UUID:Wt,Extend:G,Type:vn,Validation:mn,Cache:Qt,Model:Ln,Tpl:Jn,View:or},!function(e,t){e.jquery=function(t){if(!t.ModelView){t.ModelView=e;var n=(Function.prototype.call.bind(Array.prototype.slice),t.extend),r=e.View,i=e.Model;t.fn.modelview=function(e,o){var l=arguments.length,a=l?e:null,u=e,s=!0,c=!1,f=[];return this.each(function(){var e,d,h,p,g=t(this);if(g.data("modelview")){if(s=!1,d=g.data("modelview"),e=d.$model,"view"===a)f.push(d);else if("model"===a){if(l>1)return d.model(o),this;f.push(e)}else if("data"===a){if(l>1)return e.data(o),this;f.push(e.data())}else"sync"===a?d.sync(o):"reset"===a?d.reset():"dispose"===a&&(g.data("modelview",null),d.dispose());return this}return c||(h={id:"model",data:{},types:{},validators:{},getters:{},setters:{},dependencies:{}},p={viewClass:r,modelClass:i,id:"view",bindAttribute:"data-bind",livebind:null,autobind:!1,isomorphic:!1,bindbubble:!1,autovalidate:!0,events:null,autoSync:!0,cacheSize:r._CACHE_SIZE,refreshInterval:r._REFRESH_INTERVAL,model:null,template:null,actions:{},handlers:{},shortcuts:{}},u=n({},p,u),!u.model||u.model instanceof i||(u.model=n({},h,u.model)),c=!0),u.model?(e=u.model instanceof i?u.model:new u.modelClass(u.model.id,u.model.data,u.model.types,u.model.validators,u.model.getters,u.model.setters,u.model.dependencies),d=new u.viewClass(u.id,e,{bind:u.bindAttribute||"data-bind"},u.cacheSize,u.refreshInterval).template(u.template).events(u.handlers).shortcuts(u.shortcuts).actions(u.actions).livebind(u.livebind).autobind(u.autobind).isomorphic(u.isomorphic).bindbubble(u.bindbubble).autovalidate(u.autovalidate).bind(u.events,g[0]),g.data("modelview",d),void(u.autoSync&&d.sync())):this}),!s&&f.length?1==this.length?f[0]:f:this}}!t.widget||t.mvc&&t.mvc.ModelViewWidget||t.widget("mvc.ModelViewWidget",{options:{},$view:null,_create:function(){var e=this;e.$view=e.element.modelview(e.options).modelview("view")},value:function(e,t){var n=this;return 1<arguments.length?(n.$view.$model.set(e,t,1),n.element):n.$view.$model.get(e)},view:function(){return this.$view},model:function(){return this.$view.$model},_destroy:function(){var e=this.self.$view=null;e.element.modelview("dispose")}})},"undefined"!=typeof t.jQuery&&e.jquery(t.jQuery)}(e.ModelView,this),e.ModelView});
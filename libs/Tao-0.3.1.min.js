/**
*  Tao
*  A simple, tiny, isomorphic, precise and fast template engine for handling both string and live dom based templates
*
*  @version: 0.3.1
*  https://github.com/foo123/Tao.js
*
**/
!function(e,t,i){"use strict";var s,n="object"==typeof module&&module.exports,l="function"==typeof define&&define.amd;n?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||i.call(e,{NODE:module})||1:l&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,s,n){return i.call(e,{AMD:n})}):t in e||(e[t]=s=i.call(e,{})||1)&&l&&define(t,[],function(){return s})}(this,"Tao",function(e,t){"use strict";function i(e,t,i){var n;return i=!0===i,e?e.substr&&e.substring?(e=g(e,new RegExp(t.source,"g"),i),n=function l(e){var t,n,r,u,p,h=l.tpl[1],f=h.length,o=[],g="";for(n=0;f>n;n++)t=h[n],r=t[0],p=t[1],u=t[2],r?(i&&!p&&t[3]>-1&&o.length&&(u=u.slice(0,t[3])+"<!--"+o.join("\n")+"-->"+u.slice(t[3]),o=[]),g+=u):(e[s](u)&&(t[3]=String(e[u])),i?p?(g+=t[3],t[4]&&o.push("att:"+t[4]+"|key:"+u+"|"+[t[5],t[3].length].join(","))):g+="<!--key:"+u+"-->"+t[3]+"<!--/key-->":g+=t[3]);return g}):(e=c(e,new RegExp(t.source,""),i),n=function u(e){var t,i,n,l,p,f,o,g,c,d,a,b,x,S,y=u.tpl[0];for(l=h(e),o=l.length,f=0;o>f;f++)if(p=l[f],g=String(e[p]),y[s](p)){for(c=y[p][0],i=0,n=c.length;n>i;i++)c[i][0][r]=g;for(d=y[p][1],i=0,n=d.length;n>i;i++){if(t=d[i],a=t[1],x=a.length,S=x?a[0][r]:"",x>1)for(b=1;x>b;b++)S+=a[b][r];t[0][r]=S}}}):n=function(){},n.tpl=e,n.dispose=function(){n.tpl=null},n}var s="hasOwnProperty",n="lastIndexOf",l="match",r="nodeValue",u="nodeType",p="parentNode",h=Object.keys,f=/[a-zA-Z0-9_\-]/,o=function(e){return parseInt(e,10)},g=function(e,i,l){for(var r,u,p,h,o,g,c,d,a,b,x=[],S=0,y=!1,m=-1,v=0,C=!1,T={};r=i.exec(e);){if(u=i.lastIndex-r[0].length,p=e.slice(S,u),a=-1,l&&(c=p[n]("<"),d=p[n](">"),c>d?(a=-1,C=!0):d>c&&(a=d+1,C=!1)),x.push([1,C,p,a]),C)if(-1<(o=p[n]("="))){for(y="",g=o;o>-1&&f.test(h=p.charAt(--o));)y=h+y;m=u-S-g-2,v=m+r[0].length}else y&&(m=v+u-S-2-1,v+=m+r[0].length);else y=!1,v=0,m=-1;b=r[1]?r[1]:r[0],T[s](b)?T[b].push(x.length):T[b]=[x.length],x.push([0,C,b,t,y,m]),S=i.lastIndex}return p=e.slice(S),a=-1,l&&(c=p[n]("<"),d=p[n](">"),c>d?(a=-1,C=!0):d>c&&(a=d+1,C=!1)),x.push([1,C,p,a]),[T,x]},c=function(e,t,i){var n,h,f,g,c,d,a,b,x,S,y,m,v,C,T,k,w,I,O,j,q,E,N,A=0;if(h=[],f=[],S=e,S.attributes&&(c=S.attributes.length))if(i&&S.firstChild&&8===S.firstChild[u]&&"att:"===S.firstChild[r].slice(0,4))for(b=S.firstChild[r].split("\n"),c=b.length,C={},g=0;c>g;g++)d=b[g].split("|"),O=d[0].slice(4),y=S.attributes[O],C[s](O)||(C[O]=[1,[]],f.push([y,C[O],S])),C[O][1].push([d[1].slice(4),d[2].split(",").map(o)]);else for(g=0;c>g;g++)y=S.attributes[g],(d=y[r][l](t))&&f.push([0,y,d,S]);if(3===S[u])i&&S.previousSibling&&S.nextSibling&&8===S.previousSibling[u]&&8===S.nextSibling[u]&&"key:"===(m=S.previousSibling[r]).slice(0,4)&&"/key"===S.nextSibling[r]?(d=[S[r],m.slice(4)],h.push([S,d,S[p]])):(d=S[r][l](t))&&h.push([S,d,S[p]]);else if(S.firstChild)for(N=[S=S.firstChild];N.length;){if(S.attributes&&(c=S.attributes.length))if(i&&S.firstChild&&8===S.firstChild[u]&&"att:"===S.firstChild[r].slice(0,4))for(b=S.firstChild[r].split("\n"),c=b.length,C={},g=0;c>g;g++)d=b[g].split("|"),O=d[0].slice(4),y=S.attributes[O],C[s](O)||(C[O]=[1,[]],f.push([y,C[O],S])),C[O][1].push([d[1].slice(4),d[2].split(",").map(o)]);else for(g=0;c>g;g++)y=S.attributes[g],(d=y[r][l](t))&&f.push([y,d,S]);if(S.firstChild)N.push(S=S.firstChild);else{for(3===S[u]&&(i&&S.previousSibling&&S.nextSibling&&8===S.previousSibling[u]&&8===S.nextSibling[u]&&"key:"===(m=S.previousSibling[r]).slice(0,4)&&"/key"===S.nextSibling[r]?(d=[S[r],m.slice(4)],h.push([S,d,S[p]])):(d=S[r][l](t))&&h.push([S,d,S[p]])),S=N.pop();N.length&&!S.nextSibling;)S=N.pop();S.nextSibling&&N.push(S=S.nextSibling)}}for(n={},g=0,c=h.length;c>g;g++)if(a=h[g],E=a[0],d=a[1],S=a[2],w=E[r],w.length>d[0].length){do m=d[1]?d[1]:d[0],v=E.splitText(d.index),E=v.splitText(d[0].length),n[s](m)?n[m][0].push([v,S]):n[m]=[[[v,S]],[]],d=E[r][l](t);while(d)}else m=d[1]?d[1]:d[0],v=E,n[s](m)?n[m][0].push([v,S]):n[m]=[[[v,S]],[]];for(T={},g=0,c=f.length;c>g;g++)if(a=f[g],y=a[0],d=a[1],S=a[2],w=y[r],I=w,k=I in T,k&&(I+="_"+ ++A,k=!1),!k)if(E=document.createTextNode(w||""),T[I]=[[],[E]],1===d[0])for(b=d[1],x=b.length,q=0,g=0;x>g;g++)j=b[g],m=j[0],v=E.splitText(j[1][0]-q),E=v.splitText(j[1][1]),T[I][0].push(m),T[I][1].push(v,E),n[s](m)?(n[m][0].push([v,S]),n[m][1].push([y,T[I][1],w,S])):n[m]=[[[v,S]],[[y,T[I][1],w,S]]],q+=j[1][1]+j[1][0];else if(w.length>d[0].length){do m=d[1]?d[1]:d[0],v=E.splitText(d.index),E=v.splitText(d[0].length),T[I][0].push(m),T[I][1].push(v,E),n[s](m)?(n[m][0].push([v,S]),n[m][1].push([y,T[I][1],w,S])):n[m]=[[[v,S]],[[y,T[I][1],w,S]]],d=E[r][l](t);while(d)}else v=E,m=d[1]?d[1]:d[0],T[I][0].push(m),n[s](m)?(n[m][0].push([v,S]),n[m][1].push([y,T[I][1],w,S])):n[m]=[[[v,S]],[[y,T[I][1],w,S]]];return[n,e]};return i.VERSION="0.3.1",i});
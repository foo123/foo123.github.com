<!doctype html>
<html lang="en" class="no-ie">
<head>
<title>img2svg: vectorize image to svg</title>

<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, minimum-scale=1.0">
<meta name="description" content="img2svg: transform image to svg using potrace algorithm with color" />
<meta property="og:title" content="img2svg: vectorize image to svg">
<meta property="og:description" content="img2svg: transform image to svg using potrace algorithm with color">
<meta property="og:image" content="https://foo123.github.io/thumbs/img2svg.png">
<meta property="og:url" content="https://foo123.github.io/examples/img2svg/">
<meta name="twitter:card" content="summary">
<link rel="stylesheet" type="text/css" href="../common/css/datgui.min.css" />
<style type="text/css">
body {
    background: #444;
    color: #ccc;
    font-size: 16px;
    font-family: Helvetica, Arial, sans-serif;
}
.button {
    -moz-box-shadow:inset 0px 1px 0px 0px #f5978e;
    -webkit-box-shadow:inset 0px 1px 0px 0px #f5978e;
    box-shadow:inset 0px 1px 0px 0px #f5978e;
    background:-webkit-gradient( ease, left top, left bottom, color-stop(0.05, #f24537), color-stop(1, #c62d1f) );
    background:-moz-ease-gradient( center top, #f24537 5%, #c62d1f 100% );
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#f24537', endColorstr='#c62d1f');
    background-color:#f24537;
    -webkit-border-top-left-radius:20px;
    -moz-border-radius-topleft:20px;
    border-top-left-radius:20px;
    -webkit-border-top-right-radius:20px;
    -moz-border-radius-topright:20px;
    border-top-right-radius:20px;
    -webkit-border-bottom-right-radius:20px;
    -moz-border-radius-bottomright:20px;
    border-bottom-right-radius:20px;
    -webkit-border-bottom-left-radius:20px;
    -moz-border-radius-bottomleft:20px;
    border-bottom-left-radius:20px;
    text-indent:0;
    border:1px solid #d02718;
    display:inline-block;
    color:#ffffff;
    font-family:Arial;
    font-size:15px;
    font-weight:bold;
    font-style:normal;
    height:50px;
    line-height:50px;
    width:200px;
    text-decoration:none;
    text-align:center;
    text-shadow:1px 1px 0px #810e05;
}
.button:hover {
    background:-webkit-gradient( ease, left top, left bottom, color-stop(0.05, #c62d1f), color-stop(1, #f24537) );
    background:-moz-ease-gradient( center top, #c62d1f 5%, #f24537 100% );
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#c62d1f', endColorstr='#f24537');
    background-color:#c62d1f;
}.button:active {
    position:relative;
    top:1px;
}
.button {
    margin: 3px 2px;
    position:relative;
    cursor:pointer;
}
#container {
    position: relative;
    display: block;
    margin: 0 auto;
    width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
}
header {
    position: relative;
    display: block;
    text-align: center;
    margin: 20px auto 30px auto;
}
h1 {
    position: relative;
    display: inline-block;
    font-size: 20px;
    margin: 0;
    padding: 0;
}
#controls > input,#controls > button {
    position: relative;
    font-size: 16px;
    padding: 4px;
    width: 200px;
    max-width: 45%;
    display: inline-block;
    box-sizing: border-box;
    vertical-align: top;
    margin: 4px;
}
#controls > input {
    background: #343434;
    color: #fff;
    border: 1px solid #aaa;
}
#controls > button {
    width: 60px;
    cursor: pointer;
}
#controls {
    position: relative;
    display: block;
    margin: 0 auto;
    margin-bottom: 20px;
    width: 100%;
    text-align: center;
    box-sizing: border-box;
}
#options {
    width: 340px;
    position: relative;
    display: block;
    margin: 10px auto 10px auto;
}
#options .guidat {
    margin: 0 !important;
    float: none;
    clear: both;
}
#img,#svg {
    position: relative;
    display: inline-block;
    margin: 0;
    margin-left: 5px;
    margin-bottom: 10px;
    width: calc(50% - 10px);
    vertical-align: top;
    text-align: center;
    box-sizing: border-box;
    padding: 10px;
    min-height: 100px;
}
#img,#svg {
    color: black;
    font-weight: bold;
    font-size: 18px;
    text-decoration: none;
    --space: .25rem;
    background-image: linear-gradient(45deg, #eee 25%, transparent 25%, transparent 75%, #eee 75%, #eee 100% ), linear-gradient(45deg, #eee 25%, white 25%, white 75%, #eee 75%, #eee 100%);
    background-position: 0 0, calc(2 * var(--space)) calc(2 * var(--space));
    background-size: calc(4 * var(--space)) calc(4 * var(--space));
}
#img img,#svg svg {
    position: relative;
    display: inline-block;
    vertical-align: top;
    margin: 0;
    max-width: 100%;
    height: auto;
}
@media (max-width: 420px) {
#img,#svg {
    width: 100%;
    margin-left: 0;
    min-height: 50px;
}
}
#forkongithub {
    position: relative;
    display: block;
    margin: 10px 0 10px 0;
}
#forkongithub  a {
    background: #aa0000;
    color: #fff;
    text-decoration: none;
    font-family: arial, sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.4rem;
    position: relative;
    transition: all 0.5s;
}
#forkongithub a:hover {
    background: #aa0000;
    color: #fff;
}
#forkongithub a::before, #forkongithub a::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    z-index: 100;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub a::after {
    bottom: 1px;
    top: auto;
}
@media screen and (min-width:800px) {
    #forkongithub {
        position: absolute;
        display: block;
        z-index: 100;
        top: 0;
        right: 0;
        width: 200px;
        overflow: hidden;
        height: 200px;
        margin: 0;
    }
    #forkongithub a {
        width: 200px;
        position: absolute;
        top: 60px;
        right: -60px;
        transform: rotate(45deg);
        box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    }
}
</style>
</head>
<body>
<span id="forkongithub"><a href="https://github.com/foo123/img2svg">See me on GitHub</a></span>
<header><h1>Convert Image to SVG with img2svg v.1.0.0</h1></header>
<div id="container">
<div id="controls">
<input type="text" id="image_url" placeholder="url.." />
<input type="text" id="image_filename" placeholder="file.." /><input type="file" id="image_file" style="position:absolute;opacity:0;z-index:-1;"/>
<div id="options"></div>
<p style="clear:both">Click on SVG to download it</p>
<button id="go">GO</button>
</div>
<div id="img" title="Image"></div><a id="svg" href="#" download="result.svg" title="SVG"></a>
</div>
<script type="text/javascript" src="../common/js/datgui.min.js"></script>
<script type="text/javascript">//<![CDATA[
(function() {
"use strict";
const imgContainer = document.getElementById('img');
const svgContainer = document.getElementById('svg');
const inpUrl = document.getElementById('image_url');
const inpFile = document.getElementById('image_file');
const inpFilename = document.getElementById('image_filename');
const go = document.getElementById('go');

const options = new DAT.GUI({height: 11*32, width:340, domElement: document.getElementById('options')});
const grayscale = options.add({gray: false}, 'gray').name('Grayscale');
const contrast = options.add({contrast: 0}, 'contrast', 0, 1, 0.1).name('Contrast');
const blur = options.add({radius: 0}, 'radius', 0, 20, 1).name('Blur Radius');
const depth = options.add({depth: 5}, 'depth', 1, 256, 1).name('Color Depth');
const connectedcomponents = options.add({cc: false}, 'cc').name('ConnectedComponents');
const minpathsegments = options.add({mps: 2}, 'mps', 2, 100, 1).name('MinPathSegments');
const turnpolicy = options.add({tp: "minority"}, 'tp').options({
"left":"left", "right":"right", "black":"black", "white":"white", "majority":"majority", "minority":"minority"
}).name('TurnPolicy');
const turdsize = options.add({ts: 0}, 'ts', 0, 100, 1).name('TurdSize');
const alphamax = options.add({a: 1}, 'a', 0, 2, 0.1).name('AlphaMax');
const optcurve = options.add({opt: true}, 'opt').name('OptCurve');
const opttolerance = options.add({ot: 0.2}, 'ot', 0, 1, 0.1).name('OptTolerance');

const worker = new Worker("worker.js?refresh=1");

let currentImage = null, imgType = 'jpg', img = null, imgData = null, imgChanged = false;

function html2dom(html)
{
    const container = document.createElement('div');
    container.innerHTML = html.trim();
    return container.firstChild;
}
function base64encode(buffer)
{
  const bytes = new Uint8Array(buffer), len = bytes.byteLength;
  let binary = '';
  for (let i=0; i<len; ++i) binary += String.fromCharCode(bytes[i]);
  return window.btoa(binary);
}
function getImageData(image, done)
{
    if (imgChanged)
    {
        imgChanged = false;
        img = new Image();
        imgData = null;
        img.onload = () => {
            const canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            try {
                canvas.getContext('2d').drawImage(img, 0, 0);
                imgData = canvas.getContext('2d').getImageData(0, 0, img.width, img.height);
            } catch (e) {
                imgData = e.toString();
            }
            done(img, imgData);
        };
        img.onerror = (e) => {
            img = null;
            imgData = e.message;
            done(img, imgData);
        };
        img.crossorigin = "";
        if (image instanceof File)
        {
            const reader = new FileReader();
            reader.onload = (e) => {
                img.src = e.target.result;
            };
            reader.onerror = (e) => {
                img = null;
                imgData = e.message;
                done(img, imgData);
            };
            reader.readAsDataURL(image);
        }
        else
        {
            //img.src = image;
            fetch(image, {}, {headers:{origin:window.location.hostname}})
            .then(res => res.arrayBuffer())
            .then(buffer => {
                img.src = 'data:image/'+imgType+';base64,' + base64encode(buffer);
            })
            .catch(e => {
                img = null;
                imgData = e.toString();
                done(img, imgData);
            });
        }
    }
    else
    {
        done(img, imgData);
    }
}
function convertToSVG(image)
{
    imgContainer.textContent = 'loading..';
    svgContainer.textContent = 'loading..';
    if (svgContainer.href != '#')
    {
        URL.revokeObjectURL(svgContainer.href);
        svgContainer.href = '#';
        svgContainer.target = '_self';
    }
    getImageData(image, (img, result) => {
        if (result instanceof ImageData)
        {
            imgContainer.textContent = '';
            imgContainer.appendChild(img);
            svgContainer.textContent = 'tracing..';
            worker.onmessage = function(e) {
                svgContainer.href = URL.createObjectURL(new Blob([e.data], {type: "image/svg+xml"}));
                svgContainer.target = '_blank';
                svgContainer.textContent = '';
                svgContainer.appendChild(html2dom(e.data));
            };
            worker.postMessage({
                imageData: result,
                filters:{
                    grayscale: grayscale.getValue(),
                    contrast: {amount:contrast.getValue()},
                    blur: {radius:blur.getValue()}
                },
                params: {
                    mode: grayscale.getValue() ? "gray" : "color",
                    depth: depth.getValue(),
                    connectedcomponents: connectedcomponents.getValue(),
                    minpathsegments: minpathsegments.getValue(),
                    turnpolicy: turnpolicy.getValue(),
                    turdsize: turdsize.getValue(),
                    alphamax: alphamax.getValue(),
                    optcurve: optcurve.getValue(),
                    opttolerance: opttolerance.getValue()
                }
            });
        }
        else
        {
            if (img)
            {
                imgContainer.textContent = '';
                imgContainer.appendChild(img);
                svgContainer.textContent = 'Cannot read image: ' + result.toString();
            }
            else
            {
                imgContainer.textContent = svgContainer.textContent = 'No image';
            }
        }
    });
}
function init()
{
    currentImage = null;
    inpUrl.value = '';
    inpFilename.value = '';
    inpFilename.addEventListener('focus', () => {
        inpFile.click();
        inpFilename.blur();
    }, false);
    inpFile.addEventListener('change', () => {
        if (inpFile.files[0])
        {
            inpUrl.value = '';
            inpFilename.value = inpFile.files[0].name;
            currentImage = inpFile.files[0];
            imgChanged = true;
        }
        else
        {
            inpFilename.value = '';
            currentImage = null;
        }
    }, false);
    inpUrl.addEventListener('change', () => {
        if (inpUrl.value.trim().length)
        {
            inpFilename.value = '';
            currentImage = 'https://api.allorigins.win/raw?url='+encodeURIComponent(inpUrl.value.trim());
            switch(inpUrl.value.trim().split('.').pop().toLowerCase())
            {
                case 'webp': imgType = 'webp'; break;
                case 'gif': imgType = 'gif'; break;
                case 'png': imgType = 'png'; break;
                default: imgType = 'jpg'; break;
            }
            imgChanged = true;
        }
        else
        {
            inpUrl.value = '';
            currentImage = null;
        }
    }, false);
    go.addEventListener('click', () => {
        setTimeout(() => {
            if (currentImage) convertToSVG(currentImage);
        }, 40);
    }, false);
}
init();
})();
//]]></script>
</body>
</html>
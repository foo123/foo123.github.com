/**
*
*   FILTER.js Codecs
*   @version: @@VERSION@@
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (File Codecs)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,r){"use strict";"object"==typeof module&&module.exports?module.exports=r.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_CODECS")?define("FILTER_CODECS",["module","FILTER"],function(t,a){return r.moduleUri=t.uri,r.call(e,a),a}):(r.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function(e){return!function(e,r){"use strict";var t=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(e){var r=this.buffer,t=r?r.byteLength:0;if(t>e)return r;for(var a=512;e>a;)a<<=1;for(var n=new Uint8Array(a),o=0;t>o;++o)n[o]=r[o];return this.buffer=n},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var r=this.pos;if(e){this.ensureBuffer(r+e);for(var t=r+e;!this.eof&&this.bufferLength<t;)this.readBlock();var a=this.bufferLength;t>a&&(t=a)}else{for(;!this.eof;)this.readBlock();var t=this.bufferLength}return this.pos=t,this.buffer.subarray(r,t)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,r,t){for(var a=e+r;this.bufferLength<=a&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,r,t)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},e}(),a=function(){function e(e){throw new Error(e)}function r(r){var a=0,n=r[a++],o=r[a++];-1!=n&&-1!=o||e("Invalid header in flate stream"),8!=(15&n)&&e("Unknown compression method in flate stream"),((n<<8)+o)%31!=0&&e("Bad FCHECK in flate stream"),32&o&&e("FDICT bit set in flate stream"),this.bytes=r,this.bytesPos=a,this.codeSize=0,this.codeBuf=0,t.call(this)}var a=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),o=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),i=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],s=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];return r.prototype=Object.create(t.prototype),r.prototype.getBits=function(r){for(var t,a=this.codeSize,n=this.codeBuf,o=this.bytes,i=this.bytesPos;r>a;)"undefined"==typeof(t=o[i++])&&e("Bad encoding in flate stream"),n|=t<<a,a+=8;return t=n&(1<<r)-1,this.codeBuf=n>>r,this.codeSize=a-=r,this.bytesPos=i,t},r.prototype.getCode=function(r){for(var t=r[0],a=r[1],n=this.codeSize,o=this.codeBuf,i=this.bytes,s=this.bytesPos;a>n;){var f;"undefined"==typeof(f=i[s++])&&e("Bad encoding in flate stream"),o|=f<<n,n+=8}var c=t[o&(1<<a)-1],l=c>>16,d=65535&c;return(0==n||l>n||0==l)&&e("Bad encoding in flate stream"),this.codeBuf=o>>l,this.codeSize=n-l,this.bytesPos=s,d},r.prototype.generateHuffmanTable=function(e){for(var r=e.length,t=0,a=0;r>a;++a)e[a]>t&&(t=e[a]);for(var n=1<<t,o=new Uint32Array(n),i=1,s=0,f=2;t>=i;++i,s<<=1,f<<=1)for(var c=0;r>c;++c)if(e[c]==i){for(var l=0,d=s,a=0;i>a;++a)l=l<<1|1&d,d>>=1;for(var a=l;n>a;a+=f)o[a]=i<<16|c;++s}return[o,t]},r.prototype.readBlock=function(){function r(e,r,t,a,n){for(var o=e.getBits(t)+a;o-- >0;)r[A++]=n}var t=this.getBits(3);if(1&t&&(this.eof=!0),t>>=1,0==t){var f,c=this.bytes,l=this.bytesPos;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream");var d=f;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream"),d|=f<<8,"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream");var h=f;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream"),h|=f<<8,h!=(65535&~d)&&e("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var u=this.bufferLength,p=this.ensureBuffer(u+d),v=u+d;this.bufferLength=v;for(var g=u;v>g;++g){if("undefined"==typeof(f=c[l++])){this.eof=!0;break}p[g]=f}return void(this.bytesPos=l)}var m,y;if(1==t)m=i,y=s;else if(2==t){for(var b=this.getBits(5)+257,w=this.getBits(5)+1,U=this.getBits(4)+4,k=Array(a.length),A=0;U>A;)k[a[A++]]=this.getBits(3);for(var I=this.generateHuffmanTable(k),B=0,A=0,C=b+w,L=new Array(C);C>A;){var x=this.getCode(I);16==x?r(this,L,2,3,B):17==x?r(this,L,3,3,B=0):18==x?r(this,L,7,11,B=0):L[A++]=B=x}m=this.generateHuffmanTable(L.slice(0,b)),y=this.generateHuffmanTable(L.slice(b,C))}else e("Unknown block type in flate stream");for(var p=this.buffer,E=p?p.length:0,S=this.bufferLength;;){var P=this.getCode(m);if(256>P)S+1>=E&&(p=this.ensureBuffer(S+1),E=p.length),p[S++]=P;else{if(256==P)return void(this.bufferLength=S);P-=257,P=n[P];var T=P>>16;T>0&&(T=this.getBits(T));var B=(65535&P)+T;P=this.getCode(y),P=o[P],T=P>>16,T>0&&(T=this.getBits(T));var z=(65535&P)+T;S+B>=E&&(p=this.ensureBuffer(S+B),E=p.length);for(var G=0;B>G;++G,++S)p[S]=p[S-z]}}},r}();e.Utils.DecodeStream=t,e.Utils.FlateStream=a}(e),!function(e,r){"use strict";function t(r){return new e.Utils.FlateStream(r)}function a(){}a.prototype={constructor:a,data:null,pos:null,palette:null,imgData:null,transparency:null,animation:null,text:null,width:0,height:0,bits:null,colorType:null,compressionMethod:null,filterMethod:null,interlaceMethod:null,animation:null,hasAlphaChannel:null,colors:null,colorSpace:null,pixelBitlength:null,readData:function(e){var r,t,a,n,o,i,s,f,c,l,d,h,u,p,v=this;for(v.data=e,v.pos=8,v.palette=[],v.imgData=[],v.transparency={},v.animation=null,v.text={},o=null;;){switch(r=v.readUInt32(),c=function(){var e,r;for(r=[],i=e=0;4>e;i=++e)r.push(String.fromCharCode(this.data[this.pos++]));return r}.call(v).join("")){case"IHDR":v.width=v.readUInt32(),v.height=v.readUInt32(),v.bits=v.data[v.pos++],v.colorType=v.data[v.pos++],v.compressionMethod=v.data[v.pos++],v.filterMethod=v.data[v.pos++],v.interlaceMethod=v.data[v.pos++];break;case"acTL":v.animation={numFrames:v.readUInt32(),numPlays:v.readUInt32()||1/0,frames:[]};break;case"PLTE":v.palette=v.read(r);break;case"fcTL":o&&v.animation.frames.push(o),v.pos+=4,o={width:v.readUInt32(),height:v.readUInt32(),xOffset:v.readUInt32(),yOffset:v.readUInt32()},n=v.readUInt16(),a=v.readUInt16()||100,o.delay=1e3*n/a,o.disposeOp=v.data[v.pos++],o.blendOp=v.data[v.pos++],o.data=[];break;case"IDAT":case"fdAT":for("fdAT"===c&&(v.pos+=4,r-=4),e=(null!=o?o.data:void 0)||v.imgData,i=h=0;r>=0?r>h:h>r;i=r>=0?++h:--h)e.push(v.data[v.pos++]);break;case"tRNS":switch(v.transparency={},v.colorType){case 3:if(v.transparency.indexed=v.read(r),l=255-v.transparency.indexed.length,l>0)for(i=u=0;l>=0?l>u:u>l;i=l>=0?++u:--u)v.transparency.indexed.push(255);break;case 0:v.transparency.grayscale=v.read(r)[0];break;case 2:v.transparency.rgb=v.read(r)}break;case"tEXt":d=v.read(r),s=d.indexOf(0),f=String.fromCharCode.apply(String,d.slice(0,s)),v.text[f]=String.fromCharCode.apply(String,d.slice(s+1));break;case"IEND":return o&&v.animation.frames.push(o),v.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(v),v.hasAlphaChannel=4===(p=v.colorType)||6===p,t=v.colors+(v.hasAlphaChannel?1:0),v.pixelBitlength=v.bits*t,v.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(v),void(v.imgData=new Uint8Array(v.imgData));default:v.pos+=r}if(v.pos+=4,v.pos>v.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(e){var r,t,a,n=this;for(a=[],r=t=0;e>=0?e>t:t>e;r=e>=0?++t:--t)a.push(n.data[n.pos++]);return a},readUInt32:function(){var e,r,t,a,n=this;return e=n.data[n.pos++]<<24,r=n.data[n.pos++]<<16,t=n.data[n.pos++]<<8,a=n.data[n.pos++],e|r|t|a},readUInt16:function(){var e,r,t=this;return e=t.data[t.pos++]<<8,r=t.data[t.pos++],e|r},decodePixels:function(e){var r,a,n,o,i,s,f,c,l,d,h,u,p,v,g,m,y,b,w,U,k,A,I,B=this;if(null==e&&(e=B.imgData),0===e.length)return new Uint8Array(0);for(e=t(e),e=e.getBytes(),u=B.pixelBitlength/8,m=u*B.width,p=new Uint8Array(m*B.height),s=e.length,g=0,v=0,a=0;s>v;){switch(e[v++]){case 0:for(o=w=0;m>w;o=w+=1)p[a++]=e[v++];break;case 1:for(o=U=0;m>U;o=U+=1)r=e[v++],i=u>o?0:p[a-u],p[a++]=(r+i)%256;break;case 2:for(o=k=0;m>k;o=k+=1)r=e[v++],n=(o-o%u)/u,y=g&&p[(g-1)*m+n*u+o%u],p[a++]=(y+r)%256;break;case 3:for(o=A=0;m>A;o=A+=1)r=e[v++],n=(o-o%u)/u,i=u>o?0:p[a-u],y=g&&p[(g-1)*m+n*u+o%u],p[a++]=(r+Math.floor((i+y)/2))%256;break;case 4:for(o=I=0;m>I;o=I+=1)r=e[v++],n=(o-o%u)/u,i=u>o?0:p[a-u],0===g?y=b=0:(y=p[(g-1)*m+n*u+o%u],b=n&&p[(g-1)*m+(n-1)*u+o%u]),f=i+y-b,c=Math.abs(f-i),d=Math.abs(f-y),h=Math.abs(f-b),l=d>=c&&h>=c?i:h>=d?y:b,p[a++]=(r+l)%256;break;default:throw new Error("Invalid filter algorithm: "+e[v-1])}g++}return p},decodePalette:function(){var e,r,t,a,n,o,i,s,f,c,l=this;for(a=l.palette,i=l.transparency.indexed||[],o=new Uint8Array((i.length||0)+a.length),n=0,t=a.length,e=0,r=s=0,f=a.length;f>s;r=s+=3)o[n++]=a[r],o[n++]=a[r+1],o[n++]=a[r+2],o[n++]=null!=(c=i[e++])?c:255;return o},copyToImageData:function(e,r){var t,a,n,o,i,s,f,c,l,d,h,u=this;if(a=u.colors,l=null,t=u.hasAlphaChannel,u.palette.length&&(l=null!=(h=u._decodedPalette)?h:u._decodedPalette=u.decodePalette(),a=4,t=!0),n=e.data||e,c=n.length,i=l||r,o=s=0,1===a)for(;c>o;)f=l?4*r[o/4]:s,d=i[f++],n[o++]=d,n[o++]=d,n[o++]=d,n[o++]=t?i[f++]:255,s=f;else for(;c>o;)f=l?4*r[o/4]:s,n[o++]=i[f++],n[o++]=i[f++],n[o++]=i[f++],n[o++]=t?i[f++]:255,s=f},decode:function(){var e,r=this;return e=new Uint8Array(r.width*r.height*4),r.copyToImageData(e,r.decodePixels()),e}},e.Codec.PNG={encoder:e.NotImplemented("PNG.encoder"),decoder:function(e,r){var t=new a;return t.readData(new Uint8Array(e)),{width:t.width,height:t.height,data:t.decode()}}}}(e),!function(e,r){"use strict";function t(){}function a(e,r){for(var t,a,n=0,o=[],i=16;i>0&&!e[i-1];)i--;o.push({children:[],index:0});var s,f=o[0];for(t=0;i>t;t++){for(a=0;a<e[t];a++){for(f=o.pop(),f.children[f.index]=r[n];f.index>0;)f=o.pop();for(f.index++,o.push(f);o.length<=t;)o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s;n++}i>t+1&&(o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s)}return o[0].children}function n(e,r,t,a,n,o,i,s,c){function l(){if(T>0)return T--,P>>T&1;if(P=e[r++],255==P){var t=e[r++];if(t)throw"unexpected marker: "+(P<<8|t).toString(16)}return T=7,P>>>7}function d(e){for(var r,t=e;null!==(r=l());){if(t=t[r],"number"==typeof t)return t;if("object"!=typeof t)throw"invalid huffman sequence"}return null}function h(e){for(var r=0;e>0;){var t=l();if(null===t)return;r=r<<1|t,e--}return r}function u(e){var r=h(e);return r>=1<<e-1?r:r+(-1<<e)+1}function p(e,r){var t=d(e.huffmanTableDC),a=0===t?0:u(t);r[0]=e.pred+=a;for(var n=1;64>n;){var o=d(e.huffmanTableAC),i=15&o,s=o>>4;if(0!==i){n+=s;var c=f[n];r[c]=u(i),n++}else{if(15>s)break;n+=16}}}function v(e,r){var t=d(e.huffmanTableDC),a=0===t?0:u(t)<<c;r[0]=e.pred+=a}function g(e,r){r[0]|=l()<<c}function m(e,r){if(z>0)return void z--;for(var t=o,a=i;a>=t;){var n=d(e.huffmanTableAC),s=15&n,l=n>>4;if(0!==s){t+=l;var p=f[t];r[p]=u(s)*(1<<c),t++}else{if(15>l){z=h(l)+(1<<l)-1;break}t+=16}}}function y(e,r){for(var t=o,a=i,n=0;a>=t;){var s=f[t];switch(G){case 0:var p=d(e.huffmanTableAC),v=15&p,n=p>>4;if(0===v)15>n?(z=h(n)+(1<<n),G=4):(n=16,G=1);else{if(1!==v)throw"invalid ACn encoding";U=u(v),G=n?2:3}continue;case 1:case 2:r[s]?r[s]+=l()<<c:(n--,0===n&&(G=2==G?3:0));break;case 3:r[s]?r[s]+=l()<<c:(r[s]=U<<c,G=0);break;case 4:r[s]&&(r[s]+=l()<<c)}t++}4===G&&(z--,0===z&&(G=0))}function b(e,r,t,a,n){var o=t/x|0,i=t%x,s=o*e.v+a,f=i*e.h+n;r(e,e.blocks[s][f])}function w(e,r,t){var a=t/e.blocksPerLine|0,n=t%e.blocksPerLine;r(e,e.blocks[a][n])}var U,k,A,I,B,C,L,x=(t.precision,t.samplesPerLine,t.scanLines,t.mcusPerLine),E=t.progressive,S=(t.maxH,t.maxV,r),P=0,T=0,z=0,G=0,_=a.length;L=E?0===o?0===s?v:g:0===s?m:y:p;var M,D,R=0;D=1==_?a[0].blocksPerLine*a[0].blocksPerColumn:x*t.mcusPerColumn,n||(n=D);for(var F,X;D>R;){for(A=0;_>A;A++)a[A].pred=0;if(z=0,1==_)for(k=a[0],C=0;n>C;C++)w(k,L,R),R++;else for(C=0;n>C;C++){for(A=0;_>A;A++)for(k=a[A],F=k.h,X=k.v,I=0;X>I;I++)for(B=0;F>B;B++)b(k,L,R,I,B);if(R++,R===D)break}if(T=0,M=e[r]<<8|e[r+1],65280>M)throw"marker was not found";if(!(M>=65488&&65495>=M))break;r+=2}return r-S}function o(e,r){function t(e,t,a){var n,o,i,s,f,m,y,b,w,U,k=r.quantizationTable,A=a;for(U=0;64>U;U++)A[U]=e[U]*k[U];for(U=0;8>U;++U){var I=8*U;0!=A[1+I]||0!=A[2+I]||0!=A[3+I]||0!=A[4+I]||0!=A[5+I]||0!=A[6+I]||0!=A[7+I]?(n=v*A[0+I]+128>>8,o=v*A[4+I]+128>>8,i=A[2+I],s=A[6+I],f=g*(A[1+I]-A[7+I])+128>>8,b=g*(A[1+I]+A[7+I])+128>>8,m=A[3+I]<<4,y=A[5+I]<<4,w=n-o+1>>1,n=n+o+1>>1,o=w,w=i*p+s*u+128>>8,i=i*u-s*p+128>>8,s=w,w=f-y+1>>1,f=f+y+1>>1,y=w,w=b+m+1>>1,m=b-m+1>>1,b=w,w=n-s+1>>1,n=n+s+1>>1,s=w,w=o-i+1>>1,o=o+i+1>>1,i=w,w=f*h+b*d+2048>>12,f=f*d-b*h+2048>>12,b=w,w=m*l+y*c+2048>>12,m=m*c-y*l+2048>>12,y=w,A[0+I]=n+b,A[7+I]=n-b,A[1+I]=o+y,A[6+I]=o-y,A[2+I]=i+m,A[5+I]=i-m,A[3+I]=s+f,A[4+I]=s-f):(w=v*A[0+I]+512>>10,A[0+I]=w,A[1+I]=w,A[2+I]=w,A[3+I]=w,A[4+I]=w,A[5+I]=w,A[6+I]=w,A[7+I]=w)}for(U=0;8>U;++U){var B=U;0!=A[8+B]||0!=A[16+B]||0!=A[24+B]||0!=A[32+B]||0!=A[40+B]||0!=A[48+B]||0!=A[56+B]?(n=v*A[0+B]+2048>>12,o=v*A[32+B]+2048>>12,i=A[16+B],s=A[48+B],f=g*(A[8+B]-A[56+B])+2048>>12,b=g*(A[8+B]+A[56+B])+2048>>12,m=A[24+B],y=A[40+B],w=n-o+1>>1,n=n+o+1>>1,o=w,w=i*p+s*u+2048>>12,i=i*u-s*p+2048>>12,s=w,w=f-y+1>>1,f=f+y+1>>1,y=w,w=b+m+1>>1,m=b-m+1>>1,b=w,w=n-s+1>>1,n=n+s+1>>1,s=w,w=o-i+1>>1,o=o+i+1>>1,i=w,w=f*h+b*d+2048>>12,f=f*d-b*h+2048>>12,b=w,w=m*l+y*c+2048>>12,m=m*c-y*l+2048>>12,y=w,A[0+B]=n+b,A[56+B]=n-b,A[8+B]=o+y,A[48+B]=o-y,A[16+B]=i+m,A[40+B]=i-m,A[24+B]=s+f,A[32+B]=s-f):(w=v*a[U+0]+8192>>14,A[0+B]=w,A[8+B]=w,A[16+B]=w,A[24+B]=w,A[32+B]=w,A[40+B]=w,A[48+B]=w,A[56+B]=w)}for(U=0;64>U;++U){var C=128+(A[U]+8>>4);t[U]=0>C?0:C>255?255:C}}for(var a,n,o=[],i=r.blocksPerLine,s=r.blocksPerColumn,f=i<<3,m=new Int32Array(64),y=new Uint8Array(64),b=0;s>b;b++){var w=b<<3;for(a=0;8>a;a++)o.push(new Uint8Array(f));for(var U=0;i>U;U++){t(r.blocks[b][U],y,m);var k=0,A=U<<3;for(n=0;8>n;n++){var I=o[w+n];for(a=0;8>a;a++)I[A+a]=y[k++]}}}return o}function i(e){return 0>e?0:e>255?255:e}function s(e){function r(e){for(var r=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],t=0;64>t;t++){var a=I((r[t]*e+50)/100);1>a?a=1:a>255&&(a=255),B[O[t]]=a}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;64>o;o++){var i=I((n[o]*e+50)/100);1>i?i=1:i>255&&(i=255),C[O[o]]=i}for(var s=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,c=0;8>c;c++)for(var l=0;8>l;l++)L[f]=1/(B[O[f]]*s[c]*s[l]*8),x[f]=1/(C[O[f]]*s[c]*s[l]*8),f++}function t(e,r){for(var t=0,a=0,n=new Array,o=1;16>=o;o++){for(var i=1;i<=e[o];i++)n[r[a]]=[],n[r[a]][0]=t,n[r[a]][1]=o,a++,t++;t*=2}return n}function a(){b=t(H,N),w=t(j,$),U=t(q,Y),k=t(J,V)}function n(){for(var e=1,r=2,t=1;15>=t;t++){for(var a=e;r>a;a++)S[32767+a]=t,E[32767+a]=[],E[32767+a][1]=t,E[32767+a][0]=a;for(var n=-(r-1);-e>=n;n++)S[32767+n]=t,E[32767+n]=[],E[32767+n][1]=t,E[32767+n][0]=r-1+n;e<<=1,r<<=1}}function o(){for(var e=0;256>e;e++)X[e]=19595*e,X[e+256>>0]=38470*e,X[e+512>>0]=7471*e+32768,X[e+768>>0]=-11059*e,X[e+1024>>0]=-21709*e,X[e+1280>>0]=32768*e+8421375,X[e+1536>>0]=-27439*e,X[e+1792>>0]=-5329*e}function i(e){for(var r=e[0],t=e[1]-1;t>=0;)r&1<<t&&(G|=1<<_),t--,_--,0>_&&(255==G?(s(255),s(0)):s(G),_=7,G=0)}function s(e){z.push(e)}function f(e){s(e>>8&255),s(255&e)}function c(e,r){var t,a,n,o,i,s,f,c,l,d=0;const h=8,u=64;for(l=0;h>l;++l){t=e[d],a=e[d+1],n=e[d+2],o=e[d+3],i=e[d+4],s=e[d+5],f=e[d+6],c=e[d+7];var p=t+c,v=t-c,g=a+f,m=a-f,y=n+s,b=n-s,w=o+i,U=o-i,k=p+w,A=p-w,I=g+y,B=g-y;e[d]=k+I,e[d+4]=k-I;var C=.707106781*(B+A);e[d+2]=A+C,e[d+6]=A-C,k=U+b,I=b+m,B=m+v;var L=.382683433*(k-B),x=.5411961*k+L,E=1.306562965*B+L,S=.707106781*I,T=v+S,z=v-S;e[d+5]=z+x,e[d+3]=z-x,e[d+1]=T+E,e[d+7]=T-E,d+=8}for(d=0,l=0;h>l;++l){t=e[d],a=e[d+8],n=e[d+16],o=e[d+24],i=e[d+32],s=e[d+40],f=e[d+48],c=e[d+56];var G=t+c,_=t-c,M=a+f,D=a-f,R=n+s,F=n-s,X=o+i,O=o-i,H=G+X,N=G-X,q=M+R,Y=M-R;e[d]=H+q,e[d+32]=H-q;var j=.707106781*(Y+N);e[d+16]=N+j,e[d+48]=N-j,H=O+F,q=F+D,Y=D+_;var $=.382683433*(H-Y),J=.5411961*H+$,V=1.306562965*Y+$,W=.707106781*q,K=_+W,Q=_-W;e[d+40]=Q+J,e[d+24]=Q-J,e[d+8]=K+V,e[d+56]=K-V,d++}var Z;for(l=0;u>l;++l)Z=e[l]*r[l],P[l]=Z>0?Z+.5|0:Z-.5|0;return P}function l(){f(65504),f(16),s(74),s(70),s(73),s(70),s(0),s(1),s(1),s(0),f(1),f(1),s(0),s(0)}function d(e,r){f(65472),f(17),s(8),f(r),f(e),s(3),s(1),s(17),s(0),s(2),s(17),s(1),s(3),s(17),s(1)}function h(){f(65499),f(132),s(0);for(var e=0;64>e;e++)s(B[e]);s(1);for(var r=0;64>r;r++)s(C[r])}function u(){f(65476),f(418),s(0);for(var e=0;16>e;e++)s(H[e+1]);for(var r=0;11>=r;r++)s(N[r]);s(16);for(var t=0;16>t;t++)s(q[t+1]);for(var a=0;161>=a;a++)s(Y[a]);s(1);for(var n=0;16>n;n++)s(j[n+1]);for(var o=0;11>=o;o++)s($[o]);s(17);for(var i=0;16>i;i++)s(J[i+1]);for(var c=0;161>=c;c++)s(V[c])}function p(){f(65498),f(12),s(3),s(1),s(0),s(2),s(17),s(3),s(17),s(0),s(63),s(0)}function v(e,r,t,a,n){var o,s=n[0],f=n[240];const l=16,d=63,h=64;for(var u=c(e,r),p=0;h>p;++p)T[O[p]]=u[p];var v=T[0]-t;t=T[0],0==v?i(a[0]):(o=32767+v,i(a[S[o]]),i(E[o]));for(var g=63;g>0&&0==T[g];g--);if(0==g)return i(s),t;for(var m,y=1;g>=y;){for(var b=y;0==T[y]&&g>=y;++y);var w=y-b;if(w>=l){m=w>>4;for(var U=1;m>=U;++U)i(f);w=15&w}o=32767+T[y],i(n[(w<<4)+S[o]]),i(E[o]),y++}return g!=d&&i(s),t}function g(){for(var e=String.fromCharCode,r=0;256>r;r++)F[r]=e(r)}function m(e){if(0>=e&&(e=1),e>100&&(e=100),A!==e){var t=0;t=50>e?Math.floor(5e3/e):Math.floor(200-2*e),r(t),A=e}}function y(){e||(e=50),g(),a(),n(),o(),m(e)}var b,w,U,k,A,I=(Math.round,Math.floor),B=new Array(64),C=new Array(64),L=new Array(64),x=new Array(64),E=new Array(65535),S=new Array(65535),P=new Array(64),T=new Array(64),z=[],G=0,_=7,M=new Array(64),D=new Array(64),R=new Array(64),F=new Array(256),X=new Array(2048),O=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],H=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],N=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Y=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],j=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],$=[0,1,2,3,4,5,6,7,8,9,10,11],J=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],V=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,r){r&&m(r),z=new Array,G=0,_=7,f(65496),l(),h(),d(e.width,e.height),u(),p();var t=0,a=0,n=0;G=0,_=7,this.encode.displayName="_encode_";for(var o,s,c,g,y,A,I,B,C,E=e.data,S=e.width,P=e.height,T=4*S,F=0;P>F;){for(o=0;T>o;){for(y=T*F+o,A=y,I=-1,B=0,C=0;64>C;C++)B=C>>3,I=4*(7&C),A=y+B*T+I,F+B>=P&&(A-=T*(F+1+B-P)),o+I>=T&&(A-=o+I-T+4),s=E[A++],c=E[A++],g=E[A++],M[C]=(X[s]+X[c+256>>0]+X[g+512>>0]>>16)-128,D[C]=(X[s+768>>0]+X[c+1024>>0]+X[g+1280>>0]>>16)-128,R[C]=(X[s+1280>>0]+X[c+1536>>0]+X[g+1792>>0]>>16)-128;t=v(M,L,t,b,U),a=v(D,x,a,w,k),n=v(R,x,n,w,k),o+=32}F+=8}if(_>=0){var O=[];O[1]=_+1,O[0]=(1<<_+1)-1,i(O)}return f(65497),new Uint8Array(z)},y()}var f=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),c=4017,l=799,d=3406,h=2276,u=1567,p=3784,v=5793,g=2896;t.prototype={constructor:t,parse:function(e){function r(){var r=e[l]<<8|e[l+1];return l+=2,r}function t(){var t=r(),a=e.subarray(l,l+t-2);return l+=a.length,a}function i(e){var r,t,a=0,n=0;for(t in e.components)e.components.hasOwnProperty(t)&&(r=e.components[t],a<r.h&&(a=r.h),n<r.v&&(n=r.v));var o=Math.ceil(e.samplesPerLine/8/a),i=Math.ceil(e.scanLines/8/n);for(t in e.components)if(e.components.hasOwnProperty(t)){r=e.components[t];for(var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*r.h/a),f=Math.ceil(Math.ceil(e.scanLines/8)*r.v/n),c=o*r.h,l=i*r.v,d=[],h=0;l>h;h++){for(var u=[],p=0;c>p;p++)u.push(new Int32Array(64));d.push(u)}r.blocksPerLine=s,r.blocksPerColumn=f,r.blocks=d}e.maxH=a,e.maxV=n,e.mcusPerLine=o,e.mcusPerColumn=i}var s,c,l=0,d=(e.length,null),h=null,u=[],p=[],v=[],g=[],m=r();if(65496!=m)throw"SOI not found";for(m=r();65497!=m;){var y,b;switch(m){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=t();65504===m&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(d={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])}),65518===m&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&0===w[5]&&(h={version:w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var U=r(),k=U+l-2;k>l;){var A=e[l++],I=new Int32Array(64);if(A>>4===0)for(b=0;64>b;b++){var B=f[b];I[B]=e[l++]}else{if(A>>4!==1)throw"DQT: invalid table spec";for(b=0;64>b;b++){var B=f[b];I[B]=r()}}u[15&A]=I}break;case 65472:case 65473:case 65474:r(),s={},s.extended=65473===m,s.progressive=65474===m,s.precision=e[l++],s.scanLines=r(),s.samplesPerLine=r(),s.components={},s.componentsOrder=[];var C,L=e[l++];for(y=0;L>y;y++){C=e[l];var x=e[l+1]>>4,E=15&e[l+1],S=e[l+2];s.componentsOrder.push(C),s.components[C]={h:x,v:E,quantizationIdx:S},l+=3}i(s),p.push(s);break;case 65476:var P=r();for(y=2;P>y;){var T=e[l++],z=new Uint8Array(16),G=0;for(b=0;16>b;b++,l++)G+=z[b]=e[l];var _=new Uint8Array(G);for(b=0;G>b;b++,l++)_[b]=e[l];y+=17+G,(T>>4===0?g:v)[15&T]=a(z,_)}break;case 65501:r(),c=r();break;case 65498:var M,D=(r(),e[l++]),R=[];for(y=0;D>y;y++){M=s.components[e[l++]];var F=e[l++];M.huffmanTableDC=g[F>>4],M.huffmanTableAC=v[15&F],R.push(M)}var X=e[l++],O=e[l++],H=e[l++],N=n(e,l,s,R,c,X,O,H>>4,15&H);l+=N;break;default:if(255==e[l-3]&&e[l-2]>=192&&e[l-2]<=254){l-=3;break}throw"unknown JPEG marker "+m.toString(16)}m=r()}if(1!=p.length)throw"only single frame JPEGs supported";for(var y=0;y<p.length;y++){var q=p[y].components;for(var b in q)q[b].quantizationTable=u[q[b].quantizationIdx],delete q[b].quantizationIdx}this.width=s.samplesPerLine,this.height=s.scanLines,this.jfif=d,this.adobe=h,this.components=[];for(var y=0;y<s.componentsOrder.length;y++){var M=s.components[s.componentsOrder[y]];this.components.push({lines:o(s,M),scaleX:M.h/s.maxH,scaleY:M.v/s.maxV})}},getData:function(e,r){var t,a,n,o,s,f,c,l,d,h,u,p,v,g,m,y,b,w,U,k,A,I=this.width/e,B=this.height/r,C=0,L=e*r*this.components.length,x=new Uint8Array(L);switch(this.components.length){case 1:for(t=this.components[0],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],d=0;e>d;d++)u=s[0|d*t.scaleX*I],x[C++]=u;break;case 2:for(t=this.components[0],a=this.components[1],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],d=0;e>d;d++)u=s[0|d*t.scaleX*I],x[C++]=u,u=f[0|d*a.scaleX*I],x[C++]=u;break;case 3:for(A=!0,this.adobe&&this.adobe.transformCode?A=!0:"undefined"!=typeof this.colorTransform&&(A=!!this.colorTransform),t=this.components[0],a=this.components[1],n=this.components[2],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],c=n.lines[0|h*n.scaleY*B],d=0;e>d;d++)A?(u=s[0|d*t.scaleX*I],p=f[0|d*a.scaleX*I],v=c[0|d*n.scaleX*I],w=i(u+1.402*(v-128)),U=i(u-.3441363*(p-128)-.71413636*(v-128)),k=i(u+1.772*(p-128))):(w=s[0|d*t.scaleX*I],U=f[0|d*a.scaleX*I],k=c[0|d*n.scaleX*I]),x[C++]=w,x[C++]=U,x[C++]=k;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";for(A=!1,this.adobe&&this.adobe.transformCode?A=!0:"undefined"!=typeof this.colorTransform&&(A=!!this.colorTransform),t=this.components[0],a=this.components[1],n=this.components[2],o=this.components[3],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],c=n.lines[0|h*n.scaleY*B],l=o.lines[0|h*o.scaleY*B],d=0;e>d;d++)A?(u=s[0|d*t.scaleX*I],p=f[0|d*a.scaleX*I],v=c[0|d*n.scaleX*I],g=l[0|d*o.scaleX*I],m=255-i(u+1.402*(v-128)),y=255-i(u-.3441363*(p-128)-.71413636*(v-128)),b=255-i(u+1.772*(p-128))):(m=s[0|d*t.scaleX*I],y=f[0|d*a.scaleX*I],b=c[0|d*n.scaleX*I],g=l[0|d*o.scaleX*I]),x[C++]=m,x[C++]=y,x[C++]=b,x[C++]=g;break;default:throw"Unsupported color mode"}return x},copyToImageData:function(e){var r,t,a,n,o,s,f,c,l,d=e.width,h=e.height,u=e.data,p=this.getData(d,h),v=0,g=0;switch(this.components.length){case 1:for(t=0;h>t;t++)for(r=0;d>r;r++)a=p[v++],u[g++]=a,u[g++]=a,u[g++]=a,u[g++]=255;break;case 3:for(t=0;h>t;t++)for(r=0;d>r;r++)f=p[v++],c=p[v++],l=p[v++],u[g++]=f,u[g++]=c,u[g++]=l,u[g++]=255;break;case 4:for(t=0;h>t;t++)for(r=0;d>r;r++)o=p[v++],s=p[v++],a=p[v++],n=p[v++],f=255-i(o*(1-n/255)+n),c=255-i(s*(1-n/255)+n),l=255-i(a*(1-n/255)+n),u[g++]=f,u[g++]=c,u[g++]=l,u[g++]=255;break;default:throw"Unsupported color mode"}}};e.Codec.JPEG=e.Codec.JPG={encoder:function(e,r){r=r||{};var t="undefined"==typeof r.quality?100:r.quality,a=new s(t),n=a.encode(e);return n},decoder:function(e,r){var a=new t;a.parse(new Uint8Array(e));var n={width:a.width,height:a.height,data:new Uint8Array(a.width*a.height*4)};return a.copyToImageData(n),n}}}(e),!function(e,r){"use strict";function t(e){var r=this;if(r.pos=0,r.buffer=e,r.flag=[String.fromCharCode(r.buffer[r.pos++]),String.fromCharCode(r.buffer[r.pos++])].join(""),"BM"!==r.flag)throw new Error("Invalid BMP File");r.parseHeader(),r.parseBGR()}function a(e){var r=this;r.data=e.data,r.width=e.width,r.height=e.height,r.extraBytes=r.width%4,r.rgbSize=r.height*(3*r.width+r.extraBytes),r.headerInfoSize=40,r.flag="BM",r.reserved=0,r.offset=54,r.fileSize=r.rgbSize+r.offset,r.planes=1,r.bitPP=24,r.compress=0,r.hr=0,r.vr=0,r.colors=0,r.importantColors=0}t.prototype={constructor:t,pos:0,buffer:null,flag:null,fileSize:null,reserved:null,offset:null,headerSize:null,width:0,height:0,planes:null,bitPP:null,compress:null,rawSize:null,hr:null,vr:null,colors:null,importantColors:null,palette:null,data:null,readUInt8:function(e){return this.buffer[e++]},readUInt16LE:function(e){var r,t,a=this;return r=a.buffer[e++],t=a.buffer[e++],r|t<<8},readUInt32LE:function(e){var r,t,a,n,o=this;return r=o.buffer[e++],t=o.buffer[e++],a=o.buffer[e++],n=o.buffer[e++],r|t<<8|a<<16|n<<24},parseHeader:function(){var e=this;if(e.fileSize=e.readUInt32LE(e.pos),e.pos+=4,e.reserved=e.readUInt32LE(e.pos),e.pos+=4,e.offset=e.readUInt32LE(e.pos),e.pos+=4,e.headerSize=e.readUInt32LE(e.pos),e.pos+=4,e.width=e.readUInt32LE(e.pos),e.pos+=4,e.height=e.readUInt32LE(e.pos),e.pos+=4,e.planes=e.readUInt16LE(e.pos),e.pos+=2,e.bitPP=e.readUInt16LE(e.pos),e.pos+=2,e.compress=e.readUInt32LE(e.pos),e.pos+=4,e.rawSize=e.readUInt32LE(e.pos),
e.pos+=4,e.hr=e.readUInt32LE(e.pos),e.pos+=4,e.vr=e.readUInt32LE(e.pos),e.pos+=4,e.colors=e.readUInt32LE(e.pos),e.pos+=4,e.importantColors=e.readUInt32LE(e.pos),e.pos+=4,e.bitPP<24){var r=0===e.colors?1<<e.bitPP:e.colors;e.palette=new Array(r);for(var t=0;r>t;t++){var a=e.readUInt8(e.pos++),n=e.readUInt8(e.pos++),o=e.readUInt8(e.pos++),i=e.readUInt8(e.pos++);e.palette[t]={red:o,green:n,blue:a,quad:i}}}},parseBGR:function(){var e=this;e.pos=e.offset;var r="bit"+e.bitPP,t=e.width*e.height*4;try{e.data=new Uint8Array(t),e[r]()}catch(a){console.log("bit decode error:"+a)}},bit1:function(){var e,r,t,a,n,o,i=this,s=i.palette,f=i.width,c=i.height,l=Math.ceil(f/8),d=l%4;for(e=c-1;e>=0;e--){for(r=0;l>r;r++)for(t=i.readUInt8(i.pos++),a=e*f*4+8*r*4,n=0;8>n&&f>8*r+n;n++)o=s[t>>7-n&1],i.data[a+4*n]=o.blue,i.data[a+4*n+1]=o.green,i.data[a+4*n+2]=o.red,i.data[a+4*n+3]=255;0!=d&&(i.pos+=4-d)}},bit4:function(){var e,r,t,a,n,o,i,s=this,f=s.palette,c=s.width,l=s.height,d=Math.ceil(c/2),h=d%4;for(e=l-1;e>=0;e--){for(r=0;d>r&&(t=s.readUInt8(s.pos++),a=e*c*4+2*r*4,n=t>>4,o=15&t,i=f[n],s.data[a]=i.blue,s.data[a+1]=i.green,s.data[a+2]=i.red,s.data[a+3]=255,!(2*r+1>=c));r++)i=f[o],s.data[a+4]=i.blue,s.data[a+4+1]=i.green,s.data[a+4+2]=i.red,s.data[a+4+3]=255;0!=h&&(s.pos+=4-h)}},bit8:function(){var e,r,t,a,n,o=this,i=o.palette,s=o.width,f=o.height,c=s%4;for(e=f-1;e>=0;e--){for(r=0;s>r;r++)t=o.readUInt8(o.pos++),a=e*s*4+4*r,t<i.length?(n=i[t],o.data[a]=n.blue,o.data[a+1]=n.green,o.data[a+2]=n.red,o.data[a+3]=255):(o.data[a]=255,o.data[a+1]=255,o.data[a+2]=255,o.data[a+3]=255);0!=c&&(o.pos+=4-c)}},bit24:function(){var e,r,t,a,n,o,i=this,s=(i.palette,i.width),f=i.height,c=s%4;for(e=f-1;e>=0;e--){for(r=0;s>r;r++)a=i.readUInt8(i.pos++),n=i.readUInt8(i.pos++),o=i.readUInt8(i.pos++),t=e*s*4+4*r,i.data[t]=o,i.data[t+1]=n,i.data[t+2]=a,i.data[t+3]=255;i.pos+=c}},getData:function(){return this.data}},a.prototype={constructor:a,flag:null,fileSize:null,reserved:null,offset:null,headerSize:null,width:0,height:0,planes:null,bitPP:null,compress:null,rawSize:null,hr:null,vr:null,colors:null,importantColors:null,palette:null,extraBytes:null,rgbSize:null,headerInfoSize:null,data:null,write:function(e,r){for(var t=0;t<r.length;t++)e.push(r.charCodeAt(t))},writeUInt8:function(e,r){e.push(255&r)},writeUInt16LE:function(e,r){e.push(255&r,r>>>8&255)},writeUInt32LE:function(e,r){e.push(255&r,r>>>8&255,r>>>16&255,r>>>24&255)},fill:function(e,r,t,a){for(var n=t;a>n;n++)e[n]=r},encode:function(){var e=this,r=e.width,t=e.height,a=[],n=new Array(e.offset+e.rgbSize);e.write(a,e.flag),e.writeUInt32LE(a,e.fileSize),e.writeUInt32LE(a,e.reserved),e.writeUInt32LE(a,e.offset),e.writeUInt32LE(a,e.headerInfoSize),e.writeUInt32LE(a,r),e.writeUInt32LE(a,t),e.writeUInt16LE(a,e.planes),e.writeUInt16LE(a,e.bitPP),e.writeUInt32LE(a,e.compress),e.writeUInt32LE(a,e.rgbSize),e.writeUInt32LE(a,e.hr),e.writeUInt32LE(a,e.vr),e.writeUInt32LE(a,e.colors),e.writeUInt32LE(a,e.importantColors);var o,i,s,f,c,l,d,h=0,u=3*r+e.extraBytes;for(o=t-1;o>=0;o--){for(i=0;r>i;i++)s=o*u+3*i,f=e.data[h++],c=e.data[h++],l=e.data[h++],h++,n[s+2]=f,n[s+1]=c,n[s]=l;e.extraBytes>0&&(d=o*u+3*r,e.fill(n,0,d,d+e.extraBytes))}return new Uint8Array(a.concat(n))}},e.Codec.BMP={encoder:function(e,r){"undefined"==typeof r.quality?100:r.quality;return new a(e).encode()},decoder:function(e,r){var a=new t(new Uint8Array(e));return{data:a.data,width:a.width,height:a.height}}}}(e),!function(e,r){"use strict";function t(e){return e.reduce(function(e,r){return 2*e+r},0)}function a(e){for(var r=[],t=7;t>=0;t--)r.push(!!(e&1<<t));return r}function n(e,r){for(var t,a,n=0,o=function(e){for(var t=0,a=0;e>a;a++)r.charCodeAt(n>>3)&1<<(7&n)&&(t|=1<<a),n++;return t},i=[],s=1<<e,f=s+1,c=e+1,l=[],d=function(){l=[],c=e+1;for(var r=0;s>r;r++)l[r]=[r];l[s]=[],l[f]=null};;)if(a=t,t=o(c),t!==s){if(t===f)break;if(t<l.length)a!==s&&l.push(l[a].concat(l[t][0]));else{if(t!==l.length)throw new Error("Invalid LZW code.");l.push(l[a].concat(l[a][0]))}i.push.apply(i,l[t]),l.length===1<<c&&12>c&&c++}else d();return i}function o(e){var r=this;r.data=e,r.len=r.data.length,r.pos=0,r.readByte=function(){var r=this;if(r.pos>=r.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[r.pos++]:255&e.charCodeAt(r.pos++)},r.readBytes=function(e){for(var r=this,t=[],a=0;e>a;a++)t.push(r.readByte());return t},r.read=function(e){for(var r=this,t="",a=0;e>a;a++)t+=String.fromCharCode(r.readByte());return t},r.readUnsigned=function(){var e=this,r=e.readBytes(2);return(r[1]<<8)+r[0]}}function i(e,r){r||(r={});var o=function(r){for(var t=[],a=0;r>a;a++)t.push(e.readBytes(3));return t},i=function(){var r,t;t="";do r=e.readByte(),t+=e.read(r);while(0!==r);return t},s=function(){var n={};if(n.sig=e.read(3),n.ver=e.read(3),"GIF"!==n.sig)throw new Error("Not a GIF file.");n.width=e.readUnsigned(),n.height=e.readUnsigned();var i=a(e.readByte());n.gctFlag=i.shift(),n.colorRes=t(i.splice(0,3)),n.sorted=i.shift(),n.gctSize=t(i.splice(0,3)),n.bgColor=e.readByte(),n.pixelAspectRatio=e.readByte(),n.gctFlag&&(n.gct=o(1<<n.gctSize+1)),r.hdr&&r.hdr(n)},f=function(n){var o=function(n){var o=(e.readByte(),a(e.readByte()));n.reserved=o.splice(0,3),n.disposalMethod=t(o.splice(0,3)),n.userInput=o.shift(),n.transparencyGiven=o.shift(),n.delayTime=e.readUnsigned(),n.transparencyIndex=e.readByte(),n.terminator=e.readByte(),r.gce&&r.gce(n)},s=function(e){e.comment=i(),r.com&&r.com(e)},f=function(t){e.readByte();t.ptHeader=e.readBytes(12),t.ptData=i(),r.pte&&r.pte(t)},c=function(t){var a=function(t){e.readByte();t.unknown=e.readByte(),t.iterations=e.readUnsigned(),t.terminator=e.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(t)},n=function(e){e.appData=i(),r.app&&r.app[e.identifier]&&r.app[e.identifier](e)};e.readByte();switch(t.identifier=e.read(8),t.authCode=e.read(3),t.identifier){case"NETSCAPE":a(t);break;default:n(t)}},l=function(e){e.data=i(),r.unknown&&r.unknown(e)};switch(n.label=e.readByte(),n.label){case 249:n.extType="gce",o(n);break;case 254:n.extType="com",s(n);break;case 1:n.extType="pte",f(n);break;case 255:n.extType="app",c(n);break;default:n.extType="unknown",l(n)}},c=function(s){var f=function(e,r){for(var t=new Array(e.length),a=e.length/r,n=function(a,n){var o=e.slice(n*r,(n+1)*r);t.splice.apply(t,[a*r,r].concat(o))},o=[0,4,2,1],i=[8,8,4,2],s=0,f=0;4>f;f++)for(var c=o[f];a>c;c+=i[f])n(c,s),s++;return t};s.leftPos=e.readUnsigned(),s.topPos=e.readUnsigned(),s.width=e.readUnsigned(),s.height=e.readUnsigned();var c=a(e.readByte());s.lctFlag=c.shift(),s.interlaced=c.shift(),s.sorted=c.shift(),s.reserved=c.splice(0,2),s.lctSize=t(c.splice(0,3)),s.lctFlag&&(s.lct=o(1<<s.lctSize+1)),s.lzwMinCodeSize=e.readByte();var l=i();s.pixels=n(s.lzwMinCodeSize,l),s.interlaced&&(s.pixels=f(s.pixels,s.width)),r.img&&r.img(s)},l=function(){var t={};switch(t.sentinel=e.readByte(),String.fromCharCode(t.sentinel)){case"!":t.type="ext",f(t);break;case",":t.type="img",c(t);break;case";":t.type="eof",r.eof&&r.eof(t);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&l()},d=function(){s(),l()};d()}e.Codec.GIF={encoder:e.NotImplemented("GIF.encoder"),decoder:function(r,t){var a,n=null,s={width:0,height:0,data:null};return i(new o(new Uint8Array(r)),{hdr:function(e){a=e},gce:function(e){n=e.transparencyGiven?e.transparencyIndex:null},img:function(r){var t=r.lctFlag?r.lct:a.gct,o=new e.ImArray(r.width*r.height*4);r.pixels.forEach(function(e,r){e!==n&&(o[(r<<2)+0]=t[e][0],o[(r<<2)+1]=t[e][1],o[(r<<2)+2]=t[e][2],o[(r<<2)+3]=255)}),s.width=r.width,s.height=r.height,s.data=o}}),s}}}(e),!function(e,r){"use strict";function t(e){switch(e.image_type){case u:case g:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&d("TGA.tgaCheckHeader: Invalid type colormap data for indexed type");break;case p:case v:case m:case y:e.colormap_type&&d("TGA.tgaCheckHeader: Invalid type colormap data for colormap type");break;case h:d("TGA.tgaCheckHeader: No data");default:d('TGA.tgaCheckHeader: Invalid type " '+e.image_type+'"')}(e.width<=0||e.height<=0)&&d("TGA.tgaCheckHeader: Invalid image size"),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&d('TGA.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'"')}function a(e,r,t,a,n){var o,i,s,f;if(i=t.pixel_size>>3,s=t.width*t.height*i,r&&(f=n.subarray(a,a+=t.colormap_length*(t.colormap_size>>3))),e){o=new Uint8Array(s);for(var c,l,d,h=0,u=new Uint8Array(i);s>h;)if(c=n[a++],l=(127&c)+1,128&c){for(d=0;i>d;++d)u[d]=n[a++];for(d=0;l>d;++d)o.set(u,h+d*i);h+=i*l}else{for(l*=i,d=0;l>d;++d)o[h+d]=n[a++];h+=l}}else o=n.subarray(a,a+=r?t.width*t.height:s);return{pixel_data:o,palettes:f}}function n(e,r,t,a,n,o,i,s,f,c){var l,d,h,u=c,p=0,v=e.width;for(h=t;h!==n;h+=a)for(d=o;d!==s;d+=i,p++)l=f[p],r[4*(d+v*h)+3]=255,r[4*(d+v*h)+2]=u[3*l+0],r[4*(d+v*h)+1]=u[3*l+1],r[4*(d+v*h)+0]=u[3*l+2];return r}function o(e,r,t,a,n,o,i,s,f){var c,l,d,h=0,u=e.width;for(d=t;d!==n;d+=a)for(l=o;l!==s;l+=i,h+=2)c=f[h+0]+(f[h+1]<<8),r[4*(l+u*d)+0]=(31744&c)>>7,r[4*(l+u*d)+1]=(992&c)>>2,r[4*(l+u*d)+2]=(31&c)>>3,r[4*(l+u*d)+3]=32768&c?0:255;return r}function i(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=3)r[4*(c+h*l)+3]=255,r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+1]=f[d+1],r[4*(c+h*l)+0]=f[d+2];return r}function s(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=4)r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+1]=f[d+1],r[4*(c+h*l)+0]=f[d+2],r[4*(c+h*l)+3]=f[d+3];return r}function f(e,r,t,a,n,o,i,s,f){var c,l,d,h=0,u=e.width;for(d=t;d!==n;d+=a)for(l=o;l!==s;l+=i,h++)c=f[h],r[4*(l+u*d)+0]=c,r[4*(l+u*d)+1]=c,r[4*(l+u*d)+2]=c,r[4*(l+u*d)+3]=255;return r}function c(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=2)r[4*(c+h*l)+0]=f[d+0],r[4*(c+h*l)+1]=f[d+0],r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+3]=f[d+1];return r}function l(e,r,t,a,l,h){var u,p,v,g,m,y,B=new Uint8Array(r*t*4);switch((e.flags&b)>>w){default:case A:u=0,v=1,m=r,p=0,g=1,y=t;break;case U:u=0,v=1,m=r,p=t-1,g=-1,y=-1;break;case I:u=r-1,v=-1,m=-1,p=0,g=1,y=t;break;case k:u=r-1,v=-1,m=-1,p=t-1,g=-1,y=-1}if(h)switch(e.pixel_size){case 8:f(e,B,p,g,y,u,v,m,a);break;case 16:c(e,B,p,g,y,u,v,m,a);break;default:d("TGA.getTgaRGBA: not support this format")}else switch(e.pixel_size){case 8:n(e,B,p,g,y,u,v,m,a,l);break;case 16:o(e,B,p,g,y,u,v,m,a);break;case 24:i(e,B,p,g,y,u,v,m,a);break;case 32:s(e,B,p,g,y,u,v,m,a);break;default:d("TGA.getTgaRGBA: not support this format")}return B}var d=function(r){e.error(r,!0)},h=0,u=1,p=2,v=3,g=9,m=10,y=11,b=48,w=4,U=0,k=1,A=2,I=3;e.Codec.TGA={encoder:e.NotImplemented("TGA.encoder"),decoder:function(e,r){e.length<19&&d("TGA: Not enough data to contain header.");var n=new Uint8Array(e),o=0,i={id_length:n[o++],colormap_type:n[o++],image_type:n[o++],colormap_index:n[o++]|n[o++]<<8,colormap_length:n[o++]|n[o++]<<8,colormap_size:n[o++],origin:[n[o++]|n[o++]<<8,n[o++]|n[o++]<<8],width:n[o++]|n[o++]<<8,height:n[o++]|n[o++]<<8,pixel_size:n[o++],flags:n[o++]};t(i),i.id_length+o>e.length&&d("TGA: No data"),o+=i.id_length;var s=!1,f=!1,c=!1;switch(i.image_type){case g:s=!0,f=!0;break;case u:f=!0;break;case m:s=!0;break;case p:break;case y:s=!0,c=!0;break;case v:c=!0}var h=a(s,f,i,o,n),b=l(i,i.width,i.height,h.pixel_data,h.palettes,c);return{width:i.width,height:i.height,data:b}}}}(e),!function(e,r){"use strict";var t=function(r){e.error(r,!0)},a="hasOwnproperty",n=Array.prototype.push,o=Array.prototype.slice,i=-1,s=1,f=2,c=3,l=4,d=function(e,r){switch(e){case s:t("RGBE Read Error: "+(r||""));break;case f:t("RGBE Write Error: "+(r||""));break;case c:t("RGBE Bad File Format: "+(r||""));break;case l:default:t("RGBE: Error: "+(r||""))}return i},h=4,u=1,p=2,v=4,g="\n",m=function(e,r,t){r=r?r:1024;for(var a=e.pos,n=-1,o=0,i="",s=128,f=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+s)));0>(n=f.indexOf(g))&&r>o&&a<e.byteLength;)i+=f,o+=f.length,a+=s,f+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+s)));return n>-1?(!1!==t&&(e.pos+=o+n+1),i+f.slice(0,n)):!1},y=function(e,r){var t,a,i=r.length;for(b=new Uint16Array(i),t=0;i>t;t++)a=r.charCodeAt(t),b[t]=a;n.apply(e,o.call(new Uint8Array(b)))},w=function(e,r){n.apply(e,o.call(r))},U=/^#\?(\S+)$/,k=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,A=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,I=/^\s*FORMAT=(\S+)\s*$/,B=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,C=function(e){var r,t,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(r=m(e)))return d(s,"no header found");if(!(t=r.match(U)))return d(c,"bad initial token");for(a.valid|=u,a.programtype=t[1],a.string+=r+"\n";;){if(r=m(e),!1===r)break;if(a.string+=r+"\n","#"!==r.charAt(0)){if((t=r.match(k))&&(a.gamma=parseFloat(t[1],10)),(t=r.match(A))&&(a.exposure=parseFloat(t[1],10)),(t=r.match(I))&&(a.valid|=p,a.format=t[1]),(t=r.match(B))&&(a.valid|=v,a.height=parseInt(t[1],10),a.width=parseInt(t[2],10)),a.valid&p&&a.valid&v)break}else a.comments+=r+"\n"}return a.valid&p?a.valid&v?a:d(c,"missing image size specifier"):d(c,"missing format specifier")},L=function(e,r,t,n){var o="RGBE";n=n||{},n[a]("programtype")&&(o=n.programtype),y(e,"#?"+o+"\n"),n[a]("gamma")&&y(e,"GAMMA="+n.gamma+"\n"),n[a]("exposure")&&y(e,"EXPOSURE="+n.exposure+"\n"),y(e,"FORMAT=32-bit_rle_rgbe\n\n"),y(e,"-Y "+~~t+" +X "+~~r+"\n")},x=function(e,r,t){var a,n,o,i,f,h,u,p,v,g,m,y,b,w=r,U=t;if(8>w||w>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(w!==(e[2]<<8|e[3]))return d(c,"wrong scanline width");if(a=new Uint8Array(4*r*t),!a||!a.length)return d(l,"unable to allocate buffer space");for(n=0,o=0,p=4*w,b=new Uint8Array(4),h=new Uint8Array(p);U>0&&o<e.byteLength;){if(o+4>e.byteLength)return d(s);if(b[0]=e[o++],b[1]=e[o++],b[2]=e[o++],b[3]=e[o++],2!=b[0]||2!=b[1]||(b[2]<<8|b[3])!=w)return d(c,"bad rgbe scanline format");for(u=0;p>u&&o<e.byteLength;){if(i=e[o++],y=i>128,y&&(i-=128),0===i||u+i>p)return d(c,"bad scanline data");if(y)for(f=e[o++],v=0;i>v;v++)h[u++]=f;else h.set(e.subarray(o,o+i),u),u+=i,o+=i}for(g=w,v=0;g>v;v++)m=0,a[n]=h[v+m],m+=w,a[n+1]=h[v+m],m+=w,a[n+2]=h[v+m],m+=w,a[n+3]=h[v+m],n+=4;U--}return a},E=function(e,r,t){var a,n,o,i,s,f=4,c=new Uint8Array(2);for(a=0;t>a;){for(n=a,o=i=0;f>o&&t>n;)for(n+=o,i=o,o=1;t>n+o&&127>o&&r[n]==r[n+o];)o++;for(i>1&&i==n-a&&(c[0]=128+i,c[1]=r[a],w(e,c),a=n);n>a;)s=n-a,s>128&&(s=128),c[0]=s,w(e,c),w(e,r.subarray(a,s)),a+=s;o>=f&&(c[0]=128+o,c[1]=r[n],w(e,c),a+=o)}},S=function(e,r,t,a){var n,o,i,s=new Uint8Array(4);if(8>t||t>32767)return void w(e,r);for(n=new Uint8Array(4*t),i=0;a-- >0;){for(s[0]=2,s[1]=2,s[2]=t>>8,s[3]=255&t,w(e,s),o=0;t>o;o++)s[0]=r[datapos+0],s[1]=r[datapos+1],s[2]=r[datapos+2],s[3]=r[datapos+3],n[o]=s[0],n[o+t]=s[1],n[o+2*t]=s[2],n[o+3*t]=s[3],i+=h;for(o=0;4>o;o++)E(e,n[o*t],t)}};e.Codec.HDR=e.Codec.RGBE={encoder:function(e,r){r=r||{};var t=[];return L(t,e.width,e.height,r),S(t,e.data,r.scanline_width||0,r.num_scanlines||0),new Uint8Array(t)},decoder:function(e,r){var t=new Uint8Array(e);t.byteLength;t.pos=0;var a=C(t);if(i!==a){var n=a.width,o=a.height,s=x(t.subarray(t.pos),n,o);if(i!==s)return r&&(r.header=a.string,r.gamma=a.gamma,r.exposure=a.exposure),{width:n,height:o,data:s}}return null}}}(e),e});
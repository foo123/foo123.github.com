/**
*
*   FILTER.js
*   @version: 0.7.2
*   @built on 2015-08-04 23:41:00
*   @dependencies: Classy.js, Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n,r){"use strict";function a(e,t,n,r,a){var i;return e?{file:__filename,path:__dirname}:t?{file:i=self.location.href,path:i.split("/").slice(0,-1).join("/")}:n&&a&&a.uri?{file:i=a.uri,path:i.split("/").slice(0,-1).join("/")}:r&&(i=document.getElementsByTagName("script"))&&i.length?{file:i=i[i.length-1].src,path:i.split("/").slice(0,-1).join("/")}:{file:null,path:null}}function i(e,t,n,r,a){var i,s=e.length,o=new Array(s);for(i=0;s>i;i++)o[i]=1===r?n[e[i]]||a(t[i]):2===r?a(e[i]):n[e[i]];return o}function s(e,t,n,r,a,i){var s,o,l,u,c,h,f,d=n.length;if(i){for(s=0;d>s;s++)n[s]in e||importScripts(t+r[s]);return a()}h=document.getElementsByTagName("head")[0],f=document.createElement("a"),o=/^\./,l=0,s=0,u=function(e,n){var r=0,a=document.createElement("script");a.type="text/javascript",a.language="javascript",a.onload=a.onreadystatechange=function(){r||a.readyState&&"loaded"!=a.readyState&&"complete"!=a.readyState||(r=1,a.onload=a.onreadystatechange=null,n(),h.removeChild(a),a=null)},o.test(e)&&(f.href=t+e,e=f.protocol+"//"+f.host+f.pathname+f.search+f.hash),a.src=e,h.appendChild(a)},c=function(){n[s]in e?++s>=d?a():n[s]in e?c():u(r[s],c):++l<30?setTimeout(c,30):(l=0,s++,c())};for(;d>s&&n[s]in e;)s++;d>s?u(r[s],c):a()}n=n||[[],[]];var o,l,u,c="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),h=!c&&"undefined"!=typeof navigator,f=!c&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,d="function"==typeof define&&define.amd,m=c&&"object"==typeof module&&module.exports,p=f?self:e,_=a(c,f,d,h),g=[].concat(n[0]),v=[].concat(n[1]),y=g.length,w=/\.js$/i;if(m)module.$deps=module.$deps||{},module.exports=module.$deps[t]=r.apply(e,[{NODE:module}].concat(i(g,v,module.$deps,1,require)))||1;else if(d&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)){if(!require.defined(t)){for(u={},l=0;y>l;l++)require.specified(g[l])||(u[g[l]]=v[l].replace(w,""));require.config({paths:u}),define(t,["require","exports","module"].concat(g),function(t,n,a){return r.apply(e,[{AMD:a}].concat(i(g,v,arguments,2,t)))})}}else t in p||s(p,_.path+"/",g,v,function(){p[t]=o=r.apply(e,[{}].concat(i(g,v,p)))||1,d&&define(t,["require"],function(){return o})},f)}(this,"FILTER",[["Classy","Asynchronous"],["./classy.js","./asynchronous.js"]],function(exports,Classy,Asynchronous){var FILTER=exports.FILTER=Classy.Merge({Classy:Classy,Asynchronous:Asynchronous,Path:Asynchronous.path(exports.AMD)},Classy);return FILTER.VERSION="0.7.2",!function(e,t){"use strict";var n,r="prototype",a=(Object[r],Function[r],Array[r]),i=t.Path,s=t.Merge,o=t.Asynchronous,l=o.isPlatform(o.Platform.NODE),u=o.isPlatform(o.Platform.BROWSER),c=o.supportsMultiThreading(),h=o.isThread(),f=navigator?navigator.userAgent:"",d=function(){return"[FILTER Plugin: "+this.name+"]"},m=function(e){return e},p=function(){},_=function(e){return function(){this.$super("constructor"),e.apply(this,arguments)}},g=(t.devicePixelRatio=e.devicePixelRatio||1,t._notSupportClamp="undefined"==typeof Uint8ClampedArray),v=("undefined"==typeof Int16Array||!Int16Array[r].set,function(e,t){var n=e.length;for(t=t||0;--n>=0;)this[n+t]=e[n]}),y=a.slice,w=0,A=t.Browser={isNode:l,isBrowser:u,isWorker:h,supportsWorker:c,isPhantom:/PhantomJS/.test(f),isOpera:u&&/Opera|OPR\//.test(f),isFirefox:u&&/Firefox\//.test(f),isChrome:u&&/Chrome\//.test(f),isSafari:u&&/Apple Computer/.test(navigator.vendor),isKhtml:u&&/KHTML\//.test(f),isIE:u&&(/MSIE \d/.test(f)||/Trident\/\d/.test(f)),isGecko:u&&/gecko\/\d/i.test(f),isWebkit:u&&/WebKit\//.test(f),isMac_geLion:u&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(f),isMac_geMountainLion:u&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(f),isMobile:!1,isIOS:/AppleWebKit/.test(f)&&/Mobile\/\w+/.test(f),isWin:/windows/i.test(navigator.platform),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};A.isMobile=A.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(f),A.isMac=A.isIOS||/Mac/.test(navigator.platform),A.isIE_lt8=A.isIE&&!h&&(null==document.documentMode||document.documentMode<8),A.isIE_lt9=A.isIE&&!h&&(null==document.documentMode||document.documentMode<9),A.isQtWebkit=A.isWebkit&&/Qt\/\d+\.\d+/.test(f),t.getPath=o.path,t.uuid=function(e){return[e||"filter",(new Date).getTime(),++w].join("_")},t.Array=Array,t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.Array32F[r].set||(t.Array32F[r].set=v,t.Array64F[r].set=v,t.Array8I[r].set=v,t.Array16I[r].set=v,t.Array32I[r].set=v,t.Array8U[r].set=v,t.Array16U[r].set=v,t.Array32U[r].set=v),t.Array32F[r].subarray||(t.Array32F[r].subarray=y,t.Array64F[r].subarray=y,t.Array8I[r].subarray=y,t.Array16I[r].subarray=y,t.Array32I[r].subarray=y,t.Array8U[r].subarray=y,t.Array16U[r].subarray=y,t.Array32U[r].subarray=y),t.ImArray=g?t.Array8U:Uint8ClampedArray,t.ImArrayCopy=A.isOpera?t.Array8U:t.ImArray,g&&"undefined"!=typeof CanvasPixelArray&&!CanvasPixelArray[r].set&&(CanvasPixelArray[r].set=v),g=t._notSupportClamp=g||A.isOpera,t.NotImplemented=function(e){return e=e||"",function(){throw new Error("Method "+e+" not Implemented!")}},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(){},t.useWebGLSharedResourcesIfAvailable=function(){},t.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},t.LUMA=new t.Array32F([.212671,.71516,.072169]),t.FORMAT={IMAGE:1,DATA:4,PNG:8,JPG:16,GIF:32,TGA:64,RGBE:128},t.MIME={PNG:"image/png",JPG:"image/jpeg",GIF:"image/gif"},t.FORMAT.JPEG=t.FORMAT.JPG,t.MIME.JPEG=t.MIME.JPG,t.Utils={},t.Codec={},t.Interpolation={},t.Transform={},t.ML={},n=t.log=console&&console.log?function(e){console.log(e)}:function(){},t.warning=function(e){n("WARNING: "+e)},t.error=function(e,t){if(n("ERROR: "+e),t)throw new Error(e)};var C=t.FilterThread=t.Class(o,{path:t.getPath(exports.AMD),name:null,constructor:function(){var e=this,t=null;h&&e.initThread().listen("load",function(e){e&&e.filter&&(t&&(t.dispose(!0),t=null),t=o.load("FILTER."+e.filter))}).listen("import",function(e){e&&e["import"]&&e["import"].length&&importScripts(e["import"])}).listen("params",function(e){t&&t.unserialize(e)}).listen("apply",function(n){if(t&&n&&n.im){n.params&&t.unserialize(n.params);var r={im:t._apply(n.im[0],n.im[1],n.im[2])};t.hasMeta&&(r.meta=t.getMeta()),e.send("apply",r)}else e.send("apply",{im:null})}).listen("dispose",function(){t&&(t.dispose(!0),t=null),e.dispose(!0),close()})},thread:function(e){var t=this;return arguments.length||(e=!0),e=!!e,e&&!t.$thread?(t.fork("FILTER.FilterThread",i.file!==t.path.file?[i.file,t.path.file]:t.path.file),t.send("load",{filter:t.name})):!e&&t.$thread&&t.unfork(),t},sources:function(){var e=a.slice.call(arguments);if(e.length){var t,n=[];for(t=0;t<e.length;t++)n.push("function"==typeof e[t]?o.blob(e[t].toString()):o.blob(e[t]));this.send("import",{"import":n.join(",")})}return this},scripts:function(){var e=a.slice.call(arguments);return e.length&&this.send("import",{"import":e.join(",")}),this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{}}},unserialize:function(e){var t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn),t}}),b=t.Filter=t.Class(C,{name:"Filter",constructor:function(){},id:null,_isOn:!0,_update:!0,_onComplete:null,hasMeta:!1,dispose:function(){var e=this;return e.$super("dispose"),e.name=null,e.id=null,e._isOn=null,e._update=null,e._onComplete=null,e.hasMeta=null,e},worker:C[r].thread,complete:function(e){return this._onComplete=e||null,this},isOn:function(){return this._isOn},update:function(e){return arguments.length||(e=!0),this._update=!!e,this},turnOn:function(e){return arguments.length||(e=!0),this._isOn=!!e,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this},canRun:function(){return this._isOn},getMeta:function(){},setMeta:function(){return this},combineWith:function(){return this},_apply:function(e){return e},apply:function(e,t,n){var r,a,i=this;return i.canRun()?(arguments.length<3&&(t&&t.setSelectedData?n=null:"function"==typeof t?(n=t,t=e):(t=e,n=null)),e&&t&&(n=n||i._onComplete,r=e.getSelectedData(),i.$thread?i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&(e.meta&&i.setMeta(e.meta),i._update&&t.setSelectedData(e.im)),n&&n.call(i)}).send("apply",{im:r,params:i.serialize()}):(a=i._apply(r[0],r[1],r[2],e),i._update&&t.setSelectedData(a),n&&n.call(i))),e):e},toString:function(){return"[FILTER: "+this.name+"]"}});t.Create=function(e){e=s({init:p,name:"PluginFilter",toString:d,apply:m},e),e.constructor=_(e.init),e._apply=e.apply,delete e.init,delete e.apply;var n=e.name;return t[n]=t.Class(b,e)}}(this,FILTER),!function(e){"use strict";function t(e,t,n){return e>n?n:t>e?t:e}function n(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var r=(e.ImArray,e.Array32F),a=(e.Array64F,Math.PI),i=a+a,s=.5*a;Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2},e.CONSTANTS={PI:a,PI2:i,PI_2:s,SQRT2:Math.SQRT2,toRad:a/180,toDeg:180/a},e.Math={clamp:t,closestPower2:n,integral:function(e,t,n,a){var i,s,o,l,u,c,h,f,d,m,p=t<<2,_=e.length,g=_>>2;for(a=!0===a,m=!a,i=new r(g),m&&(s=new r(g),o=new r(g)),f=0,h=0,l=u=c=0,d=0;t>d;d++,h+=4,f++)l+=e[h],i[f]=l,m&&(u+=e[h+1],c+=e[h+2],s[f]=u,o[f]=c);for(h=p,d=0,f=0,l=u=c=0,h=p;_>h;h+=4,f++,d++)d>=t&&(d=0,l=u=c=0),l+=e[h],i[f+t]=i[f]+l,m&&(u+=e[h+1],c+=e[h+2],s[f+t]=s[f]+u,o[f+t]=o[f]+c);return m?[i,s,o]:[i,i,i]},histogram:function(e,t,n,a){var i,s,o,l,u,c,h,f,d,m,p,_=e.length,g=0,v=0,y=0,w=255,A=255,C=255,b=1/(_>>2);for(a=!0===a,p=!a,i=new r(256),p&&(s=new r(256),o=new r(256)),m=0;256>m;m+=4)i[m]=0,i[m+1]=0,i[m+2]=0,i[m+3]=0,p&&(s[m]=0,o[m]=0,s[m+1]=0,o[m+1]=0,s[m+2]=0,o[m+2]=0,s[m+3]=0,o[m+3]=0);for(m=0;_>m;m+=4)l=e[m],i[l]+=b,l>g?g=l:w>l&&(w=l),p&&(u=e[m+1],c=e[m+2],s[u]+=b,o[c]+=b,u>v?v=u:A>u&&(A=u),c>y?y=c:C>c&&(C=c));for(h=f=d=0,m=0;256>m;m+=4)h+=i[m],i[m]=h,h+=i[m+1],i[m+1]=h,h+=i[m+2],i[m+2]=h,h+=i[m+3],i[m+3]=h,p&&(f+=s[m],s[m]=f,d+=o[m],o[m]=d,f+=s[m+1],s[m+1]=f,d+=o[m+1],o[m+1]=d,f+=s[m+2],s[m+2]=f,d+=o[m+2],o[m+2]=d,f+=s[m+3],s[m+3]=f,d+=o[m+3],o[m+3]=d);return p?[i,s,o]:[i,i,i]},spectrum:function(){return null}}}(FILTER),!function(e){"use strict";var t=e.ImArray,n=Math.min;e.Interpolation.crop=function(e,r,a,i,s,o,l){o=n(o,r-1),l=n(l,a-1);var u,c,h,f,d=o-i+1,m=l-s+1,p=d*m<<2,_=new t(p),g=d<<2;for(u=s,c=s*r,h=0;l>=u;u++,c+=r,h+=g)f=c+i<<2,_.set(e.subarray(f,f+g),h);return _},e.Interpolation.pad=function(e,n,r,a,i,s,o){a=a||0,i=i||0,s=s||0,o=o||0;var l,u,c,h,f=n+s+a,d=r+o+i,m=f*d<<2,p=new t(m),_=n<<2,g=f<<2,v=o*g,y=s<<2;for(l=0,u=0,c=v;r>l;l++,u+=n,c+=g)h=u<<2,p.set(e.subarray(h,h+_),y+c);return p}}(FILTER),!function(e){"use strict";var t=e.Math.clamp,n=e.ImArray;e.Interpolation.bilinear=function(e,r,a,i,s){var o,l,u,c,h,f,d,m,p,_,g,v,y,w,A,C,b,M,I,R=i*s<<2,E=new n(R),L=(r-1)/i,x=(a-1)/s,N=r<<2;for(p=0,_=0,g=0,v=0,w=0,b=0,I=0,C=0;R>C;C+=4,_++,g+=L)_>=i&&(_=0,g=0,p++,v+=x,w=~~v,I=v-w,b=w*r),y=~~g,M=g-y,h=(1-M)*(1-I),f=M*(1-I),d=I*(1-M),m=M*I,A=b+y<<2,o=e[A],l=e[A+4],u=e[A+N],c=e[A+N+4],E[C]=t(~~(o*h+l*f+u*d+c*m+.5),0,255),o=e[A+1],l=e[A+5],u=e[A+N+1],c=e[A+N+5],E[C+1]=t(~~(o*h+l*f+u*d+c*m+.5),0,255),o=e[A+2],l=e[A+6],u=e[A+N+2],c=e[A+N+6],E[C+2]=t(~~(o*h+l*f+u*d+c*m+.5),0,255),o=e[A+3],l=e[A+7],u=e[A+N+3],c=e[A+N+7],E[C+3]=t(~~(o*h+l*f+u*d+c*m+.5),0,255);return E}}(FILTER),!function(e){"use strict";var t,n;n=e.Class({constructor:function(e){var t=this;t._cnv=e,t._transform={scale:[1,1],translate:[0,0],rotate:[0,0]},t._data=null},_cnv:null,_transform:null,_data:null,dispose:function(){var e=this;return e._cnv=null,e._data=null,e._transform=null,e},drawImage:function(){},scale:function(e,t){var n=this;return n._transform.scale[0]=e,n._transform.scale[1]=t,n},translate:function(e,t){var n=this;return n._transform.translate[0]=e,n._transform.translate[1]=t,n}}),e.FilterCanvas=t=e.Class({constructor:function(e,t){var r=this;r.width=e||0,r.height=t||0,r.style={},r._ctx=new n(r)},_ctx:null,width:null,height:null,style:null,dispose:function(){var e=this;return e.width=null,e.height=null,e.style=null,e._ctx.dispose(),e._ctx=null,e},getContext:function(){return this._ctx},toDataURL:function(){return""}}),e.Canvas=function(n,r){var a=e.Browser.isNode?new t:document.createElement("canvas");return n=n||0,r=r||0,a.style.width=n+"px",a.style.height=r+"px",a.width=n*devicePixelRatio,a.height=r*devicePixelRatio,a}}(FILTER),!function(e){"use strict";var t=Math.sqrt,n=Math.round,r=(Math.floor,Math.min),a=Math.max,i=(Math.abs,e.Math.clamp),s=function(e){return e.replace(/([.*+?^${}()|\[\]\/\\\-])/g,"\\$1")},o=function(e){return e.replace(/^\s+/gm,"").replace(/\s+$/gm,"")},l=1/255,u=100/255,c=2.55,h={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},f=e.Color=e.Class({__static__:{clamp:i,clampPixel:function(e){return r(255,a(e,0))},toGray:function(t,n,r){var a=e.LUMA;return~~(a[0]*t+a[1]*n+a[2]*r)},distance:function(e,n){var r=e[0]-n[0],a=e[1]-n[1],i=e[2]-n[2];return t(r*r+a*a+i*i)},RGB2Color:function(e){return e[0]<<16|e[1]<<8|255&e[2]},RGBA2Color:function(e){return e[3]<<24|e[0]<<16|e[1]<<8|255&e[2]},Color2RGBA:function(e){return e=~~e,[e>>>16&255,e>>>8&255,255&e,e>>>24&255]},RGB2YCbCr:function(e){var t,n,r,a=e[0],i=e[1],s=e[2];return t=~~(0+.299*a+.587*i+.114*s),n=~~(128-.168736*a-.331264*i+.5*s),r=~~(128+.5*a-.418688*i-.081312*s),[t,n,r]},YCbCr2RGB:function(e){var t,n,r,a=e[0],i=e[1],s=e[2];return t=~~(a+1.402*(s-128)),n=~~(a-.34414*(i-128)-.71414*(s-128)),r=~~(a+1.772*(i-128)),[t,n,r]},RGB2HSV:function(e){var t,n,i,s,o,l,u,c,h;return s=e[0],o=e[1],l=e[2],t=r(s,o,l),n=a(s,o,l),i=n-t,h=n,0==n?(c=0,u=0,[u,c,h]):(c=i/n,u=s==n?(o-l)/i:o==n?2+(l-s)/i:4+(s-o)/i,u*=60,0>u&&(u+=360),[u,c,h])},HSV2RGB:function(e){var t,n,r,a,i,s,o,l,u,c,h;if(u=e[0],c=e[1],h=e[2],0==c)return s=o=l=h,[s,o,l];switch(u/=60,t=~~u,n=u-t,r=h*(1-c),a=h*(1-c*n),i=h*(1-c*(1-n)),t){case 0:s=h,o=i,l=r;break;case 1:s=a,o=h,l=r;break;case 2:s=r,o=h,l=i;break;case 3:s=r,o=a,l=h;break;case 4:s=i,o=r,l=h;break;default:s=h,o=r,l=a}return[s,o,l]},toString:function(){return"[FILTER: "+this.name+"]"},C2F:l,C2P:u,P2C:c,Keywords:h,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(h).map(s).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(e,t){return e*u+(t||"")},per2col:function(e){return e*c},rgb2cmyk:function(e,t,a,s){var o,u,h=0,f=0,d=0,m=0;return s&&(e=i(n(e*c),0,255),t=i(n(t*c),0,255),a=i(n(a*c),0,255)),0==e&&0==t&&0==a?(m=1,[0,0,0,1]):(h=1-e*l,f=1-t*l,d=1-a*l,o=r(h,f,d),u=1/(1-o),h=(h-o)*u,f=(f-o)*u,d=(d-o)*u,m=o,[h,f,d,m])},cmyk2rgb:function(e,t,r,a){var s,o,l=0,u=0,c=0;return 0==e&&0==t&&0==r?[0,0,0]:(s=a,o=1-s,e=e*o+s,t=t*o+s,r=r*o+s,l=255*(1-e),u=255*(1-t),c=255*(1-r),[i(n(l),0,255),i(n(u),0,255),i(n(c),0,255)])},rgb2hex:function(e,t,r,a,s){var o;return s&&(e=i(n(e*c),0,255),t=i(n(t*c),0,255),r=i(n(r*c),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),o=a&&e[0]==e[1]&&t[0]==t[1]&&r[0]==r[1]?"#"+e[0]+t[0]+r[0]:"#"+e+t+r},rgb2hexIE:function(e,t,r,a,s){var o;return s&&(e=i(n(e*c),0,255),t=i(n(t*c),0,255),r=i(n(r*c),0,255),a=i(n(a*c),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),a=16>a?"0"+a.toString(16):a.toString(16),o="#"+a+e+t+r},hex2rgb:function(e){return!e||3>e.length?[0,0,0]:6>e.length?[i(parseInt(e[0]+e[0],16),0,255),i(parseInt(e[1]+e[1],16),0,255),i(parseInt(e[2]+e[2],16),0,255)]:[i(parseInt(e[0]+e[1],16),0,255),i(parseInt(e[2]+e[3],16),0,255),i(parseInt(e[4]+e[5],16),0,255)]},hue2rgb:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},hsl2rgb:function(e,t,r){var a,s,o,l,u;return e=(e+360)%360/360,t*=.01,r*=.01,0==t?(a=1,s=1,o=1):(u=.5>r?r*(1+t):r+t-r*t,l=2*r-u,a=f.hue2rgb(l,u,e+1/3),s=f.hue2rgb(l,u,e),o=f.hue2rgb(l,u,e-1/3)),[i(n(255*a),0,255),i(n(255*s),0,255),i(n(255*o),0,255)]},rgb2hsl:function(e,t,s,o){var u,c,h,f,d,m;return o?(e*=.01,t*=.01,s*=.01):(e*=l,t*=l,s*=l),c=a(e,t,s),u=r(e,t,s),d=.5*(c+u),c==u?h=f=0:(m=c-u,f=d>.5?m/(2-a-r):m/(a+r),h=c==e?(t-s)/m+(s>t?6:0):c==t?(s-e)/m+2:(e-t)/m+4,h/=6),[n(360*h)%360,i(100*f,0,100),i(100*d,0,100)]},parse:function(e,t,n,r){var a,i,s,l,c,h=0,d=0;if("hsl"==n||!n&&(a=e.match(f.hslRE))){if("hsl"==n){c="hsla"==e[0].toLowerCase();var m=e[1].split(",").map(o)}else{h=a[0].length,d=0,c="hsla"==a[1].toLowerCase();var m=a[2].split(",").map(o)}var p=m[0]?m[0]:"0",e=m[1]?m[1]:"0",_=m[2]?m[2]:"0",g=c&&null!=m[3]?m[3]:"1";return p=parseFloat(p,10),e="%"==e.slice(-1)?parseFloat(e,10):parseFloat(e,10)*u,_="%"==_.slice(-1)?parseFloat(_,10):parseFloat(_,10)*u,g=parseFloat(g,10),l=(new f).fromHSL([p,e,_,g]),t&&(s=e.substr(h),(i=s.match(f.colorstopRE))&&(l.colorStop(i[1]),d=i[0].length)),r?l:[l,0,h+d]}if("rgb"==n||!n&&(a=e.match(f.rgbRE))){if("rgb"==n){c="rgba"==e[0].toLowerCase();var m=e[1].split(",").map(o)}else{h=a[0].length,d=0,c="rgba"==a[1].toLowerCase();var m=a[2].split(",").map(o)}var v=m[0]?m[0]:"0",y=m[1]?m[1]:"0",w=m[2]?m[2]:"0",g=c&&null!=m[3]?m[3]:"1";return v="%"==v.slice(-1)?2.55*parseFloat(v,10):parseFloat(v,10),y="%"==y.slice(-1)?2.55*parseFloat(y,10):parseFloat(y,10),w="%"==w.slice(-1)?2.55*parseFloat(w,10):parseFloat(w,10),g=parseFloat(g,10),l=(new f).fromRGB([v,y,w,g]),t&&(s=e.substr(h),(i=s.match(f.colorstopRE))&&(l.colorStop(i[1]),d=i[0].length)),r?l:[l,0,h+d]}if("hex"==n||!n&&(a=e.match(f.hexRE))){if("hex"==n)var m=f.hex2rgb(e[0]);else{h=a[0].length,d=0;var m=f.hex2rgb(a[1])}var A=m[0]?m[0]:0,C=m[1]?m[1]:0,b=m[2]?m[2]:0,g=null!=m[3]?m[3]:255;return l=(new f).fromHEX([A,C,b,g]),t&&(s=e.substr(h),(i=s.match(f.colorstopRE))&&(l.colorStop(i[1]),d=i[0].length)),r?l:[l,0,h+d]}if("keyword"==n||!n&&(a=e.match(f.keywordRE))){if("keyword"==n)var m=e[0];else{h=a[0].length,d=0;var m=a[1]}return l=(new f).fromKeyword(m),t&&(s=e.substr(h),(i=s.match(f.colorstopRE))&&(l.colorStop(i[1]),d=i[0].length)),r?l:[l,0,h+d]}return null},fromString:function(e,t,n){return f.parse(e,t,n,1)},fromRGB:function(e){return(new f).fromRGB(e)},fromHSL:function(e){return(new f).fromHSL(e)},fromCMYK:function(e){return(new f).fromCMYK(e)},fromHEX:function(e){return(new f).fromHEX(e)},fromKeyword:function(e){return(new f).fromKeyword(e)},fromPixel:function(e){return(new f).fromPixel(e)}},constructor:function(e,t){return this instanceof f?(this.reset(),void(e&&this.set(e,t))):new f(e,t)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var e=new f;return e.col=this.col.slice(),e.cstop=this.cstop+"",e.kword=this.kword,e},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(e,t){return e&&(undef!==e[0]&&(this.col[0]=i(e[0],0,255)),undef!==e[1]&&(this.col[1]=i(e[1],0,255)),undef!==e[2]&&(this.col[2]=i(e[2],0,255)),this.col[3]=undef!==e[3]?i(e[3],0,1):1,t&&(this.cstop=t),this.kword=null),this},colorStop:function(e){return this.cstop=e,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return this.kword?!0:!1},fromPixel:function(e){return e=e||0,this.col=[i(e>>16&255,0,255),i(e>>8&255,0,255),i(255&e,0,255),i((e>>24&255)*l,0,1)],this.kword=null,this},fromKeyword:function(e){return e=e.toLowerCase(),f.Keywords[e]&&(this.col=f.Keywords[e].slice(),this.kword=e),this},fromHEX:function(e){return this.col[0]=e[0]?i(parseInt(e[0],10),0,255):0,this.col[1]=e[1]?i(parseInt(e[1],10),0,255):0,this.col[2]=e[2]?i(parseInt(e[2],10),0,255):0,this.col[3]=undef!==e[3]?i(parseInt(e[3],10)*l,0,1):1,this.kword=null,this},fromRGB:function(e){return this.col[0]=e[0]?i(n(e[0]),0,255):0,this.col[1]=e[1]?i(n(e[1]),0,255):0,this.col[2]=e[2]?i(n(e[2]),0,255):0,this.col[3]=undef!==e[3]?i(e[3],0,1):1,this.kword=null,this},fromCMYK:function(e){var t=f.cmyk2rgb(e[0]||0,e[1]||0,e[2]||0,e[3]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[4]?i(e[4],0,1):1,this.kword=null,this},fromHSL:function(e){var t=f.hsl2rgb(e[0]||0,e[1]||0,e[2]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[3]?i(e[3],0,1):1,this.kword=null,this},toPixel:function(e){return e?i(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(e,t,n){var r=f.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(e,t,n){return this.kword?this.kword:this.toHEX(1,t,n)},toHEX:function(e,t,r){return r?f.rgb2hexIE(this.col[0],this.col[1],this.col[2],i(n(255*this.col[3]),0,255)):f.rgb2hex(this.col[0],this.col[1],this.col[2],t)},toRGB:function(e,t,n){var r=this.col[3];return e?(t&&(r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(e,t,n){var r=this.col[3],a=f.rgb2hsl(this.col[0],this.col[1],this.col[2]);return e?(t&&(a[1]=0==a[1]?a[1]:a[1]+"%",a[2]=0==a[2]?a[2]:a[2]+"%",r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[a[0],a[1],a[2]].join(",")+")":"hsla("+[a[0],a[1],a[2],r].join(",")+")"):n?a:a.concat(this.col[3])},toColorStop:function(e){var t=this.cstop;return e?(t=t.length?t+",":"",1>this.col[3]?"color-stop("+t+this.toRGB(1,1)+")":"color-stop("+t+this.toHEX(1,1)+")"):(t=t.length?" "+t:"",1>this.col[3]?this.toRGB(1,1)+t:this.toHEX(1,1)+t)},toString:function(e,t){return e=e?e.toLowerCase():"hex","rgb"==e||"rgba"==e?this.toRGB(1,!1!==t,"rgb"==e):"hsl"==e||"hsla"==e?this.toHSL(1,!1!==t,"hsl"==e):"keyword"==e?this.toKeyword(1):this.toHEX(1,!1!==t,"hexie"==e)}})}(FILTER),!function(e,t){"use strict";function n(e){var t=e.width,n=e.height,r=c(t,n);return r.width=t*o,r.height=n*o,r}function r(e,t,n,r){return r=r||M,r&C&&(e.width=t,e.oCanvas.style.width=t+"px",e.oCanvas.width=t*o,e._restorable&&(e.iCanvas.style.width=e.oCanvas.style.width,e.iCanvas.width=e.oCanvas.width),e.tmpCanvas&&(e.tmpCanvas.style.width=e.oCanvas.style.width,e.tmpCanvas.width=e.oCanvas.width)),r&b&&(e.height=n,e.oCanvas.style.height=n+"px",e.oCanvas.height=n*o,e._restorable&&(e.iCanvas.style.height=e.oCanvas.style.height,e.iCanvas.height=e.oCanvas.height),e.tmpCanvas&&(e.tmpCanvas.style.height=e.oCanvas.style.height,e.tmpCanvas.height=e.oCanvas.height)),e}function a(e,t){var n=e.width,r=e.height;return t=t||255,e._restorable&&t&p&&e._needsRefresh&p&&(e.iData=e.ictx.getImageData(0,0,n,r),e._needsRefresh&=~p),t&_&&e._needsRefresh&_&&(e.oData=e.octx.getImageData(0,0,n,r),e._needsRefresh&=~_),e}function i(e,t){if(e.selection){var n=e.selection,r=e.width-1,a=e.height-1,i=f(n[0]*r),s=f(n[1]*a),o=f(n[2]*r)-i+1,l=f(n[3]*a)-s+1;t=t||255,e._restorable&&t&g&&e._needsRefresh&g&&(e.iDataSel=e.ictx.getImageData(i,s,o,l),e._needsRefresh&=~g),t&v&&e._needsRefresh&v&&(e.oDataSel=e.octx.getImageData(i,s,o,l),e._needsRefresh&=~v)}return e}var s="prototype",o=e.devicePixelRatio,l=e.ImArray,u=e.ImArrayCopy,c=(e.Array32F,e.Canvas),h=e.FilterCanvas,f=(e._notSupportTypedArrays,Math.min,Math.floor),d=e.FORMAT,m=e.MIME,p=1,_=2,g=4,v=8,y=16,w=32,A=64,C=2,b=4,M=C|b,I=g|v,R=p|_,E=~I,L=~y,x=~w,N=e.Image=e.Class({name:"Image",constructor:function O(e){var t=this,n=0,r=0;return t instanceof O?(t.width=n,t.height=r,t.iData=null,t.iDataSel=null,t.oData=null,t.oDataSel=null,t.iCanvas=c(n,r),t.oCanvas=c(n,r),t.tmpCanvas=null,t.domElement=t.oCanvas,t.ictx=t.iCanvas.getContext("2d"),t.octx=t.oCanvas.getContext("2d"),t.webgl=null,t._histogram=null,t._integral=null,t._spectrum=null,t.selection=null,t._needsRefresh=0,t._restorable=!0,t._grayscale=!1,void(e&&t.image(e))):new O(e)},width:0,height:0,selection:null,iCanvas:null,oCanvas:null,tmpCanvas:null,ictx:null,octx:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,webgl:null,_histogram:null,_integral:null,_spectrum:null,_needsRefresh:0,_restorable:!0,_grayscale:!1,dispose:function(){var e=this;return e.width=null,e.height=null,e.selection=null,e.ictx=null,e.octx=null,e.iData=null,e.iDataSel=null,e.oData=null,e.oDataSel=null,e.iCanvas=null,e.oCanvas=null,e.tmpCanvas=null,e.domElement=null,e.webgl=null,e._histogram=null,e._integral=null,e._spectrum=null,e._needsRefresh=null,e._restorable=null,e._grayscale=null,e},clone:function(e){return new N(!0===e?this.iCanvas:this.oCanvas)},grayscale:function(e){var t=this;return arguments.length?(t._grayscale=!!e,t):t._grayscale},restorable:function(e){var t=this;return arguments.length||(e=!0),t._restorable=!!e,t},apply:function(e,t){return e.apply(this,this,t||null),this},apply2:function(e,t,n){return e.apply(this,t,n||null),this},select:function(e,t,n,r){var a=this,i=arguments.length;return 1>i&&(e=0),2>i&&(t=0),3>i&&(n=1),4>i&&(r=1),a.selection=[0>e?0:e>1?1:e,0>t?0:t>1?1:t,0>n?0:n>1?1:n,0>r?0:r>1?1:r],a._needsRefresh|=I,a},deselect:function(){var e=this;return e.selection=null,e.iDataSel=null,e.oDataSel=null,e._needsRefresh&=E,e},store:function(){var e=this;return e._restorable&&(e.ictx.drawImage(e.oCanvas,0,0),e._needsRefresh|=p,e.selection&&(e._needsRefresh|=g)),e},restore:function(){var e=this;return e._restorable&&(e.octx.drawImage(e.iCanvas,0,0),e._needsRefresh|=_|y|w|A,e.selection&&(e._needsRefresh|=v)),e},dimensions:function(e,t){var n=this;return r(n,e,t,M),n._needsRefresh|=R|y|w|A,n.selection&&(n._needsRefresh|=I),n},scale:function(e,t){var r=this;if(e=e||1,t=t||e,1==e&&1==t)return r;r.tmpCanvas=r.tmpCanvas||n(r);var a=r.tmpCanvas.getContext("2d"),i=r.width,s=r.height;return a.scale(e,t),i=r.width=~~(e*i+.5),s=r.height=~~(t*s+.5),a.drawImage(r.oCanvas,0,0),r.oCanvas.style.width=i+"px",r.oCanvas.style.height=s+"px",r.oCanvas.width=i*o,r.oCanvas.height=s*o,r.octx.drawImage(r.tmpCanvas,0,0),r._restorable&&(a.drawImage(r.iCanvas,0,0),r.iCanvas.style.width=r.oCanvas.style.width,r.iCanvas.style.height=r.oCanvas.style.height,r.iCanvas.width=r.oCanvas.width,r.iCanvas.height=r.oCanvas.height,r.ictx.drawImage(r.tmpCanvas,0,0)),r.tmpCanvas.width=r.oCanvas.width,r.tmpCanvas.height=r.oCanvas.height,r._needsRefresh|=R|y|w|A,r.selection&&(r._needsRefresh|=I),r},flipHorizontal:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(e.width,0),t.scale(-1,1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=R|y|w|A,e.selection&&(e._needsRefresh|=I),e},flipVertical:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(0,e.height),t.scale(1,-1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=R|y|w|A,e.selection&&(e._needsRefresh|=I),e},draw:function(){return this},clear:function(){var e=this,t=e.width,n=e.height;return t&&n&&(e._restorable&&e.ictx.clearRect(0,0,t,n),e.octx.clearRect(0,0,t,n),e._needsRefresh|=R|y|w|A,e.selection&&(e._needsRefresh|=I)),e},crop:function(e,t,r,a){var i,s,l,u,c,h,d,m,p=this,_=p.selection,g=p.width,v=p.height;if(arguments.length)c=e,h=t,d=r-e+1,m=a-t+1;else{if(!_)return p;i=f(_[0]*(g-1)),s=f(_[1]*(v-1)),l=f(_[2]*(g-1))-i+1,u=f(_[3]*(v-1))-s+1,c=i,h=s,d=l,m=u,_[0]=0,_[1]=0,_[2]=1,_[3]=1}p.tmpCanvas=p.tmpCanvas||n(p);var C=p.tmpCanvas.getContext("2d");return C.drawImage(p.oCanvas,0,0,g,v,c,h,d,m),p.oCanvas.style.width=d+"px",p.oCanvas.style.height=m+"px",p.oCanvas.width=d*o,p.oCanvas.height=m*o,p.octx.drawImage(p.tmpCanvas,0,0),p._restorable&&(C.drawImage(p.iCanvas,0,0,g,v,c,h,d,m),p.iCanvas.style.width=p.oCanvas.style.width,p.iCanvas.style.height=p.oCanvas.style.height,p.iCanvas.width=p.oCanvas.width,p.iCanvas.height=p.oCanvas.height,p.ictx.drawImage(p.tmpCanvas,0,0)),p.tmpCanvas.width=p.oCanvas.width,p.tmpCanvas.height=p.oCanvas.height,p._needsRefresh|=R|y|w|A,_&&(p._needsRefresh|=I),p},fill:function(e,n,r,a,i){var s,o,l,u,c=this,h=c.selection,d=c.width,m=c.height;h?(s=f(h[0]*(d-1)),o=f(h[1]*(m-1)),l=f(h[2]*(d-1))-s+1,u=f(h[3]*(m-1))-o+1):(s=0,o=0,l=d,u=m),t===n&&(n=s),t===r&&(r=o),t===a&&(a=l),t===i&&(i=u),a&&!d&&i&&!m&&c.createImageData(a,i);
var p=c.ictx,_=c.octx;return e=e||0,c._restorable&&(p.fillStyle=e,p.fillRect(n,r,a,i)),_.fillStyle=e,_.fillRect(n,r,a,i),c._needsRefresh|=R|y|w|A,h&&(c._needsRefresh|=I),c},getData:function(){var e,t=this;return t._restorable?(t._needsRefresh&p&&a(t,p),e=t.iData):(t._needsRefresh&_&&a(t,_),e=t.oData),new u(e.data)},getSelectedData:function(){var e,t=this;return t.selection?t._restorable?(t._needsRefresh&g&&i(t,g),e=t.iDataSel):(t._needsRefresh&v&&i(t,v),e=t.oDataSel):t._restorable?(t._needsRefresh&p&&a(t,p),e=t.iData):(t._needsRefresh&_&&a(t,_),e=t.oData),[new u(e.data),e.width,e.height]},getProcessedData:function(){var e=this;return e._needsRefresh&_&&a(e,_),new u(e.oData.data)},getProcessedSelectedData:function(){var e,t=this;return t.selection?(t._needsRefresh&v&&i(t,v),e=t.oDataSel):(t._needsRefresh&_&&a(t,_),e=t.oData),[new u(e.data),e.width,e.height]},setData:function(e){var t=this;return t._needsRefresh&_&&a(t,_),t.oData.data.set(e),t.octx.putImageData(t.oData,0,0),t._needsRefresh|=y|w|A,t.selection&&(t._needsRefresh|=v),t},setSelectedData:function(e){var t=this;if(t.selection){var n=t.selection,r=t.width-1,s=t.height-1,o=f(n[0]*r),l=f(n[1]*s);t._needsRefresh&v&&i(t,v),t.oDataSel.data.set(e),t.octx.putImageData(t.oDataSel,o,l),t._needsRefresh|=_}else t._needsRefresh&_&&a(t,_),t.oData.data.set(e),t.octx.putImageData(t.oData,0,0);return t._needsRefresh|=y|w|A,t},createImageData:function(e,t){var n,a,i=this;return r(i,e,t,M),i._restorable&&(n=i.ictx=i.iCanvas.getContext("2d"),n.createImageData(e,t)),a=i.octx=i.oCanvas.getContext("2d"),a.createImageData(e,t),i._needsRefresh|=R,i.selection&&(i._needsRefresh|=I),i},image:function(e){if(!e)return this;var t,n,i,s,o,l,u,c,f=this;return o=e instanceof N,o&&(e=e.oCanvas),l=e instanceof HTMLVideoElement,u=e instanceof HTMLCanvasElement||e instanceof h,c=e instanceof Image,l?(i=e.videoWidth,s=e.videoHeight):(i=e.width,s=e.height),c||u||l?(r(f,i,s,M),f._restorable&&(t=f.ictx=f.iCanvas.getContext("2d"),t.drawImage(e,0,0)),n=f.octx=f.oCanvas.getContext("2d"),n.drawImage(e,0,0),f._needsRefresh|=R):(f.oData||(f.createImageData(i,s),a(f,R)),f._restorable&&(t=f.ictx=f.iCanvas.getContext("2d"),f.iData.data.set(e.data),t.putImageData(f.iData,0,0)),n=f.octx=f.oCanvas.getContext("2d"),f.oData.data.set(e.data),n.putImageData(f.oData,0,0)),f._needsRefresh|=y|w|A,f.selection&&(f._needsRefresh|=I),f},getPixel:function(e,t){var n=this;n._needsRefresh&_&&a(n,_);var r=~~(t*n.width+e+.5)<<2,i=n.oData.data;return{r:i[r],g:i[r+1],b:i[r+2],a:i[r+3]}},setPixel:function(e,t,n,r,a,i){var s=this;return s.octx.putImageData(new l([255&n,255&r,255&a,255&i]),e,t),s._needsRefresh|=_|y|w|A,s.selection&&(s._needsRefresh|=v),s},getPixelData:function(){return this._needsRefresh&_&&a(this,_),this.oData},setPixelData:function(e){var t=this;return t.octx.putImageData(e,0,0),t._needsRefresh|=_|y|w|A,t.selection&&(t._needsRefresh|=v),t},integral:function(){var e=this;return e._needsRefresh&w&&(e._integral=N.integral(e.getPixelData().data,e.width,e.height,e._grayscale),e._needsRefresh&=x),e._integral},histogram:function(){var e=this;return e._needsRefresh&y&&(e._histogram=N.histogram(e.getPixelData().data,e.width,e.height,e._grayscale),e._needsRefresh&=L),e._histogram},spectrum:function(){var e=this;return e._spectrum},toImage:function(e){var t,n=this.oCanvas,r=1;if(t=e&d.JPG?n.toDataURL(m.JPG,r):e&d.GIF?n.toDataURL(m.GIF,r):n.toDataURL(m.PNG,r),e&d.IMAGE){var a=new Image;return a.src=t,a}return t},toString:function(){return"[FILTER Image: "+this.name+"]"}});N[s].setImage=N[s].image,N[s].setDimensions=N[s].dimensions,N.scale=N.resize=e.Interpolation.bilinear,N.crop=e.Interpolation.crop,N.pad=e.Interpolation.pad,N.integral=e.Math.integral,N.histogram=e.Math.histogram,N.spectrum=e.Math.spectrum;var F=e.ScaledImage=e.Class(N,{name:"ScaledImage",constructor:function T(e,t,n){var r=this;return r instanceof T?(r.scaleX=e||1,r.scaleY=t||r.scaleX,void r.$super("constructor",n)):new T(e,t,n)},scaleX:1,scaleY:1,dispose:function(){var e=this;return e.scaleX=null,e.scaleY=null,e.$super("dispose"),e},clone:function(e){var t=this;return new F(t.scaleX,t.scaleY,!0===e?t.iCanvas:t.oCanvas)},setScale:function(e,t){var n=this,r=arguments.length;return r>0&&null!=e&&(n.scaleX=e,n.scaleY=e),r>1&&null!=t&&(n.scaleY=t),n},image:function(e){if(!e)return this;var t,n,a,i,s,o,l,u,c,f,d=this,m=d.scaleX,p=d.scaleY;return l=e instanceof N,l&&(e=e.oCanvas),u=e instanceof HTMLVideoElement,c=e instanceof HTMLCanvasElement||e instanceof h,f=e instanceof Image,u?(a=e.videoWidth,i=e.videoHeight):(a=e.width,i=e.height),(f||c||u)&&(s=~~(m*a+.5),o=~~(p*i+.5),r(d,s,o,M),d._restorable&&(t=d.ictx=d.iCanvas.getContext("2d"),t.drawImage(e,0,0,a,i,0,0,s,o)),n=d.octx=d.oCanvas.getContext("2d"),n.drawImage(e,0,0,a,i,0,0,s,o),d._needsRefresh|=R|y|w|A,d.selection&&(d._needsRefresh|=I)),d}});F[s].setImage=F[s].image}(FILTER),!function(e){"use strict";var t=e.Image,n=e.Class,r="addEventListener",a=e.Loader=n({name:"Loader",__static__:{load:e.Method(function(e,t,n){return function(e,t,r){return(new n).load(e,t,r)}},e.LATE|e.STATIC)},constructor:function o(){var e=this;return e instanceof o?void 0:new o},_crossOrigin:null,_responseType:null,dispose:function(){var e=this;return e._crossOrigin=null,e._responseType=null,e},load:function(){return null},responseType:function(e){var t=this;return arguments.length?(t._responseType=e,t):t._responseType},crossOrigin:function(e){var t=this;return arguments.length?(t._crossOrigin=e,t):t._crossOrigin}}),i=e.XHRLoader=n(a,{name:"XHRLoader",constructor:function l(){var e=this;return e instanceof l?void 0:new l},load:function(t,n,a){var i,s=this;return e.Browser.isNode?i=require("http").get(t,function(e){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){"function"==typeof n&&n(new Buffer(t))})}).on("error",function(e){"function"==typeof a&&a(e)}):(i=new XMLHttpRequest,i.open("GET",t,!0),i[r]("load",function(){"function"==typeof n&&n(this.response)},!1),"function"==typeof a&&i[r]("error",a,!1),s._crossOrigin&&(i.crossOrigin=s._crossOrigin),s._responseType&&(i.responseType=s._responseType),i.send(null)),s}}),s=e.FileLoader=n(a,{name:"FileLoader",constructor:function u(){var e=this;return e instanceof u?void 0:new u},load:function(e,t,n){var r=this,a={encoding:"arraybuffer"===r._responseType?null:r._responseType,flag:"r"};return require("fs").readFile(e,a,function(e,r){e?"function"==typeof n&&n(e):"function"==typeof t&&t(r)}),r}});e.BinaryLoader=n(a,{name:"BinaryLoader",constructor:function c(e){var t=this;return t instanceof c?void(t._decoder="function"==typeof e?e:null):new c(e)},_decoder:null,_encoder:null,dispose:function(){var e=this;return e._decoder=null,e._encoder=null,e.$super("dispose"),e},decoder:function(e){var t=this;return t._decoder="function"==typeof e?e:null,t},encoder:function(e){var t=this;return t._encoder="function"==typeof e?e:null,t},load:function(n,r,a){var o,l=this,u=new t,c=l._decoder;return"function"==typeof c&&(o=e.Browser.isNode?new s:new i,o.responseType(l._responseType||"arraybuffer").load(n,function(e){var t={},n=c(e,t);n&&(u.image(n),"function"==typeof r&&r(u,t))},a)),u}})}(FILTER),!function(e){"use strict";var t=e.Image;e.HTMLImageLoader=e.Class(e.Loader,{name:"HTMLImageLoader",constructor:function n(){return this instanceof n?void this.$super("constructor"):new n},load:function(e,n,r){var a,i=this,s=new t;return a=new Image,a.onload=function(){s.setImage(a),"function"==typeof n&&n(s,a)},a.onerror=function(){"function"==typeof r&&r(s,a)},a.crossOrigin=i._crossOrigin?i._crossOrigin:"",a.src=e,s}})}(FILTER),!function(e){"use strict";var t=(Object.prototype,Function.prototype,Array.prototype),n=t.slice,r=t.splice,a=t.concat,i=e.CompositeFilter=e.Class(e.Filter,{name:"CompositeFilter",constructor:function(e){var t=this;t.$super("constructor"),t._stack=e&&e.length?e.slice():[]},_stack:null,_meta:null,_stable:!0,dispose:function(e){var t,n=this,r=n._stack;if(n.$super("dispose"),!0===e)for(t=0;t<r.length;t++)r[t]&&r[t].dispose(e),r[t]=null;return n._stack=null,n._meta=null,n},serialize:function(){var e,t=this,n={filter:t.name,_isOn:!!t._isOn,_stable:!!t._stable,filters:[]},r=t._stack;for(e=0;e<r.length;e++)n.filters.push(r[e].serialize());return n},unserialize:function(t){var n,r,a,i,s,o=this,l=o._stack;if(t&&o.name===t.filter){if(o._isOn=!!t._isOn,o._stable=!!t._stable,i=t.filters||[],r=i.length,a=l.length,r===a&&o._stable)for(n=0;r>n;n++)l[n]=l[n].unserialize(i[n]);else{for(n=0;a>n;n++)l[n]&&l[n].dispose(!0),l[n]=null;for(l=[],n=0;r>n;n++){if(s=i[n]&&i[n].filter?e[i[n].filter]:null,!s)throw new Error('Filter "'+i[n].filter+'" could not be created');l.push((new s).unserialize(i[n]))}}o._stack=l}return o},getMeta:function(){return this._meta},setMeta:function(e){var t,n,r=this,a=r._stack;if(e&&(n=e.length)&&a.length)for(t=0;n>t;t++)a[e[t][0]].setMeta(e[t][1]);return r},stable:function(e){return arguments.length||(e=!0),this._stable=!!e,this},filters:function(e){return arguments.length?(this._stack=e.slice(),this):this._stack.slice()},push:function(){var e=n.call(arguments),t=e.length;return t&&(this._stack=a.apply(this._stack,e)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var e=n.call(arguments),t=e.length;return t&&r.apply(this._stack,[0,0].concat(e)),this},getAt:function(e){return this._stack.length>e?this._stack[e]:null},setAt:function(e,t){return this._stack.length>e?this._stack[e]=t:this._stack.push(t),this},insertAt:function(e){{var t=n.call(arguments);t.length}return argslen>1&&(t.shift(),r.apply(this._stack,[e,0].concat(t))),this},removeAt:function(e){return this._stack.splice(e,1)},remove:function(e){for(var t=this._stack.length;--t>=0;)e===this._stack[t]&&this._stack.splice(t,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(e,t,n,r){var a=this;if(a.hasMeta=!1,a._meta=[],a._isOn&&a._stack.length){var i,s,o=a._stack,l=o.length;for(i=0;l>i;i++)s=o[i],s&&s._isOn&&(e=s._apply(e,t,n,r),s.hasMeta&&a._meta.push([i,s.getMeta()]))}return a.hasMeta=a._meta.length>0,e},canRun:function(){return this._isOn&&this._stack.length},toString:function(){var e,t=arguments.length&&arguments[0].substr?arguments[0]:"  ",n=t+t,r=this._stack,a=[],i=r.length;for(e=0;i>e;e++)a.push(r[e].toString(n));return["[FILTER: "+this.name+"]","[","  "+a.join("\n  "),"]",""].join("\n")}});i.prototype.empty=i.prototype.reset,i.prototype.concat=i.prototype.push}(FILTER),!function(e){"use strict";{var t="hasOwnProperty";e.CustomFilter=e.Class(e.Filter,{name:"CustomFilter",constructor:function(e){var t=this;t.$super("constructor"),t._handler=e&&"function"==typeof e?e:null,t._params={}},_handler:null,_params:null,dispose:function(){var e=this;return e.$super("dispose"),e._handler=null,e._params=null,e},params:function(e){var n=this;if(arguments.length){for(var r in e)e[t](r)&&(n._params[r]=e[r]);return n}return n._params},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_handler:e._handler?e._handler.toString():null,_params:e._params}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._handler=null,t._handler&&(n._handler=new Function("",'"use strict"; return '+t._handler+";")()),n._params=t._params||{}),n},_apply:function(e,t,n,r){var a=this;return a._isOn&&a._handler?a._handler(a,e,t,n,r):e},canRun:function(){return this._isOn&&this._handler}})}}(FILTER),!function(e,t){"use strict";function n(e,t){var n,r,a,i,o,l=new s(20);return n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],l[0]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[1]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[2]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[3]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[4]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,n=t[5],r=t[6],a=t[7],i=t[8],o=t[9],l[5]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[6]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[7]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[8]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[9]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,n=t[10],r=t[11],a=t[12],i=t[13],o=t[14],l[10]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[11]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[12]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[13]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[14]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,n=t[15],r=t[16],a=t[17],i=t[18],o=t[19],l[15]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[16]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[17]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[18]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[19]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,l}function r(e,t,n){var r=1-n,a=new s(20);return a[0]=r*e[0]+n*t[0],a[1]=r*e[1]+n*t[1],a[2]=r*e[2]+n*t[2],a[3]=r*e[3]+n*t[3],a[4]=r*e[4]+n*t[4],a[5]=r*e[5]+n*t[5],a[6]=r*e[6]+n*t[6],a[7]=r*e[7]+n*t[7],a[8]=r*e[8]+n*t[8],a[9]=r*e[9]+n*t[9],a[10]=r*e[10]+n*t[10],a[11]=r*e[11]+n*t[11],a[12]=r*e[12]+n*t[12],a[13]=r*e[13]+n*t[13],a[14]=r*e[14]+n*t[14],a[15]=r*e[15]+n*t[15],a[16]=r*e[16]+n*t[16],a[17]=r*e[17]+n*t[17],a[18]=r*e[18]+n*t[18],a[19]=r*e[19]+n*t[19],a}var a=Math.sin,i=Math.cos,s=e.Array32F,o=e.CONSTANTS.toRad,l=(e.CONSTANTS.toDeg,e._notSupportClamp),u=e.ColorMatrixFilter=e.Class(e.Filter,{name:"ColorMatrixFilter",constructor:function(t){var n=this;n.$super("constructor"),n._matrix=t&&t.length?new s(t):null,e.useWebGL&&(n._webglInstance=e.WebGLColorMatrixFilterInstance||null)},_matrix:null,_webglInstance:null,dispose:function(){var e=this;return e.$super("dispose"),e._webglInstance=null,e._matrix=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_matrix:e._matrix}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._matrix=t._matrix),n},channel:function(n,r){r=r===t?!1:r;var a=r?1:0;switch(n){case e.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case e.CHANNEL.BLUE:return this.set([0,0,a,0,0,0,0,a,0,0,0,0,1,0,0,0,0,0,0,255]);case e.CHANNEL.GREEN:return this.set([0,a,0,0,0,0,1,0,0,0,0,a,0,0,0,0,0,0,0,255]);case e.CHANNEL.RED:default:return this.set([1,0,0,0,0,a,0,0,0,0,a,0,0,0,0,0,0,0,0,255])}},redChannel:function(t){return this.channel(e.CHANNEL.RED,t)},greenChannel:function(t){return this.channel(e.CHANNEL.GREEN,t)},blueChannel:function(t){return this.channel(e.CHANNEL.BLUE,t)},alphaChannel:function(){return this.channel(e.CHANNEL.ALPHA,!0)},maskChannel:function(t){switch(t){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(t,n){switch(t){case e.CHANNEL.ALPHA:switch(n){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case e.CHANNEL.BLUE:switch(n){case e.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.BLUE:return this;case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case e.CHANNEL.GREEN:switch(n){case e.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this;case e.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case e.CHANNEL.RED:default:switch(n){case e.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case e.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this}}},desaturate:function(){return this.set([e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,0,0,0,1,0])},colorize:function(n,r){var a,i,s,o;return r===t&&(r=1),a=.00392156862745098*(n>>16&255),i=.00392156862745098*(n>>8&255),s=.00392156862745098*(255&n),o=1-r,this.set([o+r*a*e.LUMA[0],r*a*e.LUMA[1],r*a*e.LUMA[2],0,0,r*i*e.LUMA[0],o+r*i*e.LUMA[1],r*i*e.LUMA[2],0,0,r*s*e.LUMA[0],r*s*e.LUMA[1],o+r*s*e.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(t){var n,r,a,i;return n=1-t,r=n*e.LUMA[0],a=n*e.LUMA[1],i=n*e.LUMA[2],this.set([r+t,a,i,0,0,r,a+t,i,0,0,r,a,i+t,0,0,0,0,0,1,0])},contrast:function(e,n,r){return n===t&&(n=e),r===t&&(r=e),e+=1,n+=1,r+=1,this.set([e,0,0,0,128*(1-e),0,n,0,0,128*(1-n),0,0,r,0,128*(1-r),0,0,0,1,0])},brightness:function(e,n,r){return n===t&&(n=e),r===t&&(r=e),this.set([1,0,0,0,e,0,1,0,0,n,0,0,1,0,r,0,0,0,1,0])},adjustHue:function(t){t*=o;var n=i(t),r=a(t);return this.set([e.LUMA[0]+n*(1-e.LUMA[0])+r*-e.LUMA[0],e.LUMA[1]+n*-e.LUMA[1]+r*-e.LUMA[1],e.LUMA[2]+n*-e.LUMA[2]+r*(1-e.LUMA[2]),0,0,e.LUMA[0]+n*-e.LUMA[0]+.143*r,e.LUMA[1]+n*(1-e.LUMA[1])+.14*r,e.LUMA[2]+n*-e.LUMA[2]+r*-.283,0,0,e.LUMA[0]+n*-e.LUMA[0]+r*-(1-e.LUMA[0]),e.LUMA[1]+n*-e.LUMA[1]+r*e.LUMA[1],e.LUMA[2]+n*(1-e.LUMA[2])+r*e.LUMA[2],0,0,0,0,0,1,0])},average:function(e,n,r){return e===t&&(e=.3333),n===t&&(n=.3333),r===t&&(r=.3334),this.set([e,n,r,0,0,e,n,r,0,0,e,n,r,0,0,0,0,0,1,0])},quickContrastCorrection:function(e){return e===t&&(e=1.2),this.set([e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0])},sepia:function(e){return e===t&&(e=.5),e>1?e=1:0>e&&(e=0),this.set([1-.607*e,.769*e,.189*e,0,0,.349*e,1-.314*e,.168*e,0,0,.272*e,.534*e,1-.869*e,0,0,0,0,0,1,0])},sepia2:function(n){return n===t&&(n=10),n>100&&(n=100),n*=2.55,this.set([e.LUMA[0],e.LUMA[1],e.LUMA[2],0,40,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,20,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,-n,0,0,0,1,0])},threshold:function(n,r){return r===t&&(r=256),this.set([e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,0,0,0,1,0])},threshold_rgb:function(e,n){return n===t&&(n=256),this.set([n,0,0,0,-(n-1)*e,0,n,0,0,-(n-1)*e,0,0,n,0,-(n-1)*e,0,0,0,1,0])},threshold_alpha:function(e,n){return e===t&&(e=.5),n===t&&(n=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,n,-n*e])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(e,t){return this._matrix=this._matrix?r(this._matrix,e.getMatrix(),t):new s(e.getMatrix()),this},set:function(e){return this._matrix=this._matrix?n(this._matrix,new s(e)):new s(e),this},reset:function(){return this._matrix=null,this},combineWith:function(e){return this.set(e.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(e){return this._matrix=new s(e),this},_apply:function(e){var t=this;if(t._isOn&&t._matrix){var n,r,a,i,s,o,l,u,c,h,f,d,m,p,_,g,v,y,w,A,C,b=e.length,M=t._matrix,I=(b>>2)%4;for(n=0;b>n;n+=16)y=e[n],w=e[n+1],A=e[n+2],C=e[n+3],r=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],a=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],i=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],s=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+4],w=e[n+5],A=e[n+6],C=e[n+7],o=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],l=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],u=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],c=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+8],w=e[n+9],A=e[n+10],C=e[n+11],h=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],f=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],d=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],m=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+12],w=e[n+13],A=e[n+14],C=e[n+15],p=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],_=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],g=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],v=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],e[n]=~~r,e[n+1]=~~a,e[n+2]=~~i,e[n+3]=~~s,e[n+4]=~~o,e[n+5]=~~l,e[n+6]=~~u,e[n+7]=~~c,e[n+8]=~~h,e[n+9]=~~f,e[n+10]=~~d,e[n+11]=~~m,e[n+12]=~~p,e[n+13]=~~_,e[n+14]=~~g,e[n+15]=~~v;if(I)for(I<<=2,n=b-I;b>n;n+=4)y=e[n],w=e[n+1],A=e[n+2],C=e[n+3],r=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],a=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],i=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],s=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],e[n]=~~r,e[n+1]=~~a,e[n+2]=~~i,e[n+3]=~~s}return e},canRun:function(){return this._isOn&&this._matrix}});u.prototype.grayscale=u.prototype.desaturate,u.prototype.rotateHue=u.prototype.adjustHue,u.prototype.thresholdRgb=u.prototype.threshold_rgb,u.prototype.thresholdAlpha=u.prototype.threshold_alpha,l&&(u.prototype._apply=function(e){var t=this;if(t._isOn&&t._matrix){var n,r,a,i,s,o,l,u,c,h,f,d,m,p,_,g,v,y,w,A,C,b=e.length,M=t._matrix,I=(b>>2)%4;for(n=0;b>n;n+=16)y=e[n],w=e[n+1],A=e[n+2],C=e[n+3],r=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],a=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],i=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],s=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+4],w=e[n+5],A=e[n+6],C=e[n+7],o=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],l=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],u=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],c=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+8],w=e[n+9],A=e[n+10],C=e[n+11],h=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],f=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],d=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],m=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+12],w=e[n+13],A=e[n+14],C=e[n+15],p=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],_=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],g=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],v=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],r=0>r?0:r>255?255:r,a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s,o=0>o?0:o>255?255:o,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,p=0>p?0:p>255?255:p,_=0>_?0:_>255?255:_,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,e[n]=~~r,e[n+1]=~~a,e[n+2]=~~i,e[n+3]=~~s,e[n+4]=~~o,e[n+5]=~~l,e[n+6]=~~u,e[n+7]=~~c,e[n+8]=~~h,e[n+9]=~~f,e[n+10]=~~d,e[n+11]=~~m,e[n+12]=~~p,e[n+13]=~~_,e[n+14]=~~g,e[n+15]=~~v;if(I)for(I<<=2,n=b-I;b>n;n+=4)y=e[n],w=e[n+1],A=e[n+2],C=e[n+3],r=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],a=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],i=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],s=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],r=0>r?0:r>255?255:r,a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s,e[n]=~~r,e[n+1]=~~a,e[n+2]=~~i,e[n+3]=~~s}return e})}(FILTER),!function(e,t){"use strict";var n=e.ImArrayCopy,r=e.Color.clampPixel,a=function(e){var t=new n(256),r=0;if(e)for(;256>r;)t[r]=255-r,r++;else for(;256>r;)t[r]=r,r++;return t},i=function(e){for(var t=new n(256),r=0;256>r;)t[r]=e,r++;return t},s=function(e){return e?new n(e):null},o=Math.pow,l=Math.exp,u=1/255,c=a(),h=a(1),f=e.TableLookupFilter=e.Class(e.Filter,{name:"TableLookupFilter",constructor:function(e,t,n,r){var a=this;a.$super("constructor"),a._tableR=e||null,a._tableG=t||a._tableR,a._tableB=n||a._tableG,a._tableA=r||null},_tableR:null,_tableG:null,_tableB:null,_tableA:null,dispose:function(){var e=this;return e.$super("dispose"),e._tableR=null,e._tableG=null,e._tableB=null,e._tableA=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_tableR:e._tableR,_tableG:e._tableG,_tableB:e._tableB,_tableA:e._tableA}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._tableR=t._tableR,n._tableG=t._tableG,n._tableB=t._tableB,n._tableA=t._tableA),n},thresholds:function(e,t,a){e.length||(e=[e]),t||(t=e),a||(a=t);var i,s,o=e.length,l=o+1,u=t.length,c=u+1,h=a.length,f=h+1,d=new n(256),m=new n(l),p=new n(256),_=new n(c),g=new n(256),v=new n(f),y=255/(l-1),w=255/(c-1),A=255/(f-1);for(i=0;l>i;)m[i]=~~(y*i),i++;for(e[0]=~~(255*e[0]),i=1;o>i;)e[i]=e[i-1]+~~(255*e[i]),i++;for(i=0;c>i;)_[i]=~~(w*i),i++;for(t[0]=~~(255*t[0]),i=1;u>i;)t[i]=t[i-1]+~~(255*t[i]),i++;for(i=0;f>i;)v[i]=~~(A*i),i++;for(a[0]=~~(255*a[0]),i=1;h>i;)a[i]=a[i-1]+~~(255*a[i]),i++;for(i=0;256>i;){for(s=0;o>s&&i>e[s];)s++;for(d[i]=r(m[s]),s=0;u>s&&i>t[s];)s++;for(p[i]=r(_[s]),s=0;h>s&&i>a[s];)s++;g[i]=r(v[s]),i++}return this.set(d,p,g)},threshold:function(e,t,n){return e=e||.5,t=t||e,n=n||t,this.thresholds([e],[t],[n])},quantize:function(e){e===t&&(e=64),2>e&&(e=2);var a,i=new n(256),s=new n(e),o=255/(e-1),l=e/256;for(a=0;e>a;)s[a]=~~(o*a),a++;for(a=0;256>a;)i[a]=r(s[~~(l*a)]),a++;return this.set(i)},binarize:function(){return this.quantize(2)},solarize:function(e){e===t&&(e=.5);var a,i,s=0,o=new n(256),l=2/255;for(s=0;256>s;)a=l*s,i=a>e?255-255*a:255*a-255,o[s]=~~r(i),s++;return this.set(o)},solarize2:function(e){e===t&&(e=.5),e=1-e;var a,i,s=0,o=new n(256),l=2/255;for(s=0;256>s;)a=l*s,i=e>a?255-255*a:255*a-255,o[s]=~~r(i),s++;return this.set(o)},solarizeInverse:function(e){e===t&&(e=.5),e*=256;var r=0,a=new n(256);for(r=0;256>r;)a[r]=r>e?255-r:r,r++;return this.set(a)},invert:function(){return this.set(h)},mask:function(e){var t=0,a=e>>16&255,i=e>>8&255,s=255&e;for(tR=new n(256),tG=new n(256),tB=new n(256),t=0;256>t;)tR[t]=r(t&a),tG[t]=r(t&i),tB[t]=r(t&s),t++;return this.set(tR,tG,tB)},replace:function(e,t){if(e==t)return this;var n=e>>16&255,r=e>>8&255,a=255&e,i=t>>16&255,o=t>>8&255,l=255&t,u=s(c),h=s(c),f=s(c);return u[n]=i,h[r]=o,f[a]=l,this.set(u,h,f)},extract:function(t,n,a){if(!n||!n.length)return this;a=a||0;var s,o,l=a>>16&255,u=a>>8&255,c=255&a,h=i(l),f=i(u),d=i(c);switch(t){case e.CHANNEL.BLUE:for(s=n[0],o=n[1];o>=s;)d[s]=r(s),s++;break;case e.CHANNEL.GREEN:for(s=n[0],o=n[1];o>=s;)f[s]=r(s),s++;break;case e.CHANNEL.RED:default:for(s=n[0],o=n[1];o>=s;)h[s]=r(s),s++}return this.set(h,f,d)},gammaCorrection:function(e,t,a){e=e||1,t=t||e,a=a||t,e=1/e,t=1/t,a=1/a;for(var i=new n(256),s=new n(256),l=new n(256),c=0;256>c;)i[c]=r(~~(255*o(u*c,e))),s[c]=r(~~(255*o(u*c,t))),l[c]=r(~~(255*o(u*c,a))),c++;return this.set(i,s,l)},exposure:function(e){e===t&&(e=1);var a=0,i=new n(256);for(a=0;256>a;)i[a]=r(~~(255*(1-l(-e*a*u)))),a++;return this.set(i)},set:function(e,t,n){if(!e)return this;t=t||e,n=n||t;var i,o,l,u,c,h=this._tableR||a(),f=s(h);if(t&&n){for(i=this._tableG||s(h),o=this._tableB||s(i),l=s(i),u=s(o),c=0;256>c;)h[c]=r(e[r(f[c])]),i[c]=r(t[r(l[c])]),o[c]=r(n[r(u[c])]),c++;this._tableR=h,this._tableG=i,this._tableB=o}else{for(c=0;256>c;)h[c]=r(e[r(f[c])]),c++;this._tableR=h,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=this._tableG=this._tableB=this._tableA=null,this},combineWith:function(e){return this.set(e.getTable(0),e.getTable(1),e.getTable(2))},getTable:function(t){switch(t=t||e.CHANNEL.RED){case e.CHANNEL.ALPHA:return this._tableA;case e.CHANNEL.BLUE:return this._tableB;case e.CHANNEL.GREEN:return this._tableG;case e.CHANNEL.RED:default:return this._tableR}},setTable:function(t,n){switch(n=n||e.CHANNEL.RED){case e.CHANNEL.ALPHA:return this._tableA=t,this;case e.CHANNEL.BLUE:return this._tableB=t,this;case e.CHANNEL.GREEN:return this._tableG=t,this;case e.CHANNEL.RED:default:return this._tableR=t,this}},_apply:function(e){var t=this;if(!t._isOn||!t._tableR)return e;var n,r,a,i,s,o=e.length,l=(o>>2)%4,u=t._tableR,c=t._tableG,h=t._tableB,f=t._tableA;if(f){for(n=0;o>n;n+=16)r=e[n],a=e[n+1],i=e[n+2],s=e[n+3],e[n]=u[r],e[n+1]=c[a],e[n+2]=h[i],e[n+3]=f[s],r=e[n+4],a=e[n+5],i=e[n+6],s=e[n+7],e[n+4]=u[r],e[n+5]=c[a],e[n+6]=h[i],e[n+7]=f[s],r=e[n+8],a=e[n+9],i=e[n+10],s=e[n+11],e[n+8]=u[r],e[n+9]=c[a],e[n+10]=h[i],e[n+11]=f[s],r=e[n+12],a=e[n+13],i=e[n+14],s=e[n+15],e[n+12]=u[r],e[n+13]=c[a],e[n+14]=h[i],e[n+15]=f[s];if(l)for(l<<=2,n=o-l;o>n;n+=4)r=e[n],a=e[n+1],i=e[n+2],s=e[n+3],e[n]=u[r],e[n+1]=c[a],e[n+2]=h[i],e[n+3]=f[s]}else{for(n=0;o>n;n+=16)r=e[n],a=e[n+1],i=e[n+2],e[n]=u[r],e[n+1]=c[a],e[n+2]=h[i],r=e[n+4],a=e[n+5],i=e[n+6],e[n+4]=u[r],e[n+5]=c[a],e[n+6]=h[i],r=e[n+8],a=e[n+9],i=e[n+10],e[n+8]=u[r],e[n+9]=c[a],e[n+10]=h[i],r=e[n+12],a=e[n+13],i=e[n+14],e[n+12]=u[r],e[n+13]=c[a],e[n+14]=h[i];if(l)for(l<<=2,n=o-l;o>n;n+=4)r=e[n],a=e[n+1],i=e[n+2],e[n]=u[r],e[n+1]=c[a],e[n+2]=h[i]}return e},canRun:function(){return this._isOn&&this._tableR}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(FILTER),!function(e){"use strict";{var t=(e.ImArray,e.ImArrayCopy),n=e.Array16I,r=Math.min,a=(Math.max,Math.floor);e.DisplacementMapFilter=e.Class(e.Filter,{name:"DisplacementMapFilter",constructor:function(e){var t=this;t.$super("constructor"),e&&t.setMap(e)},_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:e.MODE.CLAMP,dispose:function(){var e=this;return e.$super("dispose"),e._map=null,e.map=null,e.scaleX=null,e.scaleY=null,e.startX=null,e.startY=null,e.componentX=null,e.componentY=null,e.color=null,e.red=null,e.green=null,e.blue=null,e.alpha=null,e.mode=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_map:e._map,scaleX:e.scaleX,scaleY:e.scaleY,startX:e.startX,startY:e.startY,componentX:e.componentX,componentY:e.componentY,color:e.color,red:e.red,green:e.green,blue:e.blue,alpha:e.alpha,mode:e.mode}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n.map=null,n._map=t._map,n.scaleX=t.scaleX,n.scaleY=t.scaleY,n.startX=t.startX,n.startY=t.startY,n.componentX=t.componentX,n.componentY=t.componentY,n.color=t.color,n.red=t.red,n.green=t.green,n.blue=t.blue,n.alpha=t.alpha,n.mode=t.mode),n},reset:function(){var e=this;return e._map=null,e.map=null,e},getMap:function(){return this.map},setMap:function(e){var t=this;return e&&(t.map=e,t._map={data:e.getData(),width:e.width,height:e.height}),t},setColor:function(e){var t=this;return t.color=e,t.alpha=e>>24&255,t.red=e>>16&255,t.green=e>>8&255,t.blue=255&e,t},_apply:function(i,s,o){var l=this;if(!l._isOn||!l._map)return i;var u,c,h,f,d,m,p,_,g,v,y,w,A,C,b,M,I,R,E,L,x,N,F,O,T,S,k,D,P,G,U,H=.00390625*l.scaleX,X=.00390625*l.scaleY,B=l.componentX,Y=l.componentY,W=l.alpha,q=l.red,z=l.green,$=l.blue,j=l.mode,K=e.MODE.IGNORE,J=(e.MODE.CLAMP,e.MODE.COLOR),Q=e.MODE.WRAP;for(u=l._map.data,c=l._map.width,h=l._map.height,f=u.length>>2,m=r(c,s),p=r(h,o),D=i.length,S=m*p<<2,k=D>>2,g=a(l.startX*(s-1)),_=a(l.startY*(o-1)),v=_*s,y=-g,w=-_,A=s-g-1,C=o-_-1,d=new n(f<<1),P=new t(i),M=0,I=0,R=0,E=0,b=0;f>b;b++,M+=2,I++)I>=c&&(I=0,R++,E+=c),F=I+E<<2,d[M]=a((u[F+B]-128)*H),d[M+1]=a((u[F+Y]-128)*X);for(I=0,R=0,E=0,L=0,b=0;S>b;b+=4,I++)if(I>=m&&(I=0,R++,E+=s,L+=c),!(w>R||R>C||y>I||I>A)){if(N=I+g,x=R+_,O=N+E+v<<2,M=I+L<<1,G=N+d[M],U=x+d[M+1],U>=o||0>U||G>=s||0>G){if(j==K)continue;if(j==J){i[O]=q,i[O+1]=z,i[O+2]=$,i[O+3]=W;continue}j==Q?(U>C?U-=o:0>U&&(U+=o),G>A?G-=s:0>G&&(G+=s)):(U>C?U=C:0>U&&(U=0),G>A?G=A:0>G&&(G=0))}T=G+U*s<<2,i[O]=P[T],i[O+1]=P[T+1],i[O+2]=P[T+2],i[O+3]=P[T+3]}return i},canRun:function(){return this._isOn&&(this._map||this.map)}})}}(FILTER),!function(FILTER,undef){"use strict";var IMG=FILTER.ImArray,IMGcopy=FILTER.ImArrayCopy,PI=FILTER.CONSTANTS.PI,DoublePI=FILTER.CONSTANTS.PI2,HalfPI=FILTER.CONSTANTS.PI_2,ThreePI2=1.5*PI,Sqrt=Math.sqrt,Atan2=Math.atan2,Atan=Math.atan,Sin=Math.sin,Cos=Math.cos,Floor=Math.floor,Asin=Math.asin,Tan=Math.tan,Abs=Math.abs,Max=Math.max,toRad=FILTER.CONSTANTS.toRad,Maps,GeometricMapFilter=FILTER.GeometricMapFilter=FILTER.Class(FILTER.Filter,{name:"GeometricMapFilter",constructor:function(e){var t=this;t.$super("constructor"),e&&t.generic(e)},_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,dx:0,dy:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:FILTER.MODE.CLAMP,dispose:function(){var e=this;return e.$super("dispose"),e._map=null,e._mapName=null,e.inverseTransform=null,e.matrix=null,e.centerX=null,e.centerY=null,e.dx=null,e.dy=null,e.angle=null,e.radius=null,e.wavelength=null,e.amplitude=null,e.phase=null,e.xAmplitude=null,e.yAmplitude=null,e.xWavelength=null,e.yWavelength=null,e.mode=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_mapName:e._mapName,inverseTransform:e.inverseTransform?e.inverseTransform.toString():null,matrix:e.matrix,centerX:e.centerX,centerY:e.centerY,dx:e.dx,dy:e.dy,angle:e.angle,radius:e.radius,wavelength:e.wavelength,amplitude:e.amplitude,phase:e.phase,xAmplitude:e.xAmplitude,yAmplitude:e.yAmplitude,xWavelength:e.xWavelength,yWavelength:e.yWavelength,mode:e.mode}}
},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self.inverseTransform=null,self.matrix=params.matrix,self.centerX=params.centerX,self.centerY=params.centerY,self.dx=params.dx,self.dy=params.dy,self.angle=params.angle,self.radius=params.radius,self.wavelength=params.wavelength,self.amplitude=params.amplitude,self.phase=params.phase,self.xAmplitude=params.xAmplitude,self.yAmplitude=params.yAmplitude,self.xWavelength=params.xWavelength,self.yWavelength=params.yWavelength,self.mode=params.mode,params.inverseTransform&&(self.inverseTransform=eval('(function(){ "use strict"; return '+params.inverseTransform+"})();")),self._mapName=params._mapName,self._map=null,self._mapName&&Maps[self._mapName]&&(self._map=Maps[self._mapName])),self},generic:function(e){var t=this;return e&&(t.inverseTransform=e,t._mapName="generic",t._map=Maps.generic),t},affine:function(e){var t=this;return e&&(t.matrix=e,t._mapName="affine",t._map=Maps.affine),t},flipX:function(){var e=this;return e._mapName="flipX",e._map=Maps.flipX,e},flipY:function(){var e=this;return e._mapName="flipY",e._map=Maps.flipY,e},flipXY:function(){var e=this;return e._mapName="flipXY",e._map=Maps.flipXY,e},rotateCW:function(){var e=this;return e._mapName="rotateCW",e._map=Maps.rotateCW,e},rotateCCW:function(){var e=this;return e._mapName="rotateCCW",e._map=Maps.rotateCCW,e},polar:function(e,t){var n=this;return n.centerX=e||0,n.centerY=t||0,n._mapName="polar",n._map=Maps.polar,n},cartesian:function(e,t){var n=this;return n.centerX=e||0,n.centerY=t||0,n._mapName="cartesian",n._map=Maps.cartesian,n},twirl:function(e,t,n,r){var a=this;return a.angle=e||0,a.radius=t||0,a.centerX=n||0,a.centerY=r||0,a._mapName="twirl",a._map=Maps.twirl,a},sphere:function(e,t,n){var r=this;return r.radius=e||0,r.centerX=t||0,r.centerY=n||0,r._mapName="sphere",r._map=Maps.sphere,r},ripple:function(e,t,n,r,a,i){var s=this;return s.radius=e!==undef?e:50,s.centerX=a||0,s.centerY=i||0,s.wavelength=t!==undef?t:16,s.amplitude=n!==undef?n:10,s.phase=r||0,s._mapName="ripple",s._map=Maps.ripple,s},shift:function(e,t){var n=this;return n.dx=e!==undef?e:0,n.dy=t!==undef?t:n.dx,n._mapName="shift",n._map=Maps.shift,n},reset:function(){var e=this;return e._mapName=null,e._map=null,e},getMap:function(){return this._map},setMap:function(e){var t=this;return t._mapName=null,t._map=e,t},_apply:function(e,t,n,r){var a=this;return a._isOn&&a._map?a._map(a,e,t,n,r):e},canRun:function(){return this._isOn&&this._map}});GeometricMapFilter.prototype.translate=GeometricMapFilter.prototype.shift,Maps={generic:function(e,t,n,r){var a,i,s,o,l,u,c,h=t.length,f=new IMG(h),d=e.inverseTransform,m=e.mode,p=FILTER.MODE.CLAMP,_=FILTER.MODE.WRAP;for(a=0,i=0,s=0;h>s;s+=4,a++){if(a>=n&&(a=0,i++),l=d([a,i],n,r),u=~~l[0],c=~~l[1],0>u||u>=n||0>c||c>=r)switch(m){case _:c>=r?c-=r:0>c&&(c+=r),u>=n?u-=n:0>u&&(u+=n);break;case p:default:c>=r?c=r-1:0>c&&(c=0),u>=n?u=n-1:0>u&&(u=0)}o=u+c*n<<2,f[s]=t[o],f[s+1]=t[o+1],f[s+2]=t[o+2],f[s+3]=t[o+3]}return f},affine:function(e,t,n){var r,a,i,s,o,l,u,c,h,f=t.length,d=f>>2,m=new IMG(f),p=e.matrix,_=p[0],g=p[1],v=p[3],y=p[4],w=p[2],A=p[5],C=e.mode,b=FILTER.MODE.CLAMP,M=FILTER.MODE.WRAP,I=n-1,R=d-n;for(r=0,a=0,o=A*n,l=v*n,u=y*n,i=0;f>i;i+=4,r++){if(r>=n&&(r=0,a++),c=~~(_*r+g*a+w),h=~~(l*r+u*a+o),0>c||c>I||0>h||h>R)switch(C){case M:h>R?h-=d:0>h&&(h+=d),c>=n?c-=n:0>c&&(c+=n);break;case b:default:h>R?h=R:0>h&&(h=0),c>I?c=I:0>c&&(c=0)}s=c+h<<2,m[i]=t[s],m[i+1]=t[s+1],m[i+2]=t[s+2],m[i+3]=t[s+3]}return m},shift:function(e,t,n,r){var a,i,s,o,l,u=t.length,c=new IMG(u),h=-e.dx,f=-e.dy;for(0>h&&(h+=n),0>f&&(f+=r),a=0,i=0,s=0,o=0;u>o;o+=4,a++)a>=n&&(a=0,i++,s+=n),l=(a+h)%n+(i+f)%r*n<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},flipX:function(e,t,n){var r,a,i,s,o,l=t.length,u=new IMG(l);for(r=0,a=0,i=0,s=0;l>s;s+=4,r++)r>=n&&(r=0,a++,i+=n),o=n-1-r+i<<2,u[s]=t[o],u[s+1]=t[o+1],u[s+2]=t[o+2],u[s+3]=t[o+3];return u},flipY:function(e,t,n,r){var a,i,s,o,l,u=t.length,c=new IMG(u);for(a=0,i=0,s=(r-1)*n,o=0;u>o;o+=4,a++)a>=n&&(a=0,i++,s-=n),l=a+s<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},flipXY:function(e,t,n,r){var a,i,s,o,l,u,c=t.length,h=new IMG(c);for(a=0,i=0,o=(r-1)*n,l=0;c>l;l+=4,a++)a>=n&&(a=0,i++,s+=n,o-=n),u=n-1-a+o<<2,h[l]=t[u],h[l+1]=t[u+1],h[l+2]=t[u+2],h[l+3]=t[u+3];return h},rotateCW:function(e,t,n){var r,a,i,s,o,l=t.length,u=new IMG(l),c=l>>2;for(r=0,a=0,i=c-1,s=0;l>s;s+=4,r++,i-=n)r>=n&&(r=0,i=c-1,a++),o=a+i<<2,u[s]=t[o],u[s+1]=t[o+1],u[s+2]=t[o+2],u[s+3]=t[o+3];return u},rotateCCW:function(e,t,n){var r,a,i,s,o,l=t.length,u=new IMG(l);for(r=0,a=0,i=0,s=0;l>s;s+=4,r++,i+=n)r>=n&&(r=0,i=0,a++),o=n-1-a+i<<2,u[s]=t[o],u[s+1]=t[o+1],u[s+2]=t[o+2],u[s+3]=t[o+3];return u},twirl:function(e,t,n,r){if(0>=e.radius)return t;var a,i,s,o,l,u,c,h,f=t.length,d=new IMGcopy(t),m=e.centerX,p=e.centerY,_=e.angle,g=e.radius,v=e.mode,y=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,A=_/g,C=n-1,b=r-1;for(m=Floor(m*(n-1)),p=Floor(p*(r-1)),a=0,i=0,s=0;f>s;s+=4,a++)if(a>=n&&(a=0,i++),u=a-m,c=i-p,l=Sqrt(u*u+c*c),g>l){if(h=Atan2(c,u)+A*(g-l),u=~~(m+l*Cos(h)),c=~~(p+l*Sin(h)),0>u||u>C||0>c||c>b)switch(v){case w:c>b?c-=r:0>c&&(c+=r),u>C?u-=n:0>u&&(u+=n);break;case y:default:c>b?c=b:0>c&&(c=0),u>C?u=C:0>u&&(u=0)}o=u+c*n<<2,t[s]=d[o],t[s+1]=d[o+1],t[s+2]=d[o+2],t[s+3]=d[o+3]}return t},sphere:function(e,t,n,r){if(0>=e.radius)return t;var a,i,s,o,l,u,c,h,f,d,m,p,_,g=t.length,v=new IMGcopy(t),y=e.centerX,w=e.centerY,A=e.radius,C=e.mode,b=FILTER.MODE.CLAMP,M=FILTER.MODE.WRAP,I=A*A,R=.555556,E=1-R,L=n-1,x=r-1;for(y=Floor(y*(n-1)),w=Floor(w*(r-1)),a=0,i=0,s=0;g>s;s+=4,a++)if(a>=n&&(a=0,i++),l=a-y,u=i-w,p=l*l,_=u*u,c=p+_,I>c){if(d=I-c,m=Sqrt(d),h=Asin(l/Sqrt(p+d))*E,f=Asin(u/Sqrt(_+d))*E,l=~~(a-m*Tan(h)),u=~~(i-m*Tan(f)),0>l||l>L||0>u||u>x)switch(C){case M:u>x?u-=r:0>u&&(u+=r),l>L?l-=n:0>l&&(l+=n);break;case b:default:u>x?u=x:0>u&&(u=0),l>L?l=L:0>l&&(l=0)}o=l+u*n<<2,t[s]=v[o],t[s+1]=v[o+1],t[s+2]=v[o+2],t[s+3]=v[o+3]}return t},ripple:function(e,t,n,r){if(0>=e.radius)return t;var a,i,s,o,l,u,c,h,f,d,m,p=t.length,_=new IMGcopy(t),g=FILTER.MODE.CLAMP,v=FILTER.MODE.WRAP,y=n-1,w=r-1,A=e.centerX,C=e.centerY,b=e.radius,M=e.mode,I=b*b,R=e.wavelength,E=e.amplitude,L=e.phase;for(A=Floor(A*(n-1)),C=Floor(C*(r-1)),a=0,i=0,s=0;p>s;s+=4,a++)if(a>=n&&(a=0,i++),u=a-A,c=i-C,d=u*u,m=c*c,f=d+m,I>f){if(l=Sqrt(f),h=E*Sin(l/R*Math.PI*2-L),h*=(b-l)/b,l&&(h*=R/l),u=~~(a+u*h),c=~~(i+c*h),0>u||u>y||0>c||c>w)switch(M){case v:c>w?c-=r:0>c&&(c+=r),u>y?u-=n:0>u&&(u+=n);break;case g:default:c>w?c=w:0>c&&(c=0),u>y?u=y:0>u&&(u=0)}o=u+c*n<<2,t[s]=_[o],t[s+1]=_[o+1],t[s+2]=_[o+2],t[s+3]=_[o+3]}return t},polar:function(e,t,n,r){var a,i,s,o,l,u,c,h,f,d,m,p,_=t.length,g=new IMGcopy(t),v=FILTER.MODE.CLAMP,y=FILTER.MODE.WRAP,w=n-1,A=r-1,C=0,b=e.mode;for(m=~~(.5*n+.5),p=~~(.5*r+.5),d=Max(p,m),a=0,i=0,s=0;_>s;s+=4,a++){if(a>=n&&(a=0,i++),o=a-m,l=i-p,f=0,o>=0?l>0?(f=PI-Atan(o/l),C=Sqrt(o*o+l*l)):0>l?(f=Atan(o/l),C=Sqrt(o*o+l*l)):(f=HalfPI,C=o):0>o&&(0>l?(f=DoublePI-Atan(o/l),C=Sqrt(o*o+l*l)):l>0?(f=PI+Atan(o/l),C=Sqrt(o*o+l*l)):(f=ThreePI2,C=-o)),u=n-1-(n-1)/DoublePI*f,c=r*C/d,0>u||u>w||0>c||c>A)switch(b){case y:c>A?c-=r:0>c&&(c+=r),u>w?u-=n:0>u&&(u+=n);break;case v:default:c>A?c=A:0>c&&(c=0),u>w?u=w:0>u&&(u=0)}h=~~(u+.5)+~~(c+.5)*n<<2,t[s]=g[h],t[s+1]=g[h+1],t[s+2]=g[h+2],t[s+3]=g[h+3]}return t},cartesian:function(e,t,n,r){var a,i,s,o,l,u,c,h,f,d,m,p,_,g=t.length,v=new IMGcopy(t),y=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,A=n-1,C=r-1,b=0,M=e.mode;for(p=~~(.5*n+.5),_=~~(.5*r+.5),m=Max(_,p),a=0,i=0,s=0;g>s;s+=4,a++){if(a>=n&&(a=0,i++),f=a/n*DoublePI,d=f>=ThreePI2?DoublePI-f:f>=PI?f-PI:f>=HalfPI?PI-f:f,b=m*(i/r),c=-b*Sin(d),h=b*Cos(d),f>=ThreePI2?(o=p-c,l=_-h):f>=PI?(o=p-c,l=_+h):f>=HalfPI?(o=p+c,l=_+h):(o=p+c,l=_-h),0>o||o>A||0>l||l>C)switch(M){case w:l>C?l-=r:0>l&&(l+=r),o>A?o-=n:0>o&&(o+=n);break;case y:default:l>C?l=C:0>l&&(l=0),o>A?o=A:0>o&&(o=0)}u=~~(o+.5)+~~(l+.5)*n<<2,t[s]=v[u],t[s+1]=v[u+1],t[s+2]=v[u+2],t[s+3]=v[u+3]}return t}}}(FILTER),!function(e,t){"use strict";function n(e,t,n,r){var a,i=e.length,s=new w(e.length);for(n=n||1,r=r||1,a=0;i>a;)s[a]=n*e[a]+r*t[a],a++;return s}function r(e,t){var n,r,a,i=e.length,s=[],o=0;for(n=0;i>n;n++)for(r=0;i>r;r++)a=e[n]*t[r],o+=a,s.push(a);return{kernel:s,sum:o}}function a(e){var t,n=new Array(e);for(t=0;e>t;)n[t]=1,t++;return n}function i(e){var t,n,r,a,i=I.length;if(e--,i>e)t=new w(I[e]);else for(t=new w(I[i-1]);e>=i;){for(n=t,t=new w(n.length+1),t[0]=1,r=0,a=n.length-1;a>r;r++)t[r+1]=n[r]+n[r+1];t[n.length]=1,40>i&&I.push(new Array(t)),i++}return t}function s(e){var t,n=e>>1,r=-n,a=new Array(e);for(t=0;e>t;)a[t]=r,r++,t++;return a}function o(e){var t=i(e);return r(t,t)}function l(e,t){var n=i(e),a=s(e);return 1==t?r(a.reverse(),n):r(n,a)}function u(e,t){var n=a(e),i=s(e);return 1==t?r(i.reverse(),n):r(n,i)}function c(e,t,n){t=t||1,n=n||t;var r,a=e*e,i=a>>1,s=new w(a);for(r=0;a>r;)s[r]=t,r++;return s[i]=n,s}function h(e,t,n,r){var a,i,s,o,l,u=e*e,c=e>>1,h=u>>1,f=new w(u);for(o=0,a=0;c>=a;a++){for(i=0,l=0,s=0;c>=s;s++)f[h+a+i]=o+l,f[h-a-i]=-o-l,f[h-a+i]=-o+l,f[h+a-i]=o-l,i+=e,l+=n;o+=t}return f[h]=r||1,f}function f(e,t,n,r){var a,i,s,o,l,u,c=e*e,h=e>>1,f=c>>1,d=new w(c),m=new w(c),p=1/e,g=1e-8;for(_(t)>g?(l=1,u=n/t):(l=t/n,u=1),a=0,s=0,o=0,i=u*e;h>=a;)m[f+a]=~~(f+s+o+.5),m[f-a]=~~(f-s-o+.5),a++,s+=l,o+=i;for(a=0;h>=a;)d[m[f+a]]=d[m[f-a]]=p,a++;return d[f]=r||1,d}function d(e,t,n,r,a,i,s,o,l,u){var c,h,f,d,m,p,_,g,v,y,w,b,I,R,E,L,x,N,F,O,T,S,k,D,P,G,U,H,X,B,Y,W,q,z,$,j,K,J,Q,V,Z,et,tt,nt,rt,at,it,st=e.length,ot=st>>2,lt=i,ut=s;if(g=lt*ut,p=lt>>1,_=t*(ut>>1),w=-p-1,I=-_-t,b=p,R=_,B=0,W=t-1,Y=0,q=ot-t,h=(ot<<1)+ot,y=(t<<1)+t,u=u||1,it=0,a)for(O=r[0],T=r[g>>1],S=T-O,k=a[0],D=a[g>>1],P=D-k;u>it;){for(v=new A(st),c=new C(h),E=0,L=0,f=d=m=0,x=0;t>x;x++,E+=4,L+=3)f+=e[E],d+=e[E+1],m+=e[E+2],c[L]=f,c[L+1]=d,c[L+2]=m;for(L=0,x=0,f=d=m=0,E=y+t;st>E;E+=4,L+=3,x++)x>=t&&(x=0,f=d=m=0),f+=e[E],d+=e[E+1],m+=e[E+2],c[L+y]=c[L]+f,c[L+y+1]=c[L+1]+d,c[L+y+2]=c[L+2]+m;for(x=0,N=0,F=0,E=0;st>E;E+=4,x++)x>=t&&(x=0,N++,F+=t),G=x+w,U=F+I,H=x+b,X=F+R,G=B>G?B:G,H=H>W?W:H,U=Y>U?Y:U,X=X>q?q:X,z=G+U,K=H+X,$=H+U,j=G+X,z=(z<<1)+z,$=($<<1)+$,j=(j<<1)+j,K=(K<<1)+K,Z=O*(c[K]-c[$]-c[j]+c[z])+S*e[E],et=O*(c[K+1]-c[$+1]-c[j+1]+c[z+1])+S*e[E+1],tt=O*(c[K+2]-c[$+2]-c[j+2]+c[z+2])+S*e[E+2],nt=k*(c[K]-c[$]-c[j]+c[z])+P*e[E],rt=k*(c[K+1]-c[$+1]-c[j+1]+c[z+1])+P*e[E+1],at=k*(c[K+2]-c[$+2]-c[j+2]+c[z+2])+P*e[E+2],J=o*Z+l*nt,Q=o*et+l*rt,V=o*tt+l*at,M&&(J=0>J?0:J>255?255:J,Q=0>Q?0:Q>255?255:Q,V=0>V?0:V>255?255:V),v[E]=~~J,v[E+1]=~~Q,v[E+2]=~~V,v[E+3]=e[E+3];e=v,it++}else for(O=r[0],T=r[g>>1],S=T-O;u>it;){for(v=new A(st),c=new C(h),E=0,L=0,f=d=m=0,x=0;t>x;x++,E+=4,L+=3)f+=e[E],d+=e[E+1],m+=e[E+2],c[L]=f,c[L+1]=d,c[L+2]=m;for(L=0,x=0,f=d=m=0,E=y+t;st>E;E+=4,L+=3,x++)x>=t&&(x=0,f=d=m=0),f+=e[E],d+=e[E+1],m+=e[E+2],c[L+y]=c[L]+f,c[L+y+1]=c[L+1]+d,c[L+y+2]=c[L+2]+m;for(x=0,N=0,F=0,E=0;st>E;E+=4,x++)x>=t&&(x=0,N++,F+=t),G=x+w,U=F+I,H=x+b,X=F+R,G=B>G?B:G,H=H>W?W:H,U=Y>U?Y:U,X=X>q?q:X,z=G+U,K=H+X,$=H+U,j=G+X,z=(z<<1)+z,$=($<<1)+$,j=(j<<1)+j,K=(K<<1)+K,Z=O*(c[K]-c[$]-c[j]+c[z])+S*e[E],et=O*(c[K+1]-c[$+1]-c[j+1]+c[z+1])+S*e[E+1],tt=O*(c[K+2]-c[$+2]-c[j+2]+c[z+2])+S*e[E+2],J=o*Z+l,Q=o*et+l,V=o*tt+l,M&&(J=0>J?0:J>255?255:J,Q=0>Q?0:Q>255?255:Q,V=0>V?0:V>255?255:V),v[E]=~~J,v[E+1]=~~Q,v[E+2]=~~V,v[E+3]=e[E+3];e=v,it++}return v}function m(e,t,n,r,a,i,s,o,l){var u,c,h,f,d,m,p,_,g,v,y,w,C,I,R,E,L,x,N,F,O,T,S,k,D,P,G,U=e.length,H=U>>2;for(u=[a,r],c=[s,i],D=[l,o],E=t-1,L=H-t,G=2;G--;){for(p=new A(U),f=u[G],d=c[G],h=f.length,m=d.length,P=D[G],_=new b(d),y=0;m>y;y+=2)_[y+1]*=t;if(M)for(w=0,C=0,g=0;U>g;g+=4,w++){for(w>=t&&(w=0,C+=t),T=0,S=0,k=0,y=0,v=0;h>y;y++,v+=2)I=w+_[v],R=C+_[v+1],I>=0&&E>=I&&R>=0&&L>=R&&(srcOff=I+R<<2,O=f[y],T+=e[srcOff]*O,S+=e[srcOff+1]*O,k+=e[srcOff+2]*O);x=P*T,N=P*S,F=P*k,x=0>x?0:x>255?255:x,N=0>N?0:N>255?255:N,F=0>F?0:F>255?255:F,p[g]=~~x,p[g+1]=~~N,p[g+2]=~~F,p[g+3]=e[g+3]}else for(w=0,C=0,g=0;U>g;g+=4,w++){for(w>=t&&(w=0,C+=t),T=0,S=0,k=0,y=0,v=0;h>y;y++,v+=2)I=w+_[v],R=C+_[v+1],I>=0&&E>=I&&R>=0&&L>=R&&(srcOff=I+R<<2,O=f[y],T+=e[srcOff]*O,S+=e[srcOff+1]*O,k+=e[srcOff+2]*O);x=P*T,N=P*S,F=P*k,p[g]=~~x,p[g+1]=~~N,p[g+2]=~~F,p[g+3]=e[g+3]}e=p}return p}var p=(e.CONSTANTS.SQRT2,e.CONSTANTS.toRad),_=(e.CONSTANTS.toDeg,Math.abs),g=Math.sqrt,v=Math.sin,y=Math.cos,w=e.Array32F,A=e.ImArray,C=e.Array32F,b=e.Array16I,M=(e.Array8U,e._notSupportClamp),I=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],R=e.ConvolutionMatrixFilter=e.Class(e.Filter,{name:"ConvolutionMatrixFilter",constructor:function(t,n,r){var a=this;a.$super("constructor"),a._coeff=new w([1,0]),t&&t.length?a.set(t,~~(g(t.length)+.5),n||1,r||0):(a._matrix=null,a._dim=0),a._matrix2=null,a._dim2=0,a._isGrad=!1,a._doIntegral=0,a._doSeparable=!1,e.useWebGL&&(a._webglInstance=e.WebGLConvolutionMatrixFilterInstance||null)},_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_webglInstance:null,dispose:function(){var e=this;return e.$super("dispose"),e._webglInstance=null,e._dim=null,e._dim2=null,e._matrix=null,e._matrix2=null,e._mat=null,e._mat2=null,e._coeff=null,e._isGrad=null,e._doIntegral=null,e._doSeparable=null,e._indices=null,e._indices2=null,e._indicesf=null,e._indicesf2=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_dim:e._dim,_dim2:e._dim2,_matrix:e._matrix,_matrix2:e._matrix2,_mat:e._mat,_mat2:e._mat2,_coeff:e._coeff,_isGrad:e._isGrad,_doIntegral:e._doIntegral,_doSeparable:e._doSeparable,_indices:e._indices,_indices2:e._indices2,_indicesf:e._indicesf,_indicesf2:e._indicesf2}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._dim=t._dim,n._dim2=t._dim2,n._matrix=t._matrix,n._matrix2=t._matrix2,n._mat=t._mat,n._mat2=t._mat2,n._coeff=t._coeff,n._isGrad=t._isGrad,n._doIntegral=t._doIntegral,n._doSeparable=t._doSeparable,n._indices=t._indices,n._indices2=t._indices2,n._indicesf=t._indicesf,n._indicesf2=t._indicesf2),n},lowPass:function(e){return e=e===t?3:e%2?e:e+1,this.set(c(e),e,1/(e*e),0),this._doIntegral=1,this},highPass:function(e,n){e=e===t?3:e%2?e:e+1,n=n===t?1:n;var r=e*e,a=-n/r,i=c(e,a,1+a);return this.set(i,e,1,0),this._doIntegral=1,this},glow:function(e,n){return e=e===t?.5:e,this.highPass(n,-e)},sharpen:function(e,n){return e=e===t?.5:e,this.highPass(n,e)},verticalBlur:function(e){return e=e===t?3:e%2?e:e+1,this.set(a(e),1,1/e,0),this._dim2=e,this._doIntegral=1,this},horizontalBlur:function(e){return e=e===t?3:e%2?e:e+1,this.set(a(e),e,1/e,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(e,n){n=n===t?3:n%2?n:n+1,e*=p;var r=y(e),a=-v(e),i=f(n,r,a,1/n);return this.set(i,n,1,0)},fastGauss:function(e,n){return n=n===t?3:n%2?n:n+1,e=~~(e||1),1>e?e=1:e>3&&(e=3),this.set(c(n),n,1/(n*n),0),this._doIntegral=e,this},binomialLowPass:function(e){e=e===t?3:e%2?e:e+1;var n=i(e),r=1<<e-1,a=1/r;this.set(n,e,a,a),this._matrix2=new w(n);var s=this._computeIndices(this._matrix2,this._dim2);return this._indices2=s[0],this._indicesf2=s[1],this._mat2=s[2],this._doSeparable=!0,this},binomialHighPass:function(e){e=e===t?3:e%2?e:e+1;var r=o(e);return this.set(n(c(e),new w(r.kernel),1,-1/r.sum),e,1,0)},prewittX:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,0);return this.set(n.kernel,e,1,0)},prewittY:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,1);return this.set(n.kernel,e,1,0)},prewittDirectional:function(e,r){r=r===t?3:r%2?r:r+1,e*=p;var a=y(e),i=v(e),s=u(r,0),o=u(r,1);return this.set(n(new w(s.kernel),new w(o.kernel),a,i),r,1,0)},prewitt:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,0),r=u(e,1);this.set(n.kernel,e,1,0),this._isGrad=!0,this._matrix2=new w(r.kernel);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this},sobelX:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,0);return this.set(n.kernel,e,1,0)},sobelY:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,1);return this.set(n.kernel,e,1,0)},sobelDirectional:function(e,r){r=r===t?3:r%2?r:r+1,e*=p;var a=y(e),i=v(e),s=l(r,0),o=l(r,1);return this.set(n(new w(s.kernel),new w(o.kernel),a,i),r,1,0)},sobel:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,0),r=l(e,1);this.set(n.kernel,e,1,0),this._matrix2=new w(r.kernel);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this._isGrad=!0,this},laplace:function(e){e=e===t?3:e%2?e:e+1;var n=e*e,r=c(e,-1,n-1);return this.set(r,e,1,0),this._doIntegral=1,this},emboss:function(e,n,r){r=r===t?3:r%2?r:r+1,e=e===t?-.25*Math.PI:e*p,n=n||1;var a=n*y(e),i=-n*v(e),s=h(r,a,i,1);return this.set(s,r,1,0)},edges:function(e){return e=e||1,this.set([0,e,0,e,-4*e,e,0,e,0],3,1,0)},set:function(e,t,n,r){var a=this;a._matrix2=null,a._dim2=0,a._indices2=a._indicesf2=null,a._mat2=null,a._isGrad=!1,a._doIntegral=0,a._doSeparable=!1,a._matrix=new w(e),a._dim=t,a._coeff[0]=n||1,a._coeff[1]=r||0;var i=a._computeIndices(a._matrix,a._dim);return a._indices=i[0],a._indicesf=i[1],a._mat=i[2],a},_computeIndices:function(e,t){var n,r,a,i=[],s=[],o=[],l=e.length,u=t,c=u>>1;for(r=0,a=0,n=0;l>n;)s.push(r-c),s.push(a-c),e[n]&&(i.push(r-c),i.push(a-c),o.push(e[n])),n++,r++,r>=u&&(r=0,a++);return[new b(i),new b(s),new w(o)]},reset:function(){var e=this;return e._matrix=e._matrix2=null,e._mat=e._mat2=null,e._dim=e._dim2=0,e._indices=e._indices2=e._indicesf=e._indicesf2=null,e._isGrad=!1,e._doIntegral=0,e._doSeparable=!1,e},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(e,t){return this.set(e,t)},_apply:function(e,t,n){var r=this;if(!r._isOn||!r._matrix)return e;if(r._doIntegral)return r._matrix2?d(e,t,n,r._matrix,r._matrix2,r._dim,r._dim2,r._coeff[0],r._coeff[1],r._doIntegral):d(e,t,n,r._matrix,null,r._dim,r._dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return m(e,t,n,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,i,s,o,l,u,c,h,f,p,g,v,y,w,C,I,R,E,L,x,N,F,O=e.length,T=O>>2,S=new A(O),k=t-1,D=T-t,P=r._coeff[0],G=r._coeff[1],U=r._matrix,H=r._matrix2,X=r._isGrad;if(H){for(x=r._indicesf.length,F=new b(r._indicesf),u=0;x>u;u+=2)F[u+1]*=t;for(N=U.length,c=0,h=0,o=0;O>o;o+=4,c++){for(c>=t&&(c=0,h+=t),v=0,y=0,w=0,C=0,I=0,R=0,u=0,l=0;N>u;u++,l+=2)f=c+F[l],p=h+F[l+1],f>=0&&k>=f&&p>=0&&D>=p&&(g=f+p<<2,E=U[u],v+=e[g]*E,y+=e[g+1]*E,w+=e[g+2]*E,L=H[u],C+=e[g]*L,I+=e[g+1]*L,R+=e[g+2]*L);X?(a=_(v)+_(C),i=_(y)+_(I),s=_(w)+_(R)):(a=P*v+G*C,i=P*y+G*I,s=P*w+G*R),M&&(a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s),S[o]=~~a,S[o+1]=~~i,S[o+2]=~~s,S[o+3]=e[o+3]}}else{for(x=r._indices.length,F=new b(r._indices),u=0;x>u;u+=2)F[u+1]*=t;for(U=r._mat,N=U.length,c=0,h=0,o=0;O>o;o+=4,c++){for(c>=t&&(c=0,h+=t),v=0,y=0,w=0,u=0,l=0;N>u;u++,l+=2)f=c+F[l],p=h+F[l+1],f>=0&&k>=f&&p>=0&&D>=p&&(g=f+p<<2,E=U[u],v+=e[g]*E,y+=e[g+1]*E,w+=e[g+2]*E);a=P*v+G,i=P*y+G,s=P*w+G,M&&(a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s),S[o]=~~a,S[o+1]=~~i,S[o+2]=~~s,S[o+3]=e[o+3]}}return S},canRun:function(){return this._isOn&&this._matrix}});R.prototype.bump=R.prototype.emboss,R.prototype.boxBlur=R.prototype.lowPass,R.prototype.gaussBlur=R.prototype.binomialLowPass,R.prototype.gradX=R.prototype.prewittX,R.prototype.gradY=R.prototype.prewittY,R.prototype.gradDirectional=R.prototype.prewittDirectional,R.prototype.grad=R.prototype.prewitt}(FILTER),!function(e){"use strict";{var t,n=e.ImArray,r=e.Array8U,a=e.Array32I,i=Math.sqrt,s=function(e){var t,n=e*e,a=new r(n);for(t=0;n>t;t++)a[t]=1;return a},o=s(3);e.MorphologicalFilter=e.Class(e.Filter,{name:"MorphologicalFilter",constructor:function(){var e=this;e.$super("constructor"),e._filterName=null,e._filter=null,e._dim=0,e._structureElement=null,e._indices=null},_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var e=this;return e.$super("dispose"),e._filterName=null,e._filter=null,e._dim=null,e._structureElement=null,e._indices=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_filterName:e._filterName,_dim:e._dim,_structureElement:e._structureElement,_indices:e._indices}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._dim=n._dim,r._structureElement=n._structureElement,r._indices=n._indices,r._filterName=n._filterName,r._filterName&&t[r._filterName]&&(r._filter=t[r._filterName])),r},erode:function(e){return this.set(e,"erode")},dilate:function(e){return this.set(e,"dilate")},opening:function(e){return this.set(e,"open")},closing:function(e){return this.set(e,"close")},set:function(e,n){var l=this;l._filterName=n,l._filter=t[n],e&&e.length?(l._structureElement=new r(e),l._dim=~~(i(l._structureElement.length)+.5)):e&&e===e-0?(l._structureElement=s(e),l._dim=e):(l._structureElement=o,l._dim=3);var u,c,h,f=[],e=l._structureElement,d=e.length,m=l._dim,p=m>>1;for(c=0,h=0,u=0;d>u;)e[u]&&(f.push(c-p),f.push(h-p)),u++,c++,c>=m&&(c=0,h++);return l._indices=new a(f),l},reset:function(){var e=this;return e._filterName=null,e._filter=null,e._dim=0,e._structureElement=null,e._indices=null,e},_apply:function(e,t,n){var r=this;return r._isOn&&r._dim&&r._filter?r._filter(r,e,t,n):e},canRun:function(){return this._isOn&&this._dim&&this._filter}})}t={dilate:function(e,t,r){var i,s,o,l,u,c,h,f,d,m,p,_,g,v,y=e._structureElement,w=(y.length,e._dim,new a(e._indices)),A=t.length,C=A>>2,b=new n(A),M=w.length,I=M>>1,R=r-1,E=C-r;for(o=0;M>o;o+=2)w[o+1]*=r;for(l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=0,g=0,v=0,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],d>_&&(_=d),m>g&&(g=m),p>v&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}return b},erode:function(e,t,r){var i,s,o,l,u,c,h,f,d,m,p,_,g,v,y=e._structureElement,w=(y.length,e._dim,new a(e._indices)),A=t.length,C=A>>2,b=new n(A),M=w.length,I=M>>1,R=r-1,E=C-r;for(o=0;M>o;o+=2)w[o+1]*=r;for(l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],_>d&&(_=d),g>m&&(g=m),v>p&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}return b},open:function(e,t,r){var i,s,o,l,u,c,h,f,d,m,p,_,g,v,y=e._structureElement,w=(y.length,e._dim,new a(e._indices)),A=t.length,C=A>>2,b=new n(A),M=w.length,I=M>>1,R=r-1,E=C-r;for(o=0;M>o;o+=2)w[o+1]*=r;for(l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],_>d&&(_=d),g>m&&(g=m),v>p&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}for(t=b,b=new n(A),l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],_>d&&(_=d),g>m&&(g=m),v>p&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}return b},close:function(e,t,r){var i,s,o,l,u,c,h,f,d,m,p,_,g,v,y=e._structureElement,w=(y.length,e._dim,new a(e._indices)),A=t.length,C=A>>2,b=new n(A),M=w.length,I=M>>1,R=r-1,E=C-r;for(o=0;M>o;o+=2)w[o+1]*=r;for(l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],_>d&&(_=d),g>m&&(g=m),v>p&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}for(t=b,b=new n(A),l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,d=t[f],m=t[f+1],p=t[f+2],_>d&&(_=d),g>m&&(g=m),v>p&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}return b}}}(FILTER),!function(e,t){"use strict";var n,r=e.ImArray,a=e.Array32I,i=(Math.min,Math.max,e.StatisticalFilter=e.Class(e.Filter,{name:"StatisticalFilter",constructor:function(){var e=this;e.$super("constructor"),e._dim=0,e._indices=null,e._filterName=null,e._filter=null},_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var e=this;return e.$super("dispose"),e._dim=null,e._indices=null,e._filter=null,e._filterName=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_filterName:e._filterName,_dim:e._dim,_indices:e._indices}}},unserialize:function(e){var t,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,t=e.params,r._dim=t._dim,r._indices=t._indices,r._filterName=t._filterName,r._filterName&&n[r._filterName]&&(r._filter=n[r._filterName])),r},median:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"median")},minimum:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"minimum")},maximum:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"maximum")},set:function(e,t){var r=this;r._filterName=t,r._filter=n[t],r._dim=e;var i,s,o,l=[],u=e*e,c=e,h=c>>1;for(s=0,o=0,i=0;u>i;)l.push(s-h),l.push(o-h),i++,s++,s>=c&&(s=0,o++);return r._indices=new a(l),r},reset:function(){var e=this;return e._filterName=null,e._filter=null,e._dim=0,e._indices=null,e},_apply:function(e,t,n){var r=this;return r._isOn&&r._dim?r._filter(r,e,t,n):e},canRun:function(){return this._isOn&&this._dim}}));i.prototype.erode=i.prototype.minimum,i.prototype.dilate=i.prototype.maximum,n={median:function(e,t,n){var i,s,o,l,u,c,h,f,d,m,p,_,g,v,y,w,A,C,b=e._dim,M=b*b,I=new a(e._indices),R=t.length,E=R>>2,L=new r(R),x=M<<1,N=n-1,F=E-n;for(f=[],d=[],m=[],s=0;x>s;s+=2)I[s+1]*=n;for(i=0,o=0,l=0;R>i;){for(f.length=0,d.length=0,m.length=0,s=0;x>s;)u=o+I[s],c=l+I[s+1],u>=0&&N>=u&&c>=0&&F>=c&&(h=u+c<<2,p=t[h],_=t[h+1],g=t[h+2],f.push(p),d.push(_),m.push(g)),s+=2;f.sort(),d.sort(),m.sort(),A=f.length,C=A>>1,v=A%2?f[C+1]:~~(.5*(f[C]+f[C+1])),A=d.length,C=A>>1,y=A%2?d[C+1]:~~(.5*(d[C]+d[C+1])),A=m.length,C=A>>1,w=A%2?m[C+1]:~~(.5*(m[C]+m[C+1])),L[i]=v,L[i+1]=y,L[i+2]=w,L[i+3]=t[i+3],i+=4,o++,o>=n&&(o=0,l+=n)}return L},maximum:function(e,t,n){var i,s,o,l,u,c,h,f,d,m,p,_,g,v=e._dim,y=v*v,w=new a(e._indices),A=t.length,C=A>>2,b=new r(A),M=y<<1,I=n-1,R=C-n;for(s=0;M>s;s+=2)w[s+1]*=n;for(i=0,o=0,l=0;A>i;){for(p=0,_=0,g=0,s=0;M>s;)u=o+w[s],c=l+w[s+1],u>=0&&I>=u&&c>=0&&R>=c&&(h=u+c<<2,f=t[h],d=t[h+1],m=t[h+2],f>p&&(p=f),d>_&&(_=d),m>g&&(g=m)),s+=2;b[i]=p,b[i+1]=_,b[i+2]=g,b[i+3]=t[i+3],i+=4,o++,o>=n&&(o=0,l+=n)}return b},minimum:function(e,t,n){var i,s,o,l,u,c,h,f,d,m,p,_,g,v=e._dim,y=v*v,w=new a(e._indices),A=t.length,C=A>>2,b=new r(A),M=y<<1,I=n-1,R=C-n;for(s=0;M>s;s+=2)w[s+1]*=n;for(i=0,o=0,l=0;A>i;){for(p=255,_=255,g=255,s=0;M>s;)u=o+w[s],c=l+w[s+1],u>=0&&I>=u&&c>=0&&R>=c&&(h=u+c<<2,f=t[h],d=t[h+1],m=t[h+2],p>f&&(p=f),_>d&&(_=d),g>m&&(g=m)),s+=2;b[i]=p,b[i+1]=_,b[i+2]=g,b[i+3]=t[i+3],i+=4,o++,o>=n&&(o=0,l+=n)}return b}}}(FILTER),exports.FILTER});
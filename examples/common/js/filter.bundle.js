/**
*
*   Classy.js
*   @version: 0.6.1
*
*   Object-Oriented mini-framework for JavaScript
*   https://github.com/foo123/classy.js
*
**/!function(e,t,n,r,o){"use strict";var l="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),i=!l&&"undefined"!=typeof navigator,a="function"==typeof importScripts&&navigator instanceof WorkerNavigator,u=Array,c=u.prototype,s=function(){var e=null;if(l)return e=__filename,{path:__dirname,file:__filename};if(a)e=self.location.href;else if(i){var t;(t=document.getElementsByTagName("script"))&&t.length&&(e=t[t.length-1].src)}return e?{path:e.split("/").slice(0,-1).join("/"),file:e}:{path:null,file:null}},f=s(),p=function(e,t){if(l)return t;if("."==t.charAt(0)){e=e.split("/"),t=t.split("/");var n,r=0,o=0,i=t.length,a=e.length;for(n=0;i>n;n++)if(/^\.\./.test(t[n]))r++,o++;else{if(!/^\./.test(t[n]))break;o++}r=r>=a?0:a-r,t=e.slice(0,r).concat(t.slice(o)).join("/")}return t};n=n?[].concat(n):[];var b,d,y,m=n.length,g=new u(m),v=new u(m),h=new u(m),w=new u(m);for(b=0;m>b;b++)g[b]=n[b][0],v[b]=n[b][1],h[b]=/\.js$/i.test(v[b])?p(f.path,v[b]):p(f.path,v[b]+".js");if("object"==typeof module&&module.exports){if(o===module.exports[t]){for(b=0;m>b;b++)w[b]=module.exports[g[b]]||require(h[b])[g[b]];d=r.apply(e,w),module.exports[t]=d||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(v),function(n){if(o===n[t]){for(var l=c.slice.call(arguments,1),i=l.length,a=0;i>a;a++)w[a]=n[g[a]]||l[a];d=r.apply(e,w),n[t]=d||1}});else if(a){for(b=0;m>b;b++)self[g[b]]||importScripts(h[b]),w[b]=self[g[b]];d=r.apply(e,w),self[t]=d||1}else if(o===e[t]){var j=function(e,t){y=y||document.getElementsByTagName("head")[0];var n=0,r=document.createElement("script");r.type="text/javascript",r.language="javascript",r.onload=r.onreadystatechange=function(){n||r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(n=1,r.onload=r.onreadystatechange=null,y.removeChild(r),r=null,t&&t())},r.src=e,y.appendChild(r)},x=function(t,n,r){e[t]?r():j(n,r)},E=function(n){return function(){m>n&&(w[n]=e[g[n]]),++n<m?x(g[n],h[n],E(n)):(d=r.apply(e,w),e[t]=d||1)}};m?x(g[0],h[0],E(0)):(d=r.apply(e,w),e[t]=d||1)}}(this,"Classy",null,function(){var e={};return function(e,t){var n=function(e,t,n){this.v=e||null,this.prev=t||null,this.next=n||null};n.prototype={constructor:n,v:null,prev:null,next:null,fwd:function(e){return new n(e,this)},bwd:function(){return this.prev}};var r=Array.prototype,o=Object.prototype,l=Function.prototype,i=l.call.bind(r.slice),a=l.call.bind(o.toString),u=l.call.bind(o.hasOwnProperty),c=l.call.bind(o.propertyIsEnumerable),s=Object.keys,f=Object.defineProperty,p=2,b=3,d=4,y=8,m=9,g=16,v=32,h=64,w=128,j=256,x=512,E=1024,_=function(e){var t=typeof e,n=a(e);return"undefined"===t?x:"number"===t||e instanceof Number?isNaN(e)?b:p:null===e?j:!0===e||!1===e?d:e&&("string"===t||e instanceof String)?1===e.length?m:y:e&&("[object Array]"===n||e instanceof Array)?g:e&&("[object RegExp]"===n||e instanceof RegExp)?w:e&&("function"===t&&"[object Function]"===n||e instanceof Function)?h:e&&"[object Object]"===n?v:E},O=function(e,t){var n,r=t.length,o=[].concat(e);for(n=0;r>n;n++)o.indexOf(t[n])>-1||o.push(t[n]);return o},N=function(e,t){if(v!==_(e))throw new TypeError("bad desc");var n={};if(u(e,"enumerable")&&(n.enumerable=!!t.enumerable),u(e,"configurable")&&(n.configurable=!!t.configurable),u(e,"value")&&(n.value=t.value),u(e,"writable")&&(n.writable=!!e.writable),u(e,"get")){var r=e.get;if(h!==_(r)&&"undefined"!==r)throw new TypeError("bad get");n.get=r}if(u(e,"set")){var o=e.set;if(h!==_(o)&&"undefined"!==o)throw new TypeError("bad set");n.set=o}if(("get"in n||"set"in n)&&("value"in n||"writable"in n))throw new TypeError("identity-confused descriptor");return n},T=Object.defineProperties||function(e,t){if("object"!=typeof e||null===e)throw new TypeError("bad obj");t=Object(t);for(var n=s(t),r=[],o=0;o<n.length;o++)r.push([n[o],N(t[n[o]],e)]);for(var o=0;o<r.length;o++)f(e,r[o][0],r[o][1]);return e},S=Object.create||function(e,t){var n,r=function(){};return r.prototype=e,n=new r,n.__proto__=e,"object"==typeof t&&T(n,t),n},A=function(e){var t=new n(e);return function(e){if(e&&t&&t.v){var n,r=this;if(e="constructor"===e?t.v:t.v.prototype[e])return t=t.fwd(t.v.$super),n=e.apply(r,i(arguments,1)),t=t.bwd(),n}}},C=function(){var e,t,n,r,o,l,a,s=i(arguments);for(t=s.shift()||{},e=s.length,l=0;e>l;l++)if(n=s[l],v===_(n))for(o in n)u(n,o)&&c(n,o)&&(r=n[o],a=_(r),t[o]=p&a?0+r:(y|g)&a?r.slice(0):r);return t},R=function(e,t,n){var r,o,l=!!t;if(l||n)if(r={},t=l?t+"$":t,n&&h===_(n))for(o in e)"constructor"!==o?(l&&h===_(e[o])&&(r[t+o]=e[o]),r[n(o,e[o])]=e[o]):r[o]=e[o];else for(o in e)"constructor"!==o?(l&&h===_(e[o])&&(r[t+o]=e[o]),n&&o in n?r[n[o]]=e[o]:r[o]=e[o]):r[o]=e[o];else r=e;return r},$=function(e,n,r,o){e=e||Object,n=n||{};var l,i,a,c,f,b,d,m,h=null,w=e.$static||null;if(u(n,"constructor")?i=n.constructor:(l=function(){},n.constructor=i=l),u(n,"__static__")&&(h=n.__static__,delete n.__static__,w=O(w||[],s(h))),i.prototype=R(S(e.prototype),r,o),i.prototype=C(i.prototype,n),T(i.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0},$class:{value:i,enumerable:!1,writable:!0,configurable:!0},$super:{value:A(e),enumerable:!1,writable:!0,configurable:!0}}),T(i,{$super:{value:e,enumerable:!1,writable:!0,configurable:!0},$static:{value:w,enumerable:!1,writable:!0,configurable:!0}}),w){for(c=w.length,f={},a=0;c>a;a++)b=w[a],d=null,h&&t!==h[b]?d=h[b]:t!==e[b]&&(m=_(e[b]),d=v===m?C(null,e[b]):(y|g)&m?e[b].slice(0):p&m?0+e[b]:e[b]),f[b]={value:d,enumerable:!1,writable:!0,configurable:!0};T(i,f)}return i},I=C,B=C,F=function(){var e=i(arguments),t=e.length,n=null;if(t>=2){var r=_(e[0]);r=h===r?{Extends:e[0]}:v===r?e[0]:{Extends:Object};var o,l,a=e[1]||{},u={},c=r.Extends||r.extends||Object,s=r.Implements||r.implements,f=r.Mixin||r.mixin,p=null;if(s=s?[].concat(s):null,f=f?[].concat(f):null)for(o=0,l=f.length;l>o;o++)v===_(f[o])?f[o].mixin&&f[o].mixin.prototype&&(p=R(f[o].mixin.prototype,f[o].namespace||null,f[o].as||null),u=B(u,p)):f[o].prototype&&(p=f[o].prototype,u=B(u,p));if(s)for(o=0,l=s.length;l>o;o++)v===_(s[o])?s[o].implements&&s[o].implements.prototype&&(p=R(s[o].implements.prototype,s[o].namespace||null,s[o].as||null),u=I(u,p)):s[o].prototype&&(p=s[o].prototype,u=I(u,p));n=v===_(c)?$(c.extends||Object,C(u,a),c.namespace||null,c.as||null):$(c,C(u,a))}else n=$(Object,e[0]);return n};e.Classy={VERSION:"0.6.1",T:{UNDEFINED:x,NULL:j,BOOLEAN:d,STRING:y,NUMBER:p,NAN:b,FUNCTION:h,REGEXP:w,ARRAY:g,OBJECT:v},Type:_,Create:S,Merge:C,Alias:R,Implements:I,Mixin:B,Extends:$,Static:function(e){return e},Class:F}}(e),e.Classy});
/**
*
*   Asynchronous.js
*   @version: 0.4
*
*   Simple JavaScript class to manage asynchronous, parallel, linear, sequential and interleaved tasks
*   https://github.com/foo123/asynchronous.js
*
**/!function(n,e,t,r,o){"use strict";var s="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),i=!s&&"undefined"!=typeof navigator,u="function"==typeof importScripts&&navigator instanceof WorkerNavigator,a=Array,l=a.prototype,c=function(){var n=null;if(s)return n=__filename,{path:__dirname,file:__filename};if(u)n=self.location.href;else if(i){var e;(e=document.getElementsByTagName("script"))&&e.length&&(n=e[e.length-1].src)}return n?{path:n.split("/").slice(0,-1).join("/"),file:n}:{path:null,file:null}},f=c(),p=function(n,e){if(s)return e;if("."==e.charAt(0)){n=n.split("/"),e=e.split("/");var t,r=0,o=0,i=e.length,u=n.length;for(t=0;i>t;t++)if(/^\.\./.test(e[t]))r++,o++;else{if(!/^\./.test(e[t]))break;o++}r=r>=u?0:u-r,e=n.slice(0,r).concat(e.slice(o)).join("/")}return e};t=t?[].concat(t):[];var h,d,m,g=t.length,v=new a(g),E=new a(g),N=new a(g),y=new a(g);for(h=0;g>h;h++)v[h]=t[h][0],E[h]=t[h][1],N[h]=/\.js$/i.test(E[h])?p(f.path,E[h]):p(f.path,E[h]+".js");if("object"==typeof module&&module.exports){if(o===module.exports[e]){for(h=0;g>h;h++)y[h]=module.exports[v[h]]||require(N[h])[v[h]];d=r.apply(n,y),module.exports[e]=d||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(E),function(t){if(o===t[e]){for(var s=l.slice.call(arguments,1),i=s.length,u=0;i>u;u++)y[u]=t[v[u]]||s[u];d=r.apply(n,y),t[e]=d||1}});else if(u){for(h=0;g>h;h++)self[v[h]]||importScripts(N[h]),y[h]=self[v[h]];d=r.apply(n,y),self[e]=d||1}else if(o===n[e]){var $=function(n,e){m=m||document.getElementsByTagName("head")[0];var t=0,r=document.createElement("script");r.type="text/javascript",r.language="javascript",r.onload=r.onreadystatechange=function(){t||r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(t=1,r.onload=r.onreadystatechange=null,m.removeChild(r),r=null,e&&e())},r.src=n,m.appendChild(r)},T=function(e,t,r){n[e]?r():$(t,r)},A=function(t){return function(){g>t&&(y[t]=n[v[t]]),++t<g?T(v[t],N[t],A(t)):(d=r.apply(n,y),n[e]=d||1)}};g?T(v[0],N[0],A(0)):(d=r.apply(n,y),n[e]=d||1)}}(this,"Asynchronous",null,function(){var EXPORTS={};return!function(root,exports,undef){"use strict";function runParallelised(n){return n.$runmode=PARALLELISED,n.$running=!1,n}function runLinearised(n,e){var t,r=n,o=r.$queue;if(r.$runmode=LINEARISED,o){for(;o.length&&(!o[0]||!o[0].canRun());)o.shift();o.length?(r.$running=!0,t=o.shift(),e?t.runWithArgs(e):t.run(),t.complete()):r.$running=!1}return r}function runInterleaved(n,e){var t,r=n,o=r.$queue,s=0;if(r.$runmode=INTERLEAVED,o&&o.length){for(r.$running=!0;s<o.length;)t=o[s],t&&t.canRun()?(e?t.runWithArgs(e):t.run(),t.isFinished()?(o.shift(),t.complete()):s++):o.shift();r.$running=!1,r.$timer=setTimeout(curry(runInterleaved,r),r.$interval)}return r}function runSequenced(n,e){var t,r=n,o=r.$queue;return r.$runmode=SEQUENCED,o&&o.length&&(t=o[0],t&&t.canRun()?(r.$running=!0,e?t.runWithArgs(e):t.run(),t.isFinished()&&(o.shift(),t.complete())):o.shift(),r.$running=!1,r.$timer=setTimeout(curry(runSequenced,r),r.$interval)),r}var FP=Function.prototype,OP=Object.prototype,AP=Array.prototype,slice=FP.call.bind(AP.slice),toString=FP.call.bind(OP.toString),UNDEFINED=undef,UNKNOWN=0,NODE=1,BROWSER=2,DEFAULT_INTERVAL=60,NONE=0,INTERLEAVED=1,LINEARISED=2,PARALLELISED=3,SEQUENCED=4,isNode="undefined"!=typeof global&&"[object global]"===toString(global),isNodeProcess=!(!isNode||!process.env.NODE_UNIQUE_ID),isBrowser=!isNode&&"undefined"!=typeof navigator,isWebWorker=!isNode&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,supportsMultiThread=isNode||"function"==typeof Worker,isThread=isNodeProcess||isWebWorker,Thread,numProcessors=isNode?require("os").cpus().length:4,fromJSON=JSON.parse,toJSON=JSON.stringify,onMessage,curry=function(n,e){return function(){return n(e)}},URL=root.webkitURL||root.URL||null,blobURL=function(n){return URL?URL.createObjectURL(new Blob([n||""],{type:"text/javascript"})):n},path=function(){var n,e=null;return isNode?{path:__dirname,file:__filename}:(isWebWorker?e=self.location.href:isBrowser&&(n=document.getElementsByTagName("script"))&&n.length&&(e=n[n.length-1].src),e?{path:e.split("/").slice(0,-1).join("/"),file:""+e}:{path:null,file:null})},thisPath=path(),notThisPath=function(n){return!(!n||!n.length||n===thisPath.file)};if(onMessage=isWebWorker?function(n){n&&(onmessage=n)}:isNodeProcess?function(n){n&&process.on("message",function(e){n(fromJSON(e))})}:function(){},isNode){var fs=require("fs"),ps=require("child_process");root.close=function(){process.exit()},root.postMessage=function(n){process.send(toJSON({data:n}))},root.importScripts=function(scripts){if(scripts){scripts=scripts.split(",");for(var i=0,src,ok;i<scripts.length;){ok=!0;try{src=fs.readFileSync(scripts[i++]),eval(src)}catch(e){ok=e}if(!0!==ok)throw ok}}},Thread=function(n){var e=this;e.process=ps.fork(n),e.process.on("message",function(n){e.onmessage&&e.onmessage(fromJSON(n))}),e.process.on("error",function(n){e.onerror&&e.onerror(n)})},Thread.prototype={constructor:Thread,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.send(toJSON({data:n})),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}}else Thread=root.Worker;var Task=function(n){if(n instanceof Task)return n;if(!(this instanceof Task))return new Task(n);1>arguments.length&&(n=null);var e=this,t=null,r=null,o=!1,s=!1,i=!1,u=!1,a=!1,l=!1,c=null,f=0,p=1,h=null,d=null,m=null,g=undef,v=function(){return g=n(e),o=!0,g};e.task=function(t){return n=t,e},e.queue=function(n){return arguments.length?(t=n,e):t},e.jumpNext=function(n){t&&t.jumpNext(!1,n)},e.abort=function(n){t&&(t.abort(!1),n&&(t.dispose(),t=null))},e.dispose=function(){t&&(t.dispose(),t=null)},e.canRun=function(){return n&&(!o||s||i||u||a||l)?(s||i)&&f>=h?!1:i&&!c?!1:(u||a)&&g===d?!1:!0:!1},e.run=v,e.runWithArgs=function(e){return g=n.apply(null,e),o=!0,g},e.iif=function(t,r,o){return t?n=r:arguments.length>2&&(n=o),e},e.until=function(n){return g=undef,c=null,d=n,a=!0,l=!1,s=!1,i=!1,u=!1,e.run=v,e},e.untilNot=function(n){return g=undef,c=null,m=n,l=!0,a=!1,s=!1,i=!1,u=!1,e.run=v,e},e.loop=function(t,r,d){return g=undef,c=null,f=r||0,p=d||1,h=t,s=!0,a=!1,l=!1,i=!1,u=!1,e.run=function(){var e;return e=n(f),f+=p,g=e,o=!0,e},e},e.each=function(t){return g=undef,c=t,f=0,p=1,h=t?t.length||0:0,i=!0,a=!1,l=!1,s=!1,u=!1,e.run=function(){var e;return e=n(c[f],f),f++,g=e,o=!0,e},e},e.recurse=function(t,r){return c=null,g=t,d=r,u=!0,a=!1,l=!1,s=!1,i=!1,e.run=function(){var e;return e=n(g),g=e,o=!0,e},e},e.isFinished=function(){var n=!o||l||a||s||i||u;return n&&(a||u)&&g===d&&(n=!1),n&&l&&g!==m&&(n=!1),n&&(s||i)&&f>=h&&(n=!1),!n},e.onComplete=function(n){return r=n||null,e},e.complete=function(){return r&&"function"==typeof r&&r(),e}},Asynchronous=exports.Asynchronous=function(n){if(n instanceof Task)return n;if("function"==typeof n)return new Task(n);if(!(this instanceof Asynchronous))return new Asynchronous(n);var e=this;e.$interval=arguments.length?parseInt(n,10):DEFAULT_INTERVAL,e.$timer=null,e.$runmode=NONE,e.$running=!1,e.$queue=[],isThread&&e.initThread()};if(Asynchronous.VERSION="0.4",Asynchronous.Thread=Thread,Asynchronous.Task=Task,Asynchronous.MODE={NONE:NONE,INTERLEAVE:INTERLEAVED,LINEAR:LINEARISED,PARALLEL:PARALLELISED,SEQUENCE:SEQUENCED},Asynchronous.Platform={UNDEFINED:UNDEFINED,UNKNOWN:UNKNOWN,NODE:NODE,BROWSER:BROWSER},Asynchronous.supportsMultiThreading=function(){return supportsMultiThread},Asynchronous.isPlatform=function(n){return NODE===n?isNode:BROWSER===n?isBrowser:undef},Asynchronous.isThread=function(n){return NODE===n?isNodeProcess:BROWSER===n?isWebWorker:isThread},Asynchronous.currentPath=path,Asynchronous.requestAnimationFrame=function(n){return n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame||function(n){setTimeout(n,1e3/60)}}(root),Asynchronous.load=function(n,e,t){if(n){e&&e.length&&(e=e.filter(notThisPath),e.length&&importScripts(e.join(","))),n=n.split(".");for(var r=root;n.length;)n[0]&&n[0].length&&r[n[0]]&&(r=r[n[0]]),n.shift();if(r&&root!==r)return"function"==typeof r?!1!==t?new r:r():r}return null},Asynchronous.serialize=function(n){n=n||new Asynchronous;var e=function(e){var t=function(){var t=this,r=slice(arguments);n.step(function(){e.apply(t,r)}),n.$running||n.run(LINEARISED)};return t.free=function(){return e},t};return e.free=function(){n&&n.dispose(),n=null},e},Asynchronous.prototype={constructor:Asynchronous,$interval:DEFAULT_INTERVAL,$timer:null,$queue:null,$thread:null,$events:null,$runmode:NONE,$running:!1,dispose:function(){var n=this;return n.unfork(),n.$timer&&clearTimeout(n.$timer),n.$thread=null,n.$timer=null,n.$interval=null,n.$queue=null,n.$runmode=NONE,n.$running=!1,n},empty:function(){var n=this;return n.$timer&&clearTimeout(n.$timer),n.$timer=null,n.$queue=[],n.$runmode=NONE,n.$running=!1,n},interval:function(n){return arguments.length?(this.$interval=parseInt(n,10),this):this.$interval},fork:function(n,e,t){var r,o,s,i=this;if(!i.$thread){if(!supportsMultiThread)throw i.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");isNode?(o="Asynchronous: Thread (Process): ",s="Asynchronous: Thread (Process) Error: "):(o="Asynchronous: Thread (Worker): ",s="Asynchronous: Thread (Worker) Error: "),i.$events=i.$events||{},r=i.$thread=new Thread(thisPath.file),r.onmessage=function(n){if(n.data.event){var e=n.data.event,t=n.data.data||null;i.$events&&i.$events[e]?i.$events[e](t):("console.log"===e||"console.error"===e)&&console.log(o+(t.output||""))}},r.onerror=function(n){if(!i.$events||!i.$events.error)throw new Error(s+n.message+" file: "+n.filename+" line: "+n.lineno);i.$events.error(n)},i.send("initThread",{component:n||null,asInstance:!1!==t,imports:e?[].concat(e):null})}return i},unfork:function(){var n=this;return n.$thread&&n.send("dispose"),n.$thread=null,n.$events=null,n},initThread:function(){var n=this;return isThread&&(n.$events={},onMessage(function(e){var t=e.data.event,r=e.data.data||null;t&&n.$events[t]?n.$events[t](r):"dispose"===t&&(n.dispose(),close())})),n},listen:function(n,e){return n&&"function"==typeof e&&this.$events&&(this.$events[n]=e),this},unlisten:function(n,e){return n&&this.$events&&this.$events[n]&&(2>arguments.length||e===this.$events[n])&&delete this.$events[n],this},send:function(n,e){return n&&(isThread?postMessage({event:n,data:e||null}):this.$thread&&this.$thread.postMessage({event:n,data:e||null})),this},task:function(n){return n instanceof Task?n:"function"==typeof n?Task(n):void 0},iif:function(){var n=slice(arguments),e=new Task;return e.iif.apply(e,n)},until:function(){var n=slice(arguments),e=new Task(n.pop());return e.until.apply(e,n)},untilNot:function(){var n=slice(arguments),e=new Task(n.pop());return e.untilNot.apply(e,n)},loop:function(){var n=slice(arguments),e=new Task(n.pop());return e.loop.apply(e,n)},each:function(){var n=slice(arguments),e=new Task(n.pop());return e.each.apply(e,n)},recurse:function(){var n=slice(arguments),e=new Task(n.pop());return e.recurse.apply(e,n)},step:function(n){var e=this;return n&&e.$queue.push(e.task(n).queue(e)),e},steps:function(){var n,e,t=this,r=slice(arguments);for(e=r.length,n=0;e>n;n++)t.step(r[n]);return t},jumpNext:function(n,e){var t=this,r=t.$queue;return e=e||0,!1!==n?function(){return e<r.length&&(e>0&&r.splice(0,e),t.run(t.$runmode)),t}:(e<r.length&&(e>0&&r.splice(0,e),t.run(t.$runmode)),t)},jumpNextWithArgs:function(n,e,t){var r=this,o=r.$queue;return e=e||0,!1!==n?function(){return e<o.length&&(e>0&&o.splice(0,e),r.run(r.$runmode,slice(arguments))),r}:(e<o.length&&(e>0&&o.splice(0,e),r.run(r.$runmode,t)),r)},abort:function(n,e){var t=this;return!1!==n?function(){return e&&e>0?setTimeout(function(){t.empty()},e):t.empty(),t}:(e&&e>0?setTimeout(function(){t.empty()},e):t.empty(),t)},run:function(n,e){var t=this;return arguments.length?t.$runmode=n:n=t.$runmode,e=e||null,SEQUENCED===n?runSequenced(t,e):INTERLEAVED===n?runInterleaved(t,e):LINEARISED===n?runLinearised(t,e):PARALLELISED===n&&runParallelised(t,e),t}},isThread){var Component=null;root.console={log:function(n){postMessage({event:"console.log",data:{output:n||""}})},error:function(n){postMessage({event:"console.error",data:{output:n||""}})}},onMessage(function(n){var e=n.data.event,t=n.data.data||null;switch(e){case"initThread":t&&t.component&&(Component&&("function"==typeof Component.dispose&&Component.dispose(),Component=null),Component=Asynchronous.load(t.component,t.imports,t.asInstance));break;case"dispose":default:Component&&("function"==typeof Component.dispose&&Component.dispose(),Component=null),close()}})}}(this,EXPORTS),EXPORTS.Asynchronous});
/**
*  PublishSubscribe
*  A simple publish-subscribe implementation for PHP, Python, Node/JS
*
*  @version: 0.3.2
*  https://github.com/foo123/PublishSubscribe
*
**/
!function(t,s,n){"object"==typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):t[s]=n()}(this,"PublishSubscribe",function(){"use strict";function t(t,s,n,i){var o=this;o.topic=t?[].concat(t):[],s&&(o.originalTopic=[].concat(s)),o.tags=n?[].concat(n):[],o.namespaces=i?[].concat(i):[],o.data={},o._stopPropagation=!1,o._stopEvent=!1}function s(){return{notopics:{notags:{namespaces:{},list:[]},tags:{}},topics:{}}}function n(t){return t.length>0}function i(t,s){var i,o,e,p;return s=String(s),i=s.indexOf(t[2]),o=s.indexOf(t[1]),i>-1?(p=s.slice(i).split(t[2]).filter(n).sort(),s=s.slice(0,i)):p=[],o>-1?(e=s.slice(o).split(t[1]).filter(n).sort(),s=s.slice(0,o)):e=[],s=s.split(t[0]).filter(n),[s,e,p]}function o(t,s){var n,o,e,p,l,a,c,u,r=[],g=[];for(s=i(t,s),n=s[2],o=s[1],s=s[0],e=s.length;e;)r.push(s.join(m)),s.pop(),e--;if(e=o.length,e>1){for(u=1<<e,p=u-1;p>=1;p--){for(c=[],l=0,a=1;e>l;l++,a=1<<l)p!==a&&p&a&&c.push(o[l]);c.length&&g.push(c.join(d))}g=g.concat(o)}else e&&g.push(o[0]);return[r.length?r[0]:"",r,g,n]}function e(t,s,n){var i,o;for(i=0;n>i;i++)o=s[i],o in t?t[o]++:t[o]=1}function p(t,s,n){var i,o;for(i=0;n>i;i++)o=s[i],o in t&&(t[o]--,t[o]<=0&&delete t[o])}function l(t,s,n){var i,o;for(i=0;n>i;i++)if(o=s[i],!(o in t)||0>=t[o])return!1;return!0}function a(t,s,n,i,o,e){if(n){if(i){if(e>0){if(i in t.topics[n].tags&&t.topics[n].tags[i].list.length&&l(t.topics[n].tags[i].namespaces,o,e))return s.push([n,i,!0,t.topics[n].tags[i]]),!0}else if(i in t.topics[n].tags&&t.topics[n].tags[i].list.length)return s.push([n,i,null,t.topics[n].tags[i]]),!0}else if(e>0){if(t.topics[n].notags.list.length&&l(t.topics[n].notags.namespaces,o,e))return s.push([n,null,!0,t.topics[n].notags]),!0}else if(t.topics[n].notags.list.length)return s.push([n,null,null,t.topics[n].notags]),!0}else if(i){if(e>0){if(i in t.notopics.tags&&t.notopics.tags[i].list.length&&l(t.notopics.tags[i].namespaces,o,e))return s.push([null,i,!0,t.notopics.tags[i]]),!0}else if(i in t.notopics.tags&&t.notopics.tags[i].list.length)return s.push([null,i,null,t.notopics.tags[i]]),!0}else if(e>0&&t.notopics.notags.list.length&&l(t.notopics.notags.namespaces,o,e))return s.push([null,null,!0,t.notopics.notags]),!0;return!1}function c(t,s,n){var i,e,p,l,c,u,r=o(t,n),g=r[1],f=r[2],h=r[3],_=r[0],b=[];if(c=f.length,u=h.length,i=g.length)for(;i;){if(e=g[0],s.topics[e])if(c>0)for(l=0;c>l;l++)p=f[l],a(s,b,e,p,h,u);else a(s,b,e,null,h,u);g.shift(),i--}if(c>0)for(l=0;c>l;l++)p=f[l],a(s,b,null,p,h,u);return a(s,b,null,null,h,u),[_,b,h]}function u(s,n,i,o){if(n){var e,a,u,r,g,f,h,_,b,v,S,$,P,j,E,T,x,O,k=c(s,n,i);for(_=k[0],S=k[2],P=S.length,k=k[1],u=k.length,j=null,u>0&&(j=new t,j.originalTopic=_?_.split(m):[]),e=0;u>e;e++){for(b=k[e][0],v=k[e][1],j.topic=b?b.split(m):[],j.tags=v?v.split(d):[],$=k[e][2],f=k[e][3],g=[],E=[],r=f.list.length,a=0;r>a;a++)(!$||f.list[a][2]&&l(f.list[a][2],S,P))&&(f.list[a][1]&&E.push(a),g.push(f.list[a]));for(;E.length;)x=E.pop(),f.list[x][2]&&(O=y(f.list[x][2]),p(f.namespaces,O,O.length)),f.list.splice(x,1);for(r=g.length,a=0;r>a&&(h=g[a],j.namespaces=$?h[3].slice(0):[],T=h[0](j,o),!1!==T&&!j.eventStopped());a++);if(j.propagationStopped())break}j&&(j.dispose(),j=null)}}function r(t,s,n,o,p,l){if(s&&"function"==typeof o){n=i(t,n);var a,c,u,r=n[1].join(d),g=r.length,f=n[2],h=f.length;if(n=n[0].join(m),p=!0===p,l=!0===l,a={},h)for(u=0;h>u;u++)a[f[u]]=1;c=f.slice(0),n.length?(n in s.topics||(s.topics[n]={notags:{namespaces:{},list:[]},tags:{}}),g?(r in s.topics[n].tags||(s.topics[n].tags[r]={namespaces:{},list:[]}),h?(l?s.topics[n].tags[r].list.unshift([o,p,a,c]):s.topics[n].tags[r].list.push([o,p,a,c]),e(s.topics[n].tags[r].namespaces,f,h)):l?s.topics[n].tags[r].list.unshift([o,p,!1,[]]):s.topics[n].tags[r].list.push([o,p,!1,[]])):h?(l?s.topics[n].notags.list.unshift([o,p,a,c]):s.topics[n].notags.list.push([o,p,a,c]),e(s.topics[n].notags.namespaces,f,h)):l?s.topics[n].notags.list.unshift([o,p,!1,[]]):s.topics[n].notags.list.push([o,p,!1,[]])):g?(r in s.notopics.tags||(s.notopics.tags[r]={namespaces:{},list:[]}),h?(l?s.notopics.tags[r].list.unshift([o,p,a,c]):s.notopics.tags[r].list.push([o,p,a,c]),e(s.notopics.tags[r].namespaces,f,h)):l?s.notopics.tags[r].list.unshift([o,p,!1,[]]):s.notopics.tags[r].list.push([o,p,!1,[]])):h&&(l?s.notopics.notags.list.unshift([o,p,a,c]):s.notopics.notags.list.push([o,p,a,c]),e(s.notopics.notags.namespaces,f,h))}}function g(t,s,n,i,o){var e,a=t.list.length;if(s){if(null!=n&&a>0)for(;--a>=0;)n===t.list[a][0]&&(o&&t.list[a][2]&&l(t.list[a][2],i,o)?(e=y(t.list[a][2]),p(t.namespaces,e,e.length),t.list.splice(a,1)):o||(t.list[a][2]&&(e=y(t.list[a][2]),p(t.namespaces,e,e.length)),t.list.splice(a,1)))}else if(!s&&o>0&&a>0)for(;--a>=0;)t.list[a][2]&&l(t.list[a][2],i,o)&&(e=y(t.list[a][2]),p(t.namespaces,e,e.length),t.list.splice(a,1));else!s&&a>0&&(t.list=[],t.namespaces={})}function f(t,s,n,o){if(s){n=i(t,n);var e,p,l,a,c=n[1].join(d),u=n[2],r=c.length,f=u.length;if(n=n[0].join(m),l=n.length,a=!(!o||"function"!=typeof o),a||(o=null),l&&n in s.topics)r&&c in s.topics[n].tags?(g(s.topics[n].tags[c],a,o,u,f),s.topics[n].tags[c].list.length||delete s.topics[n].tags[c]):r||g(s.topics[n].notags,a,o,u,f),s.topics[n].notags.list.length||y(s.topics[n].tags).length||delete s.topics[n];else if(!l&&(r||f))if(r){c in s.notopics.tags&&(g(s.notopics.tags[c],a,o,u,f),s.notopics.tags[c].list.length||delete s.notopics.tags[c]);for(e in s.topics)c in s.topics[e].tags&&(g(s.topics[e].tags[c],a,o,u,f),s.topics[e].tags[c].list.length||delete s.topics[e].tags[c])}else{g(s.notopics.notags,a,o,u,f);for(p in s.notopics.tags)g(s.notopics.tags[p],a,o,u,f),s.notopics.tags[p].list.length||delete s.notopics.tags[p];for(e in s.topics){g(s.topics[e].notags,a,o,u,f);for(p in s.topics[e].tags)g(s.topics[e].tags[p],a,o,u,f),s.topics[e].tags[p].list.length||delete s.topics[e].tags[p]}}}}var h="0.3.2",_="/",b="#",v="@",m="/",d="#",y=Object.keys;t.prototype={constructor:t,topic:null,originalTopic:null,tags:null,namespaces:null,data:null,_stopPropagation:!1,_stopEvent:!1,dispose:function(){var t=this;return t.topic=null,t.originalTopic=null,t.tags=null,t.namespaces=null,t.data=null,t._stopPropagation=!0,t._stopEvent=!0,t},propagate:function(t){return arguments.length||(t=!0),this._stopPropagation=!t,this},stop:function(t){return arguments.length||(t=!0),this._stopEvent=!!t,this},propagationStopped:function(){return this._stopPropagation},eventStopped:function(){return this._stopEvent}};var S=function(){return this instanceof S?void this.initPubSub():new S};return S.VERSION=h,S.Event=t,S.prototype={constructor:S,_seps:null,_pubsub$:null,initPubSub:function(){var t=this;return t._seps=[_,b,v],t._pubsub$=s(),t},disposePubSub:function(){var t=this;return t._seps=null,t._pubsub$=null,t},setSeparators:function(t){if(t){var s=t.length;s>0&&t[0]&&(this._seps[0]=t[0]),s>1&&t[1]&&(this._seps[1]=t[1]),s>2&&t[2]&&(this._seps[2]=t[2])}return this},trigger:function(t,s,n){var i=this;return 3>arguments.length&&(n=0),n=+n,s=s||{},n>0?setTimeout(function(){u(i._seps,i._pubsub$,t,s)},n):u(i._seps,i._pubsub$,t,s),i},on:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s),n},one:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s,!0),n},on1:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s,!1,!0),n},one1:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s,!0,!0),n},off:function(t,s){var n=this;return f(n._seps,n._pubsub$,t,s||null),n}},S});

/**
*
*   FILTER.js
*   @version: 0.6.13
*   @dependencies: Classy.js, Asynchronous.js, PublishSubscribe
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n,r,i){"use strict";var a="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),s=!a&&"undefined"!=typeof navigator,l="function"==typeof importScripts&&navigator instanceof WorkerNavigator,o=Array,u=o.prototype,c=function(){var e=null;if(a)return e=__filename,{path:__dirname,file:__filename};if(l)e=self.location.href;else if(s){var t;(t=document.getElementsByTagName("script"))&&t.length&&(e=t[t.length-1].src)}return e?{path:e.split("/").slice(0,-1).join("/"),file:e}:{path:null,file:null}},h=c(),f=function(e,t){if(a)return t;if("."==t.charAt(0)){e=e.split("/"),t=t.split("/");var n,r=0,i=0,s=t.length,l=e.length;for(n=0;s>n;n++)if(/^\.\./.test(t[n]))r++,i++;else{if(!/^\./.test(t[n]))break;i++}r=r>=l?0:l-r,t=e.slice(0,r).concat(t.slice(i)).join("/")}return t};n=n?[].concat(n):[];var p,m,d,_=n.length,g=new o(_),v=new o(_),y=new o(_),b=new o(_);for(p=0;_>p;p++)g[p]=n[p][0],v[p]=n[p][1],y[p]=/\.js$/i.test(v[p])?f(h.path,v[p]):f(h.path,v[p]+".js");if("object"==typeof module&&module.exports){if(i===module.exports[t]){for(p=0;_>p;p++)b[p]=module.exports[g[p]]||require(y[p])[g[p]];m=r.apply(e,b),module.exports[t]=m||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(v),function(n){if(i===n[t]){for(var a=u.slice.call(arguments,1),s=a.length,l=0;s>l;l++)b[l]=n[g[l]]||a[l];m=r.apply(e,b),n[t]=m||1}});else if(l){for(p=0;_>p;p++)self[g[p]]||importScripts(y[p]),b[p]=self[g[p]];m=r.apply(e,b),self[t]=m||1}else if(i===e[t]){var w=function(e,t){d=d||document.getElementsByTagName("head")[0];var n=0,r=document.createElement("script");r.type="text/javascript",r.language="javascript",r.onload=r.onreadystatechange=function(){n||r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(n=1,r.onload=r.onreadystatechange=null,d.removeChild(r),r=null,t&&t())},r.src=e,d.appendChild(r)},A=function(t,n,r){e[t]?r():w(n,r)},E=function(n){return function(){_>n&&(b[n]=e[g[n]]),++n<_?A(g[n],y[n],E(n)):(m=r.apply(e,b),e[t]=m||1)}};_?A(g[0],y[0],E(0)):(m=r.apply(e,b),e[t]=m||1)}}(this,"FILTER",[["Classy","./classy"],["Asynchronous","./asynchronous"],["PublishSubscribe","./publishsubscribe"]],function(Classy,Asynchronous,PublishSubscribe){var FILTER=this.FILTER||{VERSION:"0.6.13",Class:Classy.Class,Merge:Classy.Merge,PublishSubscribe:PublishSubscribe,Asynchronous:Asynchronous,getPath:Asynchronous.currentPath,isNode:Asynchronous.isPlatform(Asynchronous.Platform.NODE),isBrowser:Asynchronous.isPlatform(Asynchronous.Platform.BROWSER),supportsWorker:Asynchronous.supportsMultiThreading(),isWorker:Asynchronous.isThread()};return!function(e,t){"use strict";var n,r=Object.prototype,i=Function.prototype,a=Array.prototype,s=i.call.bind(a.slice),l=(i.call.bind(r.toString),a.splice,a.concat,t.Merge),o=t.isNode,u=t.isBrowser,c=t.supportsWorker,h=t.isWorker,f=navigator?navigator.userAgent:"",p=t.Browser={isNode:o,isBrowser:u,isWorker:h,supportsWorker:c,isPhantom:/PhantomJS/.test(f),isOpera:u&&/Opera|OPR\//.test(f),isFirefox:u&&/Firefox\//.test(f),isChrome:u&&/Chrome\//.test(f),isSafari:u&&/Apple Computer/.test(navigator.vendor),isKhtml:u&&/KHTML\//.test(f),isIE:u&&(/MSIE \d/.test(f)||/Trident\/\d/.test(f)),isGecko:u&&/gecko\/\d/i.test(f),isWebkit:u&&/WebKit\//.test(f),isMac_geLion:u&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(f),isMac_geMountainLion:u&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(f),isMobile:!1,isIOS:/AppleWebKit/.test(f)&&/Mobile\/\w+/.test(f),isWin:/windows/i.test(navigator.platform),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};p.isMobile=p.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(f),p.isMac=p.isIOS||/Mac/.test(navigator.platform),p.isIE_lt8=p.isIE&&!h&&(null==document.documentMode||document.documentMode<8),p.isIE_lt9=p.isIE&&!h&&(null==document.documentMode||document.documentMode<9),p.isQtWebkit=p.isWebkit&&/Qt\/\d+\.\d+/.test(f);var m=t.devicePixelRatio=e.devicePixelRatio||1;t.getCanvas=t.createCanvas=function(e,t){var n=document.createElement("canvas");return e=e||0,t=t||0,n.style.width=e+"px",n.style.height=t+"px",n.width=e*m,n.height=t*m,n};var d=0;t.uuid=function(e){return[e||"fuuid",(new Date).getTime(),++d].join("_")};var _=t.URL=e.webkitURL||e.URL,g=function(e){return _.createObjectURL(new Blob([e||""],{type:"text/javascript"}))};t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(){},t.useWebGLSharedResourcesIfAvailable=function(){},t.Array=Array,t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array;var v=t._notSupportClamp="undefined"==typeof Uint8ClampedArray;if(t.ImArray=v?t.Array8U:Uint8ClampedArray,t.ImArrayCopy=p.isOpera?t.Array8U:t.ImArray,v&&"undefined"!=typeof CanvasPixelArray&&!CanvasPixelArray.prototype.set){var y=function(e,t){var n=e.length;for(t=t||0;--n>=0;)this[n+t]=e[n];return this};CanvasPixelArray.prototype.set=y}t.CONSTANTS={PI:Math.PI,PI2:2*Math.PI,PI_2:.5*Math.PI,SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI},t.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},t.LUMA=new t.Array32F([.212671,.71516,.072169]),n=t.log=console&&console.log?console.log:function(){},t.warning=function(e){n("WARNING: "+e)},t.error=function(e){n("ERROR: "+e)};var b=t.FilterThread=t.Class(t.Asynchronous,{path:t.getPath(),name:null,constructor:function(){var e=this,n=null;return h&&e.initThread().listen("load",function(e){e&&e.filter&&(n&&(n.dispose(!0),n=null),n=t.Asynchronous.load("FILTER."+e.filter))}).listen("import",function(e){e&&e["import"]&&e["import"].length&&importScripts(e["import"])}).listen("params",function(e){n&&n.unserialize(e)}).listen("apply",function(t){n&&t&&t.im?(t.params&&n.unserialize(t.params),e.send("apply",{im:n._apply(t.im[0],t.im[1],t.im[2])})):e.send("apply",{im:null})}).listen("dispose",function(){n&&(n.dispose(!0),n=null),e.dispose(!0),close()}),e},worker:function(e){var t=this;return arguments.length||(e=!0),e=!!e,!0===e?(t.fork("FILTER.FilterThread",t.path.file),t.send("load",{filter:t.name})):t.unfork(),t},sources:function(){var e=s(arguments);if(e.length){var t,n=[];for(t=0;t<e.length;t++)n.push("function"==typeof e[t]?g(e[t].toString()):g(e[t]));this.send("import",{"import":n.join(",")})}return this},scripts:function(){var e=s(arguments);return e.length&&this.send("import",{"import":e.join(",")}),this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{}}},unserialize:function(e){var t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn),t}}),w=t.Filter=t.Class({"extends":b,"implements":t.PublishSubscribe},{name:"Filter",constructor:function(){var e=this;e.initPubSub()},id:null,_isOn:!0,dispose:function(){var e=this;return e.$super("dispose"),e.disposePubSub(),e},isOn:function(){return this._isOn},turnOn:function(e){return arguments.length||(e=!0),this._isOn=!!e,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this},combineWith:function(){return this},_apply:function(e){return e},apply2:function(e,t,n){var r,i=this;return e&&t&&i._isOn&&(r=e.getSelectedData(),i.$thread?(n&&i.one("apply",function(){n(i)}),i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),i.trigger("apply",i)}).send("apply",{im:r,params:i.serialize()})):t.setSelectedData(i._apply(r[0],r[1],r[2],e))),e},apply:function(e,t){return e&&this._isOn&&this.apply2(e,e,t),e},toString:function(){return"[FILTER: "+this.name+"]"}}),A=function(){return"[FILTER Plugin: "+this.name+"]"};t.Create=function(e){e=l({init:function(){},name:"PluginFilter",toString:A,apply:function(e){return e}},e);var n=e.init;return e._apply=e.apply,e.constructor=function(){this.$super("constructor"),n.apply(this,s(arguments))},delete e.init,delete e.apply,t.Class(w,e)}}(this,FILTER),!function(e){"use strict";var t=Math.sqrt,n=Math.round,r=(Math.floor,Math.min),a=Math.max,s=(Math.abs,function(e,t,n){return a(r(e,n),t)}),l=function(e){return e.replace(/([.*+?^${}()|\[\]\/\\\-])/g,"\\$1")},o=function(e){return e.replace(/^\s+/gm,"").replace(/\s+$/gm,"")},u=1/255,c=100/255,h=2.55,f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},p=e.Color=e.Class({__static__:{clamp:s,clampPixel:function(e){return r(255,a(e,0))},ubyteToFloat:function(e){return.00392156862745098*e},ubyteColorToFloatColor:function(e){var t=e.length,n=new Array(t);for(i=0;t>i;i++)n[i]=.00392156862745098*e[i];return n},hexColorToFloatColor:function(e){var t,n,r,i;return t=e>>16&255,n=e>>8&255,r=255&e,i=e>>24&255,[.00392156862745098*t,.00392156862745098*n,.00392156862745098*r,.00392156862745098*i]},blend:function(e,t,n){return{r:e.r-~~((e.r-t.r)*n+.5),g:e.g-~~((e.g-t.g)*n+.5),b:e.b-~~((e.b-t.b)*n+.5)}},toGray:function(t,n,r){var i=e.LUMA;return~~(i[0]*t+i[1]*n+i[2]*r)},distance:function(e,n){var r=e.r-n.r,i=e.g-n.g,a=e.b-n.b;return t(r*r+i*i+a*a)},RGB2Color:function(e){return e.r<<16|e.g<<8|255&e.b},RGBA2Color:function(e){return e.a<<24|e.r<<16|e.g<<8|255&e.b},Color2RGBA:function(e){return e=~~e,{r:e>>>16&255,g:e>>>8&255,b:255&e,a:e>>>24&255}},RGB2YCbCr:function(e){var t,n,r,i=e.r,a=e.g,s=e.b;return t=~~(0+.299*i+.587*a+.114*s),n=~~(128-.168736*i-.331264*a+.5*s),r=~~(128+.5*i-.418688*a-.081312*s),{y:t,cb:n,cr:r}},YCbCr2RGB:function(e){var t,n,r,i=e.y,a=e.cb,s=e.cr;return t=~~(i+1.402*(s-128)),n=~~(i-.34414*(a-128)-.71414*(s-128)),r=~~(i+1.772*(a-128)),{r:t,g:n,b:r}},RGB2HSV:function(e){var t,n,i,s,l,o,u,c,h;return s=e.r,l=e.g,o=e.b,t=r(s,l,o),n=a(s,l,o),i=n-t,h=n,0==n?(c=0,u=0,{h:u,s:c,v:h}):(c=i/n,u=s==n?(l-o)/i:l==n?2+(o-s)/i:4+(s-l)/i,u*=60,0>u&&(u+=360),{h:u,s:c,v:h})},HSV2RGB:function(e){var t,n,r,i,a,s,l,o,u,c,h;if(u=e.h,c=e.s,h=e.v,0==c)return s=l=o=h,{r:s,g:l,b:o};switch(u/=60,t=~~u,n=u-t,r=h*(1-c),i=h*(1-c*n),a=h*(1-c*(1-n)),t){case 0:s=h,l=a,o=r;break;case 1:s=i,l=h,o=r;break;case 2:s=r,l=h,o=a;break;case 3:s=r,l=i,o=h;break;case 4:s=a,l=r,o=h;break;default:s=h,l=r,o=i}return{r:s,g:l,b:o}},toString:function(){return"[FILTER: "+this.name+"]"},C2F:u,C2P:c,P2C:h,Keywords:f,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(f).map(l).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(e,t){return e*c+(t||"")},per2col:function(e){return e*h},rgb2cmyk:function(e,t,i,a){var l,o,c=0,f=0,p=0,m=0;return a&&(e=s(n(e*h),0,255),t=s(n(t*h),0,255),i=s(n(i*h),0,255)),0==e&&0==t&&0==i?(m=1,[0,0,0,1]):(c=1-e*u,f=1-t*u,p=1-i*u,l=r(c,f,p),o=1/(1-l),c=(c-l)*o,f=(f-l)*o,p=(p-l)*o,m=l,[c,f,p,m])},cmyk2rgb:function(e,t,r,i){var a,l,o=0,u=0,c=0;return 0==e&&0==t&&0==r?[0,0,0]:(a=i,l=1-a,e=e*l+a,t=t*l+a,r=r*l+a,o=255*(1-e),u=255*(1-t),c=255*(1-r),[s(n(o),0,255),s(n(u),0,255),s(n(c),0,255)])},rgb2hex:function(e,t,r,i,a){var l;return a&&(e=s(n(e*h),0,255),t=s(n(t*h),0,255),r=s(n(r*h),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),l=i&&e[0]==e[1]&&t[0]==t[1]&&r[0]==r[1]?"#"+e[0]+t[0]+r[0]:"#"+e+t+r},rgb2hexIE:function(e,t,r,i,a){var l;return a&&(e=s(n(e*h),0,255),t=s(n(t*h),0,255),r=s(n(r*h),0,255),i=s(n(i*h),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),i=16>i?"0"+i.toString(16):i.toString(16),l="#"+i+e+t+r},hex2rgb:function(e){return!e||3>e.length?[0,0,0]:6>e.length?[s(parseInt(e[0]+e[0],16),0,255),s(parseInt(e[1]+e[1],16),0,255),s(parseInt(e[2]+e[2],16),0,255)]:[s(parseInt(e[0]+e[1],16),0,255),s(parseInt(e[2]+e[3],16),0,255),s(parseInt(e[4]+e[5],16),0,255)]},hue2rgb:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},hsl2rgb:function(e,t,r){var i,a,l,o,u;return e=(e+360)%360/360,t*=.01,r*=.01,0==t?(i=1,a=1,l=1):(u=.5>r?r*(1+t):r+t-r*t,o=2*r-u,i=p.hue2rgb(o,u,e+1/3),a=p.hue2rgb(o,u,e),l=p.hue2rgb(o,u,e-1/3)),[s(n(255*i),0,255),s(n(255*a),0,255),s(n(255*l),0,255)]},rgb2hsl:function(e,t,i,l){var o,c,h,f,p,m;return l?(e*=.01,t*=.01,i*=.01):(e*=u,t*=u,i*=u),c=a(e,t,i),o=r(e,t,i),p=.5*(c+o),c==o?h=f=0:(m=c-o,f=p>.5?m/(2-a-r):m/(a+r),h=c==e?(t-i)/m+(i>t?6:0):c==t?(i-e)/m+2:(e-t)/m+4,h/=6),[n(360*h)%360,s(100*f,0,100),s(100*p,0,100)]},parse:function(e,t,n,r){var i,a,s,l,u,h=0,f=0;if("hsl"==n||!n&&(i=e.match(p.hslRE))){if("hsl"==n){u="hsla"==e[0].toLowerCase();var m=e[1].split(",").map(o)}else{h=i[0].length,f=0,u="hsla"==i[1].toLowerCase();var m=i[2].split(",").map(o)}var d=m[0]?m[0]:"0",e=m[1]?m[1]:"0",_=m[2]?m[2]:"0",g=u&&null!=m[3]?m[3]:"1";return d=parseFloat(d,10),e="%"==e.slice(-1)?parseFloat(e,10):parseFloat(e,10)*c,_="%"==_.slice(-1)?parseFloat(_,10):parseFloat(_,10)*c,g=parseFloat(g,10),l=(new p).fromHSL([d,e,_,g]),t&&(s=e.substr(h),(a=s.match(p.colorstopRE))&&(l.colorStop(a[1]),f=a[0].length)),r?l:[l,0,h+f]}if("rgb"==n||!n&&(i=e.match(p.rgbRE))){if("rgb"==n){u="rgba"==e[0].toLowerCase();var m=e[1].split(",").map(o)}else{h=i[0].length,f=0,u="rgba"==i[1].toLowerCase();var m=i[2].split(",").map(o)}var v=m[0]?m[0]:"0",y=m[1]?m[1]:"0",b=m[2]?m[2]:"0",g=u&&null!=m[3]?m[3]:"1";return v="%"==v.slice(-1)?2.55*parseFloat(v,10):parseFloat(v,10),y="%"==y.slice(-1)?2.55*parseFloat(y,10):parseFloat(y,10),b="%"==b.slice(-1)?2.55*parseFloat(b,10):parseFloat(b,10),g=parseFloat(g,10),l=(new p).fromRGB([v,y,b,g]),t&&(s=e.substr(h),(a=s.match(p.colorstopRE))&&(l.colorStop(a[1]),f=a[0].length)),r?l:[l,0,h+f]}if("hex"==n||!n&&(i=e.match(p.hexRE))){if("hex"==n)var m=p.hex2rgb(e[0]);else{h=i[0].length,f=0;var m=p.hex2rgb(i[1])}var w=m[0]?m[0]:0,A=m[1]?m[1]:0,E=m[2]?m[2]:0,g=null!=m[3]?m[3]:255;return l=(new p).fromHEX([w,A,E,g]),t&&(s=e.substr(h),(a=s.match(p.colorstopRE))&&(l.colorStop(a[1]),f=a[0].length)),r?l:[l,0,h+f]}if("keyword"==n||!n&&(i=e.match(p.keywordRE))){if("keyword"==n)var m=e[0];else{h=i[0].length,f=0;var m=i[1]}return l=(new p).fromKeyword(m),t&&(s=e.substr(h),(a=s.match(p.colorstopRE))&&(l.colorStop(a[1]),f=a[0].length)),r?l:[l,0,h+f]}return null},fromString:function(e,t,n){return p.parse(e,t,n,1)},fromRGB:function(e){return(new p).fromRGB(e)},fromHSL:function(e){return(new p).fromHSL(e)},fromCMYK:function(e){return(new p).fromCMYK(e)},fromHEX:function(e){return(new p).fromHEX(e)},fromKeyword:function(e){return(new p).fromKeyword(e)},fromPixel:function(e){return(new p).fromPixel(e)}},constructor:function(e,t){return this instanceof p?(this.reset(),void(e&&this.set(e,t))):new p(e,t)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var e=new p;return e.col=this.col.slice(),e.cstop=this.cstop+"",e.kword=this.kword,e},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(e,t){return e&&(undef!==e[0]&&(this.col[0]=s(e[0],0,255)),undef!==e[1]&&(this.col[1]=s(e[1],0,255)),undef!==e[2]&&(this.col[2]=s(e[2],0,255)),this.col[3]=undef!==e[3]?s(e[3],0,1):1,t&&(this.cstop=t),this.kword=null),this},colorStop:function(e){return this.cstop=e,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return this.kword?!0:!1},fromPixel:function(e){return e=e||0,this.col=[s(e>>16&255,0,255),s(e>>8&255,0,255),s(255&e,0,255),s((e>>24&255)*u,0,1)],this.kword=null,this},fromKeyword:function(e){return e=e.toLowerCase(),p.Keywords[e]&&(this.col=p.Keywords[e].slice(),this.kword=e),this},fromHEX:function(e){return this.col[0]=e[0]?s(parseInt(e[0],10),0,255):0,this.col[1]=e[1]?s(parseInt(e[1],10),0,255):0,this.col[2]=e[2]?s(parseInt(e[2],10),0,255):0,this.col[3]=undef!==e[3]?s(parseInt(e[3],10)*u,0,1):1,this.kword=null,this},fromRGB:function(e){return this.col[0]=e[0]?s(n(e[0]),0,255):0,this.col[1]=e[1]?s(n(e[1]),0,255):0,this.col[2]=e[2]?s(n(e[2]),0,255):0,this.col[3]=undef!==e[3]?s(e[3],0,1):1,this.kword=null,this},fromCMYK:function(e){var t=p.cmyk2rgb(e[0]||0,e[1]||0,e[2]||0,e[3]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[4]?s(e[4],0,1):1,this.kword=null,this},fromHSL:function(e){var t=p.hsl2rgb(e[0]||0,e[1]||0,e[2]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[3]?s(e[3],0,1):1,this.kword=null,this},toPixel:function(e){return e?s(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(e,t,n){var r=p.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(e,t,n){return this.kword?this.kword:this.toHEX(1,t,n)},toHEX:function(e,t,r){return r?p.rgb2hexIE(this.col[0],this.col[1],this.col[2],s(n(255*this.col[3]),0,255)):p.rgb2hex(this.col[0],this.col[1],this.col[2],t)},toRGB:function(e,t,n){var r=this.col[3];return e?(t&&(r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(e,t,n){var r=this.col[3],i=p.rgb2hsl(this.col[0],this.col[1],this.col[2]);return e?(t&&(i[1]=0==i[1]?i[1]:i[1]+"%",i[2]=0==i[2]?i[2]:i[2]+"%",r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[i[0],i[1],i[2]].join(",")+")":"hsla("+[i[0],i[1],i[2],r].join(",")+")"):n?i:i.concat(this.col[3])},toColorStop:function(e){var t=this.cstop;return e?(t=t.length?t+",":"",1>this.col[3]?"color-stop("+t+this.toRGB(1,1)+")":"color-stop("+t+this.toHEX(1,1)+")"):(t=t.length?" "+t:"",1>this.col[3]?this.toRGB(1,1)+t:this.toHEX(1,1)+t)},toString:function(e,t){return e=e?e.toLowerCase():"hex","rgb"==e||"rgba"==e?this.toRGB(1,!1!==t,"rgb"==e):"hsl"==e||"hsla"==e?this.toHSL(1,!1!==t,"hsl"==e):"keyword"==e?this.toKeyword(1):this.toHEX(1,!1!==t,"hexie"==e)}})}(FILTER),!function(e){"use strict";function t(e){var t=f(e.width,e.height);return t.width=e.width,t.height=e.height,t}function n(e,t,n){return e.canvasElement.style.width=t+"px",e.canvasElement.width=e.width=t*u,e.canvasElement.style.height=n+"px",e.canvasElement.height=e.height=n*u,e._tmpCanvas&&(e._tmpCanvas.style.width=e.canvasElement.style.width,e._tmpCanvas.width=e.canvasElement.width,e._tmpCanvas.style.height=e.canvasElement.style.height,e._tmpCanvas.height=e.canvasElement.height),e}function r(e,t){return e.canvasElement.style.width=t+"px",e.canvasElement.width=e.width=t*u,e._tmpCanvas&&(e._tmpCanvas.style.width=e.canvasElement.style.width,e._tmpCanvas.width=e.canvasElement.width),e}function i(e,t){return e.canvasElement.style.height=t+"px",e.canvasElement.height=e.height=t*u,e._tmpCanvas&&(e._tmpCanvas.style.height=e.canvasElement.style.height,e._tmpCanvas.height=e.canvasElement.height),e}function a(e){var t,n,r,i,a,s,l,o,u,c=e.width,f=(e.height,c<<2),p=e.getPixelData().data,m=p.length,d=m>>2;for(t=new h(d),n=new h(d),r=new h(d),o=0,l=0,i=a=s=0,u=0;c>u;u++,l+=4,o++)i+=p[l],a+=p[l+1],s+=p[l+2],t[o]=i,n[o]=a,r[o]=s;for(l=f,u=0,o=0,i=a=s=0,l=f;m>l;l+=4,o++,u++)u>=c&&(u=0,i=a=s=0),i+=p[l],a+=p[l+1],s+=p[l+2],t[o+c]=t[o]+i,n[o+c]=n[o]+a,r[o+c]=r[o]+s;return e._integral=[t,n,r],e._needsRefresh&=~y,e}function s(e){var t,n,r,i,a,s,l,o,u,c,f=e.getPixelData().data,p=f.length,m=0,d=0,_=0,g=255,y=255,b=255,w=1/(p>>2);for(t=new h(256),n=new h(256),r=new h(256),c=0;256>c;c+=4)t[c]=0,n[c]=0,r[c]=0,t[c+1]=0,n[c+1]=0,r[c+1]=0,t[c+2]=0,n[c+2]=0,r[c+2]=0,t[c+3]=0,n[c+3]=0,r[c+3]=0;for(c=0;p>c;c+=4)i=f[c],a=f[c+1],s=f[c+2],t[i]+=w,n[a]+=w,r[s]+=w,i>m?m=i:g>i&&(g=i),a>d?d=a:y>a&&(y=a),s>_?_=s:b>s&&(b=s);for(l=o=u=0,c=0;256>c;c+=4)l+=t[c],t[c]=l,o+=n[c],n[c]=o,u+=r[c],r[c]=u,l+=t[c+1],t[c+1]=l,o+=n[c+1],n[c+1]=o,u+=r[c+1],r[c+1]=u,l+=t[c+2],t[c+2]=l,o+=n[c+2],n[c+2]=o,u+=r[c+2],r[c+2]=u,l+=t[c+3],t[c+3]=l,o+=n[c+3],n[c+3]=o,u+=r[c+3],r[c+3]=u;return e._histogram=[t,n,r],e._needsRefresh&=~v,e}function l(e){return e.imageData=e.context.getImageData(0,0,e.width,e.height),e._needsRefresh&=~_,e}function o(e){if(e.selection){var t=e.selection,n=e.width-1,r=e.height-1,i=m(t[0]*n),a=m(t[1]*r),s=m(t[2]*n)-i+1,l=m(t[3]*r)-a+1;e.imageDataSel=e.context.getImageData(i,a,s,l)}return e._needsRefresh&=~g,e}var u=e.devicePixelRatio,c=e.ImArray,h=e.Array32F,f=e.createCanvas,p=(e._notSupportTypedArrays,Math.min),m=Math.floor,d=e.blendModes={normal:function(e){return e},lighten:function(e,t){return t>e?t:e},darken:function(e,t){return t>e?e:t},multiply:function(e,t){return e*t*.003921568627451},average:function(e,t){return.5*(e+t)},add:function(e,t){return Math.min(255,e+t)},substract:function(e,t){return 255>e+t?0:e+t-255},difference:function(e,t){return Math.abs(e-t)},negation:function(e,t){return 255-Math.abs(255-e-t)},screen:function(e,t){return 255-((255-e)*(255-t)>>8)},exclusion:function(e,t){return e+t-2*e*t*.003921568627451},overlay:function(e,t){return 128>t?2*e*t*.003921568627451:255-2*(255-e)*(255-t)*.003921568627451},softLight:function(e,t){return 128>t?2*((e>>1)+64)*.003921568627451*t:255-2*(255-((e>>1)+64))*(255-t)*.003921568627451},hardLight:function(e,t){return 128>e?2*t*e*.003921568627451:255-2*(255-t)*(255-e)*.003921568627451},colorDodge:function(e,t){return 255==t?t:Math.min(255,(e<<8)/(255-t))},colorBurn:function(e,t){return 0==t?t:Math.max(0,255-(255-e<<8)/t)},linearLight:function(e,t){return 128>t?d.linearBurn(e,2*t):d.linearDodge(e,2*(t-128))},vividLight:function(e,t){return 128>t?d.colorBurn(e,2*t):d.colorDodge(e,2*(t-128))},pinLight:function(e,t){return 128>t?d.darken(e,2*t):d.lighten(e,2*(t-128))},hardMix:function(e,t){return d.vividLight(e,t)<128?0:255},reflect:function(e,t){return 255==t?t:Math.min(255,e*e/(255-t))},glow:function(e,t){return 255==e?e:Math.min(255,t*t/(255-e))},phoenix:function(e,t){return Math.min(e,t)-Math.max(e,t)+255}};d.linearDodge=d.add,d.linearBurn=d.substract;var _=1,g=2,v=4,y=8,b=e.Image=e.Class({"extends":Object,"implements":e.PublishSubscribe},{name:"Image",constructor:function(e,t){var n=this;n.width=0,n.height=0,n.context=null,n.selection=null,n.imageData=null,n.imageDataSel=null,n.domElement=n.canvasElement=f(n.width,n.height),n.context=n.canvasElement.getContext("2d"),n._tmpCanvas=null,n.webgl=null,n._histogram=null,n._integral=null,n._needsRefresh=0,n.initPubSub(),e&&n.setImage(e,t)},width:0,height:0,canvasElement:null,domElement:null,context:null,selection:null,imageData:null,imageDataSel:null,webgl:null,_histogram:null,_integral:null,_needsRefresh:0,_tmpCanvas:null,dispose:function(){var e=this;return e.width=null,e.height=null,e.context=null,e.selection=null,e.imageData=null,e.imageDataSel=null,e.domElement=null,e.canvasElement=null,e.context=null,e._tmpCanvas=null,e.webgl=null,e._histogram=null,e._integral=null,e._needsRefresh=null,e.disposePubSub(),e},select:function(e,t,n,r){var i=this,a=arguments.length;return 1>a&&(e=0),2>a&&(t=0),3>a&&(n=1),4>a&&(r=1),e=0>e?0:e>1?1:e,t=0>t?0:t>1?1:t,n=0>n?0:n>1?1:n,r=0>r?0:r>1?1:r,i.selection=[e,t,n,r],i._needsRefresh|=g,i},deselect:function(){var e=this;return e.selection=null,e.imageDataSel=null,e._needsRefresh&=~g,e},apply:function(e,t){return e&&e.apply2(this,this,t||null),this},apply2:function(e,t,n){return e&&t&&e.apply2(this,t,n||null),this},setWidth:function(e){var t=this;return r(t,e),t._needsRefresh|=_|v|y,t.selection&&(t._needsRefresh|=g),t},setHeight:function(e){var t=this;return i(t,e),t._needsRefresh|=_|v|y,t.selection&&(t._needsRefresh|=g),t},setDimensions:function(e,t){var r=this;return n(r,e,t),r._needsRefresh|=_|v|y,r.selection&&(r._needsRefresh|=g),r},setImage:function(t,r){if(!t)return this;var i,a,s,l,o=this,u=t instanceof HTMLVideoElement,c=t instanceof HTMLCanvasElement,h=t instanceof Image;return h||c||u?(r&&o.one("load",function(){r.call(o)}),i=t,s=u?i.videoWidth:i.width,l=u?i.videoHeight:i.height,a=o.context=n(o,s,l).canvasElement.getContext("2d"),a.drawImage(i,0,0),o._needsRefresh|=_|v|y,o.selection&&(o._needsRefresh|=g),o.webgl=e.useWebGL?new e.WebGL(o.canvasElement):null,o.trigger("load",o)):(r&&o.one("load",function(){r.call(o)}),i=new Image,i.onerror=i.onload=function(){i.width&&i.height&&(s=i.width,l=i.height,a=o.context=n(o,s,l).canvasElement.getContext("2d"),a.drawImage(i,0,0),o._needsRefresh|=_|v|y,o.selection&&(o._needsRefresh|=g),o.webgl=e.useWebGL?new e.WebGL(o.canvasElement):null),o.trigger("load",o)},i.crossOrigin="",i.src=t),o},getPixel:function(e,t){var n=this;n._needsRefresh&_&&l(n);var r=~~(t*n.width+e+.5),i=n.imageData.data;return{r:i[r],g:i[r+1],b:i[r+2],a:i[r+3]}},setPixel:function(e,t,n,r,i,a){var s=this,l=new c([255&n,255&r,255&i,255&a]);return s.context.putImageData(l,e,t),s._needsRefresh|=_|v|y,s.selection&&(s._needsRefresh|=g),s},getData:function(){var e=this;return e._needsRefresh&_&&l(e),new c(e.imageData.data)},getSelectedData:function(){var e,t=this;return t.selection?(t._needsRefresh&g&&o(t),e=t.imageDataSel):(t._needsRefresh&_&&l(t),e=t.imageData),[new c(e.data),e.width,e.height]},setData:function(e){var t=this;return t._needsRefresh&_&&l(t),t.imageData.data.set(e),t.context.putImageData(t.imageData,0,0),t._needsRefresh|=v|y,t.selection&&(t._needsRefresh|=g),t},setSelectedData:function(e){var t=this;if(t.selection){var n=t.selection,r=t.width-1,i=t.height-1,a=m(n[0]*r),s=m(n[1]*i);t._needsRefresh&g&&o(t),t.imageDataSel.data.set(e),t.context.putImageData(t.imageDataSel,a,s),t._needsRefresh|=_}else t._needsRefresh&_&&l(t),t.imageData.data.set(e),t.context.putImageData(t.imageData,0,0),t.selection&&(t._needsRefresh|=g);return t._needsRefresh|=v|y,t},getPixelData:function(){return this._needsRefresh&_&&l(this),this.imageData},setPixelData:function(e){var t=this;return t.context.putImageData(e,0,0),t._needsRefresh|=_|v|y,t.selection&&(t._needsRefresh|=g),t},createImageData:function(e,t){var r=this;return r.context=n(r,e,t).canvasElement.getContext("2d"),r.context.createImageData(e,t),r._needsRefresh|=_,r.selection&&(r._needsRefresh|=g),r},copy:function(e){return this.setData(e.getData()),this},clone:function(){return new b(this.canvasElement)},scale:function(e,n){var r=this;if(e=e||1,n=n||e,1==e&&1==n)return r;r._tmpCanvas=r._tmpCanvas||t(r);var i=r._tmpCanvas.getContext("2d");return i.scale(e,n),i.drawImage(r.canvasElement,0,0),r.width=~~(e*r.width+.5),r.height=~~(n*r.height+.5),r.canvasElement.style.width=r.width+"px",r.canvasElement.style.height=r.height+"px",r.canvasElement.width=r.width*u,r.canvasElement.height=r.height*u,r.context.drawImage(r._tmpCanvas,0,0),r._tmpCanvas.width=r.width,r._tmpCanvas.height=r.height,r._needsRefresh|=_|v|y,r.selection&&(r._needsRefresh|=g),r},flipHorizontal:function(){var e=this;e._tmpCanvas=e._tmpCanvas||t(e);var n=e._tmpCanvas.getContext("2d");return n.translate(e.width,0),n.scale(-1,1),n.drawImage(e.canvasElement,0,0),e.context.drawImage(e._tmpCanvas,0,0),e._needsRefresh|=_|v|y,e.selection&&(e._needsRefresh|=g),e},flipVertical:function(){var e=this;e._tmpCanvas=e._tmpCanvas||t(e);var n=e._tmpCanvas.getContext("2d");return n.translate(0,e.height),n.scale(1,-1),n.drawImage(e.canvasElement,0,0),e.context.drawImage(e._tmpCanvas,0,0),e._needsRefresh|=_|v|y,e.selection&&(e._needsRefresh|=g),e},clear:function(){var e=this;if(e.width&&e.height){var t=e.context;t.clearRect(0,0,e.width,e.height),e._needsRefresh|=_|v|y,e.selection&&(e._needsRefresh|=g)}return e},fill:function(e,t,r,i,a){var s=this;if(!i&&s.width&&!a&&s.height)return s;i&&!s.width&&a&&!s.height&&(s.context=n(s,i,a).canvasElement.getContext("2d"),s.context.createImageData(i,a)),e=e||0,t=t||0,r=r||0,i=i||s.width,a=a||s.height;var l=s.context;return l.fillStyle=e,l.fillRect(t,r,i,a),s._needsRefresh|=_|v|y,s.selection&&(s._needsRefresh|=g),s},draw:function(){return this},blend:function(e,t,n,r,i){var a=this;"undefined"==typeof t&&(t="normal"),"undefined"==typeof n&&(n=1),n>1?n=1:0>n&&(n=0),"undefined"==typeof r&&(r=0),"undefined"==typeof i&&(i=0);var s=0,l=0,o=a.context;if(0>r&&(s=-r,r=0),0>i&&(l=-i,i=0),r>=a.width||i>=a.height)return a;var u=d[t]||null;if(!u)return a;var c,h,f,m,b,w,A,E=p(a.width,e.width-s),L=p(a.height,e.height-l),M=a.context.getImageData(r,i,E,L),R=e.context.getImageData(s,l,E,L),I=M.data,C=R.data,x=1-n,N=C.length;for(A=0;N>A;A+=4)m=I[A],b=I[A+1],w=I[A+2],c=u(C[A],m),h=u(C[A+1],b),f=u(C[A+2],w),I[A]=c*n+m*x,I[A+1]=h*n+b*x,I[A+2]=f*n+w*x;return o.putImageData(M,r,i),a._needsRefresh|=_|v|y,a.selection&&(a._needsRefresh|=g),a},integral:function(){return this._needsRefresh&y&&a(this),this._integral
},histogram:function(){return this._needsRefresh&v&&s(this),this._histogram},toString:function(){return"[FILTER Image: "+this.name+"]"}}),w=e.ScaledImage=e.Class(b,{name:"ScaledImage",constructor:function(e,t,n,r){var i=this;i.scaleX=e||1,i.scaleY=t||i.scaleX,i.$super("constructor",n,r)},scaleX:1,scaleY:1,clone:function(){return new w(this.scaleX,this.scaleY,this.canvasElement)},setScale:function(e,t){var n=this,r=arguments.length;return r>0&&null!=e&&(n.scaleX=e,n.scaleY=e),r>1&&null!=t&&(n.scaleY=t),n},setImage:function(t,r){if(!t)return this;var i,a,s,l,o,u,c=this,h=c.scaleX,f=c.scaleY,p=t instanceof HTMLVideoElement,m=t instanceof HTMLCanvasElement,d=t instanceof Image;return d||m||p?(r&&c.one("load",function(){r.call(c)}),i=t,s=p?i.videoWidth:i.width,l=p?i.videoHeight:i.height,o=~~(h*s+.5),u=~~(f*l+.5),a=c.context=n(c,o,u).canvasElement.getContext("2d"),a.drawImage(i,0,0,s,l,0,0,o,u),c._needsRefresh|=_|v|y,c.selection&&(c._needsRefresh|=g),c.webgl=e.useWebGL?new e.WebGL(c.canvasElement):null,c.trigger("load",c)):(r&&c.one("load",function(){r.call(c)}),i=new Image,i.onerror=i.onload=function(){i.width&&i.height&&(s=i.width,l=i.height,o=~~(h*s+.5),u=~~(f*l+.5),a=c.context=n(c,s,l).canvasElement.getContext("2d"),a.drawImage(i,0,0,s,l,0,0,o,u),c._needsRefresh|=_|v|y,c.selection&&(c._needsRefresh|=g),c.webgl=e.useWebGL?new e.WebGL(c.canvasElement):null),c.trigger("load",c)},i.crossOrigin="",i.src=t),c}})}(FILTER),!function(e){"use strict";var t=Object.prototype,n=Function.prototype,r=Array.prototype,i=n.call.bind(r.slice),a=(n.call.bind(t.toString),r.splice),s=r.concat,l=e.CompositeFilter=e.Class(e.Filter,{name:"CompositeFilter",constructor:function(e){var t=this;t.$super("constructor"),t._stack=e&&e.length?e.slice():[]},_stack:null,_stable:!0,dispose:function(e){var t,n=this,r=n._stack;if(n.$super("dispose"),!0===e)for(t=0;t<r.length;t++)r[t]&&r[t].dispose(e),r[t]=null;return n._stack=null,n},serialize:function(){var e,t=this,n={filter:t.name,_isOn:!!t._isOn,_stable:!!t._stable,filters:[]},r=t._stack;for(e=0;e<r.length;e++)n.filters.push(r[e].serialize());return n},unserialize:function(t){var n,r,i,a,s,l=this,o=l._stack;if(t&&l.name===t.filter){if(l._isOn=!!t._isOn,l._stable=!!t._stable,a=t.filters||[],r=a.length,i=o.length,r===i&&l._stable)for(n=0;r>n;n++)o[n]=o[n].unserialize(a[n]);else{for(n=0;i>n;n++)o[n]&&o[n].dispose(!0),o[n]=null;for(o=[],n=0;r>n;n++){if(s=a[n]&&a[n].filter?e[a[n].filter]:null,!s)throw new Error('Filter "'+a[n].filter+'" could not be created');o.push((new s).unserialize(a[n]))}}l._stack=o}return l},stable:function(e){return arguments.length||(e=!0),this._stable=!!e,this},filters:function(e){return arguments.length?(this._stack=e.slice(),this):this._stack.slice()},push:function(){var e=i(arguments),t=e.length;return t&&(this._stack=s.apply(this._stack,e)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var e=i(arguments),t=e.length;return t&&a.apply(this._stack,[0,0].concat(e)),this},getAt:function(e){return this._stack.length>e?this._stack[e]:null},setAt:function(e,t){return this._stack.length>e?this._stack[e]=t:this._stack.push(t),this},insertAt:function(e){{var t=i(arguments);t.length}return argslen>1&&(t.shift(),a.apply(this._stack,[e,0].concat(t))),this},removeAt:function(e){return this._stack.splice(e,1)},remove:function(e){for(var t=this._stack.length;--t>=0;)e===this._stack[t]&&this._stack.splice(t,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(e,t,n,r){var i=this;if(i._isOn&&i._stack.length){var a,s,l=i._stack,o=l.length;for(a=0;o>a;a++)s=l[a],s&&s._isOn&&(e=s._apply(e,t,n,r))}return e},apply2:function(e,t,n){var r,i=this;return e&&t&&i._isOn&&i._stack.length&&(r=e.getSelectedData(),i.$thread?(n&&i.one("apply",function(){n(i)}),i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),i.trigger("apply",i)}).send("apply",{im:r,params:i.serialize()})):t.setSelectedData(i._apply(r[0],r[1],r[2],e))),e},toString:function(){return["[FILTER: "+this.name+"]","[","    "+this._stack.join("\n    "),"]",""].join("\n")}});l.prototype.empty=l.prototype.reset,l.prototype.concat=l.prototype.push}(FILTER),!function(FILTER,undef){"use strict";var CustomFilter=FILTER.CustomFilter=FILTER.Class(FILTER.Filter,{name:"CustomFilter",constructor:function(e){var t=this;t.$super("constructor"),t._handler=e&&"function"==typeof e?e:null},_handler:null,dispose:function(){var e=this;return e.$super("dispose"),e._handler=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_handler:e._handler?e._handler.toString():null}}},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self._handler=null,params._handler&&(self._handler=eval('(function(){ "use strict"; return '+params._handler+"})();"))),self},_apply:function(e,t,n,r){var i=this;return i._isOn&&i._handler?i._handler(i,e,t,n,r):e},apply2:function(e,t,n){var r,i=this;return e&&t&&i._isOn&&i._handler&&(r=e.getSelectedData(),i.$thread?(n&&i.one("apply",function(){n(i)}),i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),i.trigger("apply",i)}).send("apply",{im:r,params:i.serialize()})):t.setSelectedData(i._handler(i,r[0],r[1],r[2],e))),e}})}(FILTER),!function(e,t){"use strict";function n(e,t){var n,r,i,a,l,o=new s(20);return n=t[0],r=t[1],i=t[2],a=t[3],l=t[4],o[0]=n*e[0]+r*e[5]+i*e[10]+a*e[15],o[1]=n*e[1]+r*e[6]+i*e[11]+a*e[16],o[2]=n*e[2]+r*e[7]+i*e[12]+a*e[17],o[3]=n*e[3]+r*e[8]+i*e[13]+a*e[18],o[4]=n*e[4]+r*e[9]+i*e[14]+a*e[19]+l,n=t[5],r=t[6],i=t[7],a=t[8],l=t[9],o[5]=n*e[0]+r*e[5]+i*e[10]+a*e[15],o[6]=n*e[1]+r*e[6]+i*e[11]+a*e[16],o[7]=n*e[2]+r*e[7]+i*e[12]+a*e[17],o[8]=n*e[3]+r*e[8]+i*e[13]+a*e[18],o[9]=n*e[4]+r*e[9]+i*e[14]+a*e[19]+l,n=t[10],r=t[11],i=t[12],a=t[13],l=t[14],o[10]=n*e[0]+r*e[5]+i*e[10]+a*e[15],o[11]=n*e[1]+r*e[6]+i*e[11]+a*e[16],o[12]=n*e[2]+r*e[7]+i*e[12]+a*e[17],o[13]=n*e[3]+r*e[8]+i*e[13]+a*e[18],o[14]=n*e[4]+r*e[9]+i*e[14]+a*e[19]+l,n=t[15],r=t[16],i=t[17],a=t[18],l=t[19],o[15]=n*e[0]+r*e[5]+i*e[10]+a*e[15],o[16]=n*e[1]+r*e[6]+i*e[11]+a*e[16],o[17]=n*e[2]+r*e[7]+i*e[12]+a*e[17],o[18]=n*e[3]+r*e[8]+i*e[13]+a*e[18],o[19]=n*e[4]+r*e[9]+i*e[14]+a*e[19]+l,o}function r(e,t,n){var r=1-n,i=new s(20);return i[0]=r*e[0]+n*t[0],i[1]=r*e[1]+n*t[1],i[2]=r*e[2]+n*t[2],i[3]=r*e[3]+n*t[3],i[4]=r*e[4]+n*t[4],i[5]=r*e[5]+n*t[5],i[6]=r*e[6]+n*t[6],i[7]=r*e[7]+n*t[7],i[8]=r*e[8]+n*t[8],i[9]=r*e[9]+n*t[9],i[10]=r*e[10]+n*t[10],i[11]=r*e[11]+n*t[11],i[12]=r*e[12]+n*t[12],i[13]=r*e[13]+n*t[13],i[14]=r*e[14]+n*t[14],i[15]=r*e[15]+n*t[15],i[16]=r*e[16]+n*t[16],i[17]=r*e[17]+n*t[17],i[18]=r*e[18]+n*t[18],i[19]=r*e[19]+n*t[19],i}var i=Math.sin,a=Math.cos,s=e.Array32F,l=e.CONSTANTS.toRad,o=(e.CONSTANTS.toDeg,e._notSupportClamp),u=e.ColorMatrixFilter=e.Class(e.Filter,{name:"ColorMatrixFilter",constructor:function(t){var n=this;n.$super("constructor"),n._matrix=t&&t.length?new s(t):null,e.useWebGL&&(n._webglInstance=e.WebGLColorMatrixFilterInstance||null)},_matrix:null,_webglInstance:null,dispose:function(){var e=this;return e.$super("dispose"),e._webglInstance=null,e._matrix=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_matrix:e._matrix}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._matrix=t._matrix),n},channel:function(n,r){r=r===t?!1:r;var i=r?1:0;switch(n){case e.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case e.CHANNEL.BLUE:return this.set([0,0,i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,0,0,255]);case e.CHANNEL.GREEN:return this.set([0,i,0,0,0,0,1,0,0,0,0,i,0,0,0,0,0,0,0,255]);case e.CHANNEL.RED:default:return this.set([1,0,0,0,0,i,0,0,0,0,i,0,0,0,0,0,0,0,0,255])}},redChannel:function(t){return this.channel(e.CHANNEL.RED,t)},greenChannel:function(t){return this.channel(e.CHANNEL.GREEN,t)},blueChannel:function(t){return this.channel(e.CHANNEL.BLUE,t)},alphaChannel:function(){return this.channel(e.CHANNEL.ALPHA,!0)},maskChannel:function(t){switch(t){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(t,n){switch(t){case e.CHANNEL.ALPHA:switch(n){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case e.CHANNEL.BLUE:switch(n){case e.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.BLUE:return this;case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case e.CHANNEL.GREEN:switch(n){case e.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this;case e.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case e.CHANNEL.RED:default:switch(n){case e.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case e.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this}}},desaturate:function(){return this.set([e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,0,0,0,1,0])},colorize:function(n,r){var i,a,s,l;return r===t&&(r=1),i=.00392156862745098*(n>>16&255),a=.00392156862745098*(n>>8&255),s=.00392156862745098*(255&n),l=1-r,this.set([l+r*i*e.LUMA[0],r*i*e.LUMA[1],r*i*e.LUMA[2],0,0,r*a*e.LUMA[0],l+r*a*e.LUMA[1],r*a*e.LUMA[2],0,0,r*s*e.LUMA[0],r*s*e.LUMA[1],l+r*s*e.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(t){var n,r,i,a;return n=1-t,r=n*e.LUMA[0],i=n*e.LUMA[1],a=n*e.LUMA[2],this.set([r+t,i,a,0,0,r,i+t,a,0,0,r,i,a+t,0,0,0,0,0,1,0])},contrast:function(e,n,r){return n===t&&(n=e),r===t&&(r=e),e+=1,n+=1,r+=1,this.set([e,0,0,0,128*(1-e),0,n,0,0,128*(1-n),0,0,r,0,128*(1-r),0,0,0,1,0])},brightness:function(e,n,r){return n===t&&(n=e),r===t&&(r=e),this.set([1,0,0,0,e,0,1,0,0,n,0,0,1,0,r,0,0,0,1,0])},adjustHue:function(t){t*=l;var n=a(t),r=i(t);return this.set([e.LUMA[0]+n*(1-e.LUMA[0])+r*-e.LUMA[0],e.LUMA[1]+n*-e.LUMA[1]+r*-e.LUMA[1],e.LUMA[2]+n*-e.LUMA[2]+r*(1-e.LUMA[2]),0,0,e.LUMA[0]+n*-e.LUMA[0]+.143*r,e.LUMA[1]+n*(1-e.LUMA[1])+.14*r,e.LUMA[2]+n*-e.LUMA[2]+r*-.283,0,0,e.LUMA[0]+n*-e.LUMA[0]+r*-(1-e.LUMA[0]),e.LUMA[1]+n*-e.LUMA[1]+r*e.LUMA[1],e.LUMA[2]+n*(1-e.LUMA[2])+r*e.LUMA[2],0,0,0,0,0,1,0])},average:function(e,n,r){return e===t&&(e=.3333),n===t&&(n=.3333),r===t&&(r=.3334),this.set([e,n,r,0,0,e,n,r,0,0,e,n,r,0,0,0,0,0,1,0])},quickContrastCorrection:function(e){return e===t&&(e=1.2),this.set([e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0])},sepia:function(e){return e===t&&(e=.5),e>1?e=1:0>e&&(e=0),this.set([1-.607*e,.769*e,.189*e,0,0,.349*e,1-.314*e,.168*e,0,0,.272*e,.534*e,1-.869*e,0,0,0,0,0,1,0])},sepia2:function(n){return n===t&&(n=10),n>100&&(n=100),n*=2.55,this.set([e.LUMA[0],e.LUMA[1],e.LUMA[2],0,40,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,20,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,-n,0,0,0,1,0])},threshold:function(n,r){return r===t&&(r=256),this.set([e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,0,0,0,1,0])},threshold_rgb:function(e,n){return n===t&&(n=256),this.set([n,0,0,0,-(n-1)*e,0,n,0,0,-(n-1)*e,0,0,n,0,-(n-1)*e,0,0,0,1,0])},threshold_alpha:function(e,n){return e===t&&(e=.5),n===t&&(n=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,n,-n*e])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(e,t){return this._matrix=this._matrix?r(this._matrix,e.getMatrix(),t):new s(e.getMatrix()),this},set:function(e){return this._matrix=this._matrix?n(this._matrix,new s(e)):new s(e),this},reset:function(){return this._matrix=null,this},combineWith:function(e){return this.set(e.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(e){return this._matrix=new s(e),this},_apply:function(e){var t=this;if(t._isOn&&t._matrix){var n,r,i,a,s,l,o,u,c,h,f,p,m,d,_,g,v,y,b,w,A,E=e.length,L=t._matrix,M=(E>>2)%4;for(n=0;E>n;n+=16)y=e[n],b=e[n+1],w=e[n+2],A=e[n+3],r=L[0]*y+L[1]*b+L[2]*w+L[3]*A+L[4],i=L[5]*y+L[6]*b+L[7]*w+L[8]*A+L[9],a=L[10]*y+L[11]*b+L[12]*w+L[13]*A+L[14],s=L[15]*y+L[16]*b+L[17]*w+L[18]*A+L[19],y=e[n+4],b=e[n+5],w=e[n+6],A=e[n+7],l=L[0]*y+L[1]*b+L[2]*w+L[3]*A+L[4],o=L[5]*y+L[6]*b+L[7]*w+L[8]*A+L[9],u=L[10]*y+L[11]*b+L[12]*w+L[13]*A+L[14],c=L[15]*y+L[16]*b+L[17]*w+L[18]*A+L[19],y=e[n+8],b=e[n+9],w=e[n+10],A=e[n+11],h=L[0]*y+L[1]*b+L[2]*w+L[3]*A+L[4],f=L[5]*y+L[6]*b+L[7]*w+L[8]*A+L[9],p=L[10]*y+L[11]*b+L[12]*w+L[13]*A+L[14],m=L[15]*y+L[16]*b+L[17]*w+L[18]*A+L[19],y=e[n+12],b=e[n+13],w=e[n+14],A=e[n+15],d=L[0]*y+L[1]*b+L[2]*w+L[3]*A+L[4],_=L[5]*y+L[6]*b+L[7]*w+L[8]*A+L[9],g=L[10]*y+L[11]*b+L[12]*w+L[13]*A+L[14],v=L[15]*y+L[16]*b+L[17]*w+L[18]*A+L[19],e[n]=~~r,e[n+1]=~~i,e[n+2]=~~a,e[n+3]=~~s,e[n+4]=~~l,e[n+5]=~~o,e[n+6]=~~u,e[n+7]=~~c,e[n+8]=~~h,e[n+9]=~~f,e[n+10]=~~p,e[n+11]=~~m,e[n+12]=~~d,e[n+13]=~~_,e[n+14]=~~g,e[n+15]=~~v;if(M)for(M<<=2,n=E-M;E>n;n+=4)y=e[n],b=e[n+1],w=e[n+2],A=e[n+3],r=L[0]*y+L[1]*b+L[2]*w+L[3]*A+L[4],i=L[5]*y+L[6]*b+L[7]*w+L[8]*A+L[9],a=L[10]*y+L[11]*b+L[12]*w+L[13]*A+L[14],s=L[15]*y+L[16]*b+L[17]*w+L[18]*A+L[19],e[n]=~~r,e[n+1]=~~i,e[n+2]=~~a,e[n+3]=~~s}return e},apply2:function(e,t,n){var r,i=this;return e&&t&&i._isOn&&i._matrix&&(i.$thread?(n&&i.one("apply",function(){n(i)}),i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),i.trigger("apply",i)}).send("apply",{im:e.getSelectedData(),params:i.serialize()})):(r=e.getSelectedData(),t.setSelectedData(i._apply(r[0],r[1],r[2],e)))),e}});u.prototype.grayscale=u.prototype.desaturate,u.prototype.rotateHue=u.prototype.adjustHue,u.prototype.thresholdRgb=u.prototype.threshold_rgb,u.prototype.thresholdAlpha=u.prototype.threshold_alpha,o&&(u.prototype._apply=function(e){var t=this;if(t._isOn&&t._matrix){var n,r,i,a,s,l,o,u,c,h,f,p,m,d,_,g,v,y,b,w,A,E=e.length,L=t._matrix,M=(E>>2)%4;for(n=0;E>n;n+=16)y=e[n],b=e[n+1],w=e[n+2],A=e[n+3],r=L[0]*y+L[1]*b+L[2]*w+L[3]*A+L[4],i=L[5]*y+L[6]*b+L[7]*w+L[8]*A+L[9],a=L[10]*y+L[11]*b+L[12]*w+L[13]*A+L[14],s=L[15]*y+L[16]*b+L[17]*w+L[18]*A+L[19],y=e[n+4],b=e[n+5],w=e[n+6],A=e[n+7],l=L[0]*y+L[1]*b+L[2]*w+L[3]*A+L[4],o=L[5]*y+L[6]*b+L[7]*w+L[8]*A+L[9],u=L[10]*y+L[11]*b+L[12]*w+L[13]*A+L[14],c=L[15]*y+L[16]*b+L[17]*w+L[18]*A+L[19],y=e[n+8],b=e[n+9],w=e[n+10],A=e[n+11],h=L[0]*y+L[1]*b+L[2]*w+L[3]*A+L[4],f=L[5]*y+L[6]*b+L[7]*w+L[8]*A+L[9],p=L[10]*y+L[11]*b+L[12]*w+L[13]*A+L[14],m=L[15]*y+L[16]*b+L[17]*w+L[18]*A+L[19],y=e[n+12],b=e[n+13],w=e[n+14],A=e[n+15],d=L[0]*y+L[1]*b+L[2]*w+L[3]*A+L[4],_=L[5]*y+L[6]*b+L[7]*w+L[8]*A+L[9],g=L[10]*y+L[11]*b+L[12]*w+L[13]*A+L[14],v=L[15]*y+L[16]*b+L[17]*w+L[18]*A+L[19],r=0>r?0:r>255?255:r,i=0>i?0:i>255?255:i,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,o=0>o?0:o>255?255:o,u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,p=0>p?0:p>255?255:p,m=0>m?0:m>255?255:m,d=0>d?0:d>255?255:d,_=0>_?0:_>255?255:_,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,e[n]=~~r,e[n+1]=~~i,e[n+2]=~~a,e[n+3]=~~s,e[n+4]=~~l,e[n+5]=~~o,e[n+6]=~~u,e[n+7]=~~c,e[n+8]=~~h,e[n+9]=~~f,e[n+10]=~~p,e[n+11]=~~m,e[n+12]=~~d,e[n+13]=~~_,e[n+14]=~~g,e[n+15]=~~v;if(M)for(M<<=2,n=E-M;E>n;n+=4)y=e[n],b=e[n+1],w=e[n+2],A=e[n+3],r=L[0]*y+L[1]*b+L[2]*w+L[3]*A+L[4],i=L[5]*y+L[6]*b+L[7]*w+L[8]*A+L[9],a=L[10]*y+L[11]*b+L[12]*w+L[13]*A+L[14],s=L[15]*y+L[16]*b+L[17]*w+L[18]*A+L[19],r=0>r?0:r>255?255:r,i=0>i?0:i>255?255:i,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,e[n]=~~r,e[n+1]=~~i,e[n+2]=~~a,e[n+3]=~~s}return e})}(FILTER),!function(e,t){"use strict";var n=e.ImArrayCopy,r=e.Color.clampPixel,i=function(e){var t=new n(256),r=0;if(e)for(;256>r;)t[r]=255-r,r++;else for(;256>r;)t[r]=r,r++;return t},a=function(e){for(var t=new n(256),r=0;256>r;)t[r]=e,r++;return t},s=function(e){return e?new n(e):null},l=Math.pow,o=Math.exp,u=1/255,c=i(),h=i(1),f=e.TableLookupFilter=e.Class(e.Filter,{name:"TableLookupFilter",constructor:function(e,t,n,r){var i=this;i.$super("constructor"),i._tableR=e||null,i._tableG=t||i._tableR,i._tableB=n||i._tableG,i._tableA=r||null},_tableR:null,_tableG:null,_tableB:null,_tableA:null,dispose:function(){var e=this;return e.$super("dispose"),e._tableR=null,e._tableG=null,e._tableB=null,e._tableA=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_tableR:e._tableR,_tableG:e._tableG,_tableB:e._tableB,_tableA:e._tableA}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._tableR=t._tableR,n._tableG=t._tableG,n._tableB=t._tableB,n._tableA=t._tableA),n},thresholds:function(e,t,i){e.length||(e=[e]),t||(t=e),i||(i=t);var a,s,l=e.length,o=l+1,u=t.length,c=u+1,h=i.length,f=h+1,p=new n(256),m=new n(o),d=new n(256),_=new n(c),g=new n(256),v=new n(f),y=255/(o-1),b=255/(c-1),w=255/(f-1);for(a=0;o>a;)m[a]=~~(y*a),a++;for(e[0]=~~(255*e[0]),a=1;l>a;)e[a]=e[a-1]+~~(255*e[a]),a++;for(a=0;c>a;)_[a]=~~(b*a),a++;for(t[0]=~~(255*t[0]),a=1;u>a;)t[a]=t[a-1]+~~(255*t[a]),a++;for(a=0;f>a;)v[a]=~~(w*a),a++;for(i[0]=~~(255*i[0]),a=1;h>a;)i[a]=i[a-1]+~~(255*i[a]),a++;for(a=0;256>a;){for(s=0;l>s&&a>e[s];)s++;for(p[a]=r(m[s]),s=0;u>s&&a>t[s];)s++;for(d[a]=r(_[s]),s=0;h>s&&a>i[s];)s++;g[a]=r(v[s]),a++}return this.set(p,d,g)},threshold:function(e,t,n){return e=e||.5,t=t||e,n=n||t,this.thresholds([e],[t],[n])},quantize:function(e){e===t&&(e=64),2>e&&(e=2);var i,a=new n(256),s=new n(e),l=255/(e-1),o=e/256;for(i=0;e>i;)s[i]=~~(l*i),i++;for(i=0;256>i;)a[i]=r(s[~~(o*i)]),i++;return this.set(a)},binarize:function(){return this.quantize(2)},solarize:function(e){e===t&&(e=.5);var i,a,s=0,l=new n(256),o=2/255;for(s=0;256>s;)i=o*s,a=i>e?255-255*i:255*i-255,l[s]=~~r(a),s++;return this.set(l)},solarize2:function(e){e===t&&(e=.5),e=1-e;var i,a,s=0,l=new n(256),o=2/255;for(s=0;256>s;)i=o*s,a=e>i?255-255*i:255*i-255,l[s]=~~r(a),s++;return this.set(l)},solarizeInverse:function(e){e===t&&(e=.5),e*=256;var r=0,i=new n(256);for(r=0;256>r;)i[r]=r>e?255-r:r,r++;return this.set(i)},invert:function(){return this.set(h)},mask:function(e){var t=0,i=e>>16&255,a=e>>8&255,s=255&e;for(tR=new n(256),tG=new n(256),tB=new n(256),t=0;256>t;)tR[t]=r(t&i),tG[t]=r(t&a),tB[t]=r(t&s),t++;return this.set(tR,tG,tB)},replace:function(e,t){if(e==t)return this;var n=e>>16&255,r=e>>8&255,i=255&e,a=t>>16&255,l=t>>8&255,o=255&t,u=s(c),h=s(c),f=s(c);return u[n]=a,h[r]=l,f[i]=o,this.set(u,h,f)},extract:function(t,n,i){if(!n||!n.length)return this;i=i||0;var s,l,o=i>>16&255,u=i>>8&255,c=255&i,h=a(o),f=a(u),p=a(c);switch(t){case e.CHANNEL.BLUE:for(s=n[0],l=n[1];l>=s;)p[s]=r(s),s++;break;case e.CHANNEL.GREEN:for(s=n[0],l=n[1];l>=s;)f[s]=r(s),s++;break;case e.CHANNEL.RED:default:for(s=n[0],l=n[1];l>=s;)h[s]=r(s),s++}return this.set(h,f,p)},gammaCorrection:function(e,t,i){e=e||1,t=t||e,i=i||t,e=1/e,t=1/t,i=1/i;for(var a=new n(256),s=new n(256),o=new n(256),c=0;256>c;)a[c]=r(~~(255*l(u*c,e))),s[c]=r(~~(255*l(u*c,t))),o[c]=r(~~(255*l(u*c,i))),c++;return this.set(a,s,o)},exposure:function(e){e===t&&(e=1);var i=0,a=new n(256);for(i=0;256>i;)a[i]=r(~~(255*(1-o(-e*i*u)))),i++;return this.set(a)},set:function(e,t,n){if(!e)return this;t=t||e,n=n||t;var a,l,o,u,c,h=this._tableR||i(),f=s(h);if(t&&n){for(a=this._tableG||s(h),l=this._tableB||s(a),o=s(a),u=s(l),c=0;256>c;)h[c]=r(e[r(f[c])]),a[c]=r(t[r(o[c])]),l[c]=r(n[r(u[c])]),c++;this._tableR=h,this._tableG=a,this._tableB=l}else{for(c=0;256>c;)h[c]=r(e[r(f[c])]),c++;this._tableR=h,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=this._tableG=this._tableB=this._tableA=null,this},combineWith:function(e){return this.set(e.getTable(0),e.getTable(1),e.getTable(2))},getTable:function(t){switch(t=t||e.CHANNEL.RED){case e.CHANNEL.ALPHA:return this._tableA;case e.CHANNEL.BLUE:return this._tableB;case e.CHANNEL.GREEN:return this._tableG;case e.CHANNEL.RED:default:return this._tableR}},setTable:function(t,n){switch(n=n||e.CHANNEL.RED){case e.CHANNEL.ALPHA:return this._tableA=t,this;case e.CHANNEL.BLUE:return this._tableB=t,this;case e.CHANNEL.GREEN:return this._tableG=t,this;case e.CHANNEL.RED:default:return this._tableR=t,this}},_apply:function(e){var t=this;if(!t._isOn||!t._tableR)return e;var n,r,i,a,s,l=e.length,o=(l>>2)%4,u=t._tableR,c=t._tableG,h=t._tableB,f=t._tableA;if(f){for(n=0;l>n;n+=16)r=e[n],i=e[n+1],a=e[n+2],s=e[n+3],e[n]=u[r],e[n+1]=c[i],e[n+2]=h[a],e[n+3]=f[s],r=e[n+4],i=e[n+5],a=e[n+6],s=e[n+7],e[n+4]=u[r],e[n+5]=c[i],e[n+6]=h[a],e[n+7]=f[s],r=e[n+8],i=e[n+9],a=e[n+10],s=e[n+11],e[n+8]=u[r],e[n+9]=c[i],e[n+10]=h[a],e[n+11]=f[s],r=e[n+12],i=e[n+13],a=e[n+14],s=e[n+15],e[n+12]=u[r],e[n+13]=c[i],e[n+14]=h[a],e[n+15]=f[s];if(o)for(o<<=2,n=l-o;l>n;n+=4)r=e[n],i=e[n+1],a=e[n+2],s=e[n+3],e[n]=u[r],e[n+1]=c[i],e[n+2]=h[a],e[n+3]=f[s]}else{for(n=0;l>n;n+=16)r=e[n],i=e[n+1],a=e[n+2],e[n]=u[r],e[n+1]=c[i],e[n+2]=h[a],r=e[n+4],i=e[n+5],a=e[n+6],e[n+4]=u[r],e[n+5]=c[i],e[n+6]=h[a],r=e[n+8],i=e[n+9],a=e[n+10],e[n+8]=u[r],e[n+9]=c[i],e[n+10]=h[a],r=e[n+12],i=e[n+13],a=e[n+14],e[n+12]=u[r],e[n+13]=c[i],e[n+14]=h[a];if(o)for(o<<=2,n=l-o;l>n;n+=4)r=e[n],i=e[n+1],a=e[n+2],e[n]=u[r],e[n+1]=c[i],e[n+2]=h[a]}return e},apply2:function(e,t,n){var r,i=this;return e&&t&&i._isOn&&i._tableR&&(r=e.getSelectedData(),i.$thread?(n&&i.one("apply",function(){n(i)}),i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),i.trigger("apply",i)}).send("apply",{im:r,params:i.serialize()})):t.setSelectedData(i._apply(r[0],r[1],r[2],e))),e}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(FILTER),!function(e){"use strict";{var t=(e.ImArray,e.ImArrayCopy),n=e.Array16I,r=Math.min,i=(Math.max,Math.floor);e.DisplacementMapFilter=e.Class(e.Filter,{name:"DisplacementMapFilter",constructor:function(e){var t=this;t.$super("constructor"),e&&t.setMap(e)},_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:e.MODE.CLAMP,dispose:function(){var e=this;return e.$super("dispose"),e._map=null,e.map=null,e.scaleX=null,e.scaleY=null,e.startX=null,e.startY=null,e.componentX=null,e.componentY=null,e.color=null,e.red=null,e.green=null,e.blue=null,e.alpha=null,e.mode=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_map:e._map,scaleX:e.scaleX,scaleY:e.scaleY,startX:e.startX,startY:e.startY,componentX:e.componentX,componentY:e.componentY,color:e.color,red:e.red,green:e.green,blue:e.blue,alpha:e.alpha,mode:e.mode}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n.map=null,n._map=t._map,n.scaleX=t.scaleX,n.scaleY=t.scaleY,n.startX=t.startX,n.startY=t.startY,n.componentX=t.componentX,n.componentY=t.componentY,n.color=t.color,n.red=t.red,n.green=t.green,n.blue=t.blue,n.alpha=t.alpha,n.mode=t.mode),n},reset:function(){var e=this;return e._map=null,e.map=null,e},getMap:function(){return this.map},setMap:function(e){var t=this;return e&&(t.map=e,t._map={data:e.getData(),width:e.width,height:e.height}),t},setColor:function(e){var t=this;return t.color=e,t.alpha=e>>24&255,t.red=e>>16&255,t.green=e>>8&255,t.blue=255&e,t},_apply:function(a,s,l){var o=this;if(!o._isOn||!o._map)return a;var u,c,h,f,p,m,d,_,g,v,y,b,w,A,E,L,M,R,I,C,x,N,S,k,O,D,F,T,P,G,U,H=.00390625*o.scaleX,W=.00390625*o.scaleY,B=o.componentX,X=o.componentY,Y=o.alpha,z=o.red,j=o.green,$=o.blue,q=o.mode,K=e.MODE.IGNORE,Q=(e.MODE.CLAMP,e.MODE.COLOR),V=e.MODE.WRAP;for(u=o._map.data,c=o._map.width,h=o._map.height,f=u.length>>2,m=r(c,s),d=r(h,l),T=a.length,D=m*d<<2,F=T>>2,g=i(o.startX*(s-1)),_=i(o.startY*(l-1)),v=_*s,y=-g,b=-_,w=s-g-1,A=l-_-1,p=new n(f<<1),P=new t(a),L=0,M=0,R=0,I=0,E=0;f>E;E++,L+=2,M++)M>=c&&(M=0,R++,I+=c),S=M+I<<2,p[L]=i((u[S+B]-128)*H),p[L+1]=i((u[S+X]-128)*W);for(M=0,R=0,I=0,C=0,E=0;D>E;E+=4,M++)if(M>=m&&(M=0,R++,I+=s,C+=c),!(b>R||R>A||y>M||M>w)){if(N=M+g,x=R+_,k=N+I+v<<2,L=M+C<<1,G=N+p[L],U=x+p[L+1],U>=l||0>U||G>=s||0>G){if(q==K)continue;if(q==Q){a[k]=z,a[k+1]=j,a[k+2]=$,a[k+3]=Y;continue}q==V?(U>A?U-=l:0>U&&(U+=l),G>w?G-=s:0>G&&(G+=s)):(U>A?U=A:0>U&&(U=0),G>w?G=w:0>G&&(G=0))}O=G+U*s<<2,a[k]=P[O],a[k+1]=P[O+1],a[k+2]=P[O+2],a[k+3]=P[O+3]}return a},apply2:function(e,t,n){var r,i=this;return e&&t&&i._isOn&&(i._map||i.map)&&(r=e.getSelectedData(),i.$thread?(n&&i.one("apply",function(){n(i)}),i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),i.trigger("apply",i)}).send("apply",{im:r,params:i.serialize()})):t.setSelectedData(i._apply(r[0],r[1],r[2],e))),e}})}}(FILTER),!function(FILTER,undef){"use strict";var IMG=FILTER.ImArray,IMGcopy=FILTER.ImArrayCopy,PI=FILTER.CONSTANTS.PI,DoublePI=FILTER.CONSTANTS.PI2,HalfPI=FILTER.CONSTANTS.PI_2,ThreePI2=1.5*PI,Sqrt=Math.sqrt,Atan2=Math.atan2,Atan=Math.atan,Sin=Math.sin,Cos=Math.cos,Floor=Math.floor,Asin=Math.asin,Tan=Math.tan,Abs=Math.abs,Max=Math.max,toRad=FILTER.CONSTANTS.toRad,Maps,GeometricMapFilter=FILTER.GeometricMapFilter=FILTER.Class(FILTER.Filter,{name:"GeometricMapFilter",constructor:function(e){var t=this;t.$super("constructor"),e&&t.generic(e)},_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:FILTER.MODE.CLAMP,dispose:function(){var e=this;return e.$super("dispose"),e._map=null,e._mapName=null,e.inverseTransform=null,e.matrix=null,e.centerX=null,e.centerY=null,e.angle=null,e.radius=null,e.wavelength=null,e.amplitude=null,e.phase=null,e.xAmplitude=null,e.yAmplitude=null,e.xWavelength=null,e.yWavelength=null,e.mode=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_mapName:e._mapName,inverseTransform:e.inverseTransform?e.inverseTransform.toString():null,matrix:e.matrix,centerX:e.centerX,centerY:e.centerY,angle:e.angle,radius:e.radius,wavelength:e.wavelength,amplitude:e.amplitude,phase:e.phase,xAmplitude:e.xAmplitude,yAmplitude:e.yAmplitude,xWavelength:e.xWavelength,yWavelength:e.yWavelength,mode:e.mode}}},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self.inverseTransform=null,self.matrix=params.matrix,self.centerX=params.centerX,self.centerY=params.centerY,self.angle=params.angle,self.radius=params.radius,self.wavelength=params.wavelength,self.amplitude=params.amplitude,self.phase=params.phase,self.xAmplitude=params.xAmplitude,self.yAmplitude=params.yAmplitude,self.xWavelength=params.xWavelength,self.yWavelength=params.yWavelength,self.mode=params.mode,params.inverseTransform&&(self.inverseTransform=eval('(function(){ "use strict"; return '+params.inverseTransform+"})();")),self._mapName=params._mapName,self._map=null,self._mapName&&Maps[self._mapName]&&(self._map=Maps[self._mapName])),self},generic:function(e){var t=this;return e&&(t.inverseTransform=e,t._mapName="generic",t._map=Maps.generic),t},affine:function(e){var t=this;return e&&(t.matrix=e,t._mapName="affine",t._map=Maps.affine),t},flipX:function(){var e=this;return e._mapName="flipX",e._map=Maps.flipX,e},flipY:function(){var e=this;return e._mapName="flipY",e._map=Maps.flipY,e},flipXY:function(){var e=this;return e._mapName="flipXY",e._map=Maps.flipXY,e},rotateCW:function(){var e=this;return e._mapName="rotateCW",e._map=Maps.rotateCW,e},rotateCCW:function(){var e=this;return e._mapName="rotateCCW",e._map=Maps.rotateCCW,e},polar:function(e,t){var n=this;return n.centerX=e||0,n.centerY=t||0,n._mapName="polar",n._map=Maps.polar,n},cartesian:function(e,t){var n=this;return n.centerX=e||0,n.centerY=t||0,n._mapName="cartesian",n._map=Maps.cartesian,n},twirl:function(e,t,n,r){var i=this;return i.angle=e||0,i.radius=t||0,i.centerX=n||0,i.centerY=r||0,i._mapName="twirl",i._map=Maps.twirl,i},sphere:function(e,t,n){var r=this;return r.radius=e||0,r.centerX=t||0,r.centerY=n||0,r._mapName="sphere",r._map=Maps.sphere,r},ripple:function(e,t,n,r,i,a){var s=this;return s.radius=e!==undef?e:50,s.centerX=i||0,s.centerY=a||0,s.wavelength=t!==undef?t:16,s.amplitude=n!==undef?n:10,s.phase=r||0,s._mapName="ripple",s._map=Maps.ripple,s},reset:function(){var e=this;return e._mapName=null,e._map=null,e},getMap:function(){return this._map},setMap:function(e){var t=this;return t._mapName=null,t._map=e,t},_apply:function(e,t,n,r){var i=this;return i._isOn&&i._map?i._map(i,e,t,n,r):e},apply2:function(e,t,n){var r,i=this;return e&&t&&i._isOn&&i._map&&(r=e.getSelectedData(),i.$thread?(n&&i.one("apply",function(){n(i)}),i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),i.trigger("apply",i)}).send("apply",{im:r,params:i.serialize()})):t.setSelectedData(i._map(i,r[0],r[1],r[2],e))),e}});Maps={generic:function(e,t,n,r){var i,a,s,l,o,u,c,h=t.length,f=new IMG(h),p=e.inverseTransform,m=e.mode,d=FILTER.MODE.CLAMP,_=FILTER.MODE.WRAP;for(i=0,a=0,s=0;h>s;s+=4,i++){if(i>=n&&(i=0,a++),o=p([i,a],n,r),u=~~o[0],c=~~o[1],0>u||u>=n||0>c||c>=r)switch(m){case _:c>=r?c-=r:0>c&&(c+=r),u>=n?u-=n:0>u&&(u+=n);break;case d:default:c>=r?c=r-1:0>c&&(c=0),u>=n?u=n-1:0>u&&(u=0)}l=u+c*n<<2,f[s]=t[l],f[s+1]=t[l+1],f[s+2]=t[l+2],f[s+3]=t[l+3]}return f},affine:function(e,t,n){var r,i,a,s,l,o,u,c,h,f=t.length,p=f>>2,m=new IMG(f),d=e.matrix,_=d[0],g=d[1],v=d[3],y=d[4],b=d[2],w=d[5],A=e.mode,E=FILTER.MODE.CLAMP,L=FILTER.MODE.WRAP,M=n-1,R=p-n;for(r=0,i=0,l=w*n,o=v*n,u=y*n,a=0;f>a;a+=4,r++){if(r>=n&&(r=0,i++),c=~~(_*r+g*i+b),h=~~(o*r+u*i+l),0>c||c>M||0>h||h>R)switch(A){case L:h>R?h-=p:0>h&&(h+=p),c>=n?c-=n:0>c&&(c+=n);break;case E:default:h>R?h=R:0>h&&(h=0),c>M?c=M:0>c&&(c=0)}s=c+h<<2,m[a]=t[s],m[a+1]=t[s+1],m[a+2]=t[s+2],m[a+3]=t[s+3]}return m},flipX:function(e,t,n){var r,i,a,s,l,o=t.length,u=new IMG(o);for(r=0,i=0,a=0,s=0;o>s;s+=4,r++)r>=n&&(r=0,i++,a+=n),l=n-1-r+a<<2,u[s]=t[l],u[s+1]=t[l+1],u[s+2]=t[l+2],u[s+3]=t[l+3];return u},flipY:function(e,t,n,r){var i,a,s,l,o,u=t.length,c=new IMG(u);for(i=0,a=0,s=(r-1)*n,l=0;u>l;l+=4,i++)i>=n&&(i=0,a++,s-=n),o=i+s<<2,c[l]=t[o],c[l+1]=t[o+1],c[l+2]=t[o+2],c[l+3]=t[o+3];return c},flipXY:function(e,t,n,r){var i,a,s,l,o,u,c=t.length,h=new IMG(c);for(i=0,a=0,l=(r-1)*n,o=0;c>o;o+=4,i++)i>=n&&(i=0,a++,s+=n,l-=n),u=n-1-i+l<<2,h[o]=t[u],h[o+1]=t[u+1],h[o+2]=t[u+2],h[o+3]=t[u+3];return h},rotateCW:function(e,t,n){var r,i,a,s,l,o=t.length,u=new IMG(o),c=o>>2;for(r=0,i=0,a=c-1,s=0;o>s;s+=4,r++,a-=n)r>=n&&(r=0,a=c-1,i++),l=i+a<<2,u[s]=t[l],u[s+1]=t[l+1],u[s+2]=t[l+2],u[s+3]=t[l+3];return u},rotateCCW:function(e,t,n){var r,i,a,s,l,o=t.length,u=new IMG(o);for(r=0,i=0,a=0,s=0;o>s;s+=4,r++,a+=n)r>=n&&(r=0,a=0,i++),l=n-1-i+a<<2,u[s]=t[l],u[s+1]=t[l+1],u[s+2]=t[l+2],u[s+3]=t[l+3];return u},twirl:function(e,t,n,r){if(0>=e.radius)return t;var i,a,s,l,o,u,c,h,f=t.length,p=new IMGcopy(t),m=e.centerX,d=e.centerY,_=e.angle,g=e.radius,v=e.mode,y=FILTER.MODE.CLAMP,b=FILTER.MODE.WRAP,w=_/g,A=n-1,E=r-1;for(m=Floor(m*(n-1)),d=Floor(d*(r-1)),i=0,a=0,s=0;f>s;s+=4,i++)if(i>=n&&(i=0,a++),u=i-m,c=a-d,o=Sqrt(u*u+c*c),g>o){if(h=Atan2(c,u)+w*(g-o),u=~~(m+o*Cos(h)),c=~~(d+o*Sin(h)),0>u||u>A||0>c||c>E)switch(v){case b:c>E?c-=r:0>c&&(c+=r),u>A?u-=n:0>u&&(u+=n);
break;case y:default:c>E?c=E:0>c&&(c=0),u>A?u=A:0>u&&(u=0)}l=u+c*n<<2,t[s]=p[l],t[s+1]=p[l+1],t[s+2]=p[l+2],t[s+3]=p[l+3]}return t},sphere:function(e,t,n,r){if(0>=e.radius)return t;var i,a,s,l,o,u,c,h,f,p,m,d,_,g=t.length,v=new IMGcopy(t),y=e.centerX,b=e.centerY,w=e.radius,A=e.mode,E=FILTER.MODE.CLAMP,L=FILTER.MODE.WRAP,M=w*w,R=.555556,I=1-R,C=n-1,x=r-1;for(y=Floor(y*(n-1)),b=Floor(b*(r-1)),i=0,a=0,s=0;g>s;s+=4,i++)if(i>=n&&(i=0,a++),o=i-y,u=a-b,d=o*o,_=u*u,c=d+_,M>c){if(p=M-c,m=Sqrt(p),h=Asin(o/Sqrt(d+p))*I,f=Asin(u/Sqrt(_+p))*I,o=~~(i-m*Tan(h)),u=~~(a-m*Tan(f)),0>o||o>C||0>u||u>x)switch(A){case L:u>x?u-=r:0>u&&(u+=r),o>C?o-=n:0>o&&(o+=n);break;case E:default:u>x?u=x:0>u&&(u=0),o>C?o=C:0>o&&(o=0)}l=o+u*n<<2,t[s]=v[l],t[s+1]=v[l+1],t[s+2]=v[l+2],t[s+3]=v[l+3]}return t},ripple:function(e,t,n,r){if(0>=e.radius)return t;var i,a,s,l,o,u,c,h,f,p,m,d=t.length,_=new IMGcopy(t),g=FILTER.MODE.CLAMP,v=FILTER.MODE.WRAP,y=n-1,b=r-1,w=e.centerX,A=e.centerY,E=e.radius,L=e.mode,M=E*E,R=e.wavelength,I=e.amplitude,C=e.phase;for(w=Floor(w*(n-1)),A=Floor(A*(r-1)),i=0,a=0,s=0;d>s;s+=4,i++)if(i>=n&&(i=0,a++),u=i-w,c=a-A,p=u*u,m=c*c,f=p+m,M>f){if(o=Sqrt(f),h=I*Sin(o/R*Math.PI*2-C),h*=(E-o)/E,o&&(h*=R/o),u=~~(i+u*h),c=~~(a+c*h),0>u||u>y||0>c||c>b)switch(L){case v:c>b?c-=r:0>c&&(c+=r),u>y?u-=n:0>u&&(u+=n);break;case g:default:c>b?c=b:0>c&&(c=0),u>y?u=y:0>u&&(u=0)}l=u+c*n<<2,t[s]=_[l],t[s+1]=_[l+1],t[s+2]=_[l+2],t[s+3]=_[l+3]}return t},polar:function(e,t,n,r){var i,a,s,l,o,u,c,h,f,p,m,d,_=t.length,g=new IMGcopy(t),v=FILTER.MODE.CLAMP,y=FILTER.MODE.WRAP,b=n-1,w=r-1,A=0,E=e.mode;for(m=~~(.5*n+.5),d=~~(.5*r+.5),p=Max(d,m),i=0,a=0,s=0;_>s;s+=4,i++){if(i>=n&&(i=0,a++),l=i-m,o=a-d,f=0,l>=0?o>0?(f=PI-Atan(l/o),A=Sqrt(l*l+o*o)):0>o?(f=Atan(l/o),A=Sqrt(l*l+o*o)):(f=HalfPI,A=l):0>l&&(0>o?(f=DoublePI-Atan(l/o),A=Sqrt(l*l+o*o)):o>0?(f=PI+Atan(l/o),A=Sqrt(l*l+o*o)):(f=ThreePI2,A=-l)),u=n-1-(n-1)/DoublePI*f,c=r*A/p,0>u||u>b||0>c||c>w)switch(E){case y:c>w?c-=r:0>c&&(c+=r),u>b?u-=n:0>u&&(u+=n);break;case v:default:c>w?c=w:0>c&&(c=0),u>b?u=b:0>u&&(u=0)}h=~~(u+.5)+~~(c+.5)*n<<2,t[s]=g[h],t[s+1]=g[h+1],t[s+2]=g[h+2],t[s+3]=g[h+3]}return t},cartesian:function(e,t,n,r){var i,a,s,l,o,u,c,h,f,p,m,d,_,g=t.length,v=new IMGcopy(t),y=FILTER.MODE.CLAMP,b=FILTER.MODE.WRAP,w=n-1,A=r-1,E=0,L=e.mode;for(d=~~(.5*n+.5),_=~~(.5*r+.5),m=Max(_,d),i=0,a=0,s=0;g>s;s+=4,i++){if(i>=n&&(i=0,a++),f=i/n*DoublePI,p=f>=ThreePI2?DoublePI-f:f>=PI?f-PI:f>=HalfPI?PI-f:f,E=m*(a/r),c=-E*Sin(p),h=E*Cos(p),f>=ThreePI2?(l=d-c,o=_-h):f>=PI?(l=d-c,o=_+h):f>=HalfPI?(l=d+c,o=_+h):(l=d+c,o=_-h),0>l||l>w||0>o||o>A)switch(L){case b:o>A?o-=r:0>o&&(o+=r),l>w?l-=n:0>l&&(l+=n);break;case y:default:o>A?o=A:0>o&&(o=0),l>w?l=w:0>l&&(l=0)}u=~~(l+.5)+~~(o+.5)*n<<2,t[s]=v[u],t[s+1]=v[u+1],t[s+2]=v[u+2],t[s+3]=v[u+3]}return t}}}(FILTER),!function(e,t){"use strict";function n(e,t,n,r){var i,a=e.length,s=new b(e.length);for(n=n||1,r=r||1,i=0;a>i;)s[i]=n*e[i]+r*t[i],i++;return s}function r(e,t){var n,r,i,a=e.length,s=[],l=0;for(n=0;a>n;n++)for(r=0;a>r;r++)i=e[n]*t[r],l+=i,s.push(i);return{kernel:s,sum:l}}function i(e){var t,n=new Array(e);for(t=0;e>t;)n[t]=1,t++;return n}function a(e){var t,n,r,i,a=M.length;if(e--,a>e)t=new b(M[e]);else for(t=new b(M[a-1]);e>=a;){for(n=t,t=new b(n.length+1),t[0]=1,r=0,i=n.length-1;i>r;r++)t[r+1]=n[r]+n[r+1];t[n.length]=1,40>a&&M.push(new Array(t)),a++}return t}function s(e){var t,n=e>>1,r=-n,i=new Array(e);for(t=0;e>t;)i[t]=r,r++,t++;return i}function l(e){var t=a(e);return r(t,t)}function o(e,t){var n=a(e),i=s(e);return 1==t?r(i.reverse(),n):r(n,i)}function u(e,t){var n=i(e),a=s(e);return 1==t?r(a.reverse(),n):r(n,a)}function c(e,t,n){t=t||1,n=n||t;var r,i=e*e,a=i>>1,s=new b(i);for(r=0;i>r;)s[r]=t,r++;return s[a]=n,s}function h(e,t,n,r){var i,a,s,l,o,u=e*e,c=e>>1,h=u>>1,f=new b(u);for(l=0,i=0;c>=i;i++){for(a=0,o=0,s=0;c>=s;s++)f[h+i+a]=l+o,f[h-i-a]=-l-o,f[h-i+a]=-l+o,f[h+i-a]=l-o,a+=e,o+=n;l+=t}return f[h]=r||1,f}function f(e,t,n,r){var i,a,s,l,o,u,c=e*e,h=e>>1,f=c>>1,p=new b(c),m=new b(c),d=1/e,g=1e-8;for(_(t)>g?(o=1,u=n/t):(o=t/n,u=1),i=0,s=0,l=0,a=u*e;h>=i;)m[f+i]=~~(f+s+l+.5),m[f-i]=~~(f-s-l+.5),i++,s+=o,l+=a;for(i=0;h>=i;)p[m[f+i]]=p[m[f-i]]=d,i++;return p[f]=r||1,p}function p(e,t,n,r,i,a,s,l,o,u){var c,h,f,p,m,d,_,g,v,y,b,E,M,R,I,C,x,N,S,k,O,D,F,T,P,G,U,H,W,B,X,Y,z,j,$,q,K,Q,V,J,Z,et,tt,nt,rt,it,at,st=e.length,lt=st>>2,ot=a,ut=s;if(g=ot*ut,d=ot>>1,_=t*(ut>>1),b=-d-1,M=-_-t,E=d,R=_,B=0,Y=t-1,X=0,z=lt-t,h=(lt<<1)+lt,y=(t<<1)+t,u=u||1,at=0,i)for(k=r[0],O=r[g>>1],D=O-k,F=i[0],T=i[g>>1],P=T-F;u>at;){for(v=new w(st),c=new A(h),I=0,C=0,f=p=m=0,x=0;t>x;x++,I+=4,C+=3)f+=e[I],p+=e[I+1],m+=e[I+2],c[C]=f,c[C+1]=p,c[C+2]=m;for(C=0,x=0,f=p=m=0,I=y+t;st>I;I+=4,C+=3,x++)x>=t&&(x=0,f=p=m=0),f+=e[I],p+=e[I+1],m+=e[I+2],c[C+y]=c[C]+f,c[C+y+1]=c[C+1]+p,c[C+y+2]=c[C+2]+m;for(x=0,N=0,S=0,I=0;st>I;I+=4,x++)x>=t&&(x=0,N++,S+=t),G=x+b,U=S+M,H=x+E,W=S+R,G=B>G?B:G,H=H>Y?Y:H,U=X>U?X:U,W=W>z?z:W,j=G+U,K=H+W,$=H+U,q=G+W,j=(j<<1)+j,$=($<<1)+$,q=(q<<1)+q,K=(K<<1)+K,Z=k*(c[K]-c[$]-c[q]+c[j])+D*e[I],et=k*(c[K+1]-c[$+1]-c[q+1]+c[j+1])+D*e[I+1],tt=k*(c[K+2]-c[$+2]-c[q+2]+c[j+2])+D*e[I+2],nt=F*(c[K]-c[$]-c[q]+c[j])+P*e[I],rt=F*(c[K+1]-c[$+1]-c[q+1]+c[j+1])+P*e[I+1],it=F*(c[K+2]-c[$+2]-c[q+2]+c[j+2])+P*e[I+2],Q=l*Z+o*nt,V=l*et+o*rt,J=l*tt+o*it,L&&(Q=0>Q?0:Q>255?255:Q,V=0>V?0:V>255?255:V,J=0>J?0:J>255?255:J),v[I]=~~Q,v[I+1]=~~V,v[I+2]=~~J,v[I+3]=e[I+3];e=v,at++}else for(k=r[0],O=r[g>>1],D=O-k;u>at;){for(v=new w(st),c=new A(h),I=0,C=0,f=p=m=0,x=0;t>x;x++,I+=4,C+=3)f+=e[I],p+=e[I+1],m+=e[I+2],c[C]=f,c[C+1]=p,c[C+2]=m;for(C=0,x=0,f=p=m=0,I=y+t;st>I;I+=4,C+=3,x++)x>=t&&(x=0,f=p=m=0),f+=e[I],p+=e[I+1],m+=e[I+2],c[C+y]=c[C]+f,c[C+y+1]=c[C+1]+p,c[C+y+2]=c[C+2]+m;for(x=0,N=0,S=0,I=0;st>I;I+=4,x++)x>=t&&(x=0,N++,S+=t),G=x+b,U=S+M,H=x+E,W=S+R,G=B>G?B:G,H=H>Y?Y:H,U=X>U?X:U,W=W>z?z:W,j=G+U,K=H+W,$=H+U,q=G+W,j=(j<<1)+j,$=($<<1)+$,q=(q<<1)+q,K=(K<<1)+K,Z=k*(c[K]-c[$]-c[q]+c[j])+D*e[I],et=k*(c[K+1]-c[$+1]-c[q+1]+c[j+1])+D*e[I+1],tt=k*(c[K+2]-c[$+2]-c[q+2]+c[j+2])+D*e[I+2],Q=l*Z+o,V=l*et+o,J=l*tt+o,L&&(Q=0>Q?0:Q>255?255:Q,V=0>V?0:V>255?255:V,J=0>J?0:J>255?255:J),v[I]=~~Q,v[I+1]=~~V,v[I+2]=~~J,v[I+3]=e[I+3];e=v,at++}return v}function m(e,t,n,r,i,a,s,l,o){var u,c,h,f,p,m,d,_,g,v,y,b,A,M,R,I,C,x,N,S,k,O,D,F,T,P,G,U=e.length,H=U>>2;for(u=[i,r],c=[s,a],T=[o,l],I=t-1,C=H-t,G=2;G--;){for(d=new w(U),f=u[G],p=c[G],h=f.length,m=p.length,P=T[G],_=new E(p),y=0;m>y;y+=2)_[y+1]*=t;if(L)for(b=0,A=0,g=0;U>g;g+=4,b++){for(b>=t&&(b=0,A+=t),O=0,D=0,F=0,y=0,v=0;h>y;y++,v+=2)M=b+_[v],R=A+_[v+1],M>=0&&I>=M&&R>=0&&C>=R&&(srcOff=M+R<<2,k=f[y],O+=e[srcOff]*k,D+=e[srcOff+1]*k,F+=e[srcOff+2]*k);x=P*O,N=P*D,S=P*F,x=0>x?0:x>255?255:x,N=0>N?0:N>255?255:N,S=0>S?0:S>255?255:S,d[g]=~~x,d[g+1]=~~N,d[g+2]=~~S,d[g+3]=e[g+3]}else for(b=0,A=0,g=0;U>g;g+=4,b++){for(b>=t&&(b=0,A+=t),O=0,D=0,F=0,y=0,v=0;h>y;y++,v+=2)M=b+_[v],R=A+_[v+1],M>=0&&I>=M&&R>=0&&C>=R&&(srcOff=M+R<<2,k=f[y],O+=e[srcOff]*k,D+=e[srcOff+1]*k,F+=e[srcOff+2]*k);x=P*O,N=P*D,S=P*F,d[g]=~~x,d[g+1]=~~N,d[g+2]=~~S,d[g+3]=e[g+3]}e=d}return d}var d=(e.CONSTANTS.SQRT2,e.CONSTANTS.toRad),_=(e.CONSTANTS.toDeg,Math.abs),g=Math.sqrt,v=Math.sin,y=Math.cos,b=e.Array32F,w=e.ImArray,A=e.Array32F,E=e.Array16I,L=(e.Array8U,e._notSupportClamp),M=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],R=e.ConvolutionMatrixFilter=e.Class(e.Filter,{name:"ConvolutionMatrixFilter",constructor:function(t,n,r){var i=this;i.$super("constructor"),i._coeff=new b([1,0]),t&&t.length?i.set(t,~~(g(t.length)+.5),n||1,r||0):(i._matrix=null,i._dim=0),i._matrix2=null,i._dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,e.useWebGL&&(i._webglInstance=e.WebGLConvolutionMatrixFilterInstance||null)},_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_webglInstance:null,dispose:function(){var e=this;return e.$super("dispose"),e._webglInstance=null,e._dim=null,e._dim2=null,e._matrix=null,e._matrix2=null,e._mat=null,e._mat2=null,e._coeff=null,e._isGrad=null,e._doIntegral=null,e._doSeparable=null,e._indices=null,e._indices2=null,e._indicesf=null,e._indicesf2=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_dim:e._dim,_dim2:e._dim2,_matrix:e._matrix,_matrix2:e._matrix2,_mat:e._mat,_mat2:e._mat2,_coeff:e._coeff,_isGrad:e._isGrad,_doIntegral:e._doIntegral,_doSeparable:e._doSeparable,_indices:e._indices,_indices2:e._indices2,_indicesf:e._indicesf,_indicesf2:e._indicesf2}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._dim=t._dim,n._dim2=t._dim2,n._matrix=t._matrix,n._matrix2=t._matrix2,n._mat=t._mat,n._mat2=t._mat2,n._coeff=t._coeff,n._isGrad=t._isGrad,n._doIntegral=t._doIntegral,n._doSeparable=t._doSeparable,n._indices=t._indices,n._indices2=t._indices2,n._indicesf=t._indicesf,n._indicesf2=t._indicesf2),n},lowPass:function(e){return e=e===t?3:e%2?e:e+1,this.set(c(e),e,1/(e*e),0),this._doIntegral=1,this},highPass:function(e,n){e=e===t?3:e%2?e:e+1,n=n===t?1:n;var r=e*e,i=-n/r,a=c(e,i,1+i);return this.set(a,e,1,0),this._doIntegral=1,this},glow:function(e,n){return e=e===t?.5:e,this.highPass(n,-e)},sharpen:function(e,n){return e=e===t?.5:e,this.highPass(n,e)},verticalBlur:function(e){return e=e===t?3:e%2?e:e+1,this.set(i(e),1,1/e,0),this._dim2=e,this._doIntegral=1,this},horizontalBlur:function(e){return e=e===t?3:e%2?e:e+1,this.set(i(e),e,1/e,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(e,n){n=n===t?3:n%2?n:n+1,e*=d;var r=y(e),i=-v(e),a=f(n,r,i,1/n);return this.set(a,n,1,0)},fastGauss:function(e,n){return n=n===t?3:n%2?n:n+1,e=~~(e||1),1>e?e=1:e>3&&(e=3),this.set(c(n),n,1/(n*n),0),this._doIntegral=e,this},binomialLowPass:function(e){e=e===t?3:e%2?e:e+1;var n=a(e),r=1<<e-1,i=1/r;this.set(n,e,i,i),this._matrix2=new b(n);var s=this._computeIndices(this._matrix2,this._dim2);return this._indices2=s[0],this._indicesf2=s[1],this._mat2=s[2],this._doSeparable=!0,this},binomialHighPass:function(e){e=e===t?3:e%2?e:e+1;var r=l(e);return this.set(n(c(e),new b(r.kernel),1,-1/r.sum),e,1,0)},prewittX:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,0);return this.set(n.kernel,e,1,0)},prewittY:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,1);return this.set(n.kernel,e,1,0)},prewittDirectional:function(e,r){r=r===t?3:r%2?r:r+1,e*=d;var i=y(e),a=v(e),s=u(r,0),l=u(r,1);return this.set(n(new b(s.kernel),new b(l.kernel),i,a),r,1,0)},prewitt:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,0),r=u(e,1);this.set(n.kernel,e,1,0),this._isGrad=!0,this._matrix2=new b(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this},sobelX:function(e){e=e===t?3:e%2?e:e+1;var n=o(e,0);return this.set(n.kernel,e,1,0)},sobelY:function(e){e=e===t?3:e%2?e:e+1;var n=o(e,1);return this.set(n.kernel,e,1,0)},sobelDirectional:function(e,r){r=r===t?3:r%2?r:r+1,e*=d;var i=y(e),a=v(e),s=o(r,0),l=o(r,1);return this.set(n(new b(s.kernel),new b(l.kernel),i,a),r,1,0)},sobel:function(e){e=e===t?3:e%2?e:e+1;var n=o(e,0),r=o(e,1);this.set(n.kernel,e,1,0),this._matrix2=new b(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this._isGrad=!0,this},laplace:function(e){e=e===t?3:e%2?e:e+1;var n=e*e,r=c(e,-1,n-1);return this.set(r,e,1,0),this._doIntegral=1,this},emboss:function(e,n,r){r=r===t?3:r%2?r:r+1,e=e===t?-.25*Math.PI:e*d,n=n||1;var i=n*y(e),a=-n*v(e),s=h(r,i,a,1);return this.set(s,r,1,0)},edges:function(e){return e=e||1,this.set([0,e,0,e,-4*e,e,0,e,0],3,1,0)},set:function(e,t,n,r){var i=this;i._matrix2=null,i._dim2=0,i._indices2=i._indicesf2=null,i._mat2=null,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._matrix=new b(e),i._dim=t,i._coeff[0]=n||1,i._coeff[1]=r||0;var a=i._computeIndices(i._matrix,i._dim);return i._indices=a[0],i._indicesf=a[1],i._mat=a[2],i},_computeIndices:function(e,t){var n,r,i,a=[],s=[],l=[],o=e.length,u=t,c=u>>1;for(r=0,i=0,n=0;o>n;)s.push(r-c),s.push(i-c),e[n]&&(a.push(r-c),a.push(i-c),l.push(e[n])),n++,r++,r>=u&&(r=0,i++);return[new E(a),new E(s),new b(l)]},reset:function(){var e=this;return e._matrix=e._matrix2=null,e._mat=e._mat2=null,e._dim=e._dim2=0,e._indices=e._indices2=e._indicesf=e._indicesf2=null,e._isGrad=!1,e._doIntegral=0,e._doSeparable=!1,e},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(e,t){return this.set(e,t)},_apply:function(e,t,n){var r=this;if(!r._isOn||!r._matrix)return e;if(r._doIntegral)return r._matrix2?p(e,t,n,r._matrix,r._matrix2,r._dim,r._dim2,r._coeff[0],r._coeff[1],r._doIntegral):p(e,t,n,r._matrix,null,r._dim,r._dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return m(e,t,n,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var i,a,s,l,o,u,c,h,f,d,g,v,y,b,A,M,R,I,C,x,N,S,k=e.length,O=k>>2,D=new w(k),F=t-1,T=O-t,P=r._coeff[0],G=r._coeff[1],U=r._matrix,H=r._matrix2,W=r._isGrad;if(H){for(x=r._indicesf.length,S=new E(r._indicesf),u=0;x>u;u+=2)S[u+1]*=t;for(N=U.length,c=0,h=0,l=0;k>l;l+=4,c++){for(c>=t&&(c=0,h+=t),v=0,y=0,b=0,A=0,M=0,R=0,u=0,o=0;N>u;u++,o+=2)f=c+S[o],d=h+S[o+1],f>=0&&F>=f&&d>=0&&T>=d&&(g=f+d<<2,I=U[u],v+=e[g]*I,y+=e[g+1]*I,b+=e[g+2]*I,C=H[u],A+=e[g]*C,M+=e[g+1]*C,R+=e[g+2]*C);W?(i=_(v)+_(A),a=_(y)+_(M),s=_(b)+_(R)):(i=P*v+G*A,a=P*y+G*M,s=P*b+G*R),L&&(i=0>i?0:i>255?255:i,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s),D[l]=~~i,D[l+1]=~~a,D[l+2]=~~s,D[l+3]=e[l+3]}}else{for(x=r._indices.length,S=new E(r._indices),u=0;x>u;u+=2)S[u+1]*=t;for(U=r._mat,N=U.length,c=0,h=0,l=0;k>l;l+=4,c++){for(c>=t&&(c=0,h+=t),v=0,y=0,b=0,u=0,o=0;N>u;u++,o+=2)f=c+S[o],d=h+S[o+1],f>=0&&F>=f&&d>=0&&T>=d&&(g=f+d<<2,I=U[u],v+=e[g]*I,y+=e[g+1]*I,b+=e[g+2]*I);i=P*v+G,a=P*y+G,s=P*b+G,L&&(i=0>i?0:i>255?255:i,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s),D[l]=~~i,D[l+1]=~~a,D[l+2]=~~s,D[l+3]=e[l+3]}}return D},apply2:function(e,t,n){var r,i=this;return e&&t&&i._isOn&&i._matrix&&(i.$thread?(n&&i.one("apply",function(){n(i)}),i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),i.trigger("apply",i)}).send("apply",{im:e.getSelectedData(),params:i.serialize()})):(r=e.getSelectedData(),t.setSelectedData(i._apply(r[0],r[1],r[2],e)))),e}});R.prototype.bump=R.prototype.emboss,R.prototype.boxBlur=R.prototype.lowPass,R.prototype.gaussBlur=R.prototype.binomialLowPass,R.prototype.gradX=R.prototype.prewittX,R.prototype.gradY=R.prototype.prewittY,R.prototype.gradDirectional=R.prototype.prewittDirectional,R.prototype.grad=R.prototype.prewitt}(FILTER),!function(e){"use strict";{var t,n=e.ImArray,r=e.Array8U,i=e.Array32I,a=Math.sqrt,s=function(e){var t,n=e*e,i=new r(n);for(t=0;n>t;t++)i[t]=1;return i},l=s(3);e.MorphologicalFilter=e.Class(e.Filter,{name:"MorphologicalFilter",constructor:function(){var e=this;e.$super("constructor"),e._filterName=null,e._filter=null,e._dim=0,e._structureElement=null,e._indices=null},_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var e=this;return e.$super("dispose"),e._filterName=null,e._filter=null,e._dim=null,e._structureElement=null,e._indices=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_filterName:e._filterName,_dim:e._dim,_structureElement:e._structureElement,_indices:e._indices}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._dim=n._dim,r._structureElement=n._structureElement,r._indices=n._indices,r._filterName=n._filterName,r._filterName&&t[r._filterName]&&(r._filter=t[r._filterName])),r},erode:function(e){return this.set(e,"erode")},dilate:function(e){return this.set(e,"dilate")},opening:function(e){return this.set(e,"open")},closing:function(e){return this.set(e,"close")},set:function(e,n){var o=this;o._filterName=n,o._filter=t[n],e&&e.length?(o._structureElement=new r(e),o._dim=~~(a(o._structureElement.length)+.5)):e&&e===e-0?(o._structureElement=s(e),o._dim=e):(o._structureElement=l,o._dim=3);var u,c,h,f=[],e=o._structureElement,p=e.length,m=o._dim,d=m>>1;for(c=0,h=0,u=0;p>u;)e[u]&&(f.push(c-d),f.push(h-d)),u++,c++,c>=m&&(c=0,h++);return o._indices=new i(f),o},reset:function(){var e=this;return e._filterName=null,e._filter=null,e._dim=0,e._structureElement=null,e._indices=null,e},_apply:function(e,t,n){var r=this;return r._isOn&&r._dim&&r._filter?r._filter(r,e,t,n):e},apply2:function(e,t,n){var r,i=this;return e&&t&&i._isOn&&i._dim&&i._filter&&(r=e.getSelectedData(),i.$thread?(n&&i.one("apply",function(){n(i)}),i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),i.trigger("apply",i)}).send("apply",{im:r,params:i.serialize()})):t.setSelectedData(i._filter(i,r[0],r[1],r[2],e))),e}})}t={dilate:function(e,t,r){var a,s,l,o,u,c,h,f,p,m,d,_,g,v,y=e._structureElement,b=(y.length,e._dim,new i(e._indices)),w=t.length,A=w>>2,E=new n(w),L=b.length,M=L>>1,R=r-1,I=A-r;for(l=0;L>l;l+=2)b[l+1]*=r;for(o=0,u=0,a=0;w>a;a+=4,o++){for(o>=r&&(o=0,u+=r),_=0,g=0,v=0,s=0;M>s;s+=2)c=o+b[s],h=u+b[s+1],c>=0&&R>=c&&h>=0&&I>=h&&(f=c+h<<2,p=t[f],m=t[f+1],d=t[f+2],p>_&&(_=p),m>g&&(g=m),d>v&&(v=d));E[a]=_,E[a+1]=g,E[a+2]=v,E[a+3]=t[a+3]}return E},erode:function(e,t,r){var a,s,l,o,u,c,h,f,p,m,d,_,g,v,y=e._structureElement,b=(y.length,e._dim,new i(e._indices)),w=t.length,A=w>>2,E=new n(w),L=b.length,M=L>>1,R=r-1,I=A-r;for(l=0;L>l;l+=2)b[l+1]*=r;for(o=0,u=0,a=0;w>a;a+=4,o++){for(o>=r&&(o=0,u+=r),_=255,g=255,v=255,s=0;M>s;s+=2)c=o+b[s],h=u+b[s+1],c>=0&&R>=c&&h>=0&&I>=h&&(f=c+h<<2,p=t[f],m=t[f+1],d=t[f+2],_>p&&(_=p),g>m&&(g=m),v>d&&(v=d));E[a]=_,E[a+1]=g,E[a+2]=v,E[a+3]=t[a+3]}return E},open:function(e,t,r){var a,s,l,o,u,c,h,f,p,m,d,_,g,v,y=e._structureElement,b=(y.length,e._dim,new i(e._indices)),w=t.length,A=w>>2,E=new n(w),L=b.length,M=L>>1,R=r-1,I=A-r;for(l=0;L>l;l+=2)b[l+1]*=r;for(o=0,u=0,a=0;w>a;a+=4,o++){for(o>=r&&(o=0,u+=r),_=255,g=255,v=255,s=0;M>s;s+=2)c=o+b[s],h=u+b[s+1],c>=0&&R>=c&&h>=0&&I>=h&&(f=c+h<<2,p=t[f],m=t[f+1],d=t[f+2],_>p&&(_=p),g>m&&(g=m),v>d&&(v=d));E[a]=_,E[a+1]=g,E[a+2]=v,E[a+3]=t[a+3]}for(t=E,E=new n(w),o=0,u=0,a=0;w>a;a+=4,o++){for(o>=r&&(o=0,u+=r),_=255,g=255,v=255,s=0;M>s;s+=2)c=o+b[s],h=u+b[s+1],c>=0&&R>=c&&h>=0&&I>=h&&(f=c+h<<2,p=t[f],m=t[f+1],d=t[f+2],_>p&&(_=p),g>m&&(g=m),v>d&&(v=d));E[a]=_,E[a+1]=g,E[a+2]=v,E[a+3]=t[a+3]}return E},close:function(e,t,r){var a,s,l,o,u,c,h,f,p,m,d,_,g,v,y=e._structureElement,b=(y.length,e._dim,new i(e._indices)),w=t.length,A=w>>2,E=new n(w),L=b.length,M=L>>1,R=r-1,I=A-r;for(l=0;L>l;l+=2)b[l+1]*=r;for(o=0,u=0,a=0;w>a;a+=4,o++){for(o>=r&&(o=0,u+=r),_=255,g=255,v=255,s=0;M>s;s+=2)c=o+b[s],h=u+b[s+1],c>=0&&R>=c&&h>=0&&I>=h&&(f=c+h<<2,p=t[f],m=t[f+1],d=t[f+2],_>p&&(_=p),g>m&&(g=m),v>d&&(v=d));E[a]=_,E[a+1]=g,E[a+2]=v,E[a+3]=t[a+3]}for(t=E,E=new n(w),o=0,u=0,a=0;w>a;a+=4,o++){for(o>=r&&(o=0,u+=r),_=255,g=255,v=255,s=0;M>s;s+=2)c=o+b[s],h=u+b[s+1],c>=0&&R>=c&&h>=0&&I>=h&&(f=c+h<<2,p=t[f],m=t[f+1],d=t[f+2],_>p&&(_=p),g>m&&(g=m),v>d&&(v=d));E[a]=_,E[a+1]=g,E[a+2]=v,E[a+3]=t[a+3]}return E}}}(FILTER),!function(e,t){"use strict";var n,r=e.ImArray,i=e.Array32I,a=(Math.min,Math.max,e.StatisticalFilter=e.Class(e.Filter,{name:"StatisticalFilter",constructor:function(){var e=this;e.$super("constructor"),e._dim=0,e._indices=null,e._filterName=null,e._filter=null},_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var e=this;return e.$super("dispose"),e._dim=null,e._indices=null,e._filter=null,e._filterName=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_filterName:e._filterName,_dim:e._dim,_indices:e._indices}}},unserialize:function(e){var t,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,t=e.params,r._dim=t._dim,r._indices=t._indices,r._filterName=t._filterName,r._filterName&&n[r._filterName]&&(r._filter=n[r._filterName])),r},median:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"median")},minimum:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"minimum")},maximum:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"maximum")},set:function(e,t){var r=this;r._filterName=t,r._filter=n[t],r._dim=e;var a,s,l,o=[],u=e*e,c=e,h=c>>1;for(s=0,l=0,a=0;u>a;)o.push(s-h),o.push(l-h),a++,s++,s>=c&&(s=0,l++);return r._indices=new i(o),r},reset:function(){var e=this;return e._filterName=null,e._filter=null,e._dim=0,e._indices=null,e},_apply:function(e,t,n){var r=this;return r._isOn&&r._dim?r._filter(r,e,t,n):e},apply2:function(e,t,n){var r,i=this;return e&&t&&i._isOn&&i._dim&&(r=e.getSelectedData(),i.$thread?(n&&i.one("apply",function(){n(i)}),i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&t.setSelectedData(e.im),i.trigger("apply",i)}).send("apply",{im:r,params:i.serialize()})):t.setSelectedData(i._filter(i,r[0],r[1],r[2],e))),e}}));a.prototype.erode=a.prototype.minimum,a.prototype.dilate=a.prototype.maximum,n={median:function(e,t,n){var a,s,l,o,u,c,h,f,p,m,d,_,g,v,y,b,w,A,E=e._dim,L=E*E,M=new i(e._indices),R=t.length,I=R>>2,C=new r(R),x=L<<1,N=n-1,S=I-n;for(f=[],p=[],m=[],s=0;x>s;s+=2)M[s+1]*=n;for(a=0,l=0,o=0;R>a;){for(f.length=0,p.length=0,m.length=0,s=0;x>s;)u=l+M[s],c=o+M[s+1],u>=0&&N>=u&&c>=0&&S>=c&&(h=u+c<<2,d=t[h],_=t[h+1],g=t[h+2],f.push(d),p.push(_),m.push(g)),s+=2;f.sort(),p.sort(),m.sort(),w=f.length,A=w>>1,v=w%2?f[A+1]:~~(.5*(f[A]+f[A+1])),w=p.length,A=w>>1,y=w%2?p[A+1]:~~(.5*(p[A]+p[A+1])),w=m.length,A=w>>1,b=w%2?m[A+1]:~~(.5*(m[A]+m[A+1])),C[a]=v,C[a+1]=y,C[a+2]=b,C[a+3]=t[a+3],a+=4,l++,l>=n&&(l=0,o+=n)}return C},maximum:function(e,t,n){var a,s,l,o,u,c,h,f,p,m,d,_,g,v=e._dim,y=v*v,b=new i(e._indices),w=t.length,A=w>>2,E=new r(w),L=y<<1,M=n-1,R=A-n;for(s=0;L>s;s+=2)b[s+1]*=n;for(a=0,l=0,o=0;w>a;){for(d=0,_=0,g=0,s=0;L>s;)u=l+b[s],c=o+b[s+1],u>=0&&M>=u&&c>=0&&R>=c&&(h=u+c<<2,f=t[h],p=t[h+1],m=t[h+2],f>d&&(d=f),p>_&&(_=p),m>g&&(g=m)),s+=2;E[a]=d,E[a+1]=_,E[a+2]=g,E[a+3]=t[a+3],a+=4,l++,l>=n&&(l=0,o+=n)}return E},minimum:function(e,t,n){var a,s,l,o,u,c,h,f,p,m,d,_,g,v=e._dim,y=v*v,b=new i(e._indices),w=t.length,A=w>>2,E=new r(w),L=y<<1,M=n-1,R=A-n;for(s=0;L>s;s+=2)b[s+1]*=n;for(a=0,l=0,o=0;w>a;){for(d=255,_=255,g=255,s=0;L>s;)u=l+b[s],c=o+b[s+1],u>=0&&M>=u&&c>=0&&R>=c&&(h=u+c<<2,f=t[h],p=t[h+1],m=t[h+2],d>f&&(d=f),_>p&&(_=p),g>m&&(g=m)),s+=2;E[a]=d,E[a+1]=_,E[a+2]=g,E[a+3]=t[a+3],a+=4,l++,l>=n&&(l=0,o+=n)}return E}}}(FILTER),FILTER});
/**
*
*   FILTER.js Plugins
*   @version: 0.6.13
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(r,e,t,n,a){"use strict";var i="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),l=!i&&"undefined"!=typeof navigator,o="function"==typeof importScripts&&navigator instanceof WorkerNavigator,s=Array,u=s.prototype,c=function(){var r=null;if(i)return r=__filename,{path:__dirname,file:__filename};if(o)r=self.location.href;else if(l){var e;(e=document.getElementsByTagName("script"))&&e.length&&(r=e[e.length-1].src)}return r?{path:r.split("/").slice(0,-1).join("/"),file:r}:{path:null,file:null}},f=c(),h=function(r,e){if(i)return e;if("."==e.charAt(0)){r=r.split("/"),e=e.split("/");var t,n=0,a=0,l=e.length,o=r.length;for(t=0;l>t;t++)if(/^\.\./.test(e[t]))n++,a++;else{if(!/^\./.test(e[t]))break;a++}n=n>=o?0:o-n,e=r.slice(0,n).concat(e.slice(a)).join("/")}return e};t=t?[].concat(t):[];var p,m,d,g=t.length,v=new s(g),_=new s(g),C=new s(g),b=new s(g);for(p=0;g>p;p++)v[p]=t[p][0],_[p]=t[p][1],C[p]=/\.js$/i.test(_[p])?h(f.path,_[p]):h(f.path,_[p]+".js");if("object"==typeof module&&module.exports){if(a===module.exports[e]){for(p=0;g>p;p++)b[p]=module.exports[v[p]]||require(C[p])[v[p]];m=n.apply(r,b),module.exports[e]=m||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(_),function(t){if(a===t[e]){for(var i=u.slice.call(arguments,1),l=i.length,o=0;l>o;o++)b[o]=t[v[o]]||i[o];m=n.apply(r,b),t[e]=m||1}});else if(o){for(p=0;g>p;p++)self[v[p]]||importScripts(C[p]),b[p]=self[v[p]];m=n.apply(r,b),self[e]=m||1}else if(a===r[e]){var M=function(r,e){d=d||document.getElementsByTagName("head")[0];var t=0,n=document.createElement("script");n.type="text/javascript",n.language="javascript",n.onload=n.onreadystatechange=function(){t||n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(t=1,n.onload=n.onreadystatechange=null,d.removeChild(n),n=null,e&&e())},n.src=r,d.appendChild(n)},y=function(e,t,n){r[e]?n():M(t,n)},O=function(t){return function(){g>t&&(b[t]=r[v[t]]),++t<g?y(v[t],C[t],O(t)):(m=n.apply(r,b),r[e]=m||1)}};g?y(v[0],C[0],O(0)):(m=n.apply(r,b),r[e]=m||1)}}(this,"FILTER_PLUGINS",[["FILTER","./filter"]],function(r){var e=null;return!function(r){"use strict";var e=r._notSupportClamp,t=Math.random;r.NoiseFilter=r.Create({name:"NoiseFilter",min:-127,max:127,init:function(r,e){var t=this;t.min=r||-127,t.max=e||127},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{min:r.min,max:r.max}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.min=e.min,t.max=e.max),t},apply:function(r){var n=this;if(!n._isOn)return r;var a,i,l,o,s,u,c,f,h=n.max-n.min,p=n.min,m=r.length;if(e)for(a=0;m>a;a+=4)l=r[a],o=r[a+1],s=r[a+2],i=h*t()+p,u=l+i,c=o+i,f=s+i,0>u?u=0:u>255&&(u=255),0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),r[a]=~~u,r[a+1]=~~c,r[a+2]=~~f;else for(a=0;m>a;a+=4)l=r[a],o=r[a+1],s=r[a+2],i=h*t()+p,u=l+i,c=o+i,f=s+i,r[a]=~~u,r[a+1]=~~c,r[a+2]=~~f;return r}})}(r),!function(r){"use strict";var e=r._notSupportClamp,t=r.Array32F,n=r.Color.RGB2YCbCr,a=r.Color.YCbCr2RGB;r.HistogramEqualizeFilter=r.Create({name:"HistogramEqualizeFilter",path:r.getPath(),apply:function(r){var i,l,o,s,u,c,f,h,p,m,d,g=0,v=255,_=0,C=r.length,b=C>>2,M=1/b;for(u=new t(256),p=0;256>p;p+=4)u[p]=0,u[p+1]=0,u[p+2]=0,u[p+3]=0;for(p=0;C>p;p+=4)i=r[p],l=r[p+1],o=r[p+2],m=n({r:i,g:l,b:o}),i=r[p]=~~m.cr,l=r[p+1]=~~m.y,o=r[p+2]=~~m.cb,u[l]+=M,l>g?g=l:v>l&&(v=l);for(_=0,p=0;256>p;p+=4)_+=u[p],u[p]=_,_+=u[p+1],u[p+1]=_,_+=u[p+2],u[p+2]=_,_+=u[p+3],u[p+3]=_;if(s=g-v,e)for(p=0;C>p;p+=4)m={cr:r[p],y:r[p+1],cb:r[p+2]},m.y=u[m.y]*s+v,d=a(m),c=d.r,f=d.g,h=d.b,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,h=0>h?0:h>255?255:h,r[p]=~~c,r[p+1]=~~f,r[p+2]=~~h;else for(p=0;C>p;p+=4)m={cr:r[p],y:r[p+1],cb:r[p+2]},m.y=u[m.y]*s+v,d=a(m),r[p]=~~d.r,r[p+1]=~~d.g,r[p+2]=~~d.b;return r}})}(r),!function(r){"use strict";var e=r._notSupportClamp,t=r.Array32F;r.GrayscaleHistogramEqualizeFilter=r.Create({name:"GrayscaleHistogramEqualizeFilter",path:r.getPath(),apply:function(r){var n,a,i,l,o,s=0,u=255,c=0,f=r.length,h=f>>2,p=1/h;for(l=new t(256),o=0;256>o;o+=4)l[o]=0,l[o+1]=0,l[o+2]=0,l[o+3]=0;for(o=0;f>o;o+=4)n=r[o],l[n]+=p,n>s?s=n:u>n&&(u=n);for(c=0,o=0;256>o;o+=4)c+=l[o],l[o]=c,c+=l[o+1],l[o+1]=c,c+=l[o+2],l[o+2]=c,c+=l[o+3],l[o+3]=c;if(i=s-u,e)for(o=0;f>o;o+=4)n=r[o],a=l[n]*i+u,a=0>a?0:a>255?255:a,a=~~a,r[o]=a,r[o+1]=a,r[o+2]=a;else for(o=0;f>o;o+=4)n=r[o],a=~~(l[n]*i+u),r[o]=a,r[o+1]=a,r[o+2]=a;return r}})}(r),!function(r){"use strict";var e=r._notSupportClamp,t=r.Array32F;r.RGBHistogramEqualizeFilter=r.Create({name:"RGBHistogramEqualizeFilter",path:r.getPath(),apply:function(r){var n=this;if(!n._isOn)return r;var a,i,l,o,s,u,c,f,h,p,m,d,g,v,_,C,b=0,M=0,y=0,O=255,F=255,z=255,I=r.length,Y=I>>2,k=1/Y;for(c=new t(256),f=new t(256),h=new t(256),C=0;256>C;C+=4)c[C]=0,f[C]=0,h[C]=0,c[C+1]=0,f[C+1]=0,h[C+1]=0,c[C+2]=0,f[C+2]=0,h[C+2]=0,c[C+3]=0,f[C+3]=0,h[C+3]=0;for(C=0;I>C;C+=4)a=r[C],i=r[C+1],l=r[C+2],c[a]+=k,f[i]+=k,h[l]+=k,a>b?b=a:O>a&&(O=a),i>M?M=i:F>i&&(F=i),l>y?y=l:z>l&&(z=l);for(p=m=d=0,C=0;256>C;C+=4)p+=c[C],c[C]=p,m+=f[C],f[C]=m,d+=h[C],h[C]=d,p+=c[C+1],c[C+1]=p,m+=f[C+1],f[C+1]=m,d+=h[C+1],h[C+1]=d,p+=c[C+2],c[C+2]=p,m+=f[C+2],f[C+2]=m,d+=h[C+2],h[C+2]=d,p+=c[C+3],c[C+3]=p,m+=f[C+3],f[C+3]=m,d+=h[C+3],h[C+3]=d;if(o=b-O,s=M-F,u=y-z,e)for(C=0;I>C;C+=4)a=r[C],i=r[C+1],l=r[C+2],g=c[a]*o+O,v=f[i]*s+F,_=h[l]*u+z,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,_=0>_?0:_>255?255:_,r[C]=~~g,r[C+1]=~~v,r[C+2]=~~_;else for(C=0;I>C;C+=4)a=r[C],i=r[C+1],l=r[C+2],g=c[a]*o+O,v=f[i]*s+F,_=h[l]*u+z,r[C]=~~g,r[C+1]=~~v,r[C+2]=~~_;return r}})}(r),!function(r){"use strict";var e=Math.sqrt,t=r._notSupportClamp,n=r.Array32F;r.PixelateFilter=r.Create({name:"PixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.scale=e.scale),t},apply:function(r,a,i){var l=this;if(!l._isOn||l.scale<=1)return r;l.scale>100&&(l.scale=100);var o,s,u,c,f,h,p,m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K,Z=r.length,re=Z>>2,ee=(a<<1)+a;for(o=~~(e(re)*l.scale*.01),s=a*o,u=i%o,c=a%o,f=(u-1)*a,d=1/(o*o),g=1/(c*o),v=1/(u*o),_=1/(c*u),C=d,b=g,M=v,y=_,Y=o-1,k=(o-1)*a,L=0,j=a-1,T=0,V=re-a,O=new n(3*re),X=0,S=0,x=0,F=z=I=0,x=0;a>x;x++,X+=4,S+=3)F+=r[X],z+=r[X+1],I+=r[X+2],O[S]=F,O[S+1]=z,O[S+2]=I;for(S=0,x=0,F=z=I=0,X=ee+a;Z>X;X+=4,S+=3,x++)x>=a&&(x=0,F=z=I=0),F+=r[X],z+=r[X+1],I+=r[X+2],O[S+ee]=O[S]+F,O[S+ee+1]=O[S+1]+z,O[S+ee+2]=O[S+2]+I;for(x=0,w=0,E=0,B=x,N=E,R=B+Y,G=N+k,R=R>j?j:R,G=G>V?V:G,D=B+N,W=R+G,U=R+N,Q=B+G,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,m=C,$=m*(O[W]-O[U]-O[Q]+O[D]),J=m*(O[W+1]-O[U+1]-O[Q+1]+O[D+1]),K=m*(O[W+2]-O[U+2]-O[Q+2]+O[D+2]),t&&($=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),$=~~$,J=~~J,K=~~K,A=0,P=0,q=0,X=0;Z>X;X+=4)H=A+x+q+E<<2,r[H]=$,r[H+1]=J,r[H+2]=K,A++,(A+x>=a||A>=o)&&(A=0,P++,q+=a),(P+w>=i||P>=o)&&(x+=o,x>=a&&(x=0,w+=o,E+=s),A=0,P=0,q=0,B=x,N=E,R=B+Y,G=N+k,R=R>j?j:R,G=G>V?V:G,D=B+N,W=R+G,U=R+N,Q=B+G,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,h=0==R-B-c+1,p=0==G-N-f,m=h&&p?y:h?b:p?M:C,$=m*(O[W]-O[U]-O[Q]+O[D]),J=m*(O[W+1]-O[U+1]-O[Q+1]+O[D+1]),K=m*(O[W+2]-O[U+2]-O[Q+2]+O[D+2]),t&&($=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),$=~~$,J=~~J,K=~~K);return r}})}(r),!function(r){"use strict";var e=Math.sqrt,t=(Math.SQRT2,Math.min,r._notSupportClamp),n=r.Array32F;r.TriangularPixelateFilter=r.Create({name:"TriangularPixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.scale=e.scale),t},apply:function(r,a,i){var l=this;if(!l._isOn||l.scale<=1)return r;l.scale>100&&(l.scale=100);var o,s,u,c,f,h,p,m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K,Z,re,ee,te,ne,ae,ie,le,oe=r.length,se=oe>>2,ue=(a<<1)+a;for(o=~~(e(se)*l.scale*.01),s=o>>1,u=o-1,c=a*o,f=i%o,h=a%o,p=(f-1)*a,v=1/(o*o),_=1/(h*o),C=1/(f*o),b=1/(h*f),M=2*v,y=2*_,O=2*C,F=2*b,X=u,S=u*a,j=0,D=a-1,V=0,U=se-a,z=new n(3*se),x=0,w=0,E=0,I=Y=k=0,E=0;a>E;E++,x+=4,w+=3)I+=r[x],Y+=r[x+1],k+=r[x+2],z[w]=I,z[w+1]=Y,z[w+2]=k;for(w=0,E=0,I=Y=k=0,x=ue+a;oe>x;x+=4,w+=3,E++)E>=a&&(E=0,I=Y=k=0),I+=r[x],Y+=r[x+1],k+=r[x+2],z[w+ue]=z[w]+I,z[w+ue+1]=z[w+1]+Y,z[w+ue+2]=z[w+2]+k;for(E=0,A=0,P=0,R=E,G=P,L=E-s+X,T=P+S,L=L>D?D:L,T=T>U?U:T,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,g=M,ee=g*(z[J]-z[W]-z[$]+z[Q]),te=g*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),ne=g*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),R=E+s,L=E+X,L=L>D?D:L,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,ae=g*(z[J]-z[W]-z[$]+z[Q]),ie=g*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),le=g*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),t&&(ee=0>ee?0:ee>255?255:ee,te=0>te?0:te>255?255:te,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie,le=0>le?0:le>255?255:le),ee=~~ee,te=~~te,ne=~~ne,ae=~~ae,ie=~~ie,le=~~le,K=ee,Z=te,re=ne,q=0,H=0,B=0,x=0;oe>x;x+=4)N=q+E+B+P<<2,r[N]=K,r[N+1]=Z,r[N+2]=re,q++,(q+E>=a||q>=o)&&(q=0,H++,B+=a,K=ee,Z=te,re=ne),q>u-H&&(K=ae,Z=ie,re=le),(H+A>=i||H>=o)&&(E+=o,E>=a&&(E=0,A+=o,P+=c),q=0,H=0,B=0,R=E,G=P,L=E-s+X,T=P+S,L=L>D?D:L,T=T>U?U:T,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,m=0==L-R+s-h+1,d=0==T-G-p,g=m&&d?F:m?y:d?O:M,ee=g*(z[J]-z[W]-z[$]+z[Q]),te=g*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),ne=g*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),R=E+s,L=E+X,L=L>D?D:L,Q=R+G,J=L+T,W=L+G,$=R+T,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,J=(J<<1)+J,m=0==L-R+s-h+1,g=m&&d?F:m?y:d?O:M,ae=g*(z[J]-z[W]-z[$]+z[Q]),ie=g*(z[J+1]-z[W+1]-z[$+1]+z[Q+1]),le=g*(z[J+2]-z[W+2]-z[$+2]+z[Q+2]),t&&(ee=0>ee?0:ee>255?255:ee,te=0>te?0:te>255?255:te,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie,le=0>le?0:le>255?255:le),ee=~~ee,te=~~te,ne=~~ne,ae=~~ae,ie=~~ie,le=~~le,K=ee,Z=te,re=ne);return r}})}(r),!function(r){"use strict";var e=r._notSupportClamp,t=r.Color.RGB2HSV,n=.7083333333333334;r.HSVConverterFilter=r.Create({name:"HSVConverterFilter",path:r.getPath(),apply:function(r){var a=this;if(!a._isOn)return r;var i,l,o,s,u,c,f,h,p=r.length;if(e)for(s=0;p>s;s+=4)i=r[s],l=r[s+1],o=r[s+2],u=t({r:i,g:l,b:o}),c=u.h*n,h=255*u.s,f=u.v,0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),0>h?h=0:h>255&&(h=255),r[s]=~~c,r[s+1]=~~f,r[s+2]=~~h;else for(s=0;p>s;s+=4)i=r[s],l=r[s+1],o=r[s+2],u=t({r:i,g:l,b:o}),c=u.h*n,h=255*u.s,f=u.v,r[s]=~~c,r[s+1]=~~f,r[s+2]=~~h;return r}})}(r),!function(r){"use strict";var e=(r._notSupportClamp,r.ImArray,r.Color.clampPixel),t=r.Color.RGB2HSV,n=(r.Color.HSV2RGB,r.Color.Color2RGBA);r.HueExtractorFilter=r.Create({name:"HueExtractorFilter",range:null,background:0,init:function(r,e){var t=this;t.range=r,t.background=e||0},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{range:r.range,background:r.background}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.range=e.range,t.background=e.background),t},apply:function(r){var a=this;if(!a._isOn||!a.range||!a.range.length)return r;var i,l,o,s,u,c,f,h,p,m,d=r.length,g=a.range[0],v=a.range[a.range.length-1];for(p=n(a.background||0),s=~~e(p.r),u=~~e(p.g),c=~~e(p.b),f=~~e(p.a),h=0;d>h;h+=4)i=r[h],l=r[h+1],o=r[h+2],m=t({r:i,g:l,b:o}).h,(g>m||m>v)&&(r[h]=s,r[h+1]=u,r[h+2]=c,r[h+3]=f);return r}})}(r),!function(r){"use strict";{var e=(r._notSupportClamp,Math.min),t=Math.floor,n=r.CHANNEL.RED;r.CHANNEL.GREEN,r.CHANNEL.BLUE,r.CHANNEL.ALPHA}r.ChannelCopyFilter=r.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,init:function(r,e,t,a,i){var l=this;l._srcImg=null,l.srcImg=null,l.srcChannel=e||n,l.dstChannel=t||n,l.centerX=a||0,l.centerY=i||0,r&&l.setSrc(r)},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_srcImg:r._srcImg,centerX:r.centerX,centerY:r.centerY,srcChannel:r.srcChannel,dstChannel:r.dstChannel}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t._srcImg=e._srcImg,t.centerX=e.centerX,t.centerY=e.centerY,t.srcChannel=e.srcChannel,t.dstChannel=e.dstChannel),t},setSrc:function(r){var e=this;return r&&(e.srcImg=r,e._srcImg={data:r.getData(),width:r.width,height:r.height}),e},apply:function(r,n,a){var i=this;if(!i._isOn||!i._srcImg)return r;var l,o,s,u,c,f,h=i._srcImg.data,p=r.length,m=(h.length,i._srcImg.width),d=i._srcImg.height,g=i.srcChannel,v=i.dstChannel,_=e(n,m),C=e(a,d),b=i.centerX||0,M=i.centerY||0,y=m>>1,O=d>>1;for(b=t(b*(n-1))-y,M=t(M*(a-1))-O,l=0,o=0,s=0,l=0;p>l;l+=4,o++)o>=n&&(o=0,s++),c=o-b,f=s-M,c>=0&&_>c&&f>=0&&C>f&&(u=c+f*m<<2,r[l+v]=h[u+g]);return r}})}(r),!function(r){"use strict";var e=(r._notSupportClamp,Math.min),t=Math.floor;r.AlphaMaskFilter=r.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,init:function(r,e,t){var n=this;n.centerX=e||0,n.centerY=t||0,n._alphaMask=null,n.alphaMask=null,r&&n.setMask(r)},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_alphaMask:r._alphaMask,centerX:r.centerX,centerY:r.centerY}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t._alphaMask=e._alphaMask,t.centerX=e.centerX,t.centerY=e.centerY),t},setMask:function(r){var e=this;return r&&(e.alphaMask=r,e._alphaMask={data:r.getData(),width:r.width,height:r.height}),e},apply:function(r,n,a){var i=this;if(!i._isOn||!i._alphaMask)return r;var l,o,s,u,c,f,h=i._alphaMask.data,p=i._alphaMask.width,m=i._alphaMask.height,d=r.length,g=(h.length,e(n,p)),v=e(a,m),_=i.centerX||0,C=i.centerY||0,b=p>>1,M=m>>1;for(_=t(_*(n-1))-b,C=t(C*(a-1))-M,o=0,s=0,l=0;d>l;l+=4,o++)o>=n&&(o=0,s++),c=o-_,f=s-C,c>=0&&g>c&&f>=0&&v>f?(u=c+f*p<<2,r[l+3]=h[u+3]):r[l+3]=0;return r}})}(r),!function(r,e){"use strict";var t,n=Math.min,a=Math.max,i=Math.round,l=(Math.floor,Math.abs),o=r._notSupportClamp;r.BlendFilter=r.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendMode:null,blendImage:null,startX:0,startY:0,amount:1,init:function(r,e,t){var n=this;n.startX=0,n.startY=0,n.amount=1,n._blendImage=null,n.blendImage=null,n._blendMode=null,n.blendMode=null,r&&n.setImage(r),e&&n.setMode(e,t)},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_blendImage:r._blendImage,_blendMode:r._blendMode,startX:r.startX,startY:r.startY,amount:r.amount}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t._blendImage=e._blendImage,t.startX=e.startX,t.startY=e.startY,t.setMode(e._blendMode,e.amount)),t},setImage:function(r){var e=this;return r&&(e.blendImage=r,e._blendImage={data:r.getData(),width:r.width,height:r.height}),e},setMode:function(r,i){var l=this;return r?(l._blendMode=(""+r).toLowerCase(),l.blendMode=t[l._blendMode]||null,l.amount=a(0,n(1,e===i?1:i))):(l._blendMode=null,l.blendMode=null),l},reset:function(){var r=this;return r.startX=0,r.startY=0,r.amount=1,r._blendMode=null,r.blendMode=null,r},apply:function(r,e,t){var a=this;if(!a._isOn||!a.blendMode||!a._blendImage)return r;var l,o,s,u,c,f=a.startX||0,h=a.startY||0,p=0,m=0,d=a._blendImage,g=a.amount||1;return u=d.width,c=d.height,0>f&&(p=-f,f=0),0>h&&(m=-h,h=0),f>=e||h>=t?r:p>=u||m>=c?r:(f=i(f),h=i(h),p=i(p),m=i(m),l=n(e-f,u-p),o=n(t-h,c-m),0>=l||0>=o?r:(s=d.data,a.blendMode(r,e,t,s,u,c,f,h,p,m,l,o,g)))}}),t={normal:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=Y,x=k,w=X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},lighten:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=F>Y?F:Y,x=z>k?z:k,w=I>X?I:X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},darken:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=F>Y?Y:F,x=z>k?k:z,w=I>X?X:I,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},multiply:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=F*Y*.003921568627451,x=z*k*.003921568627451,w=I*X*.003921568627451,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},average:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=.5*(F+Y),x=.5*(z+k),w=.5*(I+X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},add:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=F+Y,x=z+k,w=I+X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},subtract:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=255>F+Y?0:F+Y-255,x=255>z+k?0:z+k-255,w=255>I+X?0:I+X-255,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},difference:function(r,e,t,n,a,i,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*e,O=c,F=f*a,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=n[b],X=n[b+1],S=n[b+2],x=l(k-z),w=l(X-I),E=l(S-Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=e),O++,O>=g&&(O=c,F+=a);return r},negation:function(r,e,t,n,a,i,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*e,O=c,F=f*a,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=n[b],X=n[b+1],S=n[b+2],x=255-l(255-k-z),w=255-l(255-X-I),E=255-l(255-S-Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=e),O++,O>=g&&(O=c,F+=a);return r},screen:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=255-((255-Y)*(255-F)>>8),x=255-((255-k)*(255-z)>>8),w=255-((255-X)*(255-I)>>8),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},exclusion:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=Y+F-2*Y*F*.003921568627451,x=k+z-2*k*z*.003921568627451,w=X+I-2*X*I*.003921568627451,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},overlay:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>F?2*Y*F*.003921568627451:255-2*(255-Y)*(255-F)*.003921568627451,x=128>z?2*k*z*.003921568627451:255-2*(255-k)*(255-z)*.003921568627451,S=128>I?2*X*I*.003921568627451:255-2*(255-X)*(255-I)*.003921568627451,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},softlight:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>F?2*((Y>>1)+64)*.003921568627451*F:255-2*(255-((Y>>1)+64))*(255-F)*.003921568627451,x=128>z?2*((k>>1)+64)*.003921568627451*z:255-2*(255-((k>>1)+64))*(255-z)*.003921568627451,w=128>I?2*((X>>1)+64)*.003921568627451*I:255-2*(255-((X>>1)+64))*(255-I)*.003921568627451,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},hardlight:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>Y?2*F*Y*.003921568627451:255-2*(255-F)*(255-Y)*.003921568627451,x=128>k?2*z*k*.003921568627451:255-2*(255-z)*(255-k)*.003921568627451,w=128>X?2*I*X*.003921568627451:255-2*(255-I)*(255-X)*.003921568627451,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},colordodge:function(r,e,t,a,i,l,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*e,O=c,F=f*i,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==z?z:n(255,(k<<8)/(255-z)),w=255==I?I:n(255,(X<<8)/(255-I)),E=255==Y?z:n(255,(S<<8)/(255-Y)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=e),O++,O>=g&&(O=c,F+=i);return r},colorburn:function(r,e,t,n,i,l,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*e,O=c,F=f*i,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=n[b],X=n[b+1],S=n[b+2],x=0==z?z:a(0,255-(255-k<<8)/z),w=0==I?I:a(0,255-(255-X<<8)/I),E=0==Y?Y:a(0,255-(255-S<<8)/Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=e),O++,O>=g&&(O=c,F+=i);return r},linearlight:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;for(var A;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],128>F?(A=2*F,S=255>A+Y?0:A+Y-255):(A=2*(F-128),S=A+Y),128>z?(A=2*z,x=255>A+k?0:A+k-255):(A=2*(z-128),x=A+k),128>I?(A=2*I,w=255>A+X?0:A+X-255):(A=2*(I-128),w=A+X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},reflect:function(r,e,t,a,i,l,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*e,O=c,F=f*i,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==z?z:n(255,k*k/(255-z)),w=255==I?I:n(255,X*X/(255-I)),E=255==Y?Y:n(255,S*S/(255-Y)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=e),O++,O>=g&&(O=c,F+=i);return r},glow:function(r,e,t,a,i,l,s,u,c,f,h,p,m){var d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=s,y=u*e,O=c,F=f*i,d=s+h,g=c+h,v=0,_=p*h;_>v;)C=M+y<<2,b=O+F<<2,z=r[C],I=r[C+1],Y=r[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==k?k:n(255,z*z/(255-k)),w=255==X?X:n(255,I*I/(255-X)),E=255==S?S:n(255,Y*Y/(255-S)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,o&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),r[C]=~~z,r[C+1]=~~I,r[C+2]=~~Y,v++,M++,M>=d&&(M=s,y+=e),O++,O>=g&&(O=c,F+=i);return r},phoenix:function(r,e,t,i,l,s,u,c,f,h,p,m,d){var g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-d,y=u,O=c*e,F=f,z=h*l,g=u+p,v=f+p,_=0,C=m*p;C>_;)b=y+O<<2,M=F+z<<2,I=r[b],Y=r[b+1],k=r[b+2],X=i[M],S=i[M+1],x=i[M+2],w=n(X,I)-a(X,I)+255,E=n(S,Y)-a(S,Y)+255,A=n(x,k)-a(x,k)+255,I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,o&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),r[b]=~~I,r[b+1]=~~Y,r[b+2]=~~k,_++,y++,y>=g&&(y=u,O+=e),F++,F>=v&&(F=f,z+=l);return r},vividlight:function(r,e,t,i,l,s,u,c,f,h,p,m,d){var g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;P=1-d,y=u,O=c*e,F=f,z=h*l,g=u+p,v=f+p,_=0,C=m*p;for(var q;C>_;)b=y+O<<2,M=F+z<<2,I=r[b],Y=r[b+1],k=r[b+2],X=i[M],S=i[M+1],x=i[M+2],128>I?(q=2*I,w=0==q?q:a(0,255-(255-X<<8)/q)):(q=2*(I-128),w=255==q?q:n(255,(X<<8)/(255-q))),128>Y?(q=2*Y,E=0==q?q:a(0,255-(255-S<<8)/q)):(q=2*(Y-128),E=255==q?q:n(255,(S<<8)/(255-q))),128>k?(q=2*k,A=0==q?q:a(0,255-(255-x<<8)/q)):(q=2*(Y-128),A=255==q?q:n(255,(x<<8)/(255-q))),I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,o&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),r[b]=~~I,r[b+1]=~~Y,r[b+2]=~~k,_++,y++,y>=g&&(y=u,O+=e),F++,F>=v&&(F=f,z+=l);return r},pinlight:function(r,e,t,n,a,i,l,s,u,c,f,h,p){var m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;E=1-p,b=l,M=s*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;for(var A;v>g;)_=b+M<<2,C=y+O<<2,F=r[_],z=r[_+1],I=r[_+2],Y=n[C],k=n[C+1],X=n[C+2],128>F?(A=2*F,S=A>Y?A:Y):(A=2*(F-128),S=A>Y?Y:A),128>z?(A=2*z,x=A>k?A:k):(A=2*(F-128),x=A>k?k:A),128>I?(A=2*I,w=A>X?A:X):(A=2*(I-128),w=A>X?X:A),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,o&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),r[_]=~~F,r[_+1]=~~z,r[_+2]=~~I,g++,b++,b>=m&&(b=l,M+=e),y++,y>=d&&(y=u,O+=a);return r},hardmix:function(r,e,t,i,l,s,u,c,f,h,p,m,d){var g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;P=1-d,y=u,O=c*e,F=f,z=h*l,g=u+p,v=f+p,_=0,C=m*p;for(var q;C>_;)b=y+O<<2,M=F+z<<2,I=r[b],Y=r[b+1],k=r[b+2],X=i[M],S=i[M+1],x=i[M+2],128>I?(q=2*I,w=0==q?q:a(0,255-(255-X<<8)/q)):(q=2*(I-128),w=255==q?q:n(255,(X<<8)/(255-q))),w=128>w?0:255,128>Y?(q=2*Y,E=0==q?q:a(0,255-(255-S<<8)/q)):(q=2*(Y-128),E=255==q?q:n(255,(S<<8)/(255-q))),E=128>E?0:255,128>k?(q=2*k,A=0==q?q:a(0,255-(255-x<<8)/q)):(q=2*(k-128),A=255==q?q:n(255,(x<<8)/(255-q))),A=128>A?0:255,I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,o&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),r[b]=~~I,r[b+1]=~~Y,r[b+2]=~~k,_++,y++,y>=g&&(y=u,O+=e),F++,F>=v&&(F=f,z+=l);return r}},t.lineardodge=t.add,t.linearburn=t.subtract}(r),!function(r){"use strict";var e=(r._notSupportClamp,r.Color.RGBA2Color),t=r.Color.Color2RGBA;r.ThresholdFilter=r.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(r,e){var t=this;t.thresholds=r,t.quantizedColors=e||null},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{thresholds:r.thresholds,quantizedColors:r.quantizedColors}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.thresholds=e.thresholds,t.quantizedColors=e.quantizedColors),t},apply:function(r){var n=this;if(!(n._isOn&&n.thresholds&&n.thresholds.length&&n.quantizedColors&&n.quantizedColors.length))return r;var a,i,l,o,s,u,c,f,h=r.length,p=n.thresholds,m=p.length,d=n.quantizedColors,g=d.length;for(c=0;h>c;c+=4){for(s=e({r:r[c],g:r[c+1],b:r[c+2],a:r[c+3]}),f=0;m>f&&s>p[f];)f++;s=g>f?d[f]:255,u=t(s),a=u.r,i=u.g,l=u.b,o=u.a,r[c]=a,r[c+1]=i,r[c+2]=l,r[c+3]=o}return r}})}(r),!function(r){"use strict";var e=(Math.sqrt,Math.exp,Math.log),t=Math.abs,n=Math.floor,a=r._notSupportClamp,i=r.Array32F;r.BokehFilter=r.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(r,e,t,n){var a=this;a.centerX=r||0,a.centerY=e||0,a.radius=t||10,a.amount=n||10},path:r.getPath(),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{centerX:r.centerX,centerY:r.centerY,radius:r.radius,amount:r.amount}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.centerX=e.centerX,t.centerY=e.centerY,t.radius=e.radius,t.amount=e.amount),t},apply:function(r,l,o){var s=this;if(!s._isOn)return r;var u,c,f,h,p,m,d,g,v,_,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L=r.length,T=s.centerX||0,j=s.centerY||0,V=s.radius,D=s.amount;if(0>=D)return r;for(u=L>>2,B=0,N=l-1,R=0,G=u-l,T=n(T*(l-1)),j=n(j*(o-1)),f=(u<<1)+u,d=(l<<1)+l,c=new i(f),g=0,v=0,_=0,h=p=m=0,_=0;l>_;_++,g+=4,v+=3)h+=r[g],p+=r[g+1],m+=r[g+2],c[v]=h,c[v+1]=p,c[v+2]=m;for(g=d+l,v=0,_=0,h=p=m=0,g=d+l;L>g;g+=4,v+=3,_++)_>=l&&(_=0,h=p=m=0),h+=r[g],p+=r[g+1],m+=r[g+2],c[v+d]=c[v]+h,c[v+d+1]=c[v+1]+p,c[v+d+2]=c[v+2]+m;for(_=0,C=0,b=0,g=0;L>g;g+=4,_++)_>=l&&(_=0,C++,b+=l),y=_-T,O=C-j,M=t(y)+t(O),F=M>V?~~e((M-V)*D):~~(M/V+.5),F>0&&(z=F*l,I=.25/(F*F),Y=_-F,k=b-z,X=_+F,S=b+z,B>Y?Y=B:X>N&&(X=N),R>k?k=R:S>G&&(S=G),x=Y+k,A=X+S,w=X+k,E=Y+S,x=(x<<1)+x,w=(w<<1)+w,E=(E<<1)+E,A=(A<<1)+A,P=I*(c[A]-c[w]-c[E]+c[x]),q=I*(c[A+1]-c[w+1]-c[E+1]+c[x+1]),H=I*(c[A+2]-c[w+2]-c[E+2]+c[x+2]),a&&(P=0>P?0:P>255?255:P,q=0>q?0:q>255?255:q,H=0>H?0:H>255?255:H),r[g]=~~P,r[g+1]=~~q,r[g+2]=~~H);return r}})}(r),e});

/**
*
*   Classy.js
*   @version: 0.9.3
*   @built on 2015-04-26 17:56:03
*
*   Object-Oriented micro-framework for JavaScript
*   https://github.com/foo123/classy.js
*
**/!function(e,n,t){"use strict";var i,r="object"==typeof module&&module.exports,l="function"==typeof define&&define.amd;r?module.exports=(module.$deps=module.$deps||{})[n]=module.$deps[n]||t.call(e,{NODE:module})||1:l&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["require","exports","module"],function(n,i,r){return t.call(e,{AMD:r})}):n in e||(e[n]=i=t.call(e,{})||1)&&l&&define(n,[],function(){return i})}(this,"Classy",function(e){return!function(e,n){"use strict";var t="constructor",i="prototype",r="__proto__",l="__static__",u="__private__",a="$super",o="$static",f="$latestatic",c="$class",s=2,b=4,m=8,d=256,p=Object,v=p[i],g=Function,h=g[i],y=String,x=Number,w=RegExp,E=Array,j=v.toString,_=(h.call.bind(h.toString),"hasOwnProperty"),q="propertyIsEnumerable",I=p.keys,$=p.defineProperty,A=function(e){return typeof e},C=function(e){throw new TypeError(e)},M=2,N=3,O=4,P=8,S=9,T=16,R=32,D=64,F=128,L=256,V=512,k=1024,B={"[object Array]":T,"[object RegExp]":F,"[object Number]":M,"[object String]":P,"[object Function]":D,"[object Object]":R},U=function(e){var t;return null===e?L:!0===e||!1===e?O:n===e?V:(t=j.call(e),t=B[t]||k,M===t||e instanceof x?isNaN(e)?N:M:P===t||e instanceof y?1===e.length?S:P:T===t||e instanceof E?T:F===t||e instanceof w?F:D===t||e instanceof g?D:R===t?R:k)},z=function(e,n){var t,i=n.length,r=[].concat(e);for(t=0;i>t;t++)-1<r.indexOf(n[t])||r.push(n[t]);return r},G=function(e,n){R!==U(e)&&C("bad desc");var t={};if(e[_]("enumerable")&&(t.enumerable=!!n.enumerable),e[_]("configurable")&&(t.configurable=!!n.configurable),e[_]("value")&&(t.value=n.value),e[_]("writable")&&(t.writable=!!e.writable),e[_]("get")){var i=e.get;D!==U(i)&&"undefined"!==i&&C("bad get"),t.get=i}if(e[_]("set")){var r=e.set;D!==U(r)&&"undefined"!==r&&C("bad set"),t.set=r}return("get"in t||"set"in t)&&("value"in t||"writable"in t)&&C("identity-confused descriptor"),t},H=p.defineProperties||function(e,n){("object"!==A(e)||null===e)&&C("bad obj"),n=p(n);for(var t=I(n),i=[],r=0;r<t.length;r++)i.push([t[r],G(n[t[r]],e)]);for(var r=0;r<i.length;r++)$(e,i[r][0],i[r][1]);return e},J=function(){},K=p.create||function(e,n){var t,l=function(){};return l[i]=e,t=new l,t[r]=e,"object"===A(n)&&H(t,n),t},Q=function(){var e,n,t,i,r,l,u,a=arguments;for(n=a[0]||{},e=a.length,l=1;e>l;l++)if(t=a[l],R===U(t))for(r in t)t[_](r)&&t[q](r)&&(i=t[r],u=U(i),n[r]=M&u?0+i:(P|T)&u?i.slice(0):i);return n},W=function(e,n,i){var r,l,u=!!n;if(u||i)if(r={},n=u?n+"$":n,i&&D===U(i))for(l in e)e[_](l)&&(t!==l?(u&&D===U(e[l])&&(r[n+l]=e[l]),r[i(l,e[l])]=e[l]):r[l]=e[l]);else for(l in e)e[_](l)&&(t!==l?(u&&D===U(e[l])&&(r[n+l]=e[l]),i&&l in i?r[i[l]]=e[l]:r[l]=e[l]):r[l]=e[l]);else r=e;return r},X=function(e){var n=e[a]||J,t=e[a+"v"]||J,i=null;return[function(t,r,l,u,a,o,f,c,s,b,m){var d,p;return i===t?d=n.call(this,t,r,l,u,a,o,f,c,s,b,m):(p=e[t])&&(i=t,d=p.call(this,r,l,u,a,o,f,c,s,b,m),i=null),d},function(n,r){var l,u;return i===n?l=t.call(this,n,r):(u=e[n])&&(i=n,l=r&&r.length?u.apply(this,r):u.call(this),i=null),l}]},Y=function(e,n){return this instanceof Y?(this.factory=e,void(this.qualifier=(M===U(n)?n:0)|s)):new Y(e,n)},Z=function(e,n){return this instanceof Z?(this.prop=e,void(this.qualifier=(M===U(n)?n:0)|s)):new Z(e,n)},en=function(e,r,s,v){e=e||p,r=r||{};var g,h,y,x,w,E,j,q,$,A,C=e[o]||null,N=e[f]||{},O=e[i],S=null,F=Q({},N),L=null,V={};r[_](t)||(r[t]=function(){}),g=r[t],r[_](u)&&(V=r[u]||{},delete r[u]),r[_](l)&&(S=r[l],L=I(S),delete r[l]);for($ in r)if(r[_]($)){if(A=r[$],A instanceof Y){if(m&A.qualifier){d&A.qualifier?F[$]=A:((S=S||{})[$]=A.factory(e,V,g),(L=L||[]).push($)),delete r[$];continue}if(b&A.qualifier){V[$]=A,delete r[$];continue}A=r[$]=A.factory(O,V,g)}D===U(A)&&(A[a]=O[$]||J)}for($ in V)V[_]($)&&(A=V[$],A instanceof Y&&(A=V[$]=A.factory(O,V,g)),D!==U(A)&&delete V[$]);if(g[i]=W(K(O),s,v),g[i]=Q(g[i],r),h=X(O),w={},w[c]=w[t]={value:g,enumerable:!1,writable:!0,configurable:!0},w[a]={value:h[0],enumerable:!1,writable:!0,configurable:!0},w[a+"v"]={value:h[1],enumerable:!1,writable:!0,configurable:!0},H(g[i],w),w={},C||L)for(C=z(C||[],L||[]),x=C.length,y=0;x>y;y++){if(E=C[y],j=null,S&&n!==S[E]){if((A=S[E])instanceof Y){if((m|d)&A.qualifier){F[E]=A;continue}j=A.factory(e,V,g)}else{if(F[_](E))continue;j=S[E]}D===U(j)&&(j[a]=e[E]||J)}else n!==e[E]&&(q=U(e[E]),j=R===q?Q(null,e[E]):(P|T)&q?e[E].slice(0):M&q?0+e[E]:e[E]);w[E]={value:j,enumerable:!1,writable:!0,configurable:!0}}for(E in F)F[_](E)&&(j=F[E].factory(e,V,g),w[E]={value:j,enumerable:!1,writable:!0,configurable:!0});return w[o]={value:C,enumerable:!1,writable:!0,configurable:!0},w[f]={value:F,enumerable:!1,writable:!0,configurable:!0},w[a]={value:e,enumerable:!1,writable:!0,configurable:!0},H(g,w),g},nn=Q,tn=Q,rn=function(e){var t,r,l,u;if(D===U(e)){if(a in e&&(e[a]=n),c in e&&(e[c]=n),f in e&&(e[f]=n),o in e){for(l=e[o],t=0,r=l.length;r>t;t++)u=l[t],u in e&&(D===U(e[u])&&e[u][a]&&(e[u][a]=n),e[u]=n);e[o]=n}l=e[i];for(u in l)D===U(l[u])&&(l[u][a]&&(l[u][a]=n),l[u]=n);l[a]=n,l[a+"v"]=n}},ln=function(){var e=arguments,n=e.length,t=null;if(m===e[0])return e[1]||{};if(n>=2){var r=U(e[0]);r=D===r?{Extends:e[0]}:R===r?e[0]:{Extends:p};var l,u,a=e[1]||{},o={},f=r[_]("Extends")?r.Extends:r[_]("extends")?r["extends"]:p,c=r[_]("Implements")?r.Implements:r[_]("implements")?r["implements"]:null,s=r[_]("Mixin")?r.Mixin:r[_]("mixin")?r.mixin:null,b=null;if(c=c?[].concat(c):null,s=s?[].concat(s):null)for(l=0,u=s.length;u>l;l++)R===U(s[l])?s[l][_]("mixin")&&s[l].mixin&&s[l].mixin[i]&&(b=W(s[l].mixin[i],s[l].namespace||null,s[l].as||null),o=tn(o,b)):s[l][i]&&(b=s[l][i],o=tn(o,b));if(c)for(l=0,u=c.length;u>l;l++)R===U(c[l])?c[l][_]("implements")&&c[l]["implements"]&&c[l]["implements"][i]&&(b=W(c[l].implements[i],c[l].namespace||null,c[l].as||null),o=nn(o,b)):c[l][i]&&(b=c[l][i],o=nn(o,b));t=R===U(f)?en(f.extends||p,Q(o,a),f.namespace||null,f.as||null):en(f,Q(o,a))}else t=en(p,e[0]);return t};e.Classy={VERSION:"0.9.3",PUBLIC:s,STATIC:m,LATE:d,PRIVATE:b,Type:U,Create:K,Merge:Q,Alias:W,Implements:nn,Mixin:tn,Extends:en,Dispose:rn,Method:Y,Prop:Z,Class:ln}}(e),e.Classy});
/**
*
*   Asynchronous.js
*   @version: 0.4.5
*
*   Simple JavaScript class to manage asynchronous, parallel, linear, sequential and interleaved tasks
*   https://github.com/foo123/asynchronous.js
*
**/!function(n,e,t){"use strict";var r,o="object"==typeof module&&module.exports,s="function"==typeof define&&define.amd;o?module.exports=(module.$deps=module.$deps||{})[e]=module.$deps[e]||t.call(n,{NODE:module})||1:s&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["require","exports","module"],function(e,r,o){return t.call(n,{AMD:o})}):e in n||(n[e]=r=t.call(n,{})||1)&&s&&define(e,[],function(){return r})}(this,"Asynchronous",function(exports){return!function(root,exports,undef){"use strict";function formatOptions(n){var e,t=[];if(n)for(e in n)t.push(e+"="+n[e]);return t.join(",")}function runParallelised(n){n.$runmode=PARALLELISED,n.$running=!1}function runLinearised(n,e){var t,r=n,o=r.$queue;if(r.$runmode=LINEARISED,o){for(;o.length&&(!o[0]||!o[0].canRun());)o.shift();o.length?(r.$running=!0,t=o.shift(),e?t.runWithArgs(e):t.run(),t.complete()):r.$running=!1}}function runInterleaved(n,e){var t,r=n,o=r.$queue,s=0;if(r.$runmode=INTERLEAVED,o&&o.length){for(r.$running=!0;s<o.length;)t=o[s],t&&t.canRun()?(e?t.runWithArgs(e):t.run(),t.isFinished()?(o.shift(),t.complete()):s++):o.shift();r.$running=!1,r.$timer=SetTime(curry(runInterleaved,r),r.$interval)}}function runSequenced(n,e){var t,r=n,o=r.$queue;r.$runmode=SEQUENCED,o&&o.length&&(t=o[0],t&&t.canRun()?(r.$running=!0,e?t.runWithArgs(e):t.run(),t.isFinished()&&(o.shift(),t.complete())):o.shift(),r.$running=!1,r.$timer=SetTime(curry(runSequenced,r),r.$interval))}var PROTO="prototype",HAS="hasOwnProperty",Obj=Object,Arr=Array,Func=Function,FP=Func[PROTO],OP=Obj[PROTO],AP=Arr[PROTO],slice=FP.call.bind(AP.slice),toString=OP.toString,is_function=function(n){return"function"==typeof n},is_instance=function(n,e){return n instanceof e},SetTime=setTimeout,ClearTime=clearTimeout,UNDEFINED=undef,UNKNOWN=0,NODE=1,BROWSER=2,DEFAULT_INTERVAL=60,NONE=0,INTERLEAVED=1,LINEARISED=2,PARALLELISED=3,SEQUENCED=4,isNode="undefined"!=typeof global&&"[object global]"===toString.call(global),isNodeProcess=!(!isNode||!process.env.NODE_UNIQUE_ID),isBrowser=!isNode&&"undefined"!=typeof navigator,isWebWorker=isBrowser&&"function"==typeof importScripts&&is_instance(navigator,WorkerNavigator),isBrowserWindow=isBrowser&&!isWebWorker&&!!root.opener,isAMD="function"==typeof define&&define.amd,supportsMultiThread=isNode||"function"==typeof Worker,isThread=isNodeProcess||isWebWorker,Thread,numProcessors=isNode?require("os").cpus().length:4,fromJSON=JSON.parse,toJSON=JSON.stringify,onMessage,curry=function(n,e){return function(){return n(e)}},URL="undefined"!=typeof root.webkitURL?root.webkitURL:"undefined"!=typeof root.URL?root.URL:null,blobURL=function(n,e){return n&&URL?URL.createObjectURL(new Blob(n.push?n:[n],e||{type:"text/javascript"})):n},path=function(n){var e;return isNode?{file:__filename,path:__dirname}:isWebWorker?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:isAMD&&n&&n.uri?{file:e=n.uri,path:e.split("/").slice(0,-1).join("/")}:isBrowser&&(e=document.getElementsByTagName("script"))&&e.length?{file:e=e[e.length-1].src,path:e.split("/").slice(0,-1).join("/")}:{path:null,file:null}},thisPath=path(exports.AMD),tpf=thisPath.file,notThisPath=function(n){return!(!n||!n.length||n===tpf)},extend=function(n,e){if(n=n||{},e)for(var t in e)e[HAS](t)&&(n[t]=e[t]);return n},_uuid=0;if(onMessage=isWebWorker?function(n){n&&(onmessage=n)}:isNodeProcess?function(n){n&&process.on("message",function(e){n(fromJSON(e))})}:function(){},isNode){var fs=require("fs"),ps=require("child_process");root.close=function(){process.exit()},root.postMessage=function(n){process.send(toJSON({data:n}))},root.importScripts=function(scripts){if(scripts&&(scripts=scripts.split(",")).length)for(var i=0,src,ok;i<scripts.length;){ok=!0;try{src=fs.readFileSync(scripts[i++]),eval(src)}catch(e){ok=e}if(!0!==ok)throw ok}},Thread=function(n){var e=this;e.process=ps.fork(n),e.process.on("message",function(n){e.onmessage&&e.onmessage(fromJSON(n))}),e.process.on("error",function(n){e.onerror&&e.onerror(n)})},Thread[PROTO]={constructor:Thread,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.send(toJSON({data:n})),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}}else Thread=root.Worker;var BrowserWindow=function(n){var e=this;return e instanceof BrowserWindow?(e.$id=(++_uuid).toString(16),void(e.options=extend({width:400,height:400,toolbar:"no",location:"no",directories:"no",status:"no",menubar:"no",scrollbars:"yes",resizable:"yes"},n))):new BrowserWindow(n)};BrowserWindow[PROTO]={constructor:BrowserWindow,options:null,$id:null,$window:null,dispose:function(){var n=this;return n.$window&&n.close(),n.$window=null,n.$id=null,n.options=null,n},close:function(){var n=this;return n.$window&&(n.$window.closed||n.$window.close(),n.$window=null),n},ready:function(n,e){var t=this,r=function o(){!t.$window||n&&!t.$window[n]?setTimeout(o,40):e()};return setTimeout(r,0),t},open:function(n){var e=this;return!e.$window&&n&&(e.$window=window.open(n.push?blobURL(["﻿"].concat(n),{type:"text/html;charset=utf-8"}):n,e.$id,formatOptions(e.options))),e},write:function(n){var e=this;return e.$window&&n&&e.$window.document.write(n),e}};var Task=function(n){if(n instanceof Task)return n;if(!(this instanceof Task))return new Task(n);var e,t=this,r=null,o=null,s=null,i=!1,u=!1,a=!1,l=!1,c=!1,f=!1,p=null,d=0,h=1,m=null,$=null,v=null,g=undef;t.queue=function(n){return arguments.length?(r=n,t):r},t.jumpNext=function(n){r&&r.jumpNext(!1,n)},t.abort=function(n){r&&(r.abort(!1),n&&(r.dispose(),r=null))},t.dispose=function(){r&&(r.dispose(),r=null)},t.task=function(n){return o=n,t},n&&t.task(n),t.run=e=function(){return o.jumpNext=t.jumpNext,o.abort=t.abort,o.dispose=t.dispose,g=o(),i=!0,o.jumpNext=null,o.abort=null,o.dispose=null,g},t.runWithArgs=function(n){return o.jumpNext=t.jumpNext,o.abort=t.abort,o.dispose=t.dispose,g=o.apply(null,n),i=!0,o.jumpNext=null,o.abort=null,o.dispose=null,g},t.canRun=function(){return o&&(!i||u||a||l||c||f)?(u||a)&&d>=m?!1:a&&!p?!1:(l||c)&&g===$?!1:!0:!1},t.iif=function(n,e,r){return n?t.task(e):arguments.length>2&&t.task(r),t},t.until=function(n){return g=undef,p=null,$=n,c=!0,f=!1,u=!1,a=!1,l=!1,t.run=e,t},t.untilNot=function(n){return g=undef,p=null,v=n,f=!0,c=!1,u=!1,a=!1,l=!1,t.run=e,t},t.loop=function(n,e,r){return g=undef,p=null,d=e||0,h=r||1,m=n,u=!0,c=!1,f=!1,a=!1,l=!1,t.run=function(){var n;return n=o(d),d+=h,g=n,i=!0,n},t},t.each=function(n){return g=undef,p=n,d=0,h=1,m=n?n.length||0:0,a=!0,c=!1,f=!1,u=!1,l=!1,t.run=function(){var n;return n=o(p[d],d),d++,g=n,i=!0,n},t},t.recurse=function(n,e){return p=null,g=n,$=e,l=!0,c=!1,f=!1,u=!1,a=!1,t.run=function(){var n;return n=o(g),g=n,i=!0,n},t},t.isFinished=function(){var n=!i||f||c||u||a||l;return n&&(c||l)&&g===$&&(n=!1),n&&f&&g!==v&&(n=!1),n&&(u||a)&&d>=m&&(n=!1),!n},t.onComplete=function(n){return s=n||null,t},t.complete=function(){return s&&is_function(s)&&s(),t}},Asynchronous=exports.Asynchronous=function(n,e){if(is_instance(n,Task))return n;if(is_function(n))return new Task(n);if(!is_instance(this,Asynchronous))return new Asynchronous(n);var t=this;t.$interval=arguments.length?parseInt(n,10):DEFAULT_INTERVAL,t.$timer=null,t.$runmode=NONE,t.$running=!1,t.$queue=[],isThread&&!1!==e&&t.initThread()};if(Asynchronous.VERSION="0.4.5",Asynchronous.Thread=Thread,Asynchronous.Task=Task,Asynchronous.BrowserWindow=BrowserWindow,Asynchronous.MODE={NONE:NONE,INTERLEAVE:INTERLEAVED,LINEAR:LINEARISED,PARALLEL:PARALLELISED,SEQUENCE:SEQUENCED},Asynchronous.Platform={UNDEFINED:UNDEFINED,UNKNOWN:UNKNOWN,NODE:NODE,BROWSER:BROWSER},Asynchronous.supportsMultiThreading=function(){return supportsMultiThread},Asynchronous.isPlatform=function(n){return NODE===n?isNode:BROWSER===n?isBrowser:undef},Asynchronous.isThread=function(n){return NODE===n?isNodeProcess:BROWSER===n?isWebWorker:isThread},Asynchronous.path=path,Asynchronous.blob=blobURL,Asynchronous.load=function(n,e,t){if(n){var r=function(){n=n.split(".");for(var e=root;n.length;)n[0]&&n[0].length&&e[n[0]]&&(e=e[n[0]]),n.shift();return e&&root!==e?is_function(e)?!1!==t?new e:e():e:void 0};return e&&e.length&&(e=e.filter(notThisPath),e.length&&importScripts(e.join(","))),r()}return null},Asynchronous.serialize=function(n){n=n||new Asynchronous;var e=function(e){var t=function(){var t=this,r=arguments;n.step(function(){e.apply(t,r)}),n.$running||n.run(LINEARISED)};return t.free=function(){return e},t};return e.free=function(){n&&n.dispose(),n=null},e},Asynchronous[PROTO]={constructor:Asynchronous,$interval:DEFAULT_INTERVAL,$timer:null,$queue:null,$thread:null,$events:null,$runmode:NONE,$running:!1,dispose:function(){var n=this;return n.unfork(!0),n.$timer&&ClearTime(n.$timer),n.$thread=null,n.$timer=null,n.$interval=null,n.$queue=null,n.$runmode=NONE,n.$running=!1,n},empty:function(){var n=this;return n.$timer&&ClearTime(n.$timer),n.$timer=null,n.$queue=[],n.$runmode=NONE,n.$running=!1,n},interval:function(n){return arguments.length?(this.$interval=parseInt(n,10),this):this.$interval},fork:function(n,e,t){var r,o,s,i=this;if(!i.$thread){if(!supportsMultiThread)throw i.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");isNode?(o="Asynchronous: Thread (Process): ",s="Asynchronous: Thread (Process) Error: "):(o="Asynchronous: Thread (Worker): ",s="Asynchronous: Thread (Worker) Error: "),i.$events=i.$events||{},r=i.$thread=new Thread(tpf),r.onmessage=function(n){if(n.data.event){var e=n.data.event,t=n.data.data||null;i.$events&&i.$events[e]?i.$events[e](t):("console.log"===e||"console.error"===e)&&console.log(o+(t.output||""))}},r.onerror=function(n){if(!i.$events||!i.$events.error)throw new Error(s+n.message+" file: "+n.filename+" line: "+n.lineno);i.$events.error(n)},i.send("initThread",{component:n||null,asInstance:!1!==t,imports:e?[].concat(e):null})}return i},unfork:function(n){var e=this;return e.$thread&&(e.send("dispose"),!0===n&&e.$thread.terminate()),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return isThread&&(n.$events={},onMessage(function(e){var t=e.data.event,r=e.data.data||null;t&&n.$events[t]?n.$events[t](r):"dispose"===t&&(n.dispose(),close())})),n},listen:function(n,e){return n&&is_function(e)&&this.$events&&(this.$events[n]=e),this},unlisten:function(n,e){return n&&this.$events&&this.$events[n]&&(2>arguments.length||e===this.$events[n])&&delete this.$events[n],this},send:function(n,e){return n&&(isThread?postMessage({event:n,data:e||null}):this.$thread&&this.$thread.postMessage({event:n,data:e||null})),this},task:function(n){return is_instance(n,Task)?n:is_function(n)?Task(n):void 0},iif:function(){var n=arguments,e=new Task;return e.iif.apply(e,n)},until:function(){var n=slice(arguments),e=new Task(n.pop());return e.until.apply(e,n)},untilNot:function(){var n=slice(arguments),e=new Task(n.pop());return e.untilNot.apply(e,n)},loop:function(){var n=slice(arguments),e=new Task(n.pop());return e.loop.apply(e,n)},each:function(){var n=slice(arguments),e=new Task(n.pop());return e.each.apply(e,n)},recurse:function(){var n=slice(arguments),e=new Task(n.pop());return e.recurse.apply(e,n)},step:function(n){var e=this;return n&&e.$queue.push(e.task(n).queue(e)),e},steps:function(){var n,e,t=this,r=arguments;for(e=r.length,n=0;e>n;n++)t.step(r[n]);return t},jumpNext:function(n,e){var t=this,r=t.$queue;return e=e||0,!1!==n?function(){return e<r.length&&(e>0&&r.splice(0,e),t.run(t.$runmode)),t}:(e<r.length&&(e>0&&r.splice(0,e),t.run(t.$runmode)),t)},jumpNextWithArgs:function(n,e,t){var r=this,o=r.$queue;return e=e||0,!1!==n?function(){return e<o.length&&(e>0&&o.splice(0,e),r.run(r.$runmode,arguments)),r}:(e<o.length&&(e>0&&o.splice(0,e),r.run(r.$runmode,t)),r)},abort:function(n,e){var t=this;return!1!==n?function(){return e&&e>0?SetTime(function(){t.empty()},e):t.empty(),t}:(e&&e>0?SetTime(function(){t.empty()},e):t.empty(),t)},run:function(n,e){var t=this;return arguments.length?t.$runmode=n:n=t.$runmode,e=e||null,SEQUENCED===n?runSequenced(t,e):INTERLEAVED===n?runInterleaved(t,e):LINEARISED===n?runLinearised(t,e):PARALLELISED===n&&runParallelised(t,e),t}},isThread){var Component=null;root.console={log:function(n){postMessage({event:"console.log",data:{output:n||""}})},error:function(n){postMessage({event:"console.error",data:{output:n||""}})}},onMessage(function(n){var e=n.data.event,t=n.data.data||null;switch(e){case"initThread":t&&t.component&&(Component&&(is_function(Component.dispose)&&Component.dispose(),Component=null),Component=Asynchronous.load(t.component,t.imports,t.asInstance));break;case"dispose":default:Component&&(is_function(Component.dispose)&&Component.dispose(),Component=null),close()}})}}(this,exports),exports.Asynchronous});
/**
*
*   FILTER.js
*   @version: 0.7.1
*   @built on 2015-06-21 18:57:40
*   @dependencies: Classy.js, Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n,r){"use strict";function a(e,t,n,r,a){var i;return e?{file:__filename,path:__dirname}:t?{file:i=self.location.href,path:i.split("/").slice(0,-1).join("/")}:n&&a&&a.uri?{file:i=a.uri,path:i.split("/").slice(0,-1).join("/")}:r&&(i=document.getElementsByTagName("script"))&&i.length?{file:i=i[i.length-1].src,path:i.split("/").slice(0,-1).join("/")}:{file:null,path:null}}function i(e,t,n,r,a){var i,s=e.length,o=new Array(s);for(i=0;s>i;i++)o[i]=1===r?n[e[i]]||a(t[i]):2===r?a(e[i]):n[e[i]];return o}function s(e,t,n,r,a,i){var s,o,l,u,c,h,f,m=n.length;if(i){for(s=0;m>s;s++)n[s]in e||importScripts(t+r[s]);return a()}h=document.getElementsByTagName("head")[0],f=document.createElement("a"),o=/^\./,l=0,s=0,u=function(e,n){var r=0,a=document.createElement("script");a.type="text/javascript",a.language="javascript",a.onload=a.onreadystatechange=function(){r||a.readyState&&"loaded"!=a.readyState&&"complete"!=a.readyState||(r=1,a.onload=a.onreadystatechange=null,n(),h.removeChild(a),a=null)},o.test(e)&&(f.href=t+e,e=f.protocol+"//"+f.host+f.pathname+f.search+f.hash),a.src=e,h.appendChild(a)},c=function(){n[s]in e?++s>=m?a():n[s]in e?c():u(r[s],c):++l<30?setTimeout(c,30):(l=0,s++,c())};for(;m>s&&n[s]in e;)s++;m>s?u(r[s],c):a()}n=n||[[],[]];var o,l,u,c="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),h=!c&&"undefined"!=typeof navigator,f=!c&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,m="function"==typeof define&&define.amd,d=c&&"object"==typeof module&&module.exports,p=f?self:e,_=a(c,f,m,h),g=[].concat(n[0]),v=[].concat(n[1]),y=g.length,w=/\.js$/i;if(d)module.$deps=module.$deps||{},module.exports=module.$deps[t]=r.apply(e,[{NODE:module}].concat(i(g,v,module.$deps,1,require)))||1;else if(m&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)){if(!require.defined(t)){for(u={},l=0;y>l;l++)require.specified(g[l])||(u[g[l]]=v[l].replace(w,""));require.config({paths:u}),define(t,["require","exports","module"].concat(g),function(t,n,a){return r.apply(e,[{AMD:a}].concat(i(g,v,arguments,2,t)))})}}else t in p||s(p,_.path+"/",g,v,function(){p[t]=o=r.apply(e,[{}].concat(i(g,v,p)))||1,m&&define(t,["require"],function(){return o})},f)}(this,"FILTER",[["Classy","Asynchronous"],["./classy.js","./asynchronous.js"]],function(exports,Classy,Asynchronous){var FILTER=exports.FILTER=Classy.Merge({Classy:Classy,Asynchronous:Asynchronous,Path:Asynchronous.path(exports.AMD)},Classy);return FILTER.VERSION="0.7.1",!function(e,t){"use strict";var n,r="prototype",a=(Object[r],Function[r],Array[r]),i=t.Path,s=t.Merge,o=t.Asynchronous,l=o.isPlatform(o.Platform.NODE),u=o.isPlatform(o.Platform.BROWSER),c=o.supportsMultiThreading(),h=o.isThread(),f=navigator?navigator.userAgent:"",m=function(){return"[FILTER Plugin: "+this.name+"]"},d=function(e){return e},p=function(){},_=function(e){return function(){this.$super("constructor"),e.apply(this,arguments)}},g=t.devicePixelRatio=e.devicePixelRatio||1,v=t._notSupportClamp="undefined"==typeof Uint8ClampedArray,y=("undefined"==typeof Int16Array||!Int16Array[r].set,function(e,t){var n=e.length;for(t=t||0;--n>=0;)this[n+t]=e[n]}),w=a.slice,A=0,C=t.Browser={isNode:l,isBrowser:u,isWorker:h,supportsWorker:c,isPhantom:/PhantomJS/.test(f),isOpera:u&&/Opera|OPR\//.test(f),isFirefox:u&&/Firefox\//.test(f),isChrome:u&&/Chrome\//.test(f),isSafari:u&&/Apple Computer/.test(navigator.vendor),isKhtml:u&&/KHTML\//.test(f),isIE:u&&(/MSIE \d/.test(f)||/Trident\/\d/.test(f)),isGecko:u&&/gecko\/\d/i.test(f),isWebkit:u&&/WebKit\//.test(f),isMac_geLion:u&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(f),isMac_geMountainLion:u&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(f),isMobile:!1,isIOS:/AppleWebKit/.test(f)&&/Mobile\/\w+/.test(f),isWin:/windows/i.test(navigator.platform),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};C.isMobile=C.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(f),C.isMac=C.isIOS||/Mac/.test(navigator.platform),C.isIE_lt8=C.isIE&&!h&&(null==document.documentMode||document.documentMode<8),C.isIE_lt9=C.isIE&&!h&&(null==document.documentMode||document.documentMode<9),C.isQtWebkit=C.isWebkit&&/Qt\/\d+\.\d+/.test(f),t.getPath=o.path,t.getCanvas=t.createCanvas=function(e,t){var n=document.createElement("canvas");return e=e||0,t=t||0,n.style.width=e+"px",n.style.height=t+"px",n.width=e*g,n.height=t*g,n},t.uuid=function(e){return[e||"filter",(new Date).getTime(),++A].join("_")},t.Array=Array,t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.Array32F[r].set||(t.Array32F[r].set=y,t.Array64F[r].set=y,t.Array8I[r].set=y,t.Array16I[r].set=y,t.Array32I[r].set=y,t.Array8U[r].set=y,t.Array16U[r].set=y,t.Array32U[r].set=y),t.Array32F[r].subarray||(t.Array32F[r].subarray=w,t.Array64F[r].subarray=w,t.Array8I[r].subarray=w,t.Array16I[r].subarray=w,t.Array32I[r].subarray=w,t.Array8U[r].subarray=w,t.Array16U[r].subarray=w,t.Array32U[r].subarray=w),t.ImArray=v?t.Array8U:Uint8ClampedArray,t.ImArrayCopy=C.isOpera?t.Array8U:t.ImArray,v&&"undefined"!=typeof CanvasPixelArray&&!CanvasPixelArray[r].set&&(CanvasPixelArray[r].set=y),v=t._notSupportClamp=v||C.isOpera,t.NotImplemented=function(e){return e=e||"",function(){throw new Error("Method "+e+" not Implemented!")}},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(){},t.useWebGLSharedResourcesIfAvailable=function(){},t.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},t.LUMA=new t.Array32F([.212671,.71516,.072169]),t.FORMAT={IMAGE:1,DATA:4,PNG:8,JPG:16,GIF:32,TGA:64,RGBE:128},t.MIME={PNG:"image/png",JPG:"image/jpeg",GIF:"image/gif"},t.FORMAT.JPEG=t.FORMAT.JPG,t.MIME.JPEG=t.MIME.JPG,t.Utils={},t.Codec={},t.Interpolation={},t.Transform={},t.ML={},n=t.log=console&&console.log?function(e){console.log(e)}:function(){},t.warning=function(e){n("WARNING: "+e)},t.error=function(e,t){if(n("ERROR: "+e),t)throw new Error(e)};var b=t.FilterThread=t.Class(o,{path:t.getPath(exports.AMD),name:null,constructor:function(){var e=this,t=null;h&&e.initThread().listen("load",function(e){e&&e.filter&&(t&&(t.dispose(!0),t=null),t=o.load("FILTER."+e.filter))}).listen("import",function(e){e&&e["import"]&&e["import"].length&&importScripts(e["import"])}).listen("params",function(e){t&&t.unserialize(e)}).listen("apply",function(n){if(t&&n&&n.im){n.params&&t.unserialize(n.params);var r={im:t._apply(n.im[0],n.im[1],n.im[2])};t.hasMeta&&(r.meta=t.getMeta()),e.send("apply",r)}else e.send("apply",{im:null})}).listen("dispose",function(){t&&(t.dispose(!0),t=null),e.dispose(!0),close()})},thread:function(e){var t=this;return arguments.length||(e=!0),e=!!e,e&&!t.$thread?(t.fork("FILTER.FilterThread",i.file!==t.path.file?[i.file,t.path.file]:t.path.file),t.send("load",{filter:t.name})):!e&&t.$thread&&t.unfork(),t},sources:function(){var e=a.slice.call(arguments);if(e.length){var t,n=[];for(t=0;t<e.length;t++)n.push("function"==typeof e[t]?o.blob(e[t].toString()):o.blob(e[t]));this.send("import",{"import":n.join(",")})}return this},scripts:function(){var e=a.slice.call(arguments);return e.length&&this.send("import",{"import":e.join(",")}),this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{}}},unserialize:function(e){var t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn),t}}),M=t.Filter=t.Class(b,{name:"Filter",constructor:function(){},id:null,_isOn:!0,_update:!0,_onComplete:null,hasMeta:!1,dispose:function(){var e=this;return e.$super("dispose"),e.name=null,e.id=null,e._isOn=null,e._update=null,e._onComplete=null,e.hasMeta=null,e},worker:b[r].thread,complete:function(e){return this._onComplete=e||null,this},isOn:function(){return this._isOn},update:function(e){return arguments.length||(e=!0),this._update=!!e,this},turnOn:function(e){return arguments.length||(e=!0),this._isOn=!!e,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this},canRun:function(){return this._isOn},getMeta:function(){},setMeta:function(){return this},combineWith:function(){return this},_apply:function(e){return e},apply:function(e,t,n){var r,a,i=this;return i.canRun()?(arguments.length<3&&(t&&t.setSelectedData?n=null:"function"==typeof t?(n=t,t=e):(t=e,n=null)),e&&t&&(n=n||i._onComplete,r=e.getSelectedData(),i.$thread?i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&(e.meta&&i.setMeta(e.meta),i._update&&t.setSelectedData(e.im)),n&&n.call(i)}).send("apply",{im:r,params:i.serialize()}):(a=i._apply(r[0],r[1],r[2],e),i._update&&t.setSelectedData(a),n&&n.call(i))),e):e},toString:function(){return"[FILTER: "+this.name+"]"}});t.Create=function(e){e=s({init:p,name:"PluginFilter",toString:m,apply:d},e),e.constructor=_(e.init),e._apply=e.apply,delete e.init,delete e.apply;var n=e.name;return t[n]=t.Class(M,e)}}(this,FILTER),!function(e){"use strict";function t(e,t,n){return e>n?n:t>e?t:e}function n(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var r=(e.ImArray,e.Array32F),a=(e.Array64F,Math.PI),i=a+a,s=.5*a;Math.log2=Math.log2||function(e){return Math.log(e)/Math.LN2},e.CONSTANTS={PI:a,PI2:i,PI_2:s,SQRT2:Math.SQRT2,toRad:a/180,toDeg:180/a},e.Math={clamp:t,closestPower2:n,integral:function(e,t,n,a){var i,s,o,l,u,c,h,f,m,d,p=t<<2,_=e.length,g=_>>2;for(a=!0===a,d=!a,i=new r(g),d&&(s=new r(g),o=new r(g)),f=0,h=0,l=u=c=0,m=0;t>m;m++,h+=4,f++)l+=e[h],i[f]=l,d&&(u+=e[h+1],c+=e[h+2],s[f]=u,o[f]=c);for(h=p,m=0,f=0,l=u=c=0,h=p;_>h;h+=4,f++,m++)m>=t&&(m=0,l=u=c=0),l+=e[h],i[f+t]=i[f]+l,d&&(u+=e[h+1],c+=e[h+2],s[f+t]=s[f]+u,o[f+t]=o[f]+c);return d?[i,s,o]:[i,i,i]},histogram:function(e,t,n,a){var i,s,o,l,u,c,h,f,m,d,p,_=e.length,g=0,v=0,y=0,w=255,A=255,C=255,b=1/(_>>2);for(a=!0===a,p=!a,i=new r(256),p&&(s=new r(256),o=new r(256)),d=0;256>d;d+=4)i[d]=0,i[d+1]=0,i[d+2]=0,i[d+3]=0,p&&(s[d]=0,o[d]=0,s[d+1]=0,o[d+1]=0,s[d+2]=0,o[d+2]=0,s[d+3]=0,o[d+3]=0);for(d=0;_>d;d+=4)l=e[d],i[l]+=b,l>g?g=l:w>l&&(w=l),p&&(u=e[d+1],c=e[d+2],s[u]+=b,o[c]+=b,u>v?v=u:A>u&&(A=u),c>y?y=c:C>c&&(C=c));for(h=f=m=0,d=0;256>d;d+=4)h+=i[d],i[d]=h,h+=i[d+1],i[d+1]=h,h+=i[d+2],i[d+2]=h,h+=i[d+3],i[d+3]=h,p&&(f+=s[d],s[d]=f,m+=o[d],o[d]=m,f+=s[d+1],s[d+1]=f,m+=o[d+1],o[d+1]=m,f+=s[d+2],s[d+2]=f,m+=o[d+2],o[d+2]=m,f+=s[d+3],s[d+3]=f,m+=o[d+3],o[d+3]=m);return p?[i,s,o]:[i,i,i]},spectrum:function(){return null}}}(FILTER),!function(e){"use strict";var t=e.ImArray,n=Math.min;e.Interpolation.crop=function(e,r,a,i,s,o,l){o=n(o,r-1),l=n(l,a-1);var u,c,h,f,m=o-i+1,d=l-s+1,p=m*d<<2,_=new t(p),g=m<<2;for(u=s,c=s*r,h=0;l>=u;u++,c+=r,h+=g)f=c+i<<2,_.set(e.subarray(f,f+g),h);return _},e.Interpolation.pad=function(e,n,r,a,i,s,o){a=a||0,i=i||0,s=s||0,o=o||0;var l,u,c,h,f=n+s+a,m=r+o+i,d=f*m<<2,p=new t(d),_=n<<2,g=f<<2,v=o*g,y=s<<2;for(l=0,u=0,c=v;r>l;l++,u+=n,c+=g)h=u<<2,p.set(e.subarray(h,h+_),y+c);return p}}(FILTER),!function(e){"use strict";var t=e.Math.clamp,n=e.ImArray;e.Interpolation.bilinear=function(e,r,a,i,s){var o,l,u,c,h,f,m,d,p,_,g,v,y,w,A,C,b,M,I,R=i*s<<2,E=new n(R),L=(r-1)/i,x=(a-1)/s,N=r<<2;for(p=0,_=0,g=0,v=0,w=0,b=0,I=0,C=0;R>C;C+=4,_++,g+=L)_>=i&&(_=0,g=0,p++,v+=x,w=~~v,I=v-w,b=w*r),y=~~g,M=g-y,h=(1-M)*(1-I),f=M*(1-I),m=I*(1-M),d=M*I,A=b+y<<2,o=e[A],l=e[A+4],u=e[A+N],c=e[A+N+4],E[C]=t(~~(o*h+l*f+u*m+c*d+.5),0,255),o=e[A+1],l=e[A+5],u=e[A+N+1],c=e[A+N+5],E[C+1]=t(~~(o*h+l*f+u*m+c*d+.5),0,255),o=e[A+2],l=e[A+6],u=e[A+N+2],c=e[A+N+6],E[C+2]=t(~~(o*h+l*f+u*m+c*d+.5),0,255),o=e[A+3],l=e[A+7],u=e[A+N+3],c=e[A+N+7],E[C+3]=t(~~(o*h+l*f+u*m+c*d+.5),0,255);return E}}(FILTER),!function(e){"use strict";var t=Math.sqrt,n=Math.round,r=(Math.floor,Math.min),a=Math.max,i=(Math.abs,e.Math.clamp),s=function(e){return e.replace(/([.*+?^${}()|\[\]\/\\\-])/g,"\\$1")},o=function(e){return e.replace(/^\s+/gm,"").replace(/\s+$/gm,"")},l=1/255,u=100/255,c=2.55,h={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},f=e.Color=e.Class({__static__:{clamp:i,clampPixel:function(e){return r(255,a(e,0))},toGray:function(t,n,r){var a=e.LUMA;return~~(a[0]*t+a[1]*n+a[2]*r)},distance:function(e,n){var r=e[0]-n[0],a=e[1]-n[1],i=e[2]-n[2];return t(r*r+a*a+i*i)},RGB2Color:function(e){return e[0]<<16|e[1]<<8|255&e[2]},RGBA2Color:function(e){return e[3]<<24|e[0]<<16|e[1]<<8|255&e[2]},Color2RGBA:function(e){return e=~~e,[e>>>16&255,e>>>8&255,255&e,e>>>24&255]},RGB2YCbCr:function(e){var t,n,r,a=e[0],i=e[1],s=e[2];return t=~~(0+.299*a+.587*i+.114*s),n=~~(128-.168736*a-.331264*i+.5*s),r=~~(128+.5*a-.418688*i-.081312*s),[t,n,r]},YCbCr2RGB:function(e){var t,n,r,a=e[0],i=e[1],s=e[2];return t=~~(a+1.402*(s-128)),n=~~(a-.34414*(i-128)-.71414*(s-128)),r=~~(a+1.772*(i-128)),[t,n,r]},RGB2HSV:function(e){var t,n,i,s,o,l,u,c,h;return s=e[0],o=e[1],l=e[2],t=r(s,o,l),n=a(s,o,l),i=n-t,h=n,0==n?(c=0,u=0,[u,c,h]):(c=i/n,u=s==n?(o-l)/i:o==n?2+(l-s)/i:4+(s-o)/i,u*=60,0>u&&(u+=360),[u,c,h])},HSV2RGB:function(e){var t,n,r,a,i,s,o,l,u,c,h;if(u=e[0],c=e[1],h=e[2],0==c)return s=o=l=h,[s,o,l];switch(u/=60,t=~~u,n=u-t,r=h*(1-c),a=h*(1-c*n),i=h*(1-c*(1-n)),t){case 0:s=h,o=i,l=r;break;case 1:s=a,o=h,l=r;break;case 2:s=r,o=h,l=i;break;case 3:s=r,o=a,l=h;break;case 4:s=i,o=r,l=h;break;default:s=h,o=r,l=a}return[s,o,l]},toString:function(){return"[FILTER: "+this.name+"]"},C2F:l,C2P:u,P2C:c,Keywords:h,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(h).map(s).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(e,t){return e*u+(t||"")},per2col:function(e){return e*c},rgb2cmyk:function(e,t,a,s){var o,u,h=0,f=0,m=0,d=0;return s&&(e=i(n(e*c),0,255),t=i(n(t*c),0,255),a=i(n(a*c),0,255)),0==e&&0==t&&0==a?(d=1,[0,0,0,1]):(h=1-e*l,f=1-t*l,m=1-a*l,o=r(h,f,m),u=1/(1-o),h=(h-o)*u,f=(f-o)*u,m=(m-o)*u,d=o,[h,f,m,d])},cmyk2rgb:function(e,t,r,a){var s,o,l=0,u=0,c=0;return 0==e&&0==t&&0==r?[0,0,0]:(s=a,o=1-s,e=e*o+s,t=t*o+s,r=r*o+s,l=255*(1-e),u=255*(1-t),c=255*(1-r),[i(n(l),0,255),i(n(u),0,255),i(n(c),0,255)])},rgb2hex:function(e,t,r,a,s){var o;return s&&(e=i(n(e*c),0,255),t=i(n(t*c),0,255),r=i(n(r*c),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),o=a&&e[0]==e[1]&&t[0]==t[1]&&r[0]==r[1]?"#"+e[0]+t[0]+r[0]:"#"+e+t+r},rgb2hexIE:function(e,t,r,a,s){var o;return s&&(e=i(n(e*c),0,255),t=i(n(t*c),0,255),r=i(n(r*c),0,255),a=i(n(a*c),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),a=16>a?"0"+a.toString(16):a.toString(16),o="#"+a+e+t+r},hex2rgb:function(e){return!e||3>e.length?[0,0,0]:6>e.length?[i(parseInt(e[0]+e[0],16),0,255),i(parseInt(e[1]+e[1],16),0,255),i(parseInt(e[2]+e[2],16),0,255)]:[i(parseInt(e[0]+e[1],16),0,255),i(parseInt(e[2]+e[3],16),0,255),i(parseInt(e[4]+e[5],16),0,255)]},hue2rgb:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},hsl2rgb:function(e,t,r){var a,s,o,l,u;return e=(e+360)%360/360,t*=.01,r*=.01,0==t?(a=1,s=1,o=1):(u=.5>r?r*(1+t):r+t-r*t,l=2*r-u,a=f.hue2rgb(l,u,e+1/3),s=f.hue2rgb(l,u,e),o=f.hue2rgb(l,u,e-1/3)),[i(n(255*a),0,255),i(n(255*s),0,255),i(n(255*o),0,255)]},rgb2hsl:function(e,t,s,o){var u,c,h,f,m,d;return o?(e*=.01,t*=.01,s*=.01):(e*=l,t*=l,s*=l),c=a(e,t,s),u=r(e,t,s),m=.5*(c+u),c==u?h=f=0:(d=c-u,f=m>.5?d/(2-a-r):d/(a+r),h=c==e?(t-s)/d+(s>t?6:0):c==t?(s-e)/d+2:(e-t)/d+4,h/=6),[n(360*h)%360,i(100*f,0,100),i(100*m,0,100)]},parse:function(e,t,n,r){var a,i,s,l,c,h=0,m=0;if("hsl"==n||!n&&(a=e.match(f.hslRE))){if("hsl"==n){c="hsla"==e[0].toLowerCase();var d=e[1].split(",").map(o)}else{h=a[0].length,m=0,c="hsla"==a[1].toLowerCase();var d=a[2].split(",").map(o)}var p=d[0]?d[0]:"0",e=d[1]?d[1]:"0",_=d[2]?d[2]:"0",g=c&&null!=d[3]?d[3]:"1";return p=parseFloat(p,10),e="%"==e.slice(-1)?parseFloat(e,10):parseFloat(e,10)*u,_="%"==_.slice(-1)?parseFloat(_,10):parseFloat(_,10)*u,g=parseFloat(g,10),l=(new f).fromHSL([p,e,_,g]),t&&(s=e.substr(h),(i=s.match(f.colorstopRE))&&(l.colorStop(i[1]),m=i[0].length)),r?l:[l,0,h+m]}if("rgb"==n||!n&&(a=e.match(f.rgbRE))){if("rgb"==n){c="rgba"==e[0].toLowerCase();var d=e[1].split(",").map(o)}else{h=a[0].length,m=0,c="rgba"==a[1].toLowerCase();var d=a[2].split(",").map(o)}var v=d[0]?d[0]:"0",y=d[1]?d[1]:"0",w=d[2]?d[2]:"0",g=c&&null!=d[3]?d[3]:"1";return v="%"==v.slice(-1)?2.55*parseFloat(v,10):parseFloat(v,10),y="%"==y.slice(-1)?2.55*parseFloat(y,10):parseFloat(y,10),w="%"==w.slice(-1)?2.55*parseFloat(w,10):parseFloat(w,10),g=parseFloat(g,10),l=(new f).fromRGB([v,y,w,g]),t&&(s=e.substr(h),(i=s.match(f.colorstopRE))&&(l.colorStop(i[1]),m=i[0].length)),r?l:[l,0,h+m]}if("hex"==n||!n&&(a=e.match(f.hexRE))){if("hex"==n)var d=f.hex2rgb(e[0]);else{h=a[0].length,m=0;var d=f.hex2rgb(a[1])}var A=d[0]?d[0]:0,C=d[1]?d[1]:0,b=d[2]?d[2]:0,g=null!=d[3]?d[3]:255;return l=(new f).fromHEX([A,C,b,g]),t&&(s=e.substr(h),(i=s.match(f.colorstopRE))&&(l.colorStop(i[1]),m=i[0].length)),r?l:[l,0,h+m]}if("keyword"==n||!n&&(a=e.match(f.keywordRE))){if("keyword"==n)var d=e[0];else{h=a[0].length,m=0;var d=a[1]}return l=(new f).fromKeyword(d),t&&(s=e.substr(h),(i=s.match(f.colorstopRE))&&(l.colorStop(i[1]),m=i[0].length)),r?l:[l,0,h+m]}return null},fromString:function(e,t,n){return f.parse(e,t,n,1)},fromRGB:function(e){return(new f).fromRGB(e)},fromHSL:function(e){return(new f).fromHSL(e)},fromCMYK:function(e){return(new f).fromCMYK(e)},fromHEX:function(e){return(new f).fromHEX(e)},fromKeyword:function(e){return(new f).fromKeyword(e)},fromPixel:function(e){return(new f).fromPixel(e)}},constructor:function(e,t){return this instanceof f?(this.reset(),void(e&&this.set(e,t))):new f(e,t)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var e=new f;return e.col=this.col.slice(),e.cstop=this.cstop+"",e.kword=this.kword,e},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(e,t){return e&&(undef!==e[0]&&(this.col[0]=i(e[0],0,255)),undef!==e[1]&&(this.col[1]=i(e[1],0,255)),undef!==e[2]&&(this.col[2]=i(e[2],0,255)),this.col[3]=undef!==e[3]?i(e[3],0,1):1,t&&(this.cstop=t),this.kword=null),this},colorStop:function(e){return this.cstop=e,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return this.kword?!0:!1},fromPixel:function(e){return e=e||0,this.col=[i(e>>16&255,0,255),i(e>>8&255,0,255),i(255&e,0,255),i((e>>24&255)*l,0,1)],this.kword=null,this},fromKeyword:function(e){return e=e.toLowerCase(),f.Keywords[e]&&(this.col=f.Keywords[e].slice(),this.kword=e),this},fromHEX:function(e){return this.col[0]=e[0]?i(parseInt(e[0],10),0,255):0,this.col[1]=e[1]?i(parseInt(e[1],10),0,255):0,this.col[2]=e[2]?i(parseInt(e[2],10),0,255):0,this.col[3]=undef!==e[3]?i(parseInt(e[3],10)*l,0,1):1,this.kword=null,this},fromRGB:function(e){return this.col[0]=e[0]?i(n(e[0]),0,255):0,this.col[1]=e[1]?i(n(e[1]),0,255):0,this.col[2]=e[2]?i(n(e[2]),0,255):0,this.col[3]=undef!==e[3]?i(e[3],0,1):1,this.kword=null,this},fromCMYK:function(e){var t=f.cmyk2rgb(e[0]||0,e[1]||0,e[2]||0,e[3]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[4]?i(e[4],0,1):1,this.kword=null,this},fromHSL:function(e){var t=f.hsl2rgb(e[0]||0,e[1]||0,e[2]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[3]?i(e[3],0,1):1,this.kword=null,this},toPixel:function(e){return e?i(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(e,t,n){var r=f.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(e,t,n){return this.kword?this.kword:this.toHEX(1,t,n)},toHEX:function(e,t,r){return r?f.rgb2hexIE(this.col[0],this.col[1],this.col[2],i(n(255*this.col[3]),0,255)):f.rgb2hex(this.col[0],this.col[1],this.col[2],t)},toRGB:function(e,t,n){var r=this.col[3];return e?(t&&(r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(e,t,n){var r=this.col[3],a=f.rgb2hsl(this.col[0],this.col[1],this.col[2]);return e?(t&&(a[1]=0==a[1]?a[1]:a[1]+"%",a[2]=0==a[2]?a[2]:a[2]+"%",r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[a[0],a[1],a[2]].join(",")+")":"hsla("+[a[0],a[1],a[2],r].join(",")+")"):n?a:a.concat(this.col[3])},toColorStop:function(e){var t=this.cstop;return e?(t=t.length?t+",":"",1>this.col[3]?"color-stop("+t+this.toRGB(1,1)+")":"color-stop("+t+this.toHEX(1,1)+")"):(t=t.length?" "+t:"",1>this.col[3]?this.toRGB(1,1)+t:this.toHEX(1,1)+t)},toString:function(e,t){return e=e?e.toLowerCase():"hex","rgb"==e||"rgba"==e?this.toRGB(1,!1!==t,"rgb"==e):"hsl"==e||"hsla"==e?this.toHSL(1,!1!==t,"hsl"==e):"keyword"==e?this.toKeyword(1):this.toHEX(1,!1!==t,"hexie"==e)}})}(FILTER),!function(e,t){"use strict";function n(e){var t=e.width,n=e.height,r=c(t,n);return r.width=t*o,r.height=n*o,r}function r(e,t,n,r){return r=r||b,r&A&&(e.width=t,e.oCanvas.style.width=t+"px",e.oCanvas.width=t*o,e._restorable&&(e.iCanvas.style.width=e.oCanvas.style.width,e.iCanvas.width=e.oCanvas.width),e.tmpCanvas&&(e.tmpCanvas.style.width=e.oCanvas.style.width,e.tmpCanvas.width=e.oCanvas.width)),r&C&&(e.height=n,e.oCanvas.style.height=n+"px",e.oCanvas.height=n*o,e._restorable&&(e.iCanvas.style.height=e.oCanvas.style.height,e.iCanvas.height=e.oCanvas.height),e.tmpCanvas&&(e.tmpCanvas.style.height=e.oCanvas.style.height,e.tmpCanvas.height=e.oCanvas.height)),e}function a(e,t){var n=e.width,r=e.height;return t=t||255,e._restorable&&t&d&&e._needsRefresh&d&&(e.iData=e.ictx.getImageData(0,0,n,r),e._needsRefresh&=~d),t&p&&e._needsRefresh&p&&(e.oData=e.octx.getImageData(0,0,n,r),e._needsRefresh&=~p),e}function i(e,t){if(e.selection){var n=e.selection,r=e.width-1,a=e.height-1,i=h(n[0]*r),s=h(n[1]*a),o=h(n[2]*r)-i+1,l=h(n[3]*a)-s+1;t=t||255,e._restorable&&t&_&&e._needsRefresh&_&&(e.iDataSel=e.ictx.getImageData(i,s,o,l),e._needsRefresh&=~_),t&g&&e._needsRefresh&g&&(e.oDataSel=e.octx.getImageData(i,s,o,l),e._needsRefresh&=~g)}return e}var s="prototype",o=e.devicePixelRatio,l=e.ImArray,u=e.ImArrayCopy,c=(e.Array32F,e.createCanvas),h=(e._notSupportTypedArrays,Math.min,Math.floor),f=e.FORMAT,m=e.MIME,d=1,p=2,_=4,g=8,v=16,y=32,w=64,A=2,C=4,b=A|C,M=_|g,I=d|p,R=~M,E=~v,L=~y,x=e.Image=e.Class({name:"Image",constructor:function O(e){var t=this,n=0,r=0;return t instanceof O?(t.width=n,t.height=r,t.iData=null,t.iDataSel=null,t.oData=null,t.oDataSel=null,t.iCanvas=c(n,r),t.oCanvas=c(n,r),t.tmpCanvas=null,t.domElement=t.oCanvas,t.ictx=t.iCanvas.getContext("2d"),t.octx=t.oCanvas.getContext("2d"),t.webgl=null,t._histogram=null,t._integral=null,t._spectrum=null,t.selection=null,t._needsRefresh=0,t._restorable=!0,t._grayscale=!1,void(e&&t.image(e))):new O(e)},width:0,height:0,selection:null,iCanvas:null,oCanvas:null,tmpCanvas:null,ictx:null,octx:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,webgl:null,_histogram:null,_integral:null,_spectrum:null,_needsRefresh:0,_restorable:!0,_grayscale:!1,dispose:function(){var e=this;return e.width=null,e.height=null,e.selection=null,e.ictx=null,e.octx=null,e.iData=null,e.iDataSel=null,e.oData=null,e.oDataSel=null,e.iCanvas=null,e.oCanvas=null,e.tmpCanvas=null,e.domElement=null,e.webgl=null,e._histogram=null,e._integral=null,e._spectrum=null,e._needsRefresh=null,e._restorable=null,e._grayscale=null,e},clone:function(e){return new x(!0===e?this.iCanvas:this.oCanvas)},grayscale:function(e){var t=this;return arguments.length?(t._grayscale=!!e,t):t._grayscale},restorable:function(e){var t=this;return arguments.length||(e=!0),t._restorable=!!e,t},apply:function(e,t){return e.apply(this,this,t||null),this},apply2:function(e,t,n){return e.apply(this,t,n||null),this},select:function(e,t,n,r){var a=this,i=arguments.length;return 1>i&&(e=0),2>i&&(t=0),3>i&&(n=1),4>i&&(r=1),a.selection=[0>e?0:e>1?1:e,0>t?0:t>1?1:t,0>n?0:n>1?1:n,0>r?0:r>1?1:r],a._needsRefresh|=M,a},deselect:function(){var e=this;return e.selection=null,e.iDataSel=null,e.oDataSel=null,e._needsRefresh&=R,e},store:function(){var e=this;return e._restorable&&(e.ictx.drawImage(e.oCanvas,0,0),e._needsRefresh|=d,e.selection&&(e._needsRefresh|=_)),e},restore:function(){var e=this;return e._restorable&&(e.octx.drawImage(e.iCanvas,0,0),e._needsRefresh|=p|v|y|w,e.selection&&(e._needsRefresh|=g)),e},dimensions:function(e,t){var n=this;return r(n,e,t,b),n._needsRefresh|=I|v|y|w,n.selection&&(n._needsRefresh|=M),n},scale:function(e,t){var r=this;if(e=e||1,t=t||e,1==e&&1==t)return r;r.tmpCanvas=r.tmpCanvas||n(r);var a=r.tmpCanvas.getContext("2d"),i=r.width,s=r.height;return a.scale(e,t),i=r.width=~~(e*i+.5),s=r.height=~~(t*s+.5),a.drawImage(r.oCanvas,0,0),r.oCanvas.style.width=i+"px",r.oCanvas.style.height=s+"px",r.oCanvas.width=i*o,r.oCanvas.height=s*o,r.octx.drawImage(r.tmpCanvas,0,0),r._restorable&&(a.drawImage(r.iCanvas,0,0),r.iCanvas.style.width=r.oCanvas.style.width,r.iCanvas.style.height=r.oCanvas.style.height,r.iCanvas.width=r.oCanvas.width,r.iCanvas.height=r.oCanvas.height,r.ictx.drawImage(r.tmpCanvas,0,0)),r.tmpCanvas.width=r.oCanvas.width,r.tmpCanvas.height=r.oCanvas.height,r._needsRefresh|=I|v|y|w,r.selection&&(r._needsRefresh|=M),r},flipHorizontal:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(e.width,0),t.scale(-1,1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=I|v|y|w,e.selection&&(e._needsRefresh|=M),e},flipVertical:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(0,e.height),t.scale(1,-1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=I|v|y|w,e.selection&&(e._needsRefresh|=M),e},draw:function(){return this},clear:function(){var e=this,t=e.width,n=e.height;return t&&n&&(e._restorable&&e.ictx.clearRect(0,0,t,n),e.octx.clearRect(0,0,t,n),e._needsRefresh|=I|v|y|w,e.selection&&(e._needsRefresh|=M)),e},crop:function(e,t,r,a){var i,s,l,u,c,f,m,d,p=this,_=p.selection,g=p.width,A=p.height;if(arguments.length)c=e,f=t,m=r-e+1,d=a-t+1;else{if(!_)return p;i=h(_[0]*(g-1)),s=h(_[1]*(A-1)),l=h(_[2]*(g-1))-i+1,u=h(_[3]*(A-1))-s+1,c=i,f=s,m=l,d=u,_[0]=0,_[1]=0,_[2]=1,_[3]=1}p.tmpCanvas=p.tmpCanvas||n(p);var C=p.tmpCanvas.getContext("2d");return C.drawImage(p.oCanvas,0,0,g,A,c,f,m,d),p.oCanvas.style.width=m+"px",p.oCanvas.style.height=d+"px",p.oCanvas.width=m*o,p.oCanvas.height=d*o,p.octx.drawImage(p.tmpCanvas,0,0),p._restorable&&(C.drawImage(p.iCanvas,0,0,g,A,c,f,m,d),p.iCanvas.style.width=p.oCanvas.style.width,p.iCanvas.style.height=p.oCanvas.style.height,p.iCanvas.width=p.oCanvas.width,p.iCanvas.height=p.oCanvas.height,p.ictx.drawImage(p.tmpCanvas,0,0)),p.tmpCanvas.width=p.oCanvas.width,p.tmpCanvas.height=p.oCanvas.height,p._needsRefresh|=I|v|y|w,_&&(p._needsRefresh|=M),p},fill:function(e,n,r,a,i){var s,o,l,u,c=this,f=c.selection,m=c.width,d=c.height;f?(s=h(f[0]*(m-1)),o=h(f[1]*(d-1)),l=h(f[2]*(m-1))-s+1,u=h(f[3]*(d-1))-o+1):(s=0,o=0,l=m,u=d),t===n&&(n=s),t===r&&(r=o),t===a&&(a=l),t===i&&(i=u),a&&!m&&i&&!d&&c.createImageData(a,i);var p=c.ictx,_=c.octx;return e=e||0,c._restorable&&(p.fillStyle=e,p.fillRect(n,r,a,i)),_.fillStyle=e,_.fillRect(n,r,a,i),c._needsRefresh|=I|v|y|w,f&&(c._needsRefresh|=M),c},getData:function(){var e,t=this;return t._restorable?(t._needsRefresh&d&&a(t,d),e=t.iData):(t._needsRefresh&p&&a(t,p),e=t.oData),new u(e.data)},getSelectedData:function(){var e,t=this;return t.selection?t._restorable?(t._needsRefresh&_&&i(t,_),e=t.iDataSel):(t._needsRefresh&g&&i(t,g),e=t.oDataSel):t._restorable?(t._needsRefresh&d&&a(t,d),e=t.iData):(t._needsRefresh&p&&a(t,p),e=t.oData),[new u(e.data),e.width,e.height]},getProcessedData:function(){var e=this;return e._needsRefresh&p&&a(e,p),new u(e.oData.data)},getProcessedSelectedData:function(){var e,t=this;return t.selection?(t._needsRefresh&g&&i(t,g),e=t.oDataSel):(t._needsRefresh&p&&a(t,p),e=t.oData),[new u(e.data),e.width,e.height]
},setData:function(e){var t=this;return t._needsRefresh&p&&a(t,p),t.oData.data.set(e),t.octx.putImageData(t.oData,0,0),t._needsRefresh|=v|y|w,t.selection&&(t._needsRefresh|=g),t},setSelectedData:function(e){var t=this;if(t.selection){var n=t.selection,r=t.width-1,s=t.height-1,o=h(n[0]*r),l=h(n[1]*s);t._needsRefresh&g&&i(t,g),t.oDataSel.data.set(e),t.octx.putImageData(t.oDataSel,o,l),t._needsRefresh|=p}else t._needsRefresh&p&&a(t,p),t.oData.data.set(e),t.octx.putImageData(t.oData,0,0);return t._needsRefresh|=v|y|w,t},createImageData:function(e,t){var n,a,i=this;return r(i,e,t,b),i._restorable&&(n=i.ictx=i.iCanvas.getContext("2d"),n.createImageData(e,t)),a=i.octx=i.oCanvas.getContext("2d"),a.createImageData(e,t),i._needsRefresh|=I,i.selection&&(i._needsRefresh|=M),i},image:function(e){if(!e)return this;var t,n,i,s,o,l,u,c,h=this;return o=e instanceof x,o&&(e=e.oCanvas),l=e instanceof HTMLVideoElement,u=e instanceof HTMLCanvasElement,c=e instanceof Image,l?(i=e.videoWidth,s=e.videoHeight):(i=e.width,s=e.height),c||u||l?(r(h,i,s,b),h._restorable&&(t=h.ictx=h.iCanvas.getContext("2d"),t.drawImage(e,0,0)),n=h.octx=h.oCanvas.getContext("2d"),n.drawImage(e,0,0),h._needsRefresh|=I):(h.oData||(h.createImageData(i,s),a(h,I)),h._restorable&&(t=h.ictx=h.iCanvas.getContext("2d"),h.iData.data.set(e.data),t.putImageData(h.iData,0,0)),n=h.octx=h.oCanvas.getContext("2d"),h.oData.data.set(e.data),n.putImageData(h.oData,0,0)),h._needsRefresh|=v|y|w,h.selection&&(h._needsRefresh|=M),h},getPixel:function(e,t){var n=this;n._needsRefresh&p&&a(n,p);var r=~~(t*n.width+e+.5)<<2,i=n.oData.data;return{r:i[r],g:i[r+1],b:i[r+2],a:i[r+3]}},setPixel:function(e,t,n,r,a,i){var s=this;return s.octx.putImageData(new l([255&n,255&r,255&a,255&i]),e,t),s._needsRefresh|=p|v|y|w,s.selection&&(s._needsRefresh|=g),s},getPixelData:function(){return this._needsRefresh&p&&a(this,p),this.oData},setPixelData:function(e){var t=this;return t.octx.putImageData(e,0,0),t._needsRefresh|=p|v|y|w,t.selection&&(t._needsRefresh|=g),t},integral:function(){var e=this;return e._needsRefresh&y&&(e._integral=x.integral(e.getPixelData().data,e.width,e.height,e._grayscale),e._needsRefresh&=L),e._integral},histogram:function(){var e=this;return e._needsRefresh&v&&(e._histogram=x.histogram(e.getPixelData().data,e.width,e.height,e._grayscale),e._needsRefresh&=E),e._histogram},spectrum:function(){var e=this;return e._spectrum},toImage:function(e){var t,n=this.oCanvas,r=1;if(t=e&f.JPG?n.toDataURL(m.JPG,r):e&f.GIF?n.toDataURL(m.GIF,r):n.toDataURL(m.PNG,r),e&f.IMAGE){var a=new Image;return a.src=t,a}return t},toString:function(){return"[FILTER Image: "+this.name+"]"}});x[s].setImage=x[s].image,x[s].setDimensions=x[s].dimensions,x.scale=x.resize=e.Interpolation.bilinear,x.crop=e.Interpolation.crop,x.pad=e.Interpolation.pad,x.integral=e.Math.integral,x.histogram=e.Math.histogram,x.spectrum=e.Math.spectrum;var N=e.ScaledImage=e.Class(x,{name:"ScaledImage",constructor:function F(e,t,n){var r=this;return r instanceof F?(r.scaleX=e||1,r.scaleY=t||r.scaleX,void r.$super("constructor",n)):new F(e,t,n)},scaleX:1,scaleY:1,dispose:function(){var e=this;return e.scaleX=null,e.scaleY=null,e.$super("dispose"),e},clone:function(e){var t=this;return new N(t.scaleX,t.scaleY,!0===e?t.iCanvas:t.oCanvas)},setScale:function(e,t){var n=this,r=arguments.length;return r>0&&null!=e&&(n.scaleX=e,n.scaleY=e),r>1&&null!=t&&(n.scaleY=t),n},image:function(e){if(!e)return this;var t,n,a,i,s,o,l,u,c,h,f=this,m=f.scaleX,d=f.scaleY;return l=e instanceof x,l&&(e=e.oCanvas),u=e instanceof HTMLVideoElement,c=e instanceof HTMLCanvasElement,h=e instanceof Image,u?(a=e.videoWidth,i=e.videoHeight):(a=e.width,i=e.height),(h||c||u)&&(s=~~(m*a+.5),o=~~(d*i+.5),r(f,s,o,b),f._restorable&&(t=f.ictx=f.iCanvas.getContext("2d"),t.drawImage(e,0,0,a,i,0,0,s,o)),n=f.octx=f.oCanvas.getContext("2d"),n.drawImage(e,0,0,a,i,0,0,s,o),f._needsRefresh|=I|v|y|w,f.selection&&(f._needsRefresh|=M)),f}});N[s].setImage=N[s].image}(FILTER),!function(e){"use strict";var t=e.Image,n=e.Class,r="addEventListener",a=e.Loader=n({name:"Loader",__static__:{load:e.Method(function(e,t,n){return function(e,t,r){return(new n).load(e,t,r)}},e.LATE|e.STATIC)},constructor:function s(){return this instanceof s?void 0:new s},_crossOrigin:null,_responseType:null,dispose:function(){var e=this;return e._crossOrigin=null,e._responseType=null,e},load:function(){return null},responseType:function(e){return arguments.length?(this._responseType=e,this):this._responseType},crossOrigin:function(e){return arguments.length?(this._crossOrigin=e,this):this._crossOrigin}}),i=e.XHRLoader=n(a,{name:"XHRLoader",constructor:function o(){return this instanceof o?void 0:new o},load:function(e,t,n){var a=this,i=new XMLHttpRequest;return i.open("GET",e,!0),i[r]("load",function(){t&&t(this.response)},!1),"function"==typeof n&&i[r]("error",n,!1),a._crossOrigin&&(i.crossOrigin=a._crossOrigin),a._responseType&&(i.responseType=a._responseType),i.send(null),a}});e.BinaryLoader=n(a,{name:"BinaryLoader",constructor:function l(e){var t=this;return t instanceof l?void(t._decoder="function"==typeof e?e:null):new l(e)},_decoder:null,_encoder:null,dispose:function(){var e=this;return e._decoder=null,e._encoder=null,e.$super("dispose"),e},codec:function(e){var t=this;return t._decoder="function"==typeof e?e:null,t},load:function(e,n,r){var a,s=this,o=new t,l=s._decoder;return"function"==typeof l&&(a=(new i).responseType(s._responseType||"arraybuffer").load(e,function(e){var t={},r=l(e,t);r&&(o.image(r),"function"==typeof n&&n(o,t))},r)),o}})}(FILTER),!function(e){"use strict";var t=e.Image;e.HTMLImageLoader=e.Class(e.Loader,{name:"HTMLImageLoader",constructor:function n(){return this instanceof n?void this.$super("constructor"):new n},load:function(e,n,r){var a,i=this,s=new t;return a=new Image,a.onload=function(){s.setImage(a),"function"==typeof n&&n(s,a)},a.onerror=function(){"function"==typeof r&&r(s,a)},a.crossOrigin=i._crossOrigin?i._crossOrigin:"",a.src=e,s}})}(FILTER),!function(e){"use strict";var t=(Object.prototype,Function.prototype,Array.prototype),n=t.slice,r=t.splice,a=t.concat,i=e.CompositeFilter=e.Class(e.Filter,{name:"CompositeFilter",constructor:function(e){var t=this;t.$super("constructor"),t._stack=e&&e.length?e.slice():[]},_stack:null,_meta:null,_stable:!0,dispose:function(e){var t,n=this,r=n._stack;if(n.$super("dispose"),!0===e)for(t=0;t<r.length;t++)r[t]&&r[t].dispose(e),r[t]=null;return n._stack=null,n._meta=null,n},serialize:function(){var e,t=this,n={filter:t.name,_isOn:!!t._isOn,_stable:!!t._stable,filters:[]},r=t._stack;for(e=0;e<r.length;e++)n.filters.push(r[e].serialize());return n},unserialize:function(t){var n,r,a,i,s,o=this,l=o._stack;if(t&&o.name===t.filter){if(o._isOn=!!t._isOn,o._stable=!!t._stable,i=t.filters||[],r=i.length,a=l.length,r===a&&o._stable)for(n=0;r>n;n++)l[n]=l[n].unserialize(i[n]);else{for(n=0;a>n;n++)l[n]&&l[n].dispose(!0),l[n]=null;for(l=[],n=0;r>n;n++){if(s=i[n]&&i[n].filter?e[i[n].filter]:null,!s)throw new Error('Filter "'+i[n].filter+'" could not be created');l.push((new s).unserialize(i[n]))}}o._stack=l}return o},getMeta:function(){return this._meta},setMeta:function(e){var t,n,r=this,a=r._stack;if(e&&(n=e.length)&&a.length)for(t=0;n>t;t++)a[e[t][0]].setMeta(e[t][1]);return r},stable:function(e){return arguments.length||(e=!0),this._stable=!!e,this},filters:function(e){return arguments.length?(this._stack=e.slice(),this):this._stack.slice()},push:function(){var e=n.call(arguments),t=e.length;return t&&(this._stack=a.apply(this._stack,e)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var e=n.call(arguments),t=e.length;return t&&r.apply(this._stack,[0,0].concat(e)),this},getAt:function(e){return this._stack.length>e?this._stack[e]:null},setAt:function(e,t){return this._stack.length>e?this._stack[e]=t:this._stack.push(t),this},insertAt:function(e){{var t=n.call(arguments);t.length}return argslen>1&&(t.shift(),r.apply(this._stack,[e,0].concat(t))),this},removeAt:function(e){return this._stack.splice(e,1)},remove:function(e){for(var t=this._stack.length;--t>=0;)e===this._stack[t]&&this._stack.splice(t,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(e,t,n,r){var a=this;if(a.hasMeta=!1,a._meta=[],a._isOn&&a._stack.length){var i,s,o=a._stack,l=o.length;for(i=0;l>i;i++)s=o[i],s&&s._isOn&&(e=s._apply(e,t,n,r),s.hasMeta&&a._meta.push([i,s.getMeta()]))}return a.hasMeta=a._meta.length>0,e},canRun:function(){return this._isOn&&this._stack.length},toString:function(){var e,t=arguments.length&&arguments[0].substr?arguments[0]:"  ",n=t+t,r=this._stack,a=[],i=r.length;for(e=0;i>e;e++)a.push(r[e].toString(n));return["[FILTER: "+this.name+"]","[","  "+a.join("\n  "),"]",""].join("\n")}});i.prototype.empty=i.prototype.reset,i.prototype.concat=i.prototype.push}(FILTER),!function(e){"use strict";{var t="hasOwnProperty";e.CustomFilter=e.Class(e.Filter,{name:"CustomFilter",constructor:function(e){var t=this;t.$super("constructor"),t._handler=e&&"function"==typeof e?e:null,t._params={}},_handler:null,_params:null,dispose:function(){var e=this;return e.$super("dispose"),e._handler=null,e._params=null,e},params:function(e){var n=this;if(arguments.length){for(var r in e)e[t](r)&&(n._params[r]=e[r]);return n}return n._params},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_handler:e._handler?e._handler.toString():null,_params:e._params}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._handler=null,t._handler&&(n._handler=new Function("",'"use strict"; return '+t._handler+";")()),n._params=t._params||{}),n},_apply:function(e,t,n,r){var a=this;return a._isOn&&a._handler?a._handler(a,e,t,n,r):e},canRun:function(){return this._isOn&&this._handler}})}}(FILTER),!function(e,t){"use strict";function n(e,t){var n,r,a,i,o,l=new s(20);return n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],l[0]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[1]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[2]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[3]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[4]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,n=t[5],r=t[6],a=t[7],i=t[8],o=t[9],l[5]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[6]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[7]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[8]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[9]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,n=t[10],r=t[11],a=t[12],i=t[13],o=t[14],l[10]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[11]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[12]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[13]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[14]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,n=t[15],r=t[16],a=t[17],i=t[18],o=t[19],l[15]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[16]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[17]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[18]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[19]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,l}function r(e,t,n){var r=1-n,a=new s(20);return a[0]=r*e[0]+n*t[0],a[1]=r*e[1]+n*t[1],a[2]=r*e[2]+n*t[2],a[3]=r*e[3]+n*t[3],a[4]=r*e[4]+n*t[4],a[5]=r*e[5]+n*t[5],a[6]=r*e[6]+n*t[6],a[7]=r*e[7]+n*t[7],a[8]=r*e[8]+n*t[8],a[9]=r*e[9]+n*t[9],a[10]=r*e[10]+n*t[10],a[11]=r*e[11]+n*t[11],a[12]=r*e[12]+n*t[12],a[13]=r*e[13]+n*t[13],a[14]=r*e[14]+n*t[14],a[15]=r*e[15]+n*t[15],a[16]=r*e[16]+n*t[16],a[17]=r*e[17]+n*t[17],a[18]=r*e[18]+n*t[18],a[19]=r*e[19]+n*t[19],a}var a=Math.sin,i=Math.cos,s=e.Array32F,o=e.CONSTANTS.toRad,l=(e.CONSTANTS.toDeg,e._notSupportClamp),u=e.ColorMatrixFilter=e.Class(e.Filter,{name:"ColorMatrixFilter",constructor:function(t){var n=this;n.$super("constructor"),n._matrix=t&&t.length?new s(t):null,e.useWebGL&&(n._webglInstance=e.WebGLColorMatrixFilterInstance||null)},_matrix:null,_webglInstance:null,dispose:function(){var e=this;return e.$super("dispose"),e._webglInstance=null,e._matrix=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_matrix:e._matrix}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._matrix=t._matrix),n},channel:function(n,r){r=r===t?!1:r;var a=r?1:0;switch(n){case e.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case e.CHANNEL.BLUE:return this.set([0,0,a,0,0,0,0,a,0,0,0,0,1,0,0,0,0,0,0,255]);case e.CHANNEL.GREEN:return this.set([0,a,0,0,0,0,1,0,0,0,0,a,0,0,0,0,0,0,0,255]);case e.CHANNEL.RED:default:return this.set([1,0,0,0,0,a,0,0,0,0,a,0,0,0,0,0,0,0,0,255])}},redChannel:function(t){return this.channel(e.CHANNEL.RED,t)},greenChannel:function(t){return this.channel(e.CHANNEL.GREEN,t)},blueChannel:function(t){return this.channel(e.CHANNEL.BLUE,t)},alphaChannel:function(){return this.channel(e.CHANNEL.ALPHA,!0)},maskChannel:function(t){switch(t){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(t,n){switch(t){case e.CHANNEL.ALPHA:switch(n){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case e.CHANNEL.BLUE:switch(n){case e.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.BLUE:return this;case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case e.CHANNEL.GREEN:switch(n){case e.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this;case e.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case e.CHANNEL.RED:default:switch(n){case e.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case e.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this}}},desaturate:function(){return this.set([e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,0,0,0,1,0])},colorize:function(n,r){var a,i,s,o;return r===t&&(r=1),a=.00392156862745098*(n>>16&255),i=.00392156862745098*(n>>8&255),s=.00392156862745098*(255&n),o=1-r,this.set([o+r*a*e.LUMA[0],r*a*e.LUMA[1],r*a*e.LUMA[2],0,0,r*i*e.LUMA[0],o+r*i*e.LUMA[1],r*i*e.LUMA[2],0,0,r*s*e.LUMA[0],r*s*e.LUMA[1],o+r*s*e.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(t){var n,r,a,i;return n=1-t,r=n*e.LUMA[0],a=n*e.LUMA[1],i=n*e.LUMA[2],this.set([r+t,a,i,0,0,r,a+t,i,0,0,r,a,i+t,0,0,0,0,0,1,0])},contrast:function(e,n,r){return n===t&&(n=e),r===t&&(r=e),e+=1,n+=1,r+=1,this.set([e,0,0,0,128*(1-e),0,n,0,0,128*(1-n),0,0,r,0,128*(1-r),0,0,0,1,0])},brightness:function(e,n,r){return n===t&&(n=e),r===t&&(r=e),this.set([1,0,0,0,e,0,1,0,0,n,0,0,1,0,r,0,0,0,1,0])},adjustHue:function(t){t*=o;var n=i(t),r=a(t);return this.set([e.LUMA[0]+n*(1-e.LUMA[0])+r*-e.LUMA[0],e.LUMA[1]+n*-e.LUMA[1]+r*-e.LUMA[1],e.LUMA[2]+n*-e.LUMA[2]+r*(1-e.LUMA[2]),0,0,e.LUMA[0]+n*-e.LUMA[0]+.143*r,e.LUMA[1]+n*(1-e.LUMA[1])+.14*r,e.LUMA[2]+n*-e.LUMA[2]+r*-.283,0,0,e.LUMA[0]+n*-e.LUMA[0]+r*-(1-e.LUMA[0]),e.LUMA[1]+n*-e.LUMA[1]+r*e.LUMA[1],e.LUMA[2]+n*(1-e.LUMA[2])+r*e.LUMA[2],0,0,0,0,0,1,0])},average:function(e,n,r){return e===t&&(e=.3333),n===t&&(n=.3333),r===t&&(r=.3334),this.set([e,n,r,0,0,e,n,r,0,0,e,n,r,0,0,0,0,0,1,0])},quickContrastCorrection:function(e){return e===t&&(e=1.2),this.set([e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0])},sepia:function(e){return e===t&&(e=.5),e>1?e=1:0>e&&(e=0),this.set([1-.607*e,.769*e,.189*e,0,0,.349*e,1-.314*e,.168*e,0,0,.272*e,.534*e,1-.869*e,0,0,0,0,0,1,0])},sepia2:function(n){return n===t&&(n=10),n>100&&(n=100),n*=2.55,this.set([e.LUMA[0],e.LUMA[1],e.LUMA[2],0,40,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,20,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,-n,0,0,0,1,0])},threshold:function(n,r){return r===t&&(r=256),this.set([e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,0,0,0,1,0])},threshold_rgb:function(e,n){return n===t&&(n=256),this.set([n,0,0,0,-(n-1)*e,0,n,0,0,-(n-1)*e,0,0,n,0,-(n-1)*e,0,0,0,1,0])},threshold_alpha:function(e,n){return e===t&&(e=.5),n===t&&(n=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,n,-n*e])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(e,t){return this._matrix=this._matrix?r(this._matrix,e.getMatrix(),t):new s(e.getMatrix()),this},set:function(e){return this._matrix=this._matrix?n(this._matrix,new s(e)):new s(e),this},reset:function(){return this._matrix=null,this},combineWith:function(e){return this.set(e.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(e){return this._matrix=new s(e),this},_apply:function(e){var t=this;if(t._isOn&&t._matrix){var n,r,a,i,s,o,l,u,c,h,f,m,d,p,_,g,v,y,w,A,C,b=e.length,M=t._matrix,I=(b>>2)%4;for(n=0;b>n;n+=16)y=e[n],w=e[n+1],A=e[n+2],C=e[n+3],r=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],a=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],i=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],s=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+4],w=e[n+5],A=e[n+6],C=e[n+7],o=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],l=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],u=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],c=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+8],w=e[n+9],A=e[n+10],C=e[n+11],h=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],f=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],m=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],d=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+12],w=e[n+13],A=e[n+14],C=e[n+15],p=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],_=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],g=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],v=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],e[n]=~~r,e[n+1]=~~a,e[n+2]=~~i,e[n+3]=~~s,e[n+4]=~~o,e[n+5]=~~l,e[n+6]=~~u,e[n+7]=~~c,e[n+8]=~~h,e[n+9]=~~f,e[n+10]=~~m,e[n+11]=~~d,e[n+12]=~~p,e[n+13]=~~_,e[n+14]=~~g,e[n+15]=~~v;if(I)for(I<<=2,n=b-I;b>n;n+=4)y=e[n],w=e[n+1],A=e[n+2],C=e[n+3],r=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],a=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],i=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],s=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],e[n]=~~r,e[n+1]=~~a,e[n+2]=~~i,e[n+3]=~~s}return e},canRun:function(){return this._isOn&&this._matrix}});u.prototype.grayscale=u.prototype.desaturate,u.prototype.rotateHue=u.prototype.adjustHue,u.prototype.thresholdRgb=u.prototype.threshold_rgb,u.prototype.thresholdAlpha=u.prototype.threshold_alpha,l&&(u.prototype._apply=function(e){var t=this;if(t._isOn&&t._matrix){var n,r,a,i,s,o,l,u,c,h,f,m,d,p,_,g,v,y,w,A,C,b=e.length,M=t._matrix,I=(b>>2)%4;for(n=0;b>n;n+=16)y=e[n],w=e[n+1],A=e[n+2],C=e[n+3],r=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],a=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],i=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],s=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+4],w=e[n+5],A=e[n+6],C=e[n+7],o=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],l=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],u=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],c=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+8],w=e[n+9],A=e[n+10],C=e[n+11],h=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],f=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],m=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],d=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],y=e[n+12],w=e[n+13],A=e[n+14],C=e[n+15],p=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],_=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],g=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],v=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],r=0>r?0:r>255?255:r,a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s,o=0>o?0:o>255?255:o,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,m=0>m?0:m>255?255:m,d=0>d?0:d>255?255:d,p=0>p?0:p>255?255:p,_=0>_?0:_>255?255:_,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,e[n]=~~r,e[n+1]=~~a,e[n+2]=~~i,e[n+3]=~~s,e[n+4]=~~o,e[n+5]=~~l,e[n+6]=~~u,e[n+7]=~~c,e[n+8]=~~h,e[n+9]=~~f,e[n+10]=~~m,e[n+11]=~~d,e[n+12]=~~p,e[n+13]=~~_,e[n+14]=~~g,e[n+15]=~~v;if(I)for(I<<=2,n=b-I;b>n;n+=4)y=e[n],w=e[n+1],A=e[n+2],C=e[n+3],r=M[0]*y+M[1]*w+M[2]*A+M[3]*C+M[4],a=M[5]*y+M[6]*w+M[7]*A+M[8]*C+M[9],i=M[10]*y+M[11]*w+M[12]*A+M[13]*C+M[14],s=M[15]*y+M[16]*w+M[17]*A+M[18]*C+M[19],r=0>r?0:r>255?255:r,a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s,e[n]=~~r,e[n+1]=~~a,e[n+2]=~~i,e[n+3]=~~s}return e})}(FILTER),!function(e,t){"use strict";var n=e.ImArrayCopy,r=e.Color.clampPixel,a=function(e){var t=new n(256),r=0;if(e)for(;256>r;)t[r]=255-r,r++;else for(;256>r;)t[r]=r,r++;return t},i=function(e){for(var t=new n(256),r=0;256>r;)t[r]=e,r++;return t},s=function(e){return e?new n(e):null},o=Math.pow,l=Math.exp,u=1/255,c=a(),h=a(1),f=e.TableLookupFilter=e.Class(e.Filter,{name:"TableLookupFilter",constructor:function(e,t,n,r){var a=this;a.$super("constructor"),a._tableR=e||null,a._tableG=t||a._tableR,a._tableB=n||a._tableG,a._tableA=r||null},_tableR:null,_tableG:null,_tableB:null,_tableA:null,dispose:function(){var e=this;return e.$super("dispose"),e._tableR=null,e._tableG=null,e._tableB=null,e._tableA=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_tableR:e._tableR,_tableG:e._tableG,_tableB:e._tableB,_tableA:e._tableA}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._tableR=t._tableR,n._tableG=t._tableG,n._tableB=t._tableB,n._tableA=t._tableA),n},thresholds:function(e,t,a){e.length||(e=[e]),t||(t=e),a||(a=t);var i,s,o=e.length,l=o+1,u=t.length,c=u+1,h=a.length,f=h+1,m=new n(256),d=new n(l),p=new n(256),_=new n(c),g=new n(256),v=new n(f),y=255/(l-1),w=255/(c-1),A=255/(f-1);for(i=0;l>i;)d[i]=~~(y*i),i++;for(e[0]=~~(255*e[0]),i=1;o>i;)e[i]=e[i-1]+~~(255*e[i]),i++;for(i=0;c>i;)_[i]=~~(w*i),i++;for(t[0]=~~(255*t[0]),i=1;u>i;)t[i]=t[i-1]+~~(255*t[i]),i++;for(i=0;f>i;)v[i]=~~(A*i),i++;for(a[0]=~~(255*a[0]),i=1;h>i;)a[i]=a[i-1]+~~(255*a[i]),i++;for(i=0;256>i;){for(s=0;o>s&&i>e[s];)s++;for(m[i]=r(d[s]),s=0;u>s&&i>t[s];)s++;for(p[i]=r(_[s]),s=0;h>s&&i>a[s];)s++;g[i]=r(v[s]),i++}return this.set(m,p,g)},threshold:function(e,t,n){return e=e||.5,t=t||e,n=n||t,this.thresholds([e],[t],[n])},quantize:function(e){e===t&&(e=64),2>e&&(e=2);var a,i=new n(256),s=new n(e),o=255/(e-1),l=e/256;for(a=0;e>a;)s[a]=~~(o*a),a++;for(a=0;256>a;)i[a]=r(s[~~(l*a)]),a++;return this.set(i)},binarize:function(){return this.quantize(2)},solarize:function(e){e===t&&(e=.5);var a,i,s=0,o=new n(256),l=2/255;for(s=0;256>s;)a=l*s,i=a>e?255-255*a:255*a-255,o[s]=~~r(i),s++;return this.set(o)},solarize2:function(e){e===t&&(e=.5),e=1-e;var a,i,s=0,o=new n(256),l=2/255;for(s=0;256>s;)a=l*s,i=e>a?255-255*a:255*a-255,o[s]=~~r(i),s++;return this.set(o)},solarizeInverse:function(e){e===t&&(e=.5),e*=256;var r=0,a=new n(256);for(r=0;256>r;)a[r]=r>e?255-r:r,r++;return this.set(a)},invert:function(){return this.set(h)},mask:function(e){var t=0,a=e>>16&255,i=e>>8&255,s=255&e;for(tR=new n(256),tG=new n(256),tB=new n(256),t=0;256>t;)tR[t]=r(t&a),tG[t]=r(t&i),tB[t]=r(t&s),t++;return this.set(tR,tG,tB)},replace:function(e,t){if(e==t)return this;var n=e>>16&255,r=e>>8&255,a=255&e,i=t>>16&255,o=t>>8&255,l=255&t,u=s(c),h=s(c),f=s(c);return u[n]=i,h[r]=o,f[a]=l,this.set(u,h,f)},extract:function(t,n,a){if(!n||!n.length)return this;a=a||0;var s,o,l=a>>16&255,u=a>>8&255,c=255&a,h=i(l),f=i(u),m=i(c);switch(t){case e.CHANNEL.BLUE:for(s=n[0],o=n[1];o>=s;)m[s]=r(s),s++;break;case e.CHANNEL.GREEN:for(s=n[0],o=n[1];o>=s;)f[s]=r(s),s++;break;case e.CHANNEL.RED:default:for(s=n[0],o=n[1];o>=s;)h[s]=r(s),s++}return this.set(h,f,m)},gammaCorrection:function(e,t,a){e=e||1,t=t||e,a=a||t,e=1/e,t=1/t,a=1/a;for(var i=new n(256),s=new n(256),l=new n(256),c=0;256>c;)i[c]=r(~~(255*o(u*c,e))),s[c]=r(~~(255*o(u*c,t))),l[c]=r(~~(255*o(u*c,a))),c++;return this.set(i,s,l)},exposure:function(e){e===t&&(e=1);var a=0,i=new n(256);for(a=0;256>a;)i[a]=r(~~(255*(1-l(-e*a*u)))),a++;return this.set(i)},set:function(e,t,n){if(!e)return this;t=t||e,n=n||t;var i,o,l,u,c,h=this._tableR||a(),f=s(h);if(t&&n){for(i=this._tableG||s(h),o=this._tableB||s(i),l=s(i),u=s(o),c=0;256>c;)h[c]=r(e[r(f[c])]),i[c]=r(t[r(l[c])]),o[c]=r(n[r(u[c])]),c++;this._tableR=h,this._tableG=i,this._tableB=o}else{for(c=0;256>c;)h[c]=r(e[r(f[c])]),c++;this._tableR=h,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=this._tableG=this._tableB=this._tableA=null,this},combineWith:function(e){return this.set(e.getTable(0),e.getTable(1),e.getTable(2))},getTable:function(t){switch(t=t||e.CHANNEL.RED){case e.CHANNEL.ALPHA:return this._tableA;case e.CHANNEL.BLUE:return this._tableB;case e.CHANNEL.GREEN:return this._tableG;case e.CHANNEL.RED:default:return this._tableR}},setTable:function(t,n){switch(n=n||e.CHANNEL.RED){case e.CHANNEL.ALPHA:return this._tableA=t,this;case e.CHANNEL.BLUE:return this._tableB=t,this;case e.CHANNEL.GREEN:return this._tableG=t,this;case e.CHANNEL.RED:default:return this._tableR=t,this}},_apply:function(e){var t=this;if(!t._isOn||!t._tableR)return e;var n,r,a,i,s,o=e.length,l=(o>>2)%4,u=t._tableR,c=t._tableG,h=t._tableB,f=t._tableA;if(f){for(n=0;o>n;n+=16)r=e[n],a=e[n+1],i=e[n+2],s=e[n+3],e[n]=u[r],e[n+1]=c[a],e[n+2]=h[i],e[n+3]=f[s],r=e[n+4],a=e[n+5],i=e[n+6],s=e[n+7],e[n+4]=u[r],e[n+5]=c[a],e[n+6]=h[i],e[n+7]=f[s],r=e[n+8],a=e[n+9],i=e[n+10],s=e[n+11],e[n+8]=u[r],e[n+9]=c[a],e[n+10]=h[i],e[n+11]=f[s],r=e[n+12],a=e[n+13],i=e[n+14],s=e[n+15],e[n+12]=u[r],e[n+13]=c[a],e[n+14]=h[i],e[n+15]=f[s];if(l)for(l<<=2,n=o-l;o>n;n+=4)r=e[n],a=e[n+1],i=e[n+2],s=e[n+3],e[n]=u[r],e[n+1]=c[a],e[n+2]=h[i],e[n+3]=f[s]}else{for(n=0;o>n;n+=16)r=e[n],a=e[n+1],i=e[n+2],e[n]=u[r],e[n+1]=c[a],e[n+2]=h[i],r=e[n+4],a=e[n+5],i=e[n+6],e[n+4]=u[r],e[n+5]=c[a],e[n+6]=h[i],r=e[n+8],a=e[n+9],i=e[n+10],e[n+8]=u[r],e[n+9]=c[a],e[n+10]=h[i],r=e[n+12],a=e[n+13],i=e[n+14],e[n+12]=u[r],e[n+13]=c[a],e[n+14]=h[i];if(l)for(l<<=2,n=o-l;o>n;n+=4)r=e[n],a=e[n+1],i=e[n+2],e[n]=u[r],e[n+1]=c[a],e[n+2]=h[i]}return e},canRun:function(){return this._isOn&&this._tableR}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(FILTER),!function(e){"use strict";{var t=(e.ImArray,e.ImArrayCopy),n=e.Array16I,r=Math.min,a=(Math.max,Math.floor);e.DisplacementMapFilter=e.Class(e.Filter,{name:"DisplacementMapFilter",constructor:function(e){var t=this;t.$super("constructor"),e&&t.setMap(e)},_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:e.MODE.CLAMP,dispose:function(){var e=this;return e.$super("dispose"),e._map=null,e.map=null,e.scaleX=null,e.scaleY=null,e.startX=null,e.startY=null,e.componentX=null,e.componentY=null,e.color=null,e.red=null,e.green=null,e.blue=null,e.alpha=null,e.mode=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_map:e._map,scaleX:e.scaleX,scaleY:e.scaleY,startX:e.startX,startY:e.startY,componentX:e.componentX,componentY:e.componentY,color:e.color,red:e.red,green:e.green,blue:e.blue,alpha:e.alpha,mode:e.mode}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n.map=null,n._map=t._map,n.scaleX=t.scaleX,n.scaleY=t.scaleY,n.startX=t.startX,n.startY=t.startY,n.componentX=t.componentX,n.componentY=t.componentY,n.color=t.color,n.red=t.red,n.green=t.green,n.blue=t.blue,n.alpha=t.alpha,n.mode=t.mode),n},reset:function(){var e=this;return e._map=null,e.map=null,e},getMap:function(){return this.map},setMap:function(e){var t=this;return e&&(t.map=e,t._map={data:e.getData(),width:e.width,height:e.height}),t},setColor:function(e){var t=this;return t.color=e,t.alpha=e>>24&255,t.red=e>>16&255,t.green=e>>8&255,t.blue=255&e,t},_apply:function(i,s,o){var l=this;if(!l._isOn||!l._map)return i;var u,c,h,f,m,d,p,_,g,v,y,w,A,C,b,M,I,R,E,L,x,N,O,F,S,T,k,D,P,G,U,H=.00390625*l.scaleX,X=.00390625*l.scaleY,Y=l.componentX,B=l.componentY,W=l.alpha,z=l.red,q=l.green,$=l.blue,j=l.mode,K=e.MODE.IGNORE,J=(e.MODE.CLAMP,e.MODE.COLOR),Q=e.MODE.WRAP;for(u=l._map.data,c=l._map.width,h=l._map.height,f=u.length>>2,d=r(c,s),p=r(h,o),D=i.length,T=d*p<<2,k=D>>2,g=a(l.startX*(s-1)),_=a(l.startY*(o-1)),v=_*s,y=-g,w=-_,A=s-g-1,C=o-_-1,m=new n(f<<1),P=new t(i),M=0,I=0,R=0,E=0,b=0;f>b;b++,M+=2,I++)I>=c&&(I=0,R++,E+=c),O=I+E<<2,m[M]=a((u[O+Y]-128)*H),m[M+1]=a((u[O+B]-128)*X);for(I=0,R=0,E=0,L=0,b=0;T>b;b+=4,I++)if(I>=d&&(I=0,R++,E+=s,L+=c),!(w>R||R>C||y>I||I>A)){if(N=I+g,x=R+_,F=N+E+v<<2,M=I+L<<1,G=N+m[M],U=x+m[M+1],U>=o||0>U||G>=s||0>G){if(j==K)continue;if(j==J){i[F]=z,i[F+1]=q,i[F+2]=$,i[F+3]=W;continue}j==Q?(U>C?U-=o:0>U&&(U+=o),G>A?G-=s:0>G&&(G+=s)):(U>C?U=C:0>U&&(U=0),G>A?G=A:0>G&&(G=0))}S=G+U*s<<2,i[F]=P[S],i[F+1]=P[S+1],i[F+2]=P[S+2],i[F+3]=P[S+3]}return i},canRun:function(){return this._isOn&&(this._map||this.map)}})}}(FILTER),!function(FILTER,undef){"use strict";var IMG=FILTER.ImArray,IMGcopy=FILTER.ImArrayCopy,PI=FILTER.CONSTANTS.PI,DoublePI=FILTER.CONSTANTS.PI2,HalfPI=FILTER.CONSTANTS.PI_2,ThreePI2=1.5*PI,Sqrt=Math.sqrt,Atan2=Math.atan2,Atan=Math.atan,Sin=Math.sin,Cos=Math.cos,Floor=Math.floor,Asin=Math.asin,Tan=Math.tan,Abs=Math.abs,Max=Math.max,toRad=FILTER.CONSTANTS.toRad,Maps,GeometricMapFilter=FILTER.GeometricMapFilter=FILTER.Class(FILTER.Filter,{name:"GeometricMapFilter",constructor:function(e){var t=this;t.$super("constructor"),e&&t.generic(e)},_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,dx:0,dy:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:FILTER.MODE.CLAMP,dispose:function(){var e=this;return e.$super("dispose"),e._map=null,e._mapName=null,e.inverseTransform=null,e.matrix=null,e.centerX=null,e.centerY=null,e.dx=null,e.dy=null,e.angle=null,e.radius=null,e.wavelength=null,e.amplitude=null,e.phase=null,e.xAmplitude=null,e.yAmplitude=null,e.xWavelength=null,e.yWavelength=null,e.mode=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_mapName:e._mapName,inverseTransform:e.inverseTransform?e.inverseTransform.toString():null,matrix:e.matrix,centerX:e.centerX,centerY:e.centerY,dx:e.dx,dy:e.dy,angle:e.angle,radius:e.radius,wavelength:e.wavelength,amplitude:e.amplitude,phase:e.phase,xAmplitude:e.xAmplitude,yAmplitude:e.yAmplitude,xWavelength:e.xWavelength,yWavelength:e.yWavelength,mode:e.mode}}},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self.inverseTransform=null,self.matrix=params.matrix,self.centerX=params.centerX,self.centerY=params.centerY,self.dx=params.dx,self.dy=params.dy,self.angle=params.angle,self.radius=params.radius,self.wavelength=params.wavelength,self.amplitude=params.amplitude,self.phase=params.phase,self.xAmplitude=params.xAmplitude,self.yAmplitude=params.yAmplitude,self.xWavelength=params.xWavelength,self.yWavelength=params.yWavelength,self.mode=params.mode,params.inverseTransform&&(self.inverseTransform=eval('(function(){ "use strict"; return '+params.inverseTransform+"})();")),self._mapName=params._mapName,self._map=null,self._mapName&&Maps[self._mapName]&&(self._map=Maps[self._mapName])),self},generic:function(e){var t=this;return e&&(t.inverseTransform=e,t._mapName="generic",t._map=Maps.generic),t},affine:function(e){var t=this;return e&&(t.matrix=e,t._mapName="affine",t._map=Maps.affine),t},flipX:function(){var e=this;return e._mapName="flipX",e._map=Maps.flipX,e},flipY:function(){var e=this;return e._mapName="flipY",e._map=Maps.flipY,e},flipXY:function(){var e=this;return e._mapName="flipXY",e._map=Maps.flipXY,e},rotateCW:function(){var e=this;return e._mapName="rotateCW",e._map=Maps.rotateCW,e},rotateCCW:function(){var e=this;
return e._mapName="rotateCCW",e._map=Maps.rotateCCW,e},polar:function(e,t){var n=this;return n.centerX=e||0,n.centerY=t||0,n._mapName="polar",n._map=Maps.polar,n},cartesian:function(e,t){var n=this;return n.centerX=e||0,n.centerY=t||0,n._mapName="cartesian",n._map=Maps.cartesian,n},twirl:function(e,t,n,r){var a=this;return a.angle=e||0,a.radius=t||0,a.centerX=n||0,a.centerY=r||0,a._mapName="twirl",a._map=Maps.twirl,a},sphere:function(e,t,n){var r=this;return r.radius=e||0,r.centerX=t||0,r.centerY=n||0,r._mapName="sphere",r._map=Maps.sphere,r},ripple:function(e,t,n,r,a,i){var s=this;return s.radius=e!==undef?e:50,s.centerX=a||0,s.centerY=i||0,s.wavelength=t!==undef?t:16,s.amplitude=n!==undef?n:10,s.phase=r||0,s._mapName="ripple",s._map=Maps.ripple,s},shift:function(e,t){var n=this;return n.dx=e!==undef?e:0,n.dy=t!==undef?t:n.dx,n._mapName="shift",n._map=Maps.shift,n},reset:function(){var e=this;return e._mapName=null,e._map=null,e},getMap:function(){return this._map},setMap:function(e){var t=this;return t._mapName=null,t._map=e,t},_apply:function(e,t,n,r){var a=this;return a._isOn&&a._map?a._map(a,e,t,n,r):e},canRun:function(){return this._isOn&&this._map}});GeometricMapFilter.prototype.translate=GeometricMapFilter.prototype.shift,Maps={generic:function(e,t,n,r){var a,i,s,o,l,u,c,h=t.length,f=new IMG(h),m=e.inverseTransform,d=e.mode,p=FILTER.MODE.CLAMP,_=FILTER.MODE.WRAP;for(a=0,i=0,s=0;h>s;s+=4,a++){if(a>=n&&(a=0,i++),l=m([a,i],n,r),u=~~l[0],c=~~l[1],0>u||u>=n||0>c||c>=r)switch(d){case _:c>=r?c-=r:0>c&&(c+=r),u>=n?u-=n:0>u&&(u+=n);break;case p:default:c>=r?c=r-1:0>c&&(c=0),u>=n?u=n-1:0>u&&(u=0)}o=u+c*n<<2,f[s]=t[o],f[s+1]=t[o+1],f[s+2]=t[o+2],f[s+3]=t[o+3]}return f},affine:function(e,t,n){var r,a,i,s,o,l,u,c,h,f=t.length,m=f>>2,d=new IMG(f),p=e.matrix,_=p[0],g=p[1],v=p[3],y=p[4],w=p[2],A=p[5],C=e.mode,b=FILTER.MODE.CLAMP,M=FILTER.MODE.WRAP,I=n-1,R=m-n;for(r=0,a=0,o=A*n,l=v*n,u=y*n,i=0;f>i;i+=4,r++){if(r>=n&&(r=0,a++),c=~~(_*r+g*a+w),h=~~(l*r+u*a+o),0>c||c>I||0>h||h>R)switch(C){case M:h>R?h-=m:0>h&&(h+=m),c>=n?c-=n:0>c&&(c+=n);break;case b:default:h>R?h=R:0>h&&(h=0),c>I?c=I:0>c&&(c=0)}s=c+h<<2,d[i]=t[s],d[i+1]=t[s+1],d[i+2]=t[s+2],d[i+3]=t[s+3]}return d},shift:function(e,t,n,r){var a,i,s,o,l,u=t.length,c=new IMG(u),h=-e.dx,f=-e.dy;for(0>h&&(h+=n),0>f&&(f+=r),a=0,i=0,s=0,o=0;u>o;o+=4,a++)a>=n&&(a=0,i++,s+=n),l=(a+h)%n+(i+f)%r*n<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},flipX:function(e,t,n){var r,a,i,s,o,l=t.length,u=new IMG(l);for(r=0,a=0,i=0,s=0;l>s;s+=4,r++)r>=n&&(r=0,a++,i+=n),o=n-1-r+i<<2,u[s]=t[o],u[s+1]=t[o+1],u[s+2]=t[o+2],u[s+3]=t[o+3];return u},flipY:function(e,t,n,r){var a,i,s,o,l,u=t.length,c=new IMG(u);for(a=0,i=0,s=(r-1)*n,o=0;u>o;o+=4,a++)a>=n&&(a=0,i++,s-=n),l=a+s<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},flipXY:function(e,t,n,r){var a,i,s,o,l,u,c=t.length,h=new IMG(c);for(a=0,i=0,o=(r-1)*n,l=0;c>l;l+=4,a++)a>=n&&(a=0,i++,s+=n,o-=n),u=n-1-a+o<<2,h[l]=t[u],h[l+1]=t[u+1],h[l+2]=t[u+2],h[l+3]=t[u+3];return h},rotateCW:function(e,t,n){var r,a,i,s,o,l=t.length,u=new IMG(l),c=l>>2;for(r=0,a=0,i=c-1,s=0;l>s;s+=4,r++,i-=n)r>=n&&(r=0,i=c-1,a++),o=a+i<<2,u[s]=t[o],u[s+1]=t[o+1],u[s+2]=t[o+2],u[s+3]=t[o+3];return u},rotateCCW:function(e,t,n){var r,a,i,s,o,l=t.length,u=new IMG(l);for(r=0,a=0,i=0,s=0;l>s;s+=4,r++,i+=n)r>=n&&(r=0,i=0,a++),o=n-1-a+i<<2,u[s]=t[o],u[s+1]=t[o+1],u[s+2]=t[o+2],u[s+3]=t[o+3];return u},twirl:function(e,t,n,r){if(0>=e.radius)return t;var a,i,s,o,l,u,c,h,f=t.length,m=new IMGcopy(t),d=e.centerX,p=e.centerY,_=e.angle,g=e.radius,v=e.mode,y=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,A=_/g,C=n-1,b=r-1;for(d=Floor(d*(n-1)),p=Floor(p*(r-1)),a=0,i=0,s=0;f>s;s+=4,a++)if(a>=n&&(a=0,i++),u=a-d,c=i-p,l=Sqrt(u*u+c*c),g>l){if(h=Atan2(c,u)+A*(g-l),u=~~(d+l*Cos(h)),c=~~(p+l*Sin(h)),0>u||u>C||0>c||c>b)switch(v){case w:c>b?c-=r:0>c&&(c+=r),u>C?u-=n:0>u&&(u+=n);break;case y:default:c>b?c=b:0>c&&(c=0),u>C?u=C:0>u&&(u=0)}o=u+c*n<<2,t[s]=m[o],t[s+1]=m[o+1],t[s+2]=m[o+2],t[s+3]=m[o+3]}return t},sphere:function(e,t,n,r){if(0>=e.radius)return t;var a,i,s,o,l,u,c,h,f,m,d,p,_,g=t.length,v=new IMGcopy(t),y=e.centerX,w=e.centerY,A=e.radius,C=e.mode,b=FILTER.MODE.CLAMP,M=FILTER.MODE.WRAP,I=A*A,R=.555556,E=1-R,L=n-1,x=r-1;for(y=Floor(y*(n-1)),w=Floor(w*(r-1)),a=0,i=0,s=0;g>s;s+=4,a++)if(a>=n&&(a=0,i++),l=a-y,u=i-w,p=l*l,_=u*u,c=p+_,I>c){if(m=I-c,d=Sqrt(m),h=Asin(l/Sqrt(p+m))*E,f=Asin(u/Sqrt(_+m))*E,l=~~(a-d*Tan(h)),u=~~(i-d*Tan(f)),0>l||l>L||0>u||u>x)switch(C){case M:u>x?u-=r:0>u&&(u+=r),l>L?l-=n:0>l&&(l+=n);break;case b:default:u>x?u=x:0>u&&(u=0),l>L?l=L:0>l&&(l=0)}o=l+u*n<<2,t[s]=v[o],t[s+1]=v[o+1],t[s+2]=v[o+2],t[s+3]=v[o+3]}return t},ripple:function(e,t,n,r){if(0>=e.radius)return t;var a,i,s,o,l,u,c,h,f,m,d,p=t.length,_=new IMGcopy(t),g=FILTER.MODE.CLAMP,v=FILTER.MODE.WRAP,y=n-1,w=r-1,A=e.centerX,C=e.centerY,b=e.radius,M=e.mode,I=b*b,R=e.wavelength,E=e.amplitude,L=e.phase;for(A=Floor(A*(n-1)),C=Floor(C*(r-1)),a=0,i=0,s=0;p>s;s+=4,a++)if(a>=n&&(a=0,i++),u=a-A,c=i-C,m=u*u,d=c*c,f=m+d,I>f){if(l=Sqrt(f),h=E*Sin(l/R*Math.PI*2-L),h*=(b-l)/b,l&&(h*=R/l),u=~~(a+u*h),c=~~(i+c*h),0>u||u>y||0>c||c>w)switch(M){case v:c>w?c-=r:0>c&&(c+=r),u>y?u-=n:0>u&&(u+=n);break;case g:default:c>w?c=w:0>c&&(c=0),u>y?u=y:0>u&&(u=0)}o=u+c*n<<2,t[s]=_[o],t[s+1]=_[o+1],t[s+2]=_[o+2],t[s+3]=_[o+3]}return t},polar:function(e,t,n,r){var a,i,s,o,l,u,c,h,f,m,d,p,_=t.length,g=new IMGcopy(t),v=FILTER.MODE.CLAMP,y=FILTER.MODE.WRAP,w=n-1,A=r-1,C=0,b=e.mode;for(d=~~(.5*n+.5),p=~~(.5*r+.5),m=Max(p,d),a=0,i=0,s=0;_>s;s+=4,a++){if(a>=n&&(a=0,i++),o=a-d,l=i-p,f=0,o>=0?l>0?(f=PI-Atan(o/l),C=Sqrt(o*o+l*l)):0>l?(f=Atan(o/l),C=Sqrt(o*o+l*l)):(f=HalfPI,C=o):0>o&&(0>l?(f=DoublePI-Atan(o/l),C=Sqrt(o*o+l*l)):l>0?(f=PI+Atan(o/l),C=Sqrt(o*o+l*l)):(f=ThreePI2,C=-o)),u=n-1-(n-1)/DoublePI*f,c=r*C/m,0>u||u>w||0>c||c>A)switch(b){case y:c>A?c-=r:0>c&&(c+=r),u>w?u-=n:0>u&&(u+=n);break;case v:default:c>A?c=A:0>c&&(c=0),u>w?u=w:0>u&&(u=0)}h=~~(u+.5)+~~(c+.5)*n<<2,t[s]=g[h],t[s+1]=g[h+1],t[s+2]=g[h+2],t[s+3]=g[h+3]}return t},cartesian:function(e,t,n,r){var a,i,s,o,l,u,c,h,f,m,d,p,_,g=t.length,v=new IMGcopy(t),y=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,A=n-1,C=r-1,b=0,M=e.mode;for(p=~~(.5*n+.5),_=~~(.5*r+.5),d=Max(_,p),a=0,i=0,s=0;g>s;s+=4,a++){if(a>=n&&(a=0,i++),f=a/n*DoublePI,m=f>=ThreePI2?DoublePI-f:f>=PI?f-PI:f>=HalfPI?PI-f:f,b=d*(i/r),c=-b*Sin(m),h=b*Cos(m),f>=ThreePI2?(o=p-c,l=_-h):f>=PI?(o=p-c,l=_+h):f>=HalfPI?(o=p+c,l=_+h):(o=p+c,l=_-h),0>o||o>A||0>l||l>C)switch(M){case w:l>C?l-=r:0>l&&(l+=r),o>A?o-=n:0>o&&(o+=n);break;case y:default:l>C?l=C:0>l&&(l=0),o>A?o=A:0>o&&(o=0)}u=~~(o+.5)+~~(l+.5)*n<<2,t[s]=v[u],t[s+1]=v[u+1],t[s+2]=v[u+2],t[s+3]=v[u+3]}return t}}}(FILTER),!function(e,t){"use strict";function n(e,t,n,r){var a,i=e.length,s=new w(e.length);for(n=n||1,r=r||1,a=0;i>a;)s[a]=n*e[a]+r*t[a],a++;return s}function r(e,t){var n,r,a,i=e.length,s=[],o=0;for(n=0;i>n;n++)for(r=0;i>r;r++)a=e[n]*t[r],o+=a,s.push(a);return{kernel:s,sum:o}}function a(e){var t,n=new Array(e);for(t=0;e>t;)n[t]=1,t++;return n}function i(e){var t,n,r,a,i=I.length;if(e--,i>e)t=new w(I[e]);else for(t=new w(I[i-1]);e>=i;){for(n=t,t=new w(n.length+1),t[0]=1,r=0,a=n.length-1;a>r;r++)t[r+1]=n[r]+n[r+1];t[n.length]=1,40>i&&I.push(new Array(t)),i++}return t}function s(e){var t,n=e>>1,r=-n,a=new Array(e);for(t=0;e>t;)a[t]=r,r++,t++;return a}function o(e){var t=i(e);return r(t,t)}function l(e,t){var n=i(e),a=s(e);return 1==t?r(a.reverse(),n):r(n,a)}function u(e,t){var n=a(e),i=s(e);return 1==t?r(i.reverse(),n):r(n,i)}function c(e,t,n){t=t||1,n=n||t;var r,a=e*e,i=a>>1,s=new w(a);for(r=0;a>r;)s[r]=t,r++;return s[i]=n,s}function h(e,t,n,r){var a,i,s,o,l,u=e*e,c=e>>1,h=u>>1,f=new w(u);for(o=0,a=0;c>=a;a++){for(i=0,l=0,s=0;c>=s;s++)f[h+a+i]=o+l,f[h-a-i]=-o-l,f[h-a+i]=-o+l,f[h+a-i]=o-l,i+=e,l+=n;o+=t}return f[h]=r||1,f}function f(e,t,n,r){var a,i,s,o,l,u,c=e*e,h=e>>1,f=c>>1,m=new w(c),d=new w(c),p=1/e,g=1e-8;for(_(t)>g?(l=1,u=n/t):(l=t/n,u=1),a=0,s=0,o=0,i=u*e;h>=a;)d[f+a]=~~(f+s+o+.5),d[f-a]=~~(f-s-o+.5),a++,s+=l,o+=i;for(a=0;h>=a;)m[d[f+a]]=m[d[f-a]]=p,a++;return m[f]=r||1,m}function m(e,t,n,r,a,i,s,o,l,u){var c,h,f,m,d,p,_,g,v,y,w,b,I,R,E,L,x,N,O,F,S,T,k,D,P,G,U,H,X,Y,B,W,z,q,$,j,K,J,Q,V,Z,et,tt,nt,rt,at,it,st=e.length,ot=st>>2,lt=i,ut=s;if(g=lt*ut,p=lt>>1,_=t*(ut>>1),w=-p-1,I=-_-t,b=p,R=_,Y=0,W=t-1,B=0,z=ot-t,h=(ot<<1)+ot,y=(t<<1)+t,u=u||1,it=0,a)for(F=r[0],S=r[g>>1],T=S-F,k=a[0],D=a[g>>1],P=D-k;u>it;){for(v=new A(st),c=new C(h),E=0,L=0,f=m=d=0,x=0;t>x;x++,E+=4,L+=3)f+=e[E],m+=e[E+1],d+=e[E+2],c[L]=f,c[L+1]=m,c[L+2]=d;for(L=0,x=0,f=m=d=0,E=y+t;st>E;E+=4,L+=3,x++)x>=t&&(x=0,f=m=d=0),f+=e[E],m+=e[E+1],d+=e[E+2],c[L+y]=c[L]+f,c[L+y+1]=c[L+1]+m,c[L+y+2]=c[L+2]+d;for(x=0,N=0,O=0,E=0;st>E;E+=4,x++)x>=t&&(x=0,N++,O+=t),G=x+w,U=O+I,H=x+b,X=O+R,G=Y>G?Y:G,H=H>W?W:H,U=B>U?B:U,X=X>z?z:X,q=G+U,K=H+X,$=H+U,j=G+X,q=(q<<1)+q,$=($<<1)+$,j=(j<<1)+j,K=(K<<1)+K,Z=F*(c[K]-c[$]-c[j]+c[q])+T*e[E],et=F*(c[K+1]-c[$+1]-c[j+1]+c[q+1])+T*e[E+1],tt=F*(c[K+2]-c[$+2]-c[j+2]+c[q+2])+T*e[E+2],nt=k*(c[K]-c[$]-c[j]+c[q])+P*e[E],rt=k*(c[K+1]-c[$+1]-c[j+1]+c[q+1])+P*e[E+1],at=k*(c[K+2]-c[$+2]-c[j+2]+c[q+2])+P*e[E+2],J=o*Z+l*nt,Q=o*et+l*rt,V=o*tt+l*at,M&&(J=0>J?0:J>255?255:J,Q=0>Q?0:Q>255?255:Q,V=0>V?0:V>255?255:V),v[E]=~~J,v[E+1]=~~Q,v[E+2]=~~V,v[E+3]=e[E+3];e=v,it++}else for(F=r[0],S=r[g>>1],T=S-F;u>it;){for(v=new A(st),c=new C(h),E=0,L=0,f=m=d=0,x=0;t>x;x++,E+=4,L+=3)f+=e[E],m+=e[E+1],d+=e[E+2],c[L]=f,c[L+1]=m,c[L+2]=d;for(L=0,x=0,f=m=d=0,E=y+t;st>E;E+=4,L+=3,x++)x>=t&&(x=0,f=m=d=0),f+=e[E],m+=e[E+1],d+=e[E+2],c[L+y]=c[L]+f,c[L+y+1]=c[L+1]+m,c[L+y+2]=c[L+2]+d;for(x=0,N=0,O=0,E=0;st>E;E+=4,x++)x>=t&&(x=0,N++,O+=t),G=x+w,U=O+I,H=x+b,X=O+R,G=Y>G?Y:G,H=H>W?W:H,U=B>U?B:U,X=X>z?z:X,q=G+U,K=H+X,$=H+U,j=G+X,q=(q<<1)+q,$=($<<1)+$,j=(j<<1)+j,K=(K<<1)+K,Z=F*(c[K]-c[$]-c[j]+c[q])+T*e[E],et=F*(c[K+1]-c[$+1]-c[j+1]+c[q+1])+T*e[E+1],tt=F*(c[K+2]-c[$+2]-c[j+2]+c[q+2])+T*e[E+2],J=o*Z+l,Q=o*et+l,V=o*tt+l,M&&(J=0>J?0:J>255?255:J,Q=0>Q?0:Q>255?255:Q,V=0>V?0:V>255?255:V),v[E]=~~J,v[E+1]=~~Q,v[E+2]=~~V,v[E+3]=e[E+3];e=v,it++}return v}function d(e,t,n,r,a,i,s,o,l){var u,c,h,f,m,d,p,_,g,v,y,w,C,I,R,E,L,x,N,O,F,S,T,k,D,P,G,U=e.length,H=U>>2;for(u=[a,r],c=[s,i],D=[l,o],E=t-1,L=H-t,G=2;G--;){for(p=new A(U),f=u[G],m=c[G],h=f.length,d=m.length,P=D[G],_=new b(m),y=0;d>y;y+=2)_[y+1]*=t;if(M)for(w=0,C=0,g=0;U>g;g+=4,w++){for(w>=t&&(w=0,C+=t),S=0,T=0,k=0,y=0,v=0;h>y;y++,v+=2)I=w+_[v],R=C+_[v+1],I>=0&&E>=I&&R>=0&&L>=R&&(srcOff=I+R<<2,F=f[y],S+=e[srcOff]*F,T+=e[srcOff+1]*F,k+=e[srcOff+2]*F);x=P*S,N=P*T,O=P*k,x=0>x?0:x>255?255:x,N=0>N?0:N>255?255:N,O=0>O?0:O>255?255:O,p[g]=~~x,p[g+1]=~~N,p[g+2]=~~O,p[g+3]=e[g+3]}else for(w=0,C=0,g=0;U>g;g+=4,w++){for(w>=t&&(w=0,C+=t),S=0,T=0,k=0,y=0,v=0;h>y;y++,v+=2)I=w+_[v],R=C+_[v+1],I>=0&&E>=I&&R>=0&&L>=R&&(srcOff=I+R<<2,F=f[y],S+=e[srcOff]*F,T+=e[srcOff+1]*F,k+=e[srcOff+2]*F);x=P*S,N=P*T,O=P*k,p[g]=~~x,p[g+1]=~~N,p[g+2]=~~O,p[g+3]=e[g+3]}e=p}return p}var p=(e.CONSTANTS.SQRT2,e.CONSTANTS.toRad),_=(e.CONSTANTS.toDeg,Math.abs),g=Math.sqrt,v=Math.sin,y=Math.cos,w=e.Array32F,A=e.ImArray,C=e.Array32F,b=e.Array16I,M=(e.Array8U,e._notSupportClamp),I=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],R=e.ConvolutionMatrixFilter=e.Class(e.Filter,{name:"ConvolutionMatrixFilter",constructor:function(t,n,r){var a=this;a.$super("constructor"),a._coeff=new w([1,0]),t&&t.length?a.set(t,~~(g(t.length)+.5),n||1,r||0):(a._matrix=null,a._dim=0),a._matrix2=null,a._dim2=0,a._isGrad=!1,a._doIntegral=0,a._doSeparable=!1,e.useWebGL&&(a._webglInstance=e.WebGLConvolutionMatrixFilterInstance||null)},_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_webglInstance:null,dispose:function(){var e=this;return e.$super("dispose"),e._webglInstance=null,e._dim=null,e._dim2=null,e._matrix=null,e._matrix2=null,e._mat=null,e._mat2=null,e._coeff=null,e._isGrad=null,e._doIntegral=null,e._doSeparable=null,e._indices=null,e._indices2=null,e._indicesf=null,e._indicesf2=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_dim:e._dim,_dim2:e._dim2,_matrix:e._matrix,_matrix2:e._matrix2,_mat:e._mat,_mat2:e._mat2,_coeff:e._coeff,_isGrad:e._isGrad,_doIntegral:e._doIntegral,_doSeparable:e._doSeparable,_indices:e._indices,_indices2:e._indices2,_indicesf:e._indicesf,_indicesf2:e._indicesf2}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._dim=t._dim,n._dim2=t._dim2,n._matrix=t._matrix,n._matrix2=t._matrix2,n._mat=t._mat,n._mat2=t._mat2,n._coeff=t._coeff,n._isGrad=t._isGrad,n._doIntegral=t._doIntegral,n._doSeparable=t._doSeparable,n._indices=t._indices,n._indices2=t._indices2,n._indicesf=t._indicesf,n._indicesf2=t._indicesf2),n},lowPass:function(e){return e=e===t?3:e%2?e:e+1,this.set(c(e),e,1/(e*e),0),this._doIntegral=1,this},highPass:function(e,n){e=e===t?3:e%2?e:e+1,n=n===t?1:n;var r=e*e,a=-n/r,i=c(e,a,1+a);return this.set(i,e,1,0),this._doIntegral=1,this},glow:function(e,n){return e=e===t?.5:e,this.highPass(n,-e)},sharpen:function(e,n){return e=e===t?.5:e,this.highPass(n,e)},verticalBlur:function(e){return e=e===t?3:e%2?e:e+1,this.set(a(e),1,1/e,0),this._dim2=e,this._doIntegral=1,this},horizontalBlur:function(e){return e=e===t?3:e%2?e:e+1,this.set(a(e),e,1/e,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(e,n){n=n===t?3:n%2?n:n+1,e*=p;var r=y(e),a=-v(e),i=f(n,r,a,1/n);return this.set(i,n,1,0)},fastGauss:function(e,n){return n=n===t?3:n%2?n:n+1,e=~~(e||1),1>e?e=1:e>3&&(e=3),this.set(c(n),n,1/(n*n),0),this._doIntegral=e,this},binomialLowPass:function(e){e=e===t?3:e%2?e:e+1;var n=i(e),r=1<<e-1,a=1/r;this.set(n,e,a,a),this._matrix2=new w(n);var s=this._computeIndices(this._matrix2,this._dim2);return this._indices2=s[0],this._indicesf2=s[1],this._mat2=s[2],this._doSeparable=!0,this},binomialHighPass:function(e){e=e===t?3:e%2?e:e+1;var r=o(e);return this.set(n(c(e),new w(r.kernel),1,-1/r.sum),e,1,0)},prewittX:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,0);return this.set(n.kernel,e,1,0)},prewittY:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,1);return this.set(n.kernel,e,1,0)},prewittDirectional:function(e,r){r=r===t?3:r%2?r:r+1,e*=p;var a=y(e),i=v(e),s=u(r,0),o=u(r,1);return this.set(n(new w(s.kernel),new w(o.kernel),a,i),r,1,0)},prewitt:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,0),r=u(e,1);this.set(n.kernel,e,1,0),this._isGrad=!0,this._matrix2=new w(r.kernel);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this},sobelX:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,0);return this.set(n.kernel,e,1,0)},sobelY:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,1);return this.set(n.kernel,e,1,0)},sobelDirectional:function(e,r){r=r===t?3:r%2?r:r+1,e*=p;var a=y(e),i=v(e),s=l(r,0),o=l(r,1);return this.set(n(new w(s.kernel),new w(o.kernel),a,i),r,1,0)},sobel:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,0),r=l(e,1);this.set(n.kernel,e,1,0),this._matrix2=new w(r.kernel);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this._isGrad=!0,this},laplace:function(e){e=e===t?3:e%2?e:e+1;var n=e*e,r=c(e,-1,n-1);return this.set(r,e,1,0),this._doIntegral=1,this},emboss:function(e,n,r){r=r===t?3:r%2?r:r+1,e=e===t?-.25*Math.PI:e*p,n=n||1;var a=n*y(e),i=-n*v(e),s=h(r,a,i,1);return this.set(s,r,1,0)},edges:function(e){return e=e||1,this.set([0,e,0,e,-4*e,e,0,e,0],3,1,0)},set:function(e,t,n,r){var a=this;a._matrix2=null,a._dim2=0,a._indices2=a._indicesf2=null,a._mat2=null,a._isGrad=!1,a._doIntegral=0,a._doSeparable=!1,a._matrix=new w(e),a._dim=t,a._coeff[0]=n||1,a._coeff[1]=r||0;var i=a._computeIndices(a._matrix,a._dim);return a._indices=i[0],a._indicesf=i[1],a._mat=i[2],a},_computeIndices:function(e,t){var n,r,a,i=[],s=[],o=[],l=e.length,u=t,c=u>>1;for(r=0,a=0,n=0;l>n;)s.push(r-c),s.push(a-c),e[n]&&(i.push(r-c),i.push(a-c),o.push(e[n])),n++,r++,r>=u&&(r=0,a++);return[new b(i),new b(s),new w(o)]},reset:function(){var e=this;return e._matrix=e._matrix2=null,e._mat=e._mat2=null,e._dim=e._dim2=0,e._indices=e._indices2=e._indicesf=e._indicesf2=null,e._isGrad=!1,e._doIntegral=0,e._doSeparable=!1,e},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(e,t){return this.set(e,t)},_apply:function(e,t,n){var r=this;if(!r._isOn||!r._matrix)return e;if(r._doIntegral)return r._matrix2?m(e,t,n,r._matrix,r._matrix2,r._dim,r._dim2,r._coeff[0],r._coeff[1],r._doIntegral):m(e,t,n,r._matrix,null,r._dim,r._dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return d(e,t,n,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,i,s,o,l,u,c,h,f,p,g,v,y,w,C,I,R,E,L,x,N,O,F=e.length,S=F>>2,T=new A(F),k=t-1,D=S-t,P=r._coeff[0],G=r._coeff[1],U=r._matrix,H=r._matrix2,X=r._isGrad;if(H){for(x=r._indicesf.length,O=new b(r._indicesf),u=0;x>u;u+=2)O[u+1]*=t;for(N=U.length,c=0,h=0,o=0;F>o;o+=4,c++){for(c>=t&&(c=0,h+=t),v=0,y=0,w=0,C=0,I=0,R=0,u=0,l=0;N>u;u++,l+=2)f=c+O[l],p=h+O[l+1],f>=0&&k>=f&&p>=0&&D>=p&&(g=f+p<<2,E=U[u],v+=e[g]*E,y+=e[g+1]*E,w+=e[g+2]*E,L=H[u],C+=e[g]*L,I+=e[g+1]*L,R+=e[g+2]*L);X?(a=_(v)+_(C),i=_(y)+_(I),s=_(w)+_(R)):(a=P*v+G*C,i=P*y+G*I,s=P*w+G*R),M&&(a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s),T[o]=~~a,T[o+1]=~~i,T[o+2]=~~s,T[o+3]=e[o+3]}}else{for(x=r._indices.length,O=new b(r._indices),u=0;x>u;u+=2)O[u+1]*=t;for(U=r._mat,N=U.length,c=0,h=0,o=0;F>o;o+=4,c++){for(c>=t&&(c=0,h+=t),v=0,y=0,w=0,u=0,l=0;N>u;u++,l+=2)f=c+O[l],p=h+O[l+1],f>=0&&k>=f&&p>=0&&D>=p&&(g=f+p<<2,E=U[u],v+=e[g]*E,y+=e[g+1]*E,w+=e[g+2]*E);a=P*v+G,i=P*y+G,s=P*w+G,M&&(a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s),T[o]=~~a,T[o+1]=~~i,T[o+2]=~~s,T[o+3]=e[o+3]}}return T},canRun:function(){return this._isOn&&this._matrix}});R.prototype.bump=R.prototype.emboss,R.prototype.boxBlur=R.prototype.lowPass,R.prototype.gaussBlur=R.prototype.binomialLowPass,R.prototype.gradX=R.prototype.prewittX,R.prototype.gradY=R.prototype.prewittY,R.prototype.gradDirectional=R.prototype.prewittDirectional,R.prototype.grad=R.prototype.prewitt}(FILTER),!function(e){"use strict";{var t,n=e.ImArray,r=e.Array8U,a=e.Array32I,i=Math.sqrt,s=function(e){var t,n=e*e,a=new r(n);for(t=0;n>t;t++)a[t]=1;return a},o=s(3);e.MorphologicalFilter=e.Class(e.Filter,{name:"MorphologicalFilter",constructor:function(){var e=this;e.$super("constructor"),e._filterName=null,e._filter=null,e._dim=0,e._structureElement=null,e._indices=null},_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var e=this;return e.$super("dispose"),e._filterName=null,e._filter=null,e._dim=null,e._structureElement=null,e._indices=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_filterName:e._filterName,_dim:e._dim,_structureElement:e._structureElement,_indices:e._indices}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._dim=n._dim,r._structureElement=n._structureElement,r._indices=n._indices,r._filterName=n._filterName,r._filterName&&t[r._filterName]&&(r._filter=t[r._filterName])),r},erode:function(e){return this.set(e,"erode")},dilate:function(e){return this.set(e,"dilate")},opening:function(e){return this.set(e,"open")},closing:function(e){return this.set(e,"close")},set:function(e,n){var l=this;l._filterName=n,l._filter=t[n],e&&e.length?(l._structureElement=new r(e),l._dim=~~(i(l._structureElement.length)+.5)):e&&e===e-0?(l._structureElement=s(e),l._dim=e):(l._structureElement=o,l._dim=3);var u,c,h,f=[],e=l._structureElement,m=e.length,d=l._dim,p=d>>1;for(c=0,h=0,u=0;m>u;)e[u]&&(f.push(c-p),f.push(h-p)),u++,c++,c>=d&&(c=0,h++);return l._indices=new a(f),l},reset:function(){var e=this;return e._filterName=null,e._filter=null,e._dim=0,e._structureElement=null,e._indices=null,e},_apply:function(e,t,n){var r=this;return r._isOn&&r._dim&&r._filter?r._filter(r,e,t,n):e},canRun:function(){return this._isOn&&this._dim&&this._filter}})}t={dilate:function(e,t,r){var i,s,o,l,u,c,h,f,m,d,p,_,g,v,y=e._structureElement,w=(y.length,e._dim,new a(e._indices)),A=t.length,C=A>>2,b=new n(A),M=w.length,I=M>>1,R=r-1,E=C-r;for(o=0;M>o;o+=2)w[o+1]*=r;for(l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=0,g=0,v=0,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,m=t[f],d=t[f+1],p=t[f+2],m>_&&(_=m),d>g&&(g=d),p>v&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}return b},erode:function(e,t,r){var i,s,o,l,u,c,h,f,m,d,p,_,g,v,y=e._structureElement,w=(y.length,e._dim,new a(e._indices)),A=t.length,C=A>>2,b=new n(A),M=w.length,I=M>>1,R=r-1,E=C-r;for(o=0;M>o;o+=2)w[o+1]*=r;for(l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,m=t[f],d=t[f+1],p=t[f+2],_>m&&(_=m),g>d&&(g=d),v>p&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}return b},open:function(e,t,r){var i,s,o,l,u,c,h,f,m,d,p,_,g,v,y=e._structureElement,w=(y.length,e._dim,new a(e._indices)),A=t.length,C=A>>2,b=new n(A),M=w.length,I=M>>1,R=r-1,E=C-r;for(o=0;M>o;o+=2)w[o+1]*=r;for(l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,m=t[f],d=t[f+1],p=t[f+2],_>m&&(_=m),g>d&&(g=d),v>p&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}for(t=b,b=new n(A),l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,m=t[f],d=t[f+1],p=t[f+2],_>m&&(_=m),g>d&&(g=d),v>p&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}return b},close:function(e,t,r){var i,s,o,l,u,c,h,f,m,d,p,_,g,v,y=e._structureElement,w=(y.length,e._dim,new a(e._indices)),A=t.length,C=A>>2,b=new n(A),M=w.length,I=M>>1,R=r-1,E=C-r;for(o=0;M>o;o+=2)w[o+1]*=r;for(l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,m=t[f],d=t[f+1],p=t[f+2],_>m&&(_=m),g>d&&(g=d),v>p&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}for(t=b,b=new n(A),l=0,u=0,i=0;A>i;i+=4,l++){for(l>=r&&(l=0,u+=r),_=255,g=255,v=255,s=0;I>s;s+=2)c=l+w[s],h=u+w[s+1],c>=0&&R>=c&&h>=0&&E>=h&&(f=c+h<<2,m=t[f],d=t[f+1],p=t[f+2],_>m&&(_=m),g>d&&(g=d),v>p&&(v=p));b[i]=_,b[i+1]=g,b[i+2]=v,b[i+3]=t[i+3]}return b}}}(FILTER),!function(e,t){"use strict";var n,r=e.ImArray,a=e.Array32I,i=(Math.min,Math.max,e.StatisticalFilter=e.Class(e.Filter,{name:"StatisticalFilter",constructor:function(){var e=this;e.$super("constructor"),e._dim=0,e._indices=null,e._filterName=null,e._filter=null},_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var e=this;return e.$super("dispose"),e._dim=null,e._indices=null,e._filter=null,e._filterName=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_filterName:e._filterName,_dim:e._dim,_indices:e._indices}}},unserialize:function(e){var t,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,t=e.params,r._dim=t._dim,r._indices=t._indices,r._filterName=t._filterName,r._filterName&&n[r._filterName]&&(r._filter=n[r._filterName])),r},median:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"median")},minimum:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"minimum")},maximum:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"maximum")},set:function(e,t){var r=this;r._filterName=t,r._filter=n[t],r._dim=e;var i,s,o,l=[],u=e*e,c=e,h=c>>1;for(s=0,o=0,i=0;u>i;)l.push(s-h),l.push(o-h),i++,s++,s>=c&&(s=0,o++);return r._indices=new a(l),r},reset:function(){var e=this;return e._filterName=null,e._filter=null,e._dim=0,e._indices=null,e},_apply:function(e,t,n){var r=this;return r._isOn&&r._dim?r._filter(r,e,t,n):e},canRun:function(){return this._isOn&&this._dim}}));i.prototype.erode=i.prototype.minimum,i.prototype.dilate=i.prototype.maximum,n={median:function(e,t,n){var i,s,o,l,u,c,h,f,m,d,p,_,g,v,y,w,A,C,b=e._dim,M=b*b,I=new a(e._indices),R=t.length,E=R>>2,L=new r(R),x=M<<1,N=n-1,O=E-n;for(f=[],m=[],d=[],s=0;x>s;s+=2)I[s+1]*=n;for(i=0,o=0,l=0;R>i;){for(f.length=0,m.length=0,d.length=0,s=0;x>s;)u=o+I[s],c=l+I[s+1],u>=0&&N>=u&&c>=0&&O>=c&&(h=u+c<<2,p=t[h],_=t[h+1],g=t[h+2],f.push(p),m.push(_),d.push(g)),s+=2;f.sort(),m.sort(),d.sort(),A=f.length,C=A>>1,v=A%2?f[C+1]:~~(.5*(f[C]+f[C+1])),A=m.length,C=A>>1,y=A%2?m[C+1]:~~(.5*(m[C]+m[C+1])),A=d.length,C=A>>1,w=A%2?d[C+1]:~~(.5*(d[C]+d[C+1])),L[i]=v,L[i+1]=y,L[i+2]=w,L[i+3]=t[i+3],i+=4,o++,o>=n&&(o=0,l+=n)}return L},maximum:function(e,t,n){var i,s,o,l,u,c,h,f,m,d,p,_,g,v=e._dim,y=v*v,w=new a(e._indices),A=t.length,C=A>>2,b=new r(A),M=y<<1,I=n-1,R=C-n;for(s=0;M>s;s+=2)w[s+1]*=n;for(i=0,o=0,l=0;A>i;){for(p=0,_=0,g=0,s=0;M>s;)u=o+w[s],c=l+w[s+1],u>=0&&I>=u&&c>=0&&R>=c&&(h=u+c<<2,f=t[h],m=t[h+1],d=t[h+2],f>p&&(p=f),m>_&&(_=m),d>g&&(g=d)),s+=2;b[i]=p,b[i+1]=_,b[i+2]=g,b[i+3]=t[i+3],i+=4,o++,o>=n&&(o=0,l+=n)}return b},minimum:function(e,t,n){var i,s,o,l,u,c,h,f,m,d,p,_,g,v=e._dim,y=v*v,w=new a(e._indices),A=t.length,C=A>>2,b=new r(A),M=y<<1,I=n-1,R=C-n;for(s=0;M>s;s+=2)w[s+1]*=n;for(i=0,o=0,l=0;A>i;){for(p=255,_=255,g=255,s=0;M>s;)u=o+w[s],c=l+w[s+1],u>=0&&I>=u&&c>=0&&R>=c&&(h=u+c<<2,f=t[h],m=t[h+1],d=t[h+2],p>f&&(p=f),_>m&&(_=m),g>d&&(g=d)),s+=2;b[i]=p,b[i+1]=_,b[i+2]=g,b[i+3]=t[i+3],i+=4,o++,o>=n&&(o=0,l+=n)}return b}}}(FILTER),exports.FILTER});
/**
*
*   FILTER.js Codecs
*   @version: 0.7.1
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (File Codecs)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,r,a){"use strict";function i(e,t,r,a,i){var n;return e?{file:__filename,path:__dirname}:t?{file:n=self.location.href,path:n.split("/").slice(0,-1).join("/")}:r&&i&&i.uri?{file:n=i.uri,path:n.split("/").slice(0,-1).join("/")}:a&&(n=document.getElementsByTagName("script"))&&n.length?{file:n=n[n.length-1].src,path:n.split("/").slice(0,-1).join("/")}:{file:null,path:null}}function n(e,t,r,a,i){var n,s=e.length,o=new Array(s);for(n=0;s>n;n++)o[n]=1===a?r[e[n]]||i(t[n]):2===a?i(e[n]):r[e[n]];return o}function s(e,t,r,a,i,n){var s,o,h,c,f,d,l,u=r.length;if(n){for(s=0;u>s;s++)r[s]in e||importScripts(t+a[s]);return i()}d=document.getElementsByTagName("head")[0],l=document.createElement("a"),o=/^\./,h=0,s=0,c=function(e,r){var a=0,i=document.createElement("script");i.type="text/javascript",i.language="javascript",i.onload=i.onreadystatechange=function(){a||i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(a=1,i.onload=i.onreadystatechange=null,r(),d.removeChild(i),i=null)},o.test(e)&&(l.href=t+e,e=l.protocol+"//"+l.host+l.pathname+l.search+l.hash),i.src=e,d.appendChild(i)},f=function(){r[s]in e?++s>=u?i():r[s]in e?f():c(a[s],f):++h<30?setTimeout(f,30):(h=0,s++,f())};for(;u>s&&r[s]in e;)s++;u>s?c(a[s],f):i()}r=r||[[],[]];var o,h,c,f="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),d=!f&&"undefined"!=typeof navigator,l=!f&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,u="function"==typeof define&&define.amd,p=f&&"object"==typeof module&&module.exports,g=l?self:e,m=i(f,l,u,d),v=[].concat(r[0]),y=[].concat(r[1]),b=v.length,w=/\.js$/i;if(p)module.$deps=module.$deps||{},module.exports=module.$deps[t]=a.apply(e,[{NODE:module}].concat(n(v,y,module.$deps,1,require)))||1;else if(u&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)){if(!require.defined(t)){for(c={},h=0;b>h;h++)require.specified(v[h])||(c[v[h]]=y[h].replace(w,""));require.config({paths:c}),define(t,["require","exports","module"].concat(v),function(t,r,i){return a.apply(e,[{AMD:i}].concat(n(v,y,arguments,2,t)))})}}else t in g||s(g,m.path+"/",v,y,function(){o=a.apply(e,[{}].concat(n(v,y,g))),u&&define(t,["require"],function(){return o})},l)}(this,"FILTER_CODECS",[["FILTER"],["./filter.js"]],function(e,t){return e.FILTER_CODECS=t,!function(e){"use strict";var t=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(e){var t=this.buffer,r=t?t.byteLength:0;if(r>e)return t;for(var a=512;e>a;)a<<=1;for(var i=new Uint8Array(a),n=0;r>n;++n)i[n]=t[n];return this.buffer=i},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var t=this.pos;if(e){this.ensureBuffer(t+e);for(var r=t+e;!this.eof&&this.bufferLength<r;)this.readBlock();var a=this.bufferLength;r>a&&(r=a)}else{for(;!this.eof;)this.readBlock();var r=this.bufferLength}return this.pos=r,this.buffer.subarray(t,r)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,t,r){for(var a=e+t;this.bufferLength<=a&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,t,r)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},e}(),r=function(){function e(e){throw new Error(e)}function r(r){var a=0,i=r[a++],n=r[a++];(-1==i||-1==n)&&e("Invalid header in flate stream"),8!=(15&i)&&e("Unknown compression method in flate stream"),((i<<8)+n)%31!=0&&e("Bad FCHECK in flate stream"),32&n&&e("FDICT bit set in flate stream"),this.bytes=r,this.bytesPos=a,this.codeSize=0,this.codeBuf=0,t.call(this)}var a=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),n=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),s=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],o=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];return r.prototype=Object.create(t.prototype),r.prototype.getBits=function(t){for(var r,a=this.codeSize,i=this.codeBuf,n=this.bytes,s=this.bytesPos;t>a;)"undefined"==typeof(r=n[s++])&&e("Bad encoding in flate stream"),i|=r<<a,a+=8;return r=i&(1<<t)-1,this.codeBuf=i>>t,this.codeSize=a-=t,this.bytesPos=s,r},r.prototype.getCode=function(t){for(var r=t[0],a=t[1],i=this.codeSize,n=this.codeBuf,s=this.bytes,o=this.bytesPos;a>i;){var h;"undefined"==typeof(h=s[o++])&&e("Bad encoding in flate stream"),n|=h<<i,i+=8}var c=r[n&(1<<a)-1],f=c>>16,d=65535&c;return(0==i||f>i||0==f)&&e("Bad encoding in flate stream"),this.codeBuf=n>>f,this.codeSize=i-f,this.bytesPos=o,d},r.prototype.generateHuffmanTable=function(e){for(var t=e.length,r=0,a=0;t>a;++a)e[a]>r&&(r=e[a]);for(var i=1<<r,n=new Uint32Array(i),s=1,o=0,h=2;r>=s;++s,o<<=1,h<<=1)for(var c=0;t>c;++c)if(e[c]==s){for(var f=0,d=o,a=0;s>a;++a)f=f<<1|1&d,d>>=1;for(var a=f;i>a;a+=h)n[a]=s<<16|c;++o}return[n,r]},r.prototype.readBlock=function(){function t(e,t,r,a,i){for(var n=e.getBits(r)+a;n-->0;)t[B++]=i}var r=this.getBits(3);if(1&r&&(this.eof=!0),r>>=1,0==r){var h,c=this.bytes,f=this.bytesPos;"undefined"==typeof(h=c[f++])&&e("Bad block header in flate stream");var d=h;"undefined"==typeof(h=c[f++])&&e("Bad block header in flate stream"),d|=h<<8,"undefined"==typeof(h=c[f++])&&e("Bad block header in flate stream");var l=h;"undefined"==typeof(h=c[f++])&&e("Bad block header in flate stream"),l|=h<<8,l!=(65535&~d)&&e("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var u=this.bufferLength,p=this.ensureBuffer(u+d),g=u+d;this.bufferLength=g;for(var m=u;g>m;++m){if("undefined"==typeof(h=c[f++])){this.eof=!0;break}p[m]=h}return void(this.bytesPos=f)}var v,y;if(1==r)v=s,y=o;else if(2==r){for(var b=this.getBits(5)+257,w=this.getBits(5)+1,k=this.getBits(4)+4,U=Array(a.length),B=0;k>B;)U[a[B++]]=this.getBits(3);for(var C=this.generateHuffmanTable(U),A=0,B=0,I=b+w,x=new Array(I);I>B;){var T=this.getCode(C);16==T?t(this,x,2,3,A):17==T?t(this,x,3,3,A=0):18==T?t(this,x,7,11,A=0):x[B++]=A=T}v=this.generateHuffmanTable(x.slice(0,b)),y=this.generateHuffmanTable(x.slice(b,I))}else e("Unknown block type in flate stream");for(var p=this.buffer,L=p?p.length:0,P=this.bufferLength;;){var S=this.getCode(v);if(256>S)P+1>=L&&(p=this.ensureBuffer(P+1),L=p.length),p[P++]=S;else{if(256==S)return void(this.bufferLength=P);S-=257,S=i[S];var E=S>>16;E>0&&(E=this.getBits(E));var A=(65535&S)+E;S=this.getCode(y),S=n[S],E=S>>16,E>0&&(E=this.getBits(E));var G=(65535&S)+E;P+A>=L&&(p=this.ensureBuffer(P+A),L=p.length);for(var _=0;A>_;++_,++P)p[P]=p[P-G]}}},r}();e.Utils.DecodeStream=t,e.Utils.FlateStream=r}(t),!function(e){"use strict";function t(e){var t,r,a,i,n,s,o,h,c,f,d,l,u,p;for(this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},n=null;;){switch(t=this.readUInt32(),c=function(){var e,t;for(t=[],s=e=0;4>e;s=++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(t);break;case"fcTL":n&&this.animation.frames.push(n),this.pos+=4,n={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},i=this.readUInt16(),a=this.readUInt16()||100,n.delay=1e3*i/a,n.disposeOp=this.data[this.pos++],n.blendOp=this.data[this.pos++],n.data=[];break;case"IDAT":case"fdAT":for("fdAT"===c&&(this.pos+=4,t-=4),e=(null!=n?n.data:void 0)||this.imgData,s=l=0;t>=0?t>l:l>t;s=t>=0?++l:--l)e.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(this.transparency.indexed=this.read(t),f=255-this.transparency.indexed.length,f>0)for(s=u=0;f>=0?f>u:u>f;s=f>=0?++u:--u)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":d=this.read(t),o=d.indexOf(0),h=String.fromCharCode.apply(String,d.slice(0,o)),this.text[h]=String.fromCharCode.apply(String,d.slice(o+1));break;case"IEND":return n&&this.animation.frames.push(n),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=4===(p=this.colorType)||6===p,r=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*r,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=t}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}var r,a,i,n,s;n=0,i=1,s=2,a=0,r=1,t.prototype.read=function(e){var t,r,a;for(a=[],t=r=0;e>=0?e>r:r>e;t=e>=0?++r:--r)a.push(this.data[this.pos++]);return a},t.prototype.readUInt32=function(){var e,t,r,a;return e=this.data[this.pos++]<<24,t=this.data[this.pos++]<<16,r=this.data[this.pos++]<<8,a=this.data[this.pos++],e|t|r|a},t.prototype.readUInt16=function(){var e,t;return e=this.data[this.pos++]<<8,t=this.data[this.pos++],e|t},t.prototype.decodePixels=function(t){var r,a,i,n,s,o,h,c,f,d,l,u,p,g,m,v,y,b,w,k,U,B,C;if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);for(t=new e.Utils.FlateStream(t),t=t.getBytes(),u=this.pixelBitlength/8,v=u*this.width,p=new Uint8Array(v*this.height),o=t.length,m=0,g=0,a=0;o>g;){switch(t[g++]){case 0:for(n=w=0;v>w;n=w+=1)p[a++]=t[g++];break;case 1:for(n=k=0;v>k;n=k+=1)r=t[g++],s=u>n?0:p[a-u],p[a++]=(r+s)%256;break;case 2:for(n=U=0;v>U;n=U+=1)r=t[g++],i=(n-n%u)/u,y=m&&p[(m-1)*v+i*u+n%u],p[a++]=(y+r)%256;break;case 3:for(n=B=0;v>B;n=B+=1)r=t[g++],i=(n-n%u)/u,s=u>n?0:p[a-u],y=m&&p[(m-1)*v+i*u+n%u],p[a++]=(r+Math.floor((s+y)/2))%256;break;case 4:for(n=C=0;v>C;n=C+=1)r=t[g++],i=(n-n%u)/u,s=u>n?0:p[a-u],0===m?y=b=0:(y=p[(m-1)*v+i*u+n%u],b=i&&p[(m-1)*v+(i-1)*u+n%u]),h=s+y-b,c=Math.abs(h-s),d=Math.abs(h-y),l=Math.abs(h-b),f=d>=c&&l>=c?s:l>=d?y:b,p[a++]=(r+f)%256;break;default:throw new Error("Invalid filter algorithm: "+t[g-1])}m++}return p},t.prototype.decodePalette=function(){var e,t,r,a,i,n,s,o,h,c;for(a=this.palette,s=this.transparency.indexed||[],n=new Uint8Array((s.length||0)+a.length),i=0,r=a.length,e=0,t=o=0,h=a.length;h>o;t=o+=3)n[i++]=a[t],n[i++]=a[t+1],n[i++]=a[t+2],n[i++]=null!=(c=s[e++])?c:255;return n},t.prototype.copyToImageData=function(e,t){var r,a,i,n,s,o,h,c,f,d,l;if(a=this.colors,f=null,r=this.hasAlphaChannel,this.palette.length&&(f=null!=(l=this._decodedPalette)?l:this._decodedPalette=this.decodePalette(),a=4,r=!0),i=e.data||e,c=i.length,s=f||t,n=o=0,1===a)for(;c>n;)h=f?4*t[n/4]:o,d=s[h++],i[n++]=d,i[n++]=d,i[n++]=d,i[n++]=r?s[h++]:255,o=h;else for(;c>n;)h=f?4*t[n/4]:o,i[n++]=s[h++],i[n++]=s[h++],i[n++]=s[h++],i[n++]=r?s[h++]:255,o=h},t.prototype.decode=function(){var e;return e=new Uint8Array(this.width*this.height*4),this.copyToImageData(e,this.decodePixels()),e},e.Codec.PNG={encoder:e.NotImplemented("PNG.encoder"),decoder:function(e){var r=new t(new Uint8Array(e)),a={width:r.width,height:r.height,data:r.decode()};return a}}}(t),!function(e){"use strict";function t(){}function r(e,t){for(var r,a,i=0,n=[],s=16;s>0&&!e[s-1];)s--;n.push({children:[],index:0});var o,h=n[0];for(r=0;s>r;r++){for(a=0;a<e[r];a++){for(h=n.pop(),h.children[h.index]=t[i];h.index>0;)h=n.pop();for(h.index++,n.push(h);n.length<=r;)n.push(o={children:[],index:0}),h.children[h.index]=o.children,h=o;i++}s>r+1&&(n.push(o={children:[],index:0}),h.children[h.index]=o.children,h=o)}return n[0].children}function a(e,t,r,a,i,n,o,h,c){function f(){if(E>0)return E--,S>>E&1;if(S=e[t++],255==S){var r=e[t++];if(r)throw"unexpected marker: "+(S<<8|r).toString(16)}return E=7,S>>>7}function d(e){for(var t,r=e;null!==(t=f());){if(r=r[t],"number"==typeof r)return r;if("object"!=typeof r)throw"invalid huffman sequence"}return null}function l(e){for(var t=0;e>0;){var r=f();if(null===r)return;t=t<<1|r,e--}return t}function u(e){var t=l(e);return t>=1<<e-1?t:t+(-1<<e)+1}function p(e,t){var r=d(e.huffmanTableDC),a=0===r?0:u(r);t[0]=e.pred+=a;for(var i=1;64>i;){var n=d(e.huffmanTableAC),o=15&n,h=n>>4;if(0!==o){i+=h;var c=s[i];t[c]=u(o),i++}else{if(15>h)break;i+=16}}}function g(e,t){var r=d(e.huffmanTableDC),a=0===r?0:u(r)<<c;t[0]=e.pred+=a}function m(e,t){t[0]|=f()<<c}function v(e,t){if(G>0)return void G--;for(var r=n,a=o;a>=r;){var i=d(e.huffmanTableAC),h=15&i,f=i>>4;if(0!==h){r+=f;var p=s[r];t[p]=u(h)*(1<<c),r++}else{if(15>f){G=l(f)+(1<<f)-1;break}r+=16}}}function y(e,t){for(var r=n,a=o,i=0;a>=r;){var h=s[r];switch(_){case 0:var p=d(e.huffmanTableAC),g=15&p,i=p>>4;if(0===g)15>i?(G=l(i)+(1<<i),_=4):(i=16,_=1);else{if(1!==g)throw"invalid ACn encoding";k=u(g),_=i?2:3}continue;case 1:case 2:t[h]?t[h]+=f()<<c:(i--,0===i&&(_=2==_?3:0));break;case 3:t[h]?t[h]+=f()<<c:(t[h]=k<<c,_=0);break;case 4:t[h]&&(t[h]+=f()<<c)}r++}4===_&&(G--,0===G&&(_=0))}function b(e,t,r,a,i){var n=r/T|0,s=r%T,o=n*e.v+a,h=s*e.h+i;t(e,e.blocks[o][h])}function w(e,t,r){var a=r/e.blocksPerLine|0,i=r%e.blocksPerLine;t(e,e.blocks[a][i])}var k,U,B,C,A,I,x,T=(r.precision,r.samplesPerLine,r.scanLines,r.mcusPerLine),L=r.progressive,P=(r.maxH,r.maxV,t),S=0,E=0,G=0,_=0,z=a.length;x=L?0===n?0===h?g:m:0===h?v:y:p;var D,M,R=0;M=1==z?a[0].blocksPerLine*a[0].blocksPerColumn:T*r.mcusPerColumn,i||(i=M);for(var F,N;M>R;){for(B=0;z>B;B++)a[B].pred=0;if(G=0,1==z)for(U=a[0],I=0;i>I;I++)w(U,x,R),R++;else for(I=0;i>I;I++){for(B=0;z>B;B++)for(U=a[B],F=U.h,N=U.v,C=0;N>C;C++)for(A=0;F>A;A++)b(U,x,R,C,A);if(R++,R===M)break}if(E=0,D=e[t]<<8|e[t+1],65280>D)throw"marker was not found";if(!(D>=65488&&65495>=D))break;t+=2}return t-P}function i(e,t){function r(e,r,a){var i,n,s,g,m,v,y,b,w,k,U=t.quantizationTable,B=a;for(k=0;64>k;k++)B[k]=e[k]*U[k];for(k=0;8>k;++k){var C=8*k;0!=B[1+C]||0!=B[2+C]||0!=B[3+C]||0!=B[4+C]||0!=B[5+C]||0!=B[6+C]||0!=B[7+C]?(i=u*B[0+C]+128>>8,n=u*B[4+C]+128>>8,s=B[2+C],g=B[6+C],m=p*(B[1+C]-B[7+C])+128>>8,b=p*(B[1+C]+B[7+C])+128>>8,v=B[3+C]<<4,y=B[5+C]<<4,w=i-n+1>>1,i=i+n+1>>1,n=w,w=s*l+g*d+128>>8,s=s*d-g*l+128>>8,g=w,w=m-y+1>>1,m=m+y+1>>1,y=w,w=b+v+1>>1,v=b-v+1>>1,b=w,w=i-g+1>>1,i=i+g+1>>1,g=w,w=n-s+1>>1,n=n+s+1>>1,s=w,w=m*f+b*c+2048>>12,m=m*c-b*f+2048>>12,b=w,w=v*h+y*o+2048>>12,v=v*o-y*h+2048>>12,y=w,B[0+C]=i+b,B[7+C]=i-b,B[1+C]=n+y,B[6+C]=n-y,B[2+C]=s+v,B[5+C]=s-v,B[3+C]=g+m,B[4+C]=g-m):(w=u*B[0+C]+512>>10,B[0+C]=w,B[1+C]=w,B[2+C]=w,B[3+C]=w,B[4+C]=w,B[5+C]=w,B[6+C]=w,B[7+C]=w)}for(k=0;8>k;++k){var A=k;0!=B[8+A]||0!=B[16+A]||0!=B[24+A]||0!=B[32+A]||0!=B[40+A]||0!=B[48+A]||0!=B[56+A]?(i=u*B[0+A]+2048>>12,n=u*B[32+A]+2048>>12,s=B[16+A],g=B[48+A],m=p*(B[8+A]-B[56+A])+2048>>12,b=p*(B[8+A]+B[56+A])+2048>>12,v=B[24+A],y=B[40+A],w=i-n+1>>1,i=i+n+1>>1,n=w,w=s*l+g*d+2048>>12,s=s*d-g*l+2048>>12,g=w,w=m-y+1>>1,m=m+y+1>>1,y=w,w=b+v+1>>1,v=b-v+1>>1,b=w,w=i-g+1>>1,i=i+g+1>>1,g=w,w=n-s+1>>1,n=n+s+1>>1,s=w,w=m*f+b*c+2048>>12,m=m*c-b*f+2048>>12,b=w,w=v*h+y*o+2048>>12,v=v*o-y*h+2048>>12,y=w,B[0+A]=i+b,B[56+A]=i-b,B[8+A]=n+y,B[48+A]=n-y,B[16+A]=s+v,B[40+A]=s-v,B[24+A]=g+m,B[32+A]=g-m):(w=u*a[k+0]+8192>>14,B[0+A]=w,B[8+A]=w,B[16+A]=w,B[24+A]=w,B[32+A]=w,B[40+A]=w,B[48+A]=w,B[56+A]=w)}for(k=0;64>k;++k){var I=128+(B[k]+8>>4);r[k]=0>I?0:I>255?255:I}}for(var a,i,n=[],s=t.blocksPerLine,g=t.blocksPerColumn,m=s<<3,v=new Int32Array(64),y=new Uint8Array(64),b=0;g>b;b++){var w=b<<3;for(a=0;8>a;a++)n.push(new Uint8Array(m));for(var k=0;s>k;k++){r(t.blocks[b][k],y,v);var U=0,B=k<<3;for(i=0;8>i;i++){var C=n[w+i];for(a=0;8>a;a++)C[B+a]=y[U++]}}}return n}function n(e){return 0>e?0:e>255?255:e}var s=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),o=4017,h=799,c=3406,f=2276,d=1567,l=3784,u=5793,p=2896;t.prototype={parse:function(e){function t(){var t=e[f]<<8|e[f+1];return f+=2,t}function n(){var r=t(),a=e.subarray(f,f+r-2);return f+=a.length,a}function o(e){var t,r,a=0,i=0;for(r in e.components)e.components.hasOwnProperty(r)&&(t=e.components[r],a<t.h&&(a=t.h),i<t.v&&(i=t.v));var n=Math.ceil(e.samplesPerLine/8/a),s=Math.ceil(e.scanLines/8/i);for(r in e.components)if(e.components.hasOwnProperty(r)){t=e.components[r];for(var o=Math.ceil(Math.ceil(e.samplesPerLine/8)*t.h/a),h=Math.ceil(Math.ceil(e.scanLines/8)*t.v/i),c=n*t.h,f=s*t.v,d=[],l=0;f>l;l++){for(var u=[],p=0;c>p;p++)u.push(new Int32Array(64));d.push(u)}t.blocksPerLine=o,t.blocksPerColumn=h,t.blocks=d}e.maxH=a,e.maxV=i,e.mcusPerLine=n,e.mcusPerColumn=s}var h,c,f=0,d=(e.length,null),l=null,u=[],p=[],g=[],m=[],v=t();if(65496!=v)throw"SOI not found";for(v=t();65497!=v;){var y,b;switch(v){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=n();65504===v&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(d={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])}),65518===v&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&0===w[5]&&(l={version:w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var k=t(),U=k+f-2;U>f;){var B=e[f++],C=new Int32Array(64);if(B>>4===0)for(b=0;64>b;b++){var A=s[b];C[A]=e[f++]}else{if(B>>4!==1)throw"DQT: invalid table spec";for(b=0;64>b;b++){var A=s[b];C[A]=t()}}u[15&B]=C}break;case 65472:case 65473:case 65474:t(),h={},h.extended=65473===v,h.progressive=65474===v,h.precision=e[f++],h.scanLines=t(),h.samplesPerLine=t(),h.components={},h.componentsOrder=[];var I,x=e[f++];for(y=0;x>y;y++){I=e[f];var T=e[f+1]>>4,L=15&e[f+1],P=e[f+2];h.componentsOrder.push(I),h.components[I]={h:T,v:L,quantizationIdx:P},f+=3}o(h),p.push(h);break;case 65476:var S=t();for(y=2;S>y;){var E=e[f++],G=new Uint8Array(16),_=0;for(b=0;16>b;b++,f++)_+=G[b]=e[f];var z=new Uint8Array(_);for(b=0;_>b;b++,f++)z[b]=e[f];y+=17+_,(E>>4===0?m:g)[15&E]=r(G,z)}break;case 65501:t(),c=t();break;case 65498:var D,M=(t(),e[f++]),R=[];for(y=0;M>y;y++){D=h.components[e[f++]];var F=e[f++];D.huffmanTableDC=m[F>>4],D.huffmanTableAC=g[15&F],R.push(D)}var N=e[f++],X=e[f++],O=e[f++],H=a(e,f,h,R,c,N,X,O>>4,15&O);f+=H;break;default:if(255==e[f-3]&&e[f-2]>=192&&e[f-2]<=254){f-=3;break}throw"unknown JPEG marker "+v.toString(16)}v=t()}if(1!=p.length)throw"only single frame JPEGs supported";for(var y=0;y<p.length;y++){var j=p[y].components;for(var b in j)j[b].quantizationTable=u[j[b].quantizationIdx],delete j[b].quantizationIdx}this.width=h.samplesPerLine,this.height=h.scanLines,this.jfif=d,this.adobe=l,this.components=[];for(var y=0;y<h.componentsOrder.length;y++){var D=h.components[h.componentsOrder[y]];this.components.push({lines:i(h,D),scaleX:D.h/h.maxH,scaleY:D.v/h.maxV})}},getData:function(e,t){var r,a,i,s,o,h,c,f,d,l,u,p,g,m,v,y,b,w,k,U,B,C=this.width/e,A=this.height/t,I=0,x=e*t*this.components.length,T=new Uint8Array(x);switch(this.components.length){case 1:for(r=this.components[0],l=0;t>l;l++)for(o=r.lines[0|l*r.scaleY*A],d=0;e>d;d++)u=o[0|d*r.scaleX*C],T[I++]=u;break;case 2:for(r=this.components[0],a=this.components[1],l=0;t>l;l++)for(o=r.lines[0|l*r.scaleY*A],h=a.lines[0|l*a.scaleY*A],d=0;e>d;d++)u=o[0|d*r.scaleX*C],T[I++]=u,u=h[0|d*a.scaleX*C],T[I++]=u;break;case 3:for(B=!0,this.adobe&&this.adobe.transformCode?B=!0:"undefined"!=typeof this.colorTransform&&(B=!!this.colorTransform),r=this.components[0],a=this.components[1],i=this.components[2],l=0;t>l;l++)for(o=r.lines[0|l*r.scaleY*A],h=a.lines[0|l*a.scaleY*A],c=i.lines[0|l*i.scaleY*A],d=0;e>d;d++)B?(u=o[0|d*r.scaleX*C],p=h[0|d*a.scaleX*C],g=c[0|d*i.scaleX*C],w=n(u+1.402*(g-128)),k=n(u-.3441363*(p-128)-.71413636*(g-128)),U=n(u+1.772*(p-128))):(w=o[0|d*r.scaleX*C],k=h[0|d*a.scaleX*C],U=c[0|d*i.scaleX*C]),T[I++]=w,T[I++]=k,T[I++]=U;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";for(B=!1,this.adobe&&this.adobe.transformCode?B=!0:"undefined"!=typeof this.colorTransform&&(B=!!this.colorTransform),r=this.components[0],a=this.components[1],i=this.components[2],s=this.components[3],l=0;t>l;l++)for(o=r.lines[0|l*r.scaleY*A],h=a.lines[0|l*a.scaleY*A],c=i.lines[0|l*i.scaleY*A],f=s.lines[0|l*s.scaleY*A],d=0;e>d;d++)B?(u=o[0|d*r.scaleX*C],p=h[0|d*a.scaleX*C],g=c[0|d*i.scaleX*C],m=f[0|d*s.scaleX*C],v=255-n(u+1.402*(g-128)),y=255-n(u-.3441363*(p-128)-.71413636*(g-128)),b=255-n(u+1.772*(p-128))):(v=o[0|d*r.scaleX*C],y=h[0|d*a.scaleX*C],b=c[0|d*i.scaleX*C],m=f[0|d*s.scaleX*C]),T[I++]=v,T[I++]=y,T[I++]=b,T[I++]=m;break;default:throw"Unsupported color mode"}return T},copyToImageData:function(e){var t,r,a,i,s,o,h,c,f,d=e.width,l=e.height,u=e.data,p=this.getData(d,l),g=0,m=0;switch(this.components.length){case 1:for(r=0;l>r;r++)for(t=0;d>t;t++)a=p[g++],u[m++]=a,u[m++]=a,u[m++]=a,u[m++]=255;break;case 3:for(r=0;l>r;r++)for(t=0;d>t;t++)h=p[g++],c=p[g++],f=p[g++],u[m++]=h,u[m++]=c,u[m++]=f,u[m++]=255;break;case 4:for(r=0;l>r;r++)for(t=0;d>t;t++)s=p[g++],o=p[g++],a=p[g++],i=p[g++],h=255-n(s*(1-i/255)+i),c=255-n(o*(1-i/255)+i),f=255-n(a*(1-i/255)+i),u[m++]=h,u[m++]=c,u[m++]=f,u[m++]=255;break;default:throw"Unsupported color mode"}}},e.Codec.JPEG=e.Codec.JPG={encoder:e.NotImplemented("JPG.encoder"),decoder:function(e){var r=new t;r.parse(new Uint8Array(e));var a={width:r.width,height:r.height,data:new Uint8Array(r.width*r.height*4)};return r.copyToImageData(a),a}}}(t),!function(e){"use strict";function t(e){var t,r,a,i,n;if(this.data=e,this.pos=0,i=function(){var e;for(e=[],a=0;2>a;a++)e.push(String.fromCharCode(this.data[this.pos++]));return e}.call(this).join(""),"BM"!==i)throw"Invalid BMP file.";t=this.readUInt32(),this.pos+=4,n=this.readUInt32(),r=this.readUInt32(),this.width=this.readUInt32(),this.height=this.readUInt32(),this.colorPlaneCount=this.readUInt16(),this.bitsPerPixel=this.readUInt16(),this.compressionMethod=this.readUInt32(),this.rawSize=this.readUInt32(),this.hResolution=this.readUInt32(),this.vResolution=this.readUInt32(),this.paletteColors=this.readUInt32(),this.importantColors=this.readUInt32()}t.prototype.readUInt16=function(){var e,t;return e=this.data[this.pos++],t=this.data[this.pos++]<<8,e|t},t.prototype.readUInt32=function(){var e,t,r,a;return e=this.data[this.pos++],t=this.data[this.pos++]<<8,r=this.data[this.pos++]<<16,a=this.data[this.pos++]<<24,e|t|r|a},t.prototype.copyToImageData=function(e){var t,r,a,i,n,s,o,h,c;for(r=e.data,s=this.width,h=c=this.height-1;0>=c?0>h:h>0;0>=c?h++:h--)for(o=0;s>=0?s>o:o>s;s>=0?o++:o--)i=4*(o+h*s),t=this.data[this.pos++],a=this.data[this.pos++],n=this.data[this.pos++],r[i++]=n,r[i++]=a,r[i++]=t,r[i++]=255},e.Codec.BMP={encoder:e.NotImplemented("BMP.encoder"),decoder:function(e){var r=new t(new Uint8Array(e)),a={width:r.width,height:r.height,data:new Uint8Array(r.width*r.height*4)};return r.copyToImageData(a),a}}}(t),!function(e){"use strict";var t=function(e){return e.reduce(function(e,t){return 2*e+t},0)},r=function(e){for(var t=[],r=7;r>=0;r--)t.push(!!(e&1<<r));return t},a=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],r=0;e>r;r++)t.push(this.readByte());return t},this.read=function(e){for(var t="",r=0;e>r;r++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},i=function(e,t){for(var r,a,i=0,n=function(e){for(var r=0,a=0;e>a;a++)t.charCodeAt(i>>3)&1<<(7&i)&&(r|=1<<a),i++;return r},s=[],o=1<<e,h=o+1,c=e+1,f=[],d=function(){f=[],c=e+1;for(var t=0;o>t;t++)f[t]=[t];f[o]=[],f[h]=null};;)if(a=r,r=n(c),r!==o){if(r===h)break;if(r<f.length)a!==o&&f.push(f[a].concat(f[r][0]));else{if(r!==f.length)throw new Error("Invalid LZW code.");f.push(f[a].concat(f[a][0]))}s.push.apply(s,f[r]),f.length===1<<c&&12>c&&c++}else d();return s},n=function(e,a){a||(a={});var n=function(t){for(var r=[],a=0;t>a;a++)r.push(e.readBytes(3));return r},s=function(){var t,r;r="";do t=e.readByte(),r+=e.read(t);while(0!==t);return r},o=function(){var i={};if(i.sig=e.read(3),i.ver=e.read(3),"GIF"!==i.sig)throw new Error("Not a GIF file.");i.width=e.readUnsigned(),i.height=e.readUnsigned();var s=r(e.readByte());i.gctFlag=s.shift(),i.colorRes=t(s.splice(0,3)),i.sorted=s.shift(),i.gctSize=t(s.splice(0,3)),i.bgColor=e.readByte(),i.pixelAspectRatio=e.readByte(),i.gctFlag&&(i.gct=n(1<<i.gctSize+1)),a.hdr&&a.hdr(i)},h=function(i){var n=function(i){var n=(e.readByte(),r(e.readByte()));i.reserved=n.splice(0,3),i.disposalMethod=t(n.splice(0,3)),i.userInput=n.shift(),i.transparencyGiven=n.shift(),i.delayTime=e.readUnsigned(),i.transparencyIndex=e.readByte(),i.terminator=e.readByte(),a.gce&&a.gce(i)},o=function(e){e.comment=s(),a.com&&a.com(e)},h=function(t){e.readByte();t.ptHeader=e.readBytes(12),t.ptData=s(),a.pte&&a.pte(t)},c=function(t){{var r=function(t){e.readByte();t.unknown=e.readByte(),t.iterations=e.readUnsigned(),t.terminator=e.readByte(),a.app&&a.app.NETSCAPE&&a.app.NETSCAPE(t)},i=function(e){e.appData=s(),a.app&&a.app[e.identifier]&&a.app[e.identifier](e)};e.readByte()}switch(t.identifier=e.read(8),t.authCode=e.read(3),t.identifier){case"NETSCAPE":r(t);break;default:i(t)}},f=function(e){e.data=s(),a.unknown&&a.unknown(e)};switch(i.label=e.readByte(),i.label){case 249:i.extType="gce",n(i);break;case 254:i.extType="com",o(i);break;case 1:i.extType="pte",h(i);break;case 255:i.extType="app",c(i);break;default:i.extType="unknown",f(i)}},c=function(o){var h=function(e,t){for(var r=new Array(e.length),a=e.length/t,i=function(a,i){var n=e.slice(i*t,(i+1)*t);r.splice.apply(r,[a*t,t].concat(n))},n=[0,4,2,1],s=[8,8,4,2],o=0,h=0;4>h;h++)for(var c=n[h];a>c;c+=s[h])i(c,o),o++;return r};o.leftPos=e.readUnsigned(),o.topPos=e.readUnsigned(),o.width=e.readUnsigned(),o.height=e.readUnsigned();var c=r(e.readByte());o.lctFlag=c.shift(),o.interlaced=c.shift(),o.sorted=c.shift(),o.reserved=c.splice(0,2),o.lctSize=t(c.splice(0,3)),o.lctFlag&&(o.lct=n(1<<o.lctSize+1)),o.lzwMinCodeSize=e.readByte();var f=s();o.pixels=i(o.lzwMinCodeSize,f),o.interlaced&&(o.pixels=h(o.pixels,o.width)),a.img&&a.img(o)},f=function(){var t={};switch(t.sentinel=e.readByte(),String.fromCharCode(t.sentinel)){case"!":t.type="ext",h(t);break;case",":t.type="img",c(t);break;case";":t.type="eof",a.eof&&a.eof(t);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&f()},d=function(){o(),f()};d()};e.Codec.GIF={encoder:e.NotImplemented("GIF.encoder"),decoder:function(t){var r,i=null,s={width:0,height:0,data:null};return n(new a(new Uint8Array(t)),{hdr:function(e){r=e},gce:function(e){i=e.transparencyGiven?e.transparencyIndex:null},img:function(t){var a=t.lctFlag?t.lct:r.gct,n=new e.ImArray(t.width*t.height*4);t.pixels.forEach(function(e,t){e!==i&&(n[(t<<2)+0]=a[e][0],n[(t<<2)+1]=a[e][1],n[(t<<2)+2]=a[e][2],n[(t<<2)+3]=255)}),s.width=t.width,s.height=t.height,s.data=n}}),s}}}(t),!function(e){"use strict";var t=e.error;e.Codec.TGA={encoder:e.NotImplemented("TGA.encoder"),decoder:function(e){function r(e){switch(e.image_type){case l:case g:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&t("TGALoader.parse.tgaCheckHeader: Invalid type colormap data for indexed type");break;case u:case p:case m:case v:e.colormap_type&&t("TGALoader.parse.tgaCheckHeader: Invalid type colormap data for colormap type");
break;case d:t("TGALoader.parse.tgaCheckHeader: No data");default:t('TGALoader.parse.tgaCheckHeader: Invalid type " '+e.image_type+'"')}(e.width<=0||e.height<=0)&&t("TGALoader.parse.tgaCheckHeader: Invalid image size"),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&t('TGALoader.parse.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'"')}function a(e,t,r,a,i){var n,s,o,h;if(s=r.pixel_size>>3,o=r.width*r.height*s,t&&(h=i.subarray(a,a+=r.colormap_length*(r.colormap_size>>3))),e){n=new Uint8Array(o);for(var c,f,d,l=0,u=new Uint8Array(s);o>l;)if(c=i[a++],f=(127&c)+1,128&c){for(d=0;s>d;++d)u[d]=i[a++];for(d=0;f>d;++d)n.set(u,l+d*s);l+=s*f}else{for(f*=s,d=0;f>d;++d)n[l+d]=i[a++];l+=f}}else n=i.subarray(a,a+=t?r.width*r.height:o);return{pixel_data:n,palettes:h}}function i(e,t,r,a,i,n,s,o,h){var c,f,d,l=h,u=0,p=I.width;for(d=t;d!==a;d+=r)for(f=i;f!==s;f+=n,u++)c=o[u],e[4*(f+p*d)+3]=255,e[4*(f+p*d)+2]=l[3*c+0],e[4*(f+p*d)+1]=l[3*c+1],e[4*(f+p*d)+0]=l[3*c+2];return e}function n(e,t,r,a,i,n,s,o){var h,c,f,d=0,l=I.width;for(f=t;f!==a;f+=r)for(c=i;c!==s;c+=n,d+=2)h=o[d+0]+(o[d+1]<<8),e[4*(c+l*f)+0]=(31744&h)>>7,e[4*(c+l*f)+1]=(992&h)>>2,e[4*(c+l*f)+2]=(31&h)>>3,e[4*(c+l*f)+3]=32768&h?0:255;return e}function s(e,t,r,a,i,n,s,o){var h,c,f=0,d=I.width;for(c=t;c!==a;c+=r)for(h=i;h!==s;h+=n,f+=3)e[4*(h+d*c)+3]=255,e[4*(h+d*c)+2]=o[f+0],e[4*(h+d*c)+1]=o[f+1],e[4*(h+d*c)+0]=o[f+2];return e}function o(e,t,r,a,i,n,s,o){var h,c,f=0,d=I.width;for(c=t;c!==a;c+=r)for(h=i;h!==s;h+=n,f+=4)e[4*(h+d*c)+2]=o[f+0],e[4*(h+d*c)+1]=o[f+1],e[4*(h+d*c)+0]=o[f+2],e[4*(h+d*c)+3]=o[f+3];return e}function h(e,t,r,a,i,n,s,o){var h,c,f,d=0,l=I.width;for(f=t;f!==a;f+=r)for(c=i;c!==s;c+=n,d++)h=o[d],e[4*(c+l*f)+0]=h,e[4*(c+l*f)+1]=h,e[4*(c+l*f)+2]=h,e[4*(c+l*f)+3]=255;return e}function c(e,t,r,a,i,n,s,o){var h,c,f=0,d=I.width;for(c=t;c!==a;c+=r)for(h=i;h!==s;h+=n,f+=2)e[4*(h+d*c)+0]=o[f+0],e[4*(h+d*c)+1]=o[f+0],e[4*(h+d*c)+2]=o[f+0],e[4*(h+d*c)+3]=o[f+1];return e}function f(e,r,a,f){var d,l,u,p,g,m,v=new Uint8Array(e*r*4);switch((I.flags&y)>>b){default:case U:d=0,u=1,g=e,l=0,p=1,m=r;break;case w:d=0,u=1,g=e,l=r-1,p=-1,m=-1;break;case B:d=e-1,u=-1,g=-1,l=0,p=1,m=r;break;case k:d=e-1,u=-1,g=-1,l=r-1,p=-1,m=-1}if(L)switch(I.pixel_size){case 8:h(v,l,p,m,d,u,g,a);break;case 16:c(v,l,p,m,d,u,g,a);break;default:t("TGALoader.parse.getTgaRGBA: not support this format")}else switch(I.pixel_size){case 8:i(v,l,p,m,d,u,g,a,f);break;case 16:n(v,l,p,m,d,u,g,a);break;case 24:s(v,l,p,m,d,u,g,a);break;case 32:o(v,l,p,m,d,u,g,a);break;default:t("TGALoader.parse.getTgaRGBA: not support this format")}return v}var d=0,l=1,u=2,p=3,g=9,m=10,v=11,y=48,b=4,w=0,k=1,U=2,B=3;e.length<19&&t("TGALoader.parse: Not enough data to contain header.");var C=new Uint8Array(e),A=0,I={id_length:C[A++],colormap_type:C[A++],image_type:C[A++],colormap_index:C[A++]|C[A++]<<8,colormap_length:C[A++]|C[A++]<<8,colormap_size:C[A++],origin:[C[A++]|C[A++]<<8,C[A++]|C[A++]<<8],width:C[A++]|C[A++]<<8,height:C[A++]|C[A++]<<8,pixel_size:C[A++],flags:C[A++]};r(I),I.id_length+A>e.length&&t("TGALoader.parse: No data"),A+=I.id_length;var x=!1,T=!1,L=!1;switch(I.image_type){case g:x=!0,T=!0;break;case l:T=!0;break;case m:x=!0;break;case u:break;case v:x=!0,L=!0;break;case p:L=!0}var P=a(x,T,I,A,C),S=f(I.width,I.height,P.pixel_data,P.palettes);return{width:I.width,height:I.height,data:S}}}}(t),!function(e){"use strict";var t=e.error;e.Codec.HDR=e.Codec.RGBE={encoder:e.NotImplemented("RGBE.encoder"),decoder:function(e,r){{var a=-1,i=1,n=2,s=3,o=4,h=function(e,r){switch(e){case i:t("RGBE Read Error: "+(r||""));break;case n:t("RGBE Write Error: "+(r||""));break;case s:t("RGBE Bad File Format: "+(r||""));break;default:case o:t("RGBE: Error: "+(r||""))}return a},c=1,f=2,d=4,l="\n",u=function(e,t,r){t=t?t:1024;for(var a=e.pos,i=-1,n=0,s="",o=128,h=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+o)));0>(i=h.indexOf(l))&&t>n&&a<e.byteLength;)s+=h,n+=h.length,a+=o,h+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+o)));return i>-1?(!1!==r&&(e.pos+=n+i+1),s+h.slice(0,i)):!1},p=function(e){var t,r,a=/^#\?(\S+)$/,n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,l=/^\s*FORMAT=(\S+)\s*$/,p=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,g={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(t=u(e)))return h(i,"no header found");if(!(r=t.match(a)))return h(s,"bad initial token");for(g.valid|=c,g.programtype=r[1],g.string+=t+"\n";;){if(t=u(e),!1===t)break;if(g.string+=t+"\n","#"!==t.charAt(0)){if((r=t.match(n))&&(g.gamma=parseFloat(r[1],10)),(r=t.match(o))&&(g.exposure=parseFloat(r[1],10)),(r=t.match(l))&&(g.valid|=f,g.format=r[1]),(r=t.match(p))&&(g.valid|=d,g.height=parseInt(r[1],10),g.width=parseInt(r[2],10)),g.valid&f&&g.valid&d)break}else g.comments+=t+"\n"}return g.valid&f?g.valid&d?g:h(s,"missing image size specifier"):h(s,"missing format specifier")},g=function(e,t,r){var a,n,c,f,d,l,u,p,g,m,v,y,b,w=t,k=r;if(8>w||w>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(w!==(e[2]<<8|e[3]))return h(s,"wrong scanline width");if(a=new Uint8Array(4*t*r),!a||!a.length)return h(o,"unable to allocate buffer space");for(n=0,c=0,p=4*w,b=new Uint8Array(4),l=new Uint8Array(p);k>0&&c<e.byteLength;){if(c+4>e.byteLength)return h(i);if(b[0]=e[c++],b[1]=e[c++],b[2]=e[c++],b[3]=e[c++],2!=b[0]||2!=b[1]||(b[2]<<8|b[3])!=w)return h(s,"bad rgbe scanline format");for(u=0;p>u&&c<e.byteLength;){if(f=e[c++],y=f>128,y&&(f-=128),0===f||u+f>p)return h(s,"bad scanline data");if(y)for(d=e[c++],g=0;f>g;g++)l[u++]=d;else l.set(e.subarray(c,c+f),u),u+=f,c+=f}for(m=w,g=0;m>g;g++)v=0,a[n]=l[g+v],v+=w,a[n+1]=l[g+v],v+=w,a[n+2]=l[g+v],v+=w,a[n+3]=l[g+v],n+=4;k--}return a},m=new Uint8Array(e);m.byteLength}m.pos=0;var v=p(m);if(a!==v){var y=v.width,b=v.height,w=g(m.subarray(m.pos),y,b);if(a!==w)return r&&(r.header=v.string,r.gamma=v.gamma,r.exposure=v.exposure),{width:y,height:b,data:w}}return null}}}(t),e.FILTER_CODECS});
/**
*
*   FILTER.js Plugins
*   @version: 0.7.1
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n,t,r){"use strict";function a(e,n,t,r,a){var i;return e?{file:__filename,path:__dirname}:n?{file:i=self.location.href,path:i.split("/").slice(0,-1).join("/")}:t&&a&&a.uri?{file:i=a.uri,path:i.split("/").slice(0,-1).join("/")}:r&&(i=document.getElementsByTagName("script"))&&i.length?{file:i=i[i.length-1].src,path:i.split("/").slice(0,-1).join("/")}:{file:null,path:null}}function i(e,n,t,r,a){var i,s=e.length,o=new Array(s);for(i=0;s>i;i++)o[i]=1===r?t[e[i]]||a(n[i]):2===r?a(e[i]):t[e[i]];return o}function s(e,n,t,r,a,i){var s,o,l,u,h,c,f,d=t.length;if(i){for(s=0;d>s;s++)t[s]in e||importScripts(n+r[s]);return a()}c=document.getElementsByTagName("head")[0],f=document.createElement("a"),o=/^\./,l=0,s=0,u=function(e,t){var r=0,a=document.createElement("script");a.type="text/javascript",a.language="javascript",a.onload=a.onreadystatechange=function(){r||a.readyState&&"loaded"!=a.readyState&&"complete"!=a.readyState||(r=1,a.onload=a.onreadystatechange=null,t(),c.removeChild(a),a=null)},o.test(e)&&(f.href=n+e,e=f.protocol+"//"+f.host+f.pathname+f.search+f.hash),a.src=e,c.appendChild(a)},h=function(){t[s]in e?++s>=d?a():t[s]in e?h():u(r[s],h):++l<30?setTimeout(h,30):(l=0,s++,h())};for(;d>s&&t[s]in e;)s++;d>s?u(r[s],h):a()}t=t||[[],[]];var o,l,u,h="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),c=!h&&"undefined"!=typeof navigator,f=!h&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,d="function"==typeof define&&define.amd,g=h&&"object"==typeof module&&module.exports,p=f?self:e,m=a(h,f,d,c),_=[].concat(t[0]),v=[].concat(t[1]),y=_.length,b=/\.js$/i;if(g)module.$deps=module.$deps||{},module.exports=module.$deps[n]=r.apply(e,[{NODE:module}].concat(i(_,v,module.$deps,1,require)))||1;else if(d&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)){if(!require.defined(n)){for(u={},l=0;y>l;l++)require.specified(_[l])||(u[_[l]]=v[l].replace(b,""));require.config({paths:u}),define(n,["require","exports","module"].concat(_),function(n,t,a){return r.apply(e,[{AMD:a}].concat(i(_,v,arguments,2,n)))})}}else n in p||s(p,m.path+"/",_,v,function(){o=r.apply(e,[{}].concat(i(_,v,p))),d&&define(n,["require"],function(){return o})},f)}(this,"FILTER_PLUGINS",[["FILTER"],["./filter.js"]],function(e,n){return e.FILTER_PLUGINS=n,!function(n){"use strict";var t=n._notSupportClamp,r=Math.random;n.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,n){var t=this;t.min=e||-127,t.max=n||127},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{min:e.min,max:e.max}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.min=n.min,t.max=n.max),t},apply:function(e){var n=this;if(!n._isOn)return e;var a,i,s,o,l,u,h,c,f=n.max-n.min,d=n.min,g=e.length;if(t)for(a=0;g>a;a+=4)s=e[a],o=e[a+1],l=e[a+2],i=f*r()+d,u=s+i,h=o+i,c=l+i,0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>c?c=0:c>255&&(c=255),e[a]=~~u,e[a+1]=~~h,e[a+2]=~~c;else for(a=0;g>a;a+=4)s=e[a],o=e[a+1],l=e[a+2],i=f*r()+d,u=s+i,h=o+i,c=l+i,e[a]=~~u,e[a+1]=~~h,e[a+2]=~~c;return e}})}(n),!function(n){"use strict";function t(e){var n,t;for(e>0&&1>e&&(e*=65536),e=u(e),256>e&&(e|=e<<8),t=0;256>t;t++)n=1&t?h[t]^255&e:h[t]^e>>8&255,c[t]=c[t+256]=n}function r(e,n,t){var r=7&e,a=4>r?n:t,i=4>r?t:n;return(1&r?-a:a)+(2&r?-2*i:2*i)}function a(e,n){var t,a,i,s,o,l=.366025403,h=.211324865,f=(e+n)*l,d=e+f,g=n+f,p=u(d),m=u(g),_=(p+m)*h,v=p-_,y=m-_,b=e-v,M=n-y;b>M?(s=1,o=0):(s=0,o=1);var C=b-s+h,w=M-o+h,O=b-1+2*h,I=M-1+2*h,z=255&p,A=255&m,x=.5-b*b-M*M;0>x?t=0:(x*=x,t=x*x*r(c[z+c[A]],b,M));var S=.5-C*C-w*w;0>S?a=0:(S*=S,a=S*S*r(c[z+s+c[A+o]],C,w));var P=.5-O*O-I*I;return 0>P?i=0:(P*=P,i=P*P*r(c[z+1+c[A+1]],O,I)),40*(t+a+i)}function i(e){return e*e*e*(e*(6*e-15)+10)}function s(e,n,t){return n+e*(t-n)}function o(e,n){var t,a,o,l,h,f,d,g,p,m,_,v,y,b;return t=u(e),a=u(n),h=e-t,f=n-a,d=h-1,g=f-1,o=t+1&255,l=a+1&255,t=255&t,a=255&a,m=i(f),p=i(h),_=r(c[t+c[a]],h,f),v=r(c[t+c[l]],h,g),y=s(m,_,v),_=r(c[o+c[a]],d,f),v=r(c[o+c[l]],d,g),b=s(m,_,v),.507*s(p,y,b)}function l(e,n,t,r,a,i,s,o,l,u,h,c){var f,d,g,p=0,m=h,_=1,v=0,y=a>>>1,b=i>>>1;for(f=0;l>f;f++)d=(t+u[f][0])%a,g=(r+u[f][1])%i,e&&(d>y&&(d=a-1-d),g>b&&(g=i-1-g)),p+=n(m*d*s,m*g*o)*_,m*=2,v+=_,_*=c;return p/v}var u=Math.floor,h=(Math.sin,Math.cos,n.CONSTANTS.PI2,new n.Array8U([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180])),c=new n.Array8U(h);n.Create({name:"PerlinNoiseFilter",_baseX:1,_baseY:1,_octaves:1,_offsets:null,_colors:null,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,init:function(e,n,t,r,a,i,s,o,l){var u=this;u._baseX=e||1,u._baseY=n||1,u.octaves(t||1,i),u.colors(s||null),u._seed=o||0,u._stitch=!!r,u._fractal=!1!==a,u._perlin=!!l},path:n.getPath(e.AMD),seed:function(e){var n=this;return t(n._seed=e||0),n},octaves:function(e,n){var t=this;for(t._octaves=e||1,t._offsets=n?n.slice(0):[];t._offsets.length<t._octaves;)t._offsets.push([0,0]);return t},colors:function(e){var n=this;return n._colors=e||null,n},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_colors:e._colors,_seed:e._seed,_stitch:e._stitch,_fractal:e._fractal,_perlin:e._perlin}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t._baseX=n._baseX,t._baseY=n._baseY,t._octaves=n._octaves,t._offsets=n._offsets,t._colors=n._colors,t._seed=n._seed,t._stitch=n._stitch,t._fractal=n._fractal,t._perlin=n._perlin),t},apply:function(e,n,t){var r,i,s,h,c,f,d=this,g=d._baseX,p=d._baseY,m=1/g,_=1/p,v=d._octaves,y=d._offsets,b=d._colors,M=!b||!b.length,C=d._perlin,w=(!d._fractal,!!d._stitch),O=e.length;for(f=C?o:a,i=0,s=0,r=0;O>r;r+=4,i++)i>=n&&(i=0,s++),h=.5*l(w,f,i,s,n,t,m,_,v,y,1,.5)+.5,M?e[r]=e[r+1]=e[r+2]=~~(255*h):(c=b[u(h*(b.length-1))],e[r]=c[0],e[r+1]=c[1],e[r+2]=c[2]);return e}})}(n),!function(n){"use strict";var t=n._notSupportClamp,r=n.Array32F,a=n.Color.RGB2YCbCr,i=n.Color.YCbCr2RGB;n.Create({name:"HistogramEqualizeFilter",path:n.getPath(e.AMD),apply:function(e){var n=this;if(!n._isOn)return e;var s,o,l,u,h,c,f,d,g,p,m,_=0,v=255,y=0,b=e.length,M=b>>2,C=1/M;for(h=new r(256),g=0;256>g;g+=4)h[g]=0,h[g+1]=0,h[g+2]=0,h[g+3]=0;for(g=0;b>g;g+=4)p=a(e.subarray(g,g+3)),s=e[g]=~~p[2],o=e[g+1]=~~p[0],l=e[g+2]=~~p[1],h[o]+=C,o>_?_=o:v>o&&(v=o);for(y=0,g=0;256>g;g+=4)y+=h[g],h[g]=y,y+=h[g+1],h[g+1]=y,y+=h[g+2],h[g+2]=y,y+=h[g+3],h[g+3]=y;if(u=_-v,t)for(g=0;b>g;g+=4)p=[e[g+1],e[g+2],e[g]],p[0]=h[p[0]]*u+v,m=i(p),c=m[0],f=m[1],d=m[2],c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,e[g]=~~c,e[g+1]=~~f,e[g+2]=~~d;else for(g=0;b>g;g+=4)p=[e[g+1],e[g+2],e[g]],p[0]=h[p[0]]*u+v,m=i(p),e[g]=~~m[0],e[g+1]=~~m[1],e[g+2]=~~m[2];return e}}),n.Create({name:"GrayscaleHistogramEqualizeFilter",path:n.getPath(e.AMD),apply:function(e){var n=this;if(!n._isOn)return e;var a,i,s,o,l,u=0,h=255,c=0,f=e.length,d=f>>2,g=1/d;for(o=new r(256),l=0;256>l;l+=4)o[l]=0,o[l+1]=0,o[l+2]=0,o[l+3]=0;for(l=0;f>l;l+=4)a=e[l],o[a]+=g,a>u?u=a:h>a&&(h=a);for(c=0,l=0;256>l;l+=4)c+=o[l],o[l]=c,c+=o[l+1],o[l+1]=c,c+=o[l+2],o[l+2]=c,c+=o[l+3],o[l+3]=c;if(s=u-h,t)for(l=0;f>l;l+=4)a=e[l],i=o[a]*s+h,i=0>i?0:i>255?255:i,i=~~i,e[l]=i,e[l+1]=i,e[l+2]=i;else for(l=0;f>l;l+=4)a=e[l],i=~~(o[a]*s+h),e[l]=i,e[l+1]=i,e[l+2]=i;return e}}),n.Create({name:"RGBHistogramEqualizeFilter",path:n.getPath(e.AMD),apply:function(e){var n=this;if(!n._isOn)return e;var a,i,s,o,l,u,h,c,f,d,g,p,m,_,v,y,b=0,M=0,C=0,w=255,O=255,I=255,z=e.length,A=z>>2,x=1/A;for(h=new r(256),c=new r(256),f=new r(256),y=0;256>y;y+=4)h[y]=0,c[y]=0,f[y]=0,h[y+1]=0,c[y+1]=0,f[y+1]=0,h[y+2]=0,c[y+2]=0,f[y+2]=0,h[y+3]=0,c[y+3]=0,f[y+3]=0;for(y=0;z>y;y+=4)a=e[y],i=e[y+1],s=e[y+2],h[a]+=x,c[i]+=x,f[s]+=x,a>b?b=a:w>a&&(w=a),i>M?M=i:O>i&&(O=i),s>C?C=s:I>s&&(I=s);for(d=g=p=0,y=0;256>y;y+=4)d+=h[y],h[y]=d,g+=c[y],c[y]=g,p+=f[y],f[y]=p,d+=h[y+1],h[y+1]=d,g+=c[y+1],c[y+1]=g,p+=f[y+1],f[y+1]=p,d+=h[y+2],h[y+2]=d,g+=c[y+2],c[y+2]=g,p+=f[y+2],f[y+2]=p,d+=h[y+3],h[y+3]=d,g+=c[y+3],c[y+3]=g,p+=f[y+3],f[y+3]=p;if(o=b-w,l=M-O,u=C-I,t)for(y=0;z>y;y+=4)a=e[y],i=e[y+1],s=e[y+2],m=h[a]*o+w,_=c[i]*l+O,v=f[s]*u+I,m=0>m?0:m>255?255:m,_=0>_?0:_>255?255:_,v=0>v?0:v>255?255:v,e[y]=~~m,e[y+1]=~~_,e[y+2]=~~v;else for(y=0;z>y;y+=4)a=e[y],i=e[y+1],s=e[y+2],m=h[a]*o+w,_=c[i]*l+O,v=f[s]*u+I,e[y]=~~m,e[y+1]=~~_,e[y+2]=~~v;return e}})}(n),!function(n){"use strict";var t=Math.sqrt,r=n._notSupportClamp,a=n.Array32F;n.Create({name:"PixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.scale=n.scale),t},apply:function(e,n,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,g,p,m,_,v,y,b,M,C,w,O,I,z,A,x,S,P,N,Y,k,X,F,q,D,L,R,H,E,T,B,G,j,U,W,$,V,Q,J,K,Z=e.length,en=Z>>>2,nn=(n<<1)+n;for(o=~~(t(en)*s.scale*.01),l=n*o,u=i%o,h=n%o,c=(u-1)*n,p=1/(o*o),m=1/(h*o),_=1/(u*o),v=1/(h*u),y=p,b=m,M=_,C=v,A=o-1,x=(o-1)*n,T=0,G=n-1,B=0,j=en-n,w=new a(3*en),S=0,P=0,N=0,O=I=z=0,N=0;n>N;N++,S+=4,P+=3)O+=e[S],I+=e[S+1],z+=e[S+2],w[P]=O,w[P+1]=I,w[P+2]=z;for(P=0,N=0,O=I=z=0,S=nn+n;Z>S;S+=4,P+=3,N++)N>=n&&(N=0,O=I=z=0),O+=e[S],I+=e[S+1],z+=e[S+2],w[P+nn]=w[P]+O,w[P+nn+1]=w[P+1]+I,w[P+nn+2]=w[P+2]+z;for(N=0,Y=0,k=0,L=N,R=k,H=L+A,E=R+x,H=H>G?G:H,E=E>j?j:E,U=L+R,V=H+E,W=H+R,$=L+E,U=(U<<1)+U,W=(W<<1)+W,$=($<<1)+$,V=(V<<1)+V,g=y,Q=g*(w[V]-w[W]-w[$]+w[U]),J=g*(w[V+1]-w[W+1]-w[$+1]+w[U+1]),K=g*(w[V+2]-w[W+2]-w[$+2]+w[U+2]),r&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K,X=0,F=0,q=0,S=0;Z>S;S+=4)D=X+N+q+k<<2,e[D]=Q,e[D+1]=J,e[D+2]=K,X++,(X+N>=n||X>=o)&&(X=0,F++,q+=n),(F+Y>=i||F>=o)&&(N+=o,N>=n&&(N=0,Y+=o,k+=l),X=0,F=0,q=0,L=N,R=k,H=L+A,E=R+x,H=H>G?G:H,E=E>j?j:E,U=L+R,V=H+E,W=H+R,$=L+E,U=(U<<1)+U,W=(W<<1)+W,$=($<<1)+$,V=(V<<1)+V,f=0==H-L-h+1,d=0==E-R-c,g=f&&d?C:f?b:d?M:y,Q=g*(w[V]-w[W]-w[$]+w[U]),J=g*(w[V+1]-w[W+1]-w[$+1]+w[U+1]),K=g*(w[V+2]-w[W+2]-w[$+2]+w[U+2]),r&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K);return e}})}(n),!function(n){"use strict";var t=Math.sqrt,r=(Math.SQRT2,Math.min,n._notSupportClamp),a=n.Array32F;n.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.scale=n.scale),t},apply:function(e,n,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,g,p,m,_,v,y,b,M,C,w,O,I,z,A,x,S,P,N,Y,k,X,F,q,D,L,R,H,E,T,B,G,j,U,W,$,V,Q,J,K,Z,en,nn,tn,rn,an,sn,on,ln=e.length,un=ln>>>2,hn=(n<<1)+n;for(o=~~(t(un)*s.scale*.01),l=o>>1,u=o-1,h=n*o,c=i%o,f=n%o,d=(c-1)*n,_=1/(o*o),v=1/(f*o),y=1/(c*o),b=1/(f*c),M=2*_,C=2*v,w=2*y,O=2*b,S=u,P=u*n,G=0,U=n-1,j=0,W=un-n,I=new a(3*un),N=0,Y=0,k=0,z=A=x=0,k=0;n>k;k++,N+=4,Y+=3)z+=e[N],A+=e[N+1],x+=e[N+2],I[Y]=z,I[Y+1]=A,I[Y+2]=x;for(Y=0,k=0,z=A=x=0,N=hn+n;ln>N;N+=4,Y+=3,k++)k>=n&&(k=0,z=A=x=0),z+=e[N],A+=e[N+1],x+=e[N+2],I[Y+hn]=I[Y]+z,I[Y+hn+1]=I[Y+1]+A,I[Y+hn+2]=I[Y+2]+x;for(k=0,X=0,F=0,H=k,E=F,T=k-l+S,B=F+P,T=T>U?U:T,B=B>W?W:B,$=H+E,J=T+B,V=T+E,Q=H+B,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,m=M,nn=m*(I[J]-I[V]-I[Q]+I[$]),tn=m*(I[J+1]-I[V+1]-I[Q+1]+I[$+1]),rn=m*(I[J+2]-I[V+2]-I[Q+2]+I[$+2]),H=k+l,T=k+S,T=T>U?U:T,$=H+E,J=T+B,V=T+E,Q=H+B,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,an=m*(I[J]-I[V]-I[Q]+I[$]),sn=m*(I[J+1]-I[V+1]-I[Q+1]+I[$+1]),on=m*(I[J+2]-I[V+2]-I[Q+2]+I[$+2]),r&&(nn=0>nn?0:nn>255?255:nn,tn=0>tn?0:tn>255?255:tn,rn=0>rn?0:rn>255?255:rn,an=0>an?0:an>255?255:an,sn=0>sn?0:sn>255?255:sn,on=0>on?0:on>255?255:on),nn=~~nn,tn=~~tn,rn=~~rn,an=~~an,sn=~~sn,on=~~on,K=nn,Z=tn,en=rn,q=0,D=0,L=0,N=0;ln>N;N+=4)R=q+k+L+F<<2,e[R]=K,e[R+1]=Z,e[R+2]=en,q++,(q+k>=n||q>=o)&&(q=0,D++,L+=n,K=nn,Z=tn,en=rn),q>u-D&&(K=an,Z=sn,en=on),(D+X>=i||D>=o)&&(k+=o,k>=n&&(k=0,X+=o,F+=h),q=0,D=0,L=0,H=k,E=F,T=k-l+S,B=F+P,T=T>U?U:T,B=B>W?W:B,$=H+E,J=T+B,V=T+E,Q=H+B,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,g=0==T-H+l-f+1,p=0==B-E-d,m=g&&p?O:g?C:p?w:M,nn=m*(I[J]-I[V]-I[Q]+I[$]),tn=m*(I[J+1]-I[V+1]-I[Q+1]+I[$+1]),rn=m*(I[J+2]-I[V+2]-I[Q+2]+I[$+2]),H=k+l,T=k+S,T=T>U?U:T,$=H+E,J=T+B,V=T+E,Q=H+B,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,g=0==T-H+l-f+1,m=g&&p?O:g?C:p?w:M,an=m*(I[J]-I[V]-I[Q]+I[$]),sn=m*(I[J+1]-I[V+1]-I[Q+1]+I[$+1]),on=m*(I[J+2]-I[V+2]-I[Q+2]+I[$+2]),r&&(nn=0>nn?0:nn>255?255:nn,tn=0>tn?0:tn>255?255:tn,rn=0>rn?0:rn>255?255:rn,an=0>an?0:an>255?255:an,sn=0>sn?0:sn>255?255:sn,on=0>on?0:on>255?255:on),nn=~~nn,tn=~~tn,rn=~~rn,an=~~an,sn=~~sn,on=~~on,K=nn,Z=tn,en=rn);return e}})}(n),!function(n,t){"use strict";var r=7/16,a=3/16,i=5/16,s=1/16,o=n.Array32F,l=n.Color.clamp,u=n.Color.RGB2YCbCr,h=n.Color.YCbCr2RGB;n.Create({name:"HalftoneFilter",_threshold:.4,_size:1,_grayscale:!1,init:function(e,n,r){var a=this;a._size=e||1,a._threshold=l(t===n?.4:n,0,1),a._grayscale=!!r},path:n.getPath(e.AMD),size:function(e){return this._size=e,this},threshold:function(e){return this._threshold=l(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this._grayscale=!!e,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_size:e._size,_threshold:e._threshold,_grayscale:e._grayscale}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t._size=n._size,t._threshold=n._threshold,t._grayscale=n._grayscale),t},apply:function(e,n,t){var c,f,d,g,p,m,_,v,y,b,M,C,w,O,I,z,A,x=this,S=e.length,P=S>>>2,N=new o(3*P),Y=x._size,k=Y*Y,X=1/k,F=255*x._threshold,q=q<<1,D=!x._grayscale,L=Y*n,R=r,H=a,E=i,T=s;for(_=0,v=0,m=0;t>_;){for(C=w=O=0,y=0,b=0,M=0;Y>b;)c=m+v+y+M<<2,f=3*(m+v+y+M),C+=e[c]+N[f],w+=e[c+1]+N[f+1],O+=e[c+2]+N[f+2],y++,y>=Y&&(y=0,b++,M+=n);if(C*=X,w*=X,O*=X,p=D?u([C,w,O]):[C,w,O],d=p[0],d>F?D?(p[0]=l(~~d,0,255),g=h(p)):g=[255,255,255]:g=[0,0,0],c=m+v<<2,I=e[c]-g[0],z=e[c+1]-g[1],A=e[c+2]-g[2],n>m+Y)for(y=Y,b=0,M=0;Y>b;)f=3*(m+v+y+M),N[f]+=R*I,N[f+1]+=R*z,N[f+2]+=R*A,y++,y>=q&&(y=Y,b++,M+=n);if(t>_+Y&&m>Y)for(y=-Y,b=Y,M=0;q>b;)f=3*(m+v+y+M),N[f]+=H*I,N[f+1]+=H*z,N[f+2]+=H*A,y++,y>=0&&(y=-Y,b++,M+=n);if(t>_+Y)for(y=0,b=Y,M=0;q>b;)f=3*(m+v+y+M),N[f]+=E*I,N[f+1]+=E*z,N[f+2]+=E*A,y++,y>=Y&&(y=0,b++,M+=n);if(t>_+Y&&n>m+Y)for(y=Y,b=Y,M=0;q>b;)f=3*(m+v+y+M),N[f]+=T*I,N[f+1]+=T*z,N[f+2]+=T*A,y++,y>=q&&(y=Y,b++,M+=n);for(y=0,b=0,M=0;Y>b;)c=m+v+y+M<<2,e[c]=g[0],e[c+1]=g[1],e[c+2]=g[2],y++,y>=Y&&(y=0,b++,M+=n);m+=Y,m>=n&&(m=0,_+=Y,v+=L)}return e}})}(n),!function(n){"use strict";var t=(Math.sqrt,Math.exp,Math.log),r=Math.abs,a=Math.floor,i=n._notSupportClamp,s=n.Array32F;n.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,n,t,r){var a=this;a.centerX=e||0,a.centerY=n||0,a.radius=t||10,a.amount=r||10},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.centerX=n.centerX,t.centerY=n.centerY,t.radius=n.radius,t.amount=n.amount),t},apply:function(e,n,o){var l=this;if(!l._isOn)return e;var u,h,c,f,d,g,p,m,_,v,y,b,M,C,w,O,I,z,A,x,S,P,N,Y,k,X,F,q,D,L,R,H,E,T=e.length,B=l.centerX||0,G=l.centerY||0,j=l.radius,U=l.amount;if(0>=U)return e;for(u=T>>2,L=0,R=n-1,H=0,E=u-n,B=a(B*(n-1)),G=a(G*(o-1)),c=(u<<1)+u,p=(n<<1)+n,h=new s(c),m=0,_=0,v=0,f=d=g=0,v=0;n>v;v++,m+=4,_+=3)f+=e[m],d+=e[m+1],g+=e[m+2],h[_]=f,h[_+1]=d,h[_+2]=g;for(m=p+n,_=0,v=0,f=d=g=0,m=p+n;T>m;m+=4,_+=3,v++)v>=n&&(v=0,f=d=g=0),f+=e[m],d+=e[m+1],g+=e[m+2],h[_+p]=h[_]+f,h[_+p+1]=h[_+1]+d,h[_+p+2]=h[_+2]+g;for(v=0,y=0,b=0,m=0;T>m;m+=4,v++)v>=n&&(v=0,y++,b+=n),C=v-B,w=y-G,M=r(C)+r(w),O=M>j?~~t((M-j)*U):~~(M/j+.5),O>0&&(I=O*n,z=.25/(O*O),A=v-O,x=b-I,S=v+O,P=b+I,L>A?A=L:S>R&&(S=R),H>x?x=H:P>E&&(P=E),N=A+x,X=S+P,Y=S+x,k=A+P,N=(N<<1)+N,Y=(Y<<1)+Y,k=(k<<1)+k,X=(X<<1)+X,F=z*(h[X]-h[Y]-h[k]+h[N]),q=z*(h[X+1]-h[Y+1]-h[k+1]+h[N+1]),D=z*(h[X+2]-h[Y+2]-h[k+2]+h[N+2]),i&&(F=0>F?0:F>255?255:F,q=0>q?0:q>255?255:q,D=0>D?0:D>255?255:D),e[m]=~~F,e[m+1]=~~q,e[m+2]=~~D);return e}})}(n),!function(n){"use strict";n.Create({name:"SeamlessTileFilter",type:0,init:function(e){var n=this;n.type=e||0},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{type:e.type}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.type=n.type),t},apply:function(e,t,r){var a,i,s,o,l,u,h,c,f,d,g,p,m,_,v,y=this,b=y.type;for(t!==r?e=n.Image.resize(e,t,r,p=t>r?t:r,p):p=t,m=Math.round(p/2),_=p*p,v=e.length,a=new n.ImArray(v),i=new n.ImArray(v),s=new n.Array8U(_),c=0,f=0,d=0;v>d;d+=4,c++)c>=p&&(c=0,f++),g=(c+m)%p+(f+m)%p*p<<2,a[g]=e[d],a[g+1]=e[d+1],a[g+2]=e[d+2],a[g+3]=e[d+3];for(c=0;m-1>=c;c++)for(f=0;m-1>=f;f++){switch(b){case 0:h=Math.sqrt((c-m)*(c-m)+(f-m)*(f-m))/m;break;case 1:h=m-f>m-c?(f-m)/m:(c-p/2)/m;break;case 2:default:h=m-f>m-c?Math.sqrt((f-p)*(f-p)+(c-p)*(c-p))/(1.13*p):Math.sqrt((c-p)*(c-p)+(f-p)*(f-p))/(1.13*p)}h=255-255*h,1>h?h=1:h>255&&(h=255),s[c+f*p]=h,s[c+(p-1-f)*p]=h,s[p-1-c+f*p]=h,s[p-1-c+(p-1-f)*p]=h}for(f=0;p-1>=f;f++)for(c=0;p-1>=c;c++)g=c+f*p,o=s[g],l=s[(c+m)%p+(f+m)%p*p],u=o+l,o/=u,l/=u,g<<=2,i[g]=~~(o*e[g]+l*a[g]),i[g+1]=~~(o*e[g+1]+l*a[g+1]),i[g+2]=~~(o*e[g+2]+l*a[g+2]),i[g+3]=e[g+3];return t!==r&&(i=n.Image.resize(i,p,p,t,r)),i}})}(n),!function(n){"use strict";n.Create({name:"FloodFillFilter",x:0,y:0,color:null,tolerance:0,path:n.getPath(e.AMD),init:function(e,n,t,r){var a=this;a.x=e||0,a.y=n||0,a.color=t||[0,0,0],a.tolerance=r||0},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{color:e.color,x:e.x,y:e.y,tolerance:e.tolerance}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.color=n.color,t.x=n.x,t.y=n.y,t.tolerance=n.tolerance),t},apply:function(e,n){var t,r,a,i,s,o,l,u,h,c,f=this,d=~~(255*(f.tolerance>=1?.999:f.tolerance)),g=f.color,p=n<<2,m=f.x,_=f.y,v=e.length,y=0,b=v-p,M=0,C=n-1<<2,w=Math.abs;if(l=_*n<<2,m<<=2,M>m||m>C||y>l||l>b||e[m+l]===g[0]&&e[m+l+1]===g[1]&&e[m+l+2]===g[2])return e;for(t=[e[m+l],e[m+l+1],e[m+l+2]],u=[],l+p>=y&&b>=l+p&&u.push([l,m,m,p]),u.push([l+p,m,m,-p]);u.length;){for(h=u.pop(),l=h[0]+(p=h[3]),s=h[1],o=h[2],i=s;i>=M&&(a=i+l,w(t[0]-e[a])<=d&&w(t[1]-e[a+1])<=d&&w(t[2]-e[a+2])<=d);i-=4)e[a]=g[0],e[a+1]=g[1],e[a+2]=g[2];if(i>=s){for(;o>=i&&!(w(t[0]-e[i+l])<=d&&w(t[1]-e[i+l+1])<=d&&w(t[2]-e[i+l+2])<=d);)i+=4;r=i,c=o>=i}else r=i+4,s>r&&l-p>=y&&b>=l-p&&u.push([l,r,s-4,-p]),i=s+4,c=!0;for(;c;){for(a=i+l;C>=i&&w(t[0]-e[a])<=d&&w(t[1]-e[a+1])<=d&&w(t[2]-e[a+2])<=d;)e[a]=g[0],e[a+1]=g[1],e[a+2]=g[2],i+=4,a=i+l;for(l+p>=y&&b>=l+p&&u.push([l,r,i-4,p]),i>o+4&&l-p>=y&&b>=l-p&&u.push([l,o+4,i-4,-p]);o>=i&&!(w(t[0]-e[i+l])<=d&&w(t[1]-e[i+l+1])<=d&&w(t[2]-e[i+l+2])<=d);)i+=4;r=i,c=o>=i}}return e}})}(n),!function(n){"use strict";var t=n._notSupportClamp,r=n.Color.RGB2HSV,a=.7083333333333334;n.Create({name:"HSVConverterFilter",path:n.getPath(e.AMD),apply:function(e){var n=this;if(!n._isOn)return e;var i,s,o,l,u,h=e.length;if(t)for(i=0;h>i;i+=4)s=r(e.subarray(i,i+3)),o=s[0]*a,u=255*s[1],l=s[2],0>o?o=0:o>255&&(o=255),0>l?l=0:l>255&&(l=255),0>u?u=0:u>255&&(u=255),e[i]=~~o,e[i+1]=~~l,e[i+2]=~~u;else for(i=0;h>i;i+=4)s=r(e.subarray(i,i+3)),o=s[0]*a,u=255*s[1],l=s[2],e[i]=~~o,e[i+1]=~~l,e[i+2]=~~u;return e}})}(n),!function(n){"use strict";var t=(n._notSupportClamp,n.Color.RGBA2Color),r=n.Color.Color2RGBA;n.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(e,n){var t=this;t.thresholds=e,t.quantizedColors=n||null},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{thresholds:e.thresholds,quantizedColors:e.quantizedColors}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.thresholds=n.thresholds,t.quantizedColors=n.quantizedColors),t},apply:function(e){var n=this;if(!(n._isOn&&n.thresholds&&n.thresholds.length&&n.quantizedColors&&n.quantizedColors.length))return e;var a,i,s,o,l=e.length,u=n.thresholds,h=u.length,c=n.quantizedColors,f=c.length;for(s=0;l>s;s+=4){for(a=t(e.subarray[s+4]),o=0;h>o&&a>u[o];)o++;a=f>o?c[o]:255,i=r(a),e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2],e[s+3]=i[3]}return e}})}(n),!function(n){"use strict";var t=(n._notSupportClamp,n.ImArray,n.Color.clampPixel),r=n.Color.RGB2HSV,a=(n.Color.HSV2RGB,n.Color.Color2RGBA);n.Create({name:"HueExtractorFilter",range:null,background:0,init:function(e,n){var t=this;t.range=e,t.background=n||0},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{range:e.range,background:e.background}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.range=n.range,t.background=n.background),t},apply:function(e){var n=this;if(!n._isOn||!n.range||!n.range.length)return e;var i,s,o,l,u,h,c,f=e.length,d=n.range[0],g=n.range[n.range.length-1];for(h=a(n.background||0),i=~~t(h[0]),s=~~t(h[1]),o=~~t(h[2]),l=~~t(h[3]),u=0;f>u;u+=4)c=r(e.subarray(u,u+3))[0],(d>c||c>g)&&(e[u]=i,e[u+1]=s,e[u+2]=o,e[u+3]=l);return e}})}(n),!function(n){"use strict";function t(e,t,r,a,i,s){var o,h,_,v,y,b=e.length,M=new u(b),C=new u(b),w=new u(b),O=new u(b),I=new u(s),z=new u(s),A=i*i,x=2*A,S=n.CONSTANTS.PI2*A;for(o=0;s>o&&(h=m(-(o*o)/x),!(c>=h&&o>=2));o++)_=m(-((y=o-.5)*y)/x),v=m(-((y=o+.5)*y)/x),I[o]=(h+_+v)/3/S,z[o]=v-_;var y,P,N,Y,k,X,F,q,D,L=o-1,R=t-(o-1),H=t*(o-1),E=t*(r-(o-1));for(y=L;R>y;y++)for(P=H;E>P;P+=t){for(N=y+P,Y=e[N]*I[0],k=Y,X=1,F=t;o>X;)k+=I[X]*(e[N-F]+e[N+F]),Y+=I[X]*(e[N-X]+e[N+X]),F+=t,X++;C[N]=k,M[N]=Y}for(y=L;R>y;y++)for(P=H;E>P;P+=t){for(q=0,N=y+P,D=1;o>D;D++)q+=z[D]*(C[N-D]-C[N+D]);w[N]=q}for(y=o;t-o>y;y++)for(P=H;E>P;P+=t){for(q=0,N=y+P,F=t,D=1;o>D;D++)q+=z[D]*(M[N-F]-M[N+F]),F+=t;O[N]=q}L=o,R=t-o,H=t*o,E=t*(r-o);var T,B,G,j,U,W,$,V,Q,J,K,Z,en,nn,tn,rn,an,sn,on,ln;for(y=L;R>y;y++)for(P=H;E>P;P+=t)N=y+P,T=N-t,B=N+t,j=N-1,G=N+1,U=T-1,W=T+1,$=B-1,V=B+1,Q=w[N],J=O[N],K=l(Q,J),en=l(w[T],O[T]),nn=l(w[B],O[B]),rn=l(w[j],O[j]),tn=l(w[G],O[G]),sn=l(w[W],O[W]),ln=l(w[V],O[V]),on=l(w[$],O[$]),an=l(w[U],O[U]),a[N]=(0>=Q*J?p(Q)>=p(J)?(Z=p(Q*K))>=p(J*sn-(Q+J)*tn)&&Z>p(J*on-(Q+J)*rn):(Z=p(J*K))>=p(Q*sn-(J+Q)*en)&&Z>p(Q*on-(J+Q)*nn):p(Q)>=Math.abs(J)?(Z=p(Q*K))>=p(J*ln+(Q-J)*tn)&&Z>p(J*an+(Q-J)*rn):(Z=p(J*K))>=p(Q*ln+(J-Q)*nn)&&Z>p(Q*an+(J-Q)*en))?K>=d?g:Math.floor(f*K):0}function r(e,n,t,r,i,s){var o,l,u,h=0,c=e.length;for(o=0;c>o;o++)e[o]=0;for(u=0,l=0,h=0;c>h;h++,u++)u>=n&&(u=0,l++),0===e[h]&&r[h]>=s&&a(e,n,t,r,u,l,h,i)}function a(e,n,t,r,i,s,o,l){var u,h,c,f=0==i?i:i-1,d=i==n-1?i:i+1,g=0==s?s:s-1,p=s==t-1?s:s+1;for(e[o]=r[o],u=f,h=g;d>=u&&p>=h;){if(c=u+h*n,(h!=s||u!=i)&&0===e[c]&&r[c]>=l)return void a(e,n,t,r,u,h,c,l);h++,h>p&&(h=g,u++)}}function i(e,t){var r,a,i,s,o,l=e.length,u=n.LUMA[0],h=n.LUMA[1],c=n.LUMA[2];for(r=0,a=0;l>r;r+=4,a++)i=e[r],s=e[r+1],o=e[r+2],t[a]=~~(u*i+h*s+c*o+.5)}function s(e){var n,t,r,a,i,s=new h(256),o=new h(256),l=e.length;for(n=0;l>n;n++)s[e[n]]++;for(t=0,r=0,n=0;256>n;n++){for(t+=s[n],i=255*t/l,a=r+1;i>=a;a++)o[a]=n;r=i}for(n=0;l>n;n++)e[n]=o[e[n]]}function o(e,n){var t,r,a,i=e.length;for(t=0,r=0;i>t;t+=4,r++)a=n[r]>0?255:0,e[t]=e[t+1]=e[t+2]=a}var l,u=n.Array32F,h=n.Array32I,c=.005,f=100,d=1e3,g=f*d,p=(n.CONSTANTS.PI2,Math.abs),m=Math.exp;l=Math.hypot?Math.hypot:function(e,n){return p(e)+p(n)},n.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:n.getPath(e.AMD),init:function(e,n,t,r,a){var i=this;i.low=arguments.length<1?2.5:e,i.high=arguments.length<2?7.5:n,i.gaussRadius=arguments.length<3?2:t,i.gaussWidth=arguments.length<4?16:r,i.contrastNormalized=!!a},thresholds:function(e,n){var t=this;return t.low=e,t.high=n,t},kernel:function(e,n){var t=this;return t.gaussRadius=e,t.gaussWidth=n,t},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{low:e.low,high:e.high,gaussRadius:e.gaussRadius,gaussWidth:e.gaussWidth,contrastNormalized:e.contrastNormalized}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.low=n.low,t.high=n.high,t.gaussRadius=n.gaussRadius,t.gaussWidth=n.gaussWidth,t.contrastNormalized=n.contrastNormalized),t},apply:function(e,n,a){var l,u,c,d,g=this,p=e.length>>2;return c=new h(p),d=new h(p),l=Math.round(g.low*f),u=Math.round(g.high*f),i(e,c),g.contrastNormalized&&s(c),t(c,n,a,d,g.gaussRadius,g.gaussWidth),r(c,n,a,d,l,u),o(e,c),e}})}(n),!function(n,t){"use strict";function r(e,n,t,r,a,i,s){var o,l,u,h,c,f,d,g=e.length;for(h=0,u=0,o=l=0;n>h;)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,r[h]=d,a[h]=o,i[h]=l,s[h]=d,h++,u+=4;for(c=0,f=1,h=n,u=n<<2,o=l=0;g>u;)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,r[h]=d,a[h]=a[h-n]+o,i[h]=i[h-n]+l,s[h]=s[h+1-n]+(d+r[h-n])+(f>1?s[h-n-n]:0)+(c>0?s[h-1-n]:0),c++,h++,u+=4,c>=n&&(c=0,f++,o=l=0)}function a(e,n,t,r){var a,i,s,o,l,u,h,c,g,p,m,_=e.length,v=new f(_);for(a=0;n>a;a++)v[a]=0,v[a+n]=0,v[a+_-n]=0,v[a+_-n-n]=0,r[a]=0,r[a+_-n]=0;for(i=0,s=0;t>i;i++,s+=n)v[0+s]=0,v[1+s]=0,v[n-1+s]=0,v[n-2+s]=0,r[0+s]=0,r[n-1+s]=0;for(a=2;n-2>a;a++)for(o=0,i=2,s=n<<1;t-2>i;i++,s+=n)h=a+s,c=h+n,g=c+n,p=h-n,m=p-n,o=0+(e[m-2]<<1)+(e[p-2]<<2)+(e[h-2]<<2)+e[h-2]+(e[c-2]<<2)+(e[g-2]<<1)+(e[m-1]<<2)+(e[p-1]<<3)+e[p-1]+(e[h-1]<<4)-(e[h-1]<<2)+(e[c-1]<<3)+e[c-1]+(e[g-1]<<2)+(e[m]<<2)+e[m]+(e[p]<<4)-(e[p]<<2)+(e[h]<<4)-e[h]+(e[c]<<4)-(e[c]<<2)+(e[g]<<2)+e[g]+(e[m+1]<<2)+(e[p+1]<<3)+e[p+1]+(e[h+1]<<4)-(e[h+1]<<2)+(e[c+1]<<3)+e[c+1]+(e[g+1]<<2)+(e[m+2]<<1)+(e[p+2]<<2)+(e[h+2]<<2)+e[h+2]+(e[c+2]<<2)+(e[g+2]<<1),v[h]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1;n-1>a;a++)for(i=1,s=n;t-1>i;i++,s+=n)h=s+a,c=h+n,p=h-n,l=0-v[p-1]+v[p+1]-v[h-1]-v[h-1]+v[h+1]+v[h+1]-v[c-1]+v[c+1],u=0+v[p-1]+v[p]+v[p]+v[p+1]-v[c-1]-v[c]-v[c]-v[c+1],r[h]=d(l)+d(u);for(a=0,o=0;n>a;)o+=r[a],r[a]=o,a++;for(a=n,s=0,o=0;_>a;)o+=r[a],r[a]=r[a-n]+o,a++,s++,s>=n&&(s=0,o=0);return r}function i(e,n){var t=.2*g(n.width,e.width),r=.2*g(n.height,e.height);return!!(d(e.x-n.x)<=t&&d(e.y-n.y)<=r&&d(e.width-n.width)<=t&&d(e.height-n.height)<=r)}function s(e,n){e.x+=n.x,e.y+=n.y,e.width+=n.width,e.height+=n.height}function o(e,n){return!!(e.x>=n.x&&e.y>=n.y&&e.x+e.width<=n.x+n.width&&e.y+e.height<=n.y+n.height)}function l(e){e.x=~~(e.x+.5),e.y=~~(e.y+.5),e.width=~~(e.width+.5),e.height=~~(e.height+.5)}function u(e,n){return n.area-e.area}function h(e,n){var t,r,a,h,c,f,d,g=e.length,p=new Array(g),m=[],_=0,v=!1;for(a=0;g>a;a++)p[a]=0;for(a=0;g>a;a++){for(v=!1,h=0;a>h;h++)i(e[h],e[a])&&(v=!0,p[a]=p[h]);v||(p[a]=_,_++)}for(t=new Array(_),r=new Array(_),a=0;_>a;a++)t[a]=0,r[a]={x:0,y:0,width:0,height:0};for(a=0;g>a;a++)d=p[a],t[d]++,s(r[d],e[a]);for(a=0;_>a;a++)c=t[a],c>=n&&(f=1/(c+c),d={x:f*(2*r[a].x+c),y:f*(2*r[a].y+c),width:f*(2*r[a].width+c),height:f*(2*r[a].height+c)},m.push(d));for(g=m.length,a=0;g>a;a++)for(h=a+1;g>h;h++)!m[a].inside&&o(m[a],m[h])?m[a].inside=!0:!m[h].inside&&o(m[h],m[a])&&(m[h].inside=!0);for(a=g;--a>=0;)m[a].inside?m.splice(a,1):(l(m[a]),m[a].area=m[a].width*m[a].height);return m.sort(u)}var c=n.Array32F,f=n.Array8U,d=Math.abs,g=Math.max,p=Math.min,m=(Math.floor,Math.round,Math.sqrt),_="hasOwnProperty";n.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,n,r,a,i,s){var o=this;o.objects=null,o.haardata=e||null,o.baseScale=t===n?1:n,o.scaleIncrement=t===r?1.25:r,o.stepIncrement=t===a?.5:a,o.minNeighbors=t===i?1:i,o.doCannyPruning=t===s?!0:!!s,o._haarchanged=!!o.haardata},path:n.getPath(e.AMD),dispose:function(){var e=this;return e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var n=this;return n.haardata=e,n._haarchanged=!0,n},params:function(e){var n=this;return e&&(e[_]("baseScale")&&(n.baseScale=e.baseScale),e[_]("scaleIncrement")&&(n.scaleIncrement=e.scaleIncrement),e[_]("stepIncrement")&&(n.stepIncrement=e.stepIncrement),e[_]("minNeighbors")&&(n.minNeighbors=e.minNeighbors),e[_]("doCannyPruning")&&(n.doCannyPruning=e.doCannyPruning),e[_]("cannyLow")&&(n.cannyLow=e.cannyLow),e[_]("cannyHigh")&&(n.cannyHigh=e.cannyHigh)),n},serialize:function(){var e=this,n={filter:e.name,_isOn:!!e._isOn,params:{baseScale:e.baseScale,scaleIncrement:e.scaleIncrement,stepIncrement:e.stepIncrement,minNeighbors:e.minNeighbors,doCannyPruning:e.doCannyPruning,cannyLow:e.cannyLow,cannyHigh:e.cannyHigh}};return e._haarchanged&&(n.params.haardata=e.haardata,e._haarchanged=!1),n},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,n[_]("haardata")&&(t.haardata=n.haardata),t.baseScale=n.baseScale,t.scaleIncrement=n.scaleIncrement,t.stepIncrement=n.stepIncrement,t.minNeighbors=n.minNeighbors,t.doCannyPruning=n.doCannyPruning,t.cannyLow=n.cannyLow,t.cannyHigh=n.cannyHigh),t},getMeta:function(){return this.objects},setMeta:function(e){return this.objects=e,this},apply:function(e,n,t){var i,s,o,l,u,d,g,_,v,y,b,M,C,w,O,I,z,A,x,S,P,N,Y,k,X,F,q,D,L,R,H,E,T,B,G,j,U,W,$,k,V,Q,J,K,Z,en,nn,tn,rn,an,sn,on,ln,un,hn,cn,fn,dn,gn,pn=this,mn=e.length>>>2,_n=pn.haardata,vn=_n.stages,yn=pn.baseScale,bn=pn.scaleIncrement,Mn=pn.stepIncrement,Cn=pn.minNeighbors,wn=pn.doCannyPruning,On=pn.cannyLow,In=pn.cannyHigh,zn=_n.size1,An=_n.size2,xn=p(n/zn,t/An),Sn=[],Pn=mn-1,Nn=0,Yn=0,kn=vn.length;for(r(e,n,t,s=new f(mn),o=new c(mn),l=new c(mn),u=new c(mn)),wn&&a(s,n,t,d=new c(mn)),X=0,F=n-1,q=0,D=mn-n,i=yn;xn>=i;){for(v=~~(i*zn),g=~~(v*Mn),y=~~(i*An),_=~~(y*Mn),O=y*n,I=_*n,b=Yn*I,P=n-v,N=t-y,L=v*y,R=1/L,C=Yn,w=b;N>C;C+=_,w+=I)for(M=Nn;P>M;M+=g)if(z=M-1+w-n,A=z+v,x=z+O,S=x+v,z=0>z?0:z>Pn?Pn:z,A=0>A?0:A>Pn?Pn:A,x=0>x?0:x>Pn?Pn:x,S=0>S?0:S>Pn?Pn:S,!(wn&&(B=R*(d[S]-d[x]-d[A]+d[z]),On>B||B>In))){for(H=R*(o[S]-o[x]-o[A]+o[z]),E=R*(l[S]-l[x]-l[A]+l[z]),T=E-H*H,T=T>1?m(T):1,G=!0,Y=0;kn>Y;Y++){for(j=vn[Y],U=j.thres,W=j.trees,$=W.length,gn=0,k=0;$>k;k++)for(J=W[k].feats,V=0;;){if(K=J[V],Z=K.rects,en=Z.length,nn=K.thres,tn=0,K.tilt)for(rn=0;en>rn;rn++)an=Z[rn],sn=M+~~(i*an[0]),on=(C-1+~~(i*an[1]))*n,ln=M+~~(i*(an[0]+an[2])),un=(C-1+~~(i*(an[1]+an[2])))*n,hn=M+~~(i*(an[0]-an[3])),cn=(C-1+~~(i*(an[1]+an[3])))*n,fn=M+~~(i*(an[0]+an[2]-an[3])),dn=(C-1+~~(i*(an[1]+an[2]+an[3])))*n,sn=X>sn?X:sn>F?F:sn,ln=X>ln?X:ln>F?F:ln,hn=X>hn?X:hn>F?F:hn,fn=X>fn?X:fn>F?F:fn,on=q>on?q:on>D?D:on,un=q>un?q:un>D?D:un,cn=q>cn?q:cn>D?D:cn,dn=q>dn?q:dn>D?D:dn,tn+=an[4]*(u[fn+dn]-u[hn+cn]-u[ln+un]+u[sn+on]);
else for(rn=0;en>rn;rn++)an=Z[rn],sn=M-1+~~(i*an[0]),ln=M-1+~~(i*(an[0]+an[2])),on=n*(C-1+~~(i*an[1])),un=n*(C-1+~~(i*(an[1]+an[3]))),sn=X>sn?X:sn>F?F:sn,ln=X>ln?X:ln>F?F:ln,on=q>on?q:on>D?D:on,un=q>un?q:un>D?D:un,tn+=an[4]*(o[ln+un]-o[sn+un]-o[ln+on]+o[sn+on]);if(Q=nn*T>tn*R?0:1){if(K.has_r){gn+=K.r_val;break}V=K.r_node}else{if(K.has_l){gn+=K.l_val;break}V=K.l_node}}if(G=gn>U,!G)break}G&&Sn.push({x:M,y:C,width:v,height:y})}i*=bn}return pn.objects=h(Sn,Cn),e}})}(n),!function(n){"use strict";{var t=(n._notSupportClamp,Math.min),r=Math.floor,a=n.CHANNEL.RED;n.CHANNEL.GREEN,n.CHANNEL.BLUE,n.CHANNEL.ALPHA}n.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,path:n.getPath(e.AMD),init:function(e,n,t,r,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=n||a,s.dstChannel=t||a,s.centerX=r||0,s.centerY=i||0,e&&s.setSrc(e)},dispose:function(){var e=this;return e.srcImg=null,e._srcImg=null,e.$super("dispose"),e},setSrc:function(e){var n=this;return e?(n.srcImg=e,n._srcImg={data:e.getData(),width:e.width,height:e.height}):(n.srcImg=null,n._srcImg=null),n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_srcImg:e._srcImg,centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t._srcImg=n._srcImg,t.centerX=n.centerX,t.centerY=n.centerY,t.srcChannel=n.srcChannel,t.dstChannel=n.dstChannel),t},apply:function(e,n,a){var i=this;if(!i._isOn||!i._srcImg)return e;var s,o,l,u,h,c,f=i._srcImg.data,d=e.length,g=(f.length,i._srcImg.width),p=i._srcImg.height,m=i.srcChannel,_=i.dstChannel,v=t(n,g),y=t(a,p),b=i.centerX||0,M=i.centerY||0,C=g>>1,w=p>>1;for(b=r(b*(n-1))-C,M=r(M*(a-1))-w,s=0,o=0,l=0,s=0;d>s;s+=4,o++)o>=n&&(o=0,l++),h=o-b,c=l-M,h>=0&&v>h&&c>=0&&y>c&&(u=h+c*g<<2,e[s+_]=f[u+m]);return e}})}(n),!function(n){"use strict";var t=(n._notSupportClamp,Math.min),r=Math.floor;n.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,path:n.getPath(e.AMD),init:function(e,n,t){var r=this;r.centerX=n||0,r.centerY=t||0,r._alphaMask=null,r.alphaMask=null,e&&r.setMask(e)},dispose:function(){var e=this;return e.alphaMask=null,e._alphaMask=null,e.$super("dispose"),e},setMask:function(e){var n=this;return e?(n.alphaMask=e,n._alphaMask={data:e.getData(),width:e.width,height:e.height}):(n.alphaMask=null,n._alphaMask=null),n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_alphaMask:e._alphaMask,centerX:e.centerX,centerY:e.centerY}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t._alphaMask=n._alphaMask,t.centerX=n.centerX,t.centerY=n.centerY),t},apply:function(e,n,a){var i=this;if(!i._isOn||!i._alphaMask)return e;var s,o,l,u,h,c,f=i._alphaMask.data,d=i._alphaMask.width,g=i._alphaMask.height,p=e.length,m=(f.length,t(n,d)),_=t(a,g),v=i.centerX||0,y=i.centerY||0,b=d>>1,M=g>>1;for(v=r(v*(n-1))-b,y=r(y*(a-1))-M,o=0,l=0,s=0;p>s;s+=4,o++)o>=n&&(o=0,l++),h=o-v,c=l-y,h>=0&&m>h&&c>=0&&_>c?(u=h+c*d<<2,e[s+3]=f[u+3]):e[s+3]=0;return e}})}(n),!function(n){"use strict";var t,r="hasOwnProperty",a=Math.min,i=Math.max,s=Math.round,o=(Math.floor,Math.abs),l=n._notSupportClamp;t={normal:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=d,i=g,s=p,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},lighten:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=h>d?h:d,i=c>g?c:g,s=f>p?f:p,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},darken:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=h>d?d:h,i=c>g?g:c,s=f>p?p:f,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},multiply:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=h*d*.003921568627451,i=c*g*.003921568627451,s=f*p*.003921568627451,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},average:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=.5*(h+d),i=.5*(c+g),s=.5*(f+p),h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},add:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=h+d,i=c+g,s=f+p,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},subtract:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=255>h+d?0:h+d-255,i=255>c+g?0:c+g-255,s=255>f+p?0:f+p-255,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},difference:function(e,n,t,r){var a,i,s,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];a=o(g-c),i=o(p-f),s=o(m-d),c=a*u+c*h,f=i*u+f*h,d=s*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},negation:function(e,n,t,r){var a,i,s,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];a=255-o(255-g-c),i=255-o(255-p-f),s=255-o(255-m-d),c=a*u+c*h,f=i*u+f*h,d=s*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},screen:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=255-((255-d)*(255-h)>>8),i=255-((255-g)*(255-c)>>8),s=255-((255-p)*(255-f)>>8),h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},exclusion:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=d+h-2*d*h*.003921568627451,i=g+c-2*g*c*.003921568627451,s=p+f-2*p*f*.003921568627451,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},overlay:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=128>h?2*d*h*.003921568627451:255-2*(255-d)*(255-h)*.003921568627451,i=128>c?2*g*c*.003921568627451:255-2*(255-g)*(255-c)*.003921568627451,a=128>f?2*p*f*.003921568627451:255-2*(255-p)*(255-f)*.003921568627451,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},softlight:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=128>h?2*((d>>1)+64)*.003921568627451*h:255-2*(255-((d>>1)+64))*(255-h)*.003921568627451,i=128>c?2*((g>>1)+64)*.003921568627451*c:255-2*(255-((g>>1)+64))*(255-c)*.003921568627451,s=128>f?2*((p>>1)+64)*.003921568627451*f:255-2*(255-((p>>1)+64))*(255-f)*.003921568627451,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},hardlight:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=128>d?2*h*d*.003921568627451:255-2*(255-h)*(255-d)*.003921568627451,i=128>g?2*c*g*.003921568627451:255-2*(255-c)*(255-g)*.003921568627451,s=128>p?2*f*p*.003921568627451:255-2*(255-f)*(255-p)*.003921568627451,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},colordodge:function(e,n,t,r){var i,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];i=255==c?c:a(255,(g<<8)/(255-c)),s=255==f?f:a(255,(p<<8)/(255-f)),o=255==d?c:a(255,(m<<8)/(255-d)),c=i*u+c*h,f=s*u+f*h,d=o*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},colorburn:function(e,n,t,r){var a,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];a=0==c?c:i(0,255-(255-g<<8)/c),s=0==f?f:i(0,255-(255-p<<8)/f),o=0==d?d:i(0,255-(255-m<<8)/d),c=a*u+c*h,f=s*u+f*h,d=o*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},linearlight:function(e,n,t,r){var a,i,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];128>c?(o=2*c,a=255>o+g?0:o+g-255):(o=2*(c-128),a=o+g),128>f?(o=2*f,i=255>o+p?0:o+p-255):(o=2*(f-128),i=o+p),128>d?(o=2*d,s=255>o+m?0:o+m-255):(o=2*(d-128),s=o+m),c=a*u+c*h,f=i*u+f*h,d=s*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},reflect:function(e,n,t,r){var i,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];i=255==c?c:a(255,g*g/(255-c)),s=255==f?f:a(255,p*p/(255-f)),o=255==d?d:a(255,m*m/(255-d)),c=i*u+c*h,f=s*u+f*h,d=o*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},glow:function(e,n,t,r){var i,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];i=255==g?g:a(255,c*c/(255-g)),s=255==p?p:a(255,f*f/(255-p)),o=255==m?m:a(255,d*d/(255-m)),c=i*u+c*h,f=s*u+f*h,d=o*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},phoenix:function(e,n,t,r){var s,o,u,h=.003921568627451*t[r+3],c=1-h,f=e[n],d=e[n+1],g=e[n+2],p=t[r],m=t[r+1],_=t[r+2];s=a(p,f)-i(p,f)+255,o=a(m,d)-i(m,d)+255,u=a(_,g)-i(_,g)+255,f=s*h+f*c,d=o*h+d*c,g=u*h+g*c,l&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g),e[n]=~~f,e[n+1]=~~d,e[n+2]=~~g},vividlight:function(e,n,t,r){var s,o,u,h,c=.003921568627451*t[r+3],f=1-c,d=e[n],g=e[n+1],p=e[n+2],m=t[r],_=t[r+1],v=t[r+2];128>d?(h=2*d,s=0==h?h:i(0,255-(255-m<<8)/h)):(h=2*(d-128),s=255==h?h:a(255,(m<<8)/(255-h))),128>g?(h=2*g,o=0==h?h:i(0,255-(255-_<<8)/h)):(h=2*(g-128),o=255==h?h:a(255,(_<<8)/(255-h))),128>p?(h=2*p,u=0==h?h:i(0,255-(255-v<<8)/h)):(h=2*(g-128),u=255==h?h:a(255,(v<<8)/(255-h))),d=s*c+d*f,g=o*c+g*f,p=u*c+p*f,l&&(d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,p=0>p?0:p>255?255:p),e[n]=~~d,e[n+1]=~~g,e[n+2]=~~p},pinlight:function(e,n,t,r){var a,i,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];128>c?(o=2*c,a=o>g?o:g):(o=2*(c-128),a=o>g?g:o),128>f?(o=2*f,i=o>p?o:p):(o=2*(c-128),i=o>p?p:o),128>d?(o=2*d,s=o>m?o:m):(o=2*(d-128),s=o>m?m:o),c=a*u+c*h,f=i*u+f*h,d=s*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},hardmix:function(e,n,t,r){var s,o,u,h,c=.003921568627451*t[r+3],f=1-c,d=e[n],g=e[n+1],p=e[n+2],m=t[r],_=t[r+1],v=t[r+2];128>d?(h=2*d,s=0==h?h:i(0,255-(255-m<<8)/h)):(h=2*(d-128),s=255==h?h:a(255,(m<<8)/(255-h))),s=128>s?0:255,128>g?(h=2*g,o=0==h?h:i(0,255-(255-_<<8)/h)):(h=2*(g-128),o=255==h?h:a(255,(_<<8)/(255-h))),o=128>o?0:255,128>p?(h=2*p,u=0==h?h:i(0,255-(255-v<<8)/h)):(h=2*(p-128),u=255==h?h:a(255,(v<<8)/(255-h))),u=128>u?0:255,d=s*c+d*f,g=o*c+g*f,p=u*c+p*f,l&&(d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,p=0>p?0:p>255?255:p),e[n]=~~d,e[n+1]=~~g,e[n+2]=~~p}},t.lineardodge=t.add,t.linearburn=t.subtract,n.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendImage:null,startX:0,startY:0,path:n.getPath(e.AMD),init:function(e,n){var t=this;t.startX=0,t.startY=0,t._blendImage=null,t.blendImage=null,t._blendMode=null,e&&t.setImage(e),n&&t.setMode(n)},dispose:function(){var e=this;return e.blendImage=null,e._blendImage=null,e._blendMode=null,e.$super("dispose"),e},setImage:function(e){var n=this;return e?(n.blendImage=e,n._blendImage={data:e.getData(),width:e.width,height:e.height}):(n.blendImage=null,n._blendImage=null),n},setMode:function(e){var n=this;return e?(n._blendMode=(""+e).toLowerCase(),t[r](n._blendMode)||(n._blendMode=null)):n._blendMode=null,n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_blendImage:e._blendImage,_blendMode:e._blendMode,startX:e.startX,startY:e.startY}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.startX=n.startX,t.startY=n.startY,t._blendImage=n._blendImage,t.setMode(n._blendMode)),t},reset:function(){var e=this;return e.startX=0,e.startY=0,e._blendMode=null,e},apply:function(e,n,r){var i=this;if(!i._isOn||!i._blendMode||!i._blendImage)return e;var o,l,u,h,c,f,d,g,p,m,_,v,y,b,M=i.startX||0,C=i.startY||0,w=0,O=0,I=i._blendImage,z=t[i._blendMode];if(0>M&&(w=-M,M=0),0>C&&(O=-C,C=0),h=I.width,c=I.height,M>=n||C>=r)return e;if(w>=h||O>=c)return e;if(M=s(M),C=s(C),w=s(w),O=s(O),o=a(n-M,h-w),l=a(r-C,c-O),0>=o||0>=l)return e;for(u=I.data,m=M,_=C*n,v=w,y=O*h,f=M+o,d=w+o,g=0,p=l*o;p>g;)b=v+y<<2,u[b+3]&&z(e,m+_<<2,u,b),g++,m++,m>=f&&(m=M,_+=n),v++,v>=d&&(v=w,y+=h);return e}})}(n),e.FILTER_PLUGINS});

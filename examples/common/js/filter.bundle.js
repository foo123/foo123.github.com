/**
*
*   Classy.js
*   @version: 0.9.3
*   @built on 2016-07-19 17:09:27
*
*   Object-Oriented micro-framework for JavaScript
*   https://github.com/foo123/classy.js
*
**/!function(e,n,i){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=i.call(e)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return i.moduleUri=n.uri,i.call(e)}):n in e||(e[n]=i.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"Classy",function(){"use strict";var e=void 0,n="constructor",i="prototype",t="__proto__",r="__static__",l="__private__",u="$super",a="$static",o="$latestatic",f="$class",c=2,s=4,b=8,d=256,m=Object,p=m[i],v=Function,g=v[i],h=String,y=Number,x=RegExp,w=Array,j=p.toString,E=(g.call.bind(g.toString),"hasOwnProperty"),_="propertyIsEnumerable",q=m.keys,I=m.defineProperty,$=function(e){return typeof e},A=function(e){throw new TypeError(e)},P=2,S=3,T=4,C=8,M=9,N=16,O=32,R=64,F=128,L=256,U=512,V=1024,k={"[object Array]":N,"[object RegExp]":F,"[object Number]":P,"[object String]":C,"[object Function]":R,"[object Object]":O},B=function(n){var i;return null===n?L:!0===n||!1===n?T:e===n?U:(i=j.call(n),i=k[i]||V,P===i||n instanceof y?isNaN(n)?S:P:C===i||n instanceof h?1===n.length?M:C:N===i||n instanceof w?N:F===i||n instanceof x?F:R===i||n instanceof v?R:O===i?O:V)},D=function(e,n){var i,t=n.length,r=[].concat(e);for(i=0;t>i;i++)-1<r.indexOf(n[i])||r.push(n[i]);return r},z=function(e,n){O!==B(e)&&A("bad desc");var i={};if(e[E]("enumerable")&&(i.enumerable=!!n.enumerable),e[E]("configurable")&&(i.configurable=!!n.configurable),e[E]("value")&&(i.value=n.value),e[E]("writable")&&(i.writable=!!e.writable),e[E]("get")){var t=e.get;R!==B(t)&&"undefined"!==t&&A("bad get"),i.get=t}if(e[E]("set")){var r=e.set;R!==B(r)&&"undefined"!==r&&A("bad set"),i.set=r}return("get"in i||"set"in i)&&("value"in i||"writable"in i)&&A("identity-confused descriptor"),i},G=m.defineProperties||function(e,n){"object"===$(e)&&null!==e||A("bad obj"),n=m(n);for(var i=q(n),t=[],r=0;r<i.length;r++)t.push([i[r],z(n[i[r]],e)]);for(var r=0;r<t.length;r++)I(e,t[r][0],t[r][1]);return e},H=function(){},J=m.create||function(e,n){var r,l=function(){};return l[i]=e,r=new l,r[t]=e,"object"===$(n)&&G(r,n),r},K=function(){var e,n,i,t,r,l,u,a=arguments;for(n=a[0]||{},e=a.length,l=1;e>l;l++)if(i=a[l],O===B(i))for(r in i)i[E](r)&&i[_](r)&&(t=i[r],u=B(t),P&u?n[r]=0+t:(C|N)&u?n[r]=t.slice(0):n[r]=t);return n},Q=function(e,i,t){var r,l,u=!!i;if(u||t)if(r={},i=u?i+"$":i,t&&R===B(t))for(l in e)e[E](l)&&(n!==l?(u&&R===B(e[l])&&(r[i+l]=e[l]),r[t(l,e[l])]=e[l]):r[l]=e[l]);else for(l in e)e[E](l)&&(n!==l?(u&&R===B(e[l])&&(r[i+l]=e[l]),t&&l in t?r[t[l]]=e[l]:r[l]=e[l]):r[l]=e[l]);else r=e;return r},W=function(e){var n=e[u]||H,i=e[u+"v"]||H,t=null;return[function(i,r,l,u,a,o,f,c,s,b,d){var m,p;return t===i?m=n.call(this,i,r,l,u,a,o,f,c,s,b,d):(p=e[i])&&(t=i,m=p.call(this,r,l,u,a,o,f,c,s,b,d),t=null),m},function(n,r){var l,u;return t===n?l=i.call(this,n,r):(u=e[n])&&(t=n,l=r&&r.length?u.apply(this,r):u.call(this),t=null),l}]},X=function(e,n){return this instanceof X?(this.factory=e,void(this.qualifier=(P===B(n)?n:0)|c)):new X(e,n)},Y=function(e,n){return this instanceof Y?(this.prop=e,void(this.qualifier=(P===B(n)?n:0)|c)):new Y(e,n)},Z=function(t,c,p,v){t=t||m,c=c||{};var g,h,y,x,w,j,_,I,$,A,S=t[a]||null,T=t[o]||{},M=t[i],F=null,L=K({},T),U=null,V={};c[E](n)||(c[n]=function(){}),g=c[n],c[E](l)&&(V=c[l]||{},delete c[l]),c[E](r)&&(F=c[r],U=q(F),delete c[r]);for($ in c)if(c[E]($)){if(A=c[$],A instanceof X){if(b&A.qualifier){d&A.qualifier?L[$]=A:((F=F||{})[$]=A.factory(t,V,g),(U=U||[]).push($)),delete c[$];continue}if(s&A.qualifier){V[$]=A,delete c[$];continue}A=c[$]=A.factory(M,V,g)}R===B(A)&&(A[u]=M[$]||H)}for($ in V)V[E]($)&&(A=V[$],A instanceof X&&(A=V[$]=A.factory(M,V,g)),R!==B(A)&&delete V[$]);if(g[i]=Q(J(M),p,v),g[i]=K(g[i],c),h=W(M),w={},w[f]=w[n]={value:g,enumerable:!1,writable:!0,configurable:!0},w[u]={value:h[0],enumerable:!1,writable:!0,configurable:!0},w[u+"v"]={value:h[1],enumerable:!1,writable:!0,configurable:!0},G(g[i],w),w={},S||U)for(S=D(S||[],U||[]),x=S.length,y=0;x>y;y++){if(j=S[y],_=null,F&&e!==F[j]){if((A=F[j])instanceof X){if((b|d)&A.qualifier){L[j]=A;continue}_=A.factory(t,V,g)}else{if(L[E](j))continue;_=F[j]}R===B(_)&&(_[u]=t[j]||H)}else e!==t[j]&&(I=B(t[j]),_=O===I?K(null,t[j]):(C|N)&I?t[j].slice(0):P&I?0+t[j]:t[j]);w[j]={value:_,enumerable:!1,writable:!0,configurable:!0}}for(j in L)L[E](j)&&(_=L[j].factory(t,V,g),w[j]={value:_,enumerable:!1,writable:!0,configurable:!0});return w[a]={value:S,enumerable:!1,writable:!0,configurable:!0},w[o]={value:L,enumerable:!1,writable:!0,configurable:!0},w[u]={value:t,enumerable:!1,writable:!0,configurable:!0},G(g,w),g},ee=K,ne=K,ie=function(n){var t,r,l,c;if(R===B(n)){if(u in n&&(n[u]=e),f in n&&(n[f]=e),o in n&&(n[o]=e),a in n){for(l=n[a],t=0,r=l.length;r>t;t++)c=l[t],c in n&&(R===B(n[c])&&n[c][u]&&(n[c][u]=e),n[c]=e);n[a]=e}l=n[i];for(c in l)R===B(l[c])&&(l[c][u]&&(l[c][u]=e),l[c]=e);l[u]=e,l[u+"v"]=e}},te=function(){var e=arguments,n=e.length,t=null;if(b===e[0])return e[1]||{};if(n>=2){var r=B(e[0]);r=R===r?{Extends:e[0]}:O===r?e[0]:{Extends:m};var l,u,a=e[1]||{},o={},f=r[E]("Extends")?r.Extends:r[E]("extends")?r["extends"]:m,c=r[E]("Implements")?r.Implements:r[E]("implements")?r["implements"]:null,s=r[E]("Mixin")?r.Mixin:r[E]("mixin")?r.mixin:null,d=null;if(c=c?[].concat(c):null,s=s?[].concat(s):null)for(l=0,u=s.length;u>l;l++)O===B(s[l])?s[l][E]("mixin")&&s[l].mixin&&s[l].mixin[i]&&(d=Q(s[l].mixin[i],s[l].namespace||null,s[l].as||null),o=ne(o,d)):s[l][i]&&(d=s[l][i],o=ne(o,d));if(c)for(l=0,u=c.length;u>l;l++)O===B(c[l])?c[l][E]("implements")&&c[l]["implements"]&&c[l]["implements"][i]&&(d=Q(c[l]["implements"][i],c[l].namespace||null,c[l].as||null),o=ee(o,d)):c[l][i]&&(d=c[l][i],o=ee(o,d));t=O===B(f)?Z(f["extends"]||m,K(o,a),f.namespace||null,f.as||null):Z(f,K(o,a))}else t=Z(m,e[0]);return t},re={VERSION:"0.9.3",PUBLIC:c,STATIC:b,LATE:d,PRIVATE:s,Type:B,Create:J,Merge:K,Alias:Q,Implements:ee,Mixin:ne,Extends:Z,Dispose:ie,Method:X,Prop:Y,Class:te};return re});
/**
*
*   Asynchronous.js
*   @version: 0.4.8
*
*   Simple JavaScript class to manage asynchronous, parallel, linear, sequential and interleaved tasks
*   https://github.com/foo123/asynchronous.js
*
**/
!function(n,e,r){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(n.$deps=n.$deps||{})&&(n.EXPORTED_SYMBOLS=[e])&&(n[e]=n.$deps[e]=r.call(n)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[e]=r.call(n)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(e,[],function(t){t(e,r.call(n))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["module"],function(e){return r.moduleUri=e.uri,r.call(n)}):e in n||(n[e]=r.call(n)||1)&&"function"==typeof define&&define.amd&&define(function(){return n[e]})}(this,"Asynchronous",function ModuleFactory__Asynchronous(undef){"use strict";function formatOptions(n){var e,r=[];if(n)for(e in n)n[HAS](e)&&r.push(e+"="+(!0===n[e]||1===n[e]?"yes":!1===n[e]||0===n[e]?"no":n[e]));return r.join(",")}function runParallelised(n,e){n.$runmode=PARALLELISED,n.$running=!1}function runLinearised(n,e){var r,t=n,o=t.$queue;if(t.$runmode=LINEARISED,o){for(;o.length&&(!o[0]||!o[0].canRun());)o.shift();o.length?(t.$running=!0,r=o.shift(),e?r.runWithArgs(e):r.run(),r.complete()):t.$running=!1}}function runInterleaved(n,e){var r,t=n,o=t.$queue,s=0;if(t.$runmode=INTERLEAVED,o&&o.length){for(t.$running=!0;s<o.length;)r=o[s],r&&r.canRun()?(e?r.runWithArgs(e):r.run(),r.isFinished()?(o.shift(),r.complete()):s++):o.shift();t.$running=!1,t.$timer=SetTime(curry(runInterleaved,t),t.$interval)}}function runSequenced(n,e){var r,t=n,o=t.$queue;t.$runmode=SEQUENCED,o&&o.length&&(r=o[0],r&&r.canRun()?(t.$running=!0,e?r.runWithArgs(e):r.run(),r.isFinished()&&(o.shift(),r.complete())):o.shift(),t.$running=!1,t.$timer=SetTime(curry(runSequenced,t),t.$interval))}var root=this,PROTO="prototype",HAS="hasOwnProperty",Obj=Object,Arr=Array,Func=Function,FP=Func[PROTO],OP=Obj[PROTO],AP=Arr[PROTO],slice=FP.call.bind(AP.slice),toString=OP.toString,is_function=function(n){return"function"==typeof n},is_instance=function(n,e){return n instanceof e},SetTime=setTimeout,ClearTime=clearTimeout,UNDEFINED=undef,UNKNOWN=0,NODE=1,BROWSER=2,DEFAULT_INTERVAL=60,NONE=0,INTERLEAVED=1,LINEARISED=2,PARALLELISED=3,SEQUENCED=4,isXPCOM="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"],isNode="undefined"!=typeof global&&"[object global]"===toString.call(global),isNodeProcess=isNode&&!!process.env.NODE_UNIQUE_ID,isSharedWorker=!isXPCOM&&!isNode&&"undefined"!=typeof SharedWorkerGlobalScope&&"function"==typeof importScripts,isWebWorker=!isXPCOM&&!isNode&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,isBrowser=!(isXPCOM||isNode||isWebWorker||isSharedWorker||"undefined"==typeof navigator||"undefined"==typeof document),isBrowserWindow=isBrowser&&!!root.opener,isBrowserFrame=isBrowser&&window.self!==window.top,isAMD="function"==typeof define&&define.amd,supportsMultiThread=isNode||"function"==typeof Worker||"function"==typeof SharedWorker,isThread=isNodeProcess||isSharedWorker||isWebWorker,Thread,numProcessors=isNode?require("os").cpus().length:4,fromJSON=JSON.parse,toJSON=JSON.stringify,onMessage,shared_port,curry=function(n,e){return function(){return n(e)}},URL="undefined"!=typeof root.webkitURL?root.webkitURL:"undefined"!=typeof root.URL?root.URL:null,blobURL=function(n,e){return n&&URL?URL.createObjectURL(new Blob(n.push?n:[n],e||{type:"text/javascript"})):n},path=function n(e){var r;return isNode?{file:__filename,path:__dirname}:isSharedWorker||isWebWorker?{file:r=self.location.href,path:r.split("/").slice(0,-1).join("/")}:isAMD&&e?{file:r=e,path:r.split("/").slice(0,-1).join("/")}:isBrowser&&(r=document.getElementsByTagName("script"))&&r.length?(n.link||(n.link=document.createElement("a")),n.link.href=r[r.length-1].src,r=n.link.href,{file:r,path:r.split("/").slice(0,-1).join("/")}):{path:null,file:null}},thisPath=path(ModuleFactory__Asynchronous.moduleUri),tpf=thisPath.file,notThisPath=function(n){return!(!n||!n.length||n===tpf)},extend=function(n,e){if(n=n||{},e)for(var r in e)e[HAS](r)&&(n[r]=e[r]);return n},_uuid=0;if(isSharedWorker?(root.close=function(){},root.postMessage=function(n){},onMessage=function e(n){shared_port?(n&&shared_port.addEventListener("message",n),e.handler=null):n&&(e.handler=n)},onconnect=function(n){shared_port=n.ports[0],root.close=function(){shared_port.close()},root.postMessage=function(n){shared_port.postMessage(n)},onMessage.handler&&(shared_port.addEventListener("message",onMessage.handler),onMessage.handler=null),shared_port.start()}):onMessage=isWebWorker?function(n){n&&(onmessage=n)}:isNodeProcess?function(n){n&&process.on("message",function(e){n(fromJSON(e))})}:function(n){},isNode){var fs=require("fs"),ps=require("child_process");root.close=function(){process.exit()},root.postMessage=function(n){process.send(toJSON({data:n}))},root.importScripts=function(scripts){if(scripts&&(scripts=scripts.split(",")).length)for(var i=0,src,ok;i<scripts.length;){ok=!0;try{src=fs.readFileSync(scripts[i++]),eval(src)}catch(e){ok=e}if(!0!==ok)throw ok}},Thread=function(n){var e=this;e.process=ps.fork(n),e.process.on("message",function(n){e.onmessage&&e.onmessage(fromJSON(n))}),e.process.on("error",function(n){e.onerror&&e.onerror(n)})},Thread.Shared=Thread,Thread[PROTO]={constructor:Thread,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.send(toJSON({data:n})),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}}else Thread=function(n){var e=this;e.process=new Worker(n),e.process.onmessage=function(n){e.onmessage&&e.onmessage(n)},e.process.onerror=function(n){e.onerror&&e.onerror(n)}},Thread.Shared=Thread,Thread[PROTO]={constructor:Thread,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.postMessage(n),this},terminate:function(){return this.process&&(this.process.terminate(),this.process=null),this}},"function"==typeof SharedWorker&&(Thread.Shared=function(n){var e=this;e.process=new SharedWorker(n),e.process.port.start(),e.process.port.onmessage=function(n){e.onmessage&&e.onmessage(n)},e.process.port.onerror=e.process.onerror=function(n){e.onerror&&e.onerror(n)}},Thread.Shared[PROTO]={constructor:Thread.Shared,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.port.postMessage(n),this},terminate:function(){return this.process&&(this.process.port.close(),this.process=null),this}});var BrowserWindow=function r(n){var e=this;return e instanceof r?(e.$id=(++_uuid).toString(16),void(e.options=extend({width:400,height:400,toolbar:0,location:0,directories:0,status:0,menubar:0,scrollbars:1,resizable:1},n))):new r(n)};BrowserWindow[PROTO]={constructor:BrowserWindow,options:null,$id:null,$window:null,dispose:function(){var n=this;return n.$window&&n.close(),n.$window=null,n.$id=null,n.options=null,n},close:function(){var n=this;return n.$window&&(n.$window.closed||n.$window.close(),n.$window=null),n},ready:function(n,e){var r=this,t=function o(){!r.$window||n&&!r.$window[n]?setTimeout(o,50):e()};return setTimeout(t,0),r},open:function(n){var e=this;return!e.$window&&n&&(e.$window=window.open(n.push?blobURL(["\ufeff"].concat(n),{type:"text/html;charset=utf-8"}):n,e.$id,formatOptions(e.options))),e},write:function(n){var e=this;return e.$window&&n&&e.$window.document.write(n),e}};var Task=function t(n){if(n instanceof t)return n;if(!(this instanceof t))return new t(n);var e,r=this,o=null,s=null,i=null,u=!1,a=!1,c=!1,l=!1,f=!1,p=!1,d=null,h=0,m=1,$=null,g=null,v=null,N=undef;r.queue=function(n){return arguments.length?(o=n,r):o},r.jumpNext=function(n){o&&o.jumpNext(!1,n)},r.abort=function(n){o&&(o.abort(!1),n&&(o.dispose(),o=null))},r.dispose=function(){o&&(o.dispose(),o=null)},r.task=function(n){return s=n,r},n&&r.task(n),r.run=e=function(){return s.jumpNext=r.jumpNext,s.abort=r.abort,s.dispose=r.dispose,N=s(),u=!0,s.jumpNext=null,s.abort=null,s.dispose=null,N},r.runWithArgs=function(n){return s.jumpNext=r.jumpNext,s.abort=r.abort,s.dispose=r.dispose,N=s.apply(null,n),u=!0,s.jumpNext=null,s.abort=null,s.dispose=null,N},r.canRun=function(){return s&&(!u||a||c||l||f||p)?(a||c)&&h>=$?!1:c&&!d?!1:!l&&!f||N!==g:!1},r.iif=function(n,e,t){return n?r.task(e):arguments.length>2&&r.task(t),r},r.until=function(n){return N=undef,d=null,g=n,f=!0,p=!1,a=!1,c=!1,l=!1,r.run=e,r},r.untilNot=function(n){return N=undef,d=null,v=n,p=!0,f=!1,a=!1,c=!1,l=!1,r.run=e,r},r.loop=function(n,e,t){return N=undef,d=null,h=e||0,m=t||1,$=n,a=!0,f=!1,p=!1,c=!1,l=!1,r.run=function(){var n;return n=s(h),h+=m,N=n,u=!0,n},r},r.each=function(n){return N=undef,d=n,h=0,m=1,$=n?n.length||0:0,c=!0,f=!1,p=!1,a=!1,l=!1,r.run=function(){var n;return n=s(d[h],h),h++,N=n,u=!0,n},r},r.recurse=function(n,e){return d=null,N=n,g=e,l=!0,f=!1,p=!1,a=!1,c=!1,r.run=function(){var n;return n=s(N),N=n,u=!0,n},r},r.isFinished=function(){var n=!u||p||f||a||c||l;return n&&(f||l)&&N===g&&(n=!1),n&&p&&N!==v&&(n=!1),n&&(a||c)&&h>=$&&(n=!1),!n},r.onComplete=function(n){return i=n||null,r},r.complete=function(){return i&&is_function(i)&&i(),r}},Asynchronous=function o(n,e){if(is_instance(n,Task))return n;if(is_function(n))return new Task(n);if(!is_instance(this,o))return new o(n,e);var r=this;r.$interval=arguments.length?parseInt(n,10)||DEFAULT_INTERVAL:DEFAULT_INTERVAL,r.$timer=null,r.$runmode=NONE,r.$running=!1,r.$queue=[],isThread&&!1!==e&&r.initThread()};if(Asynchronous.VERSION="0.4.8",Asynchronous.Thread=Thread,Asynchronous.Task=Task,Asynchronous.BrowserWindow=BrowserWindow,Asynchronous.MODE={NONE:NONE,INTERLEAVE:INTERLEAVED,LINEAR:LINEARISED,PARALLEL:PARALLELISED,SEQUENCE:SEQUENCED},Asynchronous.Platform={UNDEFINED:UNDEFINED,UNKNOWN:UNKNOWN,NODE:NODE,BROWSER:BROWSER},Asynchronous.supportsMultiThreading=function(){return supportsMultiThread},Asynchronous.isPlatform=function(n){return NODE===n?isNode:BROWSER===n?isBrowser:undef},Asynchronous.isThread=function(n){return NODE===n?isNodeProcess:BROWSER===n?isSharedWorker||isWebWorker:isThread},Asynchronous.path=path,Asynchronous.blob=blobURL,Asynchronous.load=function(n,e,r){if(n){var t=function(){n=n.split(".");for(var e=root;n.length;)n[0]&&n[0].length&&e[n[0]]&&(e=e[n[0]]),n.shift();return e&&root!==e?is_function(e)?!1!==r?new e:e():e:void 0};return e&&e.length&&(e=e.filter(notThisPath),e.length&&importScripts(e.join(","))),t()}return null},Asynchronous.serialize=function(n){n=n||new Asynchronous;var e=function(e){var r=function(){var r=this,t=arguments;n.step(function(){e.apply(r,t)}),n.$running||n.run(LINEARISED)};return r.free=function(){return e},r};return e.free=function(){n&&n.dispose(),n=null},e},Asynchronous[PROTO]={constructor:Asynchronous,$interval:DEFAULT_INTERVAL,$timer:null,$queue:null,$thread:null,$events:null,$runmode:NONE,$running:!1,dispose:function(){var n=this;return n.unfork(!0),n.$timer&&ClearTime(n.$timer),n.$thread=null,n.$timer=null,n.$interval=null,n.$queue=null,n.$runmode=NONE,n.$running=!1,n},empty:function(){var n=this;return n.$timer&&ClearTime(n.$timer),n.$timer=null,n.$queue=[],n.$runmode=NONE,n.$running=!1,n},interval:function(n){return arguments.length?(this.$interval=parseInt(n,10)||this.$interval,this):this.$interval},fork:function(n,e,r,t){var o,s,i,u=this;if(!u.$thread){if(!supportsMultiThread)throw u.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");isNode?(s="Asynchronous: Thread (Process): ",i="Asynchronous: Thread (Process) Error: "):(s="Asynchronous: Thread (Worker): ",i="Asynchronous: Thread (Worker) Error: "),u.$events=u.$events||{},o=u.$thread=!0===t?new Thread.Shared(tpf):new Thread(tpf),o.onmessage=function(n){if(n.data.event){var e=n.data.event,r=n.data.data||null;u.$events&&u.$events[e]?u.$events[e](r):"console.log"!==e&&"console.error"!==e||console.log(s+(r.output||""))}},o.onerror=function(n){if(!u.$events||!u.$events.error)throw new Error(i+n.message+" file: "+n.filename+" line: "+n.lineno);u.$events.error(n)},u.send("initThread",{component:n||null,asInstance:!1!==r,imports:e?[].concat(e):null})}return u},unfork:function(n){var e=this;return e.$thread&&(e.send("dispose"),!0===n&&e.$thread.terminate()),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return isThread&&(n.$events={},onMessage(function(e){var r=e.data.event,t=e.data.data||null;r&&n.$events[r]?n.$events[r](t):"dispose"===r&&(n.dispose(),close())})),n},listen:function(n,e){return n&&is_function(e)&&this.$events&&(this.$events[n]=e),this},unlisten:function(n,e){return n&&this.$events&&this.$events[n]&&(2>arguments.length||e===this.$events[n])&&delete this.$events[n],this},send:function(n,e){return n&&(isThread?postMessage({event:n,data:e||null}):this.$thread&&this.$thread.postMessage({event:n,data:e||null})),this},task:function(n){return is_instance(n,Task)?n:is_function(n)?Task(n):void 0},iif:function(){var n=arguments,e=new Task;return e.iif.apply(e,n)},until:function(){var n=slice(arguments),e=new Task(n.pop());return e.until.apply(e,n)},untilNot:function(){var n=slice(arguments),e=new Task(n.pop());return e.untilNot.apply(e,n)},loop:function(){var n=slice(arguments),e=new Task(n.pop());return e.loop.apply(e,n)},each:function(){var n=slice(arguments),e=new Task(n.pop());return e.each.apply(e,n)},recurse:function(){var n=slice(arguments),e=new Task(n.pop());return e.recurse.apply(e,n)},step:function(n){var e=this;return n&&e.$queue.push(e.task(n).queue(e)),e},steps:function(){var n,e,r=this,t=arguments;for(e=t.length,n=0;e>n;n++)r.step(t[n]);return r},jumpNext:function(n,e){var r=this,t=r.$queue;return e=e||0,!1!==n?function(){return e<t.length&&(e>0&&t.splice(0,e),r.run(r.$runmode)),r}:(e<t.length&&(e>0&&t.splice(0,e),r.run(r.$runmode)),r)},jumpNextWithArgs:function(n,e,r){var t=this,o=t.$queue;return e=e||0,!1!==n?function(){return e<o.length&&(e>0&&o.splice(0,e),t.run(t.$runmode,arguments)),t}:(e<o.length&&(e>0&&o.splice(0,e),t.run(t.$runmode,r)),t)},abort:function(n,e){var r=this;return!1!==n?function(){return e&&e>0?SetTime(function(){r.empty()},e):r.empty(),r}:(e&&e>0?SetTime(function(){r.empty()},e):r.empty(),r)},run:function(n,e){var r=this;return arguments.length?r.$runmode=n:n=r.$runmode,e=e||null,SEQUENCED===n?runSequenced(r,e):INTERLEAVED===n?runInterleaved(r,e):LINEARISED===n?runLinearised(r,e):PARALLELISED===n&&runParallelised(r,e),r}},isThread){var Component=null;root.console={log:function(n){postMessage({event:"console.log",data:{output:n||""}})},error:function(n){postMessage({event:"console.error",data:{output:n||""}})}},onMessage(function(n){var e=n.data.event,r=n.data.data||null;switch(e){case"initThread":r&&r.component&&(Component&&(is_function(Component.dispose)&&Component.dispose(),Component=null),Component=Asynchronous.load(r.component,r.imports,r.asInstance));break;case"dispose":default:Component&&(is_function(Component.dispose)&&Component.dispose(),Component=null),close()}})}return Asynchronous});
/**
*
*   FILTER.js
*   @version: 0.8.0
*   @built on 2016-07-19 22:00:50
*   @dependencies: Classy.js, Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n){"use strict";function r(e,t,n,r){return e?t.map(function(t,a){return(n?e[a]:e[t])||(r?r(t):null)}):[]}"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.apply(e,r(module.$deps,["Classy","Asynchronous"],!1,function(e){return require("./"+e.toLowerCase())}))):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"].concat(["Classy","Asynchronous"]),function(t){return n.moduleUri=t.uri,n.apply(e,r(Array.prototype.slice.call(arguments,1),["Classy","Asynchronous"],!0))}):t in e||(e[t]=n.apply(e,r(e,["Classy","Asynchronous"])))&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}(this,"FILTER",function ModuleFactory__FILTER(Classy,Asynchronous){"use strict";var FILTER=Classy.Merge({Classy:Classy,Asynchronous:Asynchronous,Path:Asynchronous.path(ModuleFactory__FILTER.moduleUri)},Classy);return FILTER.VERSION="0.8.0",!function(e,t,n){var r,a="prototype",i=(Object[a],Function[a],Array[a]),s=t.Path,o=t.Merge,l=t.Asynchronous,u=l.isPlatform(l.Platform.NODE),c=l.isPlatform(l.Platform.BROWSER),h=l.supportsMultiThreading(),f=l.isThread(),d=navigator?navigator.userAgent:"",p=function(){return"[FILTER Plugin: "+this.name+"]"},m=function(e,t,n,r){return e},_=function(){},g=function(e){return function(){this.$super("constructor"),e.apply(this,arguments)}},v=(t.devicePixelRatio=e.devicePixelRatio||1,t._notSupportClamp="undefined"==typeof Uint8ClampedArray),y=("undefined"==typeof Int16Array||"function"!=typeof Int16Array[a].set,function(e,t){var n=e.length;for(t=t||0;--n>=0;)this[n+t]=e[n]}),w=i.slice,C=0,A=t.Browser={isNode:u,isBrowser:c,isWorker:f,supportsWorker:h,isPhantom:/PhantomJS/.test(d),isOpera:c&&/Opera|OPR\//.test(d),isFirefox:c&&/Firefox\//.test(d),isChrome:c&&/Chrome\//.test(d),isSafari:c&&/Apple Computer/.test(navigator.vendor),isKhtml:c&&/KHTML\//.test(d),isIE:c&&(/MSIE \d/.test(d)||/Trident\/\d/.test(d)),isGecko:c&&/gecko\/\d/i.test(d),isWebkit:c&&/WebKit\//.test(d),isMac_geLion:c&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(d),isMac_geMountainLion:c&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(d),isMobile:!1,isIOS:/AppleWebKit/.test(d)&&/Mobile\/\w+/.test(d),isWin:/windows/i.test(navigator.platform),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};A.isMobile=A.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(d),A.isMac=A.isIOS||/Mac/.test(navigator.platform),A.isIE_lt8=A.isIE&&!f&&(null==document.documentMode||document.documentMode<8),A.isIE_lt9=A.isIE&&!f&&(null==document.documentMode||document.documentMode<9),A.isQtWebkit=A.isWebkit&&/Qt\/\d+\.\d+/.test(d),t.getPath=l.path,t.uuid=function(e){return[e||"filter",(new Date).getTime(),++C].join("_")},t.Array=Array,t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.Array32F[a].set||(t.Array32F[a].set=y,t.Array64F[a].set=y,t.Array8I[a].set=y,t.Array16I[a].set=y,t.Array32I[a].set=y,t.Array8U[a].set=y,t.Array16U[a].set=y,t.Array32U[a].set=y),t.Array32F[a].subarray||(t.Array32F[a].subarray=w,t.Array64F[a].subarray=w,t.Array8I[a].subarray=w,t.Array16I[a].subarray=w,t.Array32I[a].subarray=w,t.Array8U[a].subarray=w,t.Array16U[a].subarray=w,t.Array32U[a].subarray=w),t.ImArray=v?t.Array8U:Uint8ClampedArray,t.ImArrayCopy=A.isNode||A.isOpera?t.Array8U:t.ImArray,v&&"undefined"!=typeof CanvasPixelArray&&"function"!==CanvasPixelArray[a].set&&(CanvasPixelArray[a].set=y),v=t._notSupportClamp=v||A.isOpera||A.isNode,t.NotImplemented=function(e){return e=e||"",function(){throw new Error("Method "+e+" not Implemented!")}},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(e){},t.useWebGLSharedResourcesIfAvailable=function(e){},t.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},t.LUMA=new t.Array32F([.212671,.71516,.072169]),t.FORMAT={IMAGE:1,DATA:4,PNG:8,JPG:16,GIF:32,BMP:64,TGA:128,RGBE:256},t.MIME={PNG:"image/png",JPG:"image/jpeg",GIF:"image/gif",BMP:"image/bmp"},t.FORMAT.JPEG=t.FORMAT.JPG,t.MIME.JPEG=t.MIME.JPG,t.Utils={},t.Codec={},t.Interpolation={},t.Transform={},t.MachineLearning=t.ML={},r=t.log=console&&console.log?function(e){console.log(e)}:function(e){},t.warning=function(e){r("WARNING: "+e)},t.error=function(e,t){if(r("ERROR: "+e),t)throw new Error(e)};var b=t.FilterThread=t.Class(l,{path:s,name:null,constructor:function(){var e=this,t=null;f&&e.initThread().listen("load",function(e){e&&e.filter&&(t&&(t.dispose(!0),t=null),t=l.load("FILTER."+e.filter))}).listen("import",function(e){e&&e["import"]&&e["import"].length&&importScripts(e["import"])}).listen("params",function(e){t&&t.unserialize(e)}).listen("apply",function(n){if(t&&n&&n.im){n.params&&t.unserialize(n.params),n.im[0].id=n.id;var r={im:t._apply(n.im[0],n.im[1],n.im[2])};t.hasMeta&&(r.meta=t.getMeta()),e.send("apply",r)}else e.send("apply",{im:null})}).listen("dispose",function(n){t&&(t.dispose(!0),t=null),e.dispose(!0),close()})},thread:function(e){var t=this;return arguments.length||(e=!0),e=!!e,e&&!t.$thread?(t.fork("FILTER.FilterThread",s.file!==t.path.file?[s.file,t.path.file]:t.path.file),t.send("load",{filter:t.name})):!e&&t.$thread&&t.unfork(),t},sources:function(){var e=i.slice.call(arguments);if(e.length){var t,n=[];for(t=0;t<e.length;t++)"function"==typeof e[t]?n.push(l.blob(e[t].toString())):n.push(l.blob(e[t]));this.send("import",{"import":n.join(",")})}return this},scripts:function(){var e=i.slice.call(arguments);return e.length&&this.send("import",{"import":e.join(",")}),this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{}}},unserialize:function(e){var t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn),t}}),E=t.Filter=t.Class(b,{name:"Filter",constructor:function(){},id:null,_isOn:!0,_update:!0,_onComplete:null,hasMeta:!1,dispose:function(){var e=this;return e.$super("dispose"),e.name=null,e.id=null,e._isOn=null,e._update=null,e._onComplete=null,e.hasMeta=null,e},worker:b[a].thread,complete:function(e){return this._onComplete=e||null,this},isOn:function(){return this._isOn},update:function(e){return arguments.length||(e=!0),this._update=!!e,this},turnOn:function(e){return arguments.length||(e=!0),this._isOn=!!e,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this},canRun:function(){return this._isOn},getMeta:function(){},setMeta:function(e){return this},combineWith:function(e){return this},_apply:function(e,t,n,r){return e},apply:function(e,t,n){var r,a,i=this;return i.canRun()?(arguments.length<3&&(t&&t.setSelectedData?n=null:"function"==typeof t?(n=t,t=e):(t=e,n=null)),e&&t&&(n=n||i._onComplete,r=e.getSelectedData(),i.$thread?i.listen("apply",function(e){i.unlisten("apply"),e&&e.im&&(e.meta&&i.setMeta(e.meta),i._update&&t.setSelectedData(e.im)),n&&n.call(i)}).send("apply",{im:r,id:e.id,params:i.serialize()}):(r[0].id=e.id,a=i._apply(r[0],r[1],r[2],e),i._update&&t.setSelectedData(a),n&&n.call(i))),e):e},toString:function(){return"[FILTER: "+this.name+"]"}});t.Create=function(e){e=o({init:_,name:"PluginFilter",toString:p,apply:m},e),e.constructor=g(e.init),e._apply=e.apply,delete e.init,delete e.apply;var n=e.name;return t[n]=t.Class(E,e)}}(this,FILTER),!function(e,t){function n(e,t,n){return e>n?n:t>e?t:e}function r(e){return _(2,g(R(e)))}function a(e,t){var n=new p(2);return n[I]=e||0,n[M]=t||0,n}function i(e,t,n){var r=new p(3);return r[I]=e||0,r[M]=t||0,r[L]=n||0,r}function s(e,t,n){var r=1-n;return a(n*e[I]+r*t[I],n*e[M]+r*t[M])}function o(e,t,n){var r=1-n;return i(n*e[I]+r*t[I],n*e[M]+r*t[M],n*e[L]+r*t[L])}function l(e,t){return e[I]*t[M]-t[I]*e[M]}function u(e,t){var n;return 0>e&&(e=-e),0>t&&(t=-t),0==e?t:0==t?e:e>t?(n=t/e,e*m(1+n*n)):(n=e/t,t*m(1+n*n))}function c(e,t){var n,r,i,s,o;return n=a(e[I]-t[I],e[M]-t[M]),0===n[M]&&0===n[I]?null:(r=a(0,0),0===n[I]&&(r[I]=10),0===n[M]&&(r[M]=10),0!==n[M]&&0!==n[I]&&(i=n[M]/n[I],s=-n[I]/n[M],r[I]=10,r[M]=s*r[I]),o=u(r[I],r[M]),r[I]/=o,r[M]/=o,0>l(n,r)&&(r[I]=-r[I],r[M]=-r[M]),r)}function h(e,t,n,r){var a,i,s,o,l,u,c,h,f,d,m=t<<2,_=e.length,g=_>>2;for(d=!0!==r,a=new p(g),h=0,c=0,o=l=u=0,f=0;t>f;f++,c+=4,h++)o+=e[c],a[h]=o;for(c=m,f=0,h=0,o=l=u=0,c=m;_>c;c+=4,h++,f++)f>=t&&(f=0,o=l=u=0),o+=e[c],a[h+t]=a[h]+o;if(d){for(i=new p(g),s=new p(g),h=0,c=0,o=l=u=0,f=0;t>f;f++,c+=4,h++)l+=e[c+1],u+=e[c+2],i[h]=l,s[h]=u;for(c=m,f=0,h=0,o=l=u=0,c=m;_>c;c+=4,h++,f++)f>=t&&(f=0,o=l=u=0),l+=e[c+1],u+=e[c+2],i[h+t]=i[h]+l,s[h+t]=s[h]+u;return[a,i,s]}return[a,a,a]}function f(e,t,n,r){var a,i,s,o,l,u,c,h,f,d,m,_=e.length,g=0,v=0,y=0,w=255,C=255,A=255,b=1/(_>>2);for(m=!0!==r,a=new p(256),d=0;256>d;d+=8)a[d]=0,a[d+1]=0,a[d+2]=0,a[d+3]=0,a[d+4]=0,a[d+5]=0,a[d+6]=0,a[d+7]=0;for(d=0;_>d;d+=4)o=e[d],a[o]+=b,o>g?g=o:w>o&&(w=o);for(c=h=f=0,d=0;256>d;d+=8)c+=a[d],a[d]=c,c+=a[d+1],a[d+1]=c,c+=a[d+2],a[d+2]=c,c+=a[d+3],a[d+3]=c,c+=a[d+4],a[d+4]=c,c+=a[d+5],a[d+5]=c,c+=a[d+6],a[d+6]=c,c+=a[d+7],a[d+7]=c;if(m){for(i=new p(256),s=new p(256),d=0;256>d;d+=8)i[d]=0,s[d]=0,i[d+1]=0,s[d+1]=0,i[d+2]=0,s[d+2]=0,i[d+3]=0,s[d+3]=0,i[d+4]=0,s[d+4]=0,i[d+5]=0,s[d+5]=0,i[d+6]=0,s[d+6]=0,i[d+7]=0,s[d+7]=0;for(d=0;_>d;d+=4)l=e[d+1],u=e[d+2],i[l]+=b,s[u]+=b,l>v?v=l:C>l&&(C=l),u>y?y=u:A>u&&(A=u);for(c=h=f=0,d=0;256>d;d+=8)h+=i[d],i[d]=h,f+=s[d],s[d]=f,h+=i[d+1],i[d+1]=h,f+=s[d+1],s[d+1]=f,h+=i[d+2],i[d+2]=h,f+=s[d+2],s[d+2]=f,h+=i[d+3],i[d+3]=h,f+=s[d+3],s[d+3]=f,h+=i[d+4],i[d+4]=h,f+=s[d+4],s[d+4]=f,h+=i[d+5],i[d+5]=h,f+=s[d+5],s[d+5]=f,h+=i[d+6],i[d+6]=h,f+=s[d+6],s[d+6]=f,h+=i[d+7],i[d+7]=h,f+=s[d+7],s[d+7]=f;return[a,i,s]}return[a,a,a]}function d(e,t,n,r){return null}var p=(e.ImArray,e.Array32F),m=(e.Array64F,Math.sqrt),_=Math.pow,g=Math.ceil,v=Math.log,y=Math.PI,w=y+y,C=.5*y,A=Math.LN2,b=Math.SQRT2,E=function(e){return v(e)/A},R=Math.log2||E,I=0,M=1,L=2;e.CONSTANTS=e.CONST={PI:y,PI2:w,PI_2:C,SQRT2:b,LN2:A,toRad:y/180,toDeg:180/y,X:I,Y:M,Z:L},e.Geometry={Point2:a,Point3:i,enorm2:u,cross2:l,normal2:c,interpolate2:s,interpolate3:o},e.Math={clamp:n,closestPower2:r,integral:h,histogram:f,spectrum:d}}(FILTER),!function(e,t){var n=e.ImArray,r=Math.min;e.Interpolation.crop=function(e,t,a,i,s,o,l){o=r(o,t-1),l=r(l,a-1);var u,c,h,f,d=o-i+1,p=l-s+1,m=d*p<<2,_=new n(m),g=d<<2;for(u=s,c=s*t,h=0;l>=u;u++,c+=t,h+=g)f=c+i<<2,_.set(e.subarray(f,f+g),h);return _},e.Interpolation.pad=function(e,t,r,a,i,s,o){a=a||0,i=i||0,s=s||0,o=o||0;var l,u,c,h,f=t+s+a,d=r+o+i,p=f*d<<2,m=new n(p),_=t<<2,g=f<<2,v=o*g,y=s<<2;for(l=0,u=0,c=v;r>l;l++,u+=t,c+=g)h=u<<2,m.set(e.subarray(h,h+_),y+c);return m}}(FILTER),!function(e,t){var n=e.Math.clamp,r=e.ImArray;e.Interpolation.bilinear=function(e,t,a,i,s){var o,l,u,c,h,f,d,p,m,_,g,v,y,w,C,A,b,E,R,I=i*s<<2,M=new r(I),L=(t-1)/i,x=(a-1)/s,N=t<<2;for(m=0,_=0,g=0,v=0,w=0,b=0,R=0,A=0;I>A;A+=4,_++,g+=L)_>=i&&(_=0,g=0,m++,v+=x,w=~~v,R=v-w,b=w*t),y=~~g,E=g-y,h=(1-E)*(1-R),f=E*(1-R),d=R*(1-E),p=E*R,C=b+y<<2,o=e[C],l=e[C+4],u=e[C+N],c=e[C+N+4],M[A]=n(~~(o*h+l*f+u*d+c*p+.5),0,255),o=e[C+1],l=e[C+5],u=e[C+N+1],c=e[C+N+5],M[A+1]=n(~~(o*h+l*f+u*d+c*p+.5),0,255),o=e[C+2],l=e[C+6],u=e[C+N+2],c=e[C+N+6],M[A+2]=n(~~(o*h+l*f+u*d+c*p+.5),0,255),o=e[C+3],l=e[C+7],u=e[C+N+3],c=e[C+N+7],M[A+3]=n(~~(o*h+l*f+u*d+c*p+.5),0,255);return M}}(FILTER),!function(e,t){var n,r;r=e.Class({constructor:function(e){var t=this;t._cnv=e,t._transform={scale:[1,1],translate:[0,0],rotate:[0,0]},t._data=null},_cnv:null,_transform:null,_data:null,dispose:function(){var e=this;return e._cnv=null,e._data=null,e._transform=null,e},drawImage:function(){},scale:function(e,t){var n=this;return n._transform.scale[0]=e,n._transform.scale[1]=t,n},translate:function(e,t){var n=this;return n._transform.translate[0]=e,n._transform.translate[1]=t,n}}),n=e.FilterCanvas=e.Class({constructor:function(e,t){var n=this;n.width=e||0,n.height=t||0,n.style={},n._ctx=new r(n)},_ctx:null,width:null,height:null,style:null,dispose:function(){var e=this;return e.width=null,e.height=null,e.style=null,e._ctx.dispose(),e._ctx=null,e},getContext:function(e){return this._ctx},toDataURL:function(e){return""}}),e.Canvas=function(t,r){var a=e.Browser.isNode?new n:document.createElement("canvas");return t=t||0,r=r||0,a.style.width=t+"px",a.style.height=r+"px",a.width=t*devicePixelRatio,a.height=r*devicePixelRatio,a}}(FILTER),!function(e){var t=Math.sqrt,n=Math.round,r=(Math.floor,Math.min),a=Math.max,i=(Math.abs,e.Math.clamp),s=/([.*+?^${}()|\[\]\/\\\-])/g,o=function(e){return e.replace(s,"\\$1")},l=/^\s+|\s+$/g,u=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(l,"")},c=1/255,h=100/255,f=2.55,d={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},p=e.Color=e.Class({__static__:{clamp:i,clampPixel:function(e){return r(255,a(e,0))},toGray:function(t,n,r){var a=e.LUMA;return~~(a[0]*t+a[1]*n+a[2]*r)},distance:function(e,n){var r=e[0]-n[0],a=e[1]-n[1],i=e[2]-n[2];return t(r*r+a*a+i*i)},RGB2Color:function(e){return e[0]<<16|e[1]<<8|255&e[2]},RGBA2Color:function(e){return e[3]<<24|e[0]<<16|e[1]<<8|255&e[2]},Color2RGBA:function(e){return e=~~e,[e>>>16&255,e>>>8&255,255&e,e>>>24&255]},RGB2YCbCr:function(e){var t,n,r,a=e[0],i=e[1],s=e[2];return t=~~(0+.299*a+.587*i+.114*s),n=~~(128-.168736*a-.331264*i+.5*s),r=~~(128+.5*a-.418688*i-.081312*s),[t,n,r]},YCbCr2RGB:function(e){var t,n,r,a=e[0],i=e[1],s=e[2];return t=~~(a+1.402*(s-128)),n=~~(a-.34414*(i-128)-.71414*(s-128)),r=~~(a+1.772*(i-128)),[t,n,r]},RGB2HSV:function(e){var t,n,i,s,o,l,u,c,h;return s=e[0],o=e[1],l=e[2],t=r(s,o,l),n=a(s,o,l),i=n-t,h=n,0==n?(c=0,u=0,[u,c,h]):(c=i/n,u=s==n?(o-l)/i:o==n?2+(l-s)/i:4+(s-o)/i,u*=60,0>u&&(u+=360),[u,c,h])},HSV2RGB:function(e){var t,n,r,a,i,s,o,l,u,c,h;return u=e[0],c=e[1],h=e[2],0==c?(s=o=l=h,[s,o,l]):(u/=60,t=~~u,n=u-t,r=h*(1-c),a=h*(1-c*n),i=h*(1-c*(1-n)),0===t?(s=h,o=i,l=r):1===t?(s=a,o=h,l=r):2===t?(s=r,o=h,l=i):3===t?(s=r,o=a,l=h):4===t?(s=i,o=r,l=h):(s=h,o=r,l=a),[s,o,l])},toString:function(){return"[FILTER: "+this.name+"]"},C2F:c,C2P:h,P2C:f,Keywords:d,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(d).map(o).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(e,t){return e*h+(t||"")},per2col:function(e){return e*f},rgb2cmyk:function(e,t,a,s){var o,l,u=0,h=0,d=0,p=0;return s&&(e=i(n(e*f),0,255),t=i(n(t*f),0,255),a=i(n(a*f),0,255)),0==e&&0==t&&0==a?(p=1,[0,0,0,1]):(u=1-e*c,h=1-t*c,d=1-a*c,o=r(u,h,d),l=1/(1-o),u=(u-o)*l,h=(h-o)*l,d=(d-o)*l,p=o,[u,h,d,p])},cmyk2rgb:function(e,t,r,a){var s,o,l=0,u=0,c=0;return 0==e&&0==t&&0==r?[0,0,0]:(s=a,o=1-s,e=e*o+s,t=t*o+s,r=r*o+s,l=255*(1-e),u=255*(1-t),c=255*(1-r),[i(n(l),0,255),i(n(u),0,255),i(n(c),0,255)])},rgb2hex:function(e,t,r,a,s){var o;return s&&(e=i(n(e*f),0,255),t=i(n(t*f),0,255),r=i(n(r*f),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),o=a&&e[0]==e[1]&&t[0]==t[1]&&r[0]==r[1]?"#"+e[0]+t[0]+r[0]:"#"+e+t+r},rgb2hexIE:function(e,t,r,a,s){var o;return s&&(e=i(n(e*f),0,255),t=i(n(t*f),0,255),r=i(n(r*f),0,255),a=i(n(a*f),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),a=16>a?"0"+a.toString(16):a.toString(16),o="#"+a+e+t+r},hex2rgb:function(e){return!e||3>e.length?[0,0,0]:6>e.length?[i(parseInt(e[0]+e[0],16),0,255),i(parseInt(e[1]+e[1],16),0,255),i(parseInt(e[2]+e[2],16),0,255)]:[i(parseInt(e[0]+e[1],16),0,255),i(parseInt(e[2]+e[3],16),0,255),i(parseInt(e[4]+e[5],16),0,255)]},hue2rgb:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},hsl2rgb:function(e,t,r){var a,s,o,l,u;return e=(e+360)%360/360,t*=.01,r*=.01,0==t?(a=1,s=1,o=1):(u=.5>r?r*(1+t):r+t-r*t,l=2*r-u,a=p.hue2rgb(l,u,e+1/3),s=p.hue2rgb(l,u,e),o=p.hue2rgb(l,u,e-1/3)),[i(n(255*a),0,255),i(n(255*s),0,255),i(n(255*o),0,255)]},rgb2hsl:function(e,t,s,o){var l,u,h,f,d,p;return o?(e*=.01,t*=.01,s*=.01):(e*=c,t*=c,s*=c),u=a(e,t,s),l=r(e,t,s),d=.5*(u+l),u==l?h=f=0:(p=u-l,f=d>.5?p/(2-a-r):p/(a+r),h=u==e?(t-s)/p+(s>t?6:0):u==t?(s-e)/p+2:(e-t)/p+4,h/=6),[n(360*h)%360,i(100*f,0,100),i(100*d,0,100)]},parse:function(e,t,n,r){var a,i,s,o,l,c=0,f=0;if("hsl"==n||!n&&(a=e.match(p.hslRE))){if("hsl"==n){l="hsla"==e[0].toLowerCase();var d=e[1].split(",").map(u)}else{c=a[0].length,f=0,l="hsla"==a[1].toLowerCase();var d=a[2].split(",").map(u)}var m=d[0]?d[0]:"0",e=d[1]?d[1]:"0",_=d[2]?d[2]:"0",g=l&&null!=d[3]?d[3]:"1";return m=parseFloat(m,10),e="%"==e.slice(-1)?parseFloat(e,10):parseFloat(e,10)*h,_="%"==_.slice(-1)?parseFloat(_,10):parseFloat(_,10)*h,g=parseFloat(g,10),o=(new p).fromHSL([m,e,_,g]),t&&(s=e.substr(c),(i=s.match(p.colorstopRE))&&(o.colorStop(i[1]),f=i[0].length)),r?o:[o,0,c+f]}if("rgb"==n||!n&&(a=e.match(p.rgbRE))){if("rgb"==n){l="rgba"==e[0].toLowerCase();var d=e[1].split(",").map(u)}else{c=a[0].length,f=0,l="rgba"==a[1].toLowerCase();var d=a[2].split(",").map(u)}var v=d[0]?d[0]:"0",y=d[1]?d[1]:"0",w=d[2]?d[2]:"0",g=l&&null!=d[3]?d[3]:"1";return v="%"==v.slice(-1)?2.55*parseFloat(v,10):parseFloat(v,10),y="%"==y.slice(-1)?2.55*parseFloat(y,10):parseFloat(y,10),w="%"==w.slice(-1)?2.55*parseFloat(w,10):parseFloat(w,10),g=parseFloat(g,10),o=(new p).fromRGB([v,y,w,g]),t&&(s=e.substr(c),(i=s.match(p.colorstopRE))&&(o.colorStop(i[1]),f=i[0].length)),r?o:[o,0,c+f]}if("hex"==n||!n&&(a=e.match(p.hexRE))){if("hex"==n)var d=p.hex2rgb(e[0]);else{c=a[0].length,f=0;var d=p.hex2rgb(a[1])}var C=d[0]?d[0]:0,A=d[1]?d[1]:0,b=d[2]?d[2]:0,g=null!=d[3]?d[3]:255;return o=(new p).fromHEX([C,A,b,g]),t&&(s=e.substr(c),(i=s.match(p.colorstopRE))&&(o.colorStop(i[1]),f=i[0].length)),r?o:[o,0,c+f]}if("keyword"==n||!n&&(a=e.match(p.keywordRE))){if("keyword"==n)var d=e[0];else{c=a[0].length,f=0;var d=a[1]}return o=(new p).fromKeyword(d),t&&(s=e.substr(c),(i=s.match(p.colorstopRE))&&(o.colorStop(i[1]),f=i[0].length)),r?o:[o,0,c+f]}return null},fromString:function(e,t,n){return p.parse(e,t,n,1)},fromRGB:function(e){return(new p).fromRGB(e)},fromHSL:function(e){return(new p).fromHSL(e)},fromCMYK:function(e){return(new p).fromCMYK(e)},fromHEX:function(e){return(new p).fromHEX(e)},fromKeyword:function(e){return(new p).fromKeyword(e)},fromPixel:function(e){return(new p).fromPixel(e)}},constructor:function m(e,t){return this instanceof m?(this.reset(),void(e&&this.set(e,t))):new m(e,t)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var e=new p;return e.col=this.col.slice(),e.cstop=this.cstop+"",e.kword=this.kword,e},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(e,t){return e&&(undef!==e[0]&&(this.col[0]=i(e[0],0,255)),undef!==e[1]&&(this.col[1]=i(e[1],0,255)),undef!==e[2]&&(this.col[2]=i(e[2],0,255)),undef!==e[3]?this.col[3]=i(e[3],0,1):this.col[3]=1,t&&(this.cstop=t),this.kword=null),this},colorStop:function(e){return this.cstop=e,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return!!this.kword},fromPixel:function(e){return e=e||0,this.col=[i(e>>16&255,0,255),i(e>>8&255,0,255),i(255&e,0,255),i((e>>24&255)*c,0,1)],this.kword=null,this},fromKeyword:function(e){return e=e.toLowerCase(),p.Keywords[e]&&(this.col=p.Keywords[e].slice(),this.kword=e),this},fromHEX:function(e){return this.col[0]=e[0]?i(parseInt(e[0],10),0,255):0,this.col[1]=e[1]?i(parseInt(e[1],10),0,255):0,this.col[2]=e[2]?i(parseInt(e[2],10),0,255):0,this.col[3]=undef!==e[3]?i(parseInt(e[3],10)*c,0,1):1,this.kword=null,this},fromRGB:function(e){return this.col[0]=e[0]?i(n(e[0]),0,255):0,this.col[1]=e[1]?i(n(e[1]),0,255):0,this.col[2]=e[2]?i(n(e[2]),0,255):0,this.col[3]=undef!==e[3]?i(e[3],0,1):1,this.kword=null,this},fromCMYK:function(e){var t=p.cmyk2rgb(e[0]||0,e[1]||0,e[2]||0,e[3]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[4]?i(e[4],0,1):1,this.kword=null,this},fromHSL:function(e){var t=p.hsl2rgb(e[0]||0,e[1]||0,e[2]||0);return this.col[0]=t[0],this.col[1]=t[1],this.col[2]=t[2],this.col[3]=undef!==e[3]?i(e[3],0,1):1,this.kword=null,this},toPixel:function(e){return e?i(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(e,t,n){var r=p.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(e,t,n){return this.kword?this.kword:this.toHEX(1,t,n)},toHEX:function(e,t,r){return r?p.rgb2hexIE(this.col[0],this.col[1],this.col[2],i(n(255*this.col[3]),0,255)):p.rgb2hex(this.col[0],this.col[1],this.col[2],t)},toRGB:function(e,t,n){var r=this.col[3];return e?(t&&(r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(e,t,n){var r=this.col[3],a=p.rgb2hsl(this.col[0],this.col[1],this.col[2]);return e?(t&&(a[1]=0==a[1]?a[1]:a[1]+"%",a[2]=0==a[2]?a[2]:a[2]+"%",r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[a[0],a[1],a[2]].join(",")+")":"hsla("+[a[0],a[1],a[2],r].join(",")+")"):n?a:a.concat(this.col[3])},toColorStop:function(e){var t=this.cstop;return e?(t=t.length?t+",":"",1>this.col[3]?"color-stop("+t+this.toRGB(1,1)+")":"color-stop("+t+this.toHEX(1,1)+")"):(t=t.length?" "+t:"",1>this.col[3]?this.toRGB(1,1)+t:this.toHEX(1,1)+t)},toString:function(e,t){return e=e?e.toLowerCase():"hex","rgb"==e||"rgba"==e?this.toRGB(1,!1!==t,"rgb"==e):"hsl"==e||"hsla"==e?this.toHSL(1,!1!==t,"hsl"==e):"keyword"==e?this.toKeyword(1):this.toHEX(1,!1!==t,"hexie"==e)}})}(FILTER),!function(e,t){function n(e){var t=e.width,n=e.height,r=c(t,n);return r.width=t*o,r.height=n*o,r}function r(e,t,n,r){return r=r||R,r&b&&(e.width=t,e.oCanvas.style.width=t+"px",e.oCanvas.width=t*o,e._restorable&&(e.iCanvas.style.width=e.oCanvas.style.width,e.iCanvas.width=e.oCanvas.width),e.tmpCanvas&&(e.tmpCanvas.style.width=e.oCanvas.style.width,e.tmpCanvas.width=e.oCanvas.width)),r&E&&(e.height=n,e.oCanvas.style.height=n+"px",e.oCanvas.height=n*o,e._restorable&&(e.iCanvas.style.height=e.oCanvas.style.height,e.iCanvas.height=e.oCanvas.height),e.tmpCanvas&&(e.tmpCanvas.style.height=e.oCanvas.style.height,e.tmpCanvas.height=e.oCanvas.height)),e}function a(e,t){var n=e.width,r=e.height;return t=t||255,e._restorable&&t&_&&e._needsRefresh&_&&(e.iData=e.ictx.getImageData(0,0,n,r),e._needsRefresh&=~_),t&g&&e._needsRefresh&g&&(e.oData=e.octx.getImageData(0,0,n,r),e._needsRefresh&=~g),e}function i(e,t){if(e.selection){var n=e.selection,r=e.width-1,a=e.height-1,i=f(n[0]*r),s=f(n[1]*a),o=f(n[2]*r)-i+1,l=f(n[3]*a)-s+1;t=t||255,e._restorable&&t&v&&e._needsRefresh&v&&(e.iDataSel=e.ictx.getImageData(i,s,o,l),e._needsRefresh&=~v),t&y&&e._needsRefresh&y&&(e.oDataSel=e.octx.getImageData(i,s,o,l),e._needsRefresh&=~y)}return e}var s="prototype",o=e.devicePixelRatio,l=e.ImArray,u=e.ImArrayCopy,c=(e.Array32F,e.Canvas),h=e.FilterCanvas,f=(e._notSupportTypedArrays,Math.min,Math.floor),d=e.FORMAT,p=e.MIME,m=0,_=1,g=2,v=4,y=8,w=16,C=32,A=64,b=2,E=4,R=b|E,I=v|y,M=_|g,L=~I,x=~w,N=~C,S=e.Image=e.Class({name:"Image",constructor:function O(e){var t=this,n=0,r=0;return t instanceof O?(t.id=++m,t.width=n,t.height=r,t.iData=null,t.iDataSel=null,t.oData=null,t.oDataSel=null,t.iCanvas=c(n,r),t.oCanvas=c(n,r),t.tmpCanvas=null,t.domElement=t.oCanvas,t.ictx=t.iCanvas.getContext("2d"),t.octx=t.oCanvas.getContext("2d"),t.webgl=null,t._histogram=null,t._integral=null,t._spectrum=null,t.selection=null,t._needsRefresh=0,t._restorable=!0,t._grayscale=!1,void(e&&t.image(e))):new O(e)},id:null,width:0,height:0,selection:null,iCanvas:null,oCanvas:null,tmpCanvas:null,ictx:null,octx:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,webgl:null,_histogram:null,_integral:null,_spectrum:null,_needsRefresh:0,_restorable:!0,_grayscale:!1,dispose:function(){var e=this;return e.id=null,e.width=null,e.height=null,e.selection=null,e.ictx=null,e.octx=null,e.iData=null,e.iDataSel=null,e.oData=null,e.oDataSel=null,e.iCanvas=null,e.oCanvas=null,e.tmpCanvas=null,e.domElement=null,e.webgl=null,e._histogram=null,e._integral=null,e._spectrum=null,e._needsRefresh=null,e._restorable=null,e._grayscale=null,e},clone:function(e){return new S(!0===e?this.iCanvas:this.oCanvas)},grayscale:function(e){var t=this;return arguments.length?(t._grayscale=!!e,t):t._grayscale},restorable:function(e){var t=this;return arguments.length||(e=!0),t._restorable=!!e,t},apply:function(e,t){return e.apply(this,this,t||null),this},apply2:function(e,t,n){return e.apply(this,t,n||null),this},select:function(e,t,n,r){var a=this,i=arguments.length;return 1>i&&(e=0),2>i&&(t=0),3>i&&(n=1),4>i&&(r=1),a.selection=[0>e?0:e>1?1:e,0>t?0:t>1?1:t,0>n?0:n>1?1:n,0>r?0:r>1?1:r],a._needsRefresh|=I,a},deselect:function(){var e=this;return e.selection=null,e.iDataSel=null,e.oDataSel=null,e._needsRefresh&=L,e},store:function(){var e=this;return e._restorable&&(e.ictx.drawImage(e.oCanvas,0,0),e._needsRefresh|=_,e.selection&&(e._needsRefresh|=v)),e},restore:function(){var e=this;return e._restorable&&(e.octx.drawImage(e.iCanvas,0,0),e._needsRefresh|=g|w|C|A,e.selection&&(e._needsRefresh|=y)),e},dimensions:function(e,t){var n=this;return r(n,e,t,R),n._needsRefresh|=M|w|C|A,n.selection&&(n._needsRefresh|=I),n},scale:function(e,t){var r=this;if(e=e||1,t=t||e,1==e&&1==t)return r;r.tmpCanvas=r.tmpCanvas||n(r);var a=r.tmpCanvas.getContext("2d"),i=r.width,s=r.height;return a.scale(e,t),i=r.width=~~(e*i+.5),s=r.height=~~(t*s+.5),a.drawImage(r.oCanvas,0,0),r.oCanvas.style.width=i+"px",r.oCanvas.style.height=s+"px",r.oCanvas.width=i*o,r.oCanvas.height=s*o,r.octx.drawImage(r.tmpCanvas,0,0),r._restorable&&(a.drawImage(r.iCanvas,0,0),r.iCanvas.style.width=r.oCanvas.style.width,r.iCanvas.style.height=r.oCanvas.style.height,r.iCanvas.width=r.oCanvas.width,r.iCanvas.height=r.oCanvas.height,r.ictx.drawImage(r.tmpCanvas,0,0)),r.tmpCanvas.width=r.oCanvas.width,r.tmpCanvas.height=r.oCanvas.height,r._needsRefresh|=M|w|C|A,r.selection&&(r._needsRefresh|=I),r},flipHorizontal:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(e.width,0),t.scale(-1,1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=M|w|C|A,e.selection&&(e._needsRefresh|=I),e},flipVertical:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(0,e.height),t.scale(1,-1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=M|w|C|A,e.selection&&(e._needsRefresh|=I),e},draw:function(e,t,n,r){return this},clear:function(){var e=this,t=e.width,n=e.height;return t&&n&&(e._restorable&&e.ictx.clearRect(0,0,t,n),e.octx.clearRect(0,0,t,n),e._needsRefresh|=M|w|C|A,e.selection&&(e._needsRefresh|=I)),e},crop:function(e,t,r,a){var i,s,l,u,c,h,d,p,m=this,_=m.selection,g=m.width,v=m.height;if(arguments.length)c=e,h=t,d=r-e+1,p=a-t+1;else{if(!_)return m;i=f(_[0]*(g-1)),s=f(_[1]*(v-1)),l=f(_[2]*(g-1))-i+1,u=f(_[3]*(v-1))-s+1,c=i,h=s,d=l,p=u,_[0]=0,_[1]=0,_[2]=1,_[3]=1}m.tmpCanvas=m.tmpCanvas||n(m);var y=m.tmpCanvas.getContext("2d");return y.drawImage(m.oCanvas,0,0,g,v,c,h,d,p),m.oCanvas.style.width=d+"px",m.oCanvas.style.height=p+"px",m.oCanvas.width=d*o,m.oCanvas.height=p*o,m.octx.drawImage(m.tmpCanvas,0,0),m._restorable&&(y.drawImage(m.iCanvas,0,0,g,v,c,h,d,p),m.iCanvas.style.width=m.oCanvas.style.width,m.iCanvas.style.height=m.oCanvas.style.height,m.iCanvas.width=m.oCanvas.width,m.iCanvas.height=m.oCanvas.height,m.ictx.drawImage(m.tmpCanvas,0,0)),m.tmpCanvas.width=m.oCanvas.width,m.tmpCanvas.height=m.oCanvas.height,m._needsRefresh|=M|w|C|A,_&&(m._needsRefresh|=I),m},fill:function(e,n,r,a,i){var s,o,l,u,c=this,h=c.selection,d=c.width,p=c.height;h?(s=f(h[0]*(d-1)),o=f(h[1]*(p-1)),l=f(h[2]*(d-1))-s+1,u=f(h[3]*(p-1))-o+1):(s=0,o=0,l=d,u=p),t===n&&(n=s),t===r&&(r=o),t===a&&(a=l),
t===i&&(i=u),a&&!d&&i&&!p&&c.createImageData(a,i);var m=c.ictx,_=c.octx;return e=e||0,c._restorable&&(m.fillStyle=e,m.fillRect(n,r,a,i)),_.fillStyle=e,_.fillRect(n,r,a,i),c._needsRefresh|=M|w|C|A,h&&(c._needsRefresh|=I),c},getData:function(){var e,t=this;return t._restorable?(t._needsRefresh&_&&a(t,_),e=t.iData):(t._needsRefresh&g&&a(t,g),e=t.oData),new u(e.data)},getSelectedData:function(){var e,t=this;return t.selection?t._restorable?(t._needsRefresh&v&&i(t,v),e=t.iDataSel):(t._needsRefresh&y&&i(t,y),e=t.oDataSel):t._restorable?(t._needsRefresh&_&&a(t,_),e=t.iData):(t._needsRefresh&g&&a(t,g),e=t.oData),[new u(e.data),e.width,e.height]},getProcessedData:function(){var e=this;return e._needsRefresh&g&&a(e,g),new u(e.oData.data)},getProcessedSelectedData:function(){var e,t=this;return t.selection?(t._needsRefresh&y&&i(t,y),e=t.oDataSel):(t._needsRefresh&g&&a(t,g),e=t.oData),[new u(e.data),e.width,e.height]},setData:function(e){var t=this;return t._needsRefresh&g&&a(t,g),t.oData.data.set(e),t.octx.putImageData(t.oData,0,0),t._needsRefresh|=w|C|A,t.selection&&(t._needsRefresh|=y),t},setSelectedData:function(e){var t=this;if(t.selection){var n=t.selection,r=t.width-1,s=t.height-1,o=f(n[0]*r),l=f(n[1]*s);t._needsRefresh&y&&i(t,y),t.oDataSel.data.set(e),t.octx.putImageData(t.oDataSel,o,l),t._needsRefresh|=g}else t._needsRefresh&g&&a(t,g),t.oData.data.set(e),t.octx.putImageData(t.oData,0,0);return t._needsRefresh|=w|C|A,t},createImageData:function(e,t){var n,a,i=this;return r(i,e,t,R),i._restorable&&(n=i.ictx=i.iCanvas.getContext("2d"),n.createImageData(e,t)),a=i.octx=i.oCanvas.getContext("2d"),a.createImageData(e,t),i._needsRefresh|=M,i.selection&&(i._needsRefresh|=I),i},image:function(e){if(!e)return this;var t,n,i,s,o,l,u,c=this;return e instanceof S&&(e=e.oCanvas),o=e instanceof HTMLVideoElement,l=e instanceof HTMLCanvasElement||e instanceof h,u=e instanceof Image,o?(i=e.videoWidth,s=e.videoHeight):(i=e.width,s=e.height),u||l||o?(r(c,i,s,R),c._restorable&&(t=c.ictx=c.iCanvas.getContext("2d"),t.drawImage(e,0,0)),n=c.octx=c.oCanvas.getContext("2d"),n.drawImage(e,0,0),c._needsRefresh|=M):(c.oData||(c.createImageData(i,s),a(c,M)),c._restorable&&(t=c.ictx=c.iCanvas.getContext("2d"),c.iData.data.set(e.data),t.putImageData(c.iData,0,0)),n=c.octx=c.oCanvas.getContext("2d"),c.oData.data.set(e.data),n.putImageData(c.oData,0,0)),c._needsRefresh|=w|C|A,c.selection&&(c._needsRefresh|=I),c},getPixel:function(e,t){var n=this;n._needsRefresh&g&&a(n,g);var r=~~(t*n.width+e+.5)<<2,i=n.oData.data;return{r:i[r],g:i[r+1],b:i[r+2],a:i[r+3]}},setPixel:function(e,t,n,r,a,i){var s=this;return s.octx.putImageData(new l([255&n,255&r,255&a,255&i]),e,t),s._needsRefresh|=g|w|C|A,s.selection&&(s._needsRefresh|=y),s},getPixelData:function(){return this._needsRefresh&g&&a(this,g),this.oData},setPixelData:function(e){var t=this;return t.octx.putImageData(e,0,0),t._needsRefresh|=g|w|C|A,t.selection&&(t._needsRefresh|=y),t},integral:function(){var e=this;return e._needsRefresh&C&&(e._integral=S.integral(e.getPixelData().data,e.width,e.height,e._grayscale),e._needsRefresh&=N),e._integral},histogram:function(){var e=this;return e._needsRefresh&w&&(e._histogram=S.histogram(e.getPixelData().data,e.width,e.height,e._grayscale),e._needsRefresh&=x),e._histogram},spectrum:function(){var e=this;return e._spectrum},toImage:function(e){var t,n=this.oCanvas,r=1;if(t=e&d.JPG?n.toDataURL(p.JPG,r):e&d.GIF?n.toDataURL(p.GIF,r):n.toDataURL(p.PNG,r),e&d.IMAGE){var a=new Image;return a.src=t,a}return t},toString:function(){return"[FILTER Image: "+this.name+"]"}});S[s].setImage=S[s].image,S[s].setDimensions=S[s].dimensions,S.scale=S.resize=e.Interpolation.bilinear,S.crop=e.Interpolation.crop,S.pad=e.Interpolation.pad,S.integral=e.Math.integral,S.histogram=e.Math.histogram,S.spectrum=e.Math.spectrum;var T=e.ScaledImage=e.Class(S,{name:"ScaledImage",constructor:function F(e,t,n){var r=this;return r instanceof F?(r.scaleX=e||1,r.scaleY=t||r.scaleX,void r.$super("constructor",n)):new F(e,t,n)},scaleX:1,scaleY:1,dispose:function(){var e=this;return e.scaleX=null,e.scaleY=null,e.$super("dispose"),e},clone:function(e){var t=this;return new T(t.scaleX,t.scaleY,!0===e?t.iCanvas:t.oCanvas)},setScale:function(e,t){var n=this,r=arguments.length;return r>0&&null!=e&&(n.scaleX=e,n.scaleY=e),r>1&&null!=t&&(n.scaleY=t),n},image:function(e){if(!e)return this;var t,n,a,i,s,o,l,u,c,f=this,d=f.scaleX,p=f.scaleY;return e instanceof S&&(e=e.oCanvas),l=e instanceof HTMLVideoElement,u=e instanceof HTMLCanvasElement||e instanceof h,c=e instanceof Image,l?(a=e.videoWidth,i=e.videoHeight):(a=e.width,i=e.height),(c||u||l)&&(s=~~(d*a+.5),o=~~(p*i+.5),r(f,s,o,R),f._restorable&&(t=f.ictx=f.iCanvas.getContext("2d"),t.drawImage(e,0,0,a,i,0,0,s,o)),n=f.octx=f.oCanvas.getContext("2d"),n.drawImage(e,0,0,a,i,0,0,s,o),f._needsRefresh|=M|w|C|A,f.selection&&(f._needsRefresh|=I)),f}});T[s].setImage=T[s].image}(FILTER),!function(e,t){function n(e,t,n){var r="";if(!e)return xhr?xhr:r;var a,l,u,c,h,f=s(e);if(n){for(l=0,u=f.length;u>l;l++)a=f[l],n.setHeader(a,e[a]);return n}if(t){for(l=0,u=f.length;u>l;l++)if(a=f[l],"[object Array]"===i.call(e[a]))for(c=0,h=e[a].length;h>c;c++)t.setRequestHeader(a,String(e[a][c]));else t.setRequestHeader(a,String(e[a]));return t}for(l=0,u=f.length;u>l;l++)if(a=f[l],"[object Array]"===i.call(e[a]))for(r.length&&(r+=o),r+=a+": "+String(e[a][0]),c=1,h=e[a].length;h>c;c++)r+=o+String(e[a][c]);else r.length&&(r+=o),r+=a+": "+String(e[a]);return r}function r(e,t){var n,r,i,s,l={},c=null;if(e)for(t=!0===t,e=e.split(o),r=0,i=e.length;i>r;r++)s=e[r],n=s.split(":"),n.length>1?(c=u(n.shift()),t&&(c=c.toLowerCase()),l[a](c)?("string"==typeof l[c]&&(l[c]=[l[c]]),l[c].push(u(n.join(":")))):l[c]=u(n.join(":"))):n[0].length&&c&&(l[c]=o+n[0]);return l}var a="hasOwnProperty",i=Object.prototype.toString,s=Object.keys,o="\r\n",l=/^\s+|\s+$/g,u=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(l,"")},c=e.Image,h=e.Class,f=e.Loader=h({name:"Loader",__static__:{load:e.Method(function(e,t,n){return function(e,t,r){return(new n).load(e,t,r)}},e.LATE|e.STATIC)},constructor:function(){},_crossOrigin:null,_responseType:null,dispose:function(){var e=this;return e._crossOrigin=null,e._responseType=null,e},load:function(e,t,n){return null},responseType:function(e){var t=this;return arguments.length?(t._responseType=e,t):t._responseType},crossOrigin:function(e){var t=this;return arguments.length?(t._crossOrigin=e,t):t._crossOrigin}}),d=e.XHR=function m(e,t){var n=this,r=!1;n.readyState=m.UNSENT,n.status=null,n.statusText=null,n.responseType="text",n.responseURL=null,n.response=null,n.responseText=null,n.responseXml=null,n._rawHeaders=null,n._headers=null,n.send=function(t){return r||m.UNSENT!==n.readyState?n:(e&&e(t),n.readyState=m.OPENED,n)},n.abort=function(){return r?n:(r=!0,t&&t(),n)},n.getAllResponseHeaders=function(e){return m.DONE!==n.readyState?null:!0===e?n._headers:n._rawHeaders},n.getResponseHeader=function(e,t){if(null==e||m.DONE!==n.readyState)return null;var r=n._headers||{};return!1!==t&&(e=e.toLowerCase()),r[a](e)?r[e]:null},n.dispose=function(){return n.readyState=null,n.status=null,n.statusText=null,n.responseType=null,n.responseURL=null,n.response=null,n.responseText=null,n.responseXml=null,n._rawHeaders=null,n._headers=null,n.getAllResponseHeaders=null,n.getResponseHeader=null,n.send=null,n.abort=null,n}};d.UNSENT=0,d.OPENED=1,d.HEADERS_RECEIVED=2,d.LOADING=3,d.DONE=4,d.create=e.Browser.isNode?function(e,t){if(e=e||{},!e.url)return null;var r,a,s="[object Object]"===i.call(e.url)?e.url:require("url").parse(e.url),o={method:e.method||"GET",agent:!1,protocol:s.protocol,host:s.hostname,hostname:s.hostname,port:s.port||80,path:(s.pathname||"/")+(s.query?"?"+s.query:"")};return a=new d(function(e){null!=e&&(e=String(e),r.setHeader("Content-Length",String(e.length)),r.write(e)),r.end()},function(){r.abort()}),r=("https:"===o.protocol?require("https").request:require("http").request)(o,function(t){var n="",r=0;a.readyState=d.OPENED,e.onStateChange&&e.onStateChange(a),a.readyState=d.HEADERS_RECEIVED,a._rawHeaders=t.rawHeaders.join("\r\n"),a._headers=t.headers,a.responseURL=t.url||null,a.status=t.statusCode||null,a.statusText=t.statusMessage||null,e.onStateChange&&e.onStateChange(a),t.on("data",function(t){r||(r=1,a.readyState=d.LOADING,e.onStateChange&&e.onStateChange(a),e.onLoadStart&&e.onLoadStart(a)),n+=t.toString(),e.onProgress&&e.onProgress(a)}),t.on("end",function(){a.readyState=d.DONE,a.responseType="text",a.response=a.responseText=n,e.onStateChange&&e.onStateChange(a),e.onLoadEnd&&e.onLoadEnd(a),d.DONE===a.readyState&&(200===a.status?e.onComplete&&e.onComplete(a):e.onRequestError?e.onRequestError(a):e.onError&&e.onError(a))}),t.on("error",function(t){a.statusText=t.toString(),e.onError&&e.onError(a)})}),r.setTimeout(e.timeout||3e4,function(t){e.onTimeout&&e.onTimeout(a)}),r.on("abort",function(t){e.onAbort&&e.onAbort(a)}),r.on("error",function(t){a.statusText=t.toString(),e.onError&&e.onError(a)}),e.headers&&n(e.headers,null,r),arguments.length>1&&a.send(t),a}:function(e,t){if(e=e||{},!e.url)return null;var a="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i=new d(function(e){a.send(e)},function(){a.abort()}),s=function(e,t){return e.readyState=t.readyState,e.status=t.status,e.statusText=t.statusText,e};return i.getAllResponseHeaders=function(e){var t=a.getAllResponseHeaders();return!0===e?r(t):t},i.getResponseHeader=function(e){return a.getResponseHeader(e)},a.open(e.method||"GET",e.url,!e.sync),e.responseType&&(i.responseType=a.responseType=e.responseType),a.timeout=e.timeout||3e4,e.onProgress&&(a.onprogress=function(){e.onProgress(s(i,a))}),e.onLoadStart&&(a.onloadstart=function(){e.onLoadStart(s(i,a))}),e.onLoadEnd&&(a.onloadend=function(){e.onLoadEnd(s(i,a))}),!e.sync&&e.onStateChange&&(a.onreadystatechange=function(){e.onStateChange(s(i,a))}),a.onload=function(){d.DONE===a.readyState&&(s(i,a),200===a.status?(i.responseURL=a.responseURL,i.response=a.response,e.onComplete&&e.onComplete(i)):e.onRequestError?e.onRequestError(i):e.onError&&e.onError(i))},a.onabort=function(){e.onAbort&&e.onAbort(s(i,a))},a.onerror=function(){e.onError&&e.onError(s(i,a))},a.ontimeout=function(){e.onTimeout&&e.onTimeout(s(i,a))},e.headers&&n(e.headers,a),e.mimeType&&a.overrideMimeType(e.mimeType),arguments.length>1&&i.send(t),i};var p=(e.XHRLoader=h(f,{name:"XHRLoader",constructor:function _(){var e=this;return e instanceof _?void 0:new _},load:function(e,t,n){var r=this;return d.create({url:e,responseType:r._responseType,onComplete:function(e){"function"==typeof t&&t(e.response)},onError:function(e){"function"==typeof n&&n(e.statusText)}},null),r}}),e.FileLoader=h(f,{name:"FileLoader",constructor:function g(){var e=this;return e instanceof g?void 0:new g},load:function(t,n,r){var a=this;return e.Browser.isNode?require("fs").readFile(t,{encoding:"arraybuffer"===a._responseType?null:a._responseType,flag:"r"},function(e,t){e?"function"==typeof r&&r(e.toString()):"function"==typeof n&&n(t)}):d.create({url:t,responseType:a._responseType,onComplete:function(e){"function"==typeof n&&n(e.response)},onError:function(e){"function"==typeof r&&r(e.statusText)}},null),a}}));e.BinaryLoader=h(f,{name:"BinaryLoader",constructor:function v(e){var t=this;return t instanceof v?void(t._decoder="function"==typeof e?e:null):new v(e)},_decoder:null,_encoder:null,dispose:function(){var e=this;return e._decoder=null,e._encoder=null,e.$super("dispose"),e},decoder:function(e){var t=this;return t._decoder="function"==typeof e?e:null,t},encoder:function(e){var t=this;return t._encoder="function"==typeof e?e:null,t},load:function(e,t,n){var r=this,a=new c,i=r._decoder;return"function"==typeof i&&(new p).responseType(r._responseType||"arraybuffer").load(e,function(e){var n={},r=i(e,n);r&&(a.image(r),"function"==typeof t&&t(a,n))},n),a}})}(FILTER),!function(e,t){var n=e.Image;e.HTMLImageLoader=e.Class(e.Loader,{name:"HTMLImageLoader",constructor:function r(){return this instanceof r?void this.$super("constructor"):new r},load:function(e,t,r){var a,i=this,s=new n;return a=new Image,a.onload=function(e){s.setImage(a),"function"==typeof t&&t(s,a)},a.onerror=function(e){"function"==typeof r&&r(s,a)},a.crossOrigin=i._crossOrigin||"",a.src=e,s}})}(FILTER),!function(e,t){var n=(Object.prototype,Function.prototype,Array.prototype),r=n.slice,a=n.splice,i=n.concat,s=e.CompositeFilter=e.Class(e.Filter,{name:"CompositeFilter",constructor:function(e){var t=this;t.$super("constructor"),t._stack=e&&e.length?e.slice():[]},_stack:null,_meta:null,_stable:!0,dispose:function(e){var t,n=this,r=n._stack;if(n.$super("dispose"),!0===e)for(t=0;t<r.length;t++)r[t]&&r[t].dispose(e),r[t]=null;return n._stack=null,n._meta=null,n},serialize:function(){var e,t=this,n={filter:t.name,_isOn:!!t._isOn,_stable:!!t._stable,filters:[]},r=t._stack;for(e=0;e<r.length;e++)n.filters.push(r[e].serialize());return n},unserialize:function(t){var n,r,a,i,s,o=this,l=o._stack;if(t&&o.name===t.filter){if(o._isOn=!!t._isOn,o._stable=!!t._stable,i=t.filters||[],r=i.length,a=l.length,r===a&&o._stable)for(n=0;r>n;n++)l[n]=l[n].unserialize(i[n]);else{for(n=0;a>n;n++)l[n]&&l[n].dispose(!0),l[n]=null;for(l=[],n=0;r>n;n++){if(s=i[n]&&i[n].filter?e[i[n].filter]:null,!s)throw new Error('Filter "'+i[n].filter+'" could not be created');l.push((new s).unserialize(i[n]))}}o._stack=l}return o},getMeta:function(){return this._meta},setMeta:function(e){var t,n,r=this,a=r._stack;if(e&&(n=e.length)&&a.length)for(t=0;n>t;t++)a[e[t][0]].setMeta(e[t][1]);return r},stable:function(e){return arguments.length||(e=!0),this._stable=!!e,this},filters:function(e){return arguments.length?(this._stack=e.slice(),this):this._stack.slice()},push:function(){var e=r.call(arguments),t=e.length;return t&&(this._stack=i.apply(this._stack,e)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var e=r.call(arguments),t=e.length;return t&&a.apply(this._stack,[0,0].concat(e)),this},getAt:function(e){return this._stack.length>e?this._stack[e]:null},setAt:function(e,t){return this._stack.length>e?this._stack[e]=t:this._stack.push(t),this},insertAt:function(e){var t=r.call(arguments);t.length;return argslen>1&&(t.shift(),a.apply(this._stack,[e,0].concat(t))),this},removeAt:function(e){return this._stack.splice(e,1)},remove:function(e){for(var t=this._stack.length;--t>=0;)e===this._stack[t]&&this._stack.splice(t,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(e,t,n,r){var a=this;if(a.hasMeta=!1,a._meta=[],a._isOn&&a._stack.length){var i,s,o=a._stack,l=o.length;for(i=0;l>i;i++)s=o[i],s&&s._isOn&&(e=s._apply(e,t,n,r),s.hasMeta&&a._meta.push([i,s.getMeta()]))}return a.hasMeta=a._meta.length>0,e},canRun:function(){return this._isOn&&this._stack.length},toString:function(){var e,t=arguments.length&&arguments[0].substr?arguments[0]:"  ",n=t+t,r=this._stack,a=[],i=r.length;for(e=0;i>e;e++)a.push(r[e].toString(n));return["[FILTER: "+this.name+"]","[","  "+a.join("\n  "),"]",""].join("\n")}});s.prototype.empty=s.prototype.reset,s.prototype.concat=s.prototype.push}(FILTER),!function(e,t){var n="hasOwnProperty";e.InlineFilter=e.Class(e.Filter,{name:"InlineFilter",constructor:function(e){var t=this;t.$super("constructor"),t._handler=e&&"function"==typeof e?e:null,t._params={}},_handler:null,_params:null,dispose:function(){var e=this;return e.$super("dispose"),e._handler=null,e._params=null,e},params:function(e){var t=this;if(arguments.length){for(var r in e)e[n](r)&&(t._params[r]=e[r]);return t}return t._params},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_handler:e._handler?e._handler.toString():null,_params:e._params}}},unserialize:function(t){var n,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,n=t.params,r._handler=null,n._handler&&(r._handler=new Function("FILTER",'"use strict"; return '+n._handler+";")(e)),r._params=n._params||{}),r},_apply:function(e,t,n,r){var a=this;return a._isOn&&a._handler?a._handler(a,e,t,n,r):e},canRun:function(){return this._isOn&&this._handler}});e.CustomFilter=e.InlineFilter}(FILTER),!function(e,t){function n(e,t){var n,r,a,i,o,l=new s(20);return n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],l[0]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[1]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[2]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[3]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[4]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,n=t[5],r=t[6],a=t[7],i=t[8],o=t[9],l[5]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[6]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[7]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[8]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[9]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,n=t[10],r=t[11],a=t[12],i=t[13],o=t[14],l[10]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[11]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[12]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[13]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[14]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,n=t[15],r=t[16],a=t[17],i=t[18],o=t[19],l[15]=n*e[0]+r*e[5]+a*e[10]+i*e[15],l[16]=n*e[1]+r*e[6]+a*e[11]+i*e[16],l[17]=n*e[2]+r*e[7]+a*e[12]+i*e[17],l[18]=n*e[3]+r*e[8]+a*e[13]+i*e[18],l[19]=n*e[4]+r*e[9]+a*e[14]+i*e[19]+o,l}function r(e,t,n){var r=1-n,a=new s(20);return a[0]=r*e[0]+n*t[0],a[1]=r*e[1]+n*t[1],a[2]=r*e[2]+n*t[2],a[3]=r*e[3]+n*t[3],a[4]=r*e[4]+n*t[4],a[5]=r*e[5]+n*t[5],a[6]=r*e[6]+n*t[6],a[7]=r*e[7]+n*t[7],a[8]=r*e[8]+n*t[8],a[9]=r*e[9]+n*t[9],a[10]=r*e[10]+n*t[10],a[11]=r*e[11]+n*t[11],a[12]=r*e[12]+n*t[12],a[13]=r*e[13]+n*t[13],a[14]=r*e[14]+n*t[14],a[15]=r*e[15]+n*t[15],a[16]=r*e[16]+n*t[16],a[17]=r*e[17]+n*t[17],a[18]=r*e[18]+n*t[18],a[19]=r*e[19]+n*t[19],a}var a=Math.sin,i=Math.cos,s=e.Array32F,o=e.CONST.toRad,l=(e.CONST.toDeg,e._notSupportClamp),u=e.ColorMatrixFilter=e.Class(e.Filter,{name:"ColorMatrixFilter",constructor:function(t){var n=this;n.$super("constructor"),t&&t.length?n._matrix=new s(t):n._matrix=null,e.useWebGL&&(n._webglInstance=e.WebGLColorMatrixFilterInstance||null)},_matrix:null,_webglInstance:null,dispose:function(){var e=this;return e.$super("dispose"),e._webglInstance=null,e._matrix=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_matrix:e._matrix}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._matrix=t._matrix),n},channel:function(n,r){r=r===t?!1:r;var a=r?1:0;switch(n){case e.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case e.CHANNEL.BLUE:return this.set([0,0,a,0,0,0,0,a,0,0,0,0,1,0,0,0,0,0,0,255]);case e.CHANNEL.GREEN:return this.set([0,a,0,0,0,0,1,0,0,0,0,a,0,0,0,0,0,0,0,255]);case e.CHANNEL.RED:default:return this.set([1,0,0,0,0,a,0,0,0,0,a,0,0,0,0,0,0,0,0,255])}},redChannel:function(t){return this.channel(e.CHANNEL.RED,t)},greenChannel:function(t){return this.channel(e.CHANNEL.GREEN,t)},blueChannel:function(t){return this.channel(e.CHANNEL.BLUE,t)},alphaChannel:function(t){return this.channel(e.CHANNEL.ALPHA,!0)},maskChannel:function(t){switch(t){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(t,n){switch(t){case e.CHANNEL.ALPHA:switch(n){case e.CHANNEL.ALPHA:return this;case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case e.CHANNEL.BLUE:switch(n){case e.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case e.CHANNEL.BLUE:return this;case e.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case e.CHANNEL.GREEN:switch(n){case e.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case e.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this;case e.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case e.CHANNEL.RED:default:switch(n){case e.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case e.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case e.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case e.CHANNEL.RED:default:return this}}},desaturate:function(){return this.set([e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,0,0,0,0,1,0])},colorize:function(n,r){var a,i,s,o;return r===t&&(r=1),a=.00392156862745098*(n>>16&255),i=.00392156862745098*(n>>8&255),s=.00392156862745098*(255&n),o=1-r,this.set([o+r*a*e.LUMA[0],r*a*e.LUMA[1],r*a*e.LUMA[2],0,0,r*i*e.LUMA[0],o+r*i*e.LUMA[1],r*i*e.LUMA[2],0,0,r*s*e.LUMA[0],r*s*e.LUMA[1],o+r*s*e.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(t){var n,r,a,i;return n=1-t,r=n*e.LUMA[0],a=n*e.LUMA[1],i=n*e.LUMA[2],this.set([r+t,a,i,0,0,r,a+t,i,0,0,r,a,i+t,0,0,0,0,0,1,0])},contrast:function(e,n,r){return n===t&&(n=e),r===t&&(r=e),e+=1,n+=1,r+=1,this.set([e,0,0,0,128*(1-e),0,n,0,0,128*(1-n),0,0,r,0,128*(1-r),0,0,0,1,0])},brightness:function(e,n,r){return n===t&&(n=e),r===t&&(r=e),this.set([1,0,0,0,e,0,1,0,0,n,0,0,1,0,r,0,0,0,1,0])},adjustHue:function(t){t*=o;var n=i(t),r=a(t);return this.set([e.LUMA[0]+n*(1-e.LUMA[0])+r*-e.LUMA[0],e.LUMA[1]+n*-e.LUMA[1]+r*-e.LUMA[1],e.LUMA[2]+n*-e.LUMA[2]+r*(1-e.LUMA[2]),0,0,e.LUMA[0]+n*-e.LUMA[0]+.143*r,e.LUMA[1]+n*(1-e.LUMA[1])+.14*r,e.LUMA[2]+n*-e.LUMA[2]+r*-.283,0,0,e.LUMA[0]+n*-e.LUMA[0]+r*-(1-e.LUMA[0]),e.LUMA[1]+n*-e.LUMA[1]+r*e.LUMA[1],e.LUMA[2]+n*(1-e.LUMA[2])+r*e.LUMA[2],0,0,0,0,0,1,0])},average:function(e,n,r){return e===t&&(e=.3333),n===t&&(n=.3333),r===t&&(r=.3334),this.set([e,n,r,0,0,e,n,r,0,0,e,n,r,0,0,0,0,0,1,0])},quickContrastCorrection:function(e){return e===t&&(e=1.2),this.set([e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0])},sepia:function(e){return e===t&&(e=.5),e>1?e=1:0>e&&(e=0),this.set([1-.607*e,.769*e,.189*e,0,0,.349*e,1-.314*e,.168*e,0,0,.272*e,.534*e,1-.869*e,0,0,0,0,0,1,0])},sepia2:function(n){return n===t&&(n=10),n>100&&(n=100),n*=2.55,this.set([e.LUMA[0],e.LUMA[1],e.LUMA[2],0,40,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,20,e.LUMA[0],e.LUMA[1],e.LUMA[2],0,-n,0,0,0,1,0])},threshold:function(n,r){return r===t&&(r=256),this.set([e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,e.LUMA[0]*r,e.LUMA[1]*r,e.LUMA[2]*r,0,-(r-1)*n,0,0,0,1,0])},threshold_rgb:function(e,n){return n===t&&(n=256),this.set([n,0,0,0,-(n-1)*e,0,n,0,0,-(n-1)*e,0,0,n,0,-(n-1)*e,0,0,0,1,0])},threshold_alpha:function(e,n){return e===t&&(e=.5),n===t&&(n=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,n,-n*e])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(e,t){return this._matrix=this._matrix?r(this._matrix,e.getMatrix(),t):new s(e.getMatrix()),this},set:function(e){return this._matrix=this._matrix?n(this._matrix,new s(e)):new s(e),this},reset:function(){return this._matrix=null,this},combineWith:function(e){return this.set(e.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(e){return this._matrix=new s(e),this},_apply:function(e,t,n){var r=this;if(r._isOn&&r._matrix){var a,i,s,o,l,u,c,h,f,d,p,m,_,g,v,y,w,C,A,b,E,R=e.length,I=r._matrix,M=(R>>2)%4;for(a=0;R>a;a+=16)C=e[a],A=e[a+1],b=e[a+2],E=e[a+3],i=I[0]*C+I[1]*A+I[2]*b+I[3]*E+I[4],s=I[5]*C+I[6]*A+I[7]*b+I[8]*E+I[9],o=I[10]*C+I[11]*A+I[12]*b+I[13]*E+I[14],l=I[15]*C+I[16]*A+I[17]*b+I[18]*E+I[19],C=e[a+4],A=e[a+5],b=e[a+6],E=e[a+7],u=I[0]*C+I[1]*A+I[2]*b+I[3]*E+I[4],c=I[5]*C+I[6]*A+I[7]*b+I[8]*E+I[9],h=I[10]*C+I[11]*A+I[12]*b+I[13]*E+I[14],f=I[15]*C+I[16]*A+I[17]*b+I[18]*E+I[19],C=e[a+8],A=e[a+9],b=e[a+10],E=e[a+11],d=I[0]*C+I[1]*A+I[2]*b+I[3]*E+I[4],p=I[5]*C+I[6]*A+I[7]*b+I[8]*E+I[9],m=I[10]*C+I[11]*A+I[12]*b+I[13]*E+I[14],_=I[15]*C+I[16]*A+I[17]*b+I[18]*E+I[19],C=e[a+12],A=e[a+13],b=e[a+14],E=e[a+15],g=I[0]*C+I[1]*A+I[2]*b+I[3]*E+I[4],v=I[5]*C+I[6]*A+I[7]*b+I[8]*E+I[9],y=I[10]*C+I[11]*A+I[12]*b+I[13]*E+I[14],w=I[15]*C+I[16]*A+I[17]*b+I[18]*E+I[19],e[a]=~~i,e[a+1]=~~s,e[a+2]=~~o,e[a+3]=~~l,e[a+4]=~~u,e[a+5]=~~c,e[a+6]=~~h,e[a+7]=~~f,e[a+8]=~~d,e[a+9]=~~p,e[a+10]=~~m,e[a+11]=~~_,e[a+12]=~~g,e[a+13]=~~v,e[a+14]=~~y,e[a+15]=~~w;if(M)for(M<<=2,a=R-M;R>a;a+=4)C=e[a],A=e[a+1],b=e[a+2],E=e[a+3],i=I[0]*C+I[1]*A+I[2]*b+I[3]*E+I[4],s=I[5]*C+I[6]*A+I[7]*b+I[8]*E+I[9],o=I[10]*C+I[11]*A+I[12]*b+I[13]*E+I[14],l=I[15]*C+I[16]*A+I[17]*b+I[18]*E+I[19],e[a]=~~i,e[a+1]=~~s,e[a+2]=~~o,e[a+3]=~~l}return e},canRun:function(){return this._isOn&&this._matrix}});u.prototype.grayscale=u.prototype.desaturate,u.prototype.rotateHue=u.prototype.adjustHue,u.prototype.thresholdRgb=u.prototype.threshold_rgb,u.prototype.thresholdAlpha=u.prototype.threshold_alpha,l&&(u.prototype._apply=function(e,t,n){var r=this;if(r._isOn&&r._matrix){var a,i,s,o,l,u,c,h,f,d,p,m,_,g,v,y,w,C,A,b,E,R=e.length,I=r._matrix,M=(R>>2)%4;for(a=0;R>a;a+=16)C=e[a],A=e[a+1],b=e[a+2],E=e[a+3],i=I[0]*C+I[1]*A+I[2]*b+I[3]*E+I[4],s=I[5]*C+I[6]*A+I[7]*b+I[8]*E+I[9],o=I[10]*C+I[11]*A+I[12]*b+I[13]*E+I[14],l=I[15]*C+I[16]*A+I[17]*b+I[18]*E+I[19],C=e[a+4],A=e[a+5],b=e[a+6],E=e[a+7],u=I[0]*C+I[1]*A+I[2]*b+I[3]*E+I[4],c=I[5]*C+I[6]*A+I[7]*b+I[8]*E+I[9],h=I[10]*C+I[11]*A+I[12]*b+I[13]*E+I[14],f=I[15]*C+I[16]*A+I[17]*b+I[18]*E+I[19],C=e[a+8],A=e[a+9],b=e[a+10],E=e[a+11],d=I[0]*C+I[1]*A+I[2]*b+I[3]*E+I[4],p=I[5]*C+I[6]*A+I[7]*b+I[8]*E+I[9],m=I[10]*C+I[11]*A+I[12]*b+I[13]*E+I[14],_=I[15]*C+I[16]*A+I[17]*b+I[18]*E+I[19],C=e[a+12],A=e[a+13],b=e[a+14],E=e[a+15],g=I[0]*C+I[1]*A+I[2]*b+I[3]*E+I[4],v=I[5]*C+I[6]*A+I[7]*b+I[8]*E+I[9],y=I[10]*C+I[11]*A+I[12]*b+I[13]*E+I[14],w=I[15]*C+I[16]*A+I[17]*b+I[18]*E+I[19],i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s,o=0>o?0:o>255?255:o,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,p=0>p?0:p>255?255:p,m=0>m?0:m>255?255:m,_=0>_?0:_>255?255:_,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,y=0>y?0:y>255?255:y,w=0>w?0:w>255?255:w,e[a]=~~i,e[a+1]=~~s,e[a+2]=~~o,e[a+3]=~~l,e[a+4]=~~u,e[a+5]=~~c,e[a+6]=~~h,e[a+7]=~~f,e[a+8]=~~d,e[a+9]=~~p,e[a+10]=~~m,e[a+11]=~~_,e[a+12]=~~g,e[a+13]=~~v,e[a+14]=~~y,e[a+15]=~~w;if(M)for(M<<=2,a=R-M;R>a;a+=4)C=e[a],A=e[a+1],b=e[a+2],E=e[a+3],i=I[0]*C+I[1]*A+I[2]*b+I[3]*E+I[4],s=I[5]*C+I[6]*A+I[7]*b+I[8]*E+I[9],o=I[10]*C+I[11]*A+I[12]*b+I[13]*E+I[14],l=I[15]*C+I[16]*A+I[17]*b+I[18]*E+I[19],i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s,o=0>o?0:o>255?255:o,l=0>l?0:l>255?255:l,e[a]=~~i,e[a+1]=~~s,e[a+2]=~~o,e[a+3]=~~l}return e})}(FILTER),!function(e,t){var n=e.ImArrayCopy,r=e.Color.clampPixel,a=function(){var e,t=new n(256);for(e=0;256>e;e++)t[e]=e;return t},i=function(){var e,t=new n(256);for(e=0;256>e;e++)t[e]=255-e;return t},s=function(e){var t,r=new n(256);for(t=0;256>t;t++)r[t]=e;return r},o=function(e){return e?new n(e):null},l=Math.pow,u=Math.exp,c=1/255,h=e.TableLookupFilter=e.Class(e.Filter,{name:"TableLookupFilter",constructor:function(e,t,n,r){var a=this;a.$super("constructor"),a._tableR=e||null,a._tableG=t||a._tableR,a._tableB=n||a._tableG,a._tableA=r||null},_tableR:null,_tableG:null,_tableB:null,_tableA:null,dispose:function(){var e=this;return e.$super("dispose"),e._tableR=null,e._tableG=null,e._tableB=null,e._tableA=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_tableR:e._tableR,_tableG:e._tableG,_tableB:e._tableB,_tableA:e._tableA}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._tableR=t._tableR,n._tableG=t._tableG,n._tableB=t._tableB,n._tableA=t._tableA),n},thresholds:function(e,t,a){e.length||(e=[e]),t||(t=e),a||(a=t);var i,s,o=e.length,l=o+1,u=t.length,c=u+1,h=a.length,f=h+1,d=new n(256),p=new n(l),m=new n(256),_=new n(c),g=new n(256),v=new n(f),y=255/(l-1),w=255/(c-1),C=255/(f-1);for(i=0;l>i;)p[i]=~~(y*i),i++;for(e[0]=~~(255*e[0]),i=1;o>i;)e[i]=e[i-1]+~~(255*e[i]),i++;for(i=0;c>i;)_[i]=~~(w*i),i++;for(t[0]=~~(255*t[0]),i=1;u>i;)t[i]=t[i-1]+~~(255*t[i]),i++;for(i=0;f>i;)v[i]=~~(C*i),i++;for(a[0]=~~(255*a[0]),i=1;h>i;)a[i]=a[i-1]+~~(255*a[i]),i++;for(i=0;256>i;i++){for(s=0;o>s&&i>e[s];)s++;for(d[i]=r(p[s]),s=0;u>s&&i>t[s];)s++;for(m[i]=r(_[s]),s=0;h>s&&i>a[s];)s++;g[i]=r(v[s])}return this.set(d,m,g)},threshold:function(e,t,n){return e=e||.5,t=t||e,n=n||t,this.thresholds([e],[t],[n])},quantize:function(e){e===t&&(e=64),2>e&&(e=2);var a,i=new n(256),s=new n(e),o=255/(e-1),l=e/256;for(a=0;e>a;)s[a]=~~(o*a),a++;for(a=0;256>a;a++)i[a]=r(s[~~(l*a)]);return this.set(i)},binarize:function(){return this.quantize(2)},solarize:function(e){e===t&&(e=.5);var a,i,s=0,o=new n(256),l=2/255;for(s=0;256>s;s++)a=l*s,i=a>e?255-255*a:255*a-255,o[s]=~~r(i);return this.set(o)},solarize2:function(e){e===t&&(e=.5),e=1-e;var a,i,s=0,o=new n(256),l=2/255;for(s=0;256>s;s++)a=l*s,i=e>a?255-255*a:255*a-255,o[s]=~~r(i);return this.set(o)},solarizeInverse:function(e){e===t&&(e=.5),e*=256;var r=0,a=new n(256);for(r=0;256>r;r++)a[r]=r>e?255-r:r;return this.set(a)},invert:function(){return this.set(i())},mask:function(e){var t=0,a=e>>16&255,i=e>>8&255,s=255&e;for(tR=new n(256),tG=new n(256),tB=new n(256),t=0;256>t;t++)tR[t]=r(t&a),tG[t]=r(t&i),tB[t]=r(t&s);return this.set(tR,tG,tB)},replace:function(e,t){if(e==t)return this;var n=e>>16&255,r=e>>8&255,i=255&e,s=t>>16&255,o=t>>8&255,l=255&t,u=a(),c=a(),h=a();return u[n]=s,c[r]=o,h[i]=l,this.set(u,c,h)},extract:function(t,n,a){if(!n||!n.length)return this;a=a||0;var i,o,l=a>>16&255,u=a>>8&255,c=255&a,h=s(l),f=s(u),d=s(c);switch(t){case e.CHANNEL.BLUE:for(i=n[0],o=n[1];o>=i;)d[i]=r(i),i++;break;case e.CHANNEL.GREEN:for(i=n[0],o=n[1];o>=i;)f[i]=r(i),i++;break;case e.CHANNEL.RED:default:for(i=n[0],o=n[1];o>=i;)h[i]=r(i),i++}return this.set(h,f,d)},gammaCorrection:function(e,t,a){e=e||1,t=t||e,a=a||t,e=1/e,t=1/t,a=1/a;var i=new n(256),s=new n(256),o=new n(256),u=0;for(u=0;256>u;u++)i[u]=r(~~(255*l(c*u,e))),s[u]=r(~~(255*l(c*u,t))),o[u]=r(~~(255*l(c*u,a)));return this.set(i,s,o)},exposure:function(e){e===t&&(e=1);var a=0,i=new n(256);for(a=0;256>a;a++)i[a]=r(~~(255*(1-u(-e*a*c))));return this.set(i)},set:function(e,t,n,i){if(!e)return this;t=t||e,n=n||t;var s,l,u,c,h,f=this._tableR||a(),d=o(f);if(t&&n){for(s=this._tableG||o(f),l=this._tableB||o(s),u=o(s),c=o(l),h=0;256>h;h++)f[h]=r(e[r(d[h])]),s[h]=r(t[r(u[h])]),l[h]=r(n[r(c[h])]);this._tableR=f,this._tableG=s,this._tableB=l}else{for(h=0;256>h;h++)f[h]=r(e[r(d[h])]);this._tableR=f,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=this._tableG=this._tableB=this._tableA=null,this},combineWith:function(e){return this.set(e.getTable(0),e.getTable(1),e.getTable(2))},getTable:function(t){switch(t=t||e.CHANNEL.RED){case e.CHANNEL.ALPHA:return this._tableA;case e.CHANNEL.BLUE:return this._tableB;case e.CHANNEL.GREEN:return this._tableG;case e.CHANNEL.RED:default:return this._tableR}},setTable:function(t,n){switch(n=n||e.CHANNEL.RED){case e.CHANNEL.ALPHA:return this._tableA=t,this;case e.CHANNEL.BLUE:return this._tableB=t,this;case e.CHANNEL.GREEN:return this._tableG=t,this;case e.CHANNEL.RED:default:return this._tableR=t,this}},_apply:function(e,t,n){var r=this;if(!r._isOn||!r._tableR)return e;var a,i,s,o,l,u=e.length,c=(u>>2)%4,h=r._tableR,f=r._tableG,d=r._tableB,p=r._tableA;if(p){for(a=0;u>a;a+=16)i=e[a],s=e[a+1],o=e[a+2],l=e[a+3],e[a]=h[i],e[a+1]=f[s],e[a+2]=d[o],e[a+3]=p[l],i=e[a+4],s=e[a+5],o=e[a+6],l=e[a+7],e[a+4]=h[i],e[a+5]=f[s],e[a+6]=d[o],e[a+7]=p[l],
i=e[a+8],s=e[a+9],o=e[a+10],l=e[a+11],e[a+8]=h[i],e[a+9]=f[s],e[a+10]=d[o],e[a+11]=p[l],i=e[a+12],s=e[a+13],o=e[a+14],l=e[a+15],e[a+12]=h[i],e[a+13]=f[s],e[a+14]=d[o],e[a+15]=p[l];if(c)for(c<<=2,a=u-c;u>a;a+=4)i=e[a],s=e[a+1],o=e[a+2],l=e[a+3],e[a]=h[i],e[a+1]=f[s],e[a+2]=d[o],e[a+3]=p[l]}else{for(a=0;u>a;a+=16)i=e[a],s=e[a+1],o=e[a+2],e[a]=h[i],e[a+1]=f[s],e[a+2]=d[o],i=e[a+4],s=e[a+5],o=e[a+6],e[a+4]=h[i],e[a+5]=f[s],e[a+6]=d[o],i=e[a+8],s=e[a+9],o=e[a+10],e[a+8]=h[i],e[a+9]=f[s],e[a+10]=d[o],i=e[a+12],s=e[a+13],o=e[a+14],e[a+12]=h[i],e[a+13]=f[s],e[a+14]=d[o];if(c)for(c<<=2,a=u-c;u>a;a+=4)i=e[a],s=e[a+1],o=e[a+2],e[a]=h[i],e[a+1]=f[s],e[a+2]=d[o]}return e},canRun:function(){return this._isOn&&this._tableR}});h.prototype.posterize=h.prototype.levels=h.prototype.quantize}(FILTER),!function(e,t){var n=(e.ImArray,e.ImArrayCopy),r=e.Array16I,a=Math.min,i=(Math.max,Math.floor);e.DisplacementMapFilter=e.Class(e.Filter,{name:"DisplacementMapFilter",constructor:function(e){var t=this;t.$super("constructor"),e&&t.setMap(e)},_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:e.MODE.CLAMP,dispose:function(){var e=this;return e.$super("dispose"),e._map=null,e.map=null,e.scaleX=null,e.scaleY=null,e.startX=null,e.startY=null,e.componentX=null,e.componentY=null,e.color=null,e.red=null,e.green=null,e.blue=null,e.alpha=null,e.mode=null,e},serialize:function(){var e=this,t=e.map;return{filter:e.name,_isOn:!!e._isOn,params:{_map:e._map||(t?{data:t.getData(),width:t.width,height:t.height}:null),scaleX:e.scaleX,scaleY:e.scaleY,startX:e.startX,startY:e.startY,componentX:e.componentX,componentY:e.componentY,color:e.color,red:e.red,green:e.green,blue:e.blue,alpha:e.alpha,mode:e.mode}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n.map=null,n._map=t._map,n.scaleX=t.scaleX,n.scaleY=t.scaleY,n.startX=t.startX,n.startY=t.startY,n.componentX=t.componentX,n.componentY=t.componentY,n.color=t.color,n.red=t.red,n.green=t.green,n.blue=t.blue,n.alpha=t.alpha,n.mode=t.mode),n},reset:function(){var e=this;return e._map=null,e.map=null,e},getMap:function(){return this.map},setMap:function(e){var t=this;return e&&(t.map=e,t._map=null),t},setColor:function(e){var t=this;return t.color=e,t.alpha=e>>24&255,t.red=e>>16&255,t.green=e>>8&255,t.blue=255&e,t},_apply:function(t,s,o){var l=this;if(!l._isOn||!l.map&&!l._map)return t;var u,c,h,f,d,p,m,_,g,v,y,w,C,A,b,E,R,I,M,L,x,N,S,T,O,F,D,P,k,G,H,U=l.map,X=l._map||{data:U.getData(),width:U.width,height:U.height},B=.00390625*l.scaleX,Y=.00390625*l.scaleY,W=l.componentX,q=l.componentY,z=l.alpha,$=l.red,j=l.green,K=l.blue,J=l.mode,V=e.MODE.IGNORE,Q=(e.MODE.CLAMP,e.MODE.COLOR),Z=e.MODE.WRAP;for(u=X.data,c=X.width,h=X.height,f=u.length>>2,p=a(c,s),m=a(h,o),P=t.length,F=p*m<<2,D=P>>2,g=i(l.startX*(s-1)),_=i(l.startY*(o-1)),v=_*s,y=-g,w=-_,C=s-g-1,A=o-_-1,d=new r(f<<1),k=new n(t),E=0,R=0,I=0,M=0,b=0;f>b;b++,E+=2,R++)R>=c&&(R=0,I++,M+=c),S=R+M<<2,d[E]=i((u[S+W]-128)*B),d[E+1]=i((u[S+q]-128)*Y);for(R=0,I=0,M=0,L=0,b=0;F>b;b+=4,R++)if(R>=p&&(R=0,I++,M+=s,L+=c),!(w>I||I>A||y>R||R>C)){if(N=R+g,x=I+_,T=N+M+v<<2,E=R+L<<1,G=N+d[E],H=x+d[E+1],H>=o||0>H||G>=s||0>G){if(J==V)continue;if(J==Q){t[T]=$,t[T+1]=j,t[T+2]=K,t[T+3]=z;continue}J==Z?(H>A?H-=o:0>H&&(H+=o),G>C?G-=s:0>G&&(G+=s)):(H>A?H=A:0>H&&(H=0),G>C?G=C:0>G&&(G=0))}O=G+H*s<<2,t[T]=k[O],t[T+1]=k[O+1],t[T+2]=k[O+2],t[T+3]=k[O+3]}return t},canRun:function(){return this._isOn&&(this._map||this.map)}})}(FILTER),!function(FILTER,undef){var IMG=FILTER.ImArray,IMGcopy=FILTER.ImArrayCopy,PI=FILTER.CONST.PI,DoublePI=FILTER.CONST.PI2,HalfPI=FILTER.CONST.PI_2,ThreePI2=1.5*PI,Sqrt=Math.sqrt,Atan2=Math.atan2,Atan=Math.atan,Sin=Math.sin,Cos=Math.cos,Floor=Math.floor,Round=Math.round,Asin=Math.asin,Tan=Math.tan,Abs=Math.abs,Max=Math.max,toRad=FILTER.CONST.toRad,Maps,GeometricMapFilter=FILTER.GeometricMapFilter=FILTER.Class(FILTER.Filter,{name:"GeometricMapFilter",constructor:function(e){var t=this;t.$super("constructor"),e&&t.generic(e)},_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,dx:0,dy:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:FILTER.MODE.CLAMP,dispose:function(){var e=this;return e.$super("dispose"),e._map=null,e._mapName=null,e.inverseTransform=null,e.matrix=null,e.centerX=null,e.centerY=null,e.dx=null,e.dy=null,e.angle=null,e.radius=null,e.wavelength=null,e.amplitude=null,e.phase=null,e.xAmplitude=null,e.yAmplitude=null,e.xWavelength=null,e.yWavelength=null,e.mode=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_mapName:e._mapName,inverseTransform:e.inverseTransform?e.inverseTransform.toString():null,matrix:e.matrix,centerX:e.centerX,centerY:e.centerY,dx:e.dx,dy:e.dy,angle:e.angle,radius:e.radius,wavelength:e.wavelength,amplitude:e.amplitude,phase:e.phase,xAmplitude:e.xAmplitude,yAmplitude:e.yAmplitude,xWavelength:e.xWavelength,yWavelength:e.yWavelength,mode:e.mode}}},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self.inverseTransform=null,self.matrix=params.matrix,self.centerX=params.centerX,self.centerY=params.centerY,self.dx=params.dx,self.dy=params.dy,self.angle=params.angle,self.radius=params.radius,self.wavelength=params.wavelength,self.amplitude=params.amplitude,self.phase=params.phase,self.xAmplitude=params.xAmplitude,self.yAmplitude=params.yAmplitude,self.xWavelength=params.xWavelength,self.yWavelength=params.yWavelength,self.mode=params.mode,params.inverseTransform&&(self.inverseTransform=eval('(function(){ "use strict"; return '+params.inverseTransform+"})();")),self._mapName=params._mapName,self._map=null,self._mapName&&Maps[self._mapName]&&(self._map=Maps[self._mapName])),self},generic:function(e){var t=this;return e&&(t.inverseTransform=e,t._mapName="generic",t._map=Maps.generic),t},affine:function(e){var t=this;return e&&(t.matrix=e,t._mapName="affine",t._map=Maps.affine),t},flipX:function(){var e=this;return e._mapName="flipX",e._map=Maps.flipX,e},flipY:function(){var e=this;return e._mapName="flipY",e._map=Maps.flipY,e},flipXY:function(){var e=this;return e._mapName="flipXY",e._map=Maps.flipXY,e},rotateCW:function(){var e=this;return e._mapName="rotateCW",e._map=Maps.rotateCW,e},rotateCCW:function(){var e=this;return e._mapName="rotateCCW",e._map=Maps.rotateCCW,e},polar:function(e,t){var n=this;return n.centerX=e||0,n.centerY=t||0,n._mapName="polar",n._map=Maps.polar,n},cartesian:function(e,t){var n=this;return n.centerX=e||0,n.centerY=t||0,n._mapName="cartesian",n._map=Maps.cartesian,n},twirl:function(e,t,n,r){var a=this;return a.angle=e||0,a.radius=t||0,a.centerX=n||0,a.centerY=r||0,a._mapName="twirl",a._map=Maps.twirl,a},sphere:function(e,t,n){var r=this;return r.radius=e||0,r.centerX=t||0,r.centerY=n||0,r._mapName="sphere",r._map=Maps.sphere,r},ripple:function(e,t,n,r,a,i){var s=this;return s.radius=e!==undef?e:50,s.centerX=a||0,s.centerY=i||0,s.wavelength=t!==undef?t:16,s.amplitude=n!==undef?n:10,s.phase=r||0,s._mapName="ripple",s._map=Maps.ripple,s},shift:function(e,t){var n=this;return n.dx=e!==undef?e:0,n.dy=t!==undef?t:n.dx,n._mapName="shift",n._map=Maps.shift,n},reset:function(){var e=this;return e._mapName=null,e._map=null,e},getMap:function(){return this._map},setMap:function(e){var t=this;return t._mapName=null,t._map=e,t},_apply:function(e,t,n,r){var a=this;return a._isOn&&a._map?a._map(a,e,t,n,r):e},canRun:function(){return this._isOn&&this._map}});GeometricMapFilter.prototype.translate=GeometricMapFilter.prototype.shift,Maps={generic:function(e,t,n,r){var a,i,s,o,l,u,c,h=t.length,f=new IMG(h),d=e.inverseTransform,p=e.mode,m=FILTER.MODE.CLAMP,_=FILTER.MODE.WRAP;for(a=0,i=0,s=0;h>s;s+=4,a++){if(a>=n&&(a=0,i++),l=d([a,i],n,r),u=~~l[0],c=~~l[1],0>u||u>=n||0>c||c>=r)switch(p){case _:c>=r?c-=r:0>c&&(c+=r),u>=n?u-=n:0>u&&(u+=n);break;case m:default:c>=r?c=r-1:0>c&&(c=0),u>=n?u=n-1:0>u&&(u=0)}o=u+c*n<<2,f[s]=t[o],f[s+1]=t[o+1],f[s+2]=t[o+2],f[s+3]=t[o+3]}return f},affine:function(e,t,n,r){var a,i,s,o,l,u,c,h,f,d=t.length,p=d>>2,m=new IMG(d),_=e.matrix,g=_[0],v=_[1],y=_[3],w=_[4],C=_[2],A=_[5],b=e.mode,E=FILTER.MODE.CLAMP,R=FILTER.MODE.WRAP,I=n-1,M=p-n;for(a=0,i=0,l=A*n,u=y*n,c=w*n,s=0;d>s;s+=4,a++){if(a>=n&&(a=0,i++),h=~~(g*a+v*i+C),f=~~(u*a+c*i+l),0>h||h>I||0>f||f>M)switch(b){case R:f>M?f-=p:0>f&&(f+=p),h>=n?h-=n:0>h&&(h+=n);break;case E:default:f>M?f=M:0>f&&(f=0),h>I?h=I:0>h&&(h=0)}o=h+f<<2,m[s]=t[o],m[s+1]=t[o+1],m[s+2]=t[o+2],m[s+3]=t[o+3]}return m},shift:function(e,t,n,r){var a,i,s,o,l,u=t.length,c=new IMG(u),h=-e.dx,f=-e.dy;for(0>h&&(h+=n),0>f&&(f+=r),a=0,i=0,s=0,o=0;u>o;o+=4,a++)a>=n&&(a=0,i++,s+=n),l=(a+h)%n+(i+f)%r*n<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},flipX:function(e,t,n,r){var a,i,s,o,l,u=t.length,c=new IMG(u);for(a=0,i=0,s=0,o=0;u>o;o+=4,a++)a>=n&&(a=0,i++,s+=n),l=n-1-a+s<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},flipY:function(e,t,n,r){var a,i,s,o,l,u=t.length,c=new IMG(u);for(a=0,i=0,s=(r-1)*n,o=0;u>o;o+=4,a++)a>=n&&(a=0,i++,s-=n),l=a+s<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},flipXY:function(e,t,n,r){var a,i,s,o,l,u,c=t.length,h=new IMG(c);for(a=0,i=0,o=(r-1)*n,l=0;c>l;l+=4,a++)a>=n&&(a=0,i++,s+=n,o-=n),u=n-1-a+o<<2,h[l]=t[u],h[l+1]=t[u+1],h[l+2]=t[u+2],h[l+3]=t[u+3];return h},rotateCW:function(e,t,n,r){var a,i,s,o,l,u=t.length,c=new IMG(u),h=u>>2;for(a=0,i=0,s=h-1,o=0;u>o;o+=4,a++,s-=n)a>=n&&(a=0,s=h-1,i++),l=i+s<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},rotateCCW:function(e,t,n,r){var a,i,s,o,l,u=t.length,c=new IMG(u);for(a=0,i=0,s=0,o=0;u>o;o+=4,a++,s+=n)a>=n&&(a=0,s=0,i++),l=n-1-i+s<<2,c[o]=t[l],c[o+1]=t[l+1],c[o+2]=t[l+2],c[o+3]=t[l+3];return c},twirl:function(e,t,n,r){if(0>=e.radius)return t;var a,i,s,o,l,u,c,h,f=t.length,d=new IMGcopy(t),p=e.centerX,m=e.centerY,_=e.angle,g=e.radius,v=e.mode,y=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,C=_/g,A=n-1,b=r-1;for(p=Floor(p*(n-1)),m=Floor(m*(r-1)),a=0,i=0,s=0;f>s;s+=4,a++)if(a>=n&&(a=0,i++),u=a-p,c=i-m,l=Sqrt(u*u+c*c),g>l){if(h=Atan2(c,u)+C*(g-l),u=~~(p+l*Cos(h)),c=~~(m+l*Sin(h)),0>u||u>A||0>c||c>b)switch(v){case w:c>b?c-=r:0>c&&(c+=r),u>A?u-=n:0>u&&(u+=n);break;case y:default:c>b?c=b:0>c&&(c=0),u>A?u=A:0>u&&(u=0)}o=u+c*n<<2,t[s]=d[o],t[s+1]=d[o+1],t[s+2]=d[o+2],t[s+3]=d[o+3]}return t},sphere:function(e,t,n,r){if(0>=e.radius)return t;var a,i,s,o,l,u,c,h,f,d,p,m,_,g=t.length,v=new IMGcopy(t),y=e.centerX,w=e.centerY,C=e.radius,A=e.mode,b=FILTER.MODE.CLAMP,E=FILTER.MODE.WRAP,R=C*C,I=.555556,M=1-I,L=n-1,x=r-1;for(y=Floor(y*(n-1)),w=Floor(w*(r-1)),a=0,i=0,s=0;g>s;s+=4,a++)if(a>=n&&(a=0,i++),l=a-y,u=i-w,m=l*l,_=u*u,c=m+_,R>c){if(d=R-c,p=Sqrt(d),h=Asin(l/Sqrt(m+d))*M,f=Asin(u/Sqrt(_+d))*M,l=~~(a-p*Tan(h)),u=~~(i-p*Tan(f)),0>l||l>L||0>u||u>x)switch(A){case E:u>x?u-=r:0>u&&(u+=r),l>L?l-=n:0>l&&(l+=n);break;case b:default:u>x?u=x:0>u&&(u=0),l>L?l=L:0>l&&(l=0)}o=l+u*n<<2,t[s]=v[o],t[s+1]=v[o+1],t[s+2]=v[o+2],t[s+3]=v[o+3]}return t},ripple:function(e,t,n,r){if(0>=e.radius)return t;var a,i,s,o,l,u,c,h,f,d,p,m=t.length,_=new IMGcopy(t),g=FILTER.MODE.CLAMP,v=FILTER.MODE.WRAP,y=n-1,w=r-1,C=e.centerX,A=e.centerY,b=e.radius,E=e.mode,R=b*b,I=e.wavelength,M=e.amplitude,L=e.phase;for(C=Floor(C*(n-1)),A=Floor(A*(r-1)),a=0,i=0,s=0;m>s;s+=4,a++)if(a>=n&&(a=0,i++),u=a-C,c=i-A,d=u*u,p=c*c,f=d+p,R>f){if(l=Sqrt(f),h=M*Sin(l/I*Math.PI*2-L),h*=(b-l)/b,l&&(h*=I/l),u=~~(a+u*h),c=~~(i+c*h),0>u||u>y||0>c||c>w)switch(E){case v:c>w?c-=r:0>c&&(c+=r),u>y?u-=n:0>u&&(u+=n);break;case g:default:c>w?c=w:0>c&&(c=0),u>y?u=y:0>u&&(u=0)}o=u+c*n<<2,t[s]=_[o],t[s+1]=_[o+1],t[s+2]=_[o+2],t[s+3]=_[o+3]}return t},polar:function(e,t,n,r){var a,i,s,o,l,u,c,h,f,d,p,m,_=t.length,g=new IMGcopy(t),v=FILTER.MODE.CLAMP,y=FILTER.MODE.WRAP,w=n-1,C=r-1,A=0,b=e.mode;for(p=~~(.5*n+.5),m=~~(.5*r+.5),d=Max(m,p),a=0,i=0,s=0;_>s;s+=4,a++){if(a>=n&&(a=0,i++),o=a-p,l=i-m,f=0,o>=0?l>0?(f=PI-Atan(o/l),A=Sqrt(o*o+l*l)):0>l?(f=Atan(o/l),A=Sqrt(o*o+l*l)):(f=HalfPI,A=o):0>o&&(0>l?(f=DoublePI-Atan(o/l),A=Sqrt(o*o+l*l)):l>0?(f=PI+Atan(o/l),A=Sqrt(o*o+l*l)):(f=ThreePI2,A=-o)),u=n-1-(n-1)/DoublePI*f,c=r*A/d,u=Round(u),c=Round(c),0>u||u>w||0>c||c>C)switch(b){case y:c>C?c-=r:0>c&&(c+=r),u>w?u-=n:0>u&&(u+=n);break;case v:default:c>C?c=C:0>c&&(c=0),u>w?u=w:0>u&&(u=0)}h=u+c*n<<2,t[s]=g[h],t[s+1]=g[h+1],t[s+2]=g[h+2],t[s+3]=g[h+3]}return t},cartesian:function(e,t,n,r){var a,i,s,o,l,u,c,h,f,d,p,m,_,g=t.length,v=new IMGcopy(t),y=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,C=n-1,A=r-1,b=0,E=e.mode;for(m=~~(.5*n+.5),_=~~(.5*r+.5),p=Max(_,m),a=0,i=0,s=0;g>s;s+=4,a++){if(a>=n&&(a=0,i++),f=a/n*DoublePI,d=f>=ThreePI2?DoublePI-f:f>=PI?f-PI:f>=HalfPI?PI-f:f,b=p*(i/r),c=-b*Sin(d),h=b*Cos(d),f>=ThreePI2?(o=m-c,l=_-h):f>=PI?(o=m-c,l=_+h):f>=HalfPI?(o=m+c,l=_+h):(o=m+c,l=_-h),o=Round(o),l=Round(l),0>o||o>C||0>l||l>A)switch(E){case w:l>A?l-=r:0>l&&(l+=r),o>C?o-=n:0>o&&(o+=n);break;case y:default:l>A?l=A:0>l&&(l=0),o>C?o=C:0>o&&(o=0)}u=o+l*n<<2,t[s]=v[u],t[s+1]=v[u+1],t[s+2]=v[u+2],t[s+3]=v[u+3]}return t}}}(FILTER),!function(e,t){function n(e,t,n,r){var a,i=e.length,s=new w(e.length);for(n=n||1,r=r||1,a=0;i>a;)s[a]=n*e[a]+r*t[a],a++;return s}function r(e,t){var n,r,a,i=e.length,s=[],o=0;for(n=0;i>n;n++)for(r=0;i>r;r++)a=e[n]*t[r],o+=a,s.push(a);return{kernel:s,sum:o}}function a(e){var t,n=new Array(e);for(t=0;e>t;)n[t]=1,t++;return n}function i(e){var t,n,r,a,i=R.length;if(e--,i>e)t=new w(R[e]);else for(t=new w(R[i-1]);e>=i;){for(n=t,t=new w(n.length+1),t[0]=1,r=0,a=n.length-1;a>r;r++)t[r+1]=n[r]+n[r+1];t[n.length]=1,40>i&&R.push(new Array(t)),i++}return t}function s(e){var t,n=e>>1,r=-n,a=new Array(e);for(t=0;e>t;)a[t]=r,r++,t++;return a}function o(e){var t=i(e);return r(t,t)}function l(e,t){var n=i(e),a=s(e);return 1==t?r(a.reverse(),n):r(n,a)}function u(e,t){var n=a(e),i=s(e);return 1==t?r(i.reverse(),n):r(n,i)}function c(e,t,n){t=t||1,n=n||t;var r,a=e*e,i=a>>1,s=new w(a);for(r=0;a>r;)s[r]=t,r++;return s[i]=n,s}function h(e,t,n,r){var a,i,s,o,l,u=e*e,c=e>>1,h=u>>1,f=new w(u);for(o=0,a=0;c>=a;a++){for(i=0,l=0,s=0;c>=s;s++)f[h+a+i]=o+l,f[h-a-i]=-o-l,f[h-a+i]=-o+l,f[h+a-i]=o-l,i+=e,l+=n;o+=t}return f[h]=r||1,f}function f(e,t,n,r){var a,i,s,o,l,u,c=e*e,h=e>>1,f=c>>1,d=new w(c),p=new w(c),m=1/e,g=1e-8;for(_(t)>g?(l=1,u=n/t):(l=t/n,u=1),a=0,s=0,o=0,i=u*e;h>=a;)p[f+a]=~~(f+s+o+.5),p[f-a]=~~(f-s-o+.5),a++,s+=l,o+=i;for(a=0;h>=a;)d[p[f+a]]=d[p[f-a]]=m,a++;return d[f]=r||1,d}function d(e,t,n,r,a,i,s,o,l,u){var c,h,f,d,p,m,_,g,v,y,w,b,R,I,M,L,x,N,S,T,O,F,D,P,k,G,H,U,X,B,Y,W,q,z,$,j,K,J,V,Q,Z,ee,te,ne,re,ae,ie,se=e.length,oe=se>>2,le=i,ue=s;if(g=le*ue,m=le>>1,_=t*(ue>>1),w=-m-1,R=-_-t,b=m,I=_,B=0,W=t-1,Y=0,q=oe-t,h=(oe<<1)+oe,y=(t<<1)+t,u=u||1,ie=0,a)for(T=r[0],O=r[g>>1],F=O-T,D=a[0],P=a[g>>1],k=P-D;u>ie;){for(v=new C(se),c=new A(h),M=0,L=0,f=d=p=0,x=0;t>x;x++,M+=4,L+=3)f+=e[M],d+=e[M+1],p+=e[M+2],c[L]=f,c[L+1]=d,c[L+2]=p;for(L=0,x=0,f=d=p=0,M=y+t;se>M;M+=4,L+=3,x++)x>=t&&(x=0,f=d=p=0),f+=e[M],d+=e[M+1],p+=e[M+2],c[L+y]=c[L]+f,c[L+y+1]=c[L+1]+d,c[L+y+2]=c[L+2]+p;for(x=0,N=0,S=0,M=0;se>M;M+=4,x++)x>=t&&(x=0,N++,S+=t),G=x+w,H=S+R,U=x+b,X=S+I,G=B>G?B:G,U=U>W?W:U,H=Y>H?Y:H,X=X>q?q:X,z=G+H,K=U+X,$=U+H,j=G+X,z=(z<<1)+z,$=($<<1)+$,j=(j<<1)+j,K=(K<<1)+K,Z=T*(c[K]-c[$]-c[j]+c[z])+F*e[M],ee=T*(c[K+1]-c[$+1]-c[j+1]+c[z+1])+F*e[M+1],te=T*(c[K+2]-c[$+2]-c[j+2]+c[z+2])+F*e[M+2],ne=D*(c[K]-c[$]-c[j]+c[z])+k*e[M],re=D*(c[K+1]-c[$+1]-c[j+1]+c[z+1])+k*e[M+1],ae=D*(c[K+2]-c[$+2]-c[j+2]+c[z+2])+k*e[M+2],J=o*Z+l*ne,V=o*ee+l*re,Q=o*te+l*ae,E&&(J=0>J?0:J>255?255:J,V=0>V?0:V>255?255:V,Q=0>Q?0:Q>255?255:Q),v[M]=~~J,v[M+1]=~~V,v[M+2]=~~Q,v[M+3]=e[M+3];e=v,ie++}else for(T=r[0],O=r[g>>1],F=O-T;u>ie;){for(v=new C(se),c=new A(h),M=0,L=0,f=d=p=0,x=0;t>x;x++,M+=4,L+=3)f+=e[M],d+=e[M+1],p+=e[M+2],c[L]=f,c[L+1]=d,c[L+2]=p;for(L=0,x=0,f=d=p=0,M=y+t;se>M;M+=4,L+=3,x++)x>=t&&(x=0,f=d=p=0),f+=e[M],d+=e[M+1],p+=e[M+2],c[L+y]=c[L]+f,c[L+y+1]=c[L+1]+d,c[L+y+2]=c[L+2]+p;for(x=0,N=0,S=0,M=0;se>M;M+=4,x++)x>=t&&(x=0,N++,S+=t),G=x+w,H=S+R,U=x+b,X=S+I,G=B>G?B:G,U=U>W?W:U,H=Y>H?Y:H,X=X>q?q:X,z=G+H,K=U+X,$=U+H,j=G+X,z=(z<<1)+z,$=($<<1)+$,j=(j<<1)+j,K=(K<<1)+K,Z=T*(c[K]-c[$]-c[j]+c[z])+F*e[M],ee=T*(c[K+1]-c[$+1]-c[j+1]+c[z+1])+F*e[M+1],te=T*(c[K+2]-c[$+2]-c[j+2]+c[z+2])+F*e[M+2],J=o*Z+l,V=o*ee+l,Q=o*te+l,E&&(J=0>J?0:J>255?255:J,V=0>V?0:V>255?255:V,Q=0>Q?0:Q>255?255:Q),v[M]=~~J,v[M+1]=~~V,v[M+2]=~~Q,v[M+3]=e[M+3];e=v,ie++}return v}function p(e,t,n,r,a,i,s,o,l){var u,c,h,f,d,p,m,_,g,v,y,w,A,R,I,M,L,x,N,S,T,O,F,D,P,k,G,H=e.length,U=H>>2;for(u=[a,r],c=[s,i],P=[l,o],M=t-1,L=U-t,G=2;G--;){for(m=new C(H),f=u[G],d=c[G],h=f.length,p=d.length,k=P[G],_=new b(d),y=0;p>y;y+=2)_[y+1]*=t;if(E)for(w=0,A=0,g=0;H>g;g+=4,w++){for(w>=t&&(w=0,A+=t),O=0,F=0,D=0,y=0,v=0;h>y;y++,v+=2)R=w+_[v],I=A+_[v+1],R>=0&&M>=R&&I>=0&&L>=I&&(srcOff=R+I<<2,T=f[y],O+=e[srcOff]*T,F+=e[srcOff+1]*T,D+=e[srcOff+2]*T);x=k*O,N=k*F,S=k*D,x=0>x?0:x>255?255:x,N=0>N?0:N>255?255:N,S=0>S?0:S>255?255:S,m[g]=~~x,m[g+1]=~~N,m[g+2]=~~S,m[g+3]=e[g+3]}else for(w=0,A=0,g=0;H>g;g+=4,w++){for(w>=t&&(w=0,A+=t),O=0,F=0,D=0,y=0,v=0;h>y;y++,v+=2)R=w+_[v],I=A+_[v+1],R>=0&&M>=R&&I>=0&&L>=I&&(srcOff=R+I<<2,T=f[y],O+=e[srcOff]*T,F+=e[srcOff+1]*T,D+=e[srcOff+2]*T);x=k*O,N=k*F,S=k*D,m[g]=~~x,m[g+1]=~~N,m[g+2]=~~S,m[g+3]=e[g+3]}e=m}return m}var m=(e.CONST.SQRT2,e.CONST.toRad),_=(e.CONST.toDeg,Math.abs),g=Math.sqrt,v=Math.sin,y=Math.cos,w=e.Array32F,C=e.ImArray,A=e.Array32F,b=e.Array16I,E=(e.Array8U,e._notSupportClamp),R=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],I=e.ConvolutionMatrixFilter=e.Class(e.Filter,{name:"ConvolutionMatrixFilter",constructor:function(t,n,r){var a=this;a.$super("constructor"),a._coeff=new w([1,0]),t&&t.length?a.set(t,~~(g(t.length)+.5),n||1,r||0):(a._matrix=null,a._dim=0),a._matrix2=null,a._dim2=0,a._isGrad=!1,a._doIntegral=0,a._doSeparable=!1,e.useWebGL&&(a._webglInstance=e.WebGLConvolutionMatrixFilterInstance||null)},_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_webglInstance:null,dispose:function(){var e=this;return e.$super("dispose"),e._webglInstance=null,e._dim=null,e._dim2=null,e._matrix=null,e._matrix2=null,e._mat=null,e._mat2=null,e._coeff=null,e._isGrad=null,e._doIntegral=null,e._doSeparable=null,e._indices=null,e._indices2=null,e._indicesf=null,e._indicesf2=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_dim:e._dim,_dim2:e._dim2,_matrix:e._matrix,_matrix2:e._matrix2,_mat:e._mat,_mat2:e._mat2,_coeff:e._coeff,_isGrad:e._isGrad,_doIntegral:e._doIntegral,_doSeparable:e._doSeparable,_indices:e._indices,_indices2:e._indices2,_indicesf:e._indicesf,_indicesf2:e._indicesf2}}},unserialize:function(e){var t,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,t=e.params,n._dim=t._dim,n._dim2=t._dim2,n._matrix=t._matrix,n._matrix2=t._matrix2,n._mat=t._mat,n._mat2=t._mat2,n._coeff=t._coeff,n._isGrad=t._isGrad,n._doIntegral=t._doIntegral,n._doSeparable=t._doSeparable,n._indices=t._indices,n._indices2=t._indices2,n._indicesf=t._indicesf,n._indicesf2=t._indicesf2),n},lowPass:function(e){return e=e===t?3:e%2?e:e+1,this.set(c(e),e,1/(e*e),0),this._doIntegral=1,this},highPass:function(e,n){e=e===t?3:e%2?e:e+1,n=n===t?1:n;var r=e*e,a=-n/r,i=c(e,a,1+a);return this.set(i,e,1,0),this._doIntegral=1,this},glow:function(e,n){return e=e===t?.5:e,this.highPass(n,-e)},sharpen:function(e,n){return e=e===t?.5:e,this.highPass(n,e)},verticalBlur:function(e){return e=e===t?3:e%2?e:e+1,this.set(a(e),1,1/e,0),this._dim2=e,this._doIntegral=1,this},horizontalBlur:function(e){return e=e===t?3:e%2?e:e+1,this.set(a(e),e,1/e,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(e,n){n=n===t?3:n%2?n:n+1,e*=m;var r=y(e),a=-v(e),i=f(n,r,a,1/n);return this.set(i,n,1,0)},fastGauss:function(e,n){return n=n===t?3:n%2?n:n+1,e=~~(e||1),1>e?e=1:e>3&&(e=3),this.set(c(n),n,1/(n*n),0),this._doIntegral=e,this},binomialLowPass:function(e){e=e===t?3:e%2?e:e+1;var n=i(e),r=1<<e-1,a=1/r;this.set(n,e,a,a),this._matrix2=new w(n);var s=this._computeIndices(this._matrix2,this._dim2);return this._indices2=s[0],this._indicesf2=s[1],this._mat2=s[2],this._doSeparable=!0,this},binomialHighPass:function(e){e=e===t?3:e%2?e:e+1;var r=o(e);return this.set(n(c(e),new w(r.kernel),1,-1/r.sum),e,1,0)},prewittX:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,0);return this.set(n.kernel,e,1,0)},prewittY:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,1);return this.set(n.kernel,e,1,0)},prewittDirectional:function(e,r){r=r===t?3:r%2?r:r+1,e*=m;var a=y(e),i=v(e),s=u(r,0),o=u(r,1);return this.set(n(new w(s.kernel),new w(o.kernel),a,i),r,1,0)},prewitt:function(e){e=e===t?3:e%2?e:e+1;var n=u(e,0),r=u(e,1);this.set(n.kernel,e,1,0),this._isGrad=!0,this._matrix2=new w(r.kernel);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this},sobelX:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,0);return this.set(n.kernel,e,1,0)},sobelY:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,1);return this.set(n.kernel,e,1,0)},sobelDirectional:function(e,r){r=r===t?3:r%2?r:r+1,e*=m;var a=y(e),i=v(e),s=l(r,0),o=l(r,1);return this.set(n(new w(s.kernel),new w(o.kernel),a,i),r,1,0)},sobel:function(e){e=e===t?3:e%2?e:e+1;var n=l(e,0),r=l(e,1);this.set(n.kernel,e,1,0),this._matrix2=new w(r.kernel);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this._isGrad=!0,this},laplace:function(e){e=e===t?3:e%2?e:e+1;var n=e*e,r=c(e,-1,n-1);return this.set(r,e,1,0),this._doIntegral=1,this},emboss:function(e,n,r){r=r===t?3:r%2?r:r+1,e=e===t?-.25*Math.PI:e*m,n=n||1;var a=n*y(e),i=-n*v(e),s=h(r,a,i,1);return this.set(s,r,1,0)},edges:function(e){return e=e||1,this.set([0,e,0,e,-4*e,e,0,e,0],3,1,0)},set:function(e,t,n,r){var a=this;a._matrix2=null,a._dim2=0,a._indices2=a._indicesf2=null,a._mat2=null,a._isGrad=!1,a._doIntegral=0,a._doSeparable=!1,a._matrix=new w(e),a._dim=t,a._coeff[0]=n||1,a._coeff[1]=r||0;var i=a._computeIndices(a._matrix,a._dim);return a._indices=i[0],a._indicesf=i[1],a._mat=i[2],a},_computeIndices:function(e,t){var n,r,a,i=[],s=[],o=[],l=e.length,u=t,c=u>>1;for(r=0,a=0,n=0;l>n;)s.push(r-c),s.push(a-c),e[n]&&(i.push(r-c),i.push(a-c),o.push(e[n])),n++,r++,r>=u&&(r=0,a++);return[new b(i),new b(s),new w(o)]},reset:function(){var e=this;return e._matrix=e._matrix2=null,e._mat=e._mat2=null,e._dim=e._dim2=0,e._indices=e._indices2=e._indicesf=e._indicesf2=null,e._isGrad=!1,e._doIntegral=0,e._doSeparable=!1,e},combineWith:function(e){return this},getMatrix:function(){return this._matrix},setMatrix:function(e,t){return this.set(e,t)},_apply:function(e,t,n){var r=this;if(!r._isOn||!r._matrix)return e;if(r._doIntegral)return r._matrix2?d(e,t,n,r._matrix,r._matrix2,r._dim,r._dim2,r._coeff[0],r._coeff[1],r._doIntegral):d(e,t,n,r._matrix,null,r._dim,r._dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return p(e,t,n,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,i,s,o,l,u,c,h,f,m,g,v,y,w,A,R,I,M,L,x,N,S,T=e.length,O=T>>2,F=new C(T),D=t-1,P=O-t,k=r._coeff[0],G=r._coeff[1],H=r._matrix,U=r._matrix2,X=r._isGrad;if(U){for(x=r._indicesf.length,S=new b(r._indicesf),u=0;x>u;u+=2)S[u+1]*=t;for(N=H.length,c=0,h=0,o=0;T>o;o+=4,c++){for(c>=t&&(c=0,h+=t),v=0,y=0,w=0,A=0,R=0,I=0,u=0,l=0;N>u;u++,l+=2)f=c+S[l],m=h+S[l+1],f>=0&&D>=f&&m>=0&&P>=m&&(g=f+m<<2,M=H[u],v+=e[g]*M,y+=e[g+1]*M,w+=e[g+2]*M,L=U[u],A+=e[g]*L,R+=e[g+1]*L,I+=e[g+2]*L);X?(a=_(v)+_(A),i=_(y)+_(R),s=_(w)+_(I)):(a=k*v+G*A,i=k*y+G*R,s=k*w+G*I),E&&(a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s),F[o]=~~a,F[o+1]=~~i,F[o+2]=~~s,F[o+3]=e[o+3]}}else{for(x=r._indices.length,S=new b(r._indices),u=0;x>u;u+=2)S[u+1]*=t;for(H=r._mat,N=H.length,c=0,h=0,o=0;T>o;o+=4,c++){for(c>=t&&(c=0,h+=t),v=0,y=0,w=0,u=0,l=0;N>u;u++,l+=2)f=c+S[l],m=h+S[l+1],f>=0&&D>=f&&m>=0&&P>=m&&(g=f+m<<2,M=H[u],v+=e[g]*M,y+=e[g+1]*M,w+=e[g+2]*M);a=k*v+G,i=k*y+G,s=k*w+G,E&&(a=0>a?0:a>255?255:a,i=0>i?0:i>255?255:i,s=0>s?0:s>255?255:s),F[o]=~~a,F[o+1]=~~i,F[o+2]=~~s,F[o+3]=e[o+3]}}return F},canRun:function(){return this._isOn&&this._matrix}});I.prototype.bump=I.prototype.emboss,I.prototype.boxBlur=I.prototype.lowPass,I.prototype.gaussBlur=I.prototype.binomialLowPass,I.prototype.gradX=I.prototype.prewittX,I.prototype.gradY=I.prototype.prewittY,I.prototype.gradDirectional=I.prototype.prewittDirectional,I.prototype.grad=I.prototype.prewitt}(FILTER),!function(e,t){var n,r=e.ImArray,a=e.Array8U,i=e.Array32I,s=Math.sqrt,o=function(e){var t,n=e*e,r=new a(n);for(t=0;n>t;t++)r[t]=1;return r},l=o(3);e.MorphologicalFilter=e.Class(e.Filter,{name:"MorphologicalFilter",constructor:function(){var e=this;e.$super("constructor"),e._filterName=null,e._filter=null,e._dim=0,e._structureElement=null,e._indices=null},_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var e=this;return e.$super("dispose"),e._filterName=null,e._filter=null,e._dim=null,e._structureElement=null,e._indices=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_filterName:e._filterName,_dim:e._dim,_structureElement:e._structureElement,_indices:e._indices}}},unserialize:function(e){var t,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,t=e.params,r._dim=t._dim,r._structureElement=t._structureElement,r._indices=t._indices,r._filterName=t._filterName,r._filterName&&n[r._filterName]&&(r._filter=n[r._filterName])),r},erode:function(e){return this.set(e,"erode")},dilate:function(e){return this.set(e,"dilate")},opening:function(e){return this.set(e,"open")},closing:function(e){return this.set(e,"close")},set:function(e,t){var r=this;r._filterName=t,r._filter=n[t],e&&e.length?(r._structureElement=new a(e),r._dim=~~(s(r._structureElement.length)+.5)):e&&e===e-0?(r._structureElement=o(e),r._dim=e):(r._structureElement=l,r._dim=3);var u,c,h,f=[],e=r._structureElement,d=e.length,p=r._dim,m=p>>1;for(c=0,h=0,u=0;d>u;)e[u]&&(f.push(c-m),f.push(h-m)),u++,c++,c>=p&&(c=0,h++);return r._indices=new i(f),r},reset:function(){var e=this;return e._filterName=null,e._filter=null,e._dim=0,e._structureElement=null,e._indices=null,e},_apply:function(e,t,n){var r=this;return r._isOn&&r._dim&&r._filter?r._filter(r,e,t,n):e},canRun:function(){return this._isOn&&this._dim&&this._filter}});n={dilate:function(e,t,n,a){var s,o,l,u,c,h,f,d,p,m,_,g,v,y,w=e._structureElement,C=(w.length,e._dim,new i(e._indices)),A=t.length,b=A>>2,E=new r(A),R=C.length,I=R>>1,M=n-1,L=b-n;for(l=0;R>l;l+=2)C[l+1]*=n;for(u=0,c=0,s=0;A>s;s+=4,u++){for(u>=n&&(u=0,c+=n),g=0,v=0,y=0,o=0;I>o;o+=2)h=u+C[o],f=c+C[o+1],h>=0&&M>=h&&f>=0&&L>=f&&(d=h+f<<2,p=t[d],m=t[d+1],_=t[d+2],p>g&&(g=p),m>v&&(v=m),_>y&&(y=_));E[s]=g,E[s+1]=v,E[s+2]=y,E[s+3]=t[s+3]}return E},erode:function(e,t,n,a){var s,o,l,u,c,h,f,d,p,m,_,g,v,y,w=e._structureElement,C=(w.length,e._dim,new i(e._indices)),A=t.length,b=A>>2,E=new r(A),R=C.length,I=R>>1,M=n-1,L=b-n;for(l=0;R>l;l+=2)C[l+1]*=n;for(u=0,c=0,s=0;A>s;s+=4,u++){for(u>=n&&(u=0,c+=n),g=255,v=255,y=255,o=0;I>o;o+=2)h=u+C[o],f=c+C[o+1],h>=0&&M>=h&&f>=0&&L>=f&&(d=h+f<<2,p=t[d],m=t[d+1],_=t[d+2],g>p&&(g=p),v>m&&(v=m),y>_&&(y=_));E[s]=g,E[s+1]=v,E[s+2]=y,E[s+3]=t[s+3]}return E},open:function(e,t,n,a){var s,o,l,u,c,h,f,d,p,m,_,g,v,y,w=e._structureElement,C=(w.length,e._dim,new i(e._indices)),A=t.length,b=A>>2,E=new r(A),R=C.length,I=R>>1,M=n-1,L=b-n;for(l=0;R>l;l+=2)C[l+1]*=n;for(u=0,c=0,s=0;A>s;s+=4,u++){for(u>=n&&(u=0,c+=n),g=255,v=255,y=255,o=0;I>o;o+=2)h=u+C[o],f=c+C[o+1],h>=0&&M>=h&&f>=0&&L>=f&&(d=h+f<<2,p=t[d],m=t[d+1],_=t[d+2],g>p&&(g=p),v>m&&(v=m),y>_&&(y=_));E[s]=g,E[s+1]=v,E[s+2]=y,E[s+3]=t[s+3]}for(t=E,E=new r(A),u=0,c=0,s=0;A>s;s+=4,u++){for(u>=n&&(u=0,c+=n),g=255,v=255,y=255,o=0;I>o;o+=2)h=u+C[o],f=c+C[o+1],h>=0&&M>=h&&f>=0&&L>=f&&(d=h+f<<2,p=t[d],m=t[d+1],_=t[d+2],g>p&&(g=p),v>m&&(v=m),y>_&&(y=_));E[s]=g,E[s+1]=v,E[s+2]=y,E[s+3]=t[s+3]}return E},close:function(e,t,n,a){var s,o,l,u,c,h,f,d,p,m,_,g,v,y,w=e._structureElement,C=(w.length,e._dim,new i(e._indices)),A=t.length,b=A>>2,E=new r(A),R=C.length,I=R>>1,M=n-1,L=b-n;for(l=0;R>l;l+=2)C[l+1]*=n;for(u=0,c=0,s=0;A>s;s+=4,u++){for(u>=n&&(u=0,c+=n),g=255,v=255,y=255,o=0;I>o;o+=2)h=u+C[o],f=c+C[o+1],h>=0&&M>=h&&f>=0&&L>=f&&(d=h+f<<2,p=t[d],m=t[d+1],_=t[d+2],g>p&&(g=p),v>m&&(v=m),y>_&&(y=_));E[s]=g,E[s+1]=v,E[s+2]=y,E[s+3]=t[s+3]}for(t=E,E=new r(A),u=0,c=0,s=0;A>s;s+=4,u++){for(u>=n&&(u=0,c+=n),g=255,v=255,y=255,o=0;I>o;o+=2)h=u+C[o],f=c+C[o+1],h>=0&&M>=h&&f>=0&&L>=f&&(d=h+f<<2,p=t[d],m=t[d+1],_=t[d+2],g>p&&(g=p),v>m&&(v=m),y>_&&(y=_));E[s]=g,E[s+1]=v,E[s+2]=y,E[s+3]=t[s+3]}return E}}}(FILTER),!function(e,t){var n,r=e.ImArray,a=e.Array32I,i=(Math.min,Math.max,e.StatisticalFilter=e.Class(e.Filter,{name:"StatisticalFilter",constructor:function(){var e=this;e.$super("constructor"),e._dim=0,e._indices=null,e._filterName=null,e._filter=null},_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var e=this;return e.$super("dispose"),e._dim=null,e._indices=null,e._filter=null,e._filterName=null,e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_filterName:e._filterName,_dim:e._dim,_indices:e._indices}}},unserialize:function(e){var t,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,t=e.params,r._dim=t._dim,r._indices=t._indices,r._filterName=t._filterName,r._filterName&&n[r._filterName]&&(r._filter=n[r._filterName])),r},median:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"median")},minimum:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"minimum")},maximum:function(e){return e=e===t?3:e%2?e:e+1,this.set(e,"maximum")},set:function(e,t){var r=this;r._filterName=t,r._filter=n[t],r._dim=e;var i,s,o,l=[],u=e*e,c=e,h=c>>1;for(s=0,o=0,i=0;u>i;)l.push(s-h),l.push(o-h),i++,s++,s>=c&&(s=0,o++);return r._indices=new a(l),r},reset:function(){var e=this;return e._filterName=null,e._filter=null,e._dim=0,e._indices=null,e},_apply:function(e,t,n){var r=this;return r._isOn&&r._dim?r._filter(r,e,t,n):e},canRun:function(){return this._isOn&&this._dim}}));i.prototype.erode=i.prototype.minimum,i.prototype.dilate=i.prototype.maximum,n={median:function(e,t,n,i){var s,o,l,u,c,h,f,d,p,m,_,g,v,y,w,C,A,b,E=e._dim,R=E*E,I=new a(e._indices),M=t.length,L=M>>2,x=new r(M),N=R<<1,S=n-1,T=L-n;for(d=[],p=[],m=[],o=0;N>o;o+=2)I[o+1]*=n;for(s=0,l=0,u=0;M>s;){for(d.length=0,p.length=0,m.length=0,o=0;N>o;)c=l+I[o],h=u+I[o+1],c>=0&&S>=c&&h>=0&&T>=h&&(f=c+h<<2,_=t[f],g=t[f+1],v=t[f+2],d.push(_),p.push(g),m.push(v)),o+=2;d.sort(),p.sort(),m.sort(),A=d.length,b=A>>1,y=A%2?d[b+1]:~~(.5*(d[b]+d[b+1])),A=p.length,b=A>>1,w=A%2?p[b+1]:~~(.5*(p[b]+p[b+1])),A=m.length,b=A>>1,C=A%2?m[b+1]:~~(.5*(m[b]+m[b+1])),x[s]=y,x[s+1]=w,x[s+2]=C,x[s+3]=t[s+3],s+=4,l++,l>=n&&(l=0,u+=n)}return x},maximum:function(e,t,n,i){var s,o,l,u,c,h,f,d,p,m,_,g,v,y=e._dim,w=y*y,C=new a(e._indices),A=t.length,b=A>>2,E=new r(A),R=w<<1,I=n-1,M=b-n;for(o=0;R>o;o+=2)C[o+1]*=n;for(s=0,l=0,u=0;A>s;){for(_=0,g=0,v=0,o=0;R>o;)c=l+C[o],h=u+C[o+1],c>=0&&I>=c&&h>=0&&M>=h&&(f=c+h<<2,d=t[f],p=t[f+1],m=t[f+2],d>_&&(_=d),p>g&&(g=p),m>v&&(v=m)),o+=2;E[s]=_,E[s+1]=g,E[s+2]=v,E[s+3]=t[s+3],s+=4,l++,l>=n&&(l=0,u+=n)}return E},minimum:function(e,t,n,i){var s,o,l,u,c,h,f,d,p,m,_,g,v,y=e._dim,w=y*y,C=new a(e._indices),A=t.length,b=A>>2,E=new r(A),R=w<<1,I=n-1,M=b-n;for(o=0;R>o;o+=2)C[o+1]*=n;for(s=0,l=0,u=0;A>s;){for(_=255,g=255,v=255,o=0;R>o;)c=l+C[o],h=u+C[o+1],c>=0&&I>=c&&h>=0&&M>=h&&(f=c+h<<2,d=t[f],p=t[f+1],m=t[f+2],_>d&&(_=d),g>p&&(g=p),v>m&&(v=m)),o+=2;E[s]=_,E[s+1]=g,E[s+2]=v,E[s+3]=t[s+3],s+=4,l++,l>=n&&(l=0,u+=n)}return E}}}(FILTER),!function(e,t){function n(e){var t,n;for(e>0&&1>e&&(e*=65536),e=u(e),256>e&&(e|=e<<8),n=0;256>n;n++)t=1&n?h[n]^255&e:h[n]^e>>8&255,f[n]=f[n+256]=t}function r(e,t,n){var r=7&e,a=4>r?t:n,i=4>r?n:t;return(1&r?-a:a)+(2&r?-2*i:2*i)}function a(e,t){var n,a,i,s,o,l=.366025403,c=.211324865,h=(e+t)*l,d=e+h,p=t+h,m=u(d),_=u(p),g=(m+_)*c,v=m-g,y=_-g,w=e-v,C=t-y;
w>C?(s=1,o=0):(s=0,o=1);var A=w-s+c,b=C-o+c,E=w-1+2*c,R=C-1+2*c,I=255&m,M=255&_,L=.5-w*w-C*C;0>L?n=0:(L*=L,n=L*L*r(f[I+f[M]],w,C));var x=.5-A*A-b*b;0>x?a=0:(x*=x,a=x*x*r(f[I+s+f[M+o]],A,b));var N=.5-E*E-R*R;return 0>N?i=0:(N*=N,i=N*N*r(f[I+1+f[M+1]],E,R)),40*(n+a+i)}function i(e){return e*e*e*(e*(6*e-15)+10)}function s(e,t,n){return t+e*(n-t)}function o(e,t){var n,a,o,l,c,h,d,p,m,_,g,v,y,w;return n=u(e),a=u(t),c=e-n,h=t-a,d=c-1,p=h-1,o=n+1&255,l=a+1&255,n=255&n,a=255&a,_=i(h),m=i(c),g=r(f[n+f[a]],c,h),v=r(f[n+f[l]],c,p),y=s(_,g,v),g=r(f[o+f[a]],d,h),v=r(f[o+f[l]],d,p),w=s(_,g,v),.507*s(m,y,w)}function l(e,t,n,r,a,i,s,o,l,u,c){var h,f,d,p=0,m=u,_=1,g=0;for(h=0;o>h;h++)f=(t+l[h][0])%r,d=(n+l[h][1])%a,p+=e(m*f*i,m*d*s)*_,m*=2,g+=_,_*=c;return p/g}var u=Math.floor,c=(Math.sin,Math.cos,e.CONST.PI2,e.Array8U),h=new c([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),f=new c(h);e.PerlinNoise={seed:n,Image:function(t,n,r,i,s,u,c,h,f,d){var p,m,_,g,v,y,w=(new e.Image).restorable(!1).fill("rgb(0,0,0)",0,0,n,r),C=1/i,A=1/s,b=d?o:a,n=w.width,r=w.height,E=w.getData(),R=E.length,I=n>>>1,M=r>>>1;if(h=h||1,f=f||.5,u=u||1,c=c||[[0,0]],t)for(p=0,m=0,v=0;R>v;v+=4,p++)p>=n&&(p=0,m++),_=p>I?n-1-p:p,g=m>M?r-1-m:m,p>_||m>g?(y=g*n+_<<2,E[v]=E[y],E[v+1]=E[y+1],E[v+2]=E[y+2]):(E[v]=~~(255*(.5*l(b,_,g,n,r,C,A,u,c,h,f)+.5)),E[v+1]=E[v],E[v+2]=E[v]);else for(p=0,m=0,v=0;R>v;v+=4,p++)p>=n&&(p=0,m++),E[v]=~~(255*(.5*l(b,_,g,n,r,C,A,u,c,h,f)+.5)),E[v+1]=E[v],E[v+2]=E[v];return w.setData(E),w}}}(FILTER),FILTER});
/**
*
*   FILTER.js Codecs
*   @version: @@VERSION@@
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (File Codecs)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,r){"use strict";"object"==typeof module&&module.exports?module.exports=r.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_CODECS")?define("FILTER_CODECS",["module","FILTER"],function(t,a){return r.moduleUri=t.uri,r.call(e,a),a}):(r.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function(e){return!function(e,r){"use strict";var t=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(e){var r=this.buffer,t=r?r.byteLength:0;if(t>e)return r;for(var a=512;e>a;)a<<=1;for(var n=new Uint8Array(a),o=0;t>o;++o)n[o]=r[o];return this.buffer=n},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var r=this.pos;if(e){this.ensureBuffer(r+e);for(var t=r+e;!this.eof&&this.bufferLength<t;)this.readBlock();var a=this.bufferLength;t>a&&(t=a)}else{for(;!this.eof;)this.readBlock();var t=this.bufferLength}return this.pos=t,this.buffer.subarray(r,t)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,r,t){for(var a=e+r;this.bufferLength<=a&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,r,t)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},e}(),a=function(){function e(e){throw new Error(e)}function r(r){var a=0,n=r[a++],o=r[a++];-1!=n&&-1!=o||e("Invalid header in flate stream"),8!=(15&n)&&e("Unknown compression method in flate stream"),((n<<8)+o)%31!=0&&e("Bad FCHECK in flate stream"),32&o&&e("FDICT bit set in flate stream"),this.bytes=r,this.bytesPos=a,this.codeSize=0,this.codeBuf=0,t.call(this)}var a=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),o=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),i=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],s=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];return r.prototype=Object.create(t.prototype),r.prototype.getBits=function(r){for(var t,a=this.codeSize,n=this.codeBuf,o=this.bytes,i=this.bytesPos;r>a;)"undefined"==typeof(t=o[i++])&&e("Bad encoding in flate stream"),n|=t<<a,a+=8;return t=n&(1<<r)-1,this.codeBuf=n>>r,this.codeSize=a-=r,this.bytesPos=i,t},r.prototype.getCode=function(r){for(var t=r[0],a=r[1],n=this.codeSize,o=this.codeBuf,i=this.bytes,s=this.bytesPos;a>n;){var f;"undefined"==typeof(f=i[s++])&&e("Bad encoding in flate stream"),o|=f<<n,n+=8}var c=t[o&(1<<a)-1],l=c>>16,d=65535&c;return(0==n||l>n||0==l)&&e("Bad encoding in flate stream"),this.codeBuf=o>>l,this.codeSize=n-l,this.bytesPos=s,d},r.prototype.generateHuffmanTable=function(e){for(var r=e.length,t=0,a=0;r>a;++a)e[a]>t&&(t=e[a]);for(var n=1<<t,o=new Uint32Array(n),i=1,s=0,f=2;t>=i;++i,s<<=1,f<<=1)for(var c=0;r>c;++c)if(e[c]==i){for(var l=0,d=s,a=0;i>a;++a)l=l<<1|1&d,d>>=1;for(var a=l;n>a;a+=f)o[a]=i<<16|c;++s}return[o,t]},r.prototype.readBlock=function(){function r(e,r,t,a,n){for(var o=e.getBits(t)+a;o-- >0;)r[A++]=n}var t=this.getBits(3);if(1&t&&(this.eof=!0),t>>=1,0==t){var f,c=this.bytes,l=this.bytesPos;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream");var d=f;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream"),d|=f<<8,"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream");var h=f;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream"),h|=f<<8,h!=(65535&~d)&&e("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var u=this.bufferLength,p=this.ensureBuffer(u+d),v=u+d;this.bufferLength=v;for(var g=u;v>g;++g){if("undefined"==typeof(f=c[l++])){this.eof=!0;break}p[g]=f}return void(this.bytesPos=l)}var m,y;if(1==t)m=i,y=s;else if(2==t){for(var b=this.getBits(5)+257,w=this.getBits(5)+1,U=this.getBits(4)+4,k=Array(a.length),A=0;U>A;)k[a[A++]]=this.getBits(3);for(var I=this.generateHuffmanTable(k),B=0,A=0,C=b+w,L=new Array(C);C>A;){var x=this.getCode(I);16==x?r(this,L,2,3,B):17==x?r(this,L,3,3,B=0):18==x?r(this,L,7,11,B=0):L[A++]=B=x}m=this.generateHuffmanTable(L.slice(0,b)),y=this.generateHuffmanTable(L.slice(b,C))}else e("Unknown block type in flate stream");for(var p=this.buffer,E=p?p.length:0,S=this.bufferLength;;){var P=this.getCode(m);if(256>P)S+1>=E&&(p=this.ensureBuffer(S+1),E=p.length),p[S++]=P;else{if(256==P)return void(this.bufferLength=S);P-=257,P=n[P];var T=P>>16;T>0&&(T=this.getBits(T));var B=(65535&P)+T;P=this.getCode(y),P=o[P],T=P>>16,T>0&&(T=this.getBits(T));var z=(65535&P)+T;S+B>=E&&(p=this.ensureBuffer(S+B),E=p.length);for(var G=0;B>G;++G,++S)p[S]=p[S-z]}}},r}();e.Utils.DecodeStream=t,e.Utils.FlateStream=a}(e),!function(e,r){"use strict";function t(r){return new e.Utils.FlateStream(r)}function a(){}a.prototype={constructor:a,data:null,pos:null,palette:null,imgData:null,transparency:null,animation:null,text:null,width:0,height:0,bits:null,colorType:null,compressionMethod:null,filterMethod:null,interlaceMethod:null,animation:null,hasAlphaChannel:null,colors:null,colorSpace:null,pixelBitlength:null,readData:function(e){var r,t,a,n,o,i,s,f,c,l,d,h,u,p,v=this;for(v.data=e,v.pos=8,v.palette=[],v.imgData=[],v.transparency={},v.animation=null,v.text={},o=null;;){switch(r=v.readUInt32(),c=function(){var e,r;for(r=[],i=e=0;4>e;i=++e)r.push(String.fromCharCode(this.data[this.pos++]));return r}.call(v).join("")){case"IHDR":v.width=v.readUInt32(),v.height=v.readUInt32(),v.bits=v.data[v.pos++],v.colorType=v.data[v.pos++],v.compressionMethod=v.data[v.pos++],v.filterMethod=v.data[v.pos++],v.interlaceMethod=v.data[v.pos++];break;case"acTL":v.animation={numFrames:v.readUInt32(),numPlays:v.readUInt32()||1/0,frames:[]};break;case"PLTE":v.palette=v.read(r);break;case"fcTL":o&&v.animation.frames.push(o),v.pos+=4,o={width:v.readUInt32(),height:v.readUInt32(),xOffset:v.readUInt32(),yOffset:v.readUInt32()},n=v.readUInt16(),a=v.readUInt16()||100,o.delay=1e3*n/a,o.disposeOp=v.data[v.pos++],o.blendOp=v.data[v.pos++],o.data=[];break;case"IDAT":case"fdAT":for("fdAT"===c&&(v.pos+=4,r-=4),e=(null!=o?o.data:void 0)||v.imgData,i=h=0;r>=0?r>h:h>r;i=r>=0?++h:--h)e.push(v.data[v.pos++]);break;case"tRNS":switch(v.transparency={},v.colorType){case 3:if(v.transparency.indexed=v.read(r),l=255-v.transparency.indexed.length,l>0)for(i=u=0;l>=0?l>u:u>l;i=l>=0?++u:--u)v.transparency.indexed.push(255);break;case 0:v.transparency.grayscale=v.read(r)[0];break;case 2:v.transparency.rgb=v.read(r)}break;case"tEXt":d=v.read(r),s=d.indexOf(0),f=String.fromCharCode.apply(String,d.slice(0,s)),v.text[f]=String.fromCharCode.apply(String,d.slice(s+1));break;case"IEND":return o&&v.animation.frames.push(o),v.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(v),v.hasAlphaChannel=4===(p=v.colorType)||6===p,t=v.colors+(v.hasAlphaChannel?1:0),v.pixelBitlength=v.bits*t,v.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(v),void(v.imgData=new Uint8Array(v.imgData));default:v.pos+=r}if(v.pos+=4,v.pos>v.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(e){var r,t,a,n=this;for(a=[],r=t=0;e>=0?e>t:t>e;r=e>=0?++t:--t)a.push(n.data[n.pos++]);return a},readUInt32:function(){var e,r,t,a,n=this;return e=n.data[n.pos++]<<24,r=n.data[n.pos++]<<16,t=n.data[n.pos++]<<8,a=n.data[n.pos++],e|r|t|a},readUInt16:function(){var e,r,t=this;return e=t.data[t.pos++]<<8,r=t.data[t.pos++],e|r},decodePixels:function(e){var r,a,n,o,i,s,f,c,l,d,h,u,p,v,g,m,y,b,w,U,k,A,I,B=this;if(null==e&&(e=B.imgData),0===e.length)return new Uint8Array(0);for(e=t(e),e=e.getBytes(),u=B.pixelBitlength/8,m=u*B.width,p=new Uint8Array(m*B.height),s=e.length,g=0,v=0,a=0;s>v;){switch(e[v++]){case 0:for(o=w=0;m>w;o=w+=1)p[a++]=e[v++];break;case 1:for(o=U=0;m>U;o=U+=1)r=e[v++],i=u>o?0:p[a-u],p[a++]=(r+i)%256;break;case 2:for(o=k=0;m>k;o=k+=1)r=e[v++],n=(o-o%u)/u,y=g&&p[(g-1)*m+n*u+o%u],p[a++]=(y+r)%256;break;case 3:for(o=A=0;m>A;o=A+=1)r=e[v++],n=(o-o%u)/u,i=u>o?0:p[a-u],y=g&&p[(g-1)*m+n*u+o%u],p[a++]=(r+Math.floor((i+y)/2))%256;break;case 4:for(o=I=0;m>I;o=I+=1)r=e[v++],n=(o-o%u)/u,i=u>o?0:p[a-u],0===g?y=b=0:(y=p[(g-1)*m+n*u+o%u],b=n&&p[(g-1)*m+(n-1)*u+o%u]),f=i+y-b,c=Math.abs(f-i),d=Math.abs(f-y),h=Math.abs(f-b),l=d>=c&&h>=c?i:h>=d?y:b,p[a++]=(r+l)%256;break;default:throw new Error("Invalid filter algorithm: "+e[v-1])}g++}return p},decodePalette:function(){var e,r,t,a,n,o,i,s,f,c,l=this;for(a=l.palette,i=l.transparency.indexed||[],o=new Uint8Array((i.length||0)+a.length),n=0,t=a.length,e=0,r=s=0,f=a.length;f>s;r=s+=3)o[n++]=a[r],o[n++]=a[r+1],o[n++]=a[r+2],o[n++]=null!=(c=i[e++])?c:255;return o},copyToImageData:function(e,r){var t,a,n,o,i,s,f,c,l,d,h,u=this;if(a=u.colors,l=null,t=u.hasAlphaChannel,u.palette.length&&(l=null!=(h=u._decodedPalette)?h:u._decodedPalette=u.decodePalette(),a=4,t=!0),n=e.data||e,c=n.length,i=l||r,o=s=0,1===a)for(;c>o;)f=l?4*r[o/4]:s,d=i[f++],n[o++]=d,n[o++]=d,n[o++]=d,n[o++]=t?i[f++]:255,s=f;else for(;c>o;)f=l?4*r[o/4]:s,n[o++]=i[f++],n[o++]=i[f++],n[o++]=i[f++],n[o++]=t?i[f++]:255,s=f},decode:function(){var e,r=this;return e=new Uint8Array(r.width*r.height*4),r.copyToImageData(e,r.decodePixels()),e}},e.Codec.PNG={encoder:e.NotImplemented("PNG.encoder"),decoder:function(e,r){var t=new a;return t.readData(new Uint8Array(e)),{width:t.width,height:t.height,data:t.decode()}}}}(e),!function(e,r){"use strict";function t(){}function a(e,r){for(var t,a,n=0,o=[],i=16;i>0&&!e[i-1];)i--;o.push({children:[],index:0});var s,f=o[0];for(t=0;i>t;t++){for(a=0;a<e[t];a++){for(f=o.pop(),f.children[f.index]=r[n];f.index>0;)f=o.pop();for(f.index++,o.push(f);o.length<=t;)o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s;n++}i>t+1&&(o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s)}return o[0].children}function n(e,r,t,a,n,o,i,s,c){function l(){if(T>0)return T--,P>>T&1;if(P=e[r++],255==P){var t=e[r++];if(t)throw"unexpected marker: "+(P<<8|t).toString(16)}return T=7,P>>>7}function d(e){for(var r,t=e;null!==(r=l());){if(t=t[r],"number"==typeof t)return t;if("object"!=typeof t)throw"invalid huffman sequence"}return null}function h(e){for(var r=0;e>0;){var t=l();if(null===t)return;r=r<<1|t,e--}return r}function u(e){var r=h(e);return r>=1<<e-1?r:r+(-1<<e)+1}function p(e,r){var t=d(e.huffmanTableDC),a=0===t?0:u(t);r[0]=e.pred+=a;for(var n=1;64>n;){var o=d(e.huffmanTableAC),i=15&o,s=o>>4;if(0!==i){n+=s;var c=f[n];r[c]=u(i),n++}else{if(15>s)break;n+=16}}}function v(e,r){var t=d(e.huffmanTableDC),a=0===t?0:u(t)<<c;r[0]=e.pred+=a}function g(e,r){r[0]|=l()<<c}function m(e,r){if(z>0)return void z--;for(var t=o,a=i;a>=t;){var n=d(e.huffmanTableAC),s=15&n,l=n>>4;if(0!==s){t+=l;var p=f[t];r[p]=u(s)*(1<<c),t++}else{if(15>l){z=h(l)+(1<<l)-1;break}t+=16}}}function y(e,r){for(var t=o,a=i,n=0;a>=t;){var s=f[t];switch(G){case 0:var p=d(e.huffmanTableAC),v=15&p,n=p>>4;if(0===v)15>n?(z=h(n)+(1<<n),G=4):(n=16,G=1);else{if(1!==v)throw"invalid ACn encoding";U=u(v),G=n?2:3}continue;case 1:case 2:r[s]?r[s]+=l()<<c:(n--,0===n&&(G=2==G?3:0));break;case 3:r[s]?r[s]+=l()<<c:(r[s]=U<<c,G=0);break;case 4:r[s]&&(r[s]+=l()<<c)}t++}4===G&&(z--,0===z&&(G=0))}function b(e,r,t,a,n){var o=t/x|0,i=t%x,s=o*e.v+a,f=i*e.h+n;r(e,e.blocks[s][f])}function w(e,r,t){var a=t/e.blocksPerLine|0,n=t%e.blocksPerLine;r(e,e.blocks[a][n])}var U,k,A,I,B,C,L,x=(t.precision,t.samplesPerLine,t.scanLines,t.mcusPerLine),E=t.progressive,S=(t.maxH,t.maxV,r),P=0,T=0,z=0,G=0,_=a.length;L=E?0===o?0===s?v:g:0===s?m:y:p;var M,D,R=0;D=1==_?a[0].blocksPerLine*a[0].blocksPerColumn:x*t.mcusPerColumn,n||(n=D);for(var F,X;D>R;){for(A=0;_>A;A++)a[A].pred=0;if(z=0,1==_)for(k=a[0],C=0;n>C;C++)w(k,L,R),R++;else for(C=0;n>C;C++){for(A=0;_>A;A++)for(k=a[A],F=k.h,X=k.v,I=0;X>I;I++)for(B=0;F>B;B++)b(k,L,R,I,B);if(R++,R===D)break}if(T=0,M=e[r]<<8|e[r+1],65280>M)throw"marker was not found";if(!(M>=65488&&65495>=M))break;r+=2}return r-S}function o(e,r){function t(e,t,a){var n,o,i,s,f,m,y,b,w,U,k=r.quantizationTable,A=a;for(U=0;64>U;U++)A[U]=e[U]*k[U];for(U=0;8>U;++U){var I=8*U;0!=A[1+I]||0!=A[2+I]||0!=A[3+I]||0!=A[4+I]||0!=A[5+I]||0!=A[6+I]||0!=A[7+I]?(n=v*A[0+I]+128>>8,o=v*A[4+I]+128>>8,i=A[2+I],s=A[6+I],f=g*(A[1+I]-A[7+I])+128>>8,b=g*(A[1+I]+A[7+I])+128>>8,m=A[3+I]<<4,y=A[5+I]<<4,w=n-o+1>>1,n=n+o+1>>1,o=w,w=i*p+s*u+128>>8,i=i*u-s*p+128>>8,s=w,w=f-y+1>>1,f=f+y+1>>1,y=w,w=b+m+1>>1,m=b-m+1>>1,b=w,w=n-s+1>>1,n=n+s+1>>1,s=w,w=o-i+1>>1,o=o+i+1>>1,i=w,w=f*h+b*d+2048>>12,f=f*d-b*h+2048>>12,b=w,w=m*l+y*c+2048>>12,m=m*c-y*l+2048>>12,y=w,A[0+I]=n+b,A[7+I]=n-b,A[1+I]=o+y,A[6+I]=o-y,A[2+I]=i+m,A[5+I]=i-m,A[3+I]=s+f,A[4+I]=s-f):(w=v*A[0+I]+512>>10,A[0+I]=w,A[1+I]=w,A[2+I]=w,A[3+I]=w,A[4+I]=w,A[5+I]=w,A[6+I]=w,A[7+I]=w)}for(U=0;8>U;++U){var B=U;0!=A[8+B]||0!=A[16+B]||0!=A[24+B]||0!=A[32+B]||0!=A[40+B]||0!=A[48+B]||0!=A[56+B]?(n=v*A[0+B]+2048>>12,o=v*A[32+B]+2048>>12,i=A[16+B],s=A[48+B],f=g*(A[8+B]-A[56+B])+2048>>12,b=g*(A[8+B]+A[56+B])+2048>>12,m=A[24+B],y=A[40+B],w=n-o+1>>1,n=n+o+1>>1,o=w,w=i*p+s*u+2048>>12,i=i*u-s*p+2048>>12,s=w,w=f-y+1>>1,f=f+y+1>>1,y=w,w=b+m+1>>1,m=b-m+1>>1,b=w,w=n-s+1>>1,n=n+s+1>>1,s=w,w=o-i+1>>1,o=o+i+1>>1,i=w,w=f*h+b*d+2048>>12,f=f*d-b*h+2048>>12,b=w,w=m*l+y*c+2048>>12,m=m*c-y*l+2048>>12,y=w,A[0+B]=n+b,A[56+B]=n-b,A[8+B]=o+y,A[48+B]=o-y,A[16+B]=i+m,A[40+B]=i-m,A[24+B]=s+f,A[32+B]=s-f):(w=v*a[U+0]+8192>>14,A[0+B]=w,A[8+B]=w,A[16+B]=w,A[24+B]=w,A[32+B]=w,A[40+B]=w,A[48+B]=w,A[56+B]=w)}for(U=0;64>U;++U){var C=128+(A[U]+8>>4);t[U]=0>C?0:C>255?255:C}}for(var a,n,o=[],i=r.blocksPerLine,s=r.blocksPerColumn,f=i<<3,m=new Int32Array(64),y=new Uint8Array(64),b=0;s>b;b++){var w=b<<3;for(a=0;8>a;a++)o.push(new Uint8Array(f));for(var U=0;i>U;U++){t(r.blocks[b][U],y,m);var k=0,A=U<<3;for(n=0;8>n;n++){var I=o[w+n];for(a=0;8>a;a++)I[A+a]=y[k++]}}}return o}function i(e){return 0>e?0:e>255?255:e}function s(e){function r(e){for(var r=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],t=0;64>t;t++){var a=I((r[t]*e+50)/100);1>a?a=1:a>255&&(a=255),B[O[t]]=a}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;64>o;o++){var i=I((n[o]*e+50)/100);1>i?i=1:i>255&&(i=255),C[O[o]]=i}for(var s=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,c=0;8>c;c++)for(var l=0;8>l;l++)L[f]=1/(B[O[f]]*s[c]*s[l]*8),x[f]=1/(C[O[f]]*s[c]*s[l]*8),f++}function t(e,r){for(var t=0,a=0,n=new Array,o=1;16>=o;o++){for(var i=1;i<=e[o];i++)n[r[a]]=[],n[r[a]][0]=t,n[r[a]][1]=o,a++,t++;t*=2}return n}function a(){b=t(H,N),w=t(j,$),U=t(q,Y),k=t(J,V)}function n(){for(var e=1,r=2,t=1;15>=t;t++){for(var a=e;r>a;a++)S[32767+a]=t,E[32767+a]=[],E[32767+a][1]=t,E[32767+a][0]=a;for(var n=-(r-1);-e>=n;n++)S[32767+n]=t,E[32767+n]=[],E[32767+n][1]=t,E[32767+n][0]=r-1+n;e<<=1,r<<=1}}function o(){for(var e=0;256>e;e++)X[e]=19595*e,X[e+256>>0]=38470*e,X[e+512>>0]=7471*e+32768,X[e+768>>0]=-11059*e,X[e+1024>>0]=-21709*e,X[e+1280>>0]=32768*e+8421375,X[e+1536>>0]=-27439*e,X[e+1792>>0]=-5329*e}function i(e){for(var r=e[0],t=e[1]-1;t>=0;)r&1<<t&&(G|=1<<_),t--,_--,0>_&&(255==G?(s(255),s(0)):s(G),_=7,G=0)}function s(e){z.push(e)}function f(e){s(e>>8&255),s(255&e)}function c(e,r){var t,a,n,o,i,s,f,c,l,d=0;const h=8,u=64;for(l=0;h>l;++l){t=e[d],a=e[d+1],n=e[d+2],o=e[d+3],i=e[d+4],s=e[d+5],f=e[d+6],c=e[d+7];var p=t+c,v=t-c,g=a+f,m=a-f,y=n+s,b=n-s,w=o+i,U=o-i,k=p+w,A=p-w,I=g+y,B=g-y;e[d]=k+I,e[d+4]=k-I;var C=.707106781*(B+A);e[d+2]=A+C,e[d+6]=A-C,k=U+b,I=b+m,B=m+v;var L=.382683433*(k-B),x=.5411961*k+L,E=1.306562965*B+L,S=.707106781*I,T=v+S,z=v-S;e[d+5]=z+x,e[d+3]=z-x,e[d+1]=T+E,e[d+7]=T-E,d+=8}for(d=0,l=0;h>l;++l){t=e[d],a=e[d+8],n=e[d+16],o=e[d+24],i=e[d+32],s=e[d+40],f=e[d+48],c=e[d+56];var G=t+c,_=t-c,M=a+f,D=a-f,R=n+s,F=n-s,X=o+i,O=o-i,H=G+X,N=G-X,q=M+R,Y=M-R;e[d]=H+q,e[d+32]=H-q;var j=.707106781*(Y+N);e[d+16]=N+j,e[d+48]=N-j,H=O+F,q=F+D,Y=D+_;var $=.382683433*(H-Y),J=.5411961*H+$,V=1.306562965*Y+$,W=.707106781*q,K=_+W,Q=_-W;e[d+40]=Q+J,e[d+24]=Q-J,e[d+8]=K+V,e[d+56]=K-V,d++}var Z;for(l=0;u>l;++l)Z=e[l]*r[l],P[l]=Z>0?Z+.5|0:Z-.5|0;return P}function l(){f(65504),f(16),s(74),s(70),s(73),s(70),s(0),s(1),s(1),s(0),f(1),f(1),s(0),s(0)}function d(e,r){f(65472),f(17),s(8),f(r),f(e),s(3),s(1),s(17),s(0),s(2),s(17),s(1),s(3),s(17),s(1)}function h(){f(65499),f(132),s(0);for(var e=0;64>e;e++)s(B[e]);s(1);for(var r=0;64>r;r++)s(C[r])}function u(){f(65476),f(418),s(0);for(var e=0;16>e;e++)s(H[e+1]);for(var r=0;11>=r;r++)s(N[r]);s(16);for(var t=0;16>t;t++)s(q[t+1]);for(var a=0;161>=a;a++)s(Y[a]);s(1);for(var n=0;16>n;n++)s(j[n+1]);for(var o=0;11>=o;o++)s($[o]);s(17);for(var i=0;16>i;i++)s(J[i+1]);for(var c=0;161>=c;c++)s(V[c])}function p(){f(65498),f(12),s(3),s(1),s(0),s(2),s(17),s(3),s(17),s(0),s(63),s(0)}function v(e,r,t,a,n){var o,s=n[0],f=n[240];const l=16,d=63,h=64;for(var u=c(e,r),p=0;h>p;++p)T[O[p]]=u[p];var v=T[0]-t;t=T[0],0==v?i(a[0]):(o=32767+v,i(a[S[o]]),i(E[o]));for(var g=63;g>0&&0==T[g];g--);if(0==g)return i(s),t;for(var m,y=1;g>=y;){for(var b=y;0==T[y]&&g>=y;++y);var w=y-b;if(w>=l){m=w>>4;for(var U=1;m>=U;++U)i(f);w=15&w}o=32767+T[y],i(n[(w<<4)+S[o]]),i(E[o]),y++}return g!=d&&i(s),t}function g(){for(var e=String.fromCharCode,r=0;256>r;r++)F[r]=e(r)}function m(e){if(0>=e&&(e=1),e>100&&(e=100),A!==e){var t=0;t=50>e?Math.floor(5e3/e):Math.floor(200-2*e),r(t),A=e}}function y(){e||(e=50),g(),a(),n(),o(),m(e)}var b,w,U,k,A,I=(Math.round,Math.floor),B=new Array(64),C=new Array(64),L=new Array(64),x=new Array(64),E=new Array(65535),S=new Array(65535),P=new Array(64),T=new Array(64),z=[],G=0,_=7,M=new Array(64),D=new Array(64),R=new Array(64),F=new Array(256),X=new Array(2048),O=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],H=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],N=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Y=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],j=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],$=[0,1,2,3,4,5,6,7,8,9,10,11],J=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],V=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,r){r&&m(r),z=new Array,G=0,_=7,f(65496),l(),h(),d(e.width,e.height),u(),p();var t=0,a=0,n=0;G=0,_=7,this.encode.displayName="_encode_";for(var o,s,c,g,y,A,I,B,C,E=e.data,S=e.width,P=e.height,T=4*S,F=0;P>F;){for(o=0;T>o;){for(y=T*F+o,A=y,I=-1,B=0,C=0;64>C;C++)B=C>>3,I=4*(7&C),A=y+B*T+I,F+B>=P&&(A-=T*(F+1+B-P)),o+I>=T&&(A-=o+I-T+4),s=E[A++],c=E[A++],g=E[A++],M[C]=(X[s]+X[c+256>>0]+X[g+512>>0]>>16)-128,D[C]=(X[s+768>>0]+X[c+1024>>0]+X[g+1280>>0]>>16)-128,R[C]=(X[s+1280>>0]+X[c+1536>>0]+X[g+1792>>0]>>16)-128;t=v(M,L,t,b,U),a=v(D,x,a,w,k),n=v(R,x,n,w,k),o+=32}F+=8}if(_>=0){var O=[];O[1]=_+1,O[0]=(1<<_+1)-1,i(O)}return f(65497),new Uint8Array(z)},y()}var f=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),c=4017,l=799,d=3406,h=2276,u=1567,p=3784,v=5793,g=2896;t.prototype={constructor:t,parse:function(e){function r(){var r=e[l]<<8|e[l+1];return l+=2,r}function t(){var t=r(),a=e.subarray(l,l+t-2);return l+=a.length,a}function i(e){var r,t,a=0,n=0;for(t in e.components)e.components.hasOwnProperty(t)&&(r=e.components[t],a<r.h&&(a=r.h),n<r.v&&(n=r.v));var o=Math.ceil(e.samplesPerLine/8/a),i=Math.ceil(e.scanLines/8/n);for(t in e.components)if(e.components.hasOwnProperty(t)){r=e.components[t];for(var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*r.h/a),f=Math.ceil(Math.ceil(e.scanLines/8)*r.v/n),c=o*r.h,l=i*r.v,d=[],h=0;l>h;h++){for(var u=[],p=0;c>p;p++)u.push(new Int32Array(64));d.push(u)}r.blocksPerLine=s,r.blocksPerColumn=f,r.blocks=d}e.maxH=a,e.maxV=n,e.mcusPerLine=o,e.mcusPerColumn=i}var s,c,l=0,d=(e.length,null),h=null,u=[],p=[],v=[],g=[],m=r();if(65496!=m)throw"SOI not found";for(m=r();65497!=m;){var y,b;switch(m){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=t();65504===m&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(d={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])}),65518===m&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&0===w[5]&&(h={version:w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var U=r(),k=U+l-2;k>l;){var A=e[l++],I=new Int32Array(64);if(A>>4===0)for(b=0;64>b;b++){var B=f[b];I[B]=e[l++]}else{if(A>>4!==1)throw"DQT: invalid table spec";for(b=0;64>b;b++){var B=f[b];I[B]=r()}}u[15&A]=I}break;case 65472:case 65473:case 65474:r(),s={},s.extended=65473===m,s.progressive=65474===m,s.precision=e[l++],s.scanLines=r(),s.samplesPerLine=r(),s.components={},s.componentsOrder=[];var C,L=e[l++];for(y=0;L>y;y++){C=e[l];var x=e[l+1]>>4,E=15&e[l+1],S=e[l+2];s.componentsOrder.push(C),s.components[C]={h:x,v:E,quantizationIdx:S},l+=3}i(s),p.push(s);break;case 65476:var P=r();for(y=2;P>y;){var T=e[l++],z=new Uint8Array(16),G=0;for(b=0;16>b;b++,l++)G+=z[b]=e[l];var _=new Uint8Array(G);for(b=0;G>b;b++,l++)_[b]=e[l];y+=17+G,(T>>4===0?g:v)[15&T]=a(z,_)}break;case 65501:r(),c=r();break;case 65498:var M,D=(r(),e[l++]),R=[];for(y=0;D>y;y++){M=s.components[e[l++]];var F=e[l++];M.huffmanTableDC=g[F>>4],M.huffmanTableAC=v[15&F],R.push(M)}var X=e[l++],O=e[l++],H=e[l++],N=n(e,l,s,R,c,X,O,H>>4,15&H);l+=N;break;default:if(255==e[l-3]&&e[l-2]>=192&&e[l-2]<=254){l-=3;break}throw"unknown JPEG marker "+m.toString(16)}m=r()}if(1!=p.length)throw"only single frame JPEGs supported";for(var y=0;y<p.length;y++){var q=p[y].components;for(var b in q)q[b].quantizationTable=u[q[b].quantizationIdx],delete q[b].quantizationIdx}this.width=s.samplesPerLine,this.height=s.scanLines,this.jfif=d,this.adobe=h,this.components=[];for(var y=0;y<s.componentsOrder.length;y++){var M=s.components[s.componentsOrder[y]];this.components.push({lines:o(s,M),scaleX:M.h/s.maxH,scaleY:M.v/s.maxV})}},getData:function(e,r){var t,a,n,o,s,f,c,l,d,h,u,p,v,g,m,y,b,w,U,k,A,I=this.width/e,B=this.height/r,C=0,L=e*r*this.components.length,x=new Uint8Array(L);switch(this.components.length){case 1:for(t=this.components[0],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],d=0;e>d;d++)u=s[0|d*t.scaleX*I],x[C++]=u;break;case 2:for(t=this.components[0],a=this.components[1],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],d=0;e>d;d++)u=s[0|d*t.scaleX*I],x[C++]=u,u=f[0|d*a.scaleX*I],x[C++]=u;break;case 3:for(A=!0,this.adobe&&this.adobe.transformCode?A=!0:"undefined"!=typeof this.colorTransform&&(A=!!this.colorTransform),t=this.components[0],a=this.components[1],n=this.components[2],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],c=n.lines[0|h*n.scaleY*B],d=0;e>d;d++)A?(u=s[0|d*t.scaleX*I],p=f[0|d*a.scaleX*I],v=c[0|d*n.scaleX*I],w=i(u+1.402*(v-128)),U=i(u-.3441363*(p-128)-.71413636*(v-128)),k=i(u+1.772*(p-128))):(w=s[0|d*t.scaleX*I],U=f[0|d*a.scaleX*I],k=c[0|d*n.scaleX*I]),x[C++]=w,x[C++]=U,x[C++]=k;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";for(A=!1,this.adobe&&this.adobe.transformCode?A=!0:"undefined"!=typeof this.colorTransform&&(A=!!this.colorTransform),t=this.components[0],a=this.components[1],n=this.components[2],o=this.components[3],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],c=n.lines[0|h*n.scaleY*B],l=o.lines[0|h*o.scaleY*B],d=0;e>d;d++)A?(u=s[0|d*t.scaleX*I],p=f[0|d*a.scaleX*I],v=c[0|d*n.scaleX*I],g=l[0|d*o.scaleX*I],m=255-i(u+1.402*(v-128)),y=255-i(u-.3441363*(p-128)-.71413636*(v-128)),b=255-i(u+1.772*(p-128))):(m=s[0|d*t.scaleX*I],y=f[0|d*a.scaleX*I],b=c[0|d*n.scaleX*I],g=l[0|d*o.scaleX*I]),x[C++]=m,x[C++]=y,x[C++]=b,x[C++]=g;break;default:throw"Unsupported color mode"}return x},copyToImageData:function(e){var r,t,a,n,o,s,f,c,l,d=e.width,h=e.height,u=e.data,p=this.getData(d,h),v=0,g=0;switch(this.components.length){case 1:for(t=0;h>t;t++)for(r=0;d>r;r++)a=p[v++],u[g++]=a,u[g++]=a,u[g++]=a,u[g++]=255;break;case 3:for(t=0;h>t;t++)for(r=0;d>r;r++)f=p[v++],c=p[v++],l=p[v++],u[g++]=f,u[g++]=c,u[g++]=l,u[g++]=255;break;case 4:for(t=0;h>t;t++)for(r=0;d>r;r++)o=p[v++],s=p[v++],a=p[v++],n=p[v++],f=255-i(o*(1-n/255)+n),c=255-i(s*(1-n/255)+n),l=255-i(a*(1-n/255)+n),u[g++]=f,u[g++]=c,u[g++]=l,u[g++]=255;break;default:throw"Unsupported color mode"}}};e.Codec.JPEG=e.Codec.JPG={encoder:function(e,r){r=r||{};var t="undefined"==typeof r.quality?100:r.quality,a=new s(t),n=a.encode(e);return n},decoder:function(e,r){var a=new t;a.parse(new Uint8Array(e));var n={width:a.width,height:a.height,data:new Uint8Array(a.width*a.height*4)};return a.copyToImageData(n),n}}}(e),!function(e,r){"use strict";function t(e){var r=this;if(r.pos=0,r.buffer=e,r.flag=[String.fromCharCode(r.buffer[r.pos++]),String.fromCharCode(r.buffer[r.pos++])].join(""),"BM"!==r.flag)throw new Error("Invalid BMP File");r.parseHeader(),r.parseBGR()}function a(e){var r=this;r.data=e.data,r.width=e.width,r.height=e.height,r.extraBytes=r.width%4,r.rgbSize=r.height*(3*r.width+r.extraBytes),r.headerInfoSize=40,r.flag="BM",r.reserved=0,r.offset=54,r.fileSize=r.rgbSize+r.offset,r.planes=1,r.bitPP=24,r.compress=0,r.hr=0,r.vr=0,r.colors=0,r.importantColors=0}t.prototype={constructor:t,pos:0,buffer:null,flag:null,fileSize:null,reserved:null,offset:null,headerSize:null,width:0,height:0,planes:null,bitPP:null,compress:null,rawSize:null,hr:null,vr:null,colors:null,importantColors:null,palette:null,data:null,readUInt8:function(e){return this.buffer[e++]},readUInt16LE:function(e){var r,t,a=this;return r=a.buffer[e++],t=a.buffer[e++],r|t<<8},readUInt32LE:function(e){var r,t,a,n,o=this;return r=o.buffer[e++],t=o.buffer[e++],a=o.buffer[e++],n=o.buffer[e++],r|t<<8|a<<16|n<<24},parseHeader:function(){var e=this;if(e.fileSize=e.readUInt32LE(e.pos),e.pos+=4,e.reserved=e.readUInt32LE(e.pos),e.pos+=4,e.offset=e.readUInt32LE(e.pos),e.pos+=4,e.headerSize=e.readUInt32LE(e.pos),e.pos+=4,e.width=e.readUInt32LE(e.pos),e.pos+=4,e.height=e.readUInt32LE(e.pos),e.pos+=4,e.planes=e.readUInt16LE(e.pos),e.pos+=2,e.bitPP=e.readUInt16LE(e.pos),e.pos+=2,e.compress=e.readUInt32LE(e.pos),e.pos+=4,e.rawSize=e.readUInt32LE(e.pos),
e.pos+=4,e.hr=e.readUInt32LE(e.pos),e.pos+=4,e.vr=e.readUInt32LE(e.pos),e.pos+=4,e.colors=e.readUInt32LE(e.pos),e.pos+=4,e.importantColors=e.readUInt32LE(e.pos),e.pos+=4,e.bitPP<24){var r=0===e.colors?1<<e.bitPP:e.colors;e.palette=new Array(r);for(var t=0;r>t;t++){var a=e.readUInt8(e.pos++),n=e.readUInt8(e.pos++),o=e.readUInt8(e.pos++),i=e.readUInt8(e.pos++);e.palette[t]={red:o,green:n,blue:a,quad:i}}}},parseBGR:function(){var e=this;e.pos=e.offset;var r="bit"+e.bitPP,t=e.width*e.height*4;try{e.data=new Uint8Array(t),e[r]()}catch(a){console.log("bit decode error:"+a)}},bit1:function(){var e,r,t,a,n,o,i=this,s=i.palette,f=i.width,c=i.height,l=Math.ceil(f/8),d=l%4;for(e=c-1;e>=0;e--){for(r=0;l>r;r++)for(t=i.readUInt8(i.pos++),a=e*f*4+8*r*4,n=0;8>n&&f>8*r+n;n++)o=s[t>>7-n&1],i.data[a+4*n]=o.blue,i.data[a+4*n+1]=o.green,i.data[a+4*n+2]=o.red,i.data[a+4*n+3]=255;0!=d&&(i.pos+=4-d)}},bit4:function(){var e,r,t,a,n,o,i,s=this,f=s.palette,c=s.width,l=s.height,d=Math.ceil(c/2),h=d%4;for(e=l-1;e>=0;e--){for(r=0;d>r&&(t=s.readUInt8(s.pos++),a=e*c*4+2*r*4,n=t>>4,o=15&t,i=f[n],s.data[a]=i.blue,s.data[a+1]=i.green,s.data[a+2]=i.red,s.data[a+3]=255,!(2*r+1>=c));r++)i=f[o],s.data[a+4]=i.blue,s.data[a+4+1]=i.green,s.data[a+4+2]=i.red,s.data[a+4+3]=255;0!=h&&(s.pos+=4-h)}},bit8:function(){var e,r,t,a,n,o=this,i=o.palette,s=o.width,f=o.height,c=s%4;for(e=f-1;e>=0;e--){for(r=0;s>r;r++)t=o.readUInt8(o.pos++),a=e*s*4+4*r,t<i.length?(n=i[t],o.data[a]=n.blue,o.data[a+1]=n.green,o.data[a+2]=n.red,o.data[a+3]=255):(o.data[a]=255,o.data[a+1]=255,o.data[a+2]=255,o.data[a+3]=255);0!=c&&(o.pos+=4-c)}},bit24:function(){var e,r,t,a,n,o,i=this,s=(i.palette,i.width),f=i.height,c=s%4;for(e=f-1;e>=0;e--){for(r=0;s>r;r++)a=i.readUInt8(i.pos++),n=i.readUInt8(i.pos++),o=i.readUInt8(i.pos++),t=e*s*4+4*r,i.data[t]=o,i.data[t+1]=n,i.data[t+2]=a,i.data[t+3]=255;i.pos+=c}},getData:function(){return this.data}},a.prototype={constructor:a,flag:null,fileSize:null,reserved:null,offset:null,headerSize:null,width:0,height:0,planes:null,bitPP:null,compress:null,rawSize:null,hr:null,vr:null,colors:null,importantColors:null,palette:null,extraBytes:null,rgbSize:null,headerInfoSize:null,data:null,write:function(e,r){for(var t=0;t<r.length;t++)e.push(r.charCodeAt(t))},writeUInt8:function(e,r){e.push(255&r)},writeUInt16LE:function(e,r){e.push(255&r,r>>>8&255)},writeUInt32LE:function(e,r){e.push(255&r,r>>>8&255,r>>>16&255,r>>>24&255)},fill:function(e,r,t,a){for(var n=t;a>n;n++)e[n]=r},encode:function(){var e=this,r=e.width,t=e.height,a=[],n=new Array(e.offset+e.rgbSize);e.write(a,e.flag),e.writeUInt32LE(a,e.fileSize),e.writeUInt32LE(a,e.reserved),e.writeUInt32LE(a,e.offset),e.writeUInt32LE(a,e.headerInfoSize),e.writeUInt32LE(a,r),e.writeUInt32LE(a,t),e.writeUInt16LE(a,e.planes),e.writeUInt16LE(a,e.bitPP),e.writeUInt32LE(a,e.compress),e.writeUInt32LE(a,e.rgbSize),e.writeUInt32LE(a,e.hr),e.writeUInt32LE(a,e.vr),e.writeUInt32LE(a,e.colors),e.writeUInt32LE(a,e.importantColors);var o,i,s,f,c,l,d,h=0,u=3*r+e.extraBytes;for(o=t-1;o>=0;o--){for(i=0;r>i;i++)s=o*u+3*i,f=e.data[h++],c=e.data[h++],l=e.data[h++],h++,n[s+2]=f,n[s+1]=c,n[s]=l;e.extraBytes>0&&(d=o*u+3*r,e.fill(n,0,d,d+e.extraBytes))}return new Uint8Array(a.concat(n))}},e.Codec.BMP={encoder:function(e,r){"undefined"==typeof r.quality?100:r.quality;return new a(e).encode()},decoder:function(e,r){var a=new t(new Uint8Array(e));return{data:a.data,width:a.width,height:a.height}}}}(e),!function(e,r){"use strict";function t(e){return e.reduce(function(e,r){return 2*e+r},0)}function a(e){for(var r=[],t=7;t>=0;t--)r.push(!!(e&1<<t));return r}function n(e,r){for(var t,a,n=0,o=function(e){for(var t=0,a=0;e>a;a++)r.charCodeAt(n>>3)&1<<(7&n)&&(t|=1<<a),n++;return t},i=[],s=1<<e,f=s+1,c=e+1,l=[],d=function(){l=[],c=e+1;for(var r=0;s>r;r++)l[r]=[r];l[s]=[],l[f]=null};;)if(a=t,t=o(c),t!==s){if(t===f)break;if(t<l.length)a!==s&&l.push(l[a].concat(l[t][0]));else{if(t!==l.length)throw new Error("Invalid LZW code.");l.push(l[a].concat(l[a][0]))}i.push.apply(i,l[t]),l.length===1<<c&&12>c&&c++}else d();return i}function o(e){var r=this;r.data=e,r.len=r.data.length,r.pos=0,r.readByte=function(){var r=this;if(r.pos>=r.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[r.pos++]:255&e.charCodeAt(r.pos++)},r.readBytes=function(e){for(var r=this,t=[],a=0;e>a;a++)t.push(r.readByte());return t},r.read=function(e){for(var r=this,t="",a=0;e>a;a++)t+=String.fromCharCode(r.readByte());return t},r.readUnsigned=function(){var e=this,r=e.readBytes(2);return(r[1]<<8)+r[0]}}function i(e,r){r||(r={});var o=function(r){for(var t=[],a=0;r>a;a++)t.push(e.readBytes(3));return t},i=function(){var r,t;t="";do r=e.readByte(),t+=e.read(r);while(0!==r);return t},s=function(){var n={};if(n.sig=e.read(3),n.ver=e.read(3),"GIF"!==n.sig)throw new Error("Not a GIF file.");n.width=e.readUnsigned(),n.height=e.readUnsigned();var i=a(e.readByte());n.gctFlag=i.shift(),n.colorRes=t(i.splice(0,3)),n.sorted=i.shift(),n.gctSize=t(i.splice(0,3)),n.bgColor=e.readByte(),n.pixelAspectRatio=e.readByte(),n.gctFlag&&(n.gct=o(1<<n.gctSize+1)),r.hdr&&r.hdr(n)},f=function(n){var o=function(n){var o=(e.readByte(),a(e.readByte()));n.reserved=o.splice(0,3),n.disposalMethod=t(o.splice(0,3)),n.userInput=o.shift(),n.transparencyGiven=o.shift(),n.delayTime=e.readUnsigned(),n.transparencyIndex=e.readByte(),n.terminator=e.readByte(),r.gce&&r.gce(n)},s=function(e){e.comment=i(),r.com&&r.com(e)},f=function(t){e.readByte();t.ptHeader=e.readBytes(12),t.ptData=i(),r.pte&&r.pte(t)},c=function(t){var a=function(t){e.readByte();t.unknown=e.readByte(),t.iterations=e.readUnsigned(),t.terminator=e.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(t)},n=function(e){e.appData=i(),r.app&&r.app[e.identifier]&&r.app[e.identifier](e)};e.readByte();switch(t.identifier=e.read(8),t.authCode=e.read(3),t.identifier){case"NETSCAPE":a(t);break;default:n(t)}},l=function(e){e.data=i(),r.unknown&&r.unknown(e)};switch(n.label=e.readByte(),n.label){case 249:n.extType="gce",o(n);break;case 254:n.extType="com",s(n);break;case 1:n.extType="pte",f(n);break;case 255:n.extType="app",c(n);break;default:n.extType="unknown",l(n)}},c=function(s){var f=function(e,r){for(var t=new Array(e.length),a=e.length/r,n=function(a,n){var o=e.slice(n*r,(n+1)*r);t.splice.apply(t,[a*r,r].concat(o))},o=[0,4,2,1],i=[8,8,4,2],s=0,f=0;4>f;f++)for(var c=o[f];a>c;c+=i[f])n(c,s),s++;return t};s.leftPos=e.readUnsigned(),s.topPos=e.readUnsigned(),s.width=e.readUnsigned(),s.height=e.readUnsigned();var c=a(e.readByte());s.lctFlag=c.shift(),s.interlaced=c.shift(),s.sorted=c.shift(),s.reserved=c.splice(0,2),s.lctSize=t(c.splice(0,3)),s.lctFlag&&(s.lct=o(1<<s.lctSize+1)),s.lzwMinCodeSize=e.readByte();var l=i();s.pixels=n(s.lzwMinCodeSize,l),s.interlaced&&(s.pixels=f(s.pixels,s.width)),r.img&&r.img(s)},l=function(){var t={};switch(t.sentinel=e.readByte(),String.fromCharCode(t.sentinel)){case"!":t.type="ext",f(t);break;case",":t.type="img",c(t);break;case";":t.type="eof",r.eof&&r.eof(t);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&l()},d=function(){s(),l()};d()}e.Codec.GIF={encoder:e.NotImplemented("GIF.encoder"),decoder:function(r,t){var a,n=null,s={width:0,height:0,data:null};return i(new o(new Uint8Array(r)),{hdr:function(e){a=e},gce:function(e){n=e.transparencyGiven?e.transparencyIndex:null},img:function(r){var t=r.lctFlag?r.lct:a.gct,o=new e.ImArray(r.width*r.height*4);r.pixels.forEach(function(e,r){e!==n&&(o[(r<<2)+0]=t[e][0],o[(r<<2)+1]=t[e][1],o[(r<<2)+2]=t[e][2],o[(r<<2)+3]=255)}),s.width=r.width,s.height=r.height,s.data=o}}),s}}}(e),!function(e,r){"use strict";function t(e){switch(e.image_type){case u:case g:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&d("TGA.tgaCheckHeader: Invalid type colormap data for indexed type");break;case p:case v:case m:case y:e.colormap_type&&d("TGA.tgaCheckHeader: Invalid type colormap data for colormap type");break;case h:d("TGA.tgaCheckHeader: No data");default:d('TGA.tgaCheckHeader: Invalid type " '+e.image_type+'"')}(e.width<=0||e.height<=0)&&d("TGA.tgaCheckHeader: Invalid image size"),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&d('TGA.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'"')}function a(e,r,t,a,n){var o,i,s,f;if(i=t.pixel_size>>3,s=t.width*t.height*i,r&&(f=n.subarray(a,a+=t.colormap_length*(t.colormap_size>>3))),e){o=new Uint8Array(s);for(var c,l,d,h=0,u=new Uint8Array(i);s>h;)if(c=n[a++],l=(127&c)+1,128&c){for(d=0;i>d;++d)u[d]=n[a++];for(d=0;l>d;++d)o.set(u,h+d*i);h+=i*l}else{for(l*=i,d=0;l>d;++d)o[h+d]=n[a++];h+=l}}else o=n.subarray(a,a+=r?t.width*t.height:s);return{pixel_data:o,palettes:f}}function n(e,r,t,a,n,o,i,s,f,c){var l,d,h,u=c,p=0,v=e.width;for(h=t;h!==n;h+=a)for(d=o;d!==s;d+=i,p++)l=f[p],r[4*(d+v*h)+3]=255,r[4*(d+v*h)+2]=u[3*l+0],r[4*(d+v*h)+1]=u[3*l+1],r[4*(d+v*h)+0]=u[3*l+2];return r}function o(e,r,t,a,n,o,i,s,f){var c,l,d,h=0,u=e.width;for(d=t;d!==n;d+=a)for(l=o;l!==s;l+=i,h+=2)c=f[h+0]+(f[h+1]<<8),r[4*(l+u*d)+0]=(31744&c)>>7,r[4*(l+u*d)+1]=(992&c)>>2,r[4*(l+u*d)+2]=(31&c)>>3,r[4*(l+u*d)+3]=32768&c?0:255;return r}function i(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=3)r[4*(c+h*l)+3]=255,r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+1]=f[d+1],r[4*(c+h*l)+0]=f[d+2];return r}function s(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=4)r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+1]=f[d+1],r[4*(c+h*l)+0]=f[d+2],r[4*(c+h*l)+3]=f[d+3];return r}function f(e,r,t,a,n,o,i,s,f){var c,l,d,h=0,u=e.width;for(d=t;d!==n;d+=a)for(l=o;l!==s;l+=i,h++)c=f[h],r[4*(l+u*d)+0]=c,r[4*(l+u*d)+1]=c,r[4*(l+u*d)+2]=c,r[4*(l+u*d)+3]=255;return r}function c(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=2)r[4*(c+h*l)+0]=f[d+0],r[4*(c+h*l)+1]=f[d+0],r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+3]=f[d+1];return r}function l(e,r,t,a,l,h){var u,p,v,g,m,y,B=new Uint8Array(r*t*4);switch((e.flags&b)>>w){default:case A:u=0,v=1,m=r,p=0,g=1,y=t;break;case U:u=0,v=1,m=r,p=t-1,g=-1,y=-1;break;case I:u=r-1,v=-1,m=-1,p=0,g=1,y=t;break;case k:u=r-1,v=-1,m=-1,p=t-1,g=-1,y=-1}if(h)switch(e.pixel_size){case 8:f(e,B,p,g,y,u,v,m,a);break;case 16:c(e,B,p,g,y,u,v,m,a);break;default:d("TGA.getTgaRGBA: not support this format")}else switch(e.pixel_size){case 8:n(e,B,p,g,y,u,v,m,a,l);break;case 16:o(e,B,p,g,y,u,v,m,a);break;case 24:i(e,B,p,g,y,u,v,m,a);break;case 32:s(e,B,p,g,y,u,v,m,a);break;default:d("TGA.getTgaRGBA: not support this format")}return B}var d=function(r){e.error(r,!0)},h=0,u=1,p=2,v=3,g=9,m=10,y=11,b=48,w=4,U=0,k=1,A=2,I=3;e.Codec.TGA={encoder:e.NotImplemented("TGA.encoder"),decoder:function(e,r){e.length<19&&d("TGA: Not enough data to contain header.");var n=new Uint8Array(e),o=0,i={id_length:n[o++],colormap_type:n[o++],image_type:n[o++],colormap_index:n[o++]|n[o++]<<8,colormap_length:n[o++]|n[o++]<<8,colormap_size:n[o++],origin:[n[o++]|n[o++]<<8,n[o++]|n[o++]<<8],width:n[o++]|n[o++]<<8,height:n[o++]|n[o++]<<8,pixel_size:n[o++],flags:n[o++]};t(i),i.id_length+o>e.length&&d("TGA: No data"),o+=i.id_length;var s=!1,f=!1,c=!1;switch(i.image_type){case g:s=!0,f=!0;break;case u:f=!0;break;case m:s=!0;break;case p:break;case y:s=!0,c=!0;break;case v:c=!0}var h=a(s,f,i,o,n),b=l(i,i.width,i.height,h.pixel_data,h.palettes,c);return{width:i.width,height:i.height,data:b}}}}(e),!function(e,r){"use strict";var t=function(r){e.error(r,!0)},a="hasOwnproperty",n=Array.prototype.push,o=Array.prototype.slice,i=-1,s=1,f=2,c=3,l=4,d=function(e,r){switch(e){case s:t("RGBE Read Error: "+(r||""));break;case f:t("RGBE Write Error: "+(r||""));break;case c:t("RGBE Bad File Format: "+(r||""));break;case l:default:t("RGBE: Error: "+(r||""))}return i},h=4,u=1,p=2,v=4,g="\n",m=function(e,r,t){r=r?r:1024;for(var a=e.pos,n=-1,o=0,i="",s=128,f=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+s)));0>(n=f.indexOf(g))&&r>o&&a<e.byteLength;)i+=f,o+=f.length,a+=s,f+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+s)));return n>-1?(!1!==t&&(e.pos+=o+n+1),i+f.slice(0,n)):!1},y=function(e,r){var t,a,i=r.length;for(b=new Uint16Array(i),t=0;i>t;t++)a=r.charCodeAt(t),b[t]=a;n.apply(e,o.call(new Uint8Array(b)))},w=function(e,r){n.apply(e,o.call(r))},U=/^#\?(\S+)$/,k=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,A=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,I=/^\s*FORMAT=(\S+)\s*$/,B=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,C=function(e){var r,t,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(r=m(e)))return d(s,"no header found");if(!(t=r.match(U)))return d(c,"bad initial token");for(a.valid|=u,a.programtype=t[1],a.string+=r+"\n";;){if(r=m(e),!1===r)break;if(a.string+=r+"\n","#"!==r.charAt(0)){if((t=r.match(k))&&(a.gamma=parseFloat(t[1],10)),(t=r.match(A))&&(a.exposure=parseFloat(t[1],10)),(t=r.match(I))&&(a.valid|=p,a.format=t[1]),(t=r.match(B))&&(a.valid|=v,a.height=parseInt(t[1],10),a.width=parseInt(t[2],10)),a.valid&p&&a.valid&v)break}else a.comments+=r+"\n"}return a.valid&p?a.valid&v?a:d(c,"missing image size specifier"):d(c,"missing format specifier")},L=function(e,r,t,n){var o="RGBE";n=n||{},n[a]("programtype")&&(o=n.programtype),y(e,"#?"+o+"\n"),n[a]("gamma")&&y(e,"GAMMA="+n.gamma+"\n"),n[a]("exposure")&&y(e,"EXPOSURE="+n.exposure+"\n"),y(e,"FORMAT=32-bit_rle_rgbe\n\n"),y(e,"-Y "+~~t+" +X "+~~r+"\n")},x=function(e,r,t){var a,n,o,i,f,h,u,p,v,g,m,y,b,w=r,U=t;if(8>w||w>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(w!==(e[2]<<8|e[3]))return d(c,"wrong scanline width");if(a=new Uint8Array(4*r*t),!a||!a.length)return d(l,"unable to allocate buffer space");for(n=0,o=0,p=4*w,b=new Uint8Array(4),h=new Uint8Array(p);U>0&&o<e.byteLength;){if(o+4>e.byteLength)return d(s);if(b[0]=e[o++],b[1]=e[o++],b[2]=e[o++],b[3]=e[o++],2!=b[0]||2!=b[1]||(b[2]<<8|b[3])!=w)return d(c,"bad rgbe scanline format");for(u=0;p>u&&o<e.byteLength;){if(i=e[o++],y=i>128,y&&(i-=128),0===i||u+i>p)return d(c,"bad scanline data");if(y)for(f=e[o++],v=0;i>v;v++)h[u++]=f;else h.set(e.subarray(o,o+i),u),u+=i,o+=i}for(g=w,v=0;g>v;v++)m=0,a[n]=h[v+m],m+=w,a[n+1]=h[v+m],m+=w,a[n+2]=h[v+m],m+=w,a[n+3]=h[v+m],n+=4;U--}return a},E=function(e,r,t){var a,n,o,i,s,f=4,c=new Uint8Array(2);for(a=0;t>a;){for(n=a,o=i=0;f>o&&t>n;)for(n+=o,i=o,o=1;t>n+o&&127>o&&r[n]==r[n+o];)o++;for(i>1&&i==n-a&&(c[0]=128+i,c[1]=r[a],w(e,c),a=n);n>a;)s=n-a,s>128&&(s=128),c[0]=s,w(e,c),w(e,r.subarray(a,s)),a+=s;o>=f&&(c[0]=128+o,c[1]=r[n],w(e,c),a+=o)}},S=function(e,r,t,a){var n,o,i,s=new Uint8Array(4);if(8>t||t>32767)return void w(e,r);for(n=new Uint8Array(4*t),i=0;a-- >0;){for(s[0]=2,s[1]=2,s[2]=t>>8,s[3]=255&t,w(e,s),o=0;t>o;o++)s[0]=r[datapos+0],s[1]=r[datapos+1],s[2]=r[datapos+2],s[3]=r[datapos+3],n[o]=s[0],n[o+t]=s[1],n[o+2*t]=s[2],n[o+3*t]=s[3],i+=h;for(o=0;4>o;o++)E(e,n[o*t],t)}};e.Codec.HDR=e.Codec.RGBE={encoder:function(e,r){r=r||{};var t=[];return L(t,e.width,e.height,r),S(t,e.data,r.scanline_width||0,r.num_scanlines||0),new Uint8Array(t)},decoder:function(e,r){var t=new Uint8Array(e);t.byteLength;t.pos=0;var a=C(t);if(i!==a){var n=a.width,o=a.height,s=x(t.subarray(t.pos),n,o);if(i!==s)return r&&(r.header=a.string,r.gamma=a.gamma,r.exposure=a.exposure),{width:n,height:o,data:s}}return null}}}(e),e});
/**
*
*   FILTER.js Plugins
*   @version: @@VERSION@@
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(n,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(n,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(r,t){return e.moduleUri=r.uri,e.call(n,t),t}):(e.call(n,n.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return n.FILTER})}(this,function n(e){return!function(e){"use strict";var r=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(n,e){var r=this;r.min=n||-127,r.max=e||127},path:e.getPath(n.moduleUri),serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{min:n.min,max:n.max}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.min=e.min,r.max=e.max),r},apply:function(n,e,a){var i=this;if(!i._isOn)return n;var s,o,l,u,h,c,f,d,m=i.max-i.min,g=i.min,p=n.length;if(r)for(s=0;p>s;s+=4)l=n[s],u=n[s+1],h=n[s+2],o=m*t()+g,c=l+o,f=u+o,d=h+o,0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),0>d?d=0:d>255&&(d=255),n[s]=~~c,n[s+1]=~~f,n[s+2]=~~d;else for(s=0;p>s;s+=4)l=n[s],u=n[s+1],h=n[s+2],o=m*t()+g,c=l+o,f=u+o,d=h+o,n[s]=~~c,n[s+1]=~~f,n[s+2]=~~d;return n}})}(e),!function(e){"use strict";var r=e._notSupportClamp,t=e.Array32F,a=e.Color.RGB2YCbCr,i=e.Color.YCbCr2RGB;e.Create({name:"HistogramEqualizeFilter",path:e.getPath(n.moduleUri),apply:function(n,e,s){var o=this;if(!o._isOn)return n;var l,u,h,c,f,d,m,g,p,_,v,y=0,C=255,b=0,M=n.length,w=M>>2,I=1/w;for(f=new t(256),p=0;256>p;p+=8)f[p]=0,f[p+1]=0,f[p+2]=0,f[p+3]=0,f[p+4]=0,f[p+5]=0,f[p+6]=0,f[p+7]=0;for(p=0;M>p;p+=4)_=a(n.subarray(p,p+3)),l=n[p]=~~_[2],u=n[p+1]=~~_[0],h=n[p+2]=~~_[1],f[u]+=I,u>y?y=u:C>u&&(C=u);for(b=0,p=0;256>p;p+=8)b+=f[p],f[p]=b,b+=f[p+1],f[p+1]=b,b+=f[p+2],f[p+2]=b,b+=f[p+3],f[p+3]=b,b+=f[p+4],f[p+4]=b,b+=f[p+5],f[p+5]=b,b+=f[p+6],f[p+6]=b,b+=f[p+7],f[p+7]=b;if(c=y-C,r)for(p=0;M>p;p+=4)_=[n[p+1],n[p+2],n[p]],_[0]=f[_[0]]*c+C,v=i(_),d=v[0],m=v[1],g=v[2],d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,g=0>g?0:g>255?255:g,n[p]=~~d,n[p+1]=~~m,n[p+2]=~~g;else for(p=0;M>p;p+=4)_=[n[p+1],n[p+2],n[p]],_[0]=f[_[0]]*c+C,v=i(_),n[p]=~~v[0],n[p+1]=~~v[1],n[p+2]=~~v[2];return n}}),e.Create({name:"GrayscaleHistogramEqualizeFilter",path:e.getPath(n.moduleUri),apply:function(n,e,a){var i=this;if(!i._isOn)return n;var s,o,l,u,h,c=0,f=255,d=0,m=n.length,g=m>>2,p=1/g;for(u=new t(256),h=0;256>h;h+=8)u[h]=0,u[h+1]=0,u[h+2]=0,u[h+3]=0,u[h+4]=0,u[h+5]=0,u[h+6]=0,u[h+7]=0;for(h=0;m>h;h+=4)s=n[h],u[s]+=p,s>c?c=s:f>s&&(f=s);for(d=0,h=0;256>h;h+=8)d+=u[h],u[h]=d,d+=u[h+1],u[h+1]=d,d+=u[h+2],u[h+2]=d,d+=u[h+3],u[h+3]=d,d+=u[h+4],u[h+4]=d,d+=u[h+5],u[h+5]=d,d+=u[h+6],u[h+6]=d,d+=u[h+7],u[h+7]=d;if(l=c-f,r)for(h=0;m>h;h+=4)s=n[h],o=u[s]*l+f,o=0>o?0:o>255?255:o,o=~~o,n[h]=o,n[h+1]=o,n[h+2]=o;else for(h=0;m>h;h+=4)s=n[h],o=~~(u[s]*l+f),n[h]=o,n[h+1]=o,n[h+2]=o;return n}}),e.Create({name:"RGBHistogramEqualizeFilter",path:e.getPath(n.moduleUri),apply:function(n,e,a){var i=this;if(!i._isOn)return n;var s,o,l,u,h,c,f,d,m,g,p,_,v,y,C,b,M=0,w=0,I=0,O=255,z=255,x=255,P=n.length,k=P>>2,F=1/k;for(f=new t(256),d=new t(256),m=new t(256),b=0;256>b;b+=8)f[b]=0,d[b]=0,m[b]=0,f[b+1]=0,d[b+1]=0,m[b+1]=0,f[b+2]=0,d[b+2]=0,m[b+2]=0,f[b+3]=0,d[b+3]=0,m[b+3]=0,f[b+4]=0,d[b+4]=0,m[b+4]=0,f[b+5]=0,d[b+5]=0,m[b+5]=0,f[b+6]=0,d[b+6]=0,m[b+6]=0,f[b+7]=0,d[b+7]=0,m[b+7]=0;for(b=0;P>b;b+=4)s=n[b],o=n[b+1],l=n[b+2],f[s]+=F,d[o]+=F,m[l]+=F,s>M?M=s:O>s&&(O=s),o>w?w=o:z>o&&(z=o),l>I?I=l:x>l&&(x=l);for(g=p=_=0,b=0;256>b;b+=8)g+=f[b],f[b]=g,p+=d[b],d[b]=p,_+=m[b],m[b]=_,g+=f[b+1],f[b+1]=g,p+=d[b+1],d[b+1]=p,_+=m[b+1],m[b+1]=_,g+=f[b+2],f[b+2]=g,p+=d[b+2],d[b+2]=p,_+=m[b+2],m[b+2]=_,g+=f[b+3],f[b+3]=g,p+=d[b+3],d[b+3]=p,_+=m[b+3],m[b+3]=_,g+=f[b+4],f[b+4]=g,p+=d[b+4],d[b+4]=p,_+=m[b+4],m[b+4]=_,g+=f[b+5],f[b+5]=g,p+=d[b+5],d[b+5]=p,_+=m[b+5],m[b+5]=_,g+=f[b+6],f[b+6]=g,p+=d[b+6],d[b+6]=p,_+=m[b+6],m[b+6]=_,g+=f[b+7],f[b+7]=g,p+=d[b+7],d[b+7]=p,_+=m[b+7],m[b+7]=_;if(u=M-O,h=w-z,c=I-x,r)for(b=0;P>b;b+=4)s=n[b],o=n[b+1],l=n[b+2],v=f[s]*u+O,y=d[o]*h+z,C=m[l]*c+x,v=0>v?0:v>255?255:v,y=0>y?0:y>255?255:y,C=0>C?0:C>255?255:C,n[b]=~~v,n[b+1]=~~y,n[b+2]=~~C;else for(b=0;P>b;b+=4)s=n[b],o=n[b+1],l=n[b+2],v=f[s]*u+O,y=d[o]*h+z,C=m[l]*c+x,n[b]=~~v,n[b+1]=~~y,n[b+2]=~~C;return n}})}(e),!function(e){"use strict";var r=Math.sqrt,t=e._notSupportClamp,a=e.Array32F;e.Create({name:"PixelateFilter",scale:1,init:function(n){var e=this;e.scale=n||1},path:e.getPath(n.moduleUri),serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{scale:n.scale}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.scale=e.scale),r},apply:function(n,e,i){var s=this;if(!s._isOn||s.scale<=1)return n;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,m,g,p,_,v,y,C,b,M,w,I,O,z,x,P,k,F,Y,S,N,A,L,R,X,U,H,q,E,G,B,T,W,j,$,D,V,Q,J,K,Z=n.length,nn=Z>>>2,en=(e<<1)+e;for(o=~~(r(nn)*s.scale*.01),l=e*o,u=i%o,h=e%o,c=(u-1)*e,g=1/(o*o),p=1/(h*o),_=1/(u*o),v=1/(h*u),y=g,C=p,b=_,M=v,x=o-1,P=(o-1)*e,G=0,T=e-1,B=0,W=nn-e,w=new a(3*nn),k=0,F=0,Y=0,I=O=z=0,Y=0;e>Y;Y++,k+=4,F+=3)I+=n[k],O+=n[k+1],z+=n[k+2],w[F]=I,w[F+1]=O,w[F+2]=z;for(F=0,Y=0,I=O=z=0,k=en+e;Z>k;k+=4,F+=3,Y++)Y>=e&&(Y=0,I=O=z=0),I+=n[k],O+=n[k+1],z+=n[k+2],w[F+en]=w[F]+I,w[F+en+1]=w[F+1]+O,w[F+en+2]=w[F+2]+z;for(Y=0,S=0,N=0,U=Y,H=N,q=U+x,E=H+P,q=q>T?T:q,E=E>W?W:E,j=U+H,V=q+E,$=q+H,D=U+E,j=(j<<1)+j,$=($<<1)+$,D=(D<<1)+D,V=(V<<1)+V,m=y,Q=m*(w[V]-w[$]-w[D]+w[j]),J=m*(w[V+1]-w[$+1]-w[D+1]+w[j+1]),K=m*(w[V+2]-w[$+2]-w[D+2]+w[j+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K,A=0,L=0,R=0,k=0;Z>k;k+=4)X=A+Y+R+N<<2,n[X]=Q,n[X+1]=J,n[X+2]=K,A++,(A+Y>=e||A>=o)&&(A=0,L++,R+=e),(L+S>=i||L>=o)&&(Y+=o,Y>=e&&(Y=0,S+=o,N+=l),A=0,L=0,R=0,U=Y,H=N,q=U+x,E=H+P,q=q>T?T:q,E=E>W?W:E,j=U+H,V=q+E,$=q+H,D=U+E,j=(j<<1)+j,$=($<<1)+$,D=(D<<1)+D,V=(V<<1)+V,f=0==q-U-h+1,d=0==E-H-c,m=f&&d?M:f?C:d?b:y,Q=m*(w[V]-w[$]-w[D]+w[j]),J=m*(w[V+1]-w[$+1]-w[D+1]+w[j+1]),K=m*(w[V+2]-w[$+2]-w[D+2]+w[j+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K);return n}})}(e),!function(e){"use strict";var r=Math.sqrt,t=(Math.SQRT2,Math.min,e._notSupportClamp),a=e.Array32F;e.Create({name:"TriangularPixelateFilter",scale:1,init:function(n){var e=this;e.scale=n||1},path:e.getPath(n.moduleUri),serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{scale:n.scale}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.scale=e.scale),r},apply:function(n,e,i){var s=this;if(!s._isOn||s.scale<=1)return n;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,m,g,p,_,v,y,C,b,M,w,I,O,z,x,P,k,F,Y,S,N,A,L,R,X,U,H,q,E,G,B,T,W,j,$,D,V,Q,J,K,Z,nn,en,rn,tn,an,sn,on,ln=n.length,un=ln>>>2,hn=(e<<1)+e;for(o=~~(r(un)*s.scale*.01),l=o>>1,u=o-1,h=e*o,c=i%o,f=e%o,d=(c-1)*e,_=1/(o*o),v=1/(f*o),y=1/(c*o),C=1/(f*c),b=2*_,M=2*v,w=2*y,I=2*C,k=u,F=u*e,T=0,j=e-1,W=0,$=un-e,O=new a(3*un),Y=0,S=0,N=0,z=x=P=0,N=0;e>N;N++,Y+=4,S+=3)z+=n[Y],x+=n[Y+1],P+=n[Y+2],O[S]=z,O[S+1]=x,O[S+2]=P;for(S=0,N=0,z=x=P=0,Y=hn+e;ln>Y;Y+=4,S+=3,N++)N>=e&&(N=0,z=x=P=0),z+=n[Y],x+=n[Y+1],P+=n[Y+2],O[S+hn]=O[S]+z,O[S+hn+1]=O[S+1]+x,O[S+hn+2]=O[S+2]+P;for(N=0,A=0,L=0,q=N,E=L,G=N-l+k,B=L+F,G=G>j?j:G,B=B>$?$:B,D=q+E,J=G+B,V=G+E,Q=q+B,D=(D<<1)+D,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,p=b,en=p*(O[J]-O[V]-O[Q]+O[D]),rn=p*(O[J+1]-O[V+1]-O[Q+1]+O[D+1]),tn=p*(O[J+2]-O[V+2]-O[Q+2]+O[D+2]),q=N+l,G=N+k,G=G>j?j:G,D=q+E,J=G+B,V=G+E,Q=q+B,D=(D<<1)+D,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,an=p*(O[J]-O[V]-O[Q]+O[D]),sn=p*(O[J+1]-O[V+1]-O[Q+1]+O[D+1]),on=p*(O[J+2]-O[V+2]-O[Q+2]+O[D+2]),t&&(en=0>en?0:en>255?255:en,rn=0>rn?0:rn>255?255:rn,tn=0>tn?0:tn>255?255:tn,an=0>an?0:an>255?255:an,sn=0>sn?0:sn>255?255:sn,on=0>on?0:on>255?255:on),en=~~en,rn=~~rn,tn=~~tn,an=~~an,sn=~~sn,on=~~on,K=en,Z=rn,nn=tn,R=0,X=0,U=0,Y=0;ln>Y;Y+=4)H=R+N+U+L<<2,n[H]=K,n[H+1]=Z,n[H+2]=nn,R++,(R+N>=e||R>=o)&&(R=0,X++,U+=e,K=en,Z=rn,nn=tn),R>u-X&&(K=an,Z=sn,nn=on),(X+A>=i||X>=o)&&(N+=o,N>=e&&(N=0,A+=o,L+=h),R=0,X=0,U=0,q=N,E=L,G=N-l+k,B=L+F,G=G>j?j:G,B=B>$?$:B,D=q+E,J=G+B,V=G+E,Q=q+B,D=(D<<1)+D,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,m=0==G-q+l-f+1,g=0==B-E-d,p=m&&g?I:m?M:g?w:b,en=p*(O[J]-O[V]-O[Q]+O[D]),rn=p*(O[J+1]-O[V+1]-O[Q+1]+O[D+1]),tn=p*(O[J+2]-O[V+2]-O[Q+2]+O[D+2]),q=N+l,G=N+k,G=G>j?j:G,D=q+E,J=G+B,V=G+E,Q=q+B,D=(D<<1)+D,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,m=0==G-q+l-f+1,p=m&&g?I:m?M:g?w:b,an=p*(O[J]-O[V]-O[Q]+O[D]),sn=p*(O[J+1]-O[V+1]-O[Q+1]+O[D+1]),on=p*(O[J+2]-O[V+2]-O[Q+2]+O[D+2]),t&&(en=0>en?0:en>255?255:en,rn=0>rn?0:rn>255?255:rn,tn=0>tn?0:tn>255?255:tn,an=0>an?0:an>255?255:an,sn=0>sn?0:sn>255?255:sn,on=0>on?0:on>255?255:on),en=~~en,rn=~~rn,tn=~~tn,an=~~an,sn=~~sn,on=~~on,K=en,Z=rn,nn=tn);return n}})}(e),!function(e,r){"use strict";var t=7/16,a=3/16,i=5/16,s=1/16,o=e.Array32F,l=e.Color.clamp,u=e.Color.RGB2YCbCr,h=e.Color.YCbCr2RGB;e.Create({name:"HalftoneFilter",_threshold:.4,_size:1,_grayscale:!1,init:function(n,e,t){var a=this;a._size=n||1,a._threshold=l(r===e?.4:e,0,1),a._grayscale=!!t},path:e.getPath(n.moduleUri),size:function(n){return this._size=n,this},threshold:function(n){return this._threshold=l(n,0,1),this},grayscale:function(n){return arguments.length||(n=!0),this._grayscale=!!n,this},serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{_size:n._size,_threshold:n._threshold,_grayscale:n._grayscale}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r._size=e._size,r._threshold=e._threshold,r._grayscale=e._grayscale),r},apply:function(n,e,r){var c,f,d,m,g,p,_,v,y,C,b,M,w,I,O,z,x,P=this,k=n.length,F=k>>>2,Y=new o(3*F),S=P._size,N=S*S,A=1/N,L=255*P._threshold,R=R<<1,X=!P._grayscale,U=S*e,H=t,q=a,E=i,G=s;for(_=0,v=0,p=0;r>_;){for(M=w=I=0,y=0,C=0,b=0;S>C;)c=p+v+y+b<<2,f=3*(p+v+y+b),M+=n[c]+Y[f],w+=n[c+1]+Y[f+1],I+=n[c+2]+Y[f+2],y++,y>=S&&(y=0,C++,b+=e);if(M*=A,w*=A,I*=A,g=X?u([M,w,I]):[M,w,I],d=g[0],d>L?X?(g[0]=l(~~d,0,255),m=h(g)):m=[255,255,255]:m=[0,0,0],c=p+v<<2,O=n[c]-m[0],z=n[c+1]-m[1],x=n[c+2]-m[2],e>p+S)for(y=S,C=0,b=0;S>C;)f=3*(p+v+y+b),Y[f]+=H*O,Y[f+1]+=H*z,Y[f+2]+=H*x,y++,y>=R&&(y=S,C++,b+=e);if(r>_+S&&p>S)for(y=-S,C=S,b=0;R>C;)f=3*(p+v+y+b),Y[f]+=q*O,Y[f+1]+=q*z,Y[f+2]+=q*x,y++,y>=0&&(y=-S,C++,b+=e);if(r>_+S)for(y=0,C=S,b=0;R>C;)f=3*(p+v+y+b),Y[f]+=E*O,Y[f+1]+=E*z,Y[f+2]+=E*x,y++,y>=S&&(y=0,C++,b+=e);if(r>_+S&&e>p+S)for(y=S,C=S,b=0;R>C;)f=3*(p+v+y+b),Y[f]+=G*O,Y[f+1]+=G*z,Y[f+2]+=G*x,y++,y>=R&&(y=S,C++,b+=e);for(y=0,C=0,b=0;S>C;)c=p+v+y+b<<2,n[c]=m[0],n[c+1]=m[1],n[c+2]=m[2],y++,y>=S&&(y=0,C++,b+=e);p+=S,p>=e&&(p=0,_+=S,v+=U)}return n}})}(e),!function(e){"use strict";var r=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,s=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(n,e,r,t){var a=this;a.centerX=n||0,a.centerY=e||0,a.radius=r||10,a.amount=t||10},path:e.getPath(n.moduleUri),serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{centerX:n.centerX,centerY:n.centerY,radius:n.radius,amount:n.amount}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.centerX=e.centerX,r.centerY=e.centerY,r.radius=e.radius,r.amount=e.amount),r},apply:function(n,e,o){var l=this;if(!l._isOn)return n;var u,h,c,f,d,m,g,p,_,v,y,C,b,M,w,I,O,z,x,P,k,F,Y,S,N,A,L,R,X,U,H,q,E,G=n.length,B=l.centerX||0,T=l.centerY||0,W=l.radius,j=l.amount;if(0>=j)return n;for(u=G>>2,U=0,H=e-1,q=0,E=u-e,B=a(B*(e-1)),T=a(T*(o-1)),c=(u<<1)+u,g=(e<<1)+e,h=new s(c),p=0,_=0,v=0,f=d=m=0,v=0;e>v;v++,p+=4,_+=3)f+=n[p],d+=n[p+1],m+=n[p+2],h[_]=f,h[_+1]=d,h[_+2]=m;for(p=g+e,_=0,v=0,f=d=m=0,p=g+e;G>p;p+=4,_+=3,v++)v>=e&&(v=0,f=d=m=0),f+=n[p],d+=n[p+1],m+=n[p+2],h[_+g]=h[_]+f,h[_+g+1]=h[_+1]+d,h[_+g+2]=h[_+2]+m;for(v=0,y=0,C=0,p=0;G>p;p+=4,v++)v>=e&&(v=0,y++,C+=e),M=v-B,w=y-T,b=t(M)+t(w),I=b>W?~~r((b-W)*j):~~(b/W+.5),I>0&&(O=I*e,z=.25/(I*I),x=v-I,P=C-O,k=v+I,F=C+O,U>x?x=U:k>H&&(k=H),q>P?P=q:F>E&&(F=E),Y=x+P,A=k+F,S=k+P,N=x+F,Y=(Y<<1)+Y,S=(S<<1)+S,N=(N<<1)+N,A=(A<<1)+A,L=z*(h[A]-h[S]-h[N]+h[Y]),R=z*(h[A+1]-h[S+1]-h[N+1]+h[Y+1]),X=z*(h[A+2]-h[S+2]-h[N+2]+h[Y+2]),i&&(L=0>L?0:L>255?255:L,R=0>R?0:R>255?255:R,X=0>X?0:X>255?255:X),n[p]=~~L,n[p+1]=~~R,n[p+2]=~~X);return n}})}(e),!function(e){"use strict";e.Create({name:"SeamlessTileFilter",type:0,init:function(n){var e=this;e.type=n||0},path:e.getPath(n.moduleUri),serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{type:n.type}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.type=e.type),r},apply:function(n,r,t){var a,i,s,o,l,u,h,c,f,d,m,g,p,_,v,y=this,C=y.type;for(r!==t?n=e.Image.resize(n,r,t,g=r>t?r:t,g):g=r,p=Math.round(g/2),_=g*g,v=n.length,a=new e.ImArray(v),i=new e.ImArray(v),s=new e.Array8U(_),c=0,f=0,d=0;v>d;d+=4,c++)c>=g&&(c=0,f++),m=(c+p)%g+(f+p)%g*g<<2,a[m]=n[d],a[m+1]=n[d+1],a[m+2]=n[d+2],a[m+3]=n[d+3];for(c=0;p-1>=c;c++)for(f=0;p-1>=f;f++){switch(C){case 0:h=Math.sqrt((c-p)*(c-p)+(f-p)*(f-p))/p;break;case 1:h=p-f>p-c?(f-p)/p:(c-g/2)/p;break;case 2:default:h=p-f>p-c?Math.sqrt((f-g)*(f-g)+(c-g)*(c-g))/(1.13*g):Math.sqrt((c-g)*(c-g)+(f-g)*(f-g))/(1.13*g)}h=255-255*h,1>h?h=1:h>255&&(h=255),s[c+f*g]=h,s[c+(g-1-f)*g]=h,s[g-1-c+f*g]=h,s[g-1-c+(g-1-f)*g]=h}for(f=0;g-1>=f;f++)for(c=0;g-1>=c;c++)m=c+f*g,o=s[m],l=s[(c+p)%g+(f+p)%g*g],u=o+l,o/=u,l/=u,m<<=2,i[m]=~~(o*n[m]+l*a[m]),i[m+1]=~~(o*n[m+1]+l*a[m+1]),i[m+2]=~~(o*n[m+2]+l*a[m+2]),i[m+3]=n[m+3];return r!==t&&(i=e.Image.resize(i,g,g,r,t)),i}})}(e),!function(e){"use strict";e.Create({name:"FloodFillFilter",x:0,y:0,color:null,tolerance:0,path:e.getPath(n.moduleUri),init:function(n,e,r,t){var a=this;a.x=n||0,a.y=e||0,a.color=r||[0,0,0],a.tolerance=t||0},serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{color:n.color,x:n.x,y:n.y,tolerance:n.tolerance}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.color=e.color,r.x=e.x,r.y=e.y,r.tolerance=e.tolerance),r},apply:function(n,e,r){var t,a,i,s,o,l,u,h,c,f,d=this,m=~~(255*(d.tolerance>=1?.999:d.tolerance)),g=d.color,p=e<<2,_=d.x,v=d.y,y=n.length,C=0,b=y-p,M=0,w=e-1<<2,I=Math.abs;if(u=v*e<<2,_<<=2,M>_||_>w||C>u||u>b||n[_+u]===g[0]&&n[_+u+1]===g[1]&&n[_+u+2]===g[2])return n;for(t=[n[_+u],n[_+u+1],n[_+u+2]],h=[],u+p>=C&&b>=u+p&&h.push([u,_,_,p]),h.push([u+p,_,_,-p]);h.length;){for(c=h.pop(),u=c[0]+(p=c[3]),o=c[1],l=c[2],s=o;s>=M&&(i=s+u,I(t[0]-n[i])<=m&&I(t[1]-n[i+1])<=m&&I(t[2]-n[i+2])<=m);s-=4)n[i]=g[0],n[i+1]=g[1],n[i+2]=g[2];if(s>=o){for(;l>=s&&!(I(t[0]-n[s+u])<=m&&I(t[1]-n[s+u+1])<=m&&I(t[2]-n[s+u+2])<=m);)s+=4;a=s,f=l>=s}else a=s+4,o>a&&u-p>=C&&b>=u-p&&h.push([u,a,o-4,-p]),s=o+4,f=!0;for(;f;){for(i=s+u;w>=s&&I(t[0]-n[i])<=m&&I(t[1]-n[i+1])<=m&&I(t[2]-n[i+2])<=m;)n[i]=g[0],n[i+1]=g[1],n[i+2]=g[2],s+=4,i=s+u;for(u+p>=C&&b>=u+p&&h.push([u,a,s-4,p]),s>l+4&&u-p>=C&&b>=u-p&&h.push([u,l+4,s-4,-p]);l>=s&&!(I(t[0]-n[s+u])<=m&&I(t[1]-n[s+u+1])<=m&&I(t[2]-n[s+u+2])<=m);)s+=4;a=s,f=l>=s}}return n}})}(e),!function(e){"use strict";var r=e._notSupportClamp,t=e.Color.RGB2HSV,a=.7083333333333334;e.Create({name:"HSVConverterFilter",path:e.getPath(n.moduleUri),apply:function(n,e,i){var s=this;if(!s._isOn)return n;var o,l,u,h,c,f=n.length;if(r)for(o=0;f>o;o+=4)l=t(n.subarray(o,o+3)),u=l[0]*a,c=255*l[1],h=l[2],0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>c?c=0:c>255&&(c=255),n[o]=~~u,n[o+1]=~~h,n[o+2]=~~c;else for(o=0;f>o;o+=4)l=t(n.subarray(o,o+3)),u=l[0]*a,c=255*l[1],h=l[2],n[o]=~~u,n[o+1]=~~h,n[o+2]=~~c;return n}})}(e),!function(e){"use strict";var r=(e._notSupportClamp,e.Color.RGBA2Color),t=e.Color.Color2RGBA;e.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(n,e){var r=this;r.thresholds=n,r.quantizedColors=e||null},path:e.getPath(n.moduleUri),serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{thresholds:n.thresholds,quantizedColors:n.quantizedColors}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.thresholds=e.thresholds,r.quantizedColors=e.quantizedColors),r},apply:function(n,e,a){var i=this;if(!(i._isOn&&i.thresholds&&i.thresholds.length&&i.quantizedColors&&i.quantizedColors.length))return n;var s,o,l,u,h=n.length,c=i.thresholds,f=c.length,d=i.quantizedColors,m=d.length;for(l=0;h>l;l+=4){for(s=r(n.subarray[l+4]),u=0;f>u&&s>c[u];)u++;s=m>u?d[u]:255,o=t(s),n[l]=o[0],n[l+1]=o[1],n[l+2]=o[2],n[l+3]=o[3]}return n}})}(e),!function(e){"use strict";var r=(e._notSupportClamp,e.ImArray,e.Color.clampPixel),t=e.Color.RGB2HSV,a=(e.Color.HSV2RGB,e.Color.Color2RGBA);e.Create({name:"HueExtractorFilter",range:null,background:0,init:function(n,e){var r=this;r.range=n,r.background=e||0},path:e.getPath(n.moduleUri),serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{range:n.range,background:n.background}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.range=e.range,r.background=e.background),r},apply:function(n,e,i){var s=this;if(!s._isOn||!s.range||!s.range.length)return n;var o,l,u,h,c,f,d,m=n.length,g=s.range[0],p=s.range[s.range.length-1];for(f=a(s.background||0),o=~~r(f[0]),l=~~r(f[1]),u=~~r(f[2]),h=~~r(f[3]),c=0;m>c;c+=4)d=t(n.subarray(c,c+3))[0],(g>d||d>p)&&(n[c]=o,n[c+1]=l,n[c+2]=u,n[c+3]=h);return n}})}(e),!function(e){"use strict";function r(n,e,r,t,a,i){var s,o,h,v,y,C=n.length,b=new u(C),M=new u(C),w=new u(C),I=new u(C),O=new u(i),z=new u(i),x=a*a,P=2*x,k=g*x;for(s=0;i>s&&(o=_(-(s*s)/P),!(c>=o&&s>=2));s++)h=_(-((y=s-.5)*y)/P),v=_(-((y=s+.5)*y)/P),O[s]=(o+h+v)/3/k,z[s]=v-h;var y,F,Y,S,N,A,L,R,X,U=s-1,H=e-(s-1),q=e*(s-1),E=e*(r-(s-1));for(y=U;H>y;y++)for(F=q;E>F;F+=e){for(Y=y+F,S=n[Y]*O[0],N=S,A=1,L=e;s>A;)N+=O[A]*(n[Y-L]+n[Y+L]),S+=O[A]*(n[Y-A]+n[Y+A]),L+=e,A++;M[Y]=N,b[Y]=S}for(y=U;H>y;y++)for(F=q;E>F;F+=e){for(R=0,Y=y+F,X=1;s>X;X++)R+=z[X]*(M[Y-X]-M[Y+X]);w[Y]=R}for(y=s;e-s>y;y++)for(F=q;E>F;F+=e){for(R=0,Y=y+F,L=e,X=1;s>X;X++)R+=z[X]*(b[Y-L]-b[Y+L]),L+=e;I[Y]=R}U=s,H=e-s,q=e*s,E=e*(r-s);var G,B,T,W,j,$,D,V,Q,J,K,Z,nn,en,rn,tn,an,sn,on,ln;for(y=U;H>y;y++)for(F=q;E>F;F+=e)Y=y+F,G=Y-e,B=Y+e,W=Y-1,T=Y+1,j=G-1,$=G+1,D=B-1,V=B+1,Q=w[Y],J=I[Y],K=l(Q,J),nn=l(w[G],I[G]),en=l(w[B],I[B]),tn=l(w[W],I[W]),rn=l(w[T],I[T]),sn=l(w[$],I[$]),ln=l(w[V],I[V]),on=l(w[D],I[D]),an=l(w[j],I[j]),(0>=Q*J?p(Q)>=p(J)?(Z=p(Q*K))>=p(J*sn-(Q+J)*rn)&&Z>p(J*on-(Q+J)*tn):(Z=p(J*K))>=p(Q*sn-(J+Q)*nn)&&Z>p(Q*on-(J+Q)*en):p(Q)>=Math.abs(J)?(Z=p(Q*K))>=p(J*ln+(Q-J)*rn)&&Z>p(J*an+(Q-J)*tn):(Z=p(J*K))>=p(Q*ln+(J-Q)*en)&&Z>p(Q*an+(J-Q)*nn))?t[Y]=K>=d?m:Math.floor(f*K):t[Y]=0}function t(n,e,r,t,i,s){var o,l,u,h=0,c=n.length;for(o=0;c>o;o++)n[o]=0;for(u=0,l=0,h=0;c>h;h++,u++)u>=e&&(u=0,l++),0===n[h]&&t[h]>=s&&a(n,e,r,t,u,l,h,i)}function a(n,e,r,t,i,s,o,l){var u,h,c,f=0==i?i:i-1,d=i==e-1?i:i+1,m=0==s?s:s-1,g=s==r-1?s:s+1;for(n[o]=t[o],u=f,h=m;d>=u&&g>=h;){if(c=u+h*e,(h!=s||u!=i)&&0===n[c]&&t[c]>=l)return void a(n,e,r,t,u,h,c,l);h++,h>g&&(h=m,u++)}}function i(n,r){var t,a,i,s,o,l=n.length,u=e.LUMA[0],h=e.LUMA[1],c=e.LUMA[2];for(t=0,a=0;l>t;t+=4,a++)i=n[t],s=n[t+1],o=n[t+2],r[a]=~~(u*i+h*s+c*o+.5)}function s(n){var e,r,t,a,i,s=new h(256),o=new h(256),l=n.length;for(e=0;l>e;e++)s[n[e]]++;for(r=0,t=0,e=0;256>e;e++){for(r+=s[e],i=255*r/l,a=t+1;i>=a;a++)o[a]=e;t=i}for(e=0;l>e;e++)n[e]=o[n[e]]}function o(n,e){var r,t,a,i=n.length;for(r=0,t=0;i>r;r+=4,t++)a=e[t]>0?255:0,n[r]=n[r+1]=n[r+2]=a}var l,u=e.Array32F,h=e.Array32I,c=.005,f=100,d=1e3,m=f*d,g=e.CONST.PI2,p=Math.abs,_=Math.exp;l=Math.hypot?Math.hypot:function(n,e){return p(n)+p(e)},e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:e.getPath(n.moduleUri),init:function(n,e,r,t,a){var i=this;i.low=arguments.length<1?2.5:n,i.high=arguments.length<2?7.5:e,i.gaussRadius=arguments.length<3?2:r,i.gaussWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},thresholds:function(n,e){var r=this;return r.low=n,r.high=e,r},kernel:function(n,e){var r=this;return r.gaussRadius=n,r.gaussWidth=e,r},serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{low:n.low,high:n.high,gaussRadius:n.gaussRadius,gaussWidth:n.gaussWidth,contrastNormalized:n.contrastNormalized}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.low=e.low,r.high=e.high,r.gaussRadius=e.gaussRadius,r.gaussWidth=e.gaussWidth,r.contrastNormalized=e.contrastNormalized),r},apply:function(n,e,a){var l,u,c,d,m=this,g=n.length>>2;return c=new h(g),d=new h(g),l=Math.round(m.low*f),u=Math.round(m.high*f),i(n,c),m.contrastNormalized&&s(c),r(c,e,a,d,m.gaussRadius,m.gaussWidth),t(c,e,a,d,l,u),o(n,c),n}})}(e),!function(e,r){"use strict";function t(n,e,r,t,a,i,s){var o,l,u,h,c,f,d,m=n.length;for(h=0,u=0,o=l=0;e>h;)d=4899*n[u]+9617*n[u+1]+1868*n[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[h]=d,a[h]=o,i[h]=l,s[h]=d,h++,u+=4;for(c=0,f=1,h=e,u=e<<2,o=l=0;m>u;)d=4899*n[u]+9617*n[u+1]+1868*n[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[h]=d,a[h]=a[h-e]+o,i[h]=i[h-e]+l,s[h]=s[h+1-e]+(d+t[h-e])+(f>1?s[h-e-e]:0)+(c>0?s[h-1-e]:0),c++,h++,u+=4,c>=e&&(c=0,f++,o=l=0)}function a(n,e,r,t){var a,i,s,o,l,u,h,c,m,g,p,_=n.length,v=new f(_);for(a=0;e>a;a++)v[a]=0,v[a+e]=0,v[a+_-e]=0,v[a+_-e-e]=0,t[a]=0,t[a+_-e]=0;for(i=0,s=0;r>i;i++,s+=e)v[0+s]=0,v[1+s]=0,v[e-1+s]=0,v[e-2+s]=0,t[0+s]=0,t[e-1+s]=0;for(a=2;e-2>a;a++)for(o=0,i=2,s=e<<1;r-2>i;i++,s+=e)h=a+s,c=h+e,m=c+e,g=h-e,p=g-e,o=0+(n[p-2]<<1)+(n[g-2]<<2)+(n[h-2]<<2)+n[h-2]+(n[c-2]<<2)+(n[m-2]<<1)+(n[p-1]<<2)+(n[g-1]<<3)+n[g-1]+(n[h-1]<<4)-(n[h-1]<<2)+(n[c-1]<<3)+n[c-1]+(n[m-1]<<2)+(n[p]<<2)+n[p]+(n[g]<<4)-(n[g]<<2)+(n[h]<<4)-n[h]+(n[c]<<4)-(n[c]<<2)+(n[m]<<2)+n[m]+(n[p+1]<<2)+(n[g+1]<<3)+n[g+1]+(n[h+1]<<4)-(n[h+1]<<2)+(n[c+1]<<3)+n[c+1]+(n[m+1]<<2)+(n[p+2]<<1)+(n[g+2]<<2)+(n[h+2]<<2)+n[h+2]+(n[c+2]<<2)+(n[m+2]<<1),v[h]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1;e-1>a;a++)for(i=1,s=e;r-1>i;i++,s+=e)h=s+a,c=h+e,g=h-e,l=0-v[g-1]+v[g+1]-v[h-1]-v[h-1]+v[h+1]+v[h+1]-v[c-1]+v[c+1],u=0+v[g-1]+v[g]+v[g]+v[g+1]-v[c-1]-v[c]-v[c]-v[c+1],t[h]=d(l)+d(u);for(a=0,o=0;e>a;)o+=t[a],t[a]=o,a++;for(a=e,s=0,o=0;_>a;)o+=t[a],t[a]=t[a-e]+o,a++,s++,s>=e&&(s=0,o=0);return t}function i(n,e){var r=.2*m(e.width,n.width),t=.2*m(e.height,n.height);return!!(d(n.x-e.x)<=r&&d(n.y-e.y)<=t&&d(n.width-e.width)<=r&&d(n.height-e.height)<=t)}function s(n,e){n.x+=e.x,n.y+=e.y,n.width+=e.width,n.height+=e.height}function o(n,e){return!!(n.x>=e.x&&n.y>=e.y&&n.x+n.width<=e.x+e.width&&n.y+n.height<=e.y+e.height)}function l(n){n.x=~~(n.x+.5),n.y=~~(n.y+.5),n.width=~~(n.width+.5),n.height=~~(n.height+.5)}function u(n,e){return e.area-n.area}function h(n,e){var r,t,a,h,c,f,d,m=n.length,g=new Array(m),p=[],_=0,v=!1;for(a=0;m>a;a++)g[a]=0;for(a=0;m>a;a++){for(v=!1,h=0;a>h;h++)i(n[h],n[a])&&(v=!0,g[a]=g[h]);v||(g[a]=_,_++)}for(r=new Array(_),t=new Array(_),a=0;_>a;a++)r[a]=0,t[a]={x:0,y:0,width:0,height:0};for(a=0;m>a;a++)d=g[a],r[d]++,s(t[d],n[a]);for(a=0;_>a;a++)c=r[a],c>=e&&(f=1/(c+c),d={x:f*(2*t[a].x+c),y:f*(2*t[a].y+c),width:f*(2*t[a].width+c),height:f*(2*t[a].height+c)},p.push(d));for(m=p.length,a=0;m>a;a++)for(h=a+1;m>h;h++)!p[a].inside&&o(p[a],p[h])?p[a].inside=!0:!p[h].inside&&o(p[h],p[a])&&(p[h].inside=!0);for(a=m;--a>=0;)p[a].inside?p.splice(a,1):(l(p[a]),p[a].area=p[a].width*p[a].height);return p.sort(u)}var c=e.Array32F,f=e.Array8U,d=Math.abs,m=Math.max,g=Math.min,p=(Math.floor,Math.round,Math.sqrt),_="hasOwnProperty";e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,init:function(n,e,t,a,i,s){var o=this;o.objects=null,o.haardata=n||null,o.baseScale=r===e?1:e,o.scaleIncrement=r===t?1.25:t,o.stepIncrement=r===a?.5:a,o.minNeighbors=r===i?1:i,o.doCannyPruning=r===s?!0:!!s},path:e.getPath(n.moduleUri),dispose:function(){var n=this;return n.objects=null,n.haardata=null,n.$super("dispose"),n},haar:function(n){var e=this;return e.haardata=n,e},params:function(n){var e=this;return n&&(n[_]("haardata")&&(e.haardata=n.haardata),n[_]("baseScale")&&(e.baseScale=n.baseScale),n[_]("scaleIncrement")&&(e.scaleIncrement=n.scaleIncrement),n[_]("stepIncrement")&&(e.stepIncrement=n.stepIncrement),n[_]("minNeighbors")&&(e.minNeighbors=n.minNeighbors),n[_]("doCannyPruning")&&(e.doCannyPruning=n.doCannyPruning),n[_]("cannyLow")&&(e.cannyLow=n.cannyLow),n[_]("cannyHigh")&&(e.cannyHigh=n.cannyHigh)),e},serialize:function(){var n=this,e={filter:n.name,_isOn:!!n._isOn,params:{haardata:n.haardata,baseScale:n.baseScale,scaleIncrement:n.scaleIncrement,stepIncrement:n.stepIncrement,minNeighbors:n.minNeighbors,doCannyPruning:n.doCannyPruning,cannyLow:n.cannyLow,cannyHigh:n.cannyHigh}};return e},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.haardata=e.haardata,r.baseScale=e.baseScale,r.scaleIncrement=e.scaleIncrement,r.stepIncrement=e.stepIncrement,r.minNeighbors=e.minNeighbors,r.doCannyPruning=e.doCannyPruning,r.cannyLow=e.cannyLow,r.cannyHigh=e.cannyHigh),r},getMeta:function(){return this.objects},setMeta:function(n){return this.objects=n,this},apply:function(n,e,r){var i,s,o,l,u,d,m,_,v,y,C,b,M,w,I,O,z,x,P,k,F,Y,S,N,A,L,R,X,U,H,q,E,G,B,T,W,j,$,D,N,V,Q,J,K,Z,nn,en,rn,tn,an,sn,on,ln,un,hn,cn,fn,dn,mn,gn=this,pn=n.length>>>2,_n=gn.haardata,vn=_n.stages,yn=gn.baseScale,Cn=gn.scaleIncrement,bn=gn.stepIncrement,Mn=gn.minNeighbors,wn=gn.doCannyPruning,In=gn.cannyLow,On=gn.cannyHigh,zn=_n.size1,xn=_n.size2,Pn=g(e/zn,r/xn),kn=[],Fn=pn-1,Yn=0,Sn=0,Nn=vn.length;for(t(n,e,r,s=new f(pn),o=new c(pn),l=new c(pn),u=new c(pn)),wn&&a(s,e,r,d=new c(pn)),A=0,L=e-1,R=0,X=pn-e,i=yn;Pn>=i;){for(v=~~(i*zn),m=~~(v*bn),y=~~(i*xn),_=~~(y*bn),I=y*e,O=_*e,C=Sn*O,F=e-v,Y=r-y,U=v*y,H=1/U,M=Sn,w=C;Y>M;M+=_,w+=O)for(b=Yn;F>b;b+=m)if(z=b-1+w-e,x=z+v,P=z+I,k=P+v,z=0>z?0:z>Fn?Fn:z,x=0>x?0:x>Fn?Fn:x,P=0>P?0:P>Fn?Fn:P,k=0>k?0:k>Fn?Fn:k,!(wn&&(B=H*(d[k]-d[P]-d[x]+d[z]),In>B||B>On))){for(q=H*(o[k]-o[P]-o[x]+o[z]),E=H*(l[k]-l[P]-l[x]+l[z]),G=E-q*q,G=G>1?p(G):1,T=!0,S=0;Nn>S;S++){for(W=vn[S],j=W.thres,$=W.trees,D=$.length,mn=0,N=0;D>N;N++)for(J=$[N].feats,V=0;;){if(K=J[V],Z=K.rects,nn=Z.length,en=K.thres,rn=0,K.tilt)for(tn=0;nn>tn;tn++)an=Z[tn],sn=b+~~(i*an[0]),on=(M-1+~~(i*an[1]))*e,ln=b+~~(i*(an[0]+an[2])),un=(M-1+~~(i*(an[1]+an[2])))*e,hn=b+~~(i*(an[0]-an[3])),cn=(M-1+~~(i*(an[1]+an[3])))*e,fn=b+~~(i*(an[0]+an[2]-an[3])),dn=(M-1+~~(i*(an[1]+an[2]+an[3])))*e,sn=A>sn?A:sn>L?L:sn,ln=A>ln?A:ln>L?L:ln,hn=A>hn?A:hn>L?L:hn,fn=A>fn?A:fn>L?L:fn,on=R>on?R:on>X?X:on,un=R>un?R:un>X?X:un,cn=R>cn?R:cn>X?X:cn,dn=R>dn?R:dn>X?X:dn,rn+=an[4]*(u[fn+dn]-u[hn+cn]-u[ln+un]+u[sn+on]);else for(tn=0;nn>tn;tn++)an=Z[tn],sn=b-1+~~(i*an[0]),ln=b-1+~~(i*(an[0]+an[2])),on=e*(M-1+~~(i*an[1])),un=e*(M-1+~~(i*(an[1]+an[3]))),sn=A>sn?A:sn>L?L:sn,ln=A>ln?A:ln>L?L:ln,on=R>on?R:on>X?X:on,un=R>un?R:un>X?X:un,rn+=an[4]*(o[ln+un]-o[sn+un]-o[ln+on]+o[sn+on]);if(Q=en*G>rn*H?0:1){if(K.has_r){mn+=K.r_val;break}V=K.r_node}else{if(K.has_l){mn+=K.l_val;break}V=K.l_node}}if(T=mn>j,!T)break}T&&kn.push({x:b,y:M,width:v,height:y})}i*=Cn}return gn.objects=h(kn,Mn),n}})}(e),!function(e){"use strict";var r=(e._notSupportClamp,Math.min),t=Math.floor,a=e.CHANNEL.RED;e.CHANNEL.GREEN,e.CHANNEL.BLUE,e.CHANNEL.ALPHA;e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,path:e.getPath(n.moduleUri),init:function(n,e,r,t,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=e||a,s.dstChannel=r||a,s.centerX=t||0,s.centerY=i||0,n&&s.setSrc(n)},dispose:function(){var n=this;return n.srcImg=null,n._srcImg=null,n.$super("dispose"),n},setSrc:function(n){var e=this;return n?(e.srcImg=n,e._srcImg={data:n.getData(),width:n.width,height:n.height}):(e.srcImg=null,e._srcImg=null),e},serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{_srcImg:n._srcImg,centerX:n.centerX,centerY:n.centerY,srcChannel:n.srcChannel,dstChannel:n.dstChannel}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r._srcImg=e._srcImg,r.centerX=e.centerX,r.centerY=e.centerY,r.srcChannel=e.srcChannel,r.dstChannel=e.dstChannel),r},apply:function(n,e,a){var i=this;if(!i._isOn||!i._srcImg)return n;var s,o,l,u,h,c,f=i._srcImg.data,d=n.length,m=(f.length,i._srcImg.width),g=i._srcImg.height,p=i.srcChannel,_=i.dstChannel,v=r(e,m),y=r(a,g),C=i.centerX||0,b=i.centerY||0,M=m>>1,w=g>>1;for(C=t(C*(e-1))-M,b=t(b*(a-1))-w,s=0,o=0,l=0,s=0;d>s;s+=4,o++)o>=e&&(o=0,l++),h=o-C,c=l-b,h>=0&&v>h&&c>=0&&y>c&&(u=h+c*m<<2,n[s+_]=f[u+p]);return n}})}(e),!function(e){"use strict";var r=(e._notSupportClamp,Math.min),t=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,path:e.getPath(n.moduleUri),init:function(n,e,r){var t=this;t.centerX=e||0,t.centerY=r||0,t._alphaMask=null,t.alphaMask=null,n&&t.setMask(n)},dispose:function(){var n=this;return n.alphaMask=null,n._alphaMask=null,n.$super("dispose"),n},setMask:function(n){var e=this;return n?(e.alphaMask=n,e._alphaMask={data:n.getData(),width:n.width,height:n.height}):(e.alphaMask=null,e._alphaMask=null),e},serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{_alphaMask:n._alphaMask,centerX:n.centerX,centerY:n.centerY}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r._alphaMask=e._alphaMask,r.centerX=e.centerX,r.centerY=e.centerY),r},apply:function(n,e,a){var i=this;if(!i._isOn||!i._alphaMask)return n;var s,o,l,u,h,c,f=i._alphaMask.data,d=i._alphaMask.width,m=i._alphaMask.height,g=n.length,p=(f.length,r(e,d)),_=r(a,m),v=i.centerX||0,y=i.centerY||0,C=d>>1,b=m>>1;for(v=t(v*(e-1))-C,y=t(y*(a-1))-b,o=0,l=0,s=0;g>s;s+=4,o++)o>=e&&(o=0,l++),h=o-v,c=l-y,h>=0&&p>h&&c>=0&&_>c?(u=h+c*d<<2,n[s+3]=f[u+3]):n[s+3]=0;return n}})}(e),!function(e,r){"use strict";var t,a="hasOwnProperty",i=Math.min,s=Math.max,o=Math.round,l=(Math.floor,Math.abs),u=e._notSupportClamp;t={normal:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=d,i=m,s=g,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},lighten:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=h>d?h:d,i=c>m?c:m,s=f>g?f:g,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},darken:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=h>d?d:h,i=c>m?m:c,s=f>g?g:f,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},multiply:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=h*d*.003921568627451,i=c*m*.003921568627451,s=f*g*.003921568627451,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},average:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=.5*(h+d),i=.5*(c+m),s=.5*(f+g),h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},add:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=h+d,i=c+m,s=f+g,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},subtract:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=255>h+d?0:h+d-255,i=255>c+m?0:c+m-255,s=255>f+g?0:f+g-255,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),
n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},difference:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],h=1-o,c=n[e],f=n[e+1],d=n[e+2],m=r[t],g=r[t+1],p=r[t+2];a=l(m-c),i=l(g-f),s=l(p-d),c=a*o+c*h,f=i*o+f*h,d=s*o+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),n[e]=~~c,n[e+1]=~~f,n[e+2]=~~d},negation:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],h=1-o,c=n[e],f=n[e+1],d=n[e+2],m=r[t],g=r[t+1],p=r[t+2];a=255-l(255-m-c),i=255-l(255-g-f),s=255-l(255-p-d),c=a*o+c*h,f=i*o+f*h,d=s*o+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),n[e]=~~c,n[e+1]=~~f,n[e+2]=~~d},screen:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=255-((255-d)*(255-h)>>8),i=255-((255-m)*(255-c)>>8),s=255-((255-g)*(255-f)>>8),h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},exclusion:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=d+h-2*d*h*.003921568627451,i=m+c-2*m*c*.003921568627451,s=g+f-2*g*f*.003921568627451,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},overlay:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=128>h?2*d*h*.003921568627451:255-2*(255-d)*(255-h)*.003921568627451,i=128>c?2*m*c*.003921568627451:255-2*(255-m)*(255-c)*.003921568627451,a=128>f?2*g*f*.003921568627451:255-2*(255-g)*(255-f)*.003921568627451,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},softlight:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=128>h?2*((d>>1)+64)*(.003921568627451*h):255-2*(255-((d>>1)+64))*(255-h)*.003921568627451,i=128>c?2*((m>>1)+64)*(.003921568627451*c):255-2*(255-((m>>1)+64))*(255-c)*.003921568627451,s=128>f?2*((g>>1)+64)*(.003921568627451*f):255-2*(255-((g>>1)+64))*(255-f)*.003921568627451,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},hardlight:function(n,e,r,t){var a,i,s,o=.003921568627451*r[t+3],l=1-o,h=n[e],c=n[e+1],f=n[e+2],d=r[t],m=r[t+1],g=r[t+2];a=128>d?2*h*d*.003921568627451:255-2*(255-h)*(255-d)*.003921568627451,i=128>m?2*c*m*.003921568627451:255-2*(255-c)*(255-m)*.003921568627451,s=128>g?2*f*g*.003921568627451:255-2*(255-f)*(255-g)*.003921568627451,h=a*o+h*l,c=i*o+c*l,f=s*o+f*l,u&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),n[e]=~~h,n[e+1]=~~c,n[e+2]=~~f},colordodge:function(n,e,r,t){var a,s,o,l=.003921568627451*r[t+3],h=1-l,c=n[e],f=n[e+1],d=n[e+2],m=r[t],g=r[t+1],p=r[t+2];a=255==c?c:i(255,(m<<8)/(255-c)),s=255==f?f:i(255,(g<<8)/(255-f)),o=255==d?c:i(255,(p<<8)/(255-d)),c=a*l+c*h,f=s*l+f*h,d=o*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),n[e]=~~c,n[e+1]=~~f,n[e+2]=~~d},colorburn:function(n,e,r,t){var a,i,o,l=.003921568627451*r[t+3],h=1-l,c=n[e],f=n[e+1],d=n[e+2],m=r[t],g=r[t+1],p=r[t+2];a=0==c?c:s(0,255-(255-m<<8)/c),i=0==f?f:s(0,255-(255-g<<8)/f),o=0==d?d:s(0,255-(255-p<<8)/d),c=a*l+c*h,f=i*l+f*h,d=o*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),n[e]=~~c,n[e+1]=~~f,n[e+2]=~~d},linearlight:function(n,e,r,t){var a,i,s,o,l=.003921568627451*r[t+3],h=1-l,c=n[e],f=n[e+1],d=n[e+2],m=r[t],g=r[t+1],p=r[t+2];128>c?(o=2*c,a=255>o+m?0:o+m-255):(o=2*(c-128),a=o+m),128>f?(o=2*f,i=255>o+g?0:o+g-255):(o=2*(f-128),i=o+g),128>d?(o=2*d,s=255>o+p?0:o+p-255):(o=2*(d-128),s=o+p),c=a*l+c*h,f=i*l+f*h,d=s*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),n[e]=~~c,n[e+1]=~~f,n[e+2]=~~d},reflect:function(n,e,r,t){var a,s,o,l=.003921568627451*r[t+3],h=1-l,c=n[e],f=n[e+1],d=n[e+2],m=r[t],g=r[t+1],p=r[t+2];a=255==c?c:i(255,m*m/(255-c)),s=255==f?f:i(255,g*g/(255-f)),o=255==d?d:i(255,p*p/(255-d)),c=a*l+c*h,f=s*l+f*h,d=o*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),n[e]=~~c,n[e+1]=~~f,n[e+2]=~~d},glow:function(n,e,r,t){var a,s,o,l=.003921568627451*r[t+3],h=1-l,c=n[e],f=n[e+1],d=n[e+2],m=r[t],g=r[t+1],p=r[t+2];a=255==m?m:i(255,c*c/(255-m)),s=255==g?g:i(255,f*f/(255-g)),o=255==p?p:i(255,d*d/(255-p)),c=a*l+c*h,f=s*l+f*h,d=o*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),n[e]=~~c,n[e+1]=~~f,n[e+2]=~~d},phoenix:function(n,e,r,t){var a,o,l,h=.003921568627451*r[t+3],c=1-h,f=n[e],d=n[e+1],m=n[e+2],g=r[t],p=r[t+1],_=r[t+2];a=i(g,f)-s(g,f)+255,o=i(p,d)-s(p,d)+255,l=i(_,m)-s(_,m)+255,f=a*h+f*c,d=o*h+d*c,m=l*h+m*c,u&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m),n[e]=~~f,n[e+1]=~~d,n[e+2]=~~m},vividlight:function(n,e,r,t){var a,o,l,h,c=.003921568627451*r[t+3],f=1-c,d=n[e],m=n[e+1],g=n[e+2],p=r[t],_=r[t+1],v=r[t+2];128>d?(h=2*d,a=0==h?h:s(0,255-(255-p<<8)/h)):(h=2*(d-128),a=255==h?h:i(255,(p<<8)/(255-h))),128>m?(h=2*m,o=0==h?h:s(0,255-(255-_<<8)/h)):(h=2*(m-128),o=255==h?h:i(255,(_<<8)/(255-h))),128>g?(h=2*g,l=0==h?h:s(0,255-(255-v<<8)/h)):(h=2*(m-128),l=255==h?h:i(255,(v<<8)/(255-h))),d=a*c+d*f,m=o*c+m*f,g=l*c+g*f,u&&(d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,g=0>g?0:g>255?255:g),n[e]=~~d,n[e+1]=~~m,n[e+2]=~~g},pinlight:function(n,e,r,t){var a,i,s,o,l=.003921568627451*r[t+3],h=1-l,c=n[e],f=n[e+1],d=n[e+2],m=r[t],g=r[t+1],p=r[t+2];128>c?(o=2*c,a=o>m?o:m):(o=2*(c-128),a=o>m?m:o),128>f?(o=2*f,i=o>g?o:g):(o=2*(c-128),i=o>g?g:o),128>d?(o=2*d,s=o>p?o:p):(o=2*(d-128),s=o>p?p:o),c=a*l+c*h,f=i*l+f*h,d=s*l+d*h,u&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),n[e]=~~c,n[e+1]=~~f,n[e+2]=~~d},hardmix:function(n,e,r,t){var a,o,l,h,c=.003921568627451*r[t+3],f=1-c,d=n[e],m=n[e+1],g=n[e+2],p=r[t],_=r[t+1],v=r[t+2];128>d?(h=2*d,a=0==h?h:s(0,255-(255-p<<8)/h)):(h=2*(d-128),a=255==h?h:i(255,(p<<8)/(255-h))),a=128>a?0:255,128>m?(h=2*m,o=0==h?h:s(0,255-(255-_<<8)/h)):(h=2*(m-128),o=255==h?h:i(255,(_<<8)/(255-h))),o=128>o?0:255,128>g?(h=2*g,l=0==h?h:s(0,255-(255-v<<8)/h)):(h=2*(g-128),l=255==h?h:i(255,(v<<8)/(255-h))),l=128>l?0:255,d=a*c+d*f,m=o*c+m*f,g=l*c+g*f,u&&(d=0>d?0:d>255?255:d,m=0>m?0:m>255?255:m,g=0>g?0:g>255?255:g),n[e]=~~d,n[e+1]=~~m,n[e+2]=~~g}},t.lineardodge=t.add,t.linearburn=t.subtract,e.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendImage:null,startX:0,startY:0,path:e.getPath(n.moduleUri),init:function(n,e){var r=this;r.startX=0,r.startY=0,r._blendImage=null,r.blendImage=null,r._blendMode=null,n&&r.setImage(n),e&&r.setMode(e)},dispose:function(){var n=this;return n.blendImage=null,n._blendImage=null,n._blendMode=null,n.$super("dispose"),n},setImage:function(n){var e=this;return n?(e.blendImage=n,e._blendImage={data:n.getData(),width:n.width,height:n.height}):(e.blendImage=null,e._blendImage=null),e},setMode:function(n){var e=this;return n?(e._blendMode=(""+n).toLowerCase(),t[a](e._blendMode)||(e._blendMode=null)):e._blendMode=null,e},serialize:function(){var n=this;return{filter:n.name,_isOn:!!n._isOn,params:{_blendImage:n._blendImage,_blendMode:n._blendMode,startX:n.startX,startY:n.startY}}},unserialize:function(n){var e,r=this;return n&&r.name===n.filter&&(r._isOn=!!n._isOn,e=n.params,r.startX=e.startX,r.startY=e.startY,r._blendImage=e._blendImage,r.setMode(e._blendMode)),r},reset:function(){var n=this;return n.startX=0,n.startY=0,n._blendMode=null,n},apply:function(n,e,r){var a=this;if(!a._isOn||!a._blendMode||!a._blendImage)return n;var s,l,u,h,c,f,d,m,g,p,_,v,y,C,b=a.startX||0,M=a.startY||0,w=0,I=0,O=a._blendImage,z=t[a._blendMode];if(0>b&&(w=-b,b=0),0>M&&(I=-M,M=0),h=O.width,c=O.height,b>=e||M>=r)return n;if(w>=h||I>=c)return n;if(b=o(b),M=o(M),w=o(w),I=o(I),s=i(e-b,h-w),l=i(r-M,c-I),0>=s||0>=l)return n;for(u=O.data,p=b,_=M*e,v=w,y=I*h,f=b+s,d=w+s,m=0,g=l*s;g>m;)C=v+y<<2,u[C+3]&&z(n,p+_<<2,u,C),m++,p++,p>=f&&(p=b,_+=e),v++,v>=d&&(v=w,y+=h);return n}})}(e),e});

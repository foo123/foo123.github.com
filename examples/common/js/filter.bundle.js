/**
*
*   Classy.js
*   @version: 0.5.5
*
*   Object-Oriented mini-framework for JavaScript
*   https://github.com/foo123/classy.js
*
**/!function(e,t,n,r,o){var i="undefined"!=typeof global&&"[object global]"=={}.toString.call(global)?1:0,l=i||"undefined"==typeof navigator?0:1,a="function"==typeof importScripts&&navigator instanceof WorkerNavigator?1:0,u=Array,c=u.prototype,f=function(){var e=null;if(i)return e=__filename,{path:__dirname,file:__filename};if(a)e=self.location.href;else if(l){var t;(t=document.getElementsByTagName("script"))&&t.length&&(e=t[t.length-1].src)}return e?{path:e.split("/").slice(0,-1).join("/"),file:e}:{path:null,file:null}},s=f(),p=function(e,t){if(i)return t;if("."==t.charAt(0)){e=e.split("/"),t=t.split("/");var n,r=0,o=0,l=t.length,a=e.length;for(n=0;l>n;n++)if(/^\.\./.test(t[n]))r++,o++;else{if(!/^\./.test(t[n]))break;o++}r=r>=a?0:a-r,t=e.slice(0,r).concat(t.slice(o)).join("/")}return t};n=n?[].concat(n):[];var b,d,y,g=n.length,v=new u(g),m=new u(g),h=new u(g),w=new u(g);for(b=0;g>b;b++)v[b]=n[b][0],m[b]=n[b][1],h[b]=/\.js$/i.test(m[b])?p(s.path,m[b]):p(s.path,m[b]+".js");if("object"==typeof module&&module.exports){if(o===module.exports[t]){for(b=0;g>b;b++)w[b]=module.exports[v[b]]||require(h[b])[v[b]];d=r.apply(e,w),module.exports[t]=d||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(m),function(n){if(o===n[t]){for(var i=c.slice.call(arguments,1),l=i.length,a=0;l>a;a++)w[a]=n[v[a]]||i[a];d=r.apply(e,w),n[t]=d||1}});else if(a){for(b=0;g>b;b++)self[v[b]]||importScripts(h[b]),w[b]=self[v[b]];d=r.apply(e,w),self[t]=d||1}else if(o===e[t]){var j=function(e,t){y=y||document.getElementsByTagName("head")[0];var n=0,r=document.createElement("script");r.type="text/javascript",r.language="javascript",r.src=e,r.onload=r.onreadystatechange=function(){n||r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(n=1,r.onload=r.onreadystatechange=null,y.removeChild(r),r=null,t&&t())},y.appendChild(r)},E=function(t,n,r){e[t]?r():j(n,r)},x=function(n){return function(){g>n&&(w[n]=e[v[n]]),++n<g?E(v[n],h[n],x(n)):(d=r.apply(e,w),e[t]=d||1)}};g?E(v[0],h[0],x(0)):(d=r.apply(e,w),e[t]=d||1)}}(this,"Classy",null,function(){var e={};return function(e,t){var n=function(e,t,n){this.v=e||null,this.prev=t||null,this.next=n||null};n.prototype={constructor:n,v:null,prev:null,next:null};var r=Array.prototype,o=Object.prototype,i=Function.prototype,l=i.call.bind(r.slice),a=i.call.bind(o.toString),u=i.call.bind(o.hasOwnProperty),c=i.call.bind(o.propertyIsEnumerable),f=Object.keys,s=Object.defineProperty,p=2,b=3,d=4,y=8,g=9,v=16,m=32,h=64,w=128,j=256,E=512,x=1024,_=function(e){var t=typeof e,n=a(e);return"undefined"===t?E:"number"===t||e instanceof Number?isNaN(e)?b:p:null===e?j:!0===e||!1===e?d:e&&("string"===t||e instanceof String)?1===e.length?g:y:e&&("[object Array]"===n||e instanceof Array)?v:e&&("[object RegExp]"===n||e instanceof RegExp)?w:e&&("function"===t&&"[object Function]"===n||e instanceof Function)?h:e&&"[object Object]"===n?m:x},O=function(e,t){var n,r=t.length,o=[].concat(e);for(n=0;r>n;n++)o.indexOf(t[n])>-1||o.push(t[n]);return o},N=function(e,t){if(m!==_(e))throw new TypeError("bad desc");var n={};if(u(e,"enumerable")&&(n.enumerable=!!t.enumerable),u(e,"configurable")&&(n.configurable=!!t.configurable),u(e,"value")&&(n.value=t.value),u(e,"writable")&&(n.writable=!!e.writable),u(e,"get")){var r=e.get;if(h!==_(r)&&"undefined"!==r)throw new TypeError("bad get");n.get=r}if(u(e,"set")){var o=e.set;if(h!==_(o)&&"undefined"!==o)throw new TypeError("bad set");n.set=o}if(("get"in n||"set"in n)&&("value"in n||"writable"in n))throw new TypeError("identity-confused descriptor");return n},T=Object.defineProperties||function(e,t){if("object"!=typeof e||null===e)throw new TypeError("bad obj");t=Object(t);for(var n=f(t),r=[],o=0;o<n.length;o++)r.push([n[o],N(t[n[o]],e)]);for(var o=0;o<r.length;o++)s(e,r[o][0],r[o][1]);return e},S=Object.create||function(e,t){var n,r=function(){};return r.prototype=e,n=new r,n.__proto__=e,"object"==typeof t&&T(n,t),n},A=function(e){var t=new n(e);return function(e){if(e&&t&&t.v){var r,o=this;if(e="constructor"==e?t.v:t.v.prototype[e])return t=new n(t.v.$super,t),r=e.apply(o,l(arguments,1)),t=t.prev,r}}},C=function(){var e,t,n,r,o,i,a,f=l(arguments);for(t=f.shift()||{},e=f.length,i=0;e>i;i++)if(n=f[i],m===_(n))for(o in n)u(n,o)&&c(n,o)&&(r=n[o],a=_(r),t[o]=p&a?0+r:(y|v)&a?r.slice(0):r);return t},R=function(e,n){e=e||Object,n=n||{};var r,o,i,l,a,c,s,b,d=null,g=e.$static||null;if(u(n,"constructor")?o=n.constructor:(r=function(){},n.constructor=o=r),u(n,"__static__")&&(d=n.__static__,delete n.__static__,g=O(g||[],f(d))),o.prototype=S(e.prototype),o.prototype=C(o.prototype,n),T(o.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0},$class:{value:o,enumerable:!1,writable:!0,configurable:!0},$super:{value:A(e),enumerable:!1,writable:!0,configurable:!0}}),T(o,{$super:{value:e,enumerable:!1,writable:!0,configurable:!0},$static:{value:g,enumerable:!1,writable:!0,configurable:!0}}),g){for(l=g.length,a={},i=0;l>i;i++)c=g[i],s=null,d&&t!==d[c]?s=d[c]:t!==e[c]&&(b=_(e[c]),s=m===b?C(null,e[c]):(y|v)&b?e[c].slice(0):p&b?0+e[c]:e[c]),a[c]={value:s,enumerable:!1,writable:!0,configurable:!0};T(o,a)}return o},I=Mixin=C,M=function(){var e=l(arguments),t=e.length,n=null;if(t>=2){var r=_(e[0]);r=h===r?{Extends:e[0]}:m===r?e[0]:{Extends:Object};var o,i,a=e[1]||{},u={},c=r.Extends||r.extends||Object,f=r.Implements||r.implements,s=r.Mixin||r.mixin;if(f=f?[].concat(f):null,s=s?[].concat(s):null)for(o=0,i=s.length;i>o;o++)s[o].prototype&&(u=Mixin(u,s[o].prototype));if(f)for(o=0,i=f.length;i>o;o++)f[o].prototype&&(u=I(u,f[o].prototype));n=R(c,C(u,a))}else n=R(Object,e[0]);return n};e.Classy={VERSION:"0.5.5",T:{UNDEFINED:E,NULL:j,BOOLEAN:d,STRING:y,NUMBER:p,NAN:b,FUNCTION:h,REGEXP:w,ARRAY:v,OBJECT:m},Type:_,Create:S,Merge:C,Implements:I,Mixin:Mixin,Extends:R,Static:function(e){return e},Class:M}}(e),e.Classy});
/**
*
*   FILTER.js
*   @version: 0.6.12
*   @dependencies: Classy.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e,i,n,r){var s="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),a=!s&&"undefined"!=typeof navigator,l="function"==typeof importScripts&&navigator instanceof WorkerNavigator,o=Array,h=o.prototype,u=function(){var t=null;if(s)return t=__filename,{path:__dirname,file:__filename};if(l)t=self.location.href;else if(a){var e;(e=document.getElementsByTagName("script"))&&e.length&&(t=e[e.length-1].src)}return t?{path:t.split("/").slice(0,-1).join("/"),file:t}:{path:null,file:null}},c=u(),f=function(t,e){if(s)return e;if("."==e.charAt(0)){t=t.split("/"),e=e.split("/");var i,n=0,r=0,a=e.length,l=t.length;for(i=0;a>i;i++)if(/^\.\./.test(e[i]))n++,r++;else{if(!/^\./.test(e[i]))break;r++}n=n>=l?0:l-n,e=t.slice(0,n).concat(e.slice(r)).join("/")}return e};i=i?[].concat(i):[];var m,d,p,_=i.length,g=new o(_),v=new o(_),w=new o(_),b=new o(_);for(m=0;_>m;m++)g[m]=i[m][0],v[m]=i[m][1],w[m]=/\.js$/i.test(v[m])?f(c.path,v[m]):f(c.path,v[m]+".js");if("object"==typeof module&&module.exports){if(r===module.exports[e]){for(m=0;_>m;m++)b[m]=module.exports[g[m]]||require(w[m])[g[m]];d=n.apply(t,b),module.exports[e]=d||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(v),function(i){if(r===i[e]){for(var s=h.slice.call(arguments,1),a=s.length,l=0;a>l;l++)b[l]=i[g[l]]||s[l];d=n.apply(t,b),i[e]=d||1}});else if(l){for(m=0;_>m;m++)self[g[m]]||importScripts(w[m]),b[m]=self[g[m]];d=n.apply(t,b),self[e]=d||1}else if(r===t[e]){var y=function(t,e){p=p||document.getElementsByTagName("head")[0];var i=0,n=document.createElement("script");n.type="text/javascript",n.language="javascript",n.onload=n.onreadystatechange=function(){i||n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(i=1,n.onload=n.onreadystatechange=null,p.removeChild(n),n=null,e&&e())},n.src=t,p.appendChild(n)},A=function(e,i,n){t[e]?n():y(i,n)},E=function(i){return function(){_>i&&(b[i]=t[g[i]]),++i<_?A(g[i],w[i],E(i)):(d=n.apply(t,b),t[e]=d||1)}};_?A(g[0],w[0],E(0)):(d=n.apply(t,b),t[e]=d||1)}}(this,"FILTER",[["Classy","./classy"]],function(Classy){var FILTER=FILTER||{VERSION:"0.6.12",Class:Classy.Class,Merge:Classy.Merge};return!function(t,e){"use strict";var i,n=Object.prototype,r=Function.prototype,s=Array.prototype,a=r.call.bind(s.slice),l=r.call.bind(n.toString),o=(s.splice,s.concat,e.Merge),h="undefined"!=typeof global&&"[object global]"===l(global),u=!h&&"undefined"!=typeof navigator,c="function"==typeof importScripts&&navigator instanceof WorkerNavigator,f="function"==typeof Worker,m=navigator?navigator.userAgent:"",d=e.Browser={isNode:h,isBrowser:u,isWorker:c,supportsWorker:f,isPhantom:/PhantomJS/.test(m),isOpera:u&&/Opera|OPR\//.test(m),isFirefox:u&&/Firefox\//.test(m),isChrome:u&&/Chrome\//.test(m),isSafari:u&&/Apple Computer/.test(navigator.vendor),isKhtml:u&&/KHTML\//.test(m),isIE:u&&(/MSIE \d/.test(m)||/Trident\/\d/.test(m)),isGecko:u&&/gecko\/\d/i.test(m),isWebkit:u&&/WebKit\//.test(m),isMac_geLion:u&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(m),isMac_geMountainLion:u&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(m),isMobile:!1,isIOS:/AppleWebKit/.test(m)&&/Mobile\/\w+/.test(m),isWin:/windows/i.test(navigator.platform),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};d.isMobile=d.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(m),d.isMac=d.isIOS||/Mac/.test(navigator.platform),d.isIE_lt8=d.isIE&&!c&&(null==document.documentMode||document.documentMode<8),d.isIE_lt9=d.isIE&&!c&&(null==document.documentMode||document.documentMode<9),d.isQtWebkit=d.isWebkit&&/Qt\/\d+\.\d+/.test(m),e.getPath=function(){var t,e=null;return h?{path:__dirname,file:__filename}:(c?e=self.location.href:u&&(t=document.getElementsByTagName("script"))&&t.length&&(e=t[t.length-1].src),e?{path:e.split("/").slice(0,-1).join("/"),file:""+e}:{path:null,file:null})};var p=e.devicePixelRatio=t.devicePixelRatio||1;e.getCanvas=e.createCanvas=function(t,e){var i=document.createElement("canvas");return t=t||0,e=e||0,i.style.width=t+"px",i.style.height=e+"px",i.width=t*p,i.height=e*p,i};var _=0;e.uuid=function(t){return[t||"fuuid",(new Date).getTime(),++_].join("_")};var g=e.URL=t.webkitURL||t.URL,v=function(t){return g.createObjectURL(new Blob([t||""],{type:"text/javascript"}))};e.useWebGL=!1,e.useWebGLSharedResources=!1,e.useWebGLIfAvailable=function(){},e.useWebGLSharedResourcesIfAvailable=function(){},e.Array=Array,e.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,e.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,e.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,e.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,e.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,e.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,e.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array;var w=e._notSupportClamp="undefined"==typeof Uint8ClampedArray;if(e.ImArray=w?e.Array8U:Uint8ClampedArray,e.ImArrayCopy=d.isOpera?e.Array8U:e.ImArray,w&&"undefined"!=typeof CanvasPixelArray&&!CanvasPixelArray.prototype.set){var b=function(t,e){var i=t.length;for(e=parseInt(e,10)||0;--i>=0;)this[i+e]=t[i];return this};CanvasPixelArray.prototype.set=b}if(e.CONSTANTS={PI:Math.PI,PI2:2*Math.PI,PI_2:.5*Math.PI,SQRT2:Math.SQRT2,toRad:Math.PI/180,toDeg:180/Math.PI},e.CHANNEL={RED:0,GREEN:1,BLUE:2,ALPHA:3},e.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:4},e.LUMA=new e.Array32F([.212671,.71516,.072169]),c){var y=null;t.console={log:function(t){postMessage({event:"console.log",data:{output:t||""}})},error:function(t){postMessage({event:"console.error",data:{output:t||""}})}},onmessage=function(t){var i=t.data.event,n=t.data.data||null;switch(i){case"init":if(!(n&&n.filter&&e[n.filter]))throw new Error('Filter "'+n.filter+'" could not be created');y&&y.dispose(!0),y=new e[n.filter];break;case"import":n&&n["import"]&&n["import"].length&&importScripts(n["import"].join(","));break;case"params":y&&y.unserialize(n);break;case"apply":y&&(n&&n.im?(n.params&&y.unserialize(n.params),y.send("apply",{im:y._apply(n.im[0],n.im[1],n.im[2])})):y.send("apply",{im:null}));break;case"dispose":default:y&&y.dispose(!0),close()}}}i=e.log=console&&console.log?console.log:function(){},e.warning=function(t){i("WARNING: "+t)},e.error=function(t){i("ERROR: "+t)};var A=e.FilterWorkerInterface=e.Class({path:e.getPath(),name:null,_worker:null,_workerListeners:null,disposeWorker:function(){var t=this;return t._worker&&(t.send("dispose"),t._worker=null,t._workerListeners=null),t},serialize:function(){return{}},unserialize:function(){return this},sources:function(){var t=a(arguments);if(t.length){var e,i=[];for(e=0;e<t.length;e++)"function"==typeof t[e]?i.push(v(t[e].toString())):i.push(v(t[e]));this.send("import",{"import":i})}return this},scripts:function(){var t=a(arguments);return t.length&&this.send("import",{"import":t}),this},worker:function(t){var e,n=this;if(arguments.length||(t=!0),t=!!t,!1===t)return n._worker&&n.disposeWorker(),n;if(!n._worker){if(!f)throw new Error("Worker is not supported");n._workerListeners={},e=n._worker=new Worker(this.path.file),e.onmessage=function(t){if(t.data.event){var e=t.data.event,r=t.data.data||null;n._workerListeners&&n._workerListeners[e]&&n._workerListeners[e](r),("console.log"===e||"console.error"===e)&&i("Worker: "+r.output)}},e.onerror=function(t){if(!n._workerListeners||!n._workerListeners.error)throw new Error("Worker Error: "+t.message+" file: "+t.filename+" line: "+t.lineno);n._workerListeners.error(t)},n.send("init",{filter:n.name})}return n},bind:function(t,e){return t&&e&&this._workerListeners&&(this._workerListeners[t]=e.bind(this)),this},unbind:function(t){return t&&this._workerListeners&&this._workerListeners[t]&&delete this._workerListeners[t],this},send:function(t,e){return t&&(c?postMessage({event:t,data:e||null}):this._worker&&this._worker.postMessage({event:t,data:e||null})),this}}),E=e.Filter=e.Class(A,{name:"Filter",constructor:function(){},id:null,_isOn:!0,dispose:function(){return this.disposeWorker(),this},serialize:function(){return{filter:this.name,_isOn:!!this._isOn}},unserialize:function(t){return t&&this.name===t.filter&&(this._isOn=!!t._isOn),this},isOn:function(){return this._isOn},turnOn:function(t){return arguments.length||(t=!0),this._isOn=!!t,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this},combineWith:function(){return this},_apply:function(t){return t},apply:function(t,e){if(t&&this._isOn){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this))}return t},toString:function(){return"[FILTER: "+this.name+"]"}}),L=function(){return"[FILTER Plugin: "+this.name+"]"};e.Create=function(t){return t=o({init:function(){},name:"PluginFilter",toString:L,apply:function(t){return t}},t),t.constructor=t.init,t._apply=t.apply,delete t.init,delete t.apply,e.Class(E,t)}}(this,FILTER),!function(t){"use strict";var e=Math.sqrt,n=Math.round,r=(Math.floor,Math.min),s=Math.max,a=(Math.abs,function(t,e,i){return s(r(t,i),e)}),l=function(t){return t.replace(/([.*+?^${}()|\[\]\/\\\-])/g,"\\$1")},o=function(t){return t.replace(/^\s+/gm,"").replace(/\s+$/gm,"")},h=1/255,u=100/255,c=2.55,f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},m=t.Color=t.Class({__static__:{clamp:a,clampPixel:function(t){return r(255,s(t,0))},ubyteToFloat:function(t){return.00392156862745098*t},ubyteColorToFloatColor:function(t){var e=t.length,n=new Array(e);for(i=0;e>i;i++)n[i]=.00392156862745098*t[i];return n},hexColorToFloatColor:function(t){var e,i,n,r;return e=255&t>>16,i=255&t>>8,n=255&t,r=255&t>>24,[.00392156862745098*e,.00392156862745098*i,.00392156862745098*n,.00392156862745098*r]},blend:function(t,e,i){return{r:t.r-~~((t.r-e.r)*i+.5),g:t.g-~~((t.g-e.g)*i+.5),b:t.b-~~((t.b-e.b)*i+.5)}},toGray:function(e,i,n){var r=t.LUMA;return~~(r[0]*e+r[1]*i+r[2]*n)},distance:function(t,i){var n=t.r-i.r,r=t.g-i.g,s=t.b-i.b;return e(n*n+r*r+s*s)},RGB2Color:function(t){return t.r<<16|t.g<<8|255&t.b},RGBA2Color:function(t){return t.a<<24|t.r<<16|t.g<<8|255&t.b},Color2RGBA:function(t){return t=~~t,{r:255&t>>>16,g:255&t>>>8,b:255&t,a:255&t>>>24}},RGB2YCbCr:function(t){var e,i,n,r=t.r,s=t.g,a=t.b;return e=~~(0+.299*r+.587*s+.114*a),i=~~(128-.168736*r-.331264*s+.5*a),n=~~(128+.5*r-.418688*s-.081312*a),{y:e,cb:i,cr:n}},YCbCr2RGB:function(t){var e,i,n,r=t.y,s=t.cb,a=t.cr;return e=~~(r+1.402*(a-128)),i=~~(r-.34414*(s-128)-.71414*(a-128)),n=~~(r+1.772*(s-128)),{r:e,g:i,b:n}},RGB2HSV:function(t){var e,i,n,a,l,o,h,u,c;return a=t.r,l=t.g,o=t.b,e=r(a,l,o),i=s(a,l,o),n=i-e,c=i,0==i?(u=0,h=0,{h:h,s:u,v:c}):(u=n/i,h=a==i?(l-o)/n:l==i?2+(o-a)/n:4+(a-l)/n,h*=60,0>h&&(h+=360),{h:h,s:u,v:c})},HSV2RGB:function(t){var e,i,n,r,s,a,l,o,h,u,c;if(h=t.h,u=t.s,c=t.v,0==u)return a=l=o=c,{r:a,g:l,b:o};switch(h/=60,e=~~h,i=h-e,n=c*(1-u),r=c*(1-u*i),s=c*(1-u*(1-i)),e){case 0:a=c,l=s,o=n;break;case 1:a=r,l=c,o=n;break;case 2:a=n,l=c,o=s;break;case 3:a=n,l=r,o=c;break;case 4:a=s,l=n,o=c;break;default:a=c,l=n,o=r}return{r:a,g:l,b:o}},toString:function(){return"[FILTER: "+this.name+"]"},C2F:h,C2P:u,P2C:c,Keywords:f,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(f).map(l).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(t,e){return t*u+(e||"")},per2col:function(t){return t*c},rgb2cmyk:function(t,e,i,s){var l,o,u=0,f=0,m=0,d=0;return s&&(t=a(n(t*c),0,255),e=a(n(e*c),0,255),i=a(n(i*c),0,255)),0==t&&0==e&&0==i?(d=1,[0,0,0,1]):(u=1-t*h,f=1-e*h,m=1-i*h,l=r(u,f,m),o=1/(1-l),u=(u-l)*o,f=(f-l)*o,m=(m-l)*o,d=l,[u,f,m,d])},cmyk2rgb:function(t,e,i,r){var s,l,o=0,h=0,u=0;return 0==t&&0==e&&0==i?[0,0,0]:(s=r,l=1-s,t=t*l+s,e=e*l+s,i=i*l+s,o=255*(1-t),h=255*(1-e),u=255*(1-i),[a(n(o),0,255),a(n(h),0,255),a(n(u),0,255)])},rgb2hex:function(t,e,i,r,s){var l;return s&&(t=a(n(t*c),0,255),e=a(n(e*c),0,255),i=a(n(i*c),0,255)),t=16>t?"0"+t.toString(16):t.toString(16),e=16>e?"0"+e.toString(16):e.toString(16),i=16>i?"0"+i.toString(16):i.toString(16),l=r&&t[0]==t[1]&&e[0]==e[1]&&i[0]==i[1]?"#"+t[0]+e[0]+i[0]:"#"+t+e+i},rgb2hexIE:function(t,e,i,r,s){var l;return s&&(t=a(n(t*c),0,255),e=a(n(e*c),0,255),i=a(n(i*c),0,255),r=a(n(r*c),0,255)),t=16>t?"0"+t.toString(16):t.toString(16),e=16>e?"0"+e.toString(16):e.toString(16),i=16>i?"0"+i.toString(16):i.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),l="#"+r+t+e+i},hex2rgb:function(t){return!t||3>t.length?[0,0,0]:6>t.length?[a(parseInt(t[0]+t[0],16),0,255),a(parseInt(t[1]+t[1],16),0,255),a(parseInt(t[2]+t[2],16),0,255)]:[a(parseInt(t[0]+t[1],16),0,255),a(parseInt(t[2]+t[3],16),0,255),a(parseInt(t[4]+t[5],16),0,255)]},hue2rgb:function(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+6*(e-t)*(2/3-i):t},hsl2rgb:function(t,e,i){var r,s,l,o,h;return t=(t+360)%360/360,e*=.01,i*=.01,0==e?(r=1,s=1,l=1):(h=.5>i?i*(1+e):i+e-i*e,o=2*i-h,r=m.hue2rgb(o,h,t+1/3),s=m.hue2rgb(o,h,t),l=m.hue2rgb(o,h,t-1/3)),[a(n(255*r),0,255),a(n(255*s),0,255),a(n(255*l),0,255)]},rgb2hsl:function(t,e,i,l){var o,u,c,f,m,d;return l?(t*=.01,e*=.01,i*=.01):(t*=h,e*=h,i*=h),u=s(t,e,i),o=r(t,e,i),m=.5*(u+o),u==o?c=f=0:(d=u-o,f=m>.5?d/(2-s-r):d/(s+r),c=u==t?(e-i)/d+(i>e?6:0):u==e?(i-t)/d+2:(t-e)/d+4,c/=6),[n(360*c)%360,a(100*f,0,100),a(100*m,0,100)]},parse:function(t,e,i,n){var r,s,a,l,h,c=0,f=0;if("hsl"==i||!i&&(r=t.match(m.hslRE))){if("hsl"==i){h="hsla"==t[0].toLowerCase();var d=t[1].split(",").map(o)}else{c=r[0].length,f=0,h="hsla"==r[1].toLowerCase();var d=r[2].split(",").map(o)}var p=d[0]?d[0]:"0",t=d[1]?d[1]:"0",_=d[2]?d[2]:"0",g=h&&null!=d[3]?d[3]:"1";return p=parseFloat(p,10),t="%"==t.slice(-1)?parseFloat(t,10):parseFloat(t,10)*u,_="%"==_.slice(-1)?parseFloat(_,10):parseFloat(_,10)*u,g=parseFloat(g,10),l=(new m).fromHSL([p,t,_,g]),e&&(a=t.substr(c),(s=a.match(m.colorstopRE))&&(l.colorStop(s[1]),f=s[0].length)),n?l:[l,0,c+f]}if("rgb"==i||!i&&(r=t.match(m.rgbRE))){if("rgb"==i){h="rgba"==t[0].toLowerCase();var d=t[1].split(",").map(o)}else{c=r[0].length,f=0,h="rgba"==r[1].toLowerCase();var d=r[2].split(",").map(o)}var v=d[0]?d[0]:"0",w=d[1]?d[1]:"0",b=d[2]?d[2]:"0",g=h&&null!=d[3]?d[3]:"1";return v="%"==v.slice(-1)?2.55*parseFloat(v,10):parseFloat(v,10),w="%"==w.slice(-1)?2.55*parseFloat(w,10):parseFloat(w,10),b="%"==b.slice(-1)?2.55*parseFloat(b,10):parseFloat(b,10),g=parseFloat(g,10),l=(new m).fromRGB([v,w,b,g]),e&&(a=t.substr(c),(s=a.match(m.colorstopRE))&&(l.colorStop(s[1]),f=s[0].length)),n?l:[l,0,c+f]}if("hex"==i||!i&&(r=t.match(m.hexRE))){if("hex"==i)var d=m.hex2rgb(t[0]);else{c=r[0].length,f=0;var d=m.hex2rgb(r[1])}var y=d[0]?d[0]:0,A=d[1]?d[1]:0,E=d[2]?d[2]:0,g=null!=d[3]?d[3]:255;return l=(new m).fromHEX([y,A,E,g]),e&&(a=t.substr(c),(s=a.match(m.colorstopRE))&&(l.colorStop(s[1]),f=s[0].length)),n?l:[l,0,c+f]}if("keyword"==i||!i&&(r=t.match(m.keywordRE))){if("keyword"==i)var d=t[0];else{c=r[0].length,f=0;var d=r[1]}return l=(new m).fromKeyword(d),e&&(a=t.substr(c),(s=a.match(m.colorstopRE))&&(l.colorStop(s[1]),f=s[0].length)),n?l:[l,0,c+f]}return null},fromString:function(t,e,i){return m.parse(t,e,i,1)},fromRGB:function(t){return(new m).fromRGB(t)},fromHSL:function(t){return(new m).fromHSL(t)},fromCMYK:function(t){return(new m).fromCMYK(t)},fromHEX:function(t){return(new m).fromHEX(t)},fromKeyword:function(t){return(new m).fromKeyword(t)},fromPixel:function(t){return(new m).fromPixel(t)}},constructor:function(t,e){return this instanceof m?(this.reset(),t&&this.set(t,e),void 0):new m(t,e)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var t=new m;return t.col=this.col.slice(),t.cstop=this.cstop+"",t.kword=this.kword,t},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(t,e){return t&&(undef!==t[0]&&(this.col[0]=a(t[0],0,255)),undef!==t[1]&&(this.col[1]=a(t[1],0,255)),undef!==t[2]&&(this.col[2]=a(t[2],0,255)),this.col[3]=undef!==t[3]?a(t[3],0,1):1,e&&(this.cstop=e),this.kword=null),this},colorStop:function(t){return this.cstop=t,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return this.kword?!0:!1},fromPixel:function(t){return t=t||0,this.col=[a(255&t>>16,0,255),a(255&t>>8,0,255),a(255&t,0,255),a((255&t>>24)*h,0,1)],this.kword=null,this},fromKeyword:function(t){return t=t.toLowerCase(),m.Keywords[t]&&(this.col=m.Keywords[t].slice(),this.kword=t),this},fromHEX:function(t){return this.col[0]=t[0]?a(parseInt(t[0],10),0,255):0,this.col[1]=t[1]?a(parseInt(t[1],10),0,255):0,this.col[2]=t[2]?a(parseInt(t[2],10),0,255):0,this.col[3]=undef!==t[3]?a(parseInt(t[3],10)*h,0,1):1,this.kword=null,this},fromRGB:function(t){return this.col[0]=t[0]?a(n(t[0]),0,255):0,this.col[1]=t[1]?a(n(t[1]),0,255):0,this.col[2]=t[2]?a(n(t[2]),0,255):0,this.col[3]=undef!==t[3]?a(t[3],0,1):1,this.kword=null,this},fromCMYK:function(t){var e=m.cmyk2rgb(t[0]||0,t[1]||0,t[2]||0,t[3]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=undef!==t[4]?a(t[4],0,1):1,this.kword=null,this},fromHSL:function(t){var e=m.hsl2rgb(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=undef!==t[3]?a(t[3],0,1):1,this.kword=null,this},toPixel:function(t){return t?a(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(t,e,i){var n=m.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return i?n:n.concat(this.col[3])},toKeyword:function(t,e,i){return this.kword?this.kword:this.toHEX(1,e,i)},toHEX:function(t,e,i){return i?m.rgb2hexIE(this.col[0],this.col[1],this.col[2],a(n(255*this.col[3]),0,255)):m.rgb2hex(this.col[0],this.col[1],this.col[2],e)},toRGB:function(t,e,i){var n=this.col[3];return t?(e&&(n=1>n&&n>0?n.toString().slice(1):n),i||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(n).join(",")+")"):i?this.col.slice(0,3):this.col.slice()},toHSL:function(t,e,i){var n=this.col[3],r=m.rgb2hsl(this.col[0],this.col[1],this.col[2]);return t?(e&&(r[1]=0==r[1]?r[1]:r[1]+"%",r[2]=0==r[2]?r[2]:r[2]+"%",n=1>n&&n>0?n.toString().slice(1):n),i||1==this.col[3]?"hsl("+[r[0],r[1],r[2]].join(",")+")":"hsla("+[r[0],r[1],r[2],n].join(",")+")"):i?r:r.concat(this.col[3])},toColorStop:function(t){var e=this.cstop;return t?(e=e.length?e+",":"",1>this.col[3]?"color-stop("+e+this.toRGB(1,1)+")":"color-stop("+e+this.toHEX(1,1)+")"):(e=e.length?" "+e:"",1>this.col[3]?this.toRGB(1,1)+e:this.toHEX(1,1)+e)},toString:function(t,e){return t=t?t.toLowerCase():"hex","rgb"==t||"rgba"==t?this.toRGB(1,!1!==e,"rgb"==t):"hsl"==t||"hsla"==t?this.toHSL(1,!1!==e,"hsl"==t):"keyword"==t?this.toKeyword(1):this.toHEX(1,!1!==e,"hexie"==t)}})}(FILTER),!function(t,e){"use strict";var i=t.devicePixelRatio,n=t.ImArray,r=t.Array32F,s=t.createCanvas,a=(t._notSupportTypedArrays,Math.min),l=Math.floor,o=t.blendModes={normal:function(t){return t},lighten:function(t,e){return e>t?e:t},darken:function(t,e){return e>t?t:e},multiply:function(t,e){return.003921568627451*t*e},average:function(t,e){return.5*(t+e)},add:function(t,e){return Math.min(255,t+e)},substract:function(t,e){return 255>t+e?0:t+e-255},difference:function(t,e){return Math.abs(t-e)},negation:function(t,e){return 255-Math.abs(255-t-e)},screen:function(t,e){return 255-((255-t)*(255-e)>>8)},exclusion:function(t,e){return t+e-.003921568627451*2*t*e},overlay:function(t,e){return 128>e?.003921568627451*2*t*e:255-.003921568627451*2*(255-t)*(255-e)},softLight:function(t,e){return 128>e?2*((t>>1)+64)*.003921568627451*e:255-.003921568627451*2*(255-((t>>1)+64))*(255-e)},hardLight:function(t,e){return 128>t?.003921568627451*2*e*t:255-.003921568627451*2*(255-e)*(255-t)},colorDodge:function(t,e){return 255==e?e:Math.min(255,(t<<8)/(255-e))},colorBurn:function(t,e){return 0==e?e:Math.max(0,255-(255-t<<8)/e)},linearLight:function(t,e){return 128>e?o.linearBurn(t,2*e):o.linearDodge(t,2*(e-128))},vividLight:function(t,e){return 128>e?o.colorBurn(t,2*e):o.colorDodge(t,2*(e-128))},pinLight:function(t,e){return 128>e?o.darken(t,2*e):o.lighten(t,2*(e-128))},hardMix:function(t,e){return o.vividLight(t,e)<128?0:255},reflect:function(t,e){return 255==e?e:Math.min(255,t*t/(255-e))},glow:function(t,e){return 255==t?t:Math.min(255,e*e/(255-t))},phoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}};o.linearDodge=o.add,o.linearBurn=o.substract;var h=1,u=2,c=4,f=8,m=t.Image=t.Class({name:"Image",constructor:function(t,e){this.width=0,this.height=0,this.context=null,this.selection=null,this.imageData=null,this.imageDataSel=null,this.domElement=this.canvasElement=s(this.width,this.height),this.context=this.canvasElement.getContext("2d"),this._tmpCanvas=null,this.webgl=null,this._histogram=null,this._integral=null,this._needsRefresh=0,t&&this.setImage(t,e)},width:0,height:0,canvasElement:null,domElement:null,context:null,selection:null,imageData:null,imageDataSel:null,webgl:null,_histogram:null,_integral:null,_needsRefresh:0,_tmpCanvas:null,select:function(t,i,n,r){return this.selection=[e===t?0:t,e===i?0:i,e===n?1:n,e===r?1:r],this._needsRefresh|=u,this},deselect:function(){return this.selection=null,this.imageDataSel=null,this._needsRefresh&=~u,this},apply:function(t,e){return t&&t.apply(this,e),this},setWidth:function(t){return this._setWidth(t),this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u),this},setHeight:function(t){return this._setHeight(t),this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u),this},setDimensions:function(t,e){return this._setDimensions(t,e),this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u),this},setImage:function(e,i){if(!e)return this;var n,r,s,a,l=this;return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?(n=e,s=n instanceof HTMLVideoElement?n.videoWidth:n.width,a=n instanceof HTMLVideoElement?n.videoHeight:n.height,r=l.context=l._setDimensions(s,a).canvasElement.getContext("2d"),r.drawImage(n,0,0),l._needsRefresh|=h|c|f,l.selection&&(l._needsRefresh|=u),l.webgl=t.useWebGL?new t.WebGL(l.canvasElement):null):(n=new Image,n.onload=function(){s=n.width,a=n.height,r=l.context=l._setDimensions(s,a).canvasElement.getContext("2d"),r.drawImage(n,0,0),l._needsRefresh|=h|c|f,l.selection&&(l._needsRefresh|=u),l.webgl=t.useWebGL?new t.WebGL(l.canvasElement):null,"undefined"!=typeof i&&i.call(l)},n.src=e),n.crossOrigin="",this},getPixel:function(t,e){this._needsRefresh&h&&this._refreshData();var i=~~(e*this.width+t+.5),n=this.imageData.data;return{r:n[i],g:n[i+1],b:n[i+2],a:n[i+3]}},setPixel:function(t,e,i,r,s,a){var l=new n([255&i,255&r,255&s,255&a]);return this.context.putImageData(l,t,e),this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u),this},getData:function(){return this._needsRefresh&h&&this._refreshData(),new n(this.imageData.data)},getSelectedData:function(){var t;return this.selection?(this._needsRefresh&u&&this._refreshDataSel(),t=this.imageDataSel):(this._needsRefresh&h&&this._refreshData(),t=this.imageData),[new n(t.data),t.width,t.height]},setData:function(t){return this._needsRefresh&h&&this._refreshData(),this.imageData.data.set(t),this.context.putImageData(this.imageData,0,0),this._needsRefresh|=c|f,this.selection&&(this._needsRefresh|=u),this},setSelectedData:function(t){if(this.selection){var e=this.selection,i=this.width-1,n=this.height-1,r=l(e[0]*i),s=l(e[1]*n);this._needsRefresh&u&&this._refreshDataSel(),this.imageDataSel.data.set(t),this.context.putImageData(this.imageDataSel,r,s),this._needsRefresh|=h}else this._needsRefresh&h&&this._refreshData(),this.imageData.data.set(t),this.context.putImageData(this.imageData,0,0),this.selection&&(this._needsRefresh|=u);return this._needsRefresh|=c|f,this},getPixelData:function(){return this._needsRefresh&h&&this._refreshData(),this.imageData},setPixelData:function(t){return this.context.putImageData(t,0,0),this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u),this},createImageData:function(t,e){return this.context=this._setDimensions(t,e).canvasElement.getContext("2d"),this.context.createImageData(t,e),this._needsRefresh|=h,this.selection&&(this._needsRefresh|=u),this},copy:function(t){return this.setData(t.getData()),this},clone:function(){return new m(this.canvasElement)},scale:function(t,e){if(t=t||1,e=e||t,1==t&&1==e)return this;this._tmpCanvas=this._tmpCanvas||this._getTmpCanvas();var n=this._tmpCanvas.getContext("2d");return n.scale(t,e),n.drawImage(this.canvasElement,0,0),this.width=~~(t*this.width+.5),this.height=~~(e*this.height+.5),this.canvasElement.style.width=this.width+"px",this.canvasElement.style.height=this.height+"px",this.canvasElement.width=this.width*i,this.canvasElement.height=this.height*i,this.context.drawImage(this._tmpCanvas,0,0),this._tmpCanvas.width=this.width,this._tmpCanvas.height=this.height,this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u),this},flipHorizontal:function(){this._tmpCanvas=this._tmpCanvas||this._getTmpCanvas();var t=this._tmpCanvas.getContext("2d");return t.translate(this.width,0),t.scale(-1,1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u),this},flipVertical:function(){this._tmpCanvas=this._tmpCanvas||this._getTmpCanvas();var t=this._tmpCanvas.getContext("2d");return t.translate(0,this.height),t.scale(1,-1),t.drawImage(this.canvasElement,0,0),this.context.drawImage(this._tmpCanvas,0,0),this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u),this},clear:function(){if(this.width&&this.height){var t=this.context;t.clearRect(0,0,this.width,this.height),this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u)}return this},fill:function(t,e,i,n,r){if(!n&&this.width&&!r&&this.height)return this;n&&!this.width&&r&&!this.height&&(this.context=this._setDimensions(n,r).canvasElement.getContext("2d"),this.context.createImageData(n,r)),t=t||0,e=e||0,i=i||0,n=n||this.width,r=r||this.height;var s=this.context;return s.fillStyle=t,s.fillRect(e,i,n,r),this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u),this},draw:function(){return this},blend:function(t,e,i,n,r){"undefined"==typeof e&&(e="normal"),"undefined"==typeof i&&(i=1),i>1?i=1:0>i&&(i=0),"undefined"==typeof n&&(n=0),"undefined"==typeof r&&(r=0);var s=0,l=0,m=this.context;if(0>n&&(s=-n,n=0),0>r&&(l=-r,r=0),n>=this.width||r>=this.height)return this;var d=o[e]||null;if(!d)return this;var p,_,g,v,w,b,y,A=a(this.width,t.width-s),E=a(this.height,t.height-l),L=this.context.getImageData(n,r,A,E),M=t.context.getImageData(s,l,A,E),I=L.data,R=M.data,C=1-i,k=R.length;for(y=0;k>y;y+=4)v=I[y],w=I[y+1],b=I[y+2],p=d(R[y],v),_=d(R[y+1],w),g=d(R[y+2],b),I[y]=p*i+v*C,I[y+1]=_*i+w*C,I[y+2]=g*i+b*C;return m.putImageData(L,n,r),this._needsRefresh|=h|c|f,this.selection&&(this._needsRefresh|=u),this},integral:function(){return this._needsRefresh&f&&this._computeIntegral(),this._integral},histogram:function(){return this._needsRefresh&c&&this._computeHistogram(),this._histogram},toString:function(){return"[FILTER Image: "+this.name+"]"},_getTmpCanvas:function(){var t=s(this.width,this.height);return t.width=this.width,t.height=this.height,t},_setDimensions:function(t,e){return this.canvasElement.style.width=t+"px",this.canvasElement.width=this.width=t*i,this.canvasElement.style.height=e+"px",this.canvasElement.height=this.height=e*i,this._tmpCanvas&&(this._tmpCanvas.style.width=this.canvasElement.style.width,this._tmpCanvas.width=this.canvasElement.width,this._tmpCanvas.style.height=this.canvasElement.style.height,this._tmpCanvas.height=this.canvasElement.height),this},_setWidth:function(t){return this.canvasElement.style.width=t+"px",this.canvasElement.width=this.width=t*i,this._tmpCanvas&&(this._tmpCanvas.style.width=this.canvasElement.style.width,this._tmpCanvas.width=this.canvasElement.width),this},_setHeight:function(t){return this.canvasElement.style.height=t+"px",this.canvasElement.height=this.height=t*i,this._tmpCanvas&&(this._tmpCanvas.style.height=this.canvasElement.style.height,this._tmpCanvas.height=this.canvasElement.height),this},_computeIntegral:function(){var t,e,i,n,s,a,l,o,h,u=this.width,c=(this.height,u<<2),m=this.getPixelData().data,d=m.length,p=d>>2;
for(t=new r(p),e=new r(p),i=new r(p),o=0,l=0,n=s=a=0,h=0;u>h;h++,l+=4,o++)n+=m[l],s+=m[l+1],a+=m[l+2],t[o]=n,e[o]=s,i[o]=a;for(l=c,h=0,o=0,n=s=a=0,l=c;d>l;l+=4,o++,h++)h>=u&&(h=0,n=s=a=0),n+=m[l],s+=m[l+1],a+=m[l+2],t[o+u]=t[o]+n,e[o+u]=e[o]+s,i[o+u]=i[o]+a;return this._integral=[t,e,i],this._needsRefresh&=~f,this},_computeHistogram:function(){var t,e,i,n,s,a,l,o,h,u,f=this.getPixelData().data,m=f.length,d=0,p=0,_=0,g=255,v=255,w=255,b=1/(m>>2);for(t=new r(256),e=new r(256),i=new r(256),u=0;256>u;u+=4)t[u]=0,e[u]=0,i[u]=0,t[u+1]=0,e[u+1]=0,i[u+1]=0,t[u+2]=0,e[u+2]=0,i[u+2]=0,t[u+3]=0,e[u+3]=0,i[u+3]=0;for(u=0;m>u;u+=4)n=f[u],s=f[u+1],a=f[u+2],t[n]+=b,e[s]+=b,i[a]+=b,n>d?d=n:g>n&&(g=n),s>p?p=s:v>s&&(v=s),a>_?_=a:w>a&&(w=a);for(l=o=h=0,u=0;256>u;u+=4)l+=t[u],t[u]=l,o+=e[u],e[u]=o,h+=i[u],i[u]=h,l+=t[u+1],t[u+1]=l,o+=e[u+1],e[u+1]=o,h+=i[u+1],i[u+1]=h,l+=t[u+2],t[u+2]=l,o+=e[u+2],e[u+2]=o,h+=i[u+2],i[u+2]=h,l+=t[u+3],t[u+3]=l,o+=e[u+3],e[u+3]=o,h+=i[u+3],i[u+3]=h;return this._histogram=[t,e,i],this._needsRefresh&=~c,this},_refreshData:function(){return this.imageData=this.context.getImageData(0,0,this.width,this.height),this._needsRefresh&=~h,this},_refreshDataSel:function(){if(this.selection){var t=this.selection,e=this.width-1,i=this.height-1,n=l(t[0]*e),r=l(t[1]*i),s=l(t[2]*e)-n+1,a=l(t[3]*i)-r+1;this.imageDataSel=this.context.getImageData(n,r,s,a)}return this._needsRefresh&=~u,this}}),d=t.ScaledImage=t.Class(m,{name:"ScaledImage",constructor:function(t,e,i,n){this.scaleX=t||1,this.scaleY=e||this.scaleX,this.$super("constructor",i,n)},scaleX:1,scaleY:1,clone:function(){return new d(this.scaleX,this.scaleY,this.canvasElement)},setScale:function(t,i){return e!==t&&null!==t&&(this.scaleX=t),e===i&&e!==t&&null!==t?this.scaleY=t:null!==i&&(this.scaleY=i),this},setImage:function(e,i){if(!e)return this;var n,r,s,a,l,o,m=this,d=this.scaleX,p=this.scaleY;return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?(n=e,s=n instanceof HTMLVideoElement?n.videoWidth:n.width,a=n instanceof HTMLVideoElement?n.videoHeight:n.height,l=~~(d*s+.5),o=~~(p*a+.5),r=m.context=m._setDimensions(l,o).canvasElement.getContext("2d"),r.drawImage(n,0,0,s,a,0,0,l,o),m._needsRefresh|=h|c|f,m.selection&&(m._needsRefresh|=u),m.webgl=t.useWebGL?new t.WebGL(m.canvasElement):null):(n=new Image,n.onload=function(){s=n.width,a=n.height,l=~~(d*s+.5),o=~~(p*a+.5),r=m.context=m._setDimensions(s,a).canvasElement.getContext("2d"),r.drawImage(n,0,0,s,a,0,0,l,o),m._needsRefresh|=h|c|f,m.selection&&(m._needsRefresh|=u),m.webgl=t.useWebGL?new t.WebGL(m.canvasElement):null,"undefined"!=typeof i&&i.call(m)},n.src=e),n.crossOrigin="",this}})}(FILTER),!function(t){"use strict";var e=Object.prototype,i=Function.prototype,n=Array.prototype,r=i.call.bind(n.slice),s=(i.call.bind(e.toString),n.splice),a=n.concat,l=t.CompositeFilter=t.Class(t.Filter,{name:"CompositeFilter",constructor:function(t){this._stack=t&&t.length?t.slice():[]},_stack:null,_stable:!0,dispose:function(t){var e,i=this._stack;if(this.disposeWorker(),!0===t)for(e=0;e<i.length;e++)i[e]&&i[e].dispose(t),i[e]=null;return this._stack=null,this},serialize:function(){var t,e={filter:this.name,_isOn:!!this._isOn,_stable:!!this._stable,filters:[]},i=this._stack;for(t=0;t<i.length;t++)e.filters.push(i[t].serialize());return e},unserialize:function(e){var i,n,r,s,a,l=this,o=l._stack;if(e&&l.name===e.filter){if(l._isOn=!!e._isOn,l._stable=!!e._stable,s=e.filters||[],n=s.length,r=o.length,n===r&&l._stable)for(i=0;n>i;i++)o[i]=o[i].unserialize(s[i]);else{for(i=0;r>i;i++)o[i]&&o[i].dispose(!0),o[i]=null;for(o=[],i=0;n>i;i++){if(a=s[i]&&s[i].filter?t[s[i].filter]:null,!a)throw new Error('Filter "'+s[i].filter+'" could not be created');o.push((new a).unserialize(s[i]))}}l._stack=o}return l},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},filters:function(t){return arguments.length?(this._stack=t.slice(),this):this._stack.slice()},push:function(){var t=r(arguments),e=t.length;return e&&(this._stack=a.apply(this._stack,t)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var t=r(arguments),e=t.length;return e&&s.apply(this._stack,[0,0].concat(t)),this},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t?this._stack[t]=e:this._stack.push(e),this},insertAt:function(t){var e=r(arguments);return e.length,argslen>1&&(e.shift(),s.apply(this._stack,[t,0].concat(e))),this},removeAt:function(t){return this._stack.splice(t,1)},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(t,e,i,n){if(this._isOn&&this._stack.length){var r,s,a=this._stack,l=a.length;for(r=0;l>r;r++)s=a[r],s&&s._isOn&&(t=s._apply(t,e,i,n))}return t},apply:function(t,e){if(t&&this._isOn&&this._stack.length){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this))}return t},toString:function(){return["[FILTER: "+this.name+"]","[","    "+this._stack.join("\n    "),"]",""].join("\n")}});l.prototype.empty=l.prototype.reset,l.prototype.concat=l.prototype.push}(FILTER),!function(FILTER,undef){"use strict";var CustomFilter=FILTER.CustomFilter=FILTER.Class(FILTER.Filter,{name:"CustomFilter",constructor:function(t){this._handler=t&&"function"==typeof t?t:null},_handler:null,dispose:function(){return this.disposeWorker(),this._handler=null,this},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_handler:t._handler?t._handler.toString():null}}},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self._handler=null,params._handler&&(self._handler=eval('(function(){ "use strict"; return '+params._handler+"})();"))),self},_apply:function(t,e,i,n){return this._isOn&&this._handler?this._handler.call(this,t,e,i,n):t},apply:function(t,e){if(this._isOn&&this._handler){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._handler.call(this,i[0],i[1],i[2],t)),e&&e.call(this))}return t}})}(FILTER),!function(t,e){"use strict";function i(t,e){var i,n,r,s,l,o=new a(20);return i=e[0],n=e[1],r=e[2],s=e[3],l=e[4],o[0]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[1]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[2]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[3]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[4]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+l,i=e[5],n=e[6],r=e[7],s=e[8],l=e[9],o[5]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[6]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[7]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[8]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[9]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+l,i=e[10],n=e[11],r=e[12],s=e[13],l=e[14],o[10]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[11]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[12]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[13]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[14]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+l,i=e[15],n=e[16],r=e[17],s=e[18],l=e[19],o[15]=i*t[0]+n*t[5]+r*t[10]+s*t[15],o[16]=i*t[1]+n*t[6]+r*t[11]+s*t[16],o[17]=i*t[2]+n*t[7]+r*t[12]+s*t[17],o[18]=i*t[3]+n*t[8]+r*t[13]+s*t[18],o[19]=i*t[4]+n*t[9]+r*t[14]+s*t[19]+l,o}function n(t,e,i){var n=1-i,r=new a(20);return r[0]=n*t[0]+i*e[0],r[1]=n*t[1]+i*e[1],r[2]=n*t[2]+i*e[2],r[3]=n*t[3]+i*e[3],r[4]=n*t[4]+i*e[4],r[5]=n*t[5]+i*e[5],r[6]=n*t[6]+i*e[6],r[7]=n*t[7]+i*e[7],r[8]=n*t[8]+i*e[8],r[9]=n*t[9]+i*e[9],r[10]=n*t[10]+i*e[10],r[11]=n*t[11]+i*e[11],r[12]=n*t[12]+i*e[12],r[13]=n*t[13]+i*e[13],r[14]=n*t[14]+i*e[14],r[15]=n*t[15]+i*e[15],r[16]=n*t[16]+i*e[16],r[17]=n*t[17]+i*e[17],r[18]=n*t[18]+i*e[18],r[19]=n*t[19]+i*e[19],r}var r=Math.sin,s=Math.cos,a=t.Array32F,l=t.CONSTANTS.toRad,o=(t.CONSTANTS.toDeg,t._notSupportClamp),h=t.ColorMatrixFilter=t.Class(t.Filter,{name:"ColorMatrixFilter",constructor:function(e){this._matrix=e&&e.length?new a(e):null,t.useWebGL&&(this._webglInstance=t.WebGLColorMatrixFilterInstance||null)},_matrix:null,_webglInstance:null,dispose:function(){var t=this;return t.disposeWorker(),t._webglInstance=null,t._matrix=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_matrix:t._matrix}}},unserialize:function(t){var e,i=this;return t&&i.name===t.filter&&(i._isOn=!!t._isOn,e=t.params,i._matrix=e._matrix),i},channel:function(i,n){n=n===e?!1:n;var r=n?1:0;switch(i){case t.CHANNEL.ALPHA:return this.concat([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case t.CHANNEL.BLUE:return this.set([0,0,r,0,0,0,0,r,0,0,0,0,1,0,0,0,0,0,0,255]);case t.CHANNEL.GREEN:return this.set([0,r,0,0,0,0,1,0,0,0,0,r,0,0,0,0,0,0,0,255]);case t.CHANNEL.RED:default:return this.set([1,0,0,0,0,r,0,0,0,0,r,0,0,0,0,0,0,0,0,255])}},redChannel:function(e){return this.channel(t.CHANNEL.RED,e)},greenChannel:function(e){return this.channel(t.CHANNEL.GREEN,e)},blueChannel:function(e){return this.channel(t.CHANNEL.BLUE,e)},alphaChannel:function(){return this.channel(t.CHANNEL.ALPHA,!0)},maskChannel:function(e){switch(e){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(e,i){switch(e){case t.CHANNEL.ALPHA:switch(i){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case t.CHANNEL.BLUE:switch(i){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.BLUE:return this;case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case t.CHANNEL.GREEN:switch(i){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this;case t.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case t.CHANNEL.RED:default:switch(i){case t.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case t.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this}}},desaturate:function(){return this.set([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,0,0,0,0,1,0])},colorize:function(i,n){var r,s,a,l;return n===e&&(n=1),r=.00392156862745098*(255&i>>16),s=.00392156862745098*(255&i>>8),a=.00392156862745098*(255&i),l=1-n,this.set([l+n*r*t.LUMA[0],n*r*t.LUMA[1],n*r*t.LUMA[2],0,0,n*s*t.LUMA[0],l+n*s*t.LUMA[1],n*s*t.LUMA[2],0,0,n*a*t.LUMA[0],n*a*t.LUMA[1],l+n*a*t.LUMA[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(e){var i,n,r,s;return i=1-e,n=i*t.LUMA[0],r=i*t.LUMA[1],s=i*t.LUMA[2],this.set([n+e,r,s,0,0,n,r+e,s,0,0,n,r,s+e,0,0,0,0,0,1,0])},contrast:function(t,i,n){return i===e&&(i=t),n===e&&(n=t),t+=1,i+=1,n+=1,this.set([t,0,0,0,128*(1-t),0,i,0,0,128*(1-i),0,0,n,0,128*(1-n),0,0,0,1,0])},brightness:function(t,i,n){return i===e&&(i=t),n===e&&(n=t),this.set([1,0,0,0,t,0,1,0,0,i,0,0,1,0,n,0,0,0,1,0])},adjustHue:function(e){e*=l;var i=s(e),n=r(e);return this.set([t.LUMA[0]+i*(1-t.LUMA[0])+n*-t.LUMA[0],t.LUMA[1]+i*-t.LUMA[1]+n*-t.LUMA[1],t.LUMA[2]+i*-t.LUMA[2]+n*(1-t.LUMA[2]),0,0,t.LUMA[0]+i*-t.LUMA[0]+.143*n,t.LUMA[1]+i*(1-t.LUMA[1])+.14*n,t.LUMA[2]+i*-t.LUMA[2]+n*-.283,0,0,t.LUMA[0]+i*-t.LUMA[0]+n*-(1-t.LUMA[0]),t.LUMA[1]+i*-t.LUMA[1]+n*t.LUMA[1],t.LUMA[2]+i*(1-t.LUMA[2])+n*t.LUMA[2],0,0,0,0,0,1,0])},average:function(t,i,n){return t===e&&(t=.3333),i===e&&(i=.3333),n===e&&(n=.3334),this.set([t,i,n,0,0,t,i,n,0,0,t,i,n,0,0,0,0,0,1,0])},quickContrastCorrection:function(t){return t===e&&(t=1.2),this.set([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0])},sepia:function(t){return t===e&&(t=.5),t>1?t=1:0>t&&(t=0),this.set([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0])},sepia2:function(i){return i===e&&(i=10),i>100&&(i=100),i*=2.55,this.set([t.LUMA[0],t.LUMA[1],t.LUMA[2],0,40,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,20,t.LUMA[0],t.LUMA[1],t.LUMA[2],0,-i,0,0,0,1,0])},threshold:function(i,n){return n===e&&(n=256),this.set([t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,t.LUMA[0]*n,t.LUMA[1]*n,t.LUMA[2]*n,0,-(n-1)*i,0,0,0,1,0])},threshold_rgb:function(t,i){return i===e&&(i=256),this.set([i,0,0,0,-(i-1)*t,0,i,0,0,-(i-1)*t,0,0,i,0,-(i-1)*t,0,0,0,1,0])},threshold_alpha:function(t,i){return t===e&&(t=.5),i===e&&(i=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,i,-i*t])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(t,e){return this._matrix=this._matrix?n(this._matrix,t.getMatrix(),e):new a(t.getMatrix()),this},set:function(t){return this._matrix=this._matrix?i(this._matrix,new a(t)):new a(t),this},reset:function(){return this._matrix=null,this},combineWith:function(t){return this.set(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=new a(t),this},_apply:function(t){if(this._isOn&&this._matrix){var e,i,n,r,s,a,l,h,u,c,f,m,d,p,_,g,v,w,b,y,A,E=t.length,L=this._matrix,M=(E>>2)%4;if(o){for(e=0;E>e;e+=16)w=t[e],b=t[e+1],y=t[e+2],A=t[e+3],i=L[0]*w+L[1]*b+L[2]*y+L[3]*A+L[4],n=L[5]*w+L[6]*b+L[7]*y+L[8]*A+L[9],r=L[10]*w+L[11]*b+L[12]*y+L[13]*A+L[14],s=L[15]*w+L[16]*b+L[17]*y+L[18]*A+L[19],w=t[e+4],b=t[e+5],y=t[e+6],A=t[e+7],a=L[0]*w+L[1]*b+L[2]*y+L[3]*A+L[4],l=L[5]*w+L[6]*b+L[7]*y+L[8]*A+L[9],h=L[10]*w+L[11]*b+L[12]*y+L[13]*A+L[14],u=L[15]*w+L[16]*b+L[17]*y+L[18]*A+L[19],w=t[e+8],b=t[e+9],y=t[e+10],A=t[e+11],c=L[0]*w+L[1]*b+L[2]*y+L[3]*A+L[4],f=L[5]*w+L[6]*b+L[7]*y+L[8]*A+L[9],m=L[10]*w+L[11]*b+L[12]*y+L[13]*A+L[14],d=L[15]*w+L[16]*b+L[17]*y+L[18]*A+L[19],w=t[e+12],b=t[e+13],y=t[e+14],A=t[e+15],p=L[0]*w+L[1]*b+L[2]*y+L[3]*A+L[4],_=L[5]*w+L[6]*b+L[7]*y+L[8]*A+L[9],g=L[10]*w+L[11]*b+L[12]*y+L[13]*A+L[14],v=L[15]*w+L[16]*b+L[17]*y+L[18]*A+L[19],i=0>i?0:i>255?255:i,n=0>n?0:n>255?255:n,r=0>r?0:r>255?255:r,s=0>s?0:s>255?255:s,a=0>a?0:a>255?255:a,l=0>l?0:l>255?255:l,h=0>h?0:h>255?255:h,u=0>u?0:u>255?255:u,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,m=0>m?0:m>255?255:m,d=0>d?0:d>255?255:d,p=0>p?0:p>255?255:p,_=0>_?0:_>255?255:_,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,t[e]=~~i,t[e+1]=~~n,t[e+2]=~~r,t[e+3]=~~s,t[e+4]=~~a,t[e+5]=~~l,t[e+6]=~~h,t[e+7]=~~u,t[e+8]=~~c,t[e+9]=~~f,t[e+10]=~~m,t[e+11]=~~d,t[e+12]=~~p,t[e+13]=~~_,t[e+14]=~~g,t[e+15]=~~v;if(M)for(M<<=2,e=E-M;E>e;e+=4)w=t[e],b=t[e+1],y=t[e+2],A=t[e+3],i=L[0]*w+L[1]*b+L[2]*y+L[3]*A+L[4],n=L[5]*w+L[6]*b+L[7]*y+L[8]*A+L[9],r=L[10]*w+L[11]*b+L[12]*y+L[13]*A+L[14],s=L[15]*w+L[16]*b+L[17]*y+L[18]*A+L[19],i=0>i?0:i>255?255:i,n=0>n?0:n>255?255:n,r=0>r?0:r>255?255:r,s=0>s?0:s>255?255:s,t[e]=~~i,t[e+1]=~~n,t[e+2]=~~r,t[e+3]=~~s}else{for(e=0;E>e;e+=16)w=t[e],b=t[e+1],y=t[e+2],A=t[e+3],i=L[0]*w+L[1]*b+L[2]*y+L[3]*A+L[4],n=L[5]*w+L[6]*b+L[7]*y+L[8]*A+L[9],r=L[10]*w+L[11]*b+L[12]*y+L[13]*A+L[14],s=L[15]*w+L[16]*b+L[17]*y+L[18]*A+L[19],w=t[e+4],b=t[e+5],y=t[e+6],A=t[e+7],a=L[0]*w+L[1]*b+L[2]*y+L[3]*A+L[4],l=L[5]*w+L[6]*b+L[7]*y+L[8]*A+L[9],h=L[10]*w+L[11]*b+L[12]*y+L[13]*A+L[14],u=L[15]*w+L[16]*b+L[17]*y+L[18]*A+L[19],w=t[e+8],b=t[e+9],y=t[e+10],A=t[e+11],c=L[0]*w+L[1]*b+L[2]*y+L[3]*A+L[4],f=L[5]*w+L[6]*b+L[7]*y+L[8]*A+L[9],m=L[10]*w+L[11]*b+L[12]*y+L[13]*A+L[14],d=L[15]*w+L[16]*b+L[17]*y+L[18]*A+L[19],w=t[e+12],b=t[e+13],y=t[e+14],A=t[e+15],p=L[0]*w+L[1]*b+L[2]*y+L[3]*A+L[4],_=L[5]*w+L[6]*b+L[7]*y+L[8]*A+L[9],g=L[10]*w+L[11]*b+L[12]*y+L[13]*A+L[14],v=L[15]*w+L[16]*b+L[17]*y+L[18]*A+L[19],t[e]=~~i,t[e+1]=~~n,t[e+2]=~~r,t[e+3]=~~s,t[e+4]=~~a,t[e+5]=~~l,t[e+6]=~~h,t[e+7]=~~u,t[e+8]=~~c,t[e+9]=~~f,t[e+10]=~~m,t[e+11]=~~d,t[e+12]=~~p,t[e+13]=~~_,t[e+14]=~~g,t[e+15]=~~v;if(M)for(M<<=2,e=E-M;E>e;e+=4)w=t[e],b=t[e+1],y=t[e+2],A=t[e+3],i=L[0]*w+L[1]*b+L[2]*y+L[3]*A+L[4],n=L[5]*w+L[6]*b+L[7]*y+L[8]*A+L[9],r=L[10]*w+L[11]*b+L[12]*y+L[13]*A+L[14],s=L[15]*w+L[16]*b+L[17]*y+L[18]*A+L[19],t[e]=~~i,t[e+1]=~~n,t[e+2]=~~r,t[e+3]=~~s}}return t},apply:function(t,e){if(this._isOn&&this._matrix)if(this._worker)this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:t.getSelectedData(),params:this.serialize()});else{var i=t.getSelectedData();t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this)}return t}});h.prototype.grayscale=h.prototype.desaturate,h.prototype.rotateHue=h.prototype.adjustHue,h.prototype.thresholdRgb=h.prototype.threshold_rgb,h.prototype.thresholdAlpha=h.prototype.threshold_alpha}(FILTER),!function(t,e){"use strict";var i=t.ImArrayCopy,n=t.Color.clampPixel,r=function(t){var e=new i(256),n=0;if(t)for(;256>n;)e[n]=255-n,n++;else for(;256>n;)e[n]=n,n++;return e},s=function(t){for(var e=new i(256),n=0;256>n;)e[n]=t,n++;return e},a=function(t){return t?new i(t):null},l=Math.pow,o=Math.exp,h=1/255,u=r(),c=r(1),f=t.TableLookupFilter=t.Class(t.Filter,{name:"TableLookupFilter",constructor:function(t,e,i,n){this._tableR=t||null,this._tableG=e||this._tableR,this._tableB=i||this._tableG,this._tableA=n||null},_tableR:null,_tableG:null,_tableB:null,_tableA:null,dispose:function(){var t=this;return t.disposeWorker(),t._tableR=null,t._tableG=null,t._tableB=null,t._tableA=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_tableR:t._tableR,_tableG:t._tableG,_tableB:t._tableB,_tableA:t._tableA}}},unserialize:function(t){var e,i=this;return t&&i.name===t.filter&&(i._isOn=!!t._isOn,e=t.params,i._tableR=e._tableR,i._tableG=e._tableG,i._tableB=e._tableB,i._tableA=e._tableA),i},thresholds:function(t,e,r){t.length||(t=[t]),e||(e=t),r||(r=e);var s,a,l=t.length,o=l+1,h=e.length,u=h+1,c=r.length,f=c+1,m=new i(256),d=new i(o),p=new i(256),_=new i(u),g=new i(256),v=new i(f),w=255/(o-1),b=255/(u-1),y=255/(f-1);for(s=0;o>s;)d[s]=~~(w*s),s++;for(t[0]=~~(255*t[0]),s=1;l>s;)t[s]=t[s-1]+~~(255*t[s]),s++;for(s=0;u>s;)_[s]=~~(b*s),s++;for(e[0]=~~(255*e[0]),s=1;h>s;)e[s]=e[s-1]+~~(255*e[s]),s++;for(s=0;f>s;)v[s]=~~(y*s),s++;for(r[0]=~~(255*r[0]),s=1;c>s;)r[s]=r[s-1]+~~(255*r[s]),s++;for(s=0;256>s;){for(a=0;l>a&&s>t[a];)a++;for(m[s]=n(d[a]),a=0;h>a&&s>e[a];)a++;for(p[s]=n(_[a]),a=0;c>a&&s>r[a];)a++;g[s]=n(v[a]),s++}return this.set(m,p,g)},threshold:function(t,e,i){return t=t||.5,e=e||t,i=i||e,this.thresholds([t],[e],[i])},quantize:function(t){t===e&&(t=64),2>t&&(t=2);var r,s=new i(256),a=new i(t),l=255/(t-1),o=t/256;for(r=0;t>r;)a[r]=~~(l*r),r++;for(r=0;256>r;)s[r]=n(a[~~(o*r)]),r++;return this.set(s)},binarize:function(){return this.quantize(2)},solarize:function(t){t===e&&(t=.5);var r,s,a=0,l=new i(256),o=2/255;for(a=0;256>a;)r=o*a,s=r>t?255-255*r:255*r-255,l[a]=~~n(s),a++;return this.set(l)},solarize2:function(t){t===e&&(t=.5),t=1-t;var r,s,a=0,l=new i(256),o=2/255;for(a=0;256>a;)r=o*a,s=t>r?255-255*r:255*r-255,l[a]=~~n(s),a++;return this.set(l)},solarizeInverse:function(t){t===e&&(t=.5),t*=256;var n=0,r=new i(256);for(n=0;256>n;)r[n]=n>t?255-n:n,n++;return this.set(r)},invert:function(){return this.set(c)},mask:function(t){var e=0,r=255&t>>16,s=255&t>>8,a=255&t;for(tR=new i(256),tG=new i(256),tB=new i(256),e=0;256>e;)tR[e]=n(e&r),tG[e]=n(e&s),tB[e]=n(e&a),e++;return this.set(tR,tG,tB)},replace:function(t,e){if(t==e)return this;var i=255&t>>16,n=255&t>>8,r=255&t,s=255&e>>16,l=255&e>>8,o=255&e,h=a(u),c=a(u),f=a(u);return h[i]=s,c[n]=l,f[r]=o,this.set(h,c,f)},extract:function(e,i,r){if(!i||!i.length)return this;r=r||0;var a,l,o=255&r>>16,h=255&r>>8,u=255&r,c=s(o),f=s(h),m=s(u);switch(e){case t.CHANNEL.BLUE:for(a=i[0],l=i[1];l>=a;)m[a]=n(a),a++;break;case t.CHANNEL.GREEN:for(a=i[0],l=i[1];l>=a;)f[a]=n(a),a++;break;case t.CHANNEL.RED:default:for(a=i[0],l=i[1];l>=a;)c[a]=n(a),a++}return this.set(c,f,m)},gammaCorrection:function(t,e,r){t=t||1,e=e||t,r=r||e,t=1/t,e=1/e,r=1/r;for(var s=new i(256),a=new i(256),o=new i(256),u=0;256>u;)s[u]=n(~~(255*l(h*u,t))),a[u]=n(~~(255*l(h*u,e))),o[u]=n(~~(255*l(h*u,r))),u++;return this.set(s,a,o)},exposure:function(t){t===e&&(t=1);var r=0,s=new i(256);for(r=0;256>r;)s[r]=n(~~(255*(1-o(-t*r*h)))),r++;return this.set(s)},set:function(t,e,i){if(!t)return this;e=e||t,i=i||e;var s,l,o,h,u,c=this._tableR||r(),f=a(c);if(e&&i){for(s=this._tableG||a(c),l=this._tableB||a(s),o=a(s),h=a(l),u=0;256>u;)c[u]=n(t[n(f[u])]),s[u]=n(e[n(o[u])]),l[u]=n(i[n(h[u])]),u++;this._tableR=c,this._tableG=s,this._tableB=l}else{for(u=0;256>u;)c[u]=n(t[n(f[u])]),u++;this._tableR=c,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=this._tableG=this._tableB=this._tableA=null,this},combineWith:function(t){return this.set(t.getTable(0),t.getTable(1),t.getTable(2))},getTable:function(e){switch(e=e||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA;case t.CHANNEL.BLUE:return this._tableB;case t.CHANNEL.GREEN:return this._tableG;case t.CHANNEL.RED:default:return this._tableR}},setTable:function(e,i){switch(i=i||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA=e,this;case t.CHANNEL.BLUE:return this._tableB=e,this;case t.CHANNEL.GREEN:return this._tableG=e,this;case t.CHANNEL.RED:default:return this._tableR=e,this}},_apply:function(t){if(!this._isOn||!this._tableR)return t;var e,i,n,r,s,a=t.length,l=(a>>2)%4,o=this._tableR,h=this._tableG,u=this._tableB,c=this._tableA;if(c){for(e=0;a>e;e+=16)i=t[e],n=t[e+1],r=t[e+2],s=t[e+3],t[e]=o[i],t[e+1]=h[n],t[e+2]=u[r],t[e+3]=c[s],i=t[e+4],n=t[e+5],r=t[e+6],s=t[e+7],t[e+4]=o[i],t[e+5]=h[n],t[e+6]=u[r],t[e+7]=c[s],i=t[e+8],n=t[e+9],r=t[e+10],s=t[e+11],t[e+8]=o[i],t[e+9]=h[n],t[e+10]=u[r],t[e+11]=c[s],i=t[e+12],n=t[e+13],r=t[e+14],s=t[e+15],t[e+12]=o[i],t[e+13]=h[n],t[e+14]=u[r],t[e+15]=c[s];if(l)for(l<<=2,e=a-l;a>e;e+=4)i=t[e],n=t[e+1],r=t[e+2],s=t[e+3],t[e]=o[i],t[e+1]=h[n],t[e+2]=u[r],t[e+3]=c[s]}else{for(e=0;a>e;e+=16)i=t[e],n=t[e+1],r=t[e+2],t[e]=o[i],t[e+1]=h[n],t[e+2]=u[r],i=t[e+4],n=t[e+5],r=t[e+6],t[e+4]=o[i],t[e+5]=h[n],t[e+6]=u[r],i=t[e+8],n=t[e+9],r=t[e+10],t[e+8]=o[i],t[e+9]=h[n],t[e+10]=u[r],i=t[e+12],n=t[e+13],r=t[e+14],t[e+12]=o[i],t[e+13]=h[n],t[e+14]=u[r];if(l)for(l<<=2,e=a-l;a>e;e+=4)i=t[e],n=t[e+1],r=t[e+2],t[e]=o[i],t[e+1]=h[n],t[e+2]=u[r]}return t},apply:function(t,e){if(this._isOn&&this._tableR){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this))}return t}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(FILTER),!function(t){"use strict";var e=(t.ImArray,t.ImArrayCopy),i=t.Array16I,n=Math.min,r=(Math.max,Math.floor);t.DisplacementMapFilter=t.Class(t.Filter,{name:"DisplacementMapFilter",constructor:function(t){t&&this.setMap(t)},_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:t.MODE.CLAMP,dispose:function(){var t=this;return t.disposeWorker(),t._map=null,t.map=null,t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.red=null,t.green=null,t.blue=null,t.alpha=null,t.mode=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_map:t._map,scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color,red:t.red,green:t.green,blue:t.blue,alpha:t.alpha,mode:t.mode}}},unserialize:function(t){var e,i=this;return t&&i.name===t.filter&&(i._isOn=!!t._isOn,e=t.params,i.map=null,i._map=e._map,i.scaleX=e.scaleX,i.scaleY=e.scaleY,i.startX=e.startX,i.startY=e.startY,i.componentX=e.componentX,i.componentY=e.componentY,i.color=e.color,i.red=e.red,i.green=e.green,i.blue=e.blue,i.alpha=e.alpha,i.mode=e.mode),i},reset:function(){return this._map=null,this.map=null,this},getMap:function(){return this.map},setMap:function(t){return t&&(this.map=t,this._map={data:t.getData(),width:t.width,height:t.height}),this},setColor:function(t){return this.color=t,this.alpha=255&t>>24,this.red=255&t>>16,this.green=255&t>>8,this.blue=255&t,this},_apply:function(s,a,l){if(!this._isOn||!this._map)return s;var o,h,u,c,f,m,d,p,_,g,v,w,b,y,A,E,L,M,I,R,C,k,x,N,S,D,O,F,T,P,H,G=.00390625*this.scaleX,U=.00390625*this.scaleY,W=this.componentX,X=this.componentY,B=this.alpha,Y=this.red,z=this.green,j=this.blue,q=this.mode,K=t.MODE.IGNORE,V=(t.MODE.CLAMP,t.MODE.COLOR),Q=t.MODE.WRAP;for(o=this._map.data,h=this._map.width,u=this._map.height,c=o.length>>2,m=n(h,a),d=n(u,l),F=s.length,D=m*d<<2,O=F>>2,_=r(this.startX*(a-1)),p=r(this.startY*(l-1)),g=p*a,v=-_,w=-p,b=a-_-1,y=l-p-1,f=new i(c<<1),T=new e(s),E=0,L=0,M=0,I=0,A=0;c>A;A++,E+=2,L++)L>=h&&(L=0,M++,I+=h),x=L+I<<2,f[E]=r((o[x+W]-128)*G),f[E+1]=r((o[x+X]-128)*U);for(L=0,M=0,I=0,R=0,A=0;D>A;A+=4,L++)if(L>=m&&(L=0,M++,I+=a,R+=h),!(w>M||M>y||v>L||L>b)){if(k=L+_,C=M+p,N=k+I+g<<2,E=L+R<<1,P=k+f[E],H=C+f[E+1],H>=l||0>H||P>=a||0>P){if(q==K)continue;if(q==V){s[N]=Y,s[N+1]=z,s[N+2]=j,s[N+3]=B;continue}q==Q?(H>y?H-=l:0>H&&(H+=l),P>b?P-=a:0>P&&(P+=a)):(H>y?H=y:0>H&&(H=0),P>b?P=b:0>P&&(P=0))}S=P+H*a<<2,s[N]=T[S],s[N+1]=T[S+1],s[N+2]=T[S+2],s[N+3]=T[S+3]}return s},apply:function(t,e){if(this._isOn&&(this._map||this.map)){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this))}return t}})}(FILTER),!function(FILTER,undef){"use strict";var IMG=FILTER.ImArray,IMGcopy=FILTER.ImArrayCopy,PI=FILTER.CONSTANTS.PI,DoublePI=FILTER.CONSTANTS.PI2,HalfPI=FILTER.CONSTANTS.PI_2,ThreePI2=1.5*PI,Sqrt=Math.sqrt,Atan2=Math.atan2,Atan=Math.atan,Sin=Math.sin,Cos=Math.cos,Floor=Math.floor,Asin=Math.asin,Tan=Math.tan,Abs=Math.abs,Max=Math.max,toRad=FILTER.CONSTANTS.toRad,Maps,GeometricMapFilter=FILTER.GeometricMapFilter=FILTER.Class(FILTER.Filter,{name:"GeometricMapFilter",constructor:function(t){t&&this.generic(t)},_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:FILTER.MODE.CLAMP,dispose:function(){var t=this;return t.disposeWorker(),t._map=null,t._mapName=null,t.inverseTransform=null,t.matrix=null,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.wavelength=null,t.amplitude=null,t.phase=null,t.xAmplitude=null,t.yAmplitude=null,t.xWavelength=null,t.yWavelength=null,t.mode=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_mapName:t._mapName,inverseTransform:t.inverseTransform?t.inverseTransform.toString():null,matrix:t.matrix,centerX:t.centerX,centerY:t.centerY,angle:t.angle,radius:t.radius,wavelength:t.wavelength,amplitude:t.amplitude,phase:t.phase,xAmplitude:t.xAmplitude,yAmplitude:t.yAmplitude,xWavelength:t.xWavelength,yWavelength:t.yWavelength,mode:t.mode}}},unserialize:function(json){var self=this,params;return json&&self.name===json.filter&&(self._isOn=!!json._isOn,params=json.params,self.inverseTransform=null,self.matrix=params.matrix,self.centerX=params.centerX,self.centerY=params.centerY,self.angle=params.angle,self.radius=params.radius,self.wavelength=params.wavelength,self.amplitude=params.amplitude,self.phase=params.phase,self.xAmplitude=params.xAmplitude,self.yAmplitude=params.yAmplitude,self.xWavelength=params.xWavelength,self.yWavelength=params.yWavelength,self.mode=params.mode,params.inverseTransform&&(self.inverseTransform=eval('(function(){ "use strict"; return '+params.inverseTransform+"})();")),self._mapName=params._mapName,self._map=null,self._mapName&&Maps[self._mapName]&&(self._map=Maps[self._mapName].bind(self))),self},generic:function(t){return t&&(this.inverseTransform=t,this._mapName="generic",this._map=Maps.generic.bind(this)),this},affine:function(t){return t&&(this.matrix=t,this._mapName="affine",this._map=Maps.affine.bind(this)),this},flipX:function(){return this._mapName="flipX",this._map=Maps.flipX.bind(this),this},flipY:function(){return this._mapName="flipY",this._map=Maps.flipY.bind(this),this},flipXY:function(){return this._mapName="flipXY",this._map=Maps.flipXY.bind(this),this},rotateCW:function(){return this._mapName="rotateCW",this._map=Maps.rotateCW.bind(this),this},rotateCCW:function(){return this._mapName="rotateCCW",this._map=Maps.rotateCCW.bind(this),this},polar:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._mapName="polar",this._map=Maps.polar.bind(this),this},cartesian:function(t,e){return this.centerX=t||0,this.centerY=e||0,this._mapName="cartesian",this._map=Maps.cartesian.bind(this),this},twirl:function(t,e,i,n){return this.angle=t||0,this.radius=e||0,this.centerX=i||0,this.centerY=n||0,this._mapName="twirl",this._map=Maps.twirl.bind(this),this},sphere:function(t,e,i){return this.radius=t||0,this.centerX=e||0,this.centerY=i||0,this._mapName="sphere",this._map=Maps.sphere.bind(this),this},ripple:function(t,e,i,n,r,s){return this.radius=t!==undef?t:50,this.centerX=r||0,this.centerY=s||0,this.wavelength=e!==undef?e:16,this.amplitude=i!==undef?i:10,this.phase=n||0,this._mapName="ripple",this._map=Maps.ripple.bind(this),this},reset:function(){return this._mapName=null,this._map=null,this},getMap:function(){return this._map},setMap:function(t){return this._mapName=null,this._map=t,this},_apply:function(t,e,i,n){return this._isOn&&this._map?this._map(t,e,i,n):t},apply:function(t,e){if(this._isOn&&this._map){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._map(i[0],i[1],i[2],t)),e&&e.call(this))}return t}});Maps={generic:function(t,e,i){var n,r,s,a,l,o,h,u=t.length,c=new IMG(u),f=this.inverseTransform,m=this.mode,d=FILTER.MODE.CLAMP,p=FILTER.MODE.WRAP;for(n=0,r=0,s=0;u>s;s+=4,n++){if(n>=e&&(n=0,r++),l=f([n,r],e,i),o=~~l[0],h=~~l[1],0>o||o>=e||0>h||h>=i)switch(m){case p:h>=i?h-=i:0>h&&(h+=i),o>=e?o-=e:0>o&&(o+=e);break;case d:default:h>=i?h=i-1:0>h&&(h=0),o>=e?o=e-1:0>o&&(o=0)}a=o+h*e<<2,c[s]=t[a],c[s+1]=t[a+1],c[s+2]=t[a+2],c[s+3]=t[a+3]}return c},affine:function(t,e){var i,n,r,s,a,l,o,h,u,c=t.length,f=c>>2,m=new IMG(c),d=this.matrix,p=d[0],_=d[1],g=d[3],v=d[4],w=d[2],b=d[5],y=this.mode,A=FILTER.MODE.CLAMP,E=FILTER.MODE.WRAP,L=e-1,M=f-e;for(i=0,n=0,a=b*e,l=g*e,o=v*e,r=0;c>r;r+=4,i++){if(i>=e&&(i=0,n++),h=~~(p*i+_*n+w),u=~~(l*i+o*n+a),0>h||h>L||0>u||u>M)switch(y){case E:u>M?u-=f:0>u&&(u+=f),h>=e?h-=e:0>h&&(h+=e);break;case A:default:u>M?u=M:0>u&&(u=0),h>L?h=L:0>h&&(h=0)}s=h+u<<2,m[r]=t[s],m[r+1]=t[s+1],m[r+2]=t[s+2],m[r+3]=t[s+3]}return m},flipX:function(t,e){var i,n,r,s,a,l=t.length,o=new IMG(l);for(i=0,n=0,r=0,s=0;l>s;s+=4,i++)i>=e&&(i=0,n++,r+=e),a=e-1-i+r<<2,o[s]=t[a],o[s+1]=t[a+1],o[s+2]=t[a+2],o[s+3]=t[a+3];return o},flipY:function(t,e,i){var n,r,s,a,l,o=t.length,h=new IMG(o);for(n=0,r=0,s=(i-1)*e,a=0;o>a;a+=4,n++)n>=e&&(n=0,r++,s-=e),l=n+s<<2,h[a]=t[l],h[a+1]=t[l+1],h[a+2]=t[l+2],h[a+3]=t[l+3];return h},flipXY:function(t,e,i){var n,r,s,a,l,o,h=t.length,u=new IMG(h);
for(n=0,r=0,a=(i-1)*e,l=0;h>l;l+=4,n++)n>=e&&(n=0,r++,s+=e,a-=e),o=e-1-n+a<<2,u[l]=t[o],u[l+1]=t[o+1],u[l+2]=t[o+2],u[l+3]=t[o+3];return u},rotateCW:function(t,e){var i,n,r,s,a,l=t.length,o=new IMG(l),h=l>>2;for(i=0,n=0,r=h-1,s=0;l>s;s+=4,i++,r-=e)i>=e&&(i=0,r=h-1,n++),a=n+r<<2,o[s]=t[a],o[s+1]=t[a+1],o[s+2]=t[a+2],o[s+3]=t[a+3];return o},rotateCCW:function(t,e){var i,n,r,s,a,l=t.length,o=new IMG(l);for(i=0,n=0,r=0,s=0;l>s;s+=4,i++,r+=e)i>=e&&(i=0,r=0,n++),a=e-1-n+r<<2,o[s]=t[a],o[s+1]=t[a+1],o[s+2]=t[a+2],o[s+3]=t[a+3];return o},twirl:function(t,e,i){if(0>=this.radius)return t;var n,r,s,a,l,o,h,u,c=t.length,f=new IMGcopy(t),m=this.centerX,d=this.centerY,p=this.angle,_=this.radius,g=this.mode,v=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,b=p/_,y=e-1,A=i-1;for(m=Floor(m*(e-1)),d=Floor(d*(i-1)),n=0,r=0,s=0;c>s;s+=4,n++)if(n>=e&&(n=0,r++),o=n-m,h=r-d,l=Sqrt(o*o+h*h),_>l){if(u=Atan2(h,o)+b*(_-l),o=~~(m+l*Cos(u)),h=~~(d+l*Sin(u)),0>o||o>y||0>h||h>A)switch(g){case w:h>A?h-=i:0>h&&(h+=i),o>y?o-=e:0>o&&(o+=e);break;case v:default:h>A?h=A:0>h&&(h=0),o>y?o=y:0>o&&(o=0)}a=o+h*e<<2,t[s]=f[a],t[s+1]=f[a+1],t[s+2]=f[a+2],t[s+3]=f[a+3]}return t},sphere:function(t,e,i){if(0>=this.radius)return t;var n,r,s,a,l,o,h,u,c,f,m,d,p,_=t.length,g=new IMGcopy(t),v=this.centerX,w=this.centerY,b=this.radius,y=this.mode,A=FILTER.MODE.CLAMP,E=FILTER.MODE.WRAP,L=b*b,M=.555556,I=1-M,R=e-1,C=i-1;for(v=Floor(v*(e-1)),w=Floor(w*(i-1)),n=0,r=0,s=0;_>s;s+=4,n++)if(n>=e&&(n=0,r++),l=n-v,o=r-w,d=l*l,p=o*o,h=d+p,L>h){if(f=L-h,m=Sqrt(f),u=Asin(l/Sqrt(d+f))*I,c=Asin(o/Sqrt(p+f))*I,l=~~(n-m*Tan(u)),o=~~(r-m*Tan(c)),0>l||l>R||0>o||o>C)switch(y){case E:o>C?o-=i:0>o&&(o+=i),l>R?l-=e:0>l&&(l+=e);break;case A:default:o>C?o=C:0>o&&(o=0),l>R?l=R:0>l&&(l=0)}a=l+o*e<<2,t[s]=g[a],t[s+1]=g[a+1],t[s+2]=g[a+2],t[s+3]=g[a+3]}return t},ripple:function(t,e,i){if(0>=this.radius)return t;var n,r,s,a,l,o,h,u,c,f,m,d=t.length,p=new IMGcopy(t),_=FILTER.MODE.CLAMP,g=FILTER.MODE.WRAP,v=e-1,w=i-1,b=this.centerX,y=this.centerY,A=this.radius,E=this.mode,L=A*A,M=this.wavelength,I=this.amplitude,R=this.phase;for(b=Floor(b*(e-1)),y=Floor(y*(i-1)),n=0,r=0,s=0;d>s;s+=4,n++)if(n>=e&&(n=0,r++),o=n-b,h=r-y,f=o*o,m=h*h,c=f+m,L>c){if(l=Sqrt(c),u=I*Sin(2*l/M*Math.PI-R),u*=(A-l)/A,l&&(u*=M/l),o=~~(n+o*u),h=~~(r+h*u),0>o||o>v||0>h||h>w)switch(E){case g:h>w?h-=i:0>h&&(h+=i),o>v?o-=e:0>o&&(o+=e);break;case _:default:h>w?h=w:0>h&&(h=0),o>v?o=v:0>o&&(o=0)}a=o+h*e<<2,t[s]=p[a],t[s+1]=p[a+1],t[s+2]=p[a+2],t[s+3]=p[a+3]}return t},polar:function(t,e,i){var n,r,s,a,l,o,h,u,c,f,m,d,p=t.length,_=new IMGcopy(t),g=FILTER.MODE.CLAMP,v=FILTER.MODE.WRAP,w=e-1,b=i-1,y=0,A=this.mode;for(m=~~(.5*e+.5),d=~~(.5*i+.5),f=Max(d,m),n=0,r=0,s=0;p>s;s+=4,n++){if(n>=e&&(n=0,r++),a=n-m,l=r-d,c=0,a>=0?l>0?(c=PI-Atan(a/l),y=Sqrt(a*a+l*l)):0>l?(c=Atan(a/l),y=Sqrt(a*a+l*l)):(c=HalfPI,y=a):0>a&&(0>l?(c=DoublePI-Atan(a/l),y=Sqrt(a*a+l*l)):l>0?(c=PI+Atan(a/l),y=Sqrt(a*a+l*l)):(c=ThreePI2,y=-a)),o=e-1-(e-1)/DoublePI*c,h=i*y/f,0>o||o>w||0>h||h>b)switch(A){case v:h>b?h-=i:0>h&&(h+=i),o>w?o-=e:0>o&&(o+=e);break;case g:default:h>b?h=b:0>h&&(h=0),o>w?o=w:0>o&&(o=0)}u=~~(o+.5)+~~(h+.5)*e<<2,t[s]=_[u],t[s+1]=_[u+1],t[s+2]=_[u+2],t[s+3]=_[u+3]}return t},cartesian:function(t,e,i){var n,r,s,a,l,o,h,u,c,f,m,d,p,_=t.length,g=new IMGcopy(t),v=FILTER.MODE.CLAMP,w=FILTER.MODE.WRAP,b=e-1,y=i-1,A=0,E=this.mode;for(d=~~(.5*e+.5),p=~~(.5*i+.5),m=Max(p,d),n=0,r=0,s=0;_>s;s+=4,n++){if(n>=e&&(n=0,r++),c=n/e*DoublePI,f=c>=ThreePI2?DoublePI-c:c>=PI?c-PI:c>=HalfPI?PI-c:c,A=m*(r/i),h=-A*Sin(f),u=A*Cos(f),c>=ThreePI2?(a=d-h,l=p-u):c>=PI?(a=d-h,l=p+u):c>=HalfPI?(a=d+h,l=p+u):(a=d+h,l=p-u),0>a||a>b||0>l||l>y)switch(E){case w:l>y?l-=i:0>l&&(l+=i),a>b?a-=e:0>a&&(a+=e);break;case v:default:l>y?l=y:0>l&&(l=0),a>b?a=b:0>a&&(a=0)}o=~~(a+.5)+~~(l+.5)*e<<2,t[s]=g[o],t[s+1]=g[o+1],t[s+2]=g[o+2],t[s+3]=g[o+3]}return t}}}(FILTER),!function(t,e){"use strict";function i(t,e,i,n){var r,s=t.length,a=new b(t.length);for(i=i||1,n=n||1,r=0;s>r;)a[r]=i*t[r]+n*e[r],r++;return a}function n(t,e){var i,n,r,s=t.length,a=[],l=0;for(i=0;s>i;i++)for(n=0;s>n;n++)r=t[i]*e[n],l+=r,a.push(r);return{kernel:a,sum:l}}function r(t){var e,i=new Array(t);for(e=0;t>e;)i[e]=1,e++;return i}function s(t){var e,i,n,r,s=M.length;if(t--,s>t)e=new b(M[t]);else for(e=new b(M[s-1]);t>=s;){for(i=e,e=new b(i.length+1),e[0]=1,n=0,r=i.length-1;r>n;n++)e[n+1]=i[n]+i[n+1];e[i.length]=1,40>s&&M.push(new Array(e)),s++}return e}function a(t){var e,i=t>>1,n=-i,r=new Array(t);for(e=0;t>e;)r[e]=n,n++,e++;return r}function l(t){var e=s(t);return n(e,e)}function o(t,e){var i=s(t),r=a(t);return 1==e?n(r.reverse(),i):n(i,r)}function h(t,e){var i=r(t),s=a(t);return 1==e?n(s.reverse(),i):n(i,s)}function u(t,e,i){e=e||1,i=i||e;var n,r=t*t,s=r>>1,a=new b(r);for(n=0;r>n;)a[n]=e,n++;return a[s]=i,a}function c(t,e,i,n){var r,s,a,l,o,h=t*t,u=t>>1,c=h>>1,f=new b(h);for(l=0,r=0;u>=r;r++){for(s=0,o=0,a=0;u>=a;a++)f[c+r+s]=l+o,f[c-r-s]=-l-o,f[c-r+s]=-l+o,f[c+r-s]=l-o,s+=t,o+=i;l+=e}return f[c]=n||1,f}function f(t,e,i,n){var r,s,a,l,o,h,u=t*t,c=t>>1,f=u>>1,m=new b(u),d=new b(u),p=1/t,g=1e-8;for(_(e)>g?(o=1,h=i/e):(o=e/i,h=1),r=0,a=0,l=0,s=h*t;c>=r;)d[f+r]=~~(f+a+l+.5),d[f-r]=~~(f-a-l+.5),r++,a+=o,l+=s;for(r=0;c>=r;)m[d[f+r]]=m[d[f-r]]=p,r++;return m[f]=n||1,m}function m(t,e,i,n,r,s,a,l,o,h){var u,c,f,m,d,p,_,g,v,w,b,E,M,I,R,C,k,x,N,S,D,O,F,T,P,H,G,U,W,X,B,Y,z,j,q,K,V,Q,$,J,Z,te,ee,ie,ne,re,se,ae=t.length,le=ae>>2,oe=s,he=a;if(g=oe*he,p=oe>>1,_=e*(he>>1),b=-p-1,M=-_-e,E=p,I=_,X=0,Y=e-1,B=0,z=le-e,c=(le<<1)+le,w=(e<<1)+e,h=h||1,se=0,r)for(S=n[0],D=n[g>>1],O=D-S,F=r[0],T=r[g>>1],P=T-F;h>se;){for(v=new y(ae),u=new A(c),R=0,C=0,f=m=d=0,k=0;e>k;k++,R+=4,C+=3)f+=t[R],m+=t[R+1],d+=t[R+2],u[C]=f,u[C+1]=m,u[C+2]=d;for(C=0,k=0,f=m=d=0,R=w+e;ae>R;R+=4,C+=3,k++)k>=e&&(k=0,f=m=d=0),f+=t[R],m+=t[R+1],d+=t[R+2],u[C+w]=u[C]+f,u[C+w+1]=u[C+1]+m,u[C+w+2]=u[C+2]+d;for(k=0,x=0,N=0,R=0;ae>R;R+=4,k++)k>=e&&(k=0,x++,N+=e),H=k+b,G=N+M,U=k+E,W=N+I,H=X>H?X:H,U=U>Y?Y:U,G=B>G?B:G,W=W>z?z:W,j=H+G,V=U+W,q=U+G,K=H+W,j=(j<<1)+j,q=(q<<1)+q,K=(K<<1)+K,V=(V<<1)+V,Z=S*(u[V]-u[q]-u[K]+u[j])+O*t[R],te=S*(u[V+1]-u[q+1]-u[K+1]+u[j+1])+O*t[R+1],ee=S*(u[V+2]-u[q+2]-u[K+2]+u[j+2])+O*t[R+2],ie=F*(u[V]-u[q]-u[K]+u[j])+P*t[R],ne=F*(u[V+1]-u[q+1]-u[K+1]+u[j+1])+P*t[R+1],re=F*(u[V+2]-u[q+2]-u[K+2]+u[j+2])+P*t[R+2],Q=l*Z+o*ie,$=l*te+o*ne,J=l*ee+o*re,L&&(Q=0>Q?0:Q>255?255:Q,$=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J),v[R]=~~Q,v[R+1]=~~$,v[R+2]=~~J,v[R+3]=t[R+3];t=v,se++}else for(S=n[0],D=n[g>>1],O=D-S;h>se;){for(v=new y(ae),u=new A(c),R=0,C=0,f=m=d=0,k=0;e>k;k++,R+=4,C+=3)f+=t[R],m+=t[R+1],d+=t[R+2],u[C]=f,u[C+1]=m,u[C+2]=d;for(C=0,k=0,f=m=d=0,R=w+e;ae>R;R+=4,C+=3,k++)k>=e&&(k=0,f=m=d=0),f+=t[R],m+=t[R+1],d+=t[R+2],u[C+w]=u[C]+f,u[C+w+1]=u[C+1]+m,u[C+w+2]=u[C+2]+d;for(k=0,x=0,N=0,R=0;ae>R;R+=4,k++)k>=e&&(k=0,x++,N+=e),H=k+b,G=N+M,U=k+E,W=N+I,H=X>H?X:H,U=U>Y?Y:U,G=B>G?B:G,W=W>z?z:W,j=H+G,V=U+W,q=U+G,K=H+W,j=(j<<1)+j,q=(q<<1)+q,K=(K<<1)+K,V=(V<<1)+V,Z=S*(u[V]-u[q]-u[K]+u[j])+O*t[R],te=S*(u[V+1]-u[q+1]-u[K+1]+u[j+1])+O*t[R+1],ee=S*(u[V+2]-u[q+2]-u[K+2]+u[j+2])+O*t[R+2],Q=l*Z+o,$=l*te+o,J=l*ee+o,L&&(Q=0>Q?0:Q>255?255:Q,$=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J),v[R]=~~Q,v[R+1]=~~$,v[R+2]=~~J,v[R+3]=t[R+3];t=v,se++}return v}function d(t,e,i,n,r,s,a,l,o){var h,u,c,f,m,d,p,_,g,v,w,b,A,M,I,R,C,k,x,N,S,D,O,F,T,P,H,G=t.length,U=G>>2;for(h=[r,n],u=[a,s],T=[o,l],R=e-1,C=U-e,H=2;H--;){for(p=new y(G),f=h[H],m=u[H],c=f.length,d=m.length,P=T[H],_=new E(m),w=0;d>w;w+=2)_[w+1]*=e;if(L)for(b=0,A=0,g=0;G>g;g+=4,b++){for(b>=e&&(b=0,A+=e),D=0,O=0,F=0,w=0,v=0;c>w;w++,v+=2)M=b+_[v],I=A+_[v+1],M>=0&&R>=M&&I>=0&&C>=I&&(srcOff=M+I<<2,S=f[w],D+=t[srcOff]*S,O+=t[srcOff+1]*S,F+=t[srcOff+2]*S);k=P*D,x=P*O,N=P*F,k=0>k?0:k>255?255:k,x=0>x?0:x>255?255:x,N=0>N?0:N>255?255:N,p[g]=~~k,p[g+1]=~~x,p[g+2]=~~N,p[g+3]=t[g+3]}else for(b=0,A=0,g=0;G>g;g+=4,b++){for(b>=e&&(b=0,A+=e),D=0,O=0,F=0,w=0,v=0;c>w;w++,v+=2)M=b+_[v],I=A+_[v+1],M>=0&&R>=M&&I>=0&&C>=I&&(srcOff=M+I<<2,S=f[w],D+=t[srcOff]*S,O+=t[srcOff+1]*S,F+=t[srcOff+2]*S);k=P*D,x=P*O,N=P*F,p[g]=~~k,p[g+1]=~~x,p[g+2]=~~N,p[g+3]=t[g+3]}t=p}return p}var p=(t.CONSTANTS.SQRT2,t.CONSTANTS.toRad),_=(t.CONSTANTS.toDeg,Math.abs),g=Math.sqrt,v=Math.sin,w=Math.cos,b=t.Array32F,y=t.ImArray,A=t.Array32F,E=t.Array16I,L=(t.Array8U,t._notSupportClamp),M=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],I=t.ConvolutionMatrixFilter=t.Class(t.Filter,{name:"ConvolutionMatrixFilter",constructor:function(e,i,n){this._coeff=new b([1,0]),e&&e.length?this.set(e,~~(g(e.length)+.5),i||1,n||0):(this._matrix=null,this._dim=0),this._matrix2=null,this._dim2=0,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,t.useWebGL&&(this._webglInstance=t.WebGLConvolutionMatrixFilterInstance||null)},_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_webglInstance:null,dispose:function(){var t=this;return t.disposeWorker(),t._webglInstance=null,t._dim=null,t._dim2=null,t._matrix=null,t._matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_dim:t._dim,_dim2:t._dim2,_matrix:t._matrix,_matrix2:t._matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2}}},unserialize:function(t){var e,i=this;return t&&i.name===t.filter&&(i._isOn=!!t._isOn,e=t.params,i._dim=e._dim,i._dim2=e._dim2,i._matrix=e._matrix,i._matrix2=e._matrix2,i._mat=e._mat,i._mat2=e._mat2,i._coeff=e._coeff,i._isGrad=e._isGrad,i._doIntegral=e._doIntegral,i._doSeparable=e._doSeparable,i._indices=e._indices,i._indices2=e._indices2,i._indicesf=e._indicesf,i._indicesf2=e._indicesf2),i},lowPass:function(t){return t=t===e?3:t%2?t:t+1,this.set(u(t),t,1/(t*t),0),this._doIntegral=1,this},highPass:function(t,i){t=t===e?3:t%2?t:t+1,i=i===e?1:i;var n=t*t,r=-i/n,s=u(t,r,1+r);return this.set(s,t,1,0),this._doIntegral=1,this},glow:function(t,i){return t=t===e?.5:t,this.highPass(i,-t)},sharpen:function(t,i){return t=t===e?.5:t,this.highPass(i,t)},verticalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(r(t),1,1/t,0),this._dim2=t,this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(r(t),t,1/t,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(t,i){i=i===e?3:i%2?i:i+1,t*=p;var n=w(t),r=-v(t),s=f(i,n,r,1/i);return this.set(s,i,1,0)},fastGauss:function(t,i){return i=i===e?3:i%2?i:i+1,t=~~(t||1),1>t?t=1:t>3&&(t=3),this.set(u(i),i,1/(i*i),0),this._doIntegral=t,this},binomialLowPass:function(t){t=t===e?3:t%2?t:t+1;var i=s(t),n=1<<t-1,r=1/n;this.set(i,t,r,r),this._matrix2=new b(i);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this._doSeparable=!0,this},binomialHighPass:function(t){t=t===e?3:t%2?t:t+1;var n=l(t);return this.set(i(u(t),new b(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t=t===e?3:t%2?t:t+1;var i=h(t,0);return this.set(i.kernel,t,1,0)},prewittY:function(t){t=t===e?3:t%2?t:t+1;var i=h(t,1);return this.set(i.kernel,t,1,0)},prewittDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=p;var r=w(t),s=v(t),a=h(n,0),l=h(n,1);return this.set(i(new b(a.kernel),new b(l.kernel),r,s),n,1,0)},prewitt:function(t){t=t===e?3:t%2?t:t+1;var i=h(t,0),n=h(t,1);this.set(i.kernel,t,1,0),this._isGrad=!0,this._matrix2=new b(n.kernel);var r=this._computeIndices(this._matrix2,this._dim2);return this._indices2=r[0],this._indicesf2=r[1],this._mat2=r[2],this},sobelX:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,0);return this.set(i.kernel,t,1,0)},sobelY:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,1);return this.set(i.kernel,t,1,0)},sobelDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=p;var r=w(t),s=v(t),a=o(n,0),l=o(n,1);return this.set(i(new b(a.kernel),new b(l.kernel),r,s),n,1,0)},sobel:function(t){t=t===e?3:t%2?t:t+1;var i=o(t,0),n=o(t,1);this.set(i.kernel,t,1,0),this._matrix2=new b(n.kernel);var r=this._computeIndices(this._matrix2,this._dim2);return this._indices2=r[0],this._indicesf2=r[1],this._mat2=r[2],this._isGrad=!0,this},laplace:function(t){t=t===e?3:t%2?t:t+1;var i=t*t,n=u(t,-1,i-1);return this.set(n,t,1,0),this._doIntegral=1,this},emboss:function(t,i,n){n=n===e?3:n%2?n:n+1,t=t===e?-.25*Math.PI:t*p,i=i||1;var r=i*w(t),s=-i*v(t),a=c(n,r,s,1);return this.set(a,n,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,i,n){this._matrix2=null,this._dim2=0,this._indices2=this._indicesf2=null,this._mat2=null,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,this._matrix=new b(t),this._dim=e,this._coeff[0]=i||1,this._coeff[1]=n||0;var r=this._computeIndices(this._matrix,this._dim);return this._indices=r[0],this._indicesf=r[1],this._mat=r[2],this},_computeIndices:function(t,e){var i,n,r,s=[],a=[],l=[],o=t.length,h=e,u=h>>1;for(n=0,r=0,i=0;o>i;)a.push(n-u),a.push(r-u),t[i]&&(s.push(n-u),s.push(r-u),l.push(t[i])),i++,n++,n>=h&&(n=0,r++);return[new E(s),new E(a),new b(l)]},reset:function(){return this._matrix=this._matrix2=null,this._mat=this._mat2=null,this._dim=this._dim2=0,this._indices=this._indices2=this._indicesf=this._indicesf2=null,this._isGrad=!1,this._doIntegral=0,this._doSeparable=!1,this},combineWith:function(){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this.set(t,e)},_apply:function(t,e,i){if(!this._isOn||!this._matrix)return t;if(this._doIntegral)return this._matrix2?m(t,e,i,this._matrix,this._matrix2,this._dim,this._dim2,this._coeff[0],this._coeff[1],this._doIntegral):m(t,e,i,this._matrix,null,this._dim,this._dim,this._coeff[0],this._coeff[1],this._doIntegral);if(this._doSeparable)return d(t,e,i,this._mat,this._mat2,this._indices,this._indices2,this._coeff[0],this._coeff[1]);var n,r,s,a,l,o,h,u,c,f,p,g,v,w,b,A,M,I,R,C,k,x,N=t.length,S=N>>2,D=new y(N),O=e-1,F=S-e,T=this._coeff[0],P=this._coeff[1],H=this._matrix,G=this._matrix2,U=this._isGrad;if(G){for(C=this._indicesf.length,x=new E(this._indicesf),o=0;C>o;o+=2)x[o+1]*=e;for(k=H.length,h=0,u=0,a=0;N>a;a+=4,h++){for(h>=e&&(h=0,u+=e),g=0,v=0,w=0,b=0,A=0,M=0,o=0,l=0;k>o;o++,l+=2)c=h+x[l],f=u+x[l+1],c>=0&&O>=c&&f>=0&&F>=f&&(p=c+f<<2,I=H[o],g+=t[p]*I,v+=t[p+1]*I,w+=t[p+2]*I,R=G[o],b+=t[p]*R,A+=t[p+1]*R,M+=t[p+2]*R);U?(n=_(g)+_(b),r=_(v)+_(A),s=_(w)+_(M)):(n=T*g+P*b,r=T*v+P*A,s=T*w+P*M),L&&(n=0>n?0:n>255?255:n,r=0>r?0:r>255?255:r,s=0>s?0:s>255?255:s),D[a]=~~n,D[a+1]=~~r,D[a+2]=~~s,D[a+3]=t[a+3]}}else{for(C=this._indices.length,x=new E(this._indices),o=0;C>o;o+=2)x[o+1]*=e;for(H=this._mat,k=H.length,h=0,u=0,a=0;N>a;a+=4,h++){for(h>=e&&(h=0,u+=e),g=0,v=0,w=0,o=0,l=0;k>o;o++,l+=2)c=h+x[l],f=u+x[l+1],c>=0&&O>=c&&f>=0&&F>=f&&(p=c+f<<2,I=H[o],g+=t[p]*I,v+=t[p+1]*I,w+=t[p+2]*I);n=T*g+P,r=T*v+P,s=T*w+P,L&&(n=0>n?0:n>255?255:n,r=0>r?0:r>255?255:r,s=0>s?0:s>255?255:s),D[a]=~~n,D[a+1]=~~r,D[a+2]=~~s,D[a+3]=t[a+3]}}return D},apply:function(t,e){if(this._isOn&&this._matrix)if(this._worker)this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:t.getSelectedData(),params:this.serialize()});else{var i=t.getSelectedData();t.setSelectedData(this._apply(i[0],i[1],i[2],t)),e&&e.call(this)}return t}});I.prototype.bump=I.prototype.emboss,I.prototype.boxBlur=I.prototype.lowPass,I.prototype.gaussBlur=I.prototype.binomialLowPass,I.prototype.gradX=I.prototype.prewittX,I.prototype.gradY=I.prototype.prewittY,I.prototype.gradDirectional=I.prototype.prewittDirectional,I.prototype.grad=I.prototype.prewitt}(FILTER),!function(t){"use strict";var e,i=t.ImArray,n=t.Array8U,r=t.Array32I,s=Math.sqrt,a=function(t){var e,i=t*t,r=new n(i);for(e=0;i>e;e++)r[e]=1;return r},l=a(3);t.MorphologicalFilter=t.Class(t.Filter,{name:"MorphologicalFilter",constructor:function(){this._filterName=null,this._filter=null,this._dim=0,this._structureElement=null,this._indices=null},_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var t=this;return t.disposeWorker(),t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}}},unserialize:function(t){var i,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,i=t.params,n._dim=i._dim,n._structureElement=i._structureElement,n._indices=i._indices,n._filterName=i._filterName,n._filterName&&e[n._filterName]&&(n._filter=e[n._filterName].bind(n))),n},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},set:function(t,i){this._filterName=i,this._filter=e[i].bind(this),t&&t.length?(this._structureElement=new n(t),this._dim=~~(s(this._structureElement.length)+.5)):t&&t===t-0?(this._structureElement=a(t),this._dim=t):(this._structureElement=l,this._dim=3);var o,h,u,c=[],t=this._structureElement,f=t.length,m=this._dim,d=m>>1;for(h=0,u=0,o=0;f>o;)t[o]&&(c.push(h-d),c.push(u-d)),o++,h++,h>=m&&(h=0,u++);return this._indices=new r(c),this},reset:function(){return this._filterName=null,this._filter=null,this._dim=0,this._structureElement=null,this._indices=null,this},_apply:function(t,e,i){return this._isOn&&this._dim&&this._filter?this._filter(t,e,i):t},apply:function(t,e){if(this._isOn&&this._dim&&this._filter){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._filter(i[0],i[1],i[2],t)),e&&e.call(this))}return t}}),e={dilate:function(t,e){var n,s,a,l,o,h,u,c,f,m,d,p,_,g,v=this._structureElement,w=(v.length,this._dim,new r(this._indices)),b=t.length,y=b>>2,A=new i(b),E=w.length,L=E>>1,M=e-1,I=y-e;for(a=0;E>a;a+=2)w[a+1]*=e;for(l=0,o=0,n=0;b>n;n+=4,l++){for(l>=e&&(l=0,o+=e),p=0,_=0,g=0,s=0;L>s;s+=2)h=l+w[s],u=o+w[s+1],h>=0&&M>=h&&u>=0&&I>=u&&(c=h+u<<2,f=t[c],m=t[c+1],d=t[c+2],f>p&&(p=f),m>_&&(_=m),d>g&&(g=d));A[n]=p,A[n+1]=_,A[n+2]=g,A[n+3]=t[n+3]}return A},erode:function(t,e){var n,s,a,l,o,h,u,c,f,m,d,p,_,g,v=this._structureElement,w=(v.length,this._dim,new r(this._indices)),b=t.length,y=b>>2,A=new i(b),E=w.length,L=E>>1,M=e-1,I=y-e;for(a=0;E>a;a+=2)w[a+1]*=e;for(l=0,o=0,n=0;b>n;n+=4,l++){for(l>=e&&(l=0,o+=e),p=255,_=255,g=255,s=0;L>s;s+=2)h=l+w[s],u=o+w[s+1],h>=0&&M>=h&&u>=0&&I>=u&&(c=h+u<<2,f=t[c],m=t[c+1],d=t[c+2],p>f&&(p=f),_>m&&(_=m),g>d&&(g=d));A[n]=p,A[n+1]=_,A[n+2]=g,A[n+3]=t[n+3]}return A},open:function(t,e){var n,s,a,l,o,h,u,c,f,m,d,p,_,g,v=this._structureElement,w=(v.length,this._dim,new r(this._indices)),b=t.length,y=b>>2,A=new i(b),E=w.length,L=E>>1,M=e-1,I=y-e;for(a=0;E>a;a+=2)w[a+1]*=e;for(l=0,o=0,n=0;b>n;n+=4,l++){for(l>=e&&(l=0,o+=e),p=255,_=255,g=255,s=0;L>s;s+=2)h=l+w[s],u=o+w[s+1],h>=0&&M>=h&&u>=0&&I>=u&&(c=h+u<<2,f=t[c],m=t[c+1],d=t[c+2],p>f&&(p=f),_>m&&(_=m),g>d&&(g=d));A[n]=p,A[n+1]=_,A[n+2]=g,A[n+3]=t[n+3]}for(t=A,A=new i(b),l=0,o=0,n=0;b>n;n+=4,l++){for(l>=e&&(l=0,o+=e),p=255,_=255,g=255,s=0;L>s;s+=2)h=l+w[s],u=o+w[s+1],h>=0&&M>=h&&u>=0&&I>=u&&(c=h+u<<2,f=t[c],m=t[c+1],d=t[c+2],p>f&&(p=f),_>m&&(_=m),g>d&&(g=d));A[n]=p,A[n+1]=_,A[n+2]=g,A[n+3]=t[n+3]}return A},close:function(t,e){var n,s,a,l,o,h,u,c,f,m,d,p,_,g,v=this._structureElement,w=(v.length,this._dim,new r(this._indices)),b=t.length,y=b>>2,A=new i(b),E=w.length,L=E>>1,M=e-1,I=y-e;for(a=0;E>a;a+=2)w[a+1]*=e;for(l=0,o=0,n=0;b>n;n+=4,l++){for(l>=e&&(l=0,o+=e),p=255,_=255,g=255,s=0;L>s;s+=2)h=l+w[s],u=o+w[s+1],h>=0&&M>=h&&u>=0&&I>=u&&(c=h+u<<2,f=t[c],m=t[c+1],d=t[c+2],p>f&&(p=f),_>m&&(_=m),g>d&&(g=d));A[n]=p,A[n+1]=_,A[n+2]=g,A[n+3]=t[n+3]}for(t=A,A=new i(b),l=0,o=0,n=0;b>n;n+=4,l++){for(l>=e&&(l=0,o+=e),p=255,_=255,g=255,s=0;L>s;s+=2)h=l+w[s],u=o+w[s+1],h>=0&&M>=h&&u>=0&&I>=u&&(c=h+u<<2,f=t[c],m=t[c+1],d=t[c+2],p>f&&(p=f),_>m&&(_=m),g>d&&(g=d));A[n]=p,A[n+1]=_,A[n+2]=g,A[n+3]=t[n+3]}return A}}}(FILTER),!function(t,e){"use strict";var i,n=t.ImArray,r=t.Array32I;Math.min,Math.max;var s=t.StatisticalFilter=t.Class(t.Filter,{name:"StatisticalFilter",constructor:function(){this._dim=0,this._indices=null,this._filterName=null,this._filter=null},_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var t=this;return t.disposeWorker(),t._dim=null,t._indices=null,t._filter=null,t._filterName=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._indices=e._indices,n._filterName=e._filterName,n._filterName&&i[n._filterName]&&(n._filter=i[n._filterName].bind(n))),n},median:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,"median")},minimum:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,"minimum")},maximum:function(t){return t=t===e?3:t%2?t:t+1,this.set(t,"maximum")},set:function(t,e){this._filterName=e,this._filter=i[e].bind(this),this._dim=t;var n,s,a,l=[],o=t*t,h=t,u=h>>1;for(s=0,a=0,n=0;o>n;)l.push(s-u),l.push(a-u),n++,s++,s>=h&&(s=0,a++);return this._indices=new r(l),this},reset:function(){return this._filterName=null,this._filter=null,this._dim=0,this._indices=null,this},_apply:function(t,e,i){return this._isOn&&this._dim?this._filter(t,e,i):t},apply:function(t,e){if(this._isOn&&this._dim){var i=t.getSelectedData();this._worker?this.bind("apply",function(i){this.unbind("apply"),i&&i.im&&t.setSelectedData(i.im),e&&e.call(this)}).send("apply",{im:i,params:this.serialize()}):(t.setSelectedData(this._filter(i[0],i[1],i[2],t)),e&&e.call(this))}return t}});s.prototype.erode=s.prototype.minimum,s.prototype.dilate=s.prototype.maximum,i={median:function(t,e){var i,s,a,l,o,h,u,c,f,m,d,p,_,g,v,w,b,y,A=this._dim,E=A*A,L=new r(this._indices),M=t.length,I=M>>2,R=new n(M),C=E<<1,k=e-1,x=I-e;for(c=[],f=[],m=[],s=0;C>s;s+=2)L[s+1]*=e;for(i=0,a=0,l=0;M>i;){for(c.length=0,f.length=0,m.length=0,s=0;C>s;)o=a+L[s],h=l+L[s+1],o>=0&&k>=o&&h>=0&&x>=h&&(u=o+h<<2,d=t[u],p=t[u+1],_=t[u+2],c.push(d),f.push(p),m.push(_)),s+=2;c.sort(),f.sort(),m.sort(),b=c.length,y=b>>1,g=b%2?c[y+1]:~~(.5*(c[y]+c[y+1])),b=f.length,y=b>>1,v=b%2?f[y+1]:~~(.5*(f[y]+f[y+1])),b=m.length,y=b>>1,w=b%2?m[y+1]:~~(.5*(m[y]+m[y+1])),R[i]=g,R[i+1]=v,R[i+2]=w,R[i+3]=t[i+3],i+=4,a++,a>=e&&(a=0,l+=e)}return R},maximum:function(t,e){var i,s,a,l,o,h,u,c,f,m,d,p,_,g=this._dim,v=g*g,w=new r(this._indices),b=t.length,y=b>>2,A=new n(b),E=v<<1,L=e-1,M=y-e;for(s=0;E>s;s+=2)w[s+1]*=e;for(i=0,a=0,l=0;b>i;){for(d=0,p=0,_=0,s=0;E>s;)o=a+w[s],h=l+w[s+1],o>=0&&L>=o&&h>=0&&M>=h&&(u=o+h<<2,c=t[u],f=t[u+1],m=t[u+2],c>d&&(d=c),f>p&&(p=f),m>_&&(_=m)),s+=2;A[i]=d,A[i+1]=p,A[i+2]=_,A[i+3]=t[i+3],i+=4,a++,a>=e&&(a=0,l+=e)}return A},minimum:function(t,e){var i,s,a,l,o,h,u,c,f,m,d,p,_,g=this._dim,v=g*g,w=new r(this._indices),b=t.length,y=b>>2,A=new n(b),E=v<<1,L=e-1,M=y-e;for(s=0;E>s;s+=2)w[s+1]*=e;for(i=0,a=0,l=0;b>i;){for(d=255,p=255,_=255,s=0;E>s;)o=a+w[s],h=l+w[s+1],o>=0&&L>=o&&h>=0&&M>=h&&(u=o+h<<2,c=t[u],f=t[u+1],m=t[u+2],d>c&&(d=c),p>f&&(p=f),_>m&&(_=m)),s+=2;A[i]=d,A[i+1]=p,A[i+2]=_,A[i+3]=t[i+3],i+=4,a++,a>=e&&(a=0,l+=e)}return A}}}(FILTER),FILTER});
/**
*
*   FILTER.js Plugins
*   @version: 0.6.12
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e,r,n,a){var i="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),s=!i&&"undefined"!=typeof navigator,l="function"==typeof importScripts&&navigator instanceof WorkerNavigator,o=Array,u=o.prototype,h=function(){var t=null;if(i)return t=__filename,{path:__dirname,file:__filename};if(l)t=self.location.href;else if(s){var e;(e=document.getElementsByTagName("script"))&&e.length&&(t=e[e.length-1].src)}return t?{path:t.split("/").slice(0,-1).join("/"),file:t}:{path:null,file:null}},c=h(),f=function(t,e){if(i)return e;if("."==e.charAt(0)){t=t.split("/"),e=e.split("/");var r,n=0,a=0,s=e.length,l=t.length;for(r=0;s>r;r++)if(/^\.\./.test(e[r]))n++,a++;else{if(!/^\./.test(e[r]))break;a++}n=n>=l?0:l-n,e=t.slice(0,n).concat(e.slice(a)).join("/")}return e};r=r?[].concat(r):[];var p,m,d,g=r.length,_=new o(g),v=new o(g),C=new o(g),b=new o(g);for(p=0;g>p;p++)_[p]=r[p][0],v[p]=r[p][1],C[p]=/\.js$/i.test(v[p])?f(c.path,v[p]):f(c.path,v[p]+".js");if("object"==typeof module&&module.exports){if(a===module.exports[e]){for(p=0;g>p;p++)b[p]=module.exports[_[p]]||require(C[p])[_[p]];m=n.apply(t,b),module.exports[e]=m||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(v),function(r){if(a===r[e]){for(var i=u.slice.call(arguments,1),s=i.length,l=0;s>l;l++)b[l]=r[_[l]]||i[l];m=n.apply(t,b),r[e]=m||1}});else if(l){for(p=0;g>p;p++)self[_[p]]||importScripts(C[p]),b[p]=self[_[p]];m=n.apply(t,b),self[e]=m||1}else if(a===t[e]){var M=function(t,e){d=d||document.getElementsByTagName("head")[0];var r=0,n=document.createElement("script");n.type="text/javascript",n.language="javascript",n.onload=n.onreadystatechange=function(){r||n.readyState&&"loaded"!=n.readyState&&"complete"!=n.readyState||(r=1,n.onload=n.onreadystatechange=null,d.removeChild(n),n=null,e&&e())},n.src=t,d.appendChild(n)},y=function(e,r,n){t[e]?n():M(r,n)},O=function(r){return function(){g>r&&(b[r]=t[_[r]]),++r<g?y(_[r],C[r],O(r)):(m=n.apply(t,b),t[e]=m||1)}};g?y(_[0],C[0],O(0)):(m=n.apply(t,b),t[e]=m||1)}}(this,"FILTER_PLUGINS",[["FILTER","./filter"]],function(t){var e=null;return!function(t){"use strict";var e=t._notSupportClamp,r=Math.random;t.NoiseFilter=t.Create({name:"NoiseFilter",min:-127,max:127,init:function(t,e){this.min=t||-127,this.max=e||127},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{min:t.min,max:t.max}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.min=e.min,r.max=e.max),r},apply:function(t){var n,a,i,s,l,o,u,h,c=this.max-this.min,f=this.min,p=t.length;if(e)for(n=0;p>n;n+=4)i=t[n],s=t[n+1],l=t[n+2],a=c*r()+f,o=i+a,u=s+a,h=l+a,0>o?o=0:o>255&&(o=255),0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),t[n]=~~o,t[n+1]=~~u,t[n+2]=~~h;else for(n=0;p>n;n+=4)i=t[n],s=t[n+1],l=t[n+2],a=c*r()+f,o=i+a,u=s+a,h=l+a,t[n]=~~o,t[n+1]=~~u,t[n+2]=~~h;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F,n=t.Color.RGB2YCbCr,a=t.Color.YCbCr2RGB;t.HistogramEqualizeFilter=t.Create({name:"HistogramEqualizeFilter",path:t.getPath(),apply:function(t){var i,s,l,o,u,h,c,f,p,m,d,g=0,_=255,v=0,C=t.length,b=C>>2,M=1/b;for(u=new r(256),p=0;256>p;p+=4)u[p]=0,u[p+1]=0,u[p+2]=0,u[p+3]=0;for(p=0;C>p;p+=4)i=t[p],s=t[p+1],l=t[p+2],m=n({r:i,g:s,b:l}),i=t[p]=~~m.cr,s=t[p+1]=~~m.y,l=t[p+2]=~~m.cb,u[s]+=M,s>g?g=s:_>s&&(_=s);for(v=0,p=0;256>p;p+=4)v+=u[p],u[p]=v,v+=u[p+1],u[p+1]=v,v+=u[p+2],u[p+2]=v,v+=u[p+3],u[p+3]=v;if(o=g-_,e)for(p=0;C>p;p+=4)m={cr:t[p],y:t[p+1],cb:t[p+2]},m.y=u[m.y]*o+_,d=a(m),h=d.r,c=d.g,f=d.b,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,t[p]=~~h,t[p+1]=~~c,t[p+2]=~~f;else for(p=0;C>p;p+=4)m={cr:t[p],y:t[p+1],cb:t[p+2]},m.y=u[m.y]*o+_,d=a(m),t[p]=~~d.r,t[p+1]=~~d.g,t[p+2]=~~d.b;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F;t.GrayscaleHistogramEqualizeFilter=t.Create({name:"GrayscaleHistogramEqualizeFilter",path:t.getPath(),apply:function(t){var n,a,i,s,l,o=0,u=255,h=0,c=t.length,f=c>>2,p=1/f;for(s=new r(256),l=0;256>l;l+=4)s[l]=0,s[l+1]=0,s[l+2]=0,s[l+3]=0;for(l=0;c>l;l+=4)n=t[l],s[n]+=p,n>o?o=n:u>n&&(u=n);for(h=0,l=0;256>l;l+=4)h+=s[l],s[l]=h,h+=s[l+1],s[l+1]=h,h+=s[l+2],s[l+2]=h,h+=s[l+3],s[l+3]=h;if(i=o-u,e)for(l=0;c>l;l+=4)n=t[l],a=s[n]*i+u,a=0>a?0:a>255?255:a,a=~~a,t[l]=a,t[l+1]=a,t[l+2]=a;else for(l=0;c>l;l+=4)n=t[l],a=~~(s[n]*i+u),t[l]=a,t[l+1]=a,t[l+2]=a;return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Array32F;t.RGBHistogramEqualizeFilter=t.Create({name:"RGBHistogramEqualizeFilter",path:t.getPath(),apply:function(t){var n,a,i,s,l,o,u,h,c,f,p,m,d,g,_,v,C=0,b=0,M=0,y=255,O=255,F=255,z=t.length,I=z>>2,Y=1/I;for(u=new r(256),h=new r(256),c=new r(256),v=0;256>v;v+=4)u[v]=0,h[v]=0,c[v]=0,u[v+1]=0,h[v+1]=0,c[v+1]=0,u[v+2]=0,h[v+2]=0,c[v+2]=0,u[v+3]=0,h[v+3]=0,c[v+3]=0;for(v=0;z>v;v+=4)n=t[v],a=t[v+1],i=t[v+2],u[n]+=Y,h[a]+=Y,c[i]+=Y,n>C?C=n:y>n&&(y=n),a>b?b=a:O>a&&(O=a),i>M?M=i:F>i&&(F=i);for(f=p=m=0,v=0;256>v;v+=4)f+=u[v],u[v]=f,p+=h[v],h[v]=p,m+=c[v],c[v]=m,f+=u[v+1],u[v+1]=f,p+=h[v+1],h[v+1]=p,m+=c[v+1],c[v+1]=m,f+=u[v+2],u[v+2]=f,p+=h[v+2],h[v+2]=p,m+=c[v+2],c[v+2]=m,f+=u[v+3],u[v+3]=f,p+=h[v+3],h[v+3]=p,m+=c[v+3],c[v+3]=m;if(s=C-y,l=b-O,o=M-F,e)for(v=0;z>v;v+=4)n=t[v],a=t[v+1],i=t[v+2],d=u[n]*s+y,g=h[a]*l+O,_=c[i]*o+F,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,_=0>_?0:_>255?255:_,t[v]=~~d,t[v+1]=~~g,t[v+2]=~~_;else for(v=0;z>v;v+=4)n=t[v],a=t[v+1],i=t[v+2],d=u[n]*s+y,g=h[a]*l+O,_=c[i]*o+F,t[v]=~~d,t[v+1]=~~g,t[v+2]=~~_;return t}})}(t),!function(t){"use strict";var e=Math.sqrt,r=t._notSupportClamp,n=t.Array32F;t.PixelateFilter=t.Create({name:"PixelateFilter",scale:1,init:function(t){this.scale=t||1},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{scale:t.scale}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.scale=e.scale),r},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var s,l,o,u,h,c,f,p,m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K=t.length,Z=K>>2,te=(a<<1)+a;for(s=~~(.01*e(Z)*this.scale),l=a*s,o=i%s,u=a%s,h=(o-1)*a,m=1/(s*s),d=1/(u*s),g=1/(o*s),_=1/(u*o),v=m,C=d,b=g,M=_,I=s-1,Y=(s-1)*a,G=0,T=a-1,L=0,j=Z-a,y=new n(3*Z),k=0,X=0,S=0,O=F=z=0,S=0;a>S;S++,k+=4,X+=3)O+=t[k],F+=t[k+1],z+=t[k+2],y[X]=O,y[X+1]=F,y[X+2]=z;for(X=0,S=0,O=F=z=0,k=te+a;K>k;k+=4,X+=3,S++)S>=a&&(S=0,O=F=z=0),O+=t[k],F+=t[k+1],z+=t[k+2],y[X+te]=y[X]+O,y[X+te+1]=y[X+1]+F,y[X+te+2]=y[X+2]+z;for(S=0,x=0,w=0,H=S,B=w,N=H+I,R=B+Y,N=N>T?T:N,R=R>j?j:R,V=H+B,Q=N+R,D=N+B,U=H+R,V=(V<<1)+V,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,p=v,W=p*(y[Q]-y[D]-y[U]+y[V]),$=p*(y[Q+1]-y[D+1]-y[U+1]+y[V+1]),J=p*(y[Q+2]-y[D+2]-y[U+2]+y[V+2]),r&&(W=0>W?0:W>255?255:W,$=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J),W=~~W,$=~~$,J=~~J,E=0,A=0,P=0,k=0;K>k;k+=4)q=E+S+P+w<<2,t[q]=W,t[q+1]=$,t[q+2]=J,E++,(E+S>=a||E>=s)&&(E=0,A++,P+=a),(A+x>=i||A>=s)&&(S+=s,S>=a&&(S=0,x+=s,w+=l),E=0,A=0,P=0,H=S,B=w,N=H+I,R=B+Y,N=N>T?T:N,R=R>j?j:R,V=H+B,Q=N+R,D=N+B,U=H+R,V=(V<<1)+V,D=(D<<1)+D,U=(U<<1)+U,Q=(Q<<1)+Q,c=0==N-H-u+1,f=0==R-B-h,p=c&&f?M:c?C:f?b:v,W=p*(y[Q]-y[D]-y[U]+y[V]),$=p*(y[Q+1]-y[D+1]-y[U+1]+y[V+1]),J=p*(y[Q+2]-y[D+2]-y[U+2]+y[V+2]),r&&(W=0>W?0:W>255?255:W,$=0>$?0:$>255?255:$,J=0>J?0:J>255?255:J),W=~~W,$=~~$,J=~~J);return t}})}(t),!function(t){"use strict";var e=Math.sqrt,r=(Math.SQRT2,Math.min,t._notSupportClamp),n=t.Array32F;t.TriangularPixelateFilter=t.Create({name:"TriangularPixelateFilter",scale:1,init:function(t){this.scale=t||1},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{scale:t.scale}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.scale=e.scale),r},apply:function(t,a,i){if(this.scale<=1)return t;this.scale>100&&(this.scale=100);var s,l,o,u,h,c,f,p,m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G,L,T,j,V,D,U,Q,W,$,J,K,Z,te,ee,re,ne,ae,ie,se=t.length,le=se>>2,oe=(a<<1)+a;for(s=~~(.01*e(le)*this.scale),l=s>>1,o=s-1,u=a*s,h=i%s,c=a%s,f=(h-1)*a,g=1/(s*s),_=1/(c*s),v=1/(h*s),C=1/(c*h),b=2*g,M=2*_,y=2*v,O=2*C,k=o,X=o*a,T=0,V=a-1,j=0,D=le-a,F=new n(3*le),S=0,x=0,w=0,z=I=Y=0,w=0;a>w;w++,S+=4,x+=3)z+=t[S],I+=t[S+1],Y+=t[S+2],F[x]=z,F[x+1]=I,F[x+2]=Y;for(x=0,w=0,z=I=Y=0,S=oe+a;se>S;S+=4,x+=3,w++)w>=a&&(w=0,z=I=Y=0),z+=t[S],I+=t[S+1],Y+=t[S+2],F[x+oe]=F[x]+z,F[x+oe+1]=F[x+1]+I,F[x+oe+2]=F[x+2]+Y;for(w=0,E=0,A=0,N=w,R=A,G=w-l+k,L=A+X,G=G>V?V:G,L=L>D?D:L,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,d=b,te=d*(F[$]-F[Q]-F[W]+F[U]),ee=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),re=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),N=w+l,G=w+k,G=G>V?V:G,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,ne=d*(F[$]-F[Q]-F[W]+F[U]),ae=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),ie=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),r&&(te=0>te?0:te>255?255:te,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie),te=~~te,ee=~~ee,re=~~re,ne=~~ne,ae=~~ae,ie=~~ie,J=te,K=ee,Z=re,P=0,q=0,H=0,S=0;se>S;S+=4)B=P+w+H+A<<2,t[B]=J,t[B+1]=K,t[B+2]=Z,P++,(P+w>=a||P>=s)&&(P=0,q++,H+=a,J=te,K=ee,Z=re),P>o-q&&(J=ne,K=ae,Z=ie),(q+E>=i||q>=s)&&(w+=s,w>=a&&(w=0,E+=s,A+=u),P=0,q=0,H=0,N=w,R=A,G=w-l+k,L=A+X,G=G>V?V:G,L=L>D?D:L,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,p=0==G-N+l-c+1,m=0==L-R-f,d=p&&m?O:p?M:m?y:b,te=d*(F[$]-F[Q]-F[W]+F[U]),ee=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),re=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),N=w+l,G=w+k,G=G>V?V:G,U=N+R,$=G+L,Q=G+R,W=N+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,$=($<<1)+$,p=0==G-N+l-c+1,d=p&&m?O:p?M:m?y:b,ne=d*(F[$]-F[Q]-F[W]+F[U]),ae=d*(F[$+1]-F[Q+1]-F[W+1]+F[U+1]),ie=d*(F[$+2]-F[Q+2]-F[W+2]+F[U+2]),r&&(te=0>te?0:te>255?255:te,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie),te=~~te,ee=~~ee,re=~~re,ne=~~ne,ae=~~ae,ie=~~ie,J=te,K=ee,Z=re);return t}})}(t),!function(t){"use strict";var e=t._notSupportClamp,r=t.Color.RGB2HSV,n=.7083333333333334;t.HSVConverterFilter=t.Create({name:"HSVConverterFilter",path:t.getPath(),apply:function(t){var a,i,s,l,o,u,h,c,f=t.length;if(e)for(l=0;f>l;l+=4)a=t[l],i=t[l+1],s=t[l+2],o=r({r:a,g:i,b:s}),u=o.h*n,c=255*o.s,h=o.v,0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>c?c=0:c>255&&(c=255),t[l]=~~u,t[l+1]=~~h,t[l+2]=~~c;else for(l=0;f>l;l+=4)a=t[l],i=t[l+1],s=t[l+2],o=r({r:a,g:i,b:s}),u=o.h*n,c=255*o.s,h=o.v,t[l]=~~u,t[l+1]=~~h,t[l+2]=~~c;return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,t.ImArray,t.Color.clampPixel),r=t.Color.RGB2HSV,n=(t.Color.HSV2RGB,t.Color.Color2RGBA);t.HueExtractorFilter=t.Create({name:"HueExtractorFilter",range:null,background:0,init:function(t,e){this.range=t,this.background=e||0},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{range:t.range,background:t.background}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.range=e.range,r.background=e.background),r},apply:function(t){if(!this.range||!this.range.length)return t;var a,i,s,l,o,u,h,c,f,p,m=t.length,d=this.range[0],g=this.range[this.range.length-1];for(f=n(this.background||0),l=~~e(f.r),o=~~e(f.g),u=~~e(f.b),h=~~e(f.a),c=0;m>c;c+=4)a=t[c],i=t[c+1],s=t[c+2],p=r({r:a,g:i,b:s}).h,(d>p||p>g)&&(t[c]=l,t[c+1]=o,t[c+2]=u,t[c+3]=h);return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,Math.min),r=Math.floor,n=t.CHANNEL.RED;t.CHANNEL.GREEN,t.CHANNEL.BLUE,t.CHANNEL.ALPHA,t.ChannelCopyFilter=t.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,init:function(t,e,r,a,i){this._srcImg=null,this.srcImg=null,this.srcChannel=e||n,this.dstChannel=r||n,this.centerX=a||0,this.centerY=i||0,t&&this.setSrc(t)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_srcImg:t._srcImg,centerX:t.centerX,centerY:t.centerY,srcChannel:t.srcChannel,dstChannel:t.dstChannel}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._srcImg=e._srcImg,r.centerX=e.centerX,r.centerY=e.centerY,r.srcChannel=e.srcChannel,r.dstChannel=e.dstChannel),r},setSrc:function(t){return t&&(this.srcImg=t,this._srcImg={data:t.getData(),width:t.width,height:t.height}),this},apply:function(t,n,a){if(!this._srcImg)return t;var i,s,l,o,u,h,c=this._srcImg.data,f=t.length,p=(c.length,this._srcImg.width),m=this._srcImg.height,d=this.srcChannel,g=this.dstChannel,_=e(n,p),v=e(a,m),C=this.centerX||0,b=this.centerY||0,M=p>>1,y=m>>1;for(C=r(C*(n-1))-M,b=r(b*(a-1))-y,i=0,s=0,l=0,i=0;f>i;i+=4,s++)s>=n&&(s=0,l++),u=s-C,h=l-b,u>=0&&_>u&&h>=0&&v>h&&(o=u+h*p<<2,t[i+g]=c[o+d]);return t}})}(t),!function(t){"use strict";var e=(t._notSupportClamp,Math.min),r=Math.floor;t.AlphaMaskFilter=t.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,init:function(t,e,r){this.centerX=e||0,this.centerY=r||0,this._alphaMask=null,this.alphaMask=null,t&&this.setMask(t)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_alphaMask:t._alphaMask,centerX:t.centerX,centerY:t.centerY}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._alphaMask=e._alphaMask,r.centerX=e.centerX,r.centerY=e.centerY),r},setMask:function(t){return t&&(this.alphaMask=t,this._alphaMask={data:t.getData(),width:t.width,height:t.height}),this},apply:function(t,n,a){if(!this._alphaMask)return t;var i,s,l,o,u,h,c=this._alphaMask.data,f=this._alphaMask.width,p=this._alphaMask.height,m=t.length,d=(c.length,e(n,f)),g=e(a,p),_=this.centerX||0,v=this.centerY||0,C=f>>1,b=p>>1;for(_=r(_*(n-1))-C,v=r(v*(a-1))-b,s=0,l=0,i=0;m>i;i+=4,s++)s>=n&&(s=0,l++),u=s-_,h=l-v,u>=0&&d>u&&h>=0&&g>h?(o=u+h*f<<2,t[i+3]=c[o+3]):t[i+3]=0;return t}})}(t),!function(t,e){"use strict";var r,n=Math.min,a=Math.max,i=Math.round,s=(Math.floor,Math.abs),l=t._notSupportClamp;t.BlendFilter=t.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendMode:null,blendImage:null,startX:0,startY:0,amount:1,init:function(t,e,r){this.startX=0,this.startY=0,this.amount=1,this._blendImage=null,this.blendImage=null,this._blendMode=null,this.blendMode=null,t&&this.setImage(t),e&&this.setMode(e,r)},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_blendImage:t._blendImage,_blendMode:t._blendMode,startX:t.startX,startY:t.startY,amount:t.amount}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r._blendImage=e._blendImage,r.startX=e.startX,r.startY=e.startY,r.setMode(e._blendMode,e.amount)),r},setImage:function(t){return t&&(this.blendImage=t,this._blendImage={data:t.getData(),width:t.width,height:t.height}),this},setMode:function(t,i){return t?(this._blendMode=(""+t).toLowerCase(),this.blendMode=r[this._blendMode]||null,this.amount=a(0,n(1,e===i?1:i))):(this._blendMode=null,this.blendMode=null),this},reset:function(){return this.startX=0,this.startY=0,this.amount=1,this._blendMode=null,this.blendMode=null,this},apply:function(t,e,r){if(!this.blendMode||!this._blendImage)return t;var a,s,l,o,u,h=this.startX||0,c=this.startY||0,f=0,p=0,m=this._blendImage,d=this.amount||1;return o=m.width,u=m.height,0>h&&(f=-h,h=0),0>c&&(p=-c,c=0),h>=e||c>=r?t:f>=o||p>=u?t:(h=i(h),c=i(c),f=i(f),p=i(p),a=n(e-h,o-f),s=n(r-c,u-p),0>=a||0>=s?t:(l=m.data,this.blendMode(t,e,r,l,o,u,h,c,f,p,a,s,d)))}}),r={normal:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=Y,x=k,w=X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},lighten:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=F>Y?F:Y,x=z>k?z:k,w=I>X?I:X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},darken:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=F>Y?Y:F,x=z>k?k:z,w=I>X?X:I,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},multiply:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=.003921568627451*F*Y,x=.003921568627451*z*k,w=.003921568627451*I*X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},average:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=.5*(F+Y),x=.5*(z+k),w=.5*(I+X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},add:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=F+Y,x=z+k,w=I+X,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},subtract:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=255>F+Y?0:F+Y-255,x=255>z+k?0:z+k-255,w=255>I+X?0:I+X-255,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},difference:function(t,e,r,n,a,i,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*a,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=s(k-z),w=s(X-I),E=s(S-Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=a);return t},negation:function(t,e,r,n,a,i,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*a,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=255-s(255-k-z),w=255-s(255-X-I),E=255-s(255-S-Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=a);return t},screen:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=255-((255-Y)*(255-F)>>8),x=255-((255-k)*(255-z)>>8),w=255-((255-X)*(255-I)>>8),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},exclusion:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=Y+F-.003921568627451*2*Y*F,x=k+z-.003921568627451*2*k*z,w=X+I-.003921568627451*2*X*I,F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},overlay:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>F?.003921568627451*2*Y*F:255-.003921568627451*2*(255-Y)*(255-F),x=128>z?.003921568627451*2*k*z:255-.003921568627451*2*(255-k)*(255-z),S=128>I?.003921568627451*2*X*I:255-.003921568627451*2*(255-X)*(255-I),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},softlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>F?2*((Y>>1)+64)*.003921568627451*F:255-.003921568627451*2*(255-((Y>>1)+64))*(255-F),x=128>z?2*((k>>1)+64)*.003921568627451*z:255-.003921568627451*2*(255-((k>>1)+64))*(255-z),w=128>I?2*((X>>1)+64)*.003921568627451*I:255-.003921568627451*2*(255-((X>>1)+64))*(255-I),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},hardlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;for(E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],S=128>Y?.003921568627451*2*F*Y:255-.003921568627451*2*(255-F)*(255-Y),x=128>k?.003921568627451*2*z*k:255-.003921568627451*2*(255-z)*(255-k),w=128>X?.003921568627451*2*I*X:255-.003921568627451*2*(255-I)*(255-X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},colordodge:function(t,e,r,a,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==z?z:n(255,(k<<8)/(255-z)),w=255==I?I:n(255,(X<<8)/(255-I)),E=255==Y?z:n(255,(S<<8)/(255-Y)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},colorburn:function(t,e,r,n,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=n[b],X=n[b+1],S=n[b+2],x=0==z?z:a(0,255-(255-k<<8)/z),w=0==I?I:a(0,255-(255-X<<8)/I),E=0==Y?Y:a(0,255-(255-S<<8)/Y),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},linearlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;for(var A;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],128>F?(A=2*F,S=255>A+Y?0:A+Y-255):(A=2*(F-128),S=A+Y),128>z?(A=2*z,x=255>A+k?0:A+k-255):(A=2*(z-128),x=A+k),128>I?(A=2*I,w=255>A+X?0:A+X-255):(A=2*(I-128),w=A+X),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},reflect:function(t,e,r,a,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==z?z:n(255,k*k/(255-z)),w=255==I?I:n(255,X*X/(255-I)),E=255==Y?Y:n(255,S*S/(255-Y)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},glow:function(t,e,r,a,i,s,o,u,h,c,f,p,m){var d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A;for(A=1-m,M=o,y=u*e,O=h,F=c*i,d=o+f,g=h+f,_=0,v=p*f;v>_;)C=M+y<<2,b=O+F<<2,z=t[C],I=t[C+1],Y=t[C+2],k=a[b],X=a[b+1],S=a[b+2],x=255==k?k:n(255,z*z/(255-k)),w=255==X?X:n(255,I*I/(255-X)),E=255==S?S:n(255,Y*Y/(255-S)),z=x*m+z*A,I=w*m+I*A,Y=E*m+Y*A,l&&(z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y),t[C]=~~z,t[C+1]=~~I,t[C+2]=~~Y,_++,M++,M>=d&&(M=o,y+=e),O++,O>=g&&(O=h,F+=i);return t},phoenix:function(t,e,r,i,s,o,u,h,c,f,p,m,d){var g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;for(P=1-d,y=u,O=h*e,F=c,z=f*s,g=u+p,_=c+p,v=0,C=m*p;C>v;)b=y+O<<2,M=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=i[M],S=i[M+1],x=i[M+2],w=n(X,I)-a(X,I)+255,E=n(S,Y)-a(S,Y)+255,A=n(x,k)-a(x,k)+255,I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,l&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,y++,y>=g&&(y=u,O+=e),F++,F>=_&&(F=c,z+=s);return t},vividlight:function(t,e,r,i,s,o,u,h,c,f,p,m,d){var g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;P=1-d,y=u,O=h*e,F=c,z=f*s,g=u+p,_=c+p,v=0,C=m*p;for(var q;C>v;)b=y+O<<2,M=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=i[M],S=i[M+1],x=i[M+2],128>I?(q=2*I,w=0==q?q:a(0,255-(255-X<<8)/q)):(q=2*(I-128),w=255==q?q:n(255,(X<<8)/(255-q))),128>Y?(q=2*Y,E=0==q?q:a(0,255-(255-S<<8)/q)):(q=2*(Y-128),E=255==q?q:n(255,(S<<8)/(255-q))),128>k?(q=2*k,A=0==q?q:a(0,255-(255-x<<8)/q)):(q=2*(Y-128),A=255==q?q:n(255,(x<<8)/(255-q))),I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,l&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,y++,y>=g&&(y=u,O+=e),F++,F>=_&&(F=c,z+=s);return t},pinlight:function(t,e,r,n,a,i,s,o,u,h,c,f,p){var m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E;E=1-p,b=s,M=o*e,y=u,O=h*a,m=s+c,d=u+c,g=0,_=f*c;for(var A;_>g;)v=b+M<<2,C=y+O<<2,F=t[v],z=t[v+1],I=t[v+2],Y=n[C],k=n[C+1],X=n[C+2],128>F?(A=2*F,S=A>Y?A:Y):(A=2*(F-128),S=A>Y?Y:A),128>z?(A=2*z,x=A>k?A:k):(A=2*(F-128),x=A>k?k:A),128>I?(A=2*I,w=A>X?A:X):(A=2*(I-128),w=A>X?X:A),F=S*p+F*E,z=x*p+z*E,I=w*p+I*E,l&&(F=0>F?0:F>255?255:F,z=0>z?0:z>255?255:z,I=0>I?0:I>255?255:I),t[v]=~~F,t[v+1]=~~z,t[v+2]=~~I,g++,b++,b>=m&&(b=s,M+=e),y++,y>=d&&(y=u,O+=a);return t},hardmix:function(t,e,r,i,s,o,u,h,c,f,p,m,d){var g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P;P=1-d,y=u,O=h*e,F=c,z=f*s,g=u+p,_=c+p,v=0,C=m*p;for(var q;C>v;)b=y+O<<2,M=F+z<<2,I=t[b],Y=t[b+1],k=t[b+2],X=i[M],S=i[M+1],x=i[M+2],128>I?(q=2*I,w=0==q?q:a(0,255-(255-X<<8)/q)):(q=2*(I-128),w=255==q?q:n(255,(X<<8)/(255-q))),w=128>w?0:255,128>Y?(q=2*Y,E=0==q?q:a(0,255-(255-S<<8)/q)):(q=2*(Y-128),E=255==q?q:n(255,(S<<8)/(255-q))),E=128>E?0:255,128>k?(q=2*k,A=0==q?q:a(0,255-(255-x<<8)/q)):(q=2*(k-128),A=255==q?q:n(255,(x<<8)/(255-q))),A=128>A?0:255,I=w*d+I*P,Y=E*d+Y*P,k=A*d+k*P,l&&(I=0>I?0:I>255?255:I,Y=0>Y?0:Y>255?255:Y,k=0>k?0:k>255?255:k),t[b]=~~I,t[b+1]=~~Y,t[b+2]=~~k,v++,y++,y>=g&&(y=u,O+=e),F++,F>=_&&(F=c,z+=s);return t}},r.lineardodge=r.add,r.linearburn=r.subtract}(t),!function(t){"use strict";var e=(t._notSupportClamp,t.Color.RGBA2Color),r=t.Color.Color2RGBA;t.ThresholdFilter=t.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(t,e){this.thresholds=t,this.quantizedColors=e||null},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{thresholds:t.thresholds,quantizedColors:t.quantizedColors}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.thresholds=e.thresholds,r.quantizedColors=e.quantizedColors),r},apply:function(t){if(!this.thresholds||!this.thresholds.length)return t;if(!this.quantizedColors||!this.quantizedColors.length)return t;var n,a,i,s,l,o,u,h,c=t.length,f=this.thresholds,p=f.length,m=this.quantizedColors,d=m.length;for(u=0;c>u;u+=4){for(l=e({r:t[u],g:t[u+1],b:t[u+2],a:t[u+3]}),h=0;p>h&&l>f[h];)h++;l=d>h?m[h]:255,o=r(l),n=o.r,a=o.g,i=o.b,s=o.a,t[u]=n,t[u+1]=a,t[u+2]=i,t[u+3]=s}return t}})}(t),!function(t){"use strict";var e=(Math.sqrt,Math.exp,Math.log),r=Math.abs,n=Math.floor,a=t._notSupportClamp,i=t.Array32F;t.BokehFilter=t.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(t,e,r,n){this.centerX=t||0,this.centerY=e||0,this.radius=r||10,this.amount=n||10},path:t.getPath(),serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{centerX:t.centerX,centerY:t.centerY,radius:t.radius,amount:t.amount}}},unserialize:function(t){var e,r=this;return t&&r.name===t.filter&&(r._isOn=!!t._isOn,e=t.params,r.centerX=e.centerX,r.centerY=e.centerY,r.radius=e.radius,r.amount=e.amount),r},apply:function(t,s,l){var o,u,h,c,f,p,m,d,g,_,v,C,b,M,y,O,F,z,I,Y,k,X,S,x,w,E,A,P,q,H,B,N,R,G=t.length,L=this.centerX||0,T=this.centerY||0,j=this.radius,V=this.amount;if(0>=V)return t;for(o=G>>2,H=0,B=s-1,N=0,R=o-s,L=n(L*(s-1)),T=n(T*(l-1)),h=(o<<1)+o,m=(s<<1)+s,u=new i(h),d=0,g=0,_=0,c=f=p=0,_=0;s>_;_++,d+=4,g+=3)c+=t[d],f+=t[d+1],p+=t[d+2],u[g]=c,u[g+1]=f,u[g+2]=p;for(d=m+s,g=0,_=0,c=f=p=0,d=m+s;G>d;d+=4,g+=3,_++)_>=s&&(_=0,c=f=p=0),c+=t[d],f+=t[d+1],p+=t[d+2],u[g+m]=u[g]+c,u[g+m+1]=u[g+1]+f,u[g+m+2]=u[g+2]+p;for(_=0,v=0,C=0,d=0;G>d;d+=4,_++)_>=s&&(_=0,v++,C+=s),M=_-L,y=v-T,b=r(M)+r(y),O=b>j?~~e((b-j)*V):~~(b/j+.5),O>0&&(F=O*s,z=.25/(O*O),I=_-O,Y=C-F,k=_+O,X=C+F,H>I?I=H:k>B&&(k=B),N>Y?Y=N:X>R&&(X=R),S=I+Y,E=k+X,x=k+Y,w=I+X,S=(S<<1)+S,x=(x<<1)+x,w=(w<<1)+w,E=(E<<1)+E,A=z*(u[E]-u[x]-u[w]+u[S]),P=z*(u[E+1]-u[x+1]-u[w+1]+u[S+1]),q=z*(u[E+2]-u[x+2]-u[w+2]+u[S+2]),a&&(A=0>A?0:A>255?255:A,P=0>P?0:P>255?255:P,q=0>q?0:q>255?255:q),t[d]=~~A,t[d+1]=~~P,t[d+2]=~~q);return t}})}(t),e});

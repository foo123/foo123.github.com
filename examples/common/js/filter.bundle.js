/**
*
*   Classy.js
*   @version: 0.9.3
*   @built on 2016-07-19 17:09:27
*
*   Object-Oriented micro-framework for JavaScript
*   https://github.com/foo123/classy.js
*
**/!function(e,n,i){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=i.call(e)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return i.moduleUri=n.uri,i.call(e)}):n in e||(e[n]=i.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"Classy",function(){"use strict";var e=void 0,n="constructor",i="prototype",t="__proto__",r="__static__",l="__private__",u="$super",a="$static",o="$latestatic",f="$class",c=2,s=4,b=8,d=256,m=Object,p=m[i],v=Function,g=v[i],h=String,y=Number,x=RegExp,w=Array,j=p.toString,E=(g.call.bind(g.toString),"hasOwnProperty"),_="propertyIsEnumerable",q=m.keys,I=m.defineProperty,$=function(e){return typeof e},A=function(e){throw new TypeError(e)},P=2,S=3,T=4,C=8,M=9,N=16,O=32,R=64,F=128,L=256,U=512,V=1024,k={"[object Array]":N,"[object RegExp]":F,"[object Number]":P,"[object String]":C,"[object Function]":R,"[object Object]":O},B=function(n){var i;return null===n?L:!0===n||!1===n?T:e===n?U:(i=j.call(n),i=k[i]||V,P===i||n instanceof y?isNaN(n)?S:P:C===i||n instanceof h?1===n.length?M:C:N===i||n instanceof w?N:F===i||n instanceof x?F:R===i||n instanceof v?R:O===i?O:V)},D=function(e,n){var i,t=n.length,r=[].concat(e);for(i=0;t>i;i++)-1<r.indexOf(n[i])||r.push(n[i]);return r},z=function(e,n){O!==B(e)&&A("bad desc");var i={};if(e[E]("enumerable")&&(i.enumerable=!!n.enumerable),e[E]("configurable")&&(i.configurable=!!n.configurable),e[E]("value")&&(i.value=n.value),e[E]("writable")&&(i.writable=!!e.writable),e[E]("get")){var t=e.get;R!==B(t)&&"undefined"!==t&&A("bad get"),i.get=t}if(e[E]("set")){var r=e.set;R!==B(r)&&"undefined"!==r&&A("bad set"),i.set=r}return("get"in i||"set"in i)&&("value"in i||"writable"in i)&&A("identity-confused descriptor"),i},G=m.defineProperties||function(e,n){"object"===$(e)&&null!==e||A("bad obj"),n=m(n);for(var i=q(n),t=[],r=0;r<i.length;r++)t.push([i[r],z(n[i[r]],e)]);for(var r=0;r<t.length;r++)I(e,t[r][0],t[r][1]);return e},H=function(){},J=m.create||function(e,n){var r,l=function(){};return l[i]=e,r=new l,r[t]=e,"object"===$(n)&&G(r,n),r},K=function(){var e,n,i,t,r,l,u,a=arguments;for(n=a[0]||{},e=a.length,l=1;e>l;l++)if(i=a[l],O===B(i))for(r in i)i[E](r)&&i[_](r)&&(t=i[r],u=B(t),P&u?n[r]=0+t:(C|N)&u?n[r]=t.slice(0):n[r]=t);return n},Q=function(e,i,t){var r,l,u=!!i;if(u||t)if(r={},i=u?i+"$":i,t&&R===B(t))for(l in e)e[E](l)&&(n!==l?(u&&R===B(e[l])&&(r[i+l]=e[l]),r[t(l,e[l])]=e[l]):r[l]=e[l]);else for(l in e)e[E](l)&&(n!==l?(u&&R===B(e[l])&&(r[i+l]=e[l]),t&&l in t?r[t[l]]=e[l]:r[l]=e[l]):r[l]=e[l]);else r=e;return r},W=function(e){var n=e[u]||H,i=e[u+"v"]||H,t=null;return[function(i,r,l,u,a,o,f,c,s,b,d){var m,p;return t===i?m=n.call(this,i,r,l,u,a,o,f,c,s,b,d):(p=e[i])&&(t=i,m=p.call(this,r,l,u,a,o,f,c,s,b,d),t=null),m},function(n,r){var l,u;return t===n?l=i.call(this,n,r):(u=e[n])&&(t=n,l=r&&r.length?u.apply(this,r):u.call(this),t=null),l}]},X=function(e,n){return this instanceof X?(this.factory=e,void(this.qualifier=(P===B(n)?n:0)|c)):new X(e,n)},Y=function(e,n){return this instanceof Y?(this.prop=e,void(this.qualifier=(P===B(n)?n:0)|c)):new Y(e,n)},Z=function(t,c,p,v){t=t||m,c=c||{};var g,h,y,x,w,j,_,I,$,A,S=t[a]||null,T=t[o]||{},M=t[i],F=null,L=K({},T),U=null,V={};c[E](n)||(c[n]=function(){}),g=c[n],c[E](l)&&(V=c[l]||{},delete c[l]),c[E](r)&&(F=c[r],U=q(F),delete c[r]);for($ in c)if(c[E]($)){if(A=c[$],A instanceof X){if(b&A.qualifier){d&A.qualifier?L[$]=A:((F=F||{})[$]=A.factory(t,V,g),(U=U||[]).push($)),delete c[$];continue}if(s&A.qualifier){V[$]=A,delete c[$];continue}A=c[$]=A.factory(M,V,g)}R===B(A)&&(A[u]=M[$]||H)}for($ in V)V[E]($)&&(A=V[$],A instanceof X&&(A=V[$]=A.factory(M,V,g)),R!==B(A)&&delete V[$]);if(g[i]=Q(J(M),p,v),g[i]=K(g[i],c),h=W(M),w={},w[f]=w[n]={value:g,enumerable:!1,writable:!0,configurable:!0},w[u]={value:h[0],enumerable:!1,writable:!0,configurable:!0},w[u+"v"]={value:h[1],enumerable:!1,writable:!0,configurable:!0},G(g[i],w),w={},S||U)for(S=D(S||[],U||[]),x=S.length,y=0;x>y;y++){if(j=S[y],_=null,F&&e!==F[j]){if((A=F[j])instanceof X){if((b|d)&A.qualifier){L[j]=A;continue}_=A.factory(t,V,g)}else{if(L[E](j))continue;_=F[j]}R===B(_)&&(_[u]=t[j]||H)}else e!==t[j]&&(I=B(t[j]),_=O===I?K(null,t[j]):(C|N)&I?t[j].slice(0):P&I?0+t[j]:t[j]);w[j]={value:_,enumerable:!1,writable:!0,configurable:!0}}for(j in L)L[E](j)&&(_=L[j].factory(t,V,g),w[j]={value:_,enumerable:!1,writable:!0,configurable:!0});return w[a]={value:S,enumerable:!1,writable:!0,configurable:!0},w[o]={value:L,enumerable:!1,writable:!0,configurable:!0},w[u]={value:t,enumerable:!1,writable:!0,configurable:!0},G(g,w),g},ee=K,ne=K,ie=function(n){var t,r,l,c;if(R===B(n)){if(u in n&&(n[u]=e),f in n&&(n[f]=e),o in n&&(n[o]=e),a in n){for(l=n[a],t=0,r=l.length;r>t;t++)c=l[t],c in n&&(R===B(n[c])&&n[c][u]&&(n[c][u]=e),n[c]=e);n[a]=e}l=n[i];for(c in l)R===B(l[c])&&(l[c][u]&&(l[c][u]=e),l[c]=e);l[u]=e,l[u+"v"]=e}},te=function(){var e=arguments,n=e.length,t=null;if(b===e[0])return e[1]||{};if(n>=2){var r=B(e[0]);r=R===r?{Extends:e[0]}:O===r?e[0]:{Extends:m};var l,u,a=e[1]||{},o={},f=r[E]("Extends")?r.Extends:r[E]("extends")?r["extends"]:m,c=r[E]("Implements")?r.Implements:r[E]("implements")?r["implements"]:null,s=r[E]("Mixin")?r.Mixin:r[E]("mixin")?r.mixin:null,d=null;if(c=c?[].concat(c):null,s=s?[].concat(s):null)for(l=0,u=s.length;u>l;l++)O===B(s[l])?s[l][E]("mixin")&&s[l].mixin&&s[l].mixin[i]&&(d=Q(s[l].mixin[i],s[l].namespace||null,s[l].as||null),o=ne(o,d)):s[l][i]&&(d=s[l][i],o=ne(o,d));if(c)for(l=0,u=c.length;u>l;l++)O===B(c[l])?c[l][E]("implements")&&c[l]["implements"]&&c[l]["implements"][i]&&(d=Q(c[l]["implements"][i],c[l].namespace||null,c[l].as||null),o=ee(o,d)):c[l][i]&&(d=c[l][i],o=ee(o,d));t=O===B(f)?Z(f["extends"]||m,K(o,a),f.namespace||null,f.as||null):Z(f,K(o,a))}else t=Z(m,e[0]);return t},re={VERSION:"0.9.3",PUBLIC:c,STATIC:b,LATE:d,PRIVATE:s,Type:B,Create:J,Merge:K,Alias:Q,Implements:ee,Mixin:ne,Extends:Z,Dispose:ie,Method:X,Prop:Y,Class:te};return re});
/**
*
*   Asynchronous.js
*   @version: 0.5.1
*
*   Simple JavaScript class to manage asynchronous, parallel, linear, sequential and interleaved tasks
*   https://github.com/foo123/asynchronous.js
*
**/
!function(n,e,t){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(n.$deps=n.$deps||{})&&(n.EXPORTED_SYMBOLS=[e])&&(n[e]=n.$deps[e]=t.call(n)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[e]=t.call(n)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(e,[],function(r){r(e,t.call(n))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["module"],function(e){return t.moduleUri=e.uri,t.call(n)}):e in n||(n[e]=t.call(n)||1)&&"function"==typeof define&&define.amd&&define(function(){return n[e]})}(this,"Asynchronous",function n(e){"use strict";function t(n){var e,t=[];if(n)for(e in n)n[c](e)&&t.push(e+"="+(!0===n[e]||1===n[e]?"yes":!1===n[e]||0===n[e]?"no":n[e]));return t.join(",")}function r(n,e){n.$runmode=M,n.$running=!1}function o(n,e){var t,r=n,o=r.$queue;if(r.$runmode=x,o){for(;o.length&&(!o[0]||!o[0].canRun());)o.shift();o.length?(r.$running=!0,t=o.shift(),e?t.runWithArgs(e):t.run(),t.complete()):r.$running=!1}}function i(n,e){var t,r=n,o=r.$queue,s=0;if(r.$runmode=R,o&&o.length){for(r.$running=!0;s<o.length;)t=o[s],t&&t.canRun()?(e?t.runWithArgs(e):t.run(),t.isFinished()?(o.shift(),t.complete()):s++):o.shift();r.$running=!1,r.$timer=N(v(i,r),r.$interval)}}function s(n,e){var t,r=n,o=r.$queue;r.$runmode=O,o&&o.length&&(t=o[0],t&&t.canRun()?(r.$running=!0,e?t.runWithArgs(e):t.run(),t.isFinished()&&(o.shift(),t.complete())):o.shift(),r.$running=!1,r.$timer=N(v(s,r),r.$interval))}var u,l="prototype",c="hasOwnProperty",a=Object,f=Array,p=Function,d=p[l],h=a[l],m=f[l],$=(JSON.parse,JSON.stringify),g=function(){},v=function(n,e){return function(){return n(e)}},w=d.call.bind(m.slice),y=h.toString,b=function(n){return"function"==typeof n},S=function(n,e){return n instanceof e},N=setTimeout,k=clearTimeout,j=e,E=0,T=1,q=2,W=60,A=0,R=1,x=2,M=3,O=4,C="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"],L="undefined"!=typeof global&&"[object global]"===y.call(global),I=L&&"undefined"!=typeof process.send,U=!C&&!L&&"undefined"!=typeof SharedWorkerGlobalScope&&"function"==typeof importScripts,B=!C&&!L&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,D=!(C||L||B||U||"undefined"==typeof navigator||"undefined"==typeof document),F=(D&&!!window.opener,D&&window.self!==window.top,"function"==typeof define&&define.amd),P=L||"function"==typeof Worker||"function"==typeof SharedWorker,_=L?this:U||B?self||this:window||this,z=L?module.$deps:U||B?self||this:window||this,G=(L?global:U||B?self||this:window||this,I||U||B),J=I&&0===process.listenerCount("message")||U&&!_.onconnect||B&&!_.onmessage,V=J?function un(n){un.handler&&un.handler(I?n:n.data)}:g,K=null,Q={},X=(L?require("os").cpus().length:4,L?null:"undefined"!=typeof _.webkitURL?_.webkitURL:"undefined"!=typeof _.URL?_.URL:null),Y=function(n,e){return n&&X?X.createObjectURL(new Blob(n.push?n:[n],e||{type:"text/javascript"})):n},H=function ln(n){var e;return L?{file:__filename,path:__dirname}:U||B?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:F&&n?{file:e=n,path:e.split("/").slice(0,-1).join("/")}:D&&(e=document.getElementsByTagName("script"))&&e.length?(ln.link||(ln.link=document.createElement("a")),ln.link.href=e[e.length-1].src,e=ln.link.href,{file:e,path:e.split("/").slice(0,-1).join("/")}):{path:null,file:null}},Z=H(n.moduleUri),nn=Z.file,en=function(n,e){if(n=n||{},e)for(var t in e)e[c](t)&&(n[t]=e[t]);return n},tn=0;Q[nn]=1,L?(u=function(n){var e=this;e.process=require("child_process").fork(n),e.process.on("message",function(n){e.onmessage&&e.onmessage(n)}),e.process.on("error",function(n){e.onerror&&e.onerror(n)})},u.Shared=u,u[l]={constructor:u,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.send(n),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}):(u=function(n){var e=this;e.process=new Worker(n),e.process.onmessage=function(n){e.onmessage&&e.onmessage(n.data)},e.process.onerror=function(n){e.onerror&&e.onerror(n)}},u.Shared=u,u[l]={constructor:u,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.postMessage(n),this},terminate:function(){return this.process&&(this.process.terminate(),this.process=null),this}},"function"==typeof SharedWorker&&(u.Shared=function(n){var e=this;e.process=new SharedWorker(n),e.process.port.start(),e.process.port.onmessage=function(n){e.onmessage&&e.onmessage(n.data)},e.process.port.onerror=e.process.onerror=function(n){e.onerror&&e.onerror(n)}},u.Shared[l]={constructor:u.Shared,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.port.postMessage(n),this},terminate:function(){return this.process&&(this.process.port.close(),this.process=null),this}})),J&&(U?(_.close=g,_.postMessage=g,_.onconnect=function(n){var e=n.ports[0];_.close=function(){e.close()},_.postMessage=function(n){e.postMessage(n)},e.addEventListener("message",V),e.start()}):B?_.onmessage=V:I&&(_.close=function(){process.exit()},_.postMessage=function(n){process.send(n)},_.importScripts=function(n){try{new Function("",require("fs").readFileSync(n).toString()).call(z)}catch(e){throw e}},process.on("message",V)));var rn=function cn(n){var e=this;return e instanceof cn?(e.$id=(++tn).toString(16),void(e.options=en({width:400,height:400,toolbar:0,location:0,directories:0,status:0,menubar:0,scrollbars:1,resizable:1},n))):new cn(n)};rn[l]={constructor:rn,options:null,$id:null,$window:null,dispose:function(){var n=this;return n.$window&&n.close(),n.$window=null,n.$id=null,n.options=null,n},close:function(){var n=this;return n.$window&&(n.$window.closed||n.$window.close(),n.$window=null),n},ready:function(n,e){var t=this,r=function o(){!t.$window||n&&!t.$window[n]?setTimeout(o,60):e()};return setTimeout(r,0),t},open:function(n){var e=this;return!e.$window&&n&&(e.$window=window.open(n.push?Y(["\ufeff"].concat(n),{type:"text/html;charset=utf-8"}):n,e.$id,t(e.options))),e},write:function(n){var e=this;return e.$window&&n&&e.$window.document.write(n),e}};var on=function an(n){if(n instanceof an)return n;if(!(this instanceof an))return new an(n);var t,r=this,o=null,i=null,s=null,u=!1,l=!1,c=!1,a=!1,f=!1,p=!1,d=null,h=0,m=1,$=null,g=null,v=null,w=e;r.queue=function(n){return arguments.length?(o=n,r):o},r.jumpNext=function(n){o&&o.jumpNext(!1,n)},r.abort=function(n){o&&(o.abort(!1),n&&(o.dispose(),o=null))},r.dispose=function(){o&&(o.dispose(),o=null)},r.task=function(n){return i=n,r},n&&r.task(n),r.run=t=function(){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,w=i(),u=!0,i.jumpNext=null,i.abort=null,i.dispose=null,w},r.runWithArgs=function(n){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,w=i.apply(null,n),u=!0,i.jumpNext=null,i.abort=null,i.dispose=null,w},r.canRun=function(){return i&&(!u||l||c||a||f||p)?(l||c)&&h>=$?!1:c&&!d?!1:!a&&!f||w!==g:!1},r.iif=function(n,e,t){return n?r.task(e):arguments.length>2&&r.task(t),r},r.until=function(n){return w=e,d=null,g=n,f=!0,p=!1,l=!1,c=!1,a=!1,r.run=t,r},r.untilNot=function(n){return w=e,d=null,v=n,p=!0,f=!1,l=!1,c=!1,a=!1,r.run=t,r},r.loop=function(n,t,o){return w=e,d=null,h=t||0,m=o||1,$=n,l=!0,f=!1,p=!1,c=!1,a=!1,r.run=function(){var n;return n=i(h),h+=m,w=n,u=!0,n},r},r.each=function(n){return w=e,d=n,h=0,m=1,$=n?n.length||0:0,c=!0,f=!1,p=!1,l=!1,a=!1,r.run=function(){var n;return n=i(d[h],h),h++,w=n,u=!0,n},r},r.recurse=function(n,e){return d=null,w=n,g=e,a=!0,f=!1,p=!1,l=!1,c=!1,r.run=function(){var n;return n=i(w),w=n,u=!0,n},r},r.isFinished=function(){var n=!u||p||f||l||c||a;return n&&(f||a)&&w===g&&(n=!1),n&&p&&w!==v&&(n=!1),n&&(l||c)&&h>=$&&(n=!1),!n},r.onComplete=function(n){return s=n||null,r},r.complete=function(){return s&&b(s)&&s(),r}},sn=function fn(n,e){if(S(n,on))return n;if(b(n))return new on(n);if(!S(this,fn))return new fn(n,e);var t=this;t.$interval=arguments.length?parseInt(n,10)||W:W,t.$timer=null,t.$runmode=A,t.$running=!1,t.$queue=[],J&&!1!==e&&t.initThread()};return sn.VERSION="0.5.1",sn.Thread=u,sn.Task=on,sn.BrowserWindow=rn,sn.MODE={NONE:A,INTERLEAVE:R,LINEAR:x,PARALLEL:M,SEQUENCE:O},sn.Platform={UNDEFINED:j,UNKNOWN:E,NODE:T,BROWSER:q},sn.supportsMultiThreading=function(){return P},sn.isPlatform=function(n){return T===n?L:q===n?D:e},sn.isThread=function(n,e){return e=!0===e?J:!0,T===n?e&&I:q===n?e&&(U||B):e&&G},sn.path=H,sn.blob=Y,sn.load=function(n,e,t){if(n){var r=function(){n=n.split(".");for(var e=z;n.length;)n[0]&&n[0].length&&e[n[0]]&&(e=e[n[0]]),n.shift();return e&&_!==e?b(e)?!1!==t?new e:e():e:void 0};return e&&e.length&&sn.importScripts(e.join?e.join(","):e),r()}return null},sn.listen=J?function(n){V.handler=n}:g,sn.send=J?function(n){_.postMessage(n)}:g,sn.importScripts=J?function(n){if(n&&n.length){n.split&&(n=n.split(","));for(var e=0,t=n.length;t>e;e++){var r=n[e];r&&r.length&&1!==Q[r]&&(_.importScripts(r),Q[r]=1)}}}:g,sn.close=J?function(){_.close()}:g,sn.log="undefined"!=typeof console?function(n){console.log(n||"")}:g,sn.serialize=function(n){n=n||new sn(0,!1);var e=function(e){var t=function(){var t=this,r=arguments;n.step(function(){e.apply(t,r)}),n.$running||n.run(x)};return t.free=function(){return e},t};return e.free=function(){n&&n.dispose(),n=null},e},sn[l]={constructor:sn,$interval:W,$timer:null,$queue:null,$thread:null,$events:null,$runmode:A,$running:!1,dispose:function(n){var e=this;return e.unfork(!0),e.$timer&&k(e.$timer),e.$thread=null,e.$timer=null,e.$interval=null,e.$queue=null,e.$runmode=A,e.$running=!1,J&&!0===n&&sn.close(),e},empty:function(){var n=this;return n.$timer&&k(n.$timer),n.$timer=null,n.$queue=[],n.$runmode=A,n.$running=!1,n},interval:function(n){return arguments.length?(this.$interval=parseInt(n,10)||this.$interval,this):this.$interval},fork:function(n,e,t,r){var o,i,s,l=this;if(!l.$thread){if(!P)throw l.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");L?(i="Asynchronous: Thread (Process): ",s="Asynchronous: Thread (Process) Error: "):(i="Asynchronous: Thread (Worker): ",s="Asynchronous: Thread (Worker) Error: "),l.$events=l.$events||{},o=l.$thread=!0===r?new u.Shared(nn):new u(nn),o.onmessage=function(n){if(n.event){var e=n.event,t=n.data||null;l.$events&&l.$events[e]?l.$events[e](t):"console.log"!==e&&"console.error"!==e||sn.log(("console.error"===e?s:i)+(t||""))}},o.onerror=function(n){if(!l.$events||!l.$events.error)throw new Error(s+n.toString());l.$events.error(n)},l.send("initThread",{component:n||null,asInstance:!1!==t,imports:e?[].concat(e).join(","):null})}return l},unfork:function(n){var e=this;return e.$thread&&(!0===n?e.$thread.terminate():e.send("dispose")),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return J&&(n.$events={},sn.listen(function(e){var t=e.event,r=e.data||null;t&&n.$events[t]?n.$events[t](r):"dispose"===t&&(n.dispose(),sn.close())})),n},listen:function(n,e){return n&&b(e)&&this.$events&&(this.$events[n]=e),this},unlisten:function(n,e){return n&&this.$events&&this.$events[n]&&(2>arguments.length||e===this.$events[n])&&delete this.$events[n],this},send:function(n,e){return n&&(J?sn.send({event:n,data:e||null}):this.$thread&&this.$thread.postMessage({event:n,data:e||null})),this},task:function(n){return S(n,on)?n:b(n)?on(n):void 0},iif:function(){var n=arguments,e=new on;return e.iif.apply(e,n)},until:function(){var n=w(arguments),e=new on(n.pop());return e.until.apply(e,n)},untilNot:function(){var n=w(arguments),e=new on(n.pop());return e.untilNot.apply(e,n)},loop:function(){var n=w(arguments),e=new on(n.pop());return e.loop.apply(e,n)},each:function(){var n=w(arguments),e=new on(n.pop());return e.each.apply(e,n)},recurse:function(){var n=w(arguments),e=new on(n.pop());return e.recurse.apply(e,n)},step:function(n){var e=this;return n&&e.$queue.push(e.task(n).queue(e)),e},steps:function(){var n,e,t=this,r=arguments;for(e=r.length,n=0;e>n;n++)t.step(r[n]);return t},jumpNext:function(n,e){var t=this,r=t.$queue;return e=e||0,!1!==n?function(){return e<r.length&&(e>0&&r.splice(0,e),t.run(t.$runmode)),t}:(e<r.length&&(e>0&&r.splice(0,e),t.run(t.$runmode)),t)},jumpNextWithArgs:function(n,e,t){var r=this,o=r.$queue;return e=e||0,!1!==n?function(){return e<o.length&&(e>0&&o.splice(0,e),r.run(r.$runmode,arguments)),r}:(e<o.length&&(e>0&&o.splice(0,e),r.run(r.$runmode,t)),r)},abort:function(n,e){var t=this;return!1!==n?function(){return e&&e>0?N(function(){t.empty()},e):t.empty(),t}:(e&&e>0?N(function(){t.empty()},e):t.empty(),t)},run:function(n,e){var t=this;return arguments.length?t.$runmode=n:n=t.$runmode,e=e||null,O===n?s(t,e):R===n?i(t,e):x===n?o(t,e):M===n&&r(t,e),t}},J&&(sn.log=function(n){sn.send({event:"console.log",data:"string"!=typeof n?$(n):n})},sn.listen(function(n){var e=n.event,t=n.data||null;switch(e){case"initThread":t&&t.component&&(K&&(b(K.dispose)&&K.dispose(),K=null),K=sn.load(t.component,t.imports,t.asInstance));break;case"dispose":K&&(b(K.dispose)&&K.dispose(),K=null),sn.close()}})),sn});
/**
*
*   FILTER.js
*   @version: 0.9.5
*   @built on 2016-07-26 14:24:06
*   @dependencies: Classy.js, Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(e,t,n){"use strict";function r(e,t,n,r){return e?t.map(function(t,a){return(n?e[a]:e[t])||(r?r(t):null)}):[]}var a="Classy,Asynchronous".split(/\s*,\s*/);"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.apply(e,r(module.$deps,a,!1,function(e){return require("./"+e.toLowerCase())}))):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"].concat(a),function(t){return n.moduleUri=t.uri,n.apply(e,r(Array.prototype.slice.call(arguments,1),a,!0))}):t in e||(e[t]=n.apply(e,r(e,a)))&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}(this,"FILTER",function e(t,n){"use strict";var r=t.Merge({Classy:t,Asynchronous:n,Path:n.path(e.moduleUri)},t);return r.VERSION="0.9.5",!function(e,t,n){var r,a,i="prototype",o=(Object[i],Function[i],Array[i]),s=t.Path,l=t.Merge,u=t.Asynchronous,h=u.isPlatform(u.Platform.NODE),c=u.isPlatform(u.Platform.BROWSER),f=u.supportsMultiThreading(),d=u.isThread(null,!0),g=u.isThread(),p="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",m="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",v="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",_=function(){return"[FILTER Plugin: "+this.name+"]"},y=function(e,t,n,r){return e},w=function(){},R=function(e){return function(){this.$super("constructor"),e.apply(this,arguments)}},C=(t.devicePixelRatio=(c&&!g?window.devicePixelRatio:1)||1,t._notSupportClamp="undefined"==typeof Uint8ClampedArray),I="undefined"==typeof Int16Array||"function"!=typeof Int16Array[i].set,b=0,A=t.Browser={isNode:h,isBrowser:c,isWorker:d,isInsideWorker:g,supportsWorker:f,isPhantom:/PhantomJS/.test(p),isOpera:c&&/Opera|OPR\//.test(p),isFirefox:c&&/Firefox\//.test(p),isChrome:c&&/Chrome\//.test(p),isSafari:c&&/Apple Computer/.test(v),isKhtml:c&&/KHTML\//.test(p),isIE:c&&(/MSIE \d/.test(p)||/Trident\/\d/.test(p)),isGecko:c&&/gecko\/\d/i.test(p),isWebkit:c&&/WebKit\//.test(p),isMac_geLion:c&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(p),isMac_geMountainLion:c&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(p),isMobile:!1,isIOS:/AppleWebKit/.test(p)&&/Mobile\/\w+/.test(p),isWin:/windows/i.test(m),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};A.isMobile=A.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(p),A.isMac=A.isIOS||/Mac/.test(m),A.isIE_lt8=A.isIE&&!g&&(null==document.documentMode||document.documentMode<8),A.isIE_lt9=A.isIE&&!g&&(null==document.documentMode||document.documentMode<9),A.isQtWebkit=A.isWebkit&&/Qt\/\d+\.\d+/.test(p),t.getPath=u.path,t.uuid=function(e){return[e||"filter",(new Date).getTime(),++b].join("_")},t.Array=Array,t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.ImArray=C?t.Array8U:Uint8ClampedArray,t.ImArrayCopy=A.isOpera?t.Array8U:t.ImArray,t.CHANNEL={R:0,G:1,B:2,A:3,RED:0,GREEN:1,BLUE:2,ALPHA:3},t.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:3,TILE:4,STRETCH:5},t.LUMA=new t.Array32F([.212671,.71516,.072169]),t.FORMAT={IMAGE:1024,DATA:2048,PNG:2,JPG:3,JPEG:4,GIF:5,BMP:6,TGA:7,RGBE:8},t.MIME={PNG:"image/png",JPG:"image/jpeg",JPEG:"image/jpeg",GIF:"image/gif",BMP:"image/bmp"},t.CONSTANTS=t.CONST={X:0,Y:1,Z:2,PI:Math.PI,PI2:2*Math.PI,PI_2:Math.PI/2,toRad:Math.PI/180,toDeg:180/Math.PI,SQRT2:Math.SQRT2,LN2:Math.LN2},t.IO={},t.Codec={},t.Interpolation={},t.Transform={},t.MachineLearning=t.ML={},t.Util={Math:{},Array:{arrayset:I?function(e,t,n){n=n||0;for(var r=0,a=t.length;a>r;r++)e[r+n]=t[r]}:function(e,t,n){e.set(t,n||0)},subarray:t.Array32F[i].subarray?function(e,t,n){return e.subarray(t,n)}:function(e,t,n){return e.slice(t,n)},typed:r=h?function(e,t){return null==e||e instanceof t?e:Array.isArray(e)?Array===t?e:new t(e):(null==e.length&&(e.length=Object.keys(e).length),Array===t?Array.prototype.slice.call(e):new t(Array.prototype.slice.call(e)))}:function(e,t){return e},typed_obj:h?function(e,t){return null==e?e:t?JSON.parse(e):JSON.stringify(e)}:function(e){return e}},String:{},IO:{},Filter:{},Image:{}},C=t._notSupportClamp=C||A.isOpera,t.NotImplemented=function(e){return e=e||"",function(){throw new Error("Method "+e+" not Implemented!")}},t.useWebGL=!1,t.useWebGLSharedResources=!1,t.useWebGLIfAvailable=function(e){},t.useWebGLSharedResourcesIfAvailable=function(e){},a=t.log=d?u.log:"undefine"!=typeof console&&console.log?function(e){console.log(e)}:function(e){},t.warning=function(e){a("WARNING: "+e)},t.error=function(e,t){if(a("ERROR: "+e),t)throw new Error(e)};var x=t.FilterThread=t.Class(u,{path:s,name:null,_listener:null,constructor:function(){var e=this,n=null;d&&e.initThread().listen("load",function(e){e&&e.filter&&(n&&(n.dispose(!0),n=null),n=u.load("FILTER."+e.filter))}).listen("import",function(e){e&&e["import"]&&e["import"].length&&u.importScripts(e["import"].join?e["import"].join(","):e["import"])}).listen("params",function(e){n&&n.unserialize(e)}).listen("apply",function(a){if(n&&a&&a.im){a.params&&n.unserialize(a.params);var i=r(a.im[0],t.ImArray);i=n._apply(i,a.im[1],a.im[2]),e.send("apply",{im:n._update?i:!1,meta:n.hasMeta?n.getMeta():null})}else e.send("apply",{im:null})}).listen("dispose",function(t){n&&(n.dispose(!0),n=null),e.dispose(!0)})},dispose:function(e){var t=this;return t.path=null,t.name=null,t._listener&&(t._listener.cb=null,t._listener=null),t.$super("dispose",e),t},thread:function(e,t){var n=this;return arguments.length||(e=!0),e=!!e,e&&!n.$thread?(n.fork("FILTER.FilterThread",s.file!==n.path.file?[s.file,n.path.file]:n.path.file),t&&t.length&&n.send("import",{"import":t.join?t.join(","):t}),n.send("load",{filter:n.name}),n.listen("apply",n._listener=function r(e){r.cb&&r.cb(e)})):!e&&n.$thread&&(n._listener.cb=null,n._listener=null,n.unfork()),n},sources:function(){if(!arguments.length)return this;var e=arguments[0]instanceof Array?arguments[0]:o.slice.call(arguments);if(e.length){var t,n=[];for(t=0;t<e.length;t++)"function"==typeof e[t]?n.push(u.blob(e[t].toString())):n.push(u.blob(e[t]));this.send("import",{"import":n.join(",")})}return this},scripts:function(){if(!arguments.length)return this;var e=arguments[0]instanceof Array?arguments[0]:o.slice.call(arguments);return e.length&&this.send("import",{"import":e.join(",")}),this}}),S=t.Filter=t.Class(x,{name:"Filter",constructor:function(){},id:null,_isOn:!0,_update:!0,_onComplete:null,hasMeta:!1,dispose:function(){var e=this;return e.$super("dispose"),e.name=null,e.id=null,e._isOn=null,e._update=null,e._onComplete=null,e.hasMeta=null,e},worker:x[i].thread,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{}}},unserialize:function(e){var t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn),t},complete:function(e){return this._onComplete=e||null,this},isOn:function(){return this._isOn},update:function(e){return arguments.length||(e=!0),this._update=!!e,this},turnOn:function(e){return arguments.length||(e=!0),this._isOn=!!e,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this},canRun:function(){return this._isOn},getMeta:function(){},setMeta:function(e){return this},combineWith:function(e){return this},_apply:function(e,t,n,r){return e},apply:function(e,n,a){var i,o,s=this;return s.canRun()?(arguments.length<3&&(n&&n.setSelectedData?a=null:"function"==typeof n?(a=n,n=e):(n=e,a=null)),e&&n&&(a=a||s._onComplete,i=e.getSelectedData(),s.$thread?(s._listener.cb=function(e){s._listener.cb=null,e&&(e.meta&&s.setMeta(e.meta),e.im&&n.setSelectedData(r(e.im,t.ImArray))),a&&a.call(s)},s.send("apply",{im:i,params:s.serialize()})):(o=s._apply(i[0],i[1],i[2],e),s._update&&n.setSelectedData(o),a&&a.call(s))),e):e},toString:function(){return"[FILTER: "+this.name+"]"}});t.Create=function(e){e=l({init:w,name:"PluginFilter",toString:_,apply:y},e),e.constructor=R(e.init),e._apply=e.apply,delete e.init,delete e.apply;var n=e.name;return t[n]=t.Class(S,e)}}(this,r),!function(e,t){function n(e,t,n){return e>n?n:t>e?t:e}function r(e){return F(2,T(J(e)))}function a(e,t){var n=new D(2);return n[0]=e||0,n[1]=t||0,n}function i(e,t,n){var r=new D(3);return r[0]=e||0,r[1]=t||0,r[2]=n||0,r}function o(e,t,n){return a(e[0]+n*(t[0]-e[0]),e[1]+n*(t[1]-e[1]))}function s(e,t,n){return i(e[0]+n*(t[0]-e[0]),e[1]+n*(t[1]-e[1]),e[2]+n*(t[2]-e[2]))}function l(e,t){return e[0]*t[1]-t[0]*e[1]}function u(e,t){var n;return 0>e&&(e=-e),0>t&&(t=-t),0===e?t:0===t?e:e>t?(n=t/e,e*L(1+n*n)):(n=e/t,t*L(1+n*n))}function h(e,t){var n,r,i,o,s;return n=a(e[0]-t[0],e[1]-t[1]),0===n[1]&&0===n[0]?null:(r=a(0,0),0===n[0]&&(r[0]=10),0===n[1]&&(r[1]=10),0!==n[1]&&0!==n[0]&&(i=n[1]/n[0],o=-n[0]/n[1],r[0]=10,r[1]=o*r[0]),s=u(r[0],r[1]),r[0]/=s,r[1]/=s,0>l(n,r)&&(r[0]=-r[0],r[1]=-r[1]),r)}function c(e,t,n,r,a,i,o){i=H(i,t-1),o=H(o,n-1);var s,l,u,h,c=i-r+1,f=o-a+1,d=c*f<<2,g=new x(d),p=c<<2;for(s=a,l=a*t,u=0;o>=s;s++,l+=t,u+=p)h=l+r<<2,z(g,V(e,h,h+p),u);return g}function f(e,t,n,r,a,i,o){r=r||0,a=a||0,i=i||0,o=o||0;var s,l,u,h,c=t+i+r,f=n+o+a,d=c*f<<2,g=new x(d),p=t<<2,m=c<<2,v=o*m,_=i<<2;for(s=0,l=0,u=v;n>s;s++,l+=t,u+=m)h=l<<2,z(g,V(e,h,h+p),_+u);return g}function d(e,t,n,r,a,i,o,s){if(r=H(r,t-1),a=H(a,n-1),i=H(i,t-1),o=H(o,n-1),0===r&&0===a&&t===i+1&&n===o+1)return!0===s?e:new S(e);if(!e.length||r>i||a>o)return new x(0);var l,u,h,c,f=i-r+1,d=o-a+1,g=f*d<<2,p=new x(g);for(l=r,u=a,h=0;o>=u;h+=4,l++)l>i&&(l=r,u++),c=u*t+l<<2,p[h]=e[c],p[h+1]=e[c+1],p[h+2]=e[c+2],p[h+3]=e[c+3];return p}function g(e,t,n,r,a,i,o,s,l,u,h,c){var f,d,g,p;if(!(e.length&&r.length&&a&&i&&t&&n))return e;for(o=H(o,a-1),s=H(s,i-1),h=H(h,t-1),c=H(c,n-1),l=H(l,a-1),u=H(u,i-1),h-=o,c-=s,g=o,p=s;u>=p;g++)g>l&&(g=o,p++),p+c>=n||g+h>=t||(f=p*a+g<<2,d=(p+c)*t+g+h<<2,e[d]=r[f],e[d+1]=r[f+1],e[d+2]=r[f+2],e[d+3]=r[f+3]);return e}function p(e,t,n,r,a,i,o,s){if(a=H(a,t-1),i=H(i,n-1),o=H(o,t-1),s=H(s,n-1),!e.length||a>o||i>s)return e;var l,u,h,c=255&r[0],f=255&r[1],d=255&r[2],g=3<r.length?255&r[3]:255;for(l=a,u=i;s>=u;l++)l>o&&(l=a,u++),h=u*t+l<<2,e[h]=c,e[h+1]=f,e[h+2]=d,e[h+3]=g;return e}function m(e,t,n,r){var a,i,o,s,l,u=t<<2,h=e.length,c=h>>2;for(r=r||0,a=new D(c),l=0,s=0,o=0,i=0;t>l;l++,o+=4,s++)i+=e[o+r],a[s]=i;for(l=0,s=0,i=0,o=u;h>o;o+=4,s++,l++)l>=t&&(l=0,i=0),i+=e[o+r],a[s+t]=a[s]+i;return a}function v(e,t,n,r){var a,i,o,s=e.length,l=1/(s>>2);for(r=r||0,i=new D(256),a=0;s>a;a+=4)i[e[a+r]]+=l;for(o=0,a=0;256>a;a+=32)o+=i[a],i[a]=o,o+=i[a+1],i[a+1]=o,o+=i[a+2],i[a+2]=o,o+=i[a+3],i[a+3]=o,o+=i[a+4],i[a+4]=o,o+=i[a+5],i[a+5]=o,o+=i[a+6],i[a+6]=o,o+=i[a+7],i[a+7]=o,o+=i[a+8],i[a+8]=o,o+=i[a+9],i[a+9]=o,o+=i[a+10],i[a+10]=o,o+=i[a+11],i[a+11]=o,o+=i[a+12],i[a+12]=o,o+=i[a+13],i[a+13]=o,o+=i[a+14],i[a+14]=o,o+=i[a+15],i[a+15]=o,o+=i[a+16],i[a+16]=o,o+=i[a+17],i[a+17]=o,o+=i[a+18],i[a+18]=o,o+=i[a+19],i[a+19]=o,o+=i[a+20],i[a+20]=o,o+=i[a+21],i[a+21]=o,o+=i[a+22],i[a+22]=o,o+=i[a+23],i[a+23]=o,o+=i[a+24],i[a+24]=o,o+=i[a+25],i[a+25]=o,o+=i[a+26],i[a+26]=o,o+=i[a+27],i[a+27]=o,o+=i[a+28],i[a+28]=o,o+=i[a+29],i[a+29]=o,o+=i[a+30],i[a+30]=o,o+=i[a+31],i[a+31]=o;return i}function _(e,t,n,r){return null}function y(e,t,n,r,a,i,o,s,l,u,h){var c,f,d,g,p,m,v,_,y,w,R,C,I,b,A,S,M,E,k,O,P,L,F,T,G,U,B,H,N,W,j,X,K,q,$,Y,J,z,V,Z,ee,te,ne,re,ae,ie,oe,se,le=t.length,ue=le>>2,he=o,ce=s;if(_=he*ce,m=he>>1,v=n*(ce>>1),R=-m-1,I=-v-n,C=m,b=v,W=0,X=n-1,j=0,K=ue-n,f=(ue<<1)+ue,w=(n<<1)+n,y=t,t=new x(le),c=new D(f),h=h||1,i)for(O=a[0],P=a[_>>1],L=P-O,F=i[0],T=i[_>>1],G=T-F,oe=0;h>oe;oe++){for(se=t,t=y,y=se,A=0,S=0,d=g=p=0,M=0;n>M;M++,A+=4,S+=3)d+=t[A],g+=t[A+1],p+=t[A+2],c[S]=d,c[S+1]=g,c[S+2]=p;for(S=0,M=0,d=g=p=0,A=w+n;le>A;A+=4,S+=3,M++)M>=n&&(M=0,d=g=p=0),d+=t[A],g+=t[A+1],p+=t[A+2],c[S+w]=c[S]+d,c[S+w+1]=c[S+1]+g,c[S+w+2]=c[S+2]+p;for(M=0,E=0,k=0,A=0;le>A;A+=4,M++)M>=n&&(M=0,E++,k+=n),U=M+R,B=k+I,H=M+C,N=k+b,U=W>U?W:U,H=H>X?X:H,B=j>B?j:B,N=N>K?K:N,q=U+B,J=H+N,$=H+B,Y=U+N,q=(q<<1)+q,$=($<<1)+$,Y=(Y<<1)+Y,J=(J<<1)+J,ee=O*(c[J]-c[$]-c[Y]+c[q])+L*t[A],te=O*(c[J+1]-c[$+1]-c[Y+1]+c[q+1])+L*t[A+1],ne=O*(c[J+2]-c[$+2]-c[Y+2]+c[q+2])+L*t[A+2],re=F*(c[J]-c[$]-c[Y]+c[q])+G*t[A],ae=F*(c[J+1]-c[$+1]-c[Y+1]+c[q+1])+G*t[A+1],ie=F*(c[J+2]-c[$+2]-c[Y+2]+c[q+2])+G*t[A+2],z=l*ee+u*re,V=l*te+u*ae,Z=l*ne+u*ie,Q&&(z=0>z?0:z>255?255:z,V=0>V?0:V>255?255:V,Z=0>Z?0:Z>255?255:Z),y[A]=~~z,y[A+1]=~~V,y[A+2]=~~Z,y[A+3]=t[A+3]}else for(O=a[0],P=a[_>>1],L=P-O,oe=0;h>oe;oe++){for(se=t,t=y,y=se,A=0,S=0,d=g=p=0,M=0;n>M;M++,A+=4,S+=3)d+=t[A],g+=t[A+1],p+=t[A+2],c[S]=d,c[S+1]=g,c[S+2]=p;for(S=0,M=0,d=g=p=0,A=w+n;le>A;A+=4,S+=3,M++)M>=n&&(M=0,d=g=p=0),d+=t[A],g+=t[A+1],p+=t[A+2],c[S+w]=c[S]+d,c[S+w+1]=c[S+1]+g,c[S+w+2]=c[S+2]+p;for(M=0,E=0,k=0,A=0;le>A;A+=4,M++)M>=n&&(M=0,E++,k+=n),U=M+R,B=k+I,H=M+C,N=k+b,U=W>U?W:U,H=H>X?X:H,B=j>B?j:B,N=N>K?K:N,q=U+B,J=H+N,$=H+B,Y=U+N,q=(q<<1)+q,$=($<<1)+$,Y=(Y<<1)+Y,J=(J<<1)+J,ee=O*(c[J]-c[$]-c[Y]+c[q])+L*t[A],te=O*(c[J+1]-c[$+1]-c[Y+1]+c[q+1])+L*t[A+1],ne=O*(c[J+2]-c[$+2]-c[Y+2]+c[q+2])+L*t[A+2],z=l*ee+u,V=l*te+u,Z=l*ne+u,Q&&(z=0>z?0:z>255?255:z,V=0>V?0:V>255?255:V,Z=0>Z?0:Z>255?255:Z),y[A]=~~z,y[A+1]=~~V,y[A+2]=~~Z,y[A+3]=t[A+3]}return y}function w(e,t,n,r,a,i,o,s,l,u){var h,c,f,d,g,p,m,v,_,y,w,R,C,I,b,A,S,D,E,k,O,P,L,F,T,G,U,B,H=t.length,N=H>>2;for(A=n-1,S=N-n,m=new M(o),w=0,d=o.length;d>w;w+=2)m[w+1]*=n;for(v=new M(s),w=0,d=s.length;d>w;w+=2)v[w+1]*=n;for(U=2,c=a,f=o,G=l,p=m,g=t,t=new x(H);U--;){if(B=t,t=g,g=B,h=c.length,d=f.length,Q)for(R=0,C=0,_=0;H>_;_+=4,R++){for(R>=n&&(R=0,C+=n),P=L=F=T=0,w=0,y=0;h>w;w++,y+=2)I=R+p[y],b=C+p[y+1],I>=0&&A>=I&&b>=0&&S>=b&&(srcOff=I+b<<2,O=c[w],P+=t[srcOff]*O,L+=t[srcOff+1]*O,F+=t[srcOff+2]*O);D=G*P,E=G*L,k=G*F,D=0>D?0:D>255?255:D,E=0>E?0:E>255?255:E,k=0>k?0:k>255?255:k,g[_]=~~D,g[_+1]=~~E,g[_+2]=~~k,g[_+3]=t[_+3]}else for(R=0,C=0,_=0;H>_;_+=4,R++){for(R>=n&&(R=0,C+=n),P=L=F=T=0,w=0,y=0;h>w;w++,y+=2)I=R+p[y],b=C+p[y+1],I>=0&&A>=I&&b>=0&&S>=b&&(srcOff=I+b<<2,O=c[w],P+=t[srcOff]*O,L+=t[srcOff+1]*O,F+=t[srcOff+2]*O);D=G*P,E=G*L,k=G*F,g[_]=~~D,g[_+1]=~~E,g[_+2]=~~k,g[_+3]=t[_+3]}c=i,f=s,G=u,p=v}return g}function R(e,t,n,r,a){e[t]=255&~~(n[0]+a*(r[0]-n[0])),e[t+1]=255&~~(n[1]+a*(r[1]-n[1])),e[t+2]=255&~~(n[2]+a*(r[2]-n[2])),e[t+3]=255&~~(n[3]+a*(r[3]-n[3]))}function C(e,t){t=t?t.slice():t,e=e?e.slice():e;var n,r=e.length;if(t){if(t.length<r){var a=t.length,i=t[a-1];for(n=a;r>n;n++)t.push(n+1===r?1:i+(n-a+1)/(r-1))}}else if(1===r)t=[1];else for(t=new Array(r),n=0;r>n;n++)t[n]=n+1===r?1:n/(r-1);return 1!=t[t.length-1]&&(t.push(1),e.push(e[e.length-1])),[e,t]}function I(e,t,n,r,a,i,o){var s,l,u,h,c,f,d,g,p,m,v,_=e.length;if(i=i||0,0>i&&(i+=q),i>q&&(i-=q),p=N(U(i)),m=N(B(i)),v=m*t+p*n,i>$&&K>=i)for(l=0,u=0,s=0;_>s;s+=4,l++){for(l>=t&&(l=0,u++),c=t-1-l,f=u,h=H(1,(m*c+p*f)/v),g=0;h>a[g];)++g;d=0===g?0:g-1,o(e,s,r[d],r[g],a[g]>a[d]?(h-a[d])/(a[g]-a[d]):h)}else if(i>K&&Y>=i)for(l=0,u=0,s=0;_>s;s+=4,l++){for(l>=t&&(l=0,u++),c=t-1-l,f=n-1-u,h=H(1,(m*c+p*f)/v),g=0;h>a[g];)++g;d=0===g?0:g-1,o(e,s,r[d],r[g],a[g]>a[d]?(h-a[d])/(a[g]-a[d]):h)}else if(i>Y&&q>i)for(l=0,u=0,s=0;_>s;s+=4,l++){for(l>=t&&(l=0,u++),c=l,f=n-1-u,h=H(1,(m*c+p*f)/v),g=0;h>a[g];)++g;d=0===g?0:g-1,o(e,s,r[d],r[g],a[g]>a[d]?(h-a[d])/(a[g]-a[d]):h)}else for(l=0,u=0,s=0;_>s;s+=4,l++){for(l>=t&&(l=0,u++),c=l,f=u,h=H(1,(m*c+p*f)/v),g=0;h>a[g];)++g;d=0===g?0:g-1,o(e,s,r[d],r[g],a[g]>a[d]?(h-a[d])/(a[g]-a[d]):h)}return e}function b(e,t,n,r,a,i,o,s,l,u){var h,c,f,d,g,p,m,v,_=e.length;for(i=i||0,o=o||0,s=s||1,l=l||1,l>s?(s/=l,l=1):s>l?(l/=s,s=1):(l=1,s=1),c=0,f=0,h=0;_>h;h+=4,c++){for(c>=t&&(c=0,f++),g=s*(c-i)/(t-i),p=l*(f-o)/(n-o),d=H(1,L(g*g+p*p)),v=0;d>a[v];)++v;m=0===v?0:v-1,u(e,h,r[m],r[v],a[v]>a[m]?(d-a[m])/(a[v]-a[m]):d)}return e}function A(e){return e.replace(Z,"\\$1")}var x=e.ImArray,S=e.ImArrayCopy,D=e.Array32F,M=(e.Array64F,e.Array16I),E=(e.Array8U,e.Util.Math),k=e.Util.String,O=e.Util.Image,P=e.Util.Filter,L=Math.sqrt,F=Math.pow,T=Math.ceil,G=Math.log,U=Math.sin,B=Math.cos,H=Math.min,N=(Math.max,Math.abs),W=Math.PI,j=W+W,X=.5*W,K=W,q=j,$=X,Y=3*$,J=Math.log2||function(e){return G(e)/Math.LN2},z=e.Util.Array.arrayset,V=e.Util.Array.subarray,Q=e._notSupportClamp,Z=/([.*+?^${}()|\[\]\/\\\-])/g,ee=/^\s+|\s+$/g;E.clamp=n,E.closest_power2=r,E.Geometry={Point2:a,Point3:i,enorm2:u,cross2:l,normal2:h,interpolate2:o,interpolate3:s},k.esc=A,k.trim=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(ee,"")},O.crop=e.Interpolation.crop=c,O.pad=e.Interpolation.pad=f,O.get_data=d,O.set_data=g,O.fill=p,O.integral=m,O.histogram=v,O.spectrum=_,O.gradient=I,O.radial_gradient=b,O.lerp=R,O.colors_stops=C,P.integral_convolution=y,P.separable_convolution=w}(r),!function(e,t){var n=e.Util.Math.clamp,r=e.ImArray;e.Interpolation.bilinear=function(e,t,a,i,o){var s,l,u,h,c,f,d,g,p,m,v,_,y,w,R,C,I,b,A,x=i*o<<2,S=new r(x),D=(t-1)/i,M=(a-1)/o,E=t<<2;for(p=0,m=0,v=0,_=0,w=0,I=0,A=0,C=0;x>C;C+=4,m++,v+=D)m>=i&&(m=0,v=0,p++,_+=M,w=~~_,A=_-w,I=w*t),y=~~v,b=v-y,c=(1-b)*(1-A),f=b*(1-A),d=A*(1-b),g=b*A,R=I+y<<2,s=e[R],l=e[R+4],u=e[R+E],h=e[R+E+4],S[C]=n(~~(s*c+l*f+u*d+h*g+.5),0,255),s=e[R+1],l=e[R+5],u=e[R+E+1],h=e[R+E+5],S[C+1]=n(~~(s*c+l*f+u*d+h*g+.5),0,255),s=e[R+2],l=e[R+6],u=e[R+E+2],h=e[R+E+6],S[C+2]=n(~~(s*c+l*f+u*d+h*g+.5),0,255),s=e[R+3],l=e[R+7],u=e[R+E+3],h=e[R+E+7],S[C+3]=n(~~(s*c+l*f+u*d+h*g+.5),0,255);return S}}(r),!function(e,t){var n=(e.Util.Math.clamp,e.ImArray);e.Interpolation.nearest=function(e,t,r,a,i){var o,s,l,u,h,c,f,d,g,p,m,v=a*i<<2,_=new n(v),y=(t-1)/a,w=(r-1)/i,R=t<<2;for(o=0,s=0,l=0,u=0,c=0,g=0,m=0,d=0;v>d;d+=4,s++,l+=y)s>=a&&(s=0,l=0,o++,u+=w,c=~~u,g=c*t,m=.5>u-c?0:R),h=~~l,p=.5>l-h?0:4,f=(g+h<<2)+p+m,_[d]=e[f],_[d+1]=e[f+1],_[d+2]=e[f+2],_[d+3]=e[f+3];return _}}(r),!function(e,t){var n=e.Util.Math.clamp,r=e.ImArray,a=e.Array32F,i=e.Util.Array.subarray;e.Interpolation.bicubic=function(e,t,o,s,l){var u,h,c,f,d,g,p,m,v,_,y,w,R,C,I,b,A,x,S,D,M,E,k,O,P,L,F,T,G,U,B,H,N,W,j,X,K,q,$,Y=s*l<<2,J=new r(Y),z=(t-1)/s,V=(o-1)/l,Q=new r(4),Z=new a(4),ee=new a(4),te=new a(4),ne=new a(4),re=t<<2;for(u=0,h=0,c=0,f=0,g=0,v=0,y=C=I=0,m=0;Y>m;m+=4,h++,c+=z)h>=s&&(h=0,c=0,u++,f+=V,g=~~f,y=f-g,C=y*y,I=C*I,v=g*t),d=~~c,_=c-d,w=_*_,R=w*_,p=v+d<<2,X=0===g,K=o-1===g,q=0===d,$=t-1===d,O=i(e,p,p+4),P=q?O:i(e,p-4,p),L=$?O:i(e,p+4,p+8),F=$?O:i(e,p+8,p+12),b=K?O:i(e,p+re,p+re+4),D=K?O:i(e,p+re+re,p+re+re+4),A=K||q?O:i(e,p+re-4,p+re),x=K||$?O:i(e,p+re+4,p+re+8),S=K||$?O:i(e,p+re+8,p+re+12),M=K||q?O:i(e,p+re+re-4,p+re+re),E=K||$?O:i(e,p+re+re+4,p+re+re+8),k=K||$?O:i(e,p+re+re+8,p+re+re+12),T=X?O:i(e,p-re,p-re+4),G=X||q?O:i(e,p-re-4,p-re),U=X||$?O:i(e,p-re+4,p-re+8),B=X||$?O:i(e,p-re+8,p-re+12),H=B[0]-U[0]-(G[0]-T[0]),N=G[0]-T[0]-H,W=U[0]-G[0],j=T[0],Z[0]=H*R+N*w+W*_+j,H=B[1]-U[1]-(G[1]-T[1]),N=G[1]-T[1]-H,W=U[1]-G[1],j=T[1],Z[1]=H*R+N*w+W*_+j,H=B[2]-U[2]-(G[2]-T[2]),N=G[2]-T[2]-H,W=U[2]-G[2],j=T[2],Z[2]=H*R+N*w+W*_+j,H=B[3]-U[3]-(G[3]-T[3]),N=G[3]-T[3]-H,W=U[3]-G[3],j=T[3],Z[3]=H*R+N*w+W*_+j,H=F[0]-L[0]-(P[0]-O[0]),N=P[0]-O[0]-H,W=L[0]-P[0],j=O[0],ee[0]=H*R+N*w+W*_+j,H=F[1]-L[1]-(P[1]-O[1]),N=P[1]-O[1]-H,W=L[1]-P[1],j=O[1],ee[1]=H*R+N*w+W*_+j,H=F[2]-L[2]-(P[2]-O[2]),N=P[2]-O[2]-H,W=L[2]-P[2],j=O[2],ee[2]=H*R+N*w+W*_+j,H=F[3]-L[3]-(P[3]-O[3]),N=P[3]-O[3]-H,W=L[3]-P[3],j=O[3],ee[3]=H*R+N*w+W*_+j,H=S[0]-x[0]-(A[0]-b[0]),N=A[0]-b[0]-H,W=x[0]-A[0],j=b[0],te[0]=H*R+N*w+W*_+j,H=S[1]-x[1]-(A[1]-b[1]),N=A[1]-b[1]-H,W=x[1]-A[1],j=b[1],te[1]=H*R+N*w+W*_+j,H=S[2]-x[2]-(A[2]-b[2]),N=A[2]-b[2]-H,W=x[2]-A[2],j=b[2],te[2]=H*R+N*w+W*_+j,H=S[3]-x[3]-(A[3]-b[3]),N=A[3]-b[3]-H,W=x[3]-A[3],j=b[3],te[3]=H*R+N*w+W*_+j,H=k[0]-E[0]-(M[0]-D[0]),N=M[0]-D[0]-H,W=E[0]-M[0],j=D[0],ne[0]=H*R+N*w+W*_+j,H=k[1]-E[1]-(M[1]-D[1]),N=M[1]-D[1]-H,W=E[1]-M[1],j=D[1],ne[1]=H*R+N*w+W*_+j,H=k[2]-E[2]-(M[2]-D[2]),N=M[2]-D[2]-H,W=E[2]-M[2],j=D[2],ne[2]=H*R+N*w+W*_+j,H=k[3]-E[3]-(M[3]-D[3]),N=M[3]-D[3]-H,W=E[3]-M[3],j=D[3],ne[3]=H*R+N*w+W*_+j,H=ne[0]-te[0]-(Z[0]-ee[0]),N=Z[0]-ee[0]-H,W=te[0]-Z[0],j=ee[0],Q[0]=n(~~(H*I+N*C+W*y+j+.5),0,255),H=ne[1]-te[1]-(Z[1]-ee[1]),N=Z[1]-ee[1]-H,W=te[1]-Z[1],j=ee[1],Q[1]=n(~~(H*I+N*C+W*y+j+.5),0,255),H=ne[2]-te[2]-(Z[2]-ee[2]),N=Z[2]-ee[2]-H,W=te[2]-Z[2],j=ee[2],Q[2]=n(~~(H*I+N*C+W*y+j+.5),0,255),H=ne[3]-te[3]-(Z[3]-ee[3]),N=Z[3]-ee[3]-H,W=te[3]-Z[3],j=ee[3],Q[3]=n(~~(H*I+N*C+W*y+j+.5),0,255),J[m]=Q[0],J[m+1]=Q[1],J[m+2]=Q[2],J[m+3]=Q[3];return J}}(r),!function(e,t){var n=Math.sqrt,r=Math.round,a=(Math.floor,Math.min),i=Math.max,o=Math.abs,s=e.Util.Math.clamp,l=e.Util.String.esc,u=e.Util.String.trim,h=e.LUMA,c=1/255,f=100/255,d=2.55,g={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},p=e.Color=e.Class({__static__:{clamp:s,clampPixel:function(e){return a(255,i(e,0))},intensity:function(e,t,n){return~~(h[0]*e+h[1]*t+h[2]*n)},hue:function(e,t,n){var r=i(e,t,n);return 0===r||e===t&&t===n?0:e===r?60*o(t-n)/(r-a(e,t,n)):t===r?120+60*o(n-e)/(r-a(e,t,n)):240+60*o(e-t)/(r-a(e,t,n))},distance:function(e,t){var r=e[0]-t[0],a=e[1]-t[1],i=e[2]-t[2];return n(r*r+a*a+i*i)},RGB2Color:function(e){return e[0]<<16|e[1]<<8|255&e[2]},RGBA2Color:function(e){return e[3]<<24|e[0]<<16|e[1]<<8|255&e[2]},Color2RGBA:function(e){return e=~~e,[e>>>16&255,e>>>8&255,255&e,e>>>24&255]},RGB2YCbCr:function(e){var t=e[0],n=e[1],r=e[2];return[~~(0+.299*t+.587*n+.114*r),~~(128-.168736*t-.331264*n+.5*r),~~(128+.5*t-.418688*n-.081312*r)]},YCbCr2RGB:function(e){var t=e[0],n=e[1],r=e[2];return[~~(t+1.402*(r-128)),~~(t-.34414*(n-128)-.71414*(r-128)),~~(t+1.772*(n-128))]},RGB2HSV:function(e){var t,n,r,s,l,u,h,c,f;return s=e[0],l=e[1],u=e[2],t=a(s,l,u),n=i(s,l,u),r=n-t,f=n,0===n||s===l&&l===u?(c=0,h=0,[h,c,f]):(c=r/n,h=s===n?60*o(l-u)/r:l===n?120+60*o(u-s)/r:240+60*o(s-l)/r,[h,c,f])},HSV2RGB:function(e){var t,n,r,a,i,o,s,l,u,h,c;return u=e[0],h=e[1],c=e[2],0===h?(o=s=l=c,[o,s,l]):(u/=60,t=~~u,n=u-t,r=c*(1-h),a=c*(1-h*n),i=c*(1-h*(1-n)),0===t?(o=c,s=i,l=r):1===t?(o=a,s=c,l=r):2===t?(o=r,s=c,l=i):3===t?(o=r,s=a,l=c):4===t?(o=i,s=r,l=c):(o=c,s=r,l=a),[o,s,l])},toString:function(){return"[FILTER: "+this.name+"]"},C2F:c,C2P:f,P2C:d,Keywords:g,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(g).map(l).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(e,t){return e*f+(t||"")},per2col:function(e){return e*d},rgb2cmyk:function(e,t,n,i){var o,l,u=0,h=0,f=0,g=0;return i&&(e=s(r(e*d),0,255),t=s(r(t*d),0,255),n=s(r(n*d),0,255)),0==e&&0==t&&0==n?(g=1,[0,0,0,1]):(u=1-e*c,h=1-t*c,f=1-n*c,o=a(u,h,f),l=1/(1-o),u=(u-o)*l,h=(h-o)*l,f=(f-o)*l,g=o,[u,h,f,g])},cmyk2rgb:function(e,t,n,a){var i,o,l=0,u=0,h=0;return 0==e&&0==t&&0==n?[0,0,0]:(i=a,o=1-i,e=e*o+i,t=t*o+i,n=n*o+i,l=255*(1-e),u=255*(1-t),h=255*(1-n),[s(r(l),0,255),s(r(u),0,255),s(r(h),0,255)])},rgb2hex:function(e,t,n,a,i){var o;return i&&(e=s(r(e*d),0,255),t=s(r(t*d),0,255),n=s(r(n*d),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),n=16>n?"0"+n.toString(16):n.toString(16),o=a&&e[0]==e[1]&&t[0]==t[1]&&n[0]==n[1]?"#"+e[0]+t[0]+n[0]:"#"+e+t+n},rgb2hexIE:function(e,t,n,a,i){var o;return i&&(e=s(r(e*d),0,255),t=s(r(t*d),0,255),n=s(r(n*d),0,255),a=s(r(a*d),0,255)),e=16>e?"0"+e.toString(16):e.toString(16),t=16>t?"0"+t.toString(16):t.toString(16),n=16>n?"0"+n.toString(16):n.toString(16),a=16>a?"0"+a.toString(16):a.toString(16),o="#"+a+e+t+n},hex2rgb:function(e){return!e||3>e.length?[0,0,0]:6>e.length?[s(parseInt(e[0]+e[0],16),0,255),s(parseInt(e[1]+e[1],16),0,255),s(parseInt(e[2]+e[2],16),0,255)]:[s(parseInt(e[0]+e[1],16),0,255),s(parseInt(e[2]+e[3],16),0,255),s(parseInt(e[4]+e[5],16),0,255)]},hue2rgb:function(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e},hsl2rgb:function(e,t,n){var a,i,o,l,u,h=p.hue2rgb;return e=(e+360)%360/360,t*=.01,n*=.01,0==t?(a=1,i=1,o=1):(u=.5>n?n*(1+t):n+t-n*t,l=2*n-u,a=h(l,u,e+1/3),i=h(l,u,e),o=h(l,u,e-1/3)),[s(r(255*a),0,255),s(r(255*i),0,255),s(r(255*o),0,255)]},rgb2hsl:function(e,t,n,o){var l,u,h,f,d,g;return o?(e*=.01,t*=.01,n*=.01):(e*=c,t*=c,n*=c),u=i(e,t,n),l=a(e,t,n),d=.5*(u+l),u==l?h=f=0:(g=u-l,f=d>.5?g/(2-i-a):g/(i+a),h=u==e?(t-n)/g+(n>t?6:0):u==t?(n-e)/g+2:(e-t)/g+4,h/=6),[r(360*h)%360,s(100*f,0,100),s(100*d,0,100)]},parse:function(e,t,n,r){var a,i,o,s,l,h=0,c=0;if("hsl"===n||!n&&(a=e.match(p.hslRE))){if("hsl"===n){l="hsla"===e[0].toLowerCase();var d=e[1].split(",").map(u)}else{h=a[0].length,c=0,l="hsla"===a[1].toLowerCase();var d=a[2].split(",").map(u)}var g=d[0]?d[0]:"0",e=d[1]?d[1]:"0",m=d[2]?d[2]:"0",v=l&&null!=d[3]?d[3]:"1";return g=parseFloat(g,10),e="%"===e.slice(-1)?parseFloat(e,10):parseFloat(e,10)*f,m="%"===m.slice(-1)?parseFloat(m,10):parseFloat(m,10)*f,v=parseFloat(v,10),s=(new p).fromHSL([g,e,m,v]),t&&(o=e.substr(h),(i=o.match(p.colorstopRE))&&(s.colorStop(i[1]),c=i[0].length)),r?s:[s,0,h+c]}if("rgb"===n||!n&&(a=e.match(p.rgbRE))){if("rgb"===n){l="rgba"===e[0].toLowerCase();var d=e[1].split(",").map(u)}else{h=a[0].length,c=0,l="rgba"===a[1].toLowerCase();var d=a[2].split(",").map(u)}var _=d[0]?d[0]:"0",y=d[1]?d[1]:"0",w=d[2]?d[2]:"0",v=l&&null!=d[3]?d[3]:"1";return _="%"===_.slice(-1)?2.55*parseFloat(_,10):parseFloat(_,10),y="%"===y.slice(-1)?2.55*parseFloat(y,10):parseFloat(y,10),w="%"===w.slice(-1)?2.55*parseFloat(w,10):parseFloat(w,10),v=parseFloat(v,10),s=(new p).fromRGB([_,y,w,v]),t&&(o=e.substr(h),(i=o.match(p.colorstopRE))&&(s.colorStop(i[1]),c=i[0].length)),r?s:[s,0,h+c]}if("hex"===n||!n&&(a=e.match(p.hexRE))){if("hex"===n)var d=p.hex2rgb(e[0]);else{h=a[0].length,c=0;var d=p.hex2rgb(a[1])}var R=d[0]?d[0]:0,C=d[1]?d[1]:0,I=d[2]?d[2]:0,v=null!=d[3]?d[3]:255;return s=(new p).fromHEX([R,C,I,v]),t&&(o=e.substr(h),(i=o.match(p.colorstopRE))&&(s.colorStop(i[1]),c=i[0].length)),r?s:[s,0,h+c]}if("keyword"===n||!n&&(a=e.match(p.keywordRE))){if("keyword"===n)var d=e[0];else{h=a[0].length,c=0;var d=a[1]}return s=(new p).fromKeyword(d),t&&(o=e.substr(h),(i=o.match(p.colorstopRE))&&(s.colorStop(i[1]),c=i[0].length)),r?s:[s,0,h+c]}return null},fromString:function(e,t,n){return p.parse(e,t,n,1)},fromRGB:function(e){return(new p).fromRGB(e)},fromHSL:function(e){return(new p).fromHSL(e)},fromCMYK:function(e){return(new p).fromCMYK(e)},fromHEX:function(e){return(new p).fromHEX(e)},fromKeyword:function(e){return(new p).fromKeyword(e)},fromPixel:function(e){return(new p).fromPixel(e)}},constructor:function m(e,t){return this instanceof m?(this.reset(),void(e&&this.set(e,t))):new m(e,t)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var e=new p;return e.col=this.col.slice(),e.cstop=this.cstop+"",e.kword=this.kword,e},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(e,n){return e&&(t!==e[0]&&(this.col[0]=s(e[0],0,255)),t!==e[1]&&(this.col[1]=s(e[1],0,255)),t!==e[2]&&(this.col[2]=s(e[2],0,255)),t!==e[3]?this.col[3]=s(e[3],0,1):this.col[3]=1,n&&(this.cstop=n),this.kword=null),this},colorStop:function(e){return this.cstop=e,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return!!this.kword},fromPixel:function(e){return e=e||0,this.col=[s(e>>16&255,0,255),s(e>>8&255,0,255),s(255&e,0,255),s((e>>24&255)*c,0,1)],this.kword=null,this},fromKeyword:function(e){return e=e.toLowerCase(),p.Keywords[e]&&(this.col=p.Keywords[e].slice(),this.kword=e),this},fromHEX:function(e){return this.col[0]=e[0]?s(parseInt(e[0],10),0,255):0,this.col[1]=e[1]?s(parseInt(e[1],10),0,255):0,this.col[2]=e[2]?s(parseInt(e[2],10),0,255):0,this.col[3]=t!==e[3]?s(parseInt(e[3],10)*c,0,1):1,this.kword=null,this},fromRGB:function(e){return this.col[0]=e[0]?s(r(e[0]),0,255):0,this.col[1]=e[1]?s(r(e[1]),0,255):0,this.col[2]=e[2]?s(r(e[2]),0,255):0,this.col[3]=t!==e[3]?s(e[3],0,1):1,this.kword=null,this},fromCMYK:function(e){var n=p.cmyk2rgb(e[0]||0,e[1]||0,e[2]||0,e[3]||0);return this.col[0]=n[0],this.col[1]=n[1],this.col[2]=n[2],this.col[3]=t!==e[4]?s(e[4],0,1):1,this.kword=null,this},fromHSL:function(e){var n=p.hsl2rgb(e[0]||0,e[1]||0,e[2]||0);return this.col[0]=n[0],this.col[1]=n[1],this.col[2]=n[2],this.col[3]=t!==e[3]?s(e[3],0,1):1,this.kword=null,this},toPixel:function(e){return e?s(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2];
},toCMYK:function(e,t,n){var r=p.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return n?r:r.concat(this.col[3])},toKeyword:function(e,t,n){return this.kword?this.kword:this.toHEX(1,t,n)},toHEX:function(e,t,n){return n?p.rgb2hexIE(this.col[0],this.col[1],this.col[2],s(r(255*this.col[3]),0,255)):p.rgb2hex(this.col[0],this.col[1],this.col[2],t)},toRGB:function(e,t,n){var r=this.col[3];return e?(t&&(r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(r).join(",")+")"):n?this.col.slice(0,3):this.col.slice()},toHSL:function(e,t,n){var r=this.col[3],a=p.rgb2hsl(this.col[0],this.col[1],this.col[2]);return e?(t&&(a[1]=0==a[1]?a[1]:a[1]+"%",a[2]=0==a[2]?a[2]:a[2]+"%",r=1>r&&r>0?r.toString().slice(1):r),n||1==this.col[3]?"hsl("+[a[0],a[1],a[2]].join(",")+")":"hsla("+[a[0],a[1],a[2],r].join(",")+")"):n?a:a.concat(this.col[3])},toColorStop:function(e){var t=this.cstop;return e?(t=t.length?t+",":"",1>this.col[3]?"color-stop("+t+this.toRGB(1,1)+")":"color-stop("+t+this.toHEX(1,1)+")"):(t=t.length?" "+t:"",1>this.col[3]?this.toRGB(1,1)+t:this.toHEX(1,1)+t)},toString:function(e,t){return e=e?e.toLowerCase():"hex","rgb"==e||"rgba"==e?this.toRGB(1,!1!==t,"rgb"==e):"hsl"==e||"hsla"==e?this.toHSL(1,!1!==t,"hsl"==e):"keyword"==e?this.toKeyword(1):this.toHEX(1,!1!==t,"hexie"==e)}});p.toGray=p.intensity,p.Blend=p.Combine={normal:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=f,o=d,s=g,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},lighten:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=u>f?u:f,o=h>d?h:d,s=c>g?c:g,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},darken:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=u>f?f:u,o=h>d?d:h,s=c>g?g:c,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},multiply:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=u*f*.003921568627451,o=h*d*.003921568627451,s=c*g*.003921568627451,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},average:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=.5*(u+f),o=.5*(h+d),s=.5*(c+g),u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},add:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=u+f,o=h+d,s=c+g,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},subtract:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=255>u+f?0:u+f-255,o=255>h+d?0:h+d-255,s=255>c+g?0:c+g-255,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},difference:function(e,t,n,r,a){var i,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];i=o(d-h),s=o(g-c),l=o(p-f),h+=u*(i-h),c+=u*(s-c),f+=u*(l-f),a&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},negation:function(e,t,n,r,a){var i,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];i=255-o(255-d-h),s=255-o(255-g-c),l=255-o(255-p-f),h+=u*(i-h),c+=u*(s-c),f+=u*(l-f),a&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},screen:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=255-((255-f)*(255-u)>>8),o=255-((255-d)*(255-h)>>8),s=255-((255-g)*(255-c)>>8),u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},exclusion:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=f+u-2*f*u*.003921568627451,o=d+h-2*d*h*.003921568627451,s=g+c-2*g*c*.003921568627451,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},overlay:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=128>u?2*f*u*.003921568627451:255-2*(255-f)*(255-u)*.003921568627451,o=128>h?2*d*h*.003921568627451:255-2*(255-d)*(255-h)*.003921568627451,i=128>c?2*g*c*.003921568627451:255-2*(255-g)*(255-c)*.003921568627451,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},softlight:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=128>u?2*((f>>1)+64)*(.003921568627451*u):255-2*(255-((f>>1)+64))*(255-u)*.003921568627451,o=128>h?2*((d>>1)+64)*(.003921568627451*h):255-2*(255-((d>>1)+64))*(255-h)*.003921568627451,s=128>c?2*((g>>1)+64)*(.003921568627451*c):255-2*(255-((g>>1)+64))*(255-c)*.003921568627451,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},hardlight:function(e,t,n,r,a){var i,o,s,l=.003921568627451*t[r+3],u=e[n],h=e[n+1],c=e[n+2],f=t[r],d=t[r+1],g=t[r+2];i=128>f?2*u*f*.003921568627451:255-2*(255-u)*(255-f)*.003921568627451,o=128>d?2*h*d*.003921568627451:255-2*(255-h)*(255-d)*.003921568627451,s=128>g?2*c*g*.003921568627451:255-2*(255-c)*(255-g)*.003921568627451,u+=l*(i-u),h+=l*(o-h),c+=l*(s-c),a&&(u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c),e[n]=~~u,e[n+1]=~~h,e[n+2]=~~c},colordodge:function(e,t,n,r,i){var o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];o=255===h?h:a(255,(d<<8)/(255-h)),s=255===c?c:a(255,(g<<8)/(255-c)),l=255===f?f:a(255,(p<<8)/(255-f)),h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},colorburn:function(e,t,n,r,a){var o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];o=0===h?h:i(0,255-(255-d<<8)/h),s=0===c?c:i(0,255-(255-g<<8)/c),l=0===f?f:i(0,255-(255-p<<8)/f),h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),a&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},linearlight:function(e,t,n,r,a){var i,o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];128>h?(l=2*h,i=255>l+d?0:l+d-255):(l=2*(h-128),i=l+d),128>c?(l=2*c,o=255>l+g?0:l+g-255):(l=2*(c-128),o=l+g),128>f?(l=2*f,s=255>l+p?0:l+p-255):(l=2*(f-128),s=l+p),h+=u*(i-h),c+=u*(o-c),f+=u*(s-f),a&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},reflect:function(e,t,n,r,i){var o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];o=255===h?h:a(255,d*d/(255-h)),s=255===c?c:a(255,g*g/(255-c)),l=255===f?f:a(255,p*p/(255-f)),h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},glow:function(e,t,n,r,i){var o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];o=255===d?d:a(255,h*h/(255-d)),s=255===g?g:a(255,c*c/(255-g)),l=255===p?p:a(255,f*f/(255-p)),h+=u*(o-h),c+=u*(s-c),f+=u*(l-f),i&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},phoenix:function(e,t,n,r,o){var s,l,u,h=.003921568627451*t[r+3],c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];s=a(g,c)-i(g,c)+255,l=a(p,f)-i(p,f)+255,u=a(m,d)-i(m,d)+255,c+=h*(s-c),f+=h*(l-f),d+=h*(u-d),o&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},vividlight:function(e,t,n,r,o){var s,l,u,h,c=.003921568627451*t[r+3],f=e[n],d=e[n+1],g=e[n+2],p=t[r],m=t[r+1],v=t[r+2];128>f?(h=2*f,s=0===h?h:i(0,255-(255-p<<8)/h)):(h=2*(f-128),s=255===h?h:a(255,(p<<8)/(255-h))),128>d?(h=2*d,l=0===h?h:i(0,255-(255-m<<8)/h)):(h=2*(d-128),l=255===h?h:a(255,(m<<8)/(255-h))),128>g?(h=2*g,u=0===h?h:i(0,255-(255-v<<8)/h)):(h=2*(d-128),u=255===h?h:a(255,(v<<8)/(255-h))),f+=c*(s-f),d+=c*(l-d),g+=c*(u-g),o&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g),e[n]=~~f,e[n+1]=~~d,e[n+2]=~~g},pinlight:function(e,t,n,r,a){var i,o,s,l,u=.003921568627451*t[r+3],h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];128>h?(l=2*h,i=l>d?l:d):(l=2*(h-128),i=l>d?d:l),128>c?(l=2*c,o=l>g?l:g):(l=2*(h-128),o=l>g?g:l),128>f?(l=2*f,s=l>p?l:p):(l=2*(f-128),s=l>p?p:l),h+=u*(i-h),c+=u*(o-c),f+=u*(s-f),a&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},hardmix:function(e,t,n,r,o){var s,l,u,h,c=.003921568627451*t[r+3],f=e[n],d=e[n+1],g=e[n+2],p=t[r],m=t[r+1],v=t[r+2];128>f?(h=2*f,s=0===h?h:i(0,255-(255-p<<8)/h)):(h=2*(f-128),s=255===h?h:a(255,(p<<8)/(255-h))),s=128>s?0:255,128>d?(h=2*d,l=0===h?h:i(0,255-(255-m<<8)/h)):(h=2*(d-128),l=255===h?h:a(255,(m<<8)/(255-h))),l=128>l?0:255,128>g?(h=2*g,u=0===h?h:i(0,255-(255-v<<8)/h)):(h=2*(g-128),u=255===h?h:a(255,(v<<8)/(255-h))),u=128>u?0:255,f+=c*(s-f),d+=c*(l-d),g+=c*(u-g),o&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g),e[n]=~~f,e[n+1]=~~d,e[n+2]=~~g}},p.Blend.lineardodge=p.Blend.add,p.Blend.linearburn=p.Blend.subtract}(r),!function(e,t){function n(e,t,n,r,a){return t===r&&n===a?e:h(e,t,n,r,a)}var r,a,i=e.ImArray,o=e.Util.Image,s=e.Color,l=Math.min,u=Math.max,h=e.Interpolation.bilinear,c=o.get_data,f=o.set_data,d=o.fill;a=e.Class({constructor:function(e){var t=this;t._cnv=e,t._transform={scale:[1,1],translate:[0,0],rotate:[0,0]},t._data=null},_cnv:null,_w:0,_h:0,_transform:null,_data:null,fillStyle:null,dispose:function(){var e=this;return e._cnv=null,e._data=null,e._transform=null,e},fillRect:function(e,t,n,r){var a,i=this,o=i._w,l=i._h,u=i.fillStyle;null==e&&(e=0),null==t&&(t=0),null==n&&(n=o),null==r&&(r=l),u===+u?a=s.Color2RGBA(u):u&&u.substr?(a=s.fromString(u).toRGB(!1),a[3]=~~(255*a[3])):a=u&&2<u.length?u:[0,0,0,0],d(i._data,o,l,a,e,t,e+n-1,t+r-1)},clearRect:function(e,t,n,r){var a=this,i=a._w,o=a._h;null==e&&(e=0),null==t&&(t=0),null==n&&(n=i),null==r&&(r=o),d(a._data,i,o,[0,0,0,0],e,t,e+n-1,t+r-1)},drawImage:function(e,t,r,a,i,o,s,l,u){var h=this,d=h._w,g=h._h,p=e._ctx._w,m=e._ctx._h,v=e._ctx._data,_=arguments.length;3===_?(o=t,s=r,f(h._data,d,g,v,p,m,0,0,p-1,m-1,o,s)):5===_?(o=t,s=r,l=a,u=i,f(h._data,d,g,n(v,p,m,l,u),l,u,0,0,l-1,u-1,o,s)):f(h._data,d,g,n(c(v,p,m,t,r,t+a-1,r+i-1,!0),a,i,l,u),l,u,0,0,l-1,u-1,o,s)},createImageData:function(e,t){var n=this;return n._data=new i(e*t<<2),n._w=e,n._h=t,d(n._data,e,t,[0,0,0,0],0,0,e-1,t-1),n},putImageData:function(e,t,n){var r=this,a=r._w,i=r._h,o=e.width,s=e.height;null==t&&(t=0),null==n&&(n=0),f(r._data,a,i,e.data,o,s,0,0,o-1,s-1,t,n)},getImageData:function(e,t,n,r){var a,i,o,s,h=this,f=h._w,d=h._h;return null==e&&(e=0),null==t&&(t=0),null==n&&(n=f),null==r&&(r=d),a=u(0,l(e,n-1,f-1)),i=u(0,l(t,r-1,d-1)),o=l(a+n-1,n-1,f-1),s=l(i+r-1,r-1,d-1),{data:c(h._data,f,d,a,i,o,s),width:o-a+1,height:s-i+1}},scale:function(e,t){var n=this;return n._transform.scale[0]=e,n._transform.scale[1]=t,n},translate:function(e,t){var n=this;return n._transform.translate[0]=e,n._transform.translate[1]=t,n}}),r=e.CanvasProxy=e.Class({constructor:function(e,t){var n=this;n.width=e||0,n.height=t||0,n.style={},n._ctx=new a(n)},_ctx:null,width:null,height:null,style:null,dispose:function(){var e=this;return e.width=null,e.height=null,e.style=null,e._ctx.dispose(),e._ctx=null,e},getContext:function(e){return this._ctx},toDataURL:function(e){return""}}),e.Canvas=function(t,n){var a=e.Browser.isNode?new r:document.createElement("canvas");return t=t||0,n=n||0,a.style.width=t+"px",a.style.height=n+"px",a.width=t*e.devicePixelRatio,a.height=n*e.devicePixelRatio,a}}(r),!function(e,t){function n(e){var t=e.width,n=e.height,r=c(t,n);return r.width=t*s,r.height=n*s,r}function r(e,t,n,r){return r=r||S,r&A&&(e.width=t,e.oCanvas.style.width=t+"px",e.oCanvas.width=t*s,e._restorable&&(e.iCanvas.style.width=e.oCanvas.style.width,e.iCanvas.width=e.oCanvas.width),e.tmpCanvas&&(e.tmpCanvas.style.width=e.oCanvas.style.width,e.tmpCanvas.width=e.oCanvas.width)),r&x&&(e.height=n,e.oCanvas.style.height=n+"px",e.oCanvas.height=n*s,e._restorable&&(e.iCanvas.style.height=e.oCanvas.style.height,e.iCanvas.height=e.oCanvas.height),e.tmpCanvas&&(e.tmpCanvas.style.height=e.oCanvas.style.height,e.tmpCanvas.height=e.oCanvas.height)),e}function a(e,t){var n=e.width,r=e.height;return t=t||255,e._restorable&&t&_&&e._needsRefresh&_&&(e.iData=e.ictx.getImageData(0,0,n,r),e._needsRefresh&=~_),t&y&&e._needsRefresh&y&&(e.oData=e.octx.getImageData(0,0,n,r),e._needsRefresh&=~y),e}function i(e,t){if(e.selection){var n=e.selection,r=e.width-1,a=e.height-1,i=v(n[0]*r),o=v(n[1]*a),s=v(n[2]*r)-i+1,l=v(n[3]*a)-o+1;t=t||255,e._restorable&&t&w&&e._needsRefresh&w&&(e.iDataSel=e.ictx.getImageData(i,o,s,l),e._needsRefresh&=~w),t&R&&e._needsRefresh&R&&(e.oDataSel=e.octx.getImageData(i,o,s,l),e._needsRefresh&=~R)}return e}var o="prototype",s=e.devicePixelRatio,l=e.ImArray,u=e.ImArrayCopy,h=(e.Array32F,e.Util.Image),c=e.Canvas,f=e.CanvasProxy,d=e.FORMAT,g=e.MIME,p=0,m=(e._notSupportTypedArrays,e.Util.Array.arrayset),v=(e.Util.Array.subarray,Math.min,Math.floor),_=1,y=2,w=4,R=8,C=16,I=32,b=64,A=2,x=4,S=A|x,D=w|R,M=_|y,E=~D,k=~C,O=~I,P=e.Image=e.Class({name:"Image",constructor:function F(e){var t=this,n=0,r=0;return t instanceof F?(t.id=++p,t.width=n,t.height=r,t.iData=null,t.iDataSel=null,t.oData=null,t.oDataSel=null,t.iCanvas=c(n,r),t.oCanvas=c(n,r),t.tmpCanvas=null,t.domElement=t.oCanvas,t.ictx=t.iCanvas.getContext("2d"),t.octx=t.oCanvas.getContext("2d"),t.webgl=null,t._histogram=[null,null,null,null],t._integral=[null,null,null,null],t._spectrum=[null,null,null,null],t._histogramRefresh=[0,0,0,0],t._integralRefresh=[0,0,0,0],t._spectrumRefresh=[0,0,0,0],t.selection=null,t._needsRefresh=0,t._restorable=!0,t._grayscale=!1,void(e&&t.image(e))):new F(e)},id:null,width:0,height:0,selection:null,iCanvas:null,oCanvas:null,tmpCanvas:null,ictx:null,octx:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,webgl:null,_histogram:null,_integral:null,_spectrum:null,_needsRefresh:0,_restorable:!0,_grayscale:!1,dispose:function(){var e=this;return e.id=null,e.width=null,e.height=null,e.selection=null,e.ictx=null,e.octx=null,e.iData=null,e.iDataSel=null,e.oData=null,e.oDataSel=null,e.iCanvas=null,e.oCanvas=null,e.tmpCanvas=null,e.domElement=null,e.webgl=null,e._histogram=null,e._integral=null,e._spectrum=null,e._histogramRefresh=null,e._integralRefresh=null,e._spectrumRefresh=null,e._needsRefresh=null,e._restorable=null,e._grayscale=null,e},clone:function(e){return new P(!0===e?this.iCanvas:this.oCanvas)},grayscale:function(e){var t=this;return arguments.length?(t._grayscale=!!e,t):t._grayscale},restorable:function(e){var t=this;return arguments.length||(e=!0),t._restorable=!!e,t},apply:function(e,t){return e.apply(this,this,t||null),this},apply2:function(e,t,n){return e.apply(this,t,n||null),this},select:function(e,t,n,r){var a=this,i=arguments.length;return 1>i&&(e=0),2>i&&(t=0),3>i&&(n=1),4>i&&(r=1),a.selection=[0>e?0:e>1?1:e,0>t?0:t>1?1:t,0>n?0:n>1?1:n,0>r?0:r>1?1:r],a._needsRefresh|=D,a},deselect:function(){var e=this;return e.selection=null,e.iDataSel=null,e.oDataSel=null,e._needsRefresh&=E,e},store:function(){var e=this;return e._restorable&&(e.ictx.drawImage(e.oCanvas,0,0),e._needsRefresh|=_,e.selection&&(e._needsRefresh|=w)),e},restore:function(){var e=this;return e._restorable&&(e.octx.drawImage(e.iCanvas,0,0),e._needsRefresh|=y|C|I|b,e._histogramRefresh=[1,1,1,1],e._integralRefresh=[1,1,1,1],e._spectrumRefresh=[1,1,1,1],e.selection&&(e._needsRefresh|=R)),e},dimensions:function(e,t){var n=this;return r(n,e,t,S),n._needsRefresh|=M|C|I|b,n._histogramRefresh=[1,1,1,1],n._integralRefresh=[1,1,1,1],n._spectrumRefresh=[1,1,1,1],n.selection&&(n._needsRefresh|=D),n},scale:function(e,t){var r=this;if(e=e||1,t=t||e,1==e&&1==t)return r;r.tmpCanvas=r.tmpCanvas||n(r);var a=r.tmpCanvas.getContext("2d"),i=r.width,o=r.height;return a.scale(e,t),i=r.width=~~(e*i+.5),o=r.height=~~(t*o+.5),a.drawImage(r.oCanvas,0,0),r.oCanvas.style.width=i+"px",r.oCanvas.style.height=o+"px",r.oCanvas.width=i*s,r.oCanvas.height=o*s,r.octx.drawImage(r.tmpCanvas,0,0),r._restorable&&(a.drawImage(r.iCanvas,0,0),r.iCanvas.style.width=r.oCanvas.style.width,r.iCanvas.style.height=r.oCanvas.style.height,r.iCanvas.width=r.oCanvas.width,r.iCanvas.height=r.oCanvas.height,r.ictx.drawImage(r.tmpCanvas,0,0)),r.tmpCanvas.width=r.oCanvas.width,r.tmpCanvas.height=r.oCanvas.height,r._needsRefresh|=M|C|I|b,r._histogramRefresh=[1,1,1,1],r._integralRefresh=[1,1,1,1],r._spectrumRefresh=[1,1,1,1],r.selection&&(r._needsRefresh|=D),r},flipHorizontal:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(e.width,0),t.scale(-1,1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=M|I|b,e._integralRefresh=[1,1,1,1],e._spectrumRefresh=[1,1,1,1],e.selection&&(e._needsRefresh|=D),e},flipVertical:function(){var e=this;e.tmpCanvas=e.tmpCanvas||n(e);var t=e.tmpCanvas.getContext("2d");return t.translate(0,e.height),t.scale(1,-1),t.drawImage(e.oCanvas,0,0),e.octx.drawImage(e.tmpCanvas,0,0),e._restorable&&(t.drawImage(e.iCanvas,0,0),e.ictx.drawImage(e.tmpCanvas,0,0)),e._needsRefresh|=M|I|b,e._integralRefresh=[1,1,1,1],e._spectrumRefresh=[1,1,1,1],e.selection&&(e._needsRefresh|=D),e},draw:function(e,t,n,r){return this},clear:function(){var e=this,t=e.width,n=e.height;return t&&n&&(e._restorable&&e.ictx.clearRect(0,0,t,n),e.octx.clearRect(0,0,t,n),e._needsRefresh|=M|C|I|b,e._histogramRefresh=[1,1,1,1],e._integralRefresh=[1,1,1,1],e._spectrumRefresh=[1,1,1,1],e.selection&&(e._needsRefresh|=D)),e},crop:function(e,t,r,a){var i,o,l,u,h,c,f,d,g=this,p=g.selection,m=g.width,_=g.height;if(arguments.length)h=e,c=t,f=r-e+1,d=a-t+1;else{if(!p)return g;i=v(p[0]*(m-1)),o=v(p[1]*(_-1)),l=v(p[2]*(m-1))-i+1,u=v(p[3]*(_-1))-o+1,h=i,c=o,f=l,d=u,p[0]=0,p[1]=0,p[2]=1,p[3]=1}g.tmpCanvas=g.tmpCanvas||n(g);var y=g.tmpCanvas.getContext("2d");return y.drawImage(g.oCanvas,0,0,m,_,h,c,f,d),g.oCanvas.style.width=f+"px",g.oCanvas.style.height=d+"px",g.oCanvas.width=f*s,g.oCanvas.height=d*s,g.octx.drawImage(g.tmpCanvas,0,0),g._restorable&&(y.drawImage(g.iCanvas,0,0,m,_,h,c,f,d),g.iCanvas.style.width=g.oCanvas.style.width,g.iCanvas.style.height=g.oCanvas.style.height,g.iCanvas.width=g.oCanvas.width,g.iCanvas.height=g.oCanvas.height,g.ictx.drawImage(g.tmpCanvas,0,0)),g.tmpCanvas.width=g.oCanvas.width,g.tmpCanvas.height=g.oCanvas.height,g._needsRefresh|=M|C|I|b,g._histogramRefresh=[1,1,1,1],g._integralRefresh=[1,1,1,1],g._spectrumRefresh=[1,1,1,1],p&&(g._needsRefresh|=D),g},fill:function(e,n,r,a,i){var o,s,l,u,h=this,c=h.selection,f=h.width,d=h.height;c?(o=v(c[0]*(f-1)),s=v(c[1]*(d-1)),l=v(c[2]*(f-1))-o+1,u=v(c[3]*(d-1))-s+1):(o=0,s=0,l=f,u=d),t===n&&(n=o),t===r&&(r=s),t===a&&(a=l),t===i&&(i=u),a&&!f&&i&&!d&&h.createImageData(a,i);var g=h.ictx,p=h.octx;return e=e||0,h._restorable&&(g.fillStyle=e,g.fillRect(n,r,a,i)),p.fillStyle=e,p.fillRect(n,r,a,i),h._needsRefresh|=M|C|I|b,h._histogramRefresh=[1,1,1,1],h._integralRefresh=[1,1,1,1],h._spectrumRefresh=[1,1,1,1],c&&(h._needsRefresh|=D),h},getData:function(){var e,t=this;return t._restorable?(t._needsRefresh&_&&a(t,_),e=t.iData):(t._needsRefresh&y&&a(t,y),e=t.oData),new u(e.data)},getSelectedData:function(){var e,t=this;return t.selection?t._restorable?(t._needsRefresh&w&&i(t,w),e=t.iDataSel):(t._needsRefresh&R&&i(t,R),e=t.oDataSel):t._restorable?(t._needsRefresh&_&&a(t,_),e=t.iData):(t._needsRefresh&y&&a(t,y),e=t.oData),[new u(e.data),e.width,e.height]},getProcessedData:function(){var e=this;return e._needsRefresh&y&&a(e,y),new u(e.oData.data)},getProcessedSelectedData:function(){var e,t=this;return t.selection?(t._needsRefresh&R&&i(t,R),e=t.oDataSel):(t._needsRefresh&y&&a(t,y),e=t.oData),[new u(e.data),e.width,e.height]},setData:function(e){var t=this;return t._needsRefresh&y&&a(t,y),m(t.oData.data,e),t.octx.putImageData(t.oData,0,0),t._needsRefresh|=C|I|b,t._histogramRefresh=[1,1,1,1],t._integralRefresh=[1,1,1,1],t._spectrumRefresh=[1,1,1,1],t.selection&&(t._needsRefresh|=R),t},setSelectedData:function(e){var t=this;if(t.selection){var n=t.selection,r=t.width-1,o=t.height-1,s=v(n[0]*r),l=v(n[1]*o);t._needsRefresh&R&&i(t,R),m(t.oDataSel.data,e),t.octx.putImageData(t.oDataSel,s,l),t._needsRefresh|=y}else t._needsRefresh&y&&a(t,y),m(t.oData.data,e),t.octx.putImageData(t.oData,0,0);return t._needsRefresh|=C|I|b,t._histogramRefresh=[1,1,1,1],t._integralRefresh=[1,1,1,1],t._spectrumRefresh=[1,1,1,1],t},createImageData:function(e,t){var n,a,i=this;return r(i,e,t,S),i._restorable&&(n=i.ictx=i.iCanvas.getContext("2d"),n.createImageData(e,t)),a=i.octx=i.oCanvas.getContext("2d"),a.createImageData(e,t),i._needsRefresh|=M,i.selection&&(i._needsRefresh|=D),i},image:function(e){if(!e)return this;var t,n,i,o,s,l,u,h=this;return e instanceof P&&(e=e.oCanvas),s="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement,l="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||e instanceof f,u="undefined"!=typeof Image&&e instanceof Image,s?(i=e.videoWidth,o=e.videoHeight):(i=e.width,o=e.height),u||l||s?(r(h,i,o,S),h._restorable&&(t=h.ictx=h.iCanvas.getContext("2d"),t.drawImage(e,0,0)),n=h.octx=h.oCanvas.getContext("2d"),n.drawImage(e,0,0),h._needsRefresh|=M):(h.oData||(h.createImageData(i,o),a(h,M)),h._restorable&&(t=h.ictx=h.iCanvas.getContext("2d"),m(h.iData.data,e.data),t.putImageData(h.iData,0,0)),n=h.octx=h.oCanvas.getContext("2d"),m(h.oData.data,e.data),n.putImageData(h.oData,0,0)),h._needsRefresh|=C|I|b,h._histogramRefresh=[1,1,1,1],h._integralRefresh=[1,1,1,1],h._spectrumRefresh=[1,1,1,1],h.selection&&(h._needsRefresh|=D),h},getPixel:function(e,t){var n=this;n._needsRefresh&y&&a(n,y);var r=~~(t*n.width+e+.5)<<2,i=n.oData.data;return{r:i[r],g:i[r+1],b:i[r+2],a:i[r+3]}},setPixel:function(e,t,n,r,a,i){var o=this;return o.octx.putImageData(new l([255&n,255&r,255&a,255&i]),e,t),o._needsRefresh|=y|C|I|b,o._histogramRefresh=[1,1,1,1],o._integralRefresh=[1,1,1,1],o._spectrumRefresh=[1,1,1,1],o.selection&&(o._needsRefresh|=R),o},getPixelData:function(){return this._needsRefresh&y&&a(this,y),this.oData},setPixelData:function(e){var t=this;return t.octx.putImageData(e,0,0),t._needsRefresh|=y|C|I|b,t._histogramRefresh=[1,1,1,1],t._integralRefresh=[1,1,1,1],t._spectrumRefresh=[1,1,1,1],t.selection&&(t._needsRefresh|=R),t},integral:function(e){var t=this,n=h.integral,r=t._grayscale;if(null==e){if(t._needsRefresh&I){var a=t.getPixelData().data,i=t.width,o=t.height,s=n(a,i,o,0);t._integral=[s,r?s:n(a,i,o,1),r?s:n(a,i,o,2),n(a,i,o,3)],t._integralRefresh=[0,0,0,0],t._needsRefresh&=O}}else e=e||0,(t._needsRefresh&I||t._integralRefresh[e])&&(r&&!t._integralRefresh[0]?t._integral[e]=t._integral[0]:t._integral[e]=n(t.getPixelData().data,t.width,t.height,e),t._integralRefresh[e]=0,t._needsRefresh&=O);return null==e?t._integral:t._integral[e||0]},histogram:function(e){var t=this,n=h.histogram,r=t._grayscale;if(null==e){if(t._needsRefresh&C){var a=t.getPixelData().data,i=t.width,o=t.height,s=n(a,i,o,0);t._histogram=[s,r?s:n(a,i,o,1),r?s:n(a,i,o,2),null],t._histogramRefresh=[0,0,0,0],t._needsRefresh&=k}}else e=e||0,(t._needsRefresh&C||t._histogramRefresh[e])&&(r&&!t._histogramRefresh[0]?t._histogram[e]=t._histogram[0]:t._histogram[e]=n(t.getPixelData().data,t.width,t.height,e),t._histogramRefresh[e]=0,t._needsRefresh&=k);return null==e?t._histogram:t._histogram[e||0]},spectrum:function(e){var t=this;h.spectrum;return null==e?t._spectrum:t._spectrum[e||0]},toImage:function(e){var t,n=this.oCanvas,r=1;if(t=d.JPG===(16&e)?n.toDataURL(g.JPG,r):d.GIF===(16&e)?n.toDataURL(g.GIF,r):n.toDataURL(g.PNG,r),e&d.IMAGE){var a=new Image;return a.src=t,a}return t},toString:function(){return"[FILTER Image: "+this.name+"]"}});P[o].setImage=P[o].image,P[o].setDimensions=P[o].dimensions,P.Gradient=function(e,t,n,r,a,i){var o=(new P).restorable(!1).createImageData(e,t),s=h.colors_stops(n,r);return o.setData(h.gradient(o.getData(),e,t,s[0],s[1],a,i||h.lerp)),o},P.RadialGradient=function(e,t,n,r,a,i,o,s,l){var u=(new P).restorable(!1).createImageData(e,t),c=h.colors_stops(n,r);return u.setData(h.radial_gradient(u.getData(),e,t,c[0],c[1],a,i,o,s,l||h.lerp)),u},P.PerlinNoise=function(e,t,n,r,a,i,o,s,l,u,c,f){var d=(new P).restorable(!1).createImageData(e,t);return h.perlin&&(n&&h.perlin.seed(n),d.setData(h.perlin(d.getData(),e,t,r,a,i,o,s,l,u,c,f))),d},h.scale=h.resize=e.Interpolation.bilinear;var L=e.ScaledImage=e.Class(P,{name:"ScaledImage",constructor:function T(e,t,n){var r=this;return r instanceof T?(r.scaleX=e||1,r.scaleY=t||r.scaleX,void r.$super("constructor",n)):new T(e,t,n)},scaleX:1,scaleY:1,dispose:function(){var e=this;return e.scaleX=null,e.scaleY=null,e.$super("dispose"),e},clone:function(e){var t=this;return new L(t.scaleX,t.scaleY,!0===e?t.iCanvas:t.oCanvas)},setScale:function(e,t){var n=this,r=arguments.length;return r>0&&null!=e&&(n.scaleX=e,n.scaleY=e),r>1&&null!=t&&(n.scaleY=t),n},image:function(e){if(!e)return this;var t,n,a,i,o,s,l,u,h,c=this,d=c.scaleX,g=c.scaleY;return e instanceof P&&(e=e.oCanvas),l="undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement,u="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||e instanceof f,h="undefined"!=typeof Image&&e instanceof Image,l?(a=e.videoWidth,i=e.videoHeight):(a=e.width,i=e.height),(h||u||l)&&(o=~~(d*a+.5),s=~~(g*i+.5),r(c,o,s,S),c._restorable&&(t=c.ictx=c.iCanvas.getContext("2d"),t.drawImage(e,0,0,a,i,0,0,o,s)),n=c.octx=c.oCanvas.getContext("2d"),n.drawImage(e,0,0,a,i,0,0,o,s),c._needsRefresh|=M|C|I|b,c._histogramRefresh=[1,1,1,1],c._integralRefresh=[1,1,1,1],c._spectrumRefresh=[1,1,1,1],c.selection&&(c._needsRefresh|=D)),c}});L[o].setImage=L[o].image}(r),!function(e,t){e.IO.Loader=e.IO.Reader=e.Class({name:"IO.Loader",__static__:{load:e.Method(function(e,t,n){return function(e,t,r){return(new n).load(e,t,r)}},e.LATE|e.STATIC)},constructor:function(){},_crossOrigin:null,_responseType:null,dispose:function(){var e=this;return e._crossOrigin=null,e._responseType=null,e},load:function(e,t,n){return null},responseType:function(e){var t=this;return arguments.length?(t._responseType=e,t):t._responseType},crossOrigin:function(e){var t=this;return arguments.length?(t._crossOrigin=e,t):t._crossOrigin}}),e.IO.Loader.prototype.read=e.IO.Loader.prototype.load,e.IO.Writer=e.Class({name:"IO.Writer",__static__:{write:e.Method(function(e,t,n){return function(e,t,r,a){return(new n).write(e,t,r,a)}},e.LATE|e.STATIC)},constructor:function(){},_encoding:null,dispose:function(){var e=this;return e._encoding=null,e},write:function(e,t,n,r){return null},encoding:function(e){var t=this;return arguments.length?(t._encoding=e,t):t._encoding}})}(r),!function(e,t){function n(e){var t,n;for(e>0&&1>e&&(e*=65536),e=c(e),256>e&&(e|=e<<8),n=0;256>n;n++)t=1&n?d[n]^255&e:d[n]^e>>8&255,g[n]=g[n+256]=t}function r(e,t,n){var r=7&e,a=4>r?t:n,i=4>r?n:t;return(1&r?-a:a)+(2&r?-2*i:2*i)}function a(e,t){var n,a,i,o,s,l=.366025403,u=.211324865,h=(e+t)*l,f=e+h,d=t+h,p=c(f),m=c(d),v=(p+m)*u,_=p-v,y=m-v,w=e-_,R=t-y;w>R?(o=1,s=0):(o=0,s=1);var C=w-o+u,I=R-s+u,b=w-1+2*u,A=R-1+2*u,x=255&p,S=255&m,D=.5-w*w-R*R;0>D?n=0:(D*=D,n=D*D*r(g[x+g[S]],w,R));var M=.5-C*C-I*I;0>M?a=0:(M*=M,a=M*M*r(g[x+o+g[S+s]],C,I));var E=.5-b*b-A*A;return 0>E?i=0:(E*=E,i=E*E*r(g[x+1+g[S+1]],b,A)),40*(n+a+i)}function i(e){return e*e*e*(e*(6*e-15)+10)}function o(e,t,n){return t+e*(n-t)}function s(e,t){var n,a,s,l,u,h,f,d,p,m,v,_,y,w;return n=c(e),a=c(t),u=e-n,h=t-a,f=u-1,d=h-1,s=n+1&255,l=a+1&255,n=255&n,a=255&a,m=i(h),p=i(u),v=r(g[n+g[a]],u,h),_=r(g[n+g[l]],u,d),y=o(m,v,_),v=r(g[s+g[a]],f,h),_=r(g[s+g[l]],f,d),w=o(m,v,_),.507*o(p,y,w)}function l(e,t,n,r,a,i,o,s,l,u,h,c,f){var d,g,p,m,v=0,_=c,y=1,w=0;for(d=0;u>d;d++)g=(r+h[d][0])%i,p=(a+h[d][1])%o,v+=n(_*g*s,_*p*l)*y,_*=2,w+=y,y*=f;m=~~(255*(.5*v/w+.5)),e[t]=m,e[t+1]=m,e[t+2]=m,e[t+3]=255}function u(e,t,n,r,a,i,o,s,l,u,h,c,f){var d,g,p,m,v=0,_=c,y=1,w=0;for(d=0;u>d;d++)g=(r+h[d][0])%i,p=(a+h[d][1])%o,v+=n(_*g*s,_*p*l)*y,_*=2,w+=y,y*=f;m=~~(16777215*(.5*v/w+.5)),e[t]=m>>>16&255,e[t+1]=m>>>8&255,e[t+2]=255&m,e[t+3]=255}var h=e.Util.Image,c=(e.Image,Math.floor),f=(Math.sin,Math.cos,e.CONST.PI2,e.Array8U),d=new f([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),g=new f(d);h.perlin=function(e,t,n,r,i,o,h,c,f,d,g,p){var m,v,_,y,w,R,C=1/o,I=1/h,b=p?s:a,A=i?l:u,x=e.length,S=t>>>1,D=n>>>1;if(d=d||1,g=g||.5,c=c||1,f=f||[[0,0]],r)for(m=0,v=0,w=0;x>w;w+=4,m++)m>=t&&(m=0,v++),_=m>S?t-1-m:m,y=v>D?n-1-v:v,m>_||v>y?(R=y*t+_<<2,e[w]=e[R],e[w+1]=e[R+1],e[w+2]=e[R+2],e[w+3]=255):A(e,w,b,_,y,t,n,C,I,c,f,d,g);else for(m=0,v=0,w=0;x>w;w+=4,m++)m>=t&&(m=0,v++),A(e,w,b,m,v,t,n,C,I,c,f,d,g);return e},h.perlin.seed=n}(r),r});
/**
*
*   FILTER.js I/O Classes
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (I/O Loaders)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_IO")?define("FILTER_IO",["module","FILTER"],function(t,r){return n.moduleUri=t.uri,n.call(e,r),r}):(n.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(n){"use strict";n.getPath(e.moduleUri);return!function(e,n){function t(e,n,t){var r="";if(!e)return xhr?xhr:r;var o,i,l,c,f,d=u(e);if(t){for(i=0,l=d.length;l>i;i++)o=d[i],t.setHeader(o,e[o]);return t}if(n){for(i=0,l=d.length;l>i;i++)if(o=d[i],"[object Array]"===s.call(e[o]))for(c=0,f=e[o].length;f>c;c++)n.setRequestHeader(o,String(e[o][c]));else n.setRequestHeader(o,String(e[o]));return n}for(i=0,l=d.length;l>i;i++)if(o=d[i],"[object Array]"===s.call(e[o]))for(r.length&&(r+=a),r+=o+": "+String(e[o][0]),c=1,f=e[o].length;f>c;c++)r+=a+String(e[o][c]);else r.length&&(r+=a),r+=o+": "+String(e[o]);return r}function r(e,n){var t,r,s,u,l={},c=null;if(e)for(n=!0===n,e=e.split(a),r=0,s=e.length;s>r;r++)u=e[r],t=u.split(":"),t.length>1?(c=i(t.shift()),n&&(c=c.toLowerCase()),l[o](c)?("string"==typeof l[c]&&(l[c]=[l[c]]),l[c].push(i(t.join(":")))):l[c]=i(t.join(":"))):t[0].length&&c&&(l[c]=a+t[0]);return l}var o="hasOwnProperty",s=Object.prototype.toString,u=Object.keys,a="\r\n",i=e.Util.String.trim;e.Util.Http={Header:{encode:t,decode:r}};var l=e.Util.XHR=function c(e,n){var t=this,r=!1;t.readyState=c.UNSENT,t.status=null,t.statusText=null,t.responseType="text",t.responseURL=null,t.response=null,t.responseText=null,t.responseXml=null,t._rawHeaders=null,t._headers=null,t.send=function(n){return r||c.UNSENT!==t.readyState?t:(e&&e(n),t.readyState=c.OPENED,t)},t.abort=function(){return r?t:(r=!0,n&&n(),t)},t.getAllResponseHeaders=function(e){return c.DONE!==t.readyState?null:!0===e?t._headers:t._rawHeaders},t.getResponseHeader=function(e,n){if(null==e||c.DONE!==t.readyState)return null;var r=t._headers||{};return!1!==n&&(e=e.toLowerCase()),r[o](e)?r[e]:null},t.dispose=function(){return t.readyState=null,t.status=null,t.statusText=null,t.responseType=null,t.responseURL=null,t.response=null,t.responseText=null,t.responseXml=null,t._rawHeaders=null,t._headers=null,t.getAllResponseHeaders=null,t.getResponseHeader=null,t.send=null,t.abort=null,t}};l.UNSENT=0,l.OPENED=1,l.HEADERS_RECEIVED=2,l.LOADING=3,l.DONE=4,l.create=e.Browser.isNode?function(e,n){if(e=e||{},!e.url)return null;var r,o,u="[object Object]"===s.call(e.url)?e.url:require("url").parse(e.url),a={method:e.method||"GET",agent:!1,protocol:u.protocol,host:u.hostname,hostname:u.hostname,port:u.port||80,path:(u.pathname||"/")+(u.query?"?"+u.query:"")};return"file:"===a.protocol?(o=new l(function(n){o.readyState=l.OPENED,require("fs").readFile(a.path,{encoding:"arraybuffer"===o.responseType?null:o.responseType,flag:"r"},function(n,t){o.readyState=l.DONE,o.responseUrl=a.path,e.onLoadStart&&e.onLoadStart(o),e.onLoadEnd&&e.onLoadEnd(o),n?(o.status=500,o.statusText=n.toString(),e.onRequestError?e.onRequestError(o):e.onError&&e.onError(o)):(o.status=200,o.statusText=null,o.response=t,"arraybuffer"!==o.responseType?(o.responseText=t,o.responseXml=null):(o.responseText=null,o.responseXml=null),e.onComplete&&e.onComplete(o))})},function(){}),o.responseType=e.responseType||"text",arguments.length>1&&o.send(n),o):(o=new l(function(e){null!=e&&(e=String(e),r.setHeader("Content-Length",String(e.length)),r.write(e)),r.end()},function(){r.abort()}),r=("https:"===a.protocol?require("https").request:require("http").request)(a,function(n){var t="",r=0;o.readyState=l.OPENED,e.onStateChange&&e.onStateChange(o),o.readyState=l.HEADERS_RECEIVED,o._rawHeaders=n.rawHeaders.join("\r\n"),o._headers=n.headers,o.responseURL=n.url||null,o.status=n.statusCode||null,o.statusText=n.statusMessage||null,e.onStateChange&&e.onStateChange(o),n.on("data",function(n){r||(r=1,o.readyState=l.LOADING,e.onStateChange&&e.onStateChange(o),e.onLoadStart&&e.onLoadStart(o)),t+=n.toString(),e.onProgress&&e.onProgress(o)}),n.on("end",function(){o.readyState=l.DONE,o.responseType="text",o.response=o.responseText=t,e.onStateChange&&e.onStateChange(o),e.onLoadEnd&&e.onLoadEnd(o),l.DONE===o.readyState&&(200===o.status?e.onComplete&&e.onComplete(o):e.onRequestError?e.onRequestError(o):e.onError&&e.onError(o))}),n.on("error",function(n){o.statusText=n.toString(),e.onError&&e.onError(o)})}),r.setTimeout(e.timeout||3e4,function(n){e.onTimeout&&e.onTimeout(o)}),r.on("abort",function(n){e.onAbort&&e.onAbort(o)}),r.on("error",function(n){o.statusText=n.toString(),e.onError&&e.onError(o)}),e.headers&&t(e.headers,null,r),arguments.length>1&&o.send(n),o)}:function(e,n){if(e=e||{},!e.url)return null;var o="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),s=new l(function(e){o.send(e)},function(){o.abort()}),u=function(e,n){return e.readyState=n.readyState,e.status=n.status,e.statusText=n.statusText,e.responseURL=n.responseURL,e.response=n.response,"arraybuffer"!==n.responseType?(e.responseText=n.responseText,e.responseXml=n.responseXml):(e.responseText=null,e.responseXml=null),e};return s.getAllResponseHeaders=function(e){var n=o.getAllResponseHeaders();return!0===e?r(n):n},s.getResponseHeader=function(e){return o.getResponseHeader(e)},o.open(e.method||"GET",e.url,!e.sync),s.responseType=o.responseType=e.responseType||"text",o.timeout=e.timeout||3e4,e.onProgress&&(o.onprogress=function(){e.onProgress(u(s,o))}),e.onLoadStart&&(o.onloadstart=function(){e.onLoadStart(u(s,o))}),e.onLoadEnd&&(o.onloadend=function(){e.onLoadEnd(u(s,o))}),!e.sync&&e.onStateChange&&(o.onreadystatechange=function(){e.onStateChange(u(s,o))}),o.onload=function(){u(s,o),l.DONE===o.readyState&&(200===o.status?e.onComplete&&e.onComplete(s):e.onRequestError?e.onRequestError(s):e.onError&&e.onError(s))},o.onabort=function(){e.onAbort&&e.onAbort(u(s,o))},o.onerror=function(){e.onError&&e.onError(u(s,o))},o.ontimeout=function(){e.onTimeout&&e.onTimeout(u(s,o))},e.headers&&t(e.headers,o),e.mimeType&&o.overrideMimeType(e.mimeType),arguments.length>1&&s.send(n),s}}(n),!function(e,n){e.IO.XHRLoader=e.Class(e.IO.Loader,{name:"IO.XHRLoader",constructor:function t(){var e=this;return e instanceof t?void 0:new t},load:function(n,t,r){var o=this;return e.Util.XHR.create({url:n,responseType:o._responseType,onComplete:function(e){"function"==typeof t&&t(e.response)},onError:function(e){"function"==typeof r&&r(e.statusText)}},null),o}})}(n),!function(e,n){var t=e.IO.Loader,r=e.Util.XHR,o=e.Image,s=e.Class,u=e.IO.FileLoader=e.IO.FileReader=s(t,{name:"IO.FileLoader",constructor:function a(){var e=this;return e instanceof a?void 0:new a},load:function(n,t,o){var s=this;return e.Browser.isNode?require("fs").readFile("file://"===n.slice(0,7)?n.slice(7):n,{encoding:"arraybuffer"===s._responseType?null:s._responseType,flag:"r"},function(e,n){e?"function"==typeof o&&o(e.toString()):"function"==typeof t&&t(n)}):r.create({url:n,responseType:s._responseType,onComplete:function(e){"function"==typeof t&&t(e.response)},onError:function(e){"function"==typeof o&&o(e.statusText)}},null),s}});e.IO.BinaryLoader=e.IO.BinaryReader=s(u,{name:"IO.BinaryLoader",constructor:function i(e){var n=this;return n instanceof i?void(n._decoder="function"==typeof e?e:null):new i(e)},_decoder:null,_encoder:null,dispose:function(){var e=this;return e._decoder=null,e._encoder=null,e.$super("dispose"),e},decoder:function(e){var n=this;return n._decoder="function"==typeof e?e:null,n},encoder:function(e){var n=this;return n._encoder="function"==typeof e?e:null,n},load:function(e,n,t){var r=this,s=new o,u=r._decoder;return"function"==typeof u&&r.responseType("arraybuffer").$super("load",e,function(e){var r={},o=u(e,r);return o?(s.image(o),void("function"==typeof n&&n(s,r))):void("function"==typeof t&&t(s,r,e))},t),s}})}(n),!function(e,n){var t=e.Class,r=e.IO.FileWriter=t(e.IO.Writer,{name:"IO.FileWriter",constructor:function o(){var e=this;return e instanceof o?void 0:new o},write:function(n,t,r,o){var s=this;return e.Browser.isNode&&require("fs").writeFile("file://"===n.slice(0,7)?n.slice(7):n,t,{encoding:"arraybuffer"===s._encoding?null:s._encoding,flag:"w"},function(e){e?"function"==typeof o&&o(e.toString()):"function"==typeof r&&r(n)}),s}});e.IO.BinaryWriter=t(r,{name:"IO.BinaryWriter",constructor:function s(e){var n=this;return n instanceof s?void(n._encoder="function"==typeof e?e:null):new s(e)},_encoder:null,dispose:function(){var e=this;return e._encoder=null,e.$super("dispose"),e},encoder:function(e){var n=this;return n._encoder="function"==typeof e?e:null,n},write:function(e,n,t,r){var o=this,s=o._encoder;return n&&"function"==typeof s&&o.encoding("arraybuffer").$super("write",e,s(n.getPixelData()),t,r),o}})}(n),!function(e,n){var t=e.Image;e.IO.HTMLImageLoader=e.Class(e.IO.Loader,{name:"IO.HTMLImageLoader",constructor:function r(){return this instanceof r?void this.$super("constructor"):new r},load:function(e,n,r){var o,s=this,u=new t;return o=new Image,o.onload=function(e){u.setImage(o),"function"==typeof n&&n(u,o)},o.onerror=function(e){"function"==typeof r&&r(u,o)},o.crossOrigin=s._crossOrigin||"",o.src=e,u}})}(n),n});
/**
*
*   FILTER.js Codecs
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Image Codecs)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,r){"use strict";"object"==typeof module&&module.exports?module.exports=r.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_CODECS")?define("FILTER_CODECS",["module","FILTER"],function(t,a){return r.moduleUri=t.uri,r.call(e,a),a}):(r.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(r){"use strict";r.getPath(e.moduleUri);return!function(e,r){var t=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(e){var r=this.buffer,t=r?r.byteLength:0;if(t>e)return r;for(var a=512;e>a;)a<<=1;for(var n=new Uint8Array(a),o=0;t>o;++o)n[o]=r[o];return this.buffer=n},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var r=this.pos;if(e){this.ensureBuffer(r+e);for(var t=r+e;!this.eof&&this.bufferLength<t;)this.readBlock();var a=this.bufferLength;t>a&&(t=a)}else{for(;!this.eof;)this.readBlock();var t=this.bufferLength}return this.pos=t,this.buffer.subarray(r,t)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,r,t){for(var a=e+r;this.bufferLength<=a&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,r,t)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},e}(),a=function(){function e(e){throw new Error(e)}function r(r){var a=0,n=r[a++],o=r[a++];-1!=n&&-1!=o||e("Invalid header in flate stream"),8!=(15&n)&&e("Unknown compression method in flate stream"),((n<<8)+o)%31!=0&&e("Bad FCHECK in flate stream"),32&o&&e("FDICT bit set in flate stream"),this.bytes=r,this.bytesPos=a,this.codeSize=0,this.codeBuf=0,t.call(this)}var a=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),o=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),i=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],s=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];return r.prototype=Object.create(t.prototype),r.prototype.getBits=function(r){for(var t,a=this.codeSize,n=this.codeBuf,o=this.bytes,i=this.bytesPos;r>a;)"undefined"==typeof(t=o[i++])&&e("Bad encoding in flate stream"),n|=t<<a,a+=8;return t=n&(1<<r)-1,this.codeBuf=n>>r,this.codeSize=a-=r,this.bytesPos=i,t},r.prototype.getCode=function(r){for(var t=r[0],a=r[1],n=this.codeSize,o=this.codeBuf,i=this.bytes,s=this.bytesPos;a>n;){var f;"undefined"==typeof(f=i[s++])&&e("Bad encoding in flate stream"),o|=f<<n,n+=8}var c=t[o&(1<<a)-1],l=c>>16,d=65535&c;return(0==n||l>n||0==l)&&e("Bad encoding in flate stream"),this.codeBuf=o>>l,this.codeSize=n-l,this.bytesPos=s,d},r.prototype.generateHuffmanTable=function(e){for(var r=e.length,t=0,a=0;r>a;++a)e[a]>t&&(t=e[a]);for(var n=1<<t,o=new Uint32Array(n),i=1,s=0,f=2;t>=i;++i,s<<=1,f<<=1)for(var c=0;r>c;++c)if(e[c]==i){for(var l=0,d=s,a=0;i>a;++a)l=l<<1|1&d,d>>=1;for(var a=l;n>a;a+=f)o[a]=i<<16|c;++s}return[o,t]},r.prototype.readBlock=function(){function r(e,r,t,a,n){for(var o=e.getBits(t)+a;o-- >0;)r[A++]=n}var t=this.getBits(3);if(1&t&&(this.eof=!0),t>>=1,0==t){var f,c=this.bytes,l=this.bytesPos;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream");var d=f;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream"),d|=f<<8,"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream");var h=f;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream"),h|=f<<8,h!=(65535&~d)&&e("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var u=this.bufferLength,p=this.ensureBuffer(u+d),v=u+d;this.bufferLength=v;for(var g=u;v>g;++g){if("undefined"==typeof(f=c[l++])){this.eof=!0;break}p[g]=f}return void(this.bytesPos=l)}var m,y;if(1==t)m=i,y=s;else if(2==t){for(var b=this.getBits(5)+257,w=this.getBits(5)+1,U=this.getBits(4)+4,k=Array(a.length),A=0;U>A;)k[a[A++]]=this.getBits(3);for(var I=this.generateHuffmanTable(k),B=0,A=0,C=b+w,L=new Array(C);C>A;){var x=this.getCode(I);16==x?r(this,L,2,3,B):17==x?r(this,L,3,3,B=0):18==x?r(this,L,7,11,B=0):L[A++]=B=x}m=this.generateHuffmanTable(L.slice(0,b)),y=this.generateHuffmanTable(L.slice(b,C))}else e("Unknown block type in flate stream");for(var p=this.buffer,E=p?p.length:0,P=this.bufferLength;;){var S=this.getCode(m);if(256>S)P+1>=E&&(p=this.ensureBuffer(P+1),E=p.length),p[P++]=S;else{if(256==S)return void(this.bufferLength=P);S-=257,S=n[S];var T=S>>16;T>0&&(T=this.getBits(T));var B=(65535&S)+T;S=this.getCode(y),S=o[S],T=S>>16,T>0&&(T=this.getBits(T));var z=(65535&S)+T;P+B>=E&&(p=this.ensureBuffer(P+B),E=p.length);for(var G=0;B>G;++G,++P)p[P]=p[P-z]}}},r}();e.Util.ZLib={DecodeStream:t,FlateStream:a}}(r),!function(e,r){function t(r){return new e.Util.ZLib.FlateStream(r)}function a(){}a.prototype={constructor:a,data:null,pos:null,palette:null,imgData:null,transparency:null,animation:null,text:null,width:0,height:0,bits:null,colorType:null,compressionMethod:null,filterMethod:null,interlaceMethod:null,hasAlphaChannel:null,colors:null,colorSpace:null,pixelBitlength:null,readData:function(e){var r,t,a,n,o,i,s,f,c,l,d,h,u,p,v=this;for(v.data=e,v.pos=8,v.palette=[],v.imgData=[],v.transparency={},v.animation=null,v.text={},o=null;;){switch(r=v.readUInt32(),c=function(){var e,r;for(r=[],i=e=0;4>e;i=++e)r.push(String.fromCharCode(this.data[this.pos++]));return r}.call(v).join("")){case"IHDR":v.width=v.readUInt32(),v.height=v.readUInt32(),v.bits=v.data[v.pos++],v.colorType=v.data[v.pos++],v.compressionMethod=v.data[v.pos++],v.filterMethod=v.data[v.pos++],v.interlaceMethod=v.data[v.pos++];break;case"acTL":v.animation={numFrames:v.readUInt32(),numPlays:v.readUInt32()||1/0,frames:[]};break;case"PLTE":v.palette=v.read(r);break;case"fcTL":o&&v.animation.frames.push(o),v.pos+=4,o={width:v.readUInt32(),height:v.readUInt32(),xOffset:v.readUInt32(),yOffset:v.readUInt32()},n=v.readUInt16(),a=v.readUInt16()||100,o.delay=1e3*n/a,o.disposeOp=v.data[v.pos++],o.blendOp=v.data[v.pos++],o.data=[];break;case"IDAT":case"fdAT":for("fdAT"===c&&(v.pos+=4,r-=4),e=(null!=o?o.data:void 0)||v.imgData,i=h=0;r>=0?r>h:h>r;i=r>=0?++h:--h)e.push(v.data[v.pos++]);break;case"tRNS":switch(v.transparency={},v.colorType){case 3:if(v.transparency.indexed=v.read(r),l=255-v.transparency.indexed.length,l>0)for(i=u=0;l>=0?l>u:u>l;i=l>=0?++u:--u)v.transparency.indexed.push(255);break;case 0:v.transparency.grayscale=v.read(r)[0];break;case 2:v.transparency.rgb=v.read(r)}break;case"tEXt":d=v.read(r),s=d.indexOf(0),f=String.fromCharCode.apply(String,d.slice(0,s)),v.text[f]=String.fromCharCode.apply(String,d.slice(s+1));break;case"IEND":return o&&v.animation.frames.push(o),v.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(v),v.hasAlphaChannel=4===(p=v.colorType)||6===p,t=v.colors+(v.hasAlphaChannel?1:0),v.pixelBitlength=v.bits*t,v.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(v),void(v.imgData=new Uint8Array(v.imgData));default:v.pos+=r}if(v.pos+=4,v.pos>v.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(e){var r,t,a,n=this;for(a=[],r=t=0;e>=0?e>t:t>e;r=e>=0?++t:--t)a.push(n.data[n.pos++]);return a},readUInt32:function(){var e,r,t,a,n=this;return e=n.data[n.pos++]<<24,r=n.data[n.pos++]<<16,t=n.data[n.pos++]<<8,a=n.data[n.pos++],e|r|t|a},readUInt16:function(){var e,r,t=this;return e=t.data[t.pos++]<<8,r=t.data[t.pos++],e|r},decodePixels:function(e){var r,a,n,o,i,s,f,c,l,d,h,u,p,v,g,m,y,b,w,U,k,A,I,B=this;if(null==e&&(e=B.imgData),0===e.length)return new Uint8Array(0);for(e=t(e),e=e.getBytes(),u=B.pixelBitlength/8,m=u*B.width,p=new Uint8Array(m*B.height),s=e.length,g=0,v=0,a=0;s>v;){switch(e[v++]){case 0:for(o=w=0;m>w;o=w+=1)p[a++]=e[v++];break;case 1:for(o=U=0;m>U;o=U+=1)r=e[v++],i=u>o?0:p[a-u],p[a++]=(r+i)%256;break;case 2:for(o=k=0;m>k;o=k+=1)r=e[v++],n=(o-o%u)/u,y=g&&p[(g-1)*m+n*u+o%u],p[a++]=(y+r)%256;break;case 3:for(o=A=0;m>A;o=A+=1)r=e[v++],n=(o-o%u)/u,i=u>o?0:p[a-u],y=g&&p[(g-1)*m+n*u+o%u],p[a++]=(r+Math.floor((i+y)/2))%256;break;case 4:for(o=I=0;m>I;o=I+=1)r=e[v++],n=(o-o%u)/u,i=u>o?0:p[a-u],0===g?y=b=0:(y=p[(g-1)*m+n*u+o%u],b=n&&p[(g-1)*m+(n-1)*u+o%u]),f=i+y-b,c=Math.abs(f-i),d=Math.abs(f-y),h=Math.abs(f-b),l=d>=c&&h>=c?i:h>=d?y:b,p[a++]=(r+l)%256;break;default:throw new Error("Invalid filter algorithm: "+e[v-1])}g++}return p},decodePalette:function(){var e,r,t,a,n,o,i,s,f,c,l=this;for(a=l.palette,i=l.transparency.indexed||[],o=new Uint8Array((i.length||0)+a.length),n=0,t=a.length,e=0,r=s=0,f=a.length;f>s;r=s+=3)o[n++]=a[r],o[n++]=a[r+1],o[n++]=a[r+2],o[n++]=null!=(c=i[e++])?c:255;return o},copyToImageData:function(e,r){var t,a,n,o,i,s,f,c,l,d,h,u=this;if(a=u.colors,l=null,t=u.hasAlphaChannel,u.palette.length&&(l=null!=(h=u._decodedPalette)?h:u._decodedPalette=u.decodePalette(),a=4,t=!0),n=e.data||e,c=n.length,i=l||r,o=s=0,1===a)for(;c>o;)f=l?4*r[o/4]:s,d=i[f++],n[o++]=d,n[o++]=d,n[o++]=d,n[o++]=t?i[f++]:255,s=f;else for(;c>o;)f=l?4*r[o/4]:s,n[o++]=i[f++],n[o++]=i[f++],n[o++]=i[f++],n[o++]=t?i[f++]:255,s=f},decode:function(){var e,r=this;return e=new Uint8Array(r.width*r.height*4),r.copyToImageData(e,r.decodePixels()),e}},e.Codec.PNG={encoder:e.NotImplemented("PNG.encoder"),decoder:function(e,r){var t=new a;return t.readData(new Uint8Array(e)),{width:t.width,height:t.height,data:t.decode()}}}}(r),!function(e,r){function t(){}function a(e,r){for(var t,a,n=0,o=[],i=16;i>0&&!e[i-1];)i--;o.push({children:[],index:0});var s,f=o[0];for(t=0;i>t;t++){for(a=0;a<e[t];a++){for(f=o.pop(),f.children[f.index]=r[n];f.index>0;)f=o.pop();for(f.index++,o.push(f);o.length<=t;)o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s;n++}i>t+1&&(o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s)}return o[0].children}function n(e,r,t,a,n,o,i,s,c){function l(){if(T>0)return T--,S>>T&1;if(S=e[r++],255==S){var t=e[r++];if(t)throw"unexpected marker: "+(S<<8|t).toString(16)}return T=7,S>>>7}function d(e){for(var r,t=e;null!==(r=l());){if(t=t[r],"number"==typeof t)return t;if("object"!=typeof t)throw"invalid huffman sequence"}return null}function h(e){for(var r=0;e>0;){var t=l();if(null===t)return;r=r<<1|t,e--}return r}function u(e){var r=h(e);return r>=1<<e-1?r:r+(-1<<e)+1}function p(e,r){var t=d(e.huffmanTableDC),a=0===t?0:u(t);r[0]=e.pred+=a;for(var n=1;64>n;){var o=d(e.huffmanTableAC),i=15&o,s=o>>4;if(0!==i){n+=s;var c=f[n];r[c]=u(i),n++}else{if(15>s)break;n+=16}}}function v(e,r){var t=d(e.huffmanTableDC),a=0===t?0:u(t)<<c;r[0]=e.pred+=a}function g(e,r){r[0]|=l()<<c}function m(e,r){if(z>0)return void z--;for(var t=o,a=i;a>=t;){var n=d(e.huffmanTableAC),s=15&n,l=n>>4;if(0!==s){t+=l;var p=f[t];r[p]=u(s)*(1<<c),t++}else{if(15>l){z=h(l)+(1<<l)-1;break}t+=16}}}function y(e,r){for(var t=o,a=i,n=0;a>=t;){var s=f[t];switch(G){case 0:var p=d(e.huffmanTableAC),v=15&p,n=p>>4;if(0===v)15>n?(z=h(n)+(1<<n),G=4):(n=16,G=1);else{if(1!==v)throw"invalid ACn encoding";U=u(v),G=n?2:3}continue;case 1:case 2:r[s]?r[s]+=l()<<c:(n--,0===n&&(G=2==G?3:0));break;case 3:r[s]?r[s]+=l()<<c:(r[s]=U<<c,G=0);break;case 4:r[s]&&(r[s]+=l()<<c)}t++}4===G&&(z--,0===z&&(G=0))}function b(e,r,t,a,n){var o=t/x|0,i=t%x,s=o*e.v+a,f=i*e.h+n;r(e,e.blocks[s][f])}function w(e,r,t){var a=t/e.blocksPerLine|0,n=t%e.blocksPerLine;r(e,e.blocks[a][n])}var U,k,A,I,B,C,L,x=(t.precision,t.samplesPerLine,t.scanLines,t.mcusPerLine),E=t.progressive,P=(t.maxH,t.maxV,r),S=0,T=0,z=0,G=0,_=a.length;L=E?0===o?0===s?v:g:0===s?m:y:p;var M,D,R=0;D=1==_?a[0].blocksPerLine*a[0].blocksPerColumn:x*t.mcusPerColumn,n||(n=D);for(var F,X;D>R;){for(A=0;_>A;A++)a[A].pred=0;if(z=0,1==_)for(k=a[0],C=0;n>C;C++)w(k,L,R),R++;else for(C=0;n>C;C++){for(A=0;_>A;A++)for(k=a[A],F=k.h,X=k.v,I=0;X>I;I++)for(B=0;F>B;B++)b(k,L,R,I,B);if(R++,R===D)break}if(T=0,M=e[r]<<8|e[r+1],65280>M)throw"marker was not found";if(!(M>=65488&&65495>=M))break;r+=2}return r-P}function o(e,r){function t(e,t,a){var n,o,i,s,f,m,y,b,w,U,k=r.quantizationTable,A=a;for(U=0;64>U;U++)A[U]=e[U]*k[U];for(U=0;8>U;++U){var I=8*U;0!=A[1+I]||0!=A[2+I]||0!=A[3+I]||0!=A[4+I]||0!=A[5+I]||0!=A[6+I]||0!=A[7+I]?(n=v*A[0+I]+128>>8,o=v*A[4+I]+128>>8,i=A[2+I],s=A[6+I],f=g*(A[1+I]-A[7+I])+128>>8,b=g*(A[1+I]+A[7+I])+128>>8,m=A[3+I]<<4,y=A[5+I]<<4,w=n-o+1>>1,n=n+o+1>>1,o=w,w=i*p+s*u+128>>8,i=i*u-s*p+128>>8,s=w,w=f-y+1>>1,f=f+y+1>>1,y=w,w=b+m+1>>1,m=b-m+1>>1,b=w,w=n-s+1>>1,n=n+s+1>>1,s=w,w=o-i+1>>1,o=o+i+1>>1,i=w,w=f*h+b*d+2048>>12,f=f*d-b*h+2048>>12,b=w,w=m*l+y*c+2048>>12,m=m*c-y*l+2048>>12,y=w,A[0+I]=n+b,A[7+I]=n-b,A[1+I]=o+y,A[6+I]=o-y,A[2+I]=i+m,A[5+I]=i-m,A[3+I]=s+f,A[4+I]=s-f):(w=v*A[0+I]+512>>10,A[0+I]=w,A[1+I]=w,A[2+I]=w,A[3+I]=w,A[4+I]=w,A[5+I]=w,A[6+I]=w,A[7+I]=w)}for(U=0;8>U;++U){var B=U;0!=A[8+B]||0!=A[16+B]||0!=A[24+B]||0!=A[32+B]||0!=A[40+B]||0!=A[48+B]||0!=A[56+B]?(n=v*A[0+B]+2048>>12,o=v*A[32+B]+2048>>12,i=A[16+B],s=A[48+B],f=g*(A[8+B]-A[56+B])+2048>>12,b=g*(A[8+B]+A[56+B])+2048>>12,m=A[24+B],y=A[40+B],w=n-o+1>>1,n=n+o+1>>1,o=w,w=i*p+s*u+2048>>12,i=i*u-s*p+2048>>12,s=w,w=f-y+1>>1,f=f+y+1>>1,y=w,w=b+m+1>>1,m=b-m+1>>1,b=w,w=n-s+1>>1,n=n+s+1>>1,s=w,w=o-i+1>>1,o=o+i+1>>1,i=w,w=f*h+b*d+2048>>12,f=f*d-b*h+2048>>12,b=w,w=m*l+y*c+2048>>12,m=m*c-y*l+2048>>12,y=w,A[0+B]=n+b,A[56+B]=n-b,A[8+B]=o+y,A[48+B]=o-y,A[16+B]=i+m,A[40+B]=i-m,A[24+B]=s+f,A[32+B]=s-f):(w=v*a[U+0]+8192>>14,A[0+B]=w,A[8+B]=w,A[16+B]=w,A[24+B]=w,A[32+B]=w,A[40+B]=w,A[48+B]=w,A[56+B]=w)}for(U=0;64>U;++U){var C=128+(A[U]+8>>4);t[U]=0>C?0:C>255?255:C}}for(var a,n,o=[],i=r.blocksPerLine,s=r.blocksPerColumn,f=i<<3,m=new Int32Array(64),y=new Uint8Array(64),b=0;s>b;b++){var w=b<<3;for(a=0;8>a;a++)o.push(new Uint8Array(f));for(var U=0;i>U;U++){t(r.blocks[b][U],y,m);var k=0,A=U<<3;for(n=0;8>n;n++){var I=o[w+n];for(a=0;8>a;a++)I[A+a]=y[k++]}}}return o}function i(e){return 0>e?0:e>255?255:e}function s(e){function r(e){for(var r=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],t=0;64>t;t++){var a=I((r[t]*e+50)/100);1>a?a=1:a>255&&(a=255),B[O[t]]=a}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;64>o;o++){var i=I((n[o]*e+50)/100);1>i?i=1:i>255&&(i=255),C[O[o]]=i}for(var s=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,c=0;8>c;c++)for(var l=0;8>l;l++)L[f]=1/(B[O[f]]*s[c]*s[l]*8),x[f]=1/(C[O[f]]*s[c]*s[l]*8),f++}function t(e,r){for(var t=0,a=0,n=new Array,o=1;16>=o;o++){for(var i=1;i<=e[o];i++)n[r[a]]=[],n[r[a]][0]=t,n[r[a]][1]=o,a++,t++;t*=2}return n}function a(){b=t(H,N),w=t(j,$),U=t(q,Y),k=t(J,V)}function n(){for(var e=1,r=2,t=1;15>=t;t++){for(var a=e;r>a;a++)P[32767+a]=t,E[32767+a]=[],E[32767+a][1]=t,E[32767+a][0]=a;for(var n=-(r-1);-e>=n;n++)P[32767+n]=t,E[32767+n]=[],E[32767+n][1]=t,E[32767+n][0]=r-1+n;e<<=1,r<<=1}}function o(){for(var e=0;256>e;e++)X[e]=19595*e,X[e+256>>0]=38470*e,X[e+512>>0]=7471*e+32768,X[e+768>>0]=-11059*e,X[e+1024>>0]=-21709*e,X[e+1280>>0]=32768*e+8421375,X[e+1536>>0]=-27439*e,X[e+1792>>0]=-5329*e}function i(e){for(var r=e[0],t=e[1]-1;t>=0;)r&1<<t&&(G|=1<<_),t--,_--,0>_&&(255==G?(s(255),s(0)):s(G),_=7,G=0)}function s(e){z.push(e)}function f(e){s(e>>8&255),s(255&e)}function c(e,r){var t,a,n,o,i,s,f,c,l,d=0;const h=8,u=64;for(l=0;h>l;++l){t=e[d],a=e[d+1],n=e[d+2],o=e[d+3],i=e[d+4],s=e[d+5],f=e[d+6],c=e[d+7];var p=t+c,v=t-c,g=a+f,m=a-f,y=n+s,b=n-s,w=o+i,U=o-i,k=p+w,A=p-w,I=g+y,B=g-y;e[d]=k+I,e[d+4]=k-I;var C=.707106781*(B+A);e[d+2]=A+C,e[d+6]=A-C,k=U+b,I=b+m,B=m+v;var L=.382683433*(k-B),x=.5411961*k+L,E=1.306562965*B+L,P=.707106781*I,T=v+P,z=v-P;e[d+5]=z+x,e[d+3]=z-x,e[d+1]=T+E,e[d+7]=T-E,d+=8}for(d=0,l=0;h>l;++l){t=e[d],a=e[d+8],n=e[d+16],o=e[d+24],i=e[d+32],s=e[d+40],f=e[d+48],c=e[d+56];var G=t+c,_=t-c,M=a+f,D=a-f,R=n+s,F=n-s,X=o+i,O=o-i,H=G+X,N=G-X,q=M+R,Y=M-R;e[d]=H+q,e[d+32]=H-q;var j=.707106781*(Y+N);e[d+16]=N+j,e[d+48]=N-j,H=O+F,q=F+D,Y=D+_;var $=.382683433*(H-Y),J=.5411961*H+$,V=1.306562965*Y+$,W=.707106781*q,Z=_+W,K=_-W;e[d+40]=K+J,e[d+24]=K-J,e[d+8]=Z+V,e[d+56]=Z-V,d++}var Q;for(l=0;u>l;++l)Q=e[l]*r[l],S[l]=Q>0?Q+.5|0:Q-.5|0;return S}function l(){f(65504),f(16),s(74),s(70),s(73),s(70),s(0),s(1),s(1),s(0),f(1),f(1),s(0),s(0)}function d(e,r){f(65472),f(17),s(8),f(r),f(e),s(3),s(1),s(17),s(0),s(2),s(17),s(1),s(3),s(17),s(1)}function h(){f(65499),f(132),s(0);for(var e=0;64>e;e++)s(B[e]);s(1);for(var r=0;64>r;r++)s(C[r])}function u(){f(65476),f(418),s(0);for(var e=0;16>e;e++)s(H[e+1]);for(var r=0;11>=r;r++)s(N[r]);s(16);for(var t=0;16>t;t++)s(q[t+1]);for(var a=0;161>=a;a++)s(Y[a]);s(1);for(var n=0;16>n;n++)s(j[n+1]);for(var o=0;11>=o;o++)s($[o]);s(17);for(var i=0;16>i;i++)s(J[i+1]);for(var c=0;161>=c;c++)s(V[c])}function p(){f(65498),f(12),s(3),s(1),s(0),s(2),s(17),s(3),s(17),s(0),s(63),s(0)}function v(e,r,t,a,n){var o,s=n[0],f=n[240];const l=16,d=63,h=64;for(var u=c(e,r),p=0;h>p;++p)T[O[p]]=u[p];var v=T[0]-t;t=T[0],0==v?i(a[0]):(o=32767+v,i(a[P[o]]),i(E[o]));for(var g=63;g>0&&0==T[g];g--);if(0==g)return i(s),t;for(var m,y=1;g>=y;){for(var b=y;0==T[y]&&g>=y;++y);var w=y-b;if(w>=l){m=w>>4;for(var U=1;m>=U;++U)i(f);w=15&w}o=32767+T[y],i(n[(w<<4)+P[o]]),i(E[o]),y++}return g!=d&&i(s),t}function g(){for(var e=String.fromCharCode,r=0;256>r;r++)F[r]=e(r)}function m(e){if(0>=e&&(e=1),e>100&&(e=100),A!==e){var t=0;t=50>e?Math.floor(5e3/e):Math.floor(200-2*e),r(t),A=e}}function y(){e||(e=50),g(),a(),n(),o(),m(e)}var b,w,U,k,A,I=(Math.round,Math.floor),B=new Array(64),C=new Array(64),L=new Array(64),x=new Array(64),E=new Array(65535),P=new Array(65535),S=new Array(64),T=new Array(64),z=[],G=0,_=7,M=new Array(64),D=new Array(64),R=new Array(64),F=new Array(256),X=new Array(2048),O=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],H=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],N=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Y=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],j=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],$=[0,1,2,3,4,5,6,7,8,9,10,11],J=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],V=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,r){r&&m(r),z=new Array,G=0,_=7,f(65496),l(),h(),d(e.width,e.height),u(),p();var t=0,a=0,n=0;G=0,_=7,this.encode.displayName="_encode_";for(var o,s,c,g,y,A,I,B,C,E=e.data,P=e.width,S=e.height,T=4*P,F=0;S>F;){for(o=0;T>o;){for(y=T*F+o,A=y,I=-1,B=0,C=0;64>C;C++)B=C>>3,I=4*(7&C),A=y+B*T+I,F+B>=S&&(A-=T*(F+1+B-S)),o+I>=T&&(A-=o+I-T+4),s=E[A++],c=E[A++],g=E[A++],M[C]=(X[s]+X[c+256>>0]+X[g+512>>0]>>16)-128,D[C]=(X[s+768>>0]+X[c+1024>>0]+X[g+1280>>0]>>16)-128,R[C]=(X[s+1280>>0]+X[c+1536>>0]+X[g+1792>>0]>>16)-128;t=v(M,L,t,b,U),a=v(D,x,a,w,k),n=v(R,x,n,w,k),o+=32}F+=8}if(_>=0){var O=[];O[1]=_+1,O[0]=(1<<_+1)-1,i(O)}return f(65497),new Uint8Array(z)},y()}var f=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),c=4017,l=799,d=3406,h=2276,u=1567,p=3784,v=5793,g=2896;t.prototype={constructor:t,parse:function(e){function r(){var r=e[l]<<8|e[l+1];return l+=2,r}function t(){var t=r(),a=e.subarray(l,l+t-2);return l+=a.length,a}function i(e){var r,t,a=0,n=0;for(t in e.components)e.components.hasOwnProperty(t)&&(r=e.components[t],a<r.h&&(a=r.h),n<r.v&&(n=r.v));var o=Math.ceil(e.samplesPerLine/8/a),i=Math.ceil(e.scanLines/8/n);for(t in e.components)if(e.components.hasOwnProperty(t)){r=e.components[t];for(var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*r.h/a),f=Math.ceil(Math.ceil(e.scanLines/8)*r.v/n),c=o*r.h,l=i*r.v,d=[],h=0;l>h;h++){for(var u=[],p=0;c>p;p++)u.push(new Int32Array(64));d.push(u)}r.blocksPerLine=s,r.blocksPerColumn=f,r.blocks=d}e.maxH=a,e.maxV=n,e.mcusPerLine=o,e.mcusPerColumn=i}var s,c,l=0,d=(e.length,null),h=null,u=[],p=[],v=[],g=[],m=r();if(65496!=m)throw"SOI not found";for(m=r();65497!=m;){var y,b;switch(m){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=t();65504===m&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(d={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])}),65518===m&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&0===w[5]&&(h={version:w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var U=r(),k=U+l-2;k>l;){var A=e[l++],I=new Int32Array(64);if(A>>4===0)for(b=0;64>b;b++){var B=f[b];I[B]=e[l++]}else{if(A>>4!==1)throw"DQT: invalid table spec";for(b=0;64>b;b++){var B=f[b];I[B]=r()}}u[15&A]=I}break;case 65472:case 65473:case 65474:r(),s={},s.extended=65473===m,s.progressive=65474===m,s.precision=e[l++],s.scanLines=r(),s.samplesPerLine=r(),s.components={},s.componentsOrder=[];var C,L=e[l++];for(y=0;L>y;y++){C=e[l];var x=e[l+1]>>4,E=15&e[l+1],P=e[l+2];s.componentsOrder.push(C),s.components[C]={h:x,v:E,quantizationIdx:P},l+=3}i(s),p.push(s);break;case 65476:var S=r();for(y=2;S>y;){var T=e[l++],z=new Uint8Array(16),G=0;for(b=0;16>b;b++,l++)G+=z[b]=e[l];var _=new Uint8Array(G);for(b=0;G>b;b++,l++)_[b]=e[l];y+=17+G,(T>>4===0?g:v)[15&T]=a(z,_)}break;case 65501:r(),c=r();break;case 65498:var M,D=(r(),e[l++]),R=[];for(y=0;D>y;y++){M=s.components[e[l++]];var F=e[l++];M.huffmanTableDC=g[F>>4],M.huffmanTableAC=v[15&F],R.push(M)}var X=e[l++],O=e[l++],H=e[l++],N=n(e,l,s,R,c,X,O,H>>4,15&H);l+=N;break;default:if(255==e[l-3]&&e[l-2]>=192&&e[l-2]<=254){l-=3;break}throw"unknown JPEG marker "+m.toString(16)}m=r()}if(1!=p.length)throw"only single frame JPEGs supported";for(var y=0;y<p.length;y++){var q=p[y].components;for(var b in q)q[b].quantizationTable=u[q[b].quantizationIdx],delete q[b].quantizationIdx}this.width=s.samplesPerLine,this.height=s.scanLines,this.jfif=d,this.adobe=h,this.components=[];for(var y=0;y<s.componentsOrder.length;y++){var M=s.components[s.componentsOrder[y]];this.components.push({lines:o(s,M),scaleX:M.h/s.maxH,scaleY:M.v/s.maxV})}},getData:function(e,r){var t,a,n,o,s,f,c,l,d,h,u,p,v,g,m,y,b,w,U,k,A,I=this.width/e,B=this.height/r,C=0,L=e*r*this.components.length,x=new Uint8Array(L);switch(this.components.length){case 1:for(t=this.components[0],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],d=0;e>d;d++)u=s[0|d*t.scaleX*I],x[C++]=u;break;case 2:for(t=this.components[0],a=this.components[1],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],d=0;e>d;d++)u=s[0|d*t.scaleX*I],x[C++]=u,u=f[0|d*a.scaleX*I],x[C++]=u;break;case 3:for(A=!0,this.adobe&&this.adobe.transformCode?A=!0:"undefined"!=typeof this.colorTransform&&(A=!!this.colorTransform),t=this.components[0],a=this.components[1],n=this.components[2],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],c=n.lines[0|h*n.scaleY*B],d=0;e>d;d++)A?(u=s[0|d*t.scaleX*I],p=f[0|d*a.scaleX*I],v=c[0|d*n.scaleX*I],w=i(u+1.402*(v-128)),U=i(u-.3441363*(p-128)-.71413636*(v-128)),k=i(u+1.772*(p-128))):(w=s[0|d*t.scaleX*I],U=f[0|d*a.scaleX*I],k=c[0|d*n.scaleX*I]),x[C++]=w,x[C++]=U,x[C++]=k;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";for(A=!1,this.adobe&&this.adobe.transformCode?A=!0:"undefined"!=typeof this.colorTransform&&(A=!!this.colorTransform),t=this.components[0],a=this.components[1],n=this.components[2],o=this.components[3],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],c=n.lines[0|h*n.scaleY*B],l=o.lines[0|h*o.scaleY*B],d=0;e>d;d++)A?(u=s[0|d*t.scaleX*I],p=f[0|d*a.scaleX*I],v=c[0|d*n.scaleX*I],g=l[0|d*o.scaleX*I],m=255-i(u+1.402*(v-128)),y=255-i(u-.3441363*(p-128)-.71413636*(v-128)),b=255-i(u+1.772*(p-128))):(m=s[0|d*t.scaleX*I],y=f[0|d*a.scaleX*I],b=c[0|d*n.scaleX*I],g=l[0|d*o.scaleX*I]),x[C++]=m,x[C++]=y,x[C++]=b,x[C++]=g;break;default:throw"Unsupported color mode"}return x},copyToImageData:function(e){var r,t,a,n,o,s,f,c,l,d=e.width,h=e.height,u=e.data,p=this.getData(d,h),v=0,g=0;switch(this.components.length){case 1:for(t=0;h>t;t++)for(r=0;d>r;r++)a=p[v++],u[g++]=a,u[g++]=a,u[g++]=a,u[g++]=255;break;case 3:for(t=0;h>t;t++)for(r=0;d>r;r++)f=p[v++],c=p[v++],l=p[v++],u[g++]=f,u[g++]=c,u[g++]=l,u[g++]=255;break;case 4:for(t=0;h>t;t++)for(r=0;d>r;r++)o=p[v++],s=p[v++],a=p[v++],n=p[v++],f=255-i(o*(1-n/255)+n),c=255-i(s*(1-n/255)+n),l=255-i(a*(1-n/255)+n),u[g++]=f,u[g++]=c,u[g++]=l,u[g++]=255;break;default:throw"Unsupported color mode"}}};e.Codec.JPEG=e.Codec.JPG={encoder:function(e,r){r=r||{};var t="undefined"==typeof r.quality?100:r.quality,a=new s(t);return new Buffer(a.encode(e))},decoder:function(e,r){var a=new t;a.parse(new Uint8Array(e));var n={width:a.width,height:a.height,data:new Uint8Array(a.width*a.height*4)};return a.copyToImageData(n),n}}}(r),!function(e,r){function t(e){var r=this;if(r.pos=0,r.buffer=e,r.flag=[String.fromCharCode(r.buffer[r.pos++]),String.fromCharCode(r.buffer[r.pos++])].join(""),"BM"!==r.flag)throw new Error("Invalid BMP File");r.parseHeader(),r.parseBGR()}function a(e){var r=this;r.data=e.data,r.width=e.width,r.height=e.height,r.extraBytes=r.width%4,r.rgbSize=r.height*(3*r.width+r.extraBytes),r.headerInfoSize=40,r.flag="BM",r.reserved=0,r.offset=54,r.fileSize=r.rgbSize+r.offset,r.planes=1,r.bitPP=24,r.compress=0,r.hr=0,r.vr=0,r.colors=0,r.importantColors=0}t.prototype={constructor:t,pos:0,buffer:null,flag:null,fileSize:null,reserved:null,offset:null,headerSize:null,width:0,height:0,planes:null,bitPP:null,compress:null,rawSize:null,hr:null,vr:null,colors:null,importantColors:null,palette:null,data:null,readUInt8:function(e){return this.buffer[e++]},readUInt16LE:function(e){var r,t,a=this;return r=a.buffer[e++],t=a.buffer[e++],r|t<<8},readUInt32LE:function(e){var r,t,a,n,o=this;return r=o.buffer[e++],t=o.buffer[e++],a=o.buffer[e++],n=o.buffer[e++],r|t<<8|a<<16|n<<24},parseHeader:function(){var e=this;if(e.fileSize=e.readUInt32LE(e.pos),e.pos+=4,e.reserved=e.readUInt32LE(e.pos),e.pos+=4,e.offset=e.readUInt32LE(e.pos),e.pos+=4,e.headerSize=e.readUInt32LE(e.pos),e.pos+=4,e.width=e.readUInt32LE(e.pos),e.pos+=4,e.height=e.readUInt32LE(e.pos),e.pos+=4,e.planes=e.readUInt16LE(e.pos),e.pos+=2,e.bitPP=e.readUInt16LE(e.pos),e.pos+=2,e.compress=e.readUInt32LE(e.pos),e.pos+=4,e.rawSize=e.readUInt32LE(e.pos),e.pos+=4,
e.hr=e.readUInt32LE(e.pos),e.pos+=4,e.vr=e.readUInt32LE(e.pos),e.pos+=4,e.colors=e.readUInt32LE(e.pos),e.pos+=4,e.importantColors=e.readUInt32LE(e.pos),e.pos+=4,e.bitPP<24){var r=0===e.colors?1<<e.bitPP:e.colors;e.palette=new Array(r);for(var t=0;r>t;t++){var a=e.readUInt8(e.pos++),n=e.readUInt8(e.pos++),o=e.readUInt8(e.pos++),i=e.readUInt8(e.pos++);e.palette[t]={red:o,green:n,blue:a,quad:i}}}},parseBGR:function(){var e=this;e.pos=e.offset;var r="bit"+e.bitPP,t=e.width*e.height*4;try{e.data=new Uint8Array(t),e[r]()}catch(a){console.log("bit decode error:"+a)}},bit1:function(){var e,r,t,a,n,o,i=this,s=i.palette,f=i.width,c=i.height,l=Math.ceil(f/8),d=l%4;for(e=c-1;e>=0;e--){for(r=0;l>r;r++)for(t=i.readUInt8(i.pos++),a=e*f*4+8*r*4,n=0;8>n&&f>8*r+n;n++)o=s[t>>7-n&1],i.data[a+4*n]=o.blue,i.data[a+4*n+1]=o.green,i.data[a+4*n+2]=o.red,i.data[a+4*n+3]=255;0!=d&&(i.pos+=4-d)}},bit4:function(){var e,r,t,a,n,o,i,s=this,f=s.palette,c=s.width,l=s.height,d=Math.ceil(c/2),h=d%4;for(e=l-1;e>=0;e--){for(r=0;d>r&&(t=s.readUInt8(s.pos++),a=e*c*4+2*r*4,n=t>>4,o=15&t,i=f[n],s.data[a]=i.blue,s.data[a+1]=i.green,s.data[a+2]=i.red,s.data[a+3]=255,!(2*r+1>=c));r++)i=f[o],s.data[a+4]=i.blue,s.data[a+4+1]=i.green,s.data[a+4+2]=i.red,s.data[a+4+3]=255;0!=h&&(s.pos+=4-h)}},bit8:function(){var e,r,t,a,n,o=this,i=o.palette,s=o.width,f=o.height,c=s%4;for(e=f-1;e>=0;e--){for(r=0;s>r;r++)t=o.readUInt8(o.pos++),a=e*s*4+4*r,t<i.length?(n=i[t],o.data[a]=n.blue,o.data[a+1]=n.green,o.data[a+2]=n.red,o.data[a+3]=255):(o.data[a]=255,o.data[a+1]=255,o.data[a+2]=255,o.data[a+3]=255);0!=c&&(o.pos+=4-c)}},bit24:function(){var e,r,t,a,n,o,i=this,s=(i.palette,i.width),f=i.height,c=s%4;for(e=f-1;e>=0;e--){for(r=0;s>r;r++)a=i.readUInt8(i.pos++),n=i.readUInt8(i.pos++),o=i.readUInt8(i.pos++),t=e*s*4+4*r,i.data[t]=o,i.data[t+1]=n,i.data[t+2]=a,i.data[t+3]=255;i.pos+=c}},getData:function(){return this.data}},a.prototype={constructor:a,flag:null,fileSize:null,reserved:null,offset:null,headerSize:null,width:0,height:0,planes:null,bitPP:null,compress:null,rawSize:null,hr:null,vr:null,colors:null,importantColors:null,palette:null,extraBytes:null,rgbSize:null,headerInfoSize:null,data:null,write:function(e,r){for(var t=0;t<r.length;t++)e.push(r.charCodeAt(t))},writeUInt8:function(e,r){e.push(255&r)},writeUInt16LE:function(e,r){e.push(255&r,r>>>8&255)},writeUInt32LE:function(e,r){e.push(255&r,r>>>8&255,r>>>16&255,r>>>24&255)},fill:function(e,r,t,a){for(var n=t;a>n;n++)e[n]=r},encode:function(){var e=this,r=e.width,t=e.height,a=[],n=new Array(e.offset+e.rgbSize);e.write(a,e.flag),e.writeUInt32LE(a,e.fileSize),e.writeUInt32LE(a,e.reserved),e.writeUInt32LE(a,e.offset),e.writeUInt32LE(a,e.headerInfoSize),e.writeUInt32LE(a,r),e.writeUInt32LE(a,t),e.writeUInt16LE(a,e.planes),e.writeUInt16LE(a,e.bitPP),e.writeUInt32LE(a,e.compress),e.writeUInt32LE(a,e.rgbSize),e.writeUInt32LE(a,e.hr),e.writeUInt32LE(a,e.vr),e.writeUInt32LE(a,e.colors),e.writeUInt32LE(a,e.importantColors);var o,i,s,f,c,l,d,h=0,u=3*r+e.extraBytes;for(o=t-1;o>=0;o--){for(i=0;r>i;i++)s=o*u+3*i,f=e.data[h++],c=e.data[h++],l=e.data[h++],h++,n[s+2]=f,n[s+1]=c,n[s]=l;e.extraBytes>0&&(d=o*u+3*r,e.fill(n,0,d,d+e.extraBytes))}return new Uint8Array(a.concat(n))}},e.Codec.BMP={encoder:function(e,r){"undefined"==typeof r.quality?100:r.quality;return new Buffer(new a(e).encode())},decoder:function(e,r){var a=new t(new Uint8Array(e));return{data:a.data,width:a.width,height:a.height}}}}(r),!function(e,r){function t(e){return e.reduce(function(e,r){return 2*e+r},0)}function a(e){for(var r=[],t=7;t>=0;t--)r.push(!!(e&1<<t));return r}function n(e,r){for(var t,a,n=0,o=function(e){for(var t=0,a=0;e>a;a++)r.charCodeAt(n>>3)&1<<(7&n)&&(t|=1<<a),n++;return t},i=[],s=1<<e,f=s+1,c=e+1,l=[],d=function(){l=[],c=e+1;for(var r=0;s>r;r++)l[r]=[r];l[s]=[],l[f]=null};;)if(a=t,t=o(c),t!==s){if(t===f)break;if(t<l.length)a!==s&&l.push(l[a].concat(l[t][0]));else{if(t!==l.length)throw new Error("Invalid LZW code.");l.push(l[a].concat(l[a][0]))}i.push.apply(i,l[t]),l.length===1<<c&&12>c&&c++}else d();return i}function o(e){var r=this;r.data=e,r.len=r.data.length,r.pos=0,r.readByte=function(){var r=this;if(r.pos>=r.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[r.pos++]:255&e.charCodeAt(r.pos++)},r.readBytes=function(e){for(var r=this,t=[],a=0;e>a;a++)t.push(r.readByte());return t},r.read=function(e){for(var r=this,t="",a=0;e>a;a++)t+=String.fromCharCode(r.readByte());return t},r.readUnsigned=function(){var e=this,r=e.readBytes(2);return(r[1]<<8)+r[0]}}function i(e,r){r||(r={});var o=function(r){for(var t=[],a=0;r>a;a++)t.push(e.readBytes(3));return t},i=function(){var r,t;t="";do r=e.readByte(),t+=e.read(r);while(0!==r);return t},s=function(){var n={};if(n.sig=e.read(3),n.ver=e.read(3),"GIF"!==n.sig)throw new Error("Not a GIF file.");n.width=e.readUnsigned(),n.height=e.readUnsigned();var i=a(e.readByte());n.gctFlag=i.shift(),n.colorRes=t(i.splice(0,3)),n.sorted=i.shift(),n.gctSize=t(i.splice(0,3)),n.bgColor=e.readByte(),n.pixelAspectRatio=e.readByte(),n.gctFlag&&(n.gct=o(1<<n.gctSize+1)),r.hdr&&r.hdr(n)},f=function(n){var o=function(n){var o=(e.readByte(),a(e.readByte()));n.reserved=o.splice(0,3),n.disposalMethod=t(o.splice(0,3)),n.userInput=o.shift(),n.transparencyGiven=o.shift(),n.delayTime=e.readUnsigned(),n.transparencyIndex=e.readByte(),n.terminator=e.readByte(),r.gce&&r.gce(n)},s=function(e){e.comment=i(),r.com&&r.com(e)},f=function(t){e.readByte();t.ptHeader=e.readBytes(12),t.ptData=i(),r.pte&&r.pte(t)},c=function(t){var a=function(t){e.readByte();t.unknown=e.readByte(),t.iterations=e.readUnsigned(),t.terminator=e.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(t)},n=function(e){e.appData=i(),r.app&&r.app[e.identifier]&&r.app[e.identifier](e)};e.readByte();switch(t.identifier=e.read(8),t.authCode=e.read(3),t.identifier){case"NETSCAPE":a(t);break;default:n(t)}},l=function(e){e.data=i(),r.unknown&&r.unknown(e)};switch(n.label=e.readByte(),n.label){case 249:n.extType="gce",o(n);break;case 254:n.extType="com",s(n);break;case 1:n.extType="pte",f(n);break;case 255:n.extType="app",c(n);break;default:n.extType="unknown",l(n)}},c=function(s){var f=function(e,r){for(var t=new Array(e.length),a=e.length/r,n=function(a,n){var o=e.slice(n*r,(n+1)*r);t.splice.apply(t,[a*r,r].concat(o))},o=[0,4,2,1],i=[8,8,4,2],s=0,f=0;4>f;f++)for(var c=o[f];a>c;c+=i[f])n(c,s),s++;return t};s.leftPos=e.readUnsigned(),s.topPos=e.readUnsigned(),s.width=e.readUnsigned(),s.height=e.readUnsigned();var c=a(e.readByte());s.lctFlag=c.shift(),s.interlaced=c.shift(),s.sorted=c.shift(),s.reserved=c.splice(0,2),s.lctSize=t(c.splice(0,3)),s.lctFlag&&(s.lct=o(1<<s.lctSize+1)),s.lzwMinCodeSize=e.readByte();var l=i();s.pixels=n(s.lzwMinCodeSize,l),s.interlaced&&(s.pixels=f(s.pixels,s.width)),r.img&&r.img(s)},l=function(){var t={};switch(t.sentinel=e.readByte(),String.fromCharCode(t.sentinel)){case"!":t.type="ext",f(t);break;case",":t.type="img",c(t);break;case";":t.type="eof",r.eof&&r.eof(t);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&l()},d=function(){s(),l()};d()}e.Codec.GIF={encoder:e.NotImplemented("GIF.encoder"),decoder:function(r,t){var a,n=null,s={width:0,height:0,data:null};return i(new o(new Uint8Array(r)),{hdr:function(e){a=e},gce:function(e){n=e.transparencyGiven?e.transparencyIndex:null},img:function(r){var t=r.lctFlag?r.lct:a.gct,o=new e.ImArray(r.width*r.height*4);r.pixels.forEach(function(e,r){e!==n&&(o[(r<<2)+0]=t[e][0],o[(r<<2)+1]=t[e][1],o[(r<<2)+2]=t[e][2],o[(r<<2)+3]=255)}),s.width=r.width,s.height=r.height,s.data=o}}),s}}}(r),!function(e,r){function t(e){switch(e.image_type){case u:case g:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&d("TGA.tgaCheckHeader: Invalid type colormap data for indexed type");break;case p:case v:case m:case y:e.colormap_type&&d("TGA.tgaCheckHeader: Invalid type colormap data for colormap type");break;case h:d("TGA.tgaCheckHeader: No data");default:d('TGA.tgaCheckHeader: Invalid type " '+e.image_type+'"')}(e.width<=0||e.height<=0)&&d("TGA.tgaCheckHeader: Invalid image size"),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&d('TGA.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'"')}function a(e,r,t,a,n){var o,i,s,f;if(i=t.pixel_size>>3,s=t.width*t.height*i,r&&(f=n.subarray(a,a+=t.colormap_length*(t.colormap_size>>3))),e){o=new Uint8Array(s);for(var c,l,d,h=0,u=new Uint8Array(i);s>h;)if(c=n[a++],l=(127&c)+1,128&c){for(d=0;i>d;++d)u[d]=n[a++];for(d=0;l>d;++d)o.set(u,h+d*i);h+=i*l}else{for(l*=i,d=0;l>d;++d)o[h+d]=n[a++];h+=l}}else o=n.subarray(a,a+=r?t.width*t.height:s);return{pixel_data:o,palettes:f}}function n(e,r,t,a,n,o,i,s,f,c){var l,d,h,u=c,p=0,v=e.width;for(h=t;h!==n;h+=a)for(d=o;d!==s;d+=i,p++)l=f[p],r[4*(d+v*h)+3]=255,r[4*(d+v*h)+2]=u[3*l+0],r[4*(d+v*h)+1]=u[3*l+1],r[4*(d+v*h)+0]=u[3*l+2];return r}function o(e,r,t,a,n,o,i,s,f){var c,l,d,h=0,u=e.width;for(d=t;d!==n;d+=a)for(l=o;l!==s;l+=i,h+=2)c=f[h+0]+(f[h+1]<<8),r[4*(l+u*d)+0]=(31744&c)>>7,r[4*(l+u*d)+1]=(992&c)>>2,r[4*(l+u*d)+2]=(31&c)>>3,r[4*(l+u*d)+3]=32768&c?0:255;return r}function i(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=3)r[4*(c+h*l)+3]=255,r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+1]=f[d+1],r[4*(c+h*l)+0]=f[d+2];return r}function s(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=4)r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+1]=f[d+1],r[4*(c+h*l)+0]=f[d+2],r[4*(c+h*l)+3]=f[d+3];return r}function f(e,r,t,a,n,o,i,s,f){var c,l,d,h=0,u=e.width;for(d=t;d!==n;d+=a)for(l=o;l!==s;l+=i,h++)c=f[h],r[4*(l+u*d)+0]=c,r[4*(l+u*d)+1]=c,r[4*(l+u*d)+2]=c,r[4*(l+u*d)+3]=255;return r}function c(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=2)r[4*(c+h*l)+0]=f[d+0],r[4*(c+h*l)+1]=f[d+0],r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+3]=f[d+1];return r}function l(e,r,t,a,l,h){var u,p,v,g,m,y,B=new Uint8Array(r*t*4);switch((e.flags&b)>>w){default:case A:u=0,v=1,m=r,p=0,g=1,y=t;break;case U:u=0,v=1,m=r,p=t-1,g=-1,y=-1;break;case I:u=r-1,v=-1,m=-1,p=0,g=1,y=t;break;case k:u=r-1,v=-1,m=-1,p=t-1,g=-1,y=-1}if(h)switch(e.pixel_size){case 8:f(e,B,p,g,y,u,v,m,a);break;case 16:c(e,B,p,g,y,u,v,m,a);break;default:d("TGA.getTgaRGBA: not support this format")}else switch(e.pixel_size){case 8:n(e,B,p,g,y,u,v,m,a,l);break;case 16:o(e,B,p,g,y,u,v,m,a);break;case 24:i(e,B,p,g,y,u,v,m,a);break;case 32:s(e,B,p,g,y,u,v,m,a);break;default:d("TGA.getTgaRGBA: not support this format")}return B}var d=function(r){e.error(r,!0)},h=0,u=1,p=2,v=3,g=9,m=10,y=11,b=48,w=4,U=0,k=1,A=2,I=3;e.Codec.TGA={encoder:e.NotImplemented("TGA.encoder"),decoder:function(e,r){e.length<19&&d("TGA: Not enough data to contain header.");var n=new Uint8Array(e),o=0,i={id_length:n[o++],colormap_type:n[o++],image_type:n[o++],colormap_index:n[o++]|n[o++]<<8,colormap_length:n[o++]|n[o++]<<8,colormap_size:n[o++],origin:[n[o++]|n[o++]<<8,n[o++]|n[o++]<<8],width:n[o++]|n[o++]<<8,height:n[o++]|n[o++]<<8,pixel_size:n[o++],flags:n[o++]};t(i),i.id_length+o>e.length&&d("TGA: No data"),o+=i.id_length;var s=!1,f=!1,c=!1;switch(i.image_type){case g:s=!0,f=!0;break;case u:f=!0;break;case m:s=!0;break;case p:break;case y:s=!0,c=!0;break;case v:c=!0}var h=a(s,f,i,o,n),b=l(i,i.width,i.height,h.pixel_data,h.palettes,c);return{width:i.width,height:i.height,data:b}}}}(r),!function(e,r){var t=function(r){e.error(r,!0)},a="hasOwnproperty",n=Array.prototype.push,o=Array.prototype.slice,i=-1,s=1,f=2,c=3,l=4,d=function(e,r){switch(e){case s:t("RGBE Read Error: "+(r||""));break;case f:t("RGBE Write Error: "+(r||""));break;case c:t("RGBE Bad File Format: "+(r||""));break;case l:default:t("RGBE: Error: "+(r||""))}return i},h=4,u=1,p=2,v=4,g="\n",m=function(e,r,t){r=r?r:1024;for(var a=e.pos,n=-1,o=0,i="",s=128,f=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+s)));0>(n=f.indexOf(g))&&r>o&&a<e.byteLength;)i+=f,o+=f.length,a+=s,f+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+s)));return n>-1?(!1!==t&&(e.pos+=o+n+1),i+f.slice(0,n)):!1},y=function(e,r){var t,a,i=r.length;for(b=new Uint16Array(i),t=0;i>t;t++)a=r.charCodeAt(t),b[t]=a;n.apply(e,o.call(new Uint8Array(b)))},w=function(e,r){n.apply(e,o.call(r))},U=/^#\?(\S+)$/,k=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,A=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,I=/^\s*FORMAT=(\S+)\s*$/,B=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,C=function(e){var r,t,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(r=m(e)))return d(s,"no header found");if(!(t=r.match(U)))return d(c,"bad initial token");for(a.valid|=u,a.programtype=t[1],a.string+=r+"\n";;){if(r=m(e),!1===r)break;if(a.string+=r+"\n","#"!==r.charAt(0)){if((t=r.match(k))&&(a.gamma=parseFloat(t[1],10)),(t=r.match(A))&&(a.exposure=parseFloat(t[1],10)),(t=r.match(I))&&(a.valid|=p,a.format=t[1]),(t=r.match(B))&&(a.valid|=v,a.height=parseInt(t[1],10),a.width=parseInt(t[2],10)),a.valid&p&&a.valid&v)break}else a.comments+=r+"\n"}return a.valid&p?a.valid&v?a:d(c,"missing image size specifier"):d(c,"missing format specifier")},L=function(e,r,t,n){var o="RGBE";n=n||{},n[a]("programtype")&&(o=n.programtype),y(e,"#?"+o+"\n"),n[a]("gamma")&&y(e,"GAMMA="+n.gamma+"\n"),n[a]("exposure")&&y(e,"EXPOSURE="+n.exposure+"\n"),y(e,"FORMAT=32-bit_rle_rgbe\n\n"),y(e,"-Y "+~~t+" +X "+~~r+"\n")},x=function(e,r,t){var a,n,o,i,f,h,u,p,v,g,m,y,b,w=r,U=t;if(8>w||w>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(w!==(e[2]<<8|e[3]))return d(c,"wrong scanline width");if(a=new Uint8Array(4*r*t),!a||!a.length)return d(l,"unable to allocate buffer space");for(n=0,o=0,p=4*w,b=new Uint8Array(4),h=new Uint8Array(p);U>0&&o<e.byteLength;){if(o+4>e.byteLength)return d(s);if(b[0]=e[o++],b[1]=e[o++],b[2]=e[o++],b[3]=e[o++],2!=b[0]||2!=b[1]||(b[2]<<8|b[3])!=w)return d(c,"bad rgbe scanline format");for(u=0;p>u&&o<e.byteLength;){if(i=e[o++],y=i>128,y&&(i-=128),0===i||u+i>p)return d(c,"bad scanline data");if(y)for(f=e[o++],v=0;i>v;v++)h[u++]=f;else h.set(e.subarray(o,o+i),u),u+=i,o+=i}for(g=w,v=0;g>v;v++)m=0,a[n]=h[v+m],m+=w,a[n+1]=h[v+m],m+=w,a[n+2]=h[v+m],m+=w,a[n+3]=h[v+m],n+=4;U--}return a},E=function(e,r,t){var a,n,o,i,s,f=4,c=new Uint8Array(2);for(a=0;t>a;){for(n=a,o=i=0;f>o&&t>n;)for(n+=o,i=o,o=1;t>n+o&&127>o&&r[n]==r[n+o];)o++;for(i>1&&i==n-a&&(c[0]=128+i,c[1]=r[a],w(e,c),a=n);n>a;)s=n-a,s>128&&(s=128),c[0]=s,w(e,c),w(e,r.subarray(a,s)),a+=s;o>=f&&(c[0]=128+o,c[1]=r[n],w(e,c),a+=o)}},P=function(e,r,t,a){var n,o,i,s=new Uint8Array(4);if(8>t||t>32767)return void w(e,r);for(n=new Uint8Array(4*t),i=0;a-- >0;){for(s[0]=2,s[1]=2,s[2]=t>>8,s[3]=255&t,w(e,s),o=0;t>o;o++)s[0]=r[datapos+0],s[1]=r[datapos+1],s[2]=r[datapos+2],s[3]=r[datapos+3],n[o]=s[0],n[o+t]=s[1],n[o+2*t]=s[2],n[o+3*t]=s[3],i+=h;for(o=0;4>o;o++)E(e,n[o*t],t)}};e.Codec.HDR=e.Codec.RGBE={encoder:function(e,r){r=r||{};var t=[];return L(t,e.width,e.height,r),P(t,e.data,r.scanline_width||0,r.num_scanlines||0),new Buffer(new Uint8Array(t))},decoder:function(e,r){var t=new Uint8Array(e);t.byteLength;t.pos=0;var a=C(t);if(i!==a){var n=a.width,o=a.height,s=x(t.subarray(t.pos),n,o);if(i!==s)return r&&(r.header=a.string,r.gamma=a.gamma,r.exposure=a.exposure),{width:n,height:o,data:s}}return null}}}(r),r});
/**
*
*   FILTER.js Generic Filters
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Generic Filters)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(t,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_FILTERS")?define("FILTER_FILTERS",["module","FILTER"],function(n,r){return e.moduleUri=n.uri,e.call(t,r),r}):(e.call(t,t.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return t.FILTER})}(this,function t(e){"use strict";var n=e.getPath(t.moduleUri);return!function(t,e){var r=(Object.prototype,Function.prototype,Array.prototype),i=r.slice,a=r.splice,s=r.concat,l=t.CompositeFilter=t.Class(t.Filter,{name:"CompositeFilter",constructor:function(t){var e=this;e.$super("constructor"),e._stack=t&&t.length?t.slice():[]},path:n,_stack:null,_meta:null,_stable:!0,dispose:function(t){var e,n=this,r=n._stack;if(n.$super("dispose"),!0===t)for(e=0;e<r.length;e++)r[e]&&r[e].dispose(t),r[e]=null;return n._stack=null,n._meta=null,n},serialize:function(){var t,e=this,n={filter:e.name,_isOn:!!e._isOn,_stable:!!e._stable,filters:[]},r=e._stack;for(t=0;t<r.length;t++)n.filters.push(r[t].serialize());return n},unserialize:function(e){var n,r,i,a,s,l=this,u=l._stack;if(e&&l.name===e.filter){if(l._isOn=!!e._isOn,l._stable=!!e._stable,a=e.filters||[],r=a.length,i=u.length,r===i&&l._stable)for(n=0;r>n;n++)u[n]=u[n].unserialize(a[n]);else{for(n=0;i>n;n++)u[n]&&u[n].dispose(!0),u[n]=null;for(u=[],n=0;r>n;n++){if(s=a[n]&&a[n].filter?t[a[n].filter]:null,!s)throw new Error('Filter "'+a[n].filter+'" could not be created');u.push((new s).unserialize(a[n]))}}l._stack=u}return l},getMeta:function(){return this._meta},setMeta:function(t){var e,n,r=this,i=r._stack;if(t&&(n=t.length)&&i.length)for(e=0;n>e;e++)i[t[e][0]].setMeta(t[e][1]);return r},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},filters:function(t){return arguments.length?(this._stack=t.slice(),this):this._stack.slice()},push:function(){var t=i.call(arguments),e=t.length;return e&&(this._stack=s.apply(this._stack,t)),this},pop:function(){return this._stack.pop()},shift:function(){return this._stack.shift()},unshift:function(){var t=i.call(arguments),e=t.length;return e&&a.apply(this._stack,[0,0].concat(t)),this},getAt:function(t){return this._stack.length>t?this._stack[t]:null},setAt:function(t,e){return this._stack.length>t?this._stack[t]=e:this._stack.push(e),this},insertAt:function(t){var e=i.call(arguments);e.length;return argslen>1&&(e.shift(),a.apply(this._stack,[t,0].concat(e))),this},removeAt:function(t){return this._stack.splice(t,1)},remove:function(t){for(var e=this._stack.length;--e>=0;)t===this._stack[e]&&this._stack.splice(e,1);return this},reset:function(){return this._stack.length=0,this},_apply:function(t,e,n,r){var i=this,a=!1;if(i.hasMeta=!1,i._meta=[],i._isOn&&i._stack.length){var s,l,u=i._stack,o=u.length;for(s=0;o>s;s++)l=u[s],l&&l._isOn&&(t=l._apply(t,e,n,r),a=a||l._update,l.hasMeta&&i._meta.push([s,l.getMeta()]))}return i._update=a,i.hasMeta=i._meta.length>0,t},canRun:function(){return this._isOn&&this._stack.length},toString:function(){var t,e=arguments.length&&arguments[0].substr?arguments[0]:"  ",n=e+e,r=this._stack,i=[],a=r.length;for(t=0;a>t;t++)i.push(r[t].toString(n));return["[FILTER: "+this.name+"]","[","  "+i.join("\n  "),"]",""].join("\n")}});l.prototype.empty=l.prototype.reset,l.prototype.concat=l.prototype.push}(e),!function(t,e){var r="hasOwnProperty";t.InlineFilter=t.CustomFilter=t.Class(t.Filter,{name:"InlineFilter",constructor:function(t){var e=this;e.$super("constructor"),e._handler=t&&"function"==typeof t?t:null,e._params={}},path:n,_handler:null,_params:null,dispose:function(){var t=this;return t.$super("dispose"),t._handler=null,t._params=null,t},params:function(t){var e=this;if(arguments.length){for(var n in t)t[r](n)&&(e._params[n]=t[n]);return e}return e._params},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_handler:t._handler?t._handler.toString():null,_params:t._params}}},unserialize:function(e){var n,r=this;return e&&r.name===e.filter&&(r._isOn=!!e._isOn,n=e.params,r._handler=null,n._handler&&(r._handler=new Function("FILTER",'"use strict"; return '+n._handler+";")(t)),r._params=n._params||{}),r},_apply:function(t,e,n,r){var i=this;return i._isOn&&i._handler?i._handler(i,t,e,n,r):t},canRun:function(){return this._isOn&&this._handler}})}(e),!function(t,e){function r(){return new u([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}function i(t,e){var n,r,i,a,s,l=new u(20);return n=e[0],r=e[1],i=e[2],a=e[3],s=e[4],l[0]=n*t[0]+r*t[5]+i*t[10]+a*t[15],l[1]=n*t[1]+r*t[6]+i*t[11]+a*t[16],l[2]=n*t[2]+r*t[7]+i*t[12]+a*t[17],l[3]=n*t[3]+r*t[8]+i*t[13]+a*t[18],l[4]=n*t[4]+r*t[9]+i*t[14]+a*t[19]+s,n=e[5],r=e[6],i=e[7],a=e[8],s=e[9],l[5]=n*t[0]+r*t[5]+i*t[10]+a*t[15],l[6]=n*t[1]+r*t[6]+i*t[11]+a*t[16],l[7]=n*t[2]+r*t[7]+i*t[12]+a*t[17],l[8]=n*t[3]+r*t[8]+i*t[13]+a*t[18],l[9]=n*t[4]+r*t[9]+i*t[14]+a*t[19]+s,n=e[10],r=e[11],i=e[12],a=e[13],s=e[14],l[10]=n*t[0]+r*t[5]+i*t[10]+a*t[15],l[11]=n*t[1]+r*t[6]+i*t[11]+a*t[16],l[12]=n*t[2]+r*t[7]+i*t[12]+a*t[17],l[13]=n*t[3]+r*t[8]+i*t[13]+a*t[18],l[14]=n*t[4]+r*t[9]+i*t[14]+a*t[19]+s,n=e[15],r=e[16],i=e[17],a=e[18],s=e[19],l[15]=n*t[0]+r*t[5]+i*t[10]+a*t[15],l[16]=n*t[1]+r*t[6]+i*t[11]+a*t[16],l[17]=n*t[2]+r*t[7]+i*t[12]+a*t[17],l[18]=n*t[3]+r*t[8]+i*t[13]+a*t[18],l[19]=n*t[4]+r*t[9]+i*t[14]+a*t[19]+s,l}function a(t,e,n){var r=new u(20);return r[0]=t[0]+n*(e[0]-t[0]),r[1]=t[1]+n*(e[1]-t[1]),r[2]=t[2]+n*(e[2]-t[2]),r[3]=t[3]+n*(e[3]-t[3]),r[4]=t[4]+n*(e[4]-t[4]),r[5]=t[5]+n*(e[5]-t[5]),r[6]=t[6]+n*(e[6]-t[6]),r[7]=t[7]+n*(e[7]-t[7]),r[8]=t[8]+n*(e[8]-t[0]),r[9]=t[9]+n*(e[9]-t[9]),r[10]=t[10]+n*(e[10]-t[10]),r[11]=t[11]+n*(e[11]-t[11]),r[12]=t[12]+n*(e[12]-t[12]),r[13]=t[13]+n*(e[13]-t[13]),r[14]=t[14]+n*(e[14]-t[14]),r[15]=t[15]+n*(e[15]-t[15]),r[16]=t[16]+n*(e[16]-t[16]),r[17]=t[17]+n*(e[17]-t[17]),r[18]=t[18]+n*(e[18]-t[18]),r[19]=t[19]+n*(e[19]-t[19]),r}var s=Math.sin,l=Math.cos,u=t.Array32F,o=t.Util.Array.typed,c=t.CONST.toRad,h=(t.CONST.toDeg,t._notSupportClamp),_=t.ColorMatrixFilter=t.Class(t.Filter,{name:"ColorMatrixFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&t.length?e._matrix=new u(t):e._matrix=null},path:n,_matrix:null,_webglInstance:null,dispose:function(){var t=this;return t.$super("dispose"),t._webglInstance=null,t._matrix=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_matrix:t._matrix}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._matrix=o(e._matrix,u)),n},channel:function(n,r){r=r===e?!1:r;var i=r?1:0;switch(n){case t.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,255]);case t.CHANNEL.BLUE:return this.set([0,0,i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,0,0,255]);case t.CHANNEL.GREEN:return this.set([0,i,0,0,0,0,1,0,0,0,0,i,0,0,0,0,0,0,0,255]);case t.CHANNEL.RED:default:return this.set([1,0,0,0,0,i,0,0,0,0,i,0,0,0,0,0,0,0,0,255])}},redChannel:function(e){return this.channel(t.CHANNEL.RED,e)},greenChannel:function(e){return this.channel(t.CHANNEL.GREEN,e)},blueChannel:function(e){return this.channel(t.CHANNEL.BLUE,e)},alphaChannel:function(e){return this.channel(t.CHANNEL.ALPHA,!0)},maskChannel:function(e){switch(e){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}},swapChannels:function(e,n){switch(e){case t.CHANNEL.ALPHA:switch(n){case t.CHANNEL.ALPHA:return this;case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.RED:default:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0])}break;case t.CHANNEL.BLUE:switch(n){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,0,0]);case t.CHANNEL.BLUE:return this;case t.CHANNEL.GREEN:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0])}break;case t.CHANNEL.GREEN:switch(n){case t.CHANNEL.ALPHA:return this.set([1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]);case t.CHANNEL.BLUE:return this.set([1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this;case t.CHANNEL.RED:default:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0])}break;case t.CHANNEL.RED:default:switch(n){case t.CHANNEL.ALPHA:return this.set([0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0]);case t.CHANNEL.BLUE:return this.set([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0]);case t.CHANNEL.GREEN:return this.set([0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0]);case t.CHANNEL.RED:default:return this}}},desaturate:function(){var e=t.LUMA;return this.set([e[0],e[1],e[2],0,0,e[0],e[1],e[2],0,0,e[0],e[1],e[2],0,0,0,0,0,1,0])},colorize:function(n,r){var i,a,s,l,u=t.LUMA;return r===e&&(r=1),i=.00392156862745098*(n>>16&255),a=.00392156862745098*(n>>8&255),s=.00392156862745098*(255&n),l=1-r,this.set([l+r*i*u[0],r*i*u[1],r*i*u[2],0,0,r*a*u[0],l+r*a*u[1],r*a*u[2],0,0,r*s*u[0],r*s*u[1],l+r*s*u[2],0,0,0,0,0,1,0])},invert:function(){return this.set([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0])},invertAlpha:function(){return this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,-1,255])},saturate:function(e){var n,r,i,a,s=t.LUMA;return n=1-e,r=n*s[0],i=n*s[1],a=n*s[2],this.set([r+e,i,a,0,0,r,i+e,a,0,0,r,i,a+e,0,0,0,0,0,1,0])},contrast:function(t,n,r){return n===e&&(n=t),r===e&&(r=t),t+=1,n+=1,r+=1,this.set([t,0,0,0,128*(1-t),0,n,0,0,128*(1-n),0,0,r,0,128*(1-r),0,0,0,1,0])},brightness:function(t,n,r){return n===e&&(n=t),r===e&&(r=t),this.set([1,0,0,0,t,0,1,0,0,n,0,0,1,0,r,0,0,0,1,0])},adjustHue:function(e){e*=c;var n=l(e),r=s(e),i=t.LUMA;return this.set([i[0]+n*(1-i[0])+r*-i[0],i[1]+n*-i[1]+r*-i[1],i[2]+n*-i[2]+r*(1-i[2]),0,0,i[0]+n*-i[0]+.143*r,i[1]+n*(1-i[1])+.14*r,i[2]+n*-i[2]+r*-.283,0,0,i[0]+n*-i[0]+r*-(1-i[0]),i[1]+n*-i[1]+r*i[1],i[2]+n*(1-i[2])+r*i[2],0,0,0,0,0,1,0])},average:function(t,n,r){return t===e&&(t=.3333),n===e&&(n=.3333),r===e&&(r=.3334),this.set([t,n,r,0,0,t,n,r,0,0,t,n,r,0,0,0,0,0,1,0])},quickContrastCorrection:function(t){return t===e&&(t=1.2),this.set([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0])},sepia:function(t){return t===e&&(t=.5),t>1?t=1:0>t&&(t=0),this.set([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0])},sepia2:function(n){n===e&&(n=10),n>100&&(n=100),n*=2.55;var r=t.LUMA;return this.set([r[0],r[1],r[2],0,40,r[0],r[1],r[2],0,20,r[0],r[1],r[2],0,-n,0,0,0,1,0])},threshold:function(n,r){r===e&&(r=256);var i=t.LUMA;return this.set([i[0]*r,i[1]*r,i[2]*r,0,-(r-1)*n,i[0]*r,i[1]*r,i[2]*r,0,-(r-1)*n,i[0]*r,i[1]*r,i[2]*r,0,-(r-1)*n,0,0,0,1,0])},threshold_rgb:function(t,n){return n===e&&(n=256),this.set([n,0,0,0,-(n-1)*t,0,n,0,0,-(n-1)*t,0,0,n,0,-(n-1)*t,0,0,0,1,0])},threshold_alpha:function(t,n){return t===e&&(t=.5),n===e&&(n=256),this.set([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,n,-n*t])},RGB2YCbCr:function(){return this.set([.5,-.418688,-.081312,0,128,.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,0,0,0,1,0])},YCbCr2RGB:function(){return this.set([1.402,1,0,0,-179.456,-.71414,1,-.34414,0,135.45984,0,1,1.772,0,-226.816,0,0,0,1,0])},blend:function(t,e){return this._matrix=this._matrix?a(this._matrix,t.getMatrix(),e):new u(t.getMatrix()),this},set:function(t){return this._matrix=this._matrix?i(this._matrix,new u(t)):new u(t),this},reset:function(){return this._matrix=null,this},combineWith:function(t){return this.set(t.getMatrix())},getMatrix:function(){return this._matrix},setMatrix:function(t){return this._matrix=new u(t),this},_apply:h?function(t,e,n){var r=this;if(r._isOn&&r._matrix){var i,a,s,l,u,o,c,h,_,f,m,p,d,v,g,N,b,w,A,E,C,y=t.length,x=r._matrix,L=(y>>2)%4;for(i=0;y>i;i+=16)w=t[i],A=t[i+1],E=t[i+2],C=t[i+3],a=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],s=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],l=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],u=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+4],A=t[i+5],E=t[i+6],C=t[i+7],o=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],c=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],h=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],_=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+8],A=t[i+9],E=t[i+10],C=t[i+11],f=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],m=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],p=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],d=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+12],A=t[i+13],E=t[i+14],C=t[i+15],v=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],g=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],N=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],b=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,o=0>o?0:o>255?255:o,c=0>c?0:c>255?255:c,h=0>h?0:h>255?255:h,_=0>_?0:_>255?255:_,f=0>f?0:f>255?255:f,m=0>m?0:m>255?255:m,p=0>p?0:p>255?255:p,d=0>d?0:d>255?255:d,v=0>v?0:v>255?255:v,g=0>g?0:g>255?255:g,N=0>N?0:N>255?255:N,b=0>b?0:b>255?255:b,t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u,t[i+4]=~~o,t[i+5]=~~c,t[i+6]=~~h,t[i+7]=~~_,t[i+8]=~~f,t[i+9]=~~m,t[i+10]=~~p,t[i+11]=~~d,t[i+12]=~~v,t[i+13]=~~g,t[i+14]=~~N,t[i+15]=~~b;if(L)for(L<<=2,i=y-L;y>i;i+=4)w=t[i],A=t[i+1],E=t[i+2],C=t[i+3],a=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],s=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],l=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],u=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u}return t}:function(t,e,n){var r=this;if(r._isOn&&r._matrix){var i,a,s,l,u,o,c,h,_,f,m,p,d,v,g,N,b,w,A,E,C,y=t.length,x=r._matrix,L=(y>>2)%4;for(i=0;y>i;i+=16)w=t[i],A=t[i+1],E=t[i+2],C=t[i+3],a=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],s=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],l=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],u=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+4],A=t[i+5],E=t[i+6],C=t[i+7],o=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],c=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],h=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],_=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+8],A=t[i+9],E=t[i+10],C=t[i+11],f=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],m=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],p=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],d=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],w=t[i+12],A=t[i+13],E=t[i+14],C=t[i+15],v=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],g=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],N=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],b=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u,t[i+4]=~~o,t[i+5]=~~c,t[i+6]=~~h,t[i+7]=~~_,t[i+8]=~~f,t[i+9]=~~m,t[i+10]=~~p,t[i+11]=~~d,t[i+12]=~~v,t[i+13]=~~g,t[i+14]=~~N,t[i+15]=~~b;if(L)for(L<<=2,i=y-L;y>i;i+=4)w=t[i],A=t[i+1],E=t[i+2],C=t[i+3],a=x[0]*w+x[1]*A+x[2]*E+x[3]*C+x[4],s=x[5]*w+x[6]*A+x[7]*E+x[8]*C+x[9],l=x[10]*w+x[11]*A+x[12]*E+x[13]*C+x[14],u=x[15]*w+x[16]*A+x[17]*E+x[18]*C+x[19],t[i]=~~a,t[i+1]=~~s,t[i+2]=~~l,t[i+3]=~~u}return t},canRun:function(){return this._isOn&&this._matrix}});_.prototype.grayscale=_.prototype.desaturate,_.prototype.rotateHue=_.prototype.adjustHue,_.prototype.thresholdRgb=_.prototype.threshold_rgb,_.prototype.thresholdAlpha=_.prototype.threshold_alpha,_.multiply=i,_.blend=a,_.eye=r}(e),!function(t,e){var r=t.ImArrayCopy,i=t.Color.clampPixel,a=t.Util.Array.typed,s=function(){var t,e=new r(256);for(t=0;256>t;t++)e[t]=t;return e},l=function(){var t,e=new r(256);for(t=0;256>t;t++)e[t]=255-t;return e},u=function(t){var e,n=new r(256);for(e=0;256>e;e++)n[e]=t;return n},o=function(t){return t?new r(t):null},c=Math.pow,h=Math.exp,_=1/255,f=t.TableLookupFilter=t.Class(t.Filter,{name:"TableLookupFilter",constructor:function(t,e,n,r){var i=this;i.$super("constructor"),i._tableR=t||null,i._tableG=e||i._tableR,i._tableB=n||i._tableG,i._tableA=r||null},path:n,_tableR:null,_tableG:null,_tableB:null,_tableA:null,dispose:function(){var t=this;return t.$super("dispose"),t._tableR=null,t._tableG=null,t._tableB=null,t._tableA=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_tableR:t._tableR,_tableG:t._tableG,_tableB:t._tableB,_tableA:t._tableA}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._tableR=a(e._tableR,r),n._tableG=a(e._tableG,r),n._tableB=a(e._tableB,r),n._tableA=a(e._tableA,r)),n},thresholds:function(t,e,n){t.length||(t=[t]),e||(e=t),n||(n=e);var a,s,l=t.length,u=l+1,o=e.length,c=o+1,h=n.length,_=h+1,f=new r(256),m=new r(u),p=new r(256),d=new r(c),v=new r(256),g=new r(_),N=255/(u-1),b=255/(c-1),w=255/(_-1);for(a=0;u>a;)m[a]=~~(N*a),a++;for(t[0]=~~(255*t[0]),a=1;l>a;)t[a]=t[a-1]+~~(255*t[a]),a++;for(a=0;c>a;)d[a]=~~(b*a),a++;for(e[0]=~~(255*e[0]),a=1;o>a;)e[a]=e[a-1]+~~(255*e[a]),a++;for(a=0;_>a;)g[a]=~~(w*a),a++;for(n[0]=~~(255*n[0]),a=1;h>a;)n[a]=n[a-1]+~~(255*n[a]),a++;for(a=0;256>a;a++){for(s=0;l>s&&a>t[s];)s++;for(f[a]=i(m[s]),s=0;o>s&&a>e[s];)s++;for(p[a]=i(d[s]),s=0;h>s&&a>n[s];)s++;v[a]=i(g[s])}return this.set(f,p,v)},threshold:function(t,e,n){return t=t||.5,e=e||t,n=n||e,this.thresholds([t],[e],[n])},quantize:function(t){t===e&&(t=64),2>t&&(t=2);var n,a=new r(256),s=new r(t),l=255/(t-1),u=t/256;for(n=0;t>n;)s[n]=~~(l*n),n++;for(n=0;256>n;n++)a[n]=i(s[~~(u*n)]);return this.set(a)},binarize:function(){return this.quantize(2)},channel:function(e){if(null==e)return this;var n,r,i;switch(e){case t.CHANNEL.BLUE:n=u(0),r=u(0),i=s();break;case t.CHANNEL.GREEN:n=u(0),r=s(),i=u(0);break;case t.CHANNEL.RED:default:n=s(),r=u(0),i=u(0)}return this.set(n,r,i)},redChannel:function(){return this.channel(t.CHANNEL.RED)},greenChannel:function(){return this.channel(t.CHANNEL.GREEN)},blueChannel:function(){return this.channel(t.CHANNEL.BLUE)},solarize:function(t){t===e&&(t=.5);var n,a,s=0,l=new r(256),u=2/255;for(s=0;256>s;s++)n=u*s,a=n>t?255-255*n:255*n-255,l[s]=~~i(a);return this.set(l)},solarize2:function(t){t===e&&(t=.5),t=1-t;var n,a,s=0,l=new r(256),u=2/255;for(s=0;256>s;s++)n=u*s,a=t>n?255-255*n:255*n-255,l[s]=~~i(a);return this.set(l)},solarizeInverse:function(t){t===e&&(t=.5),t*=256;var n=0,i=new r(256);for(n=0;256>n;n++)i[n]=n>t?255-n:n;return this.set(i)},invert:function(){return this.set(l())},mask:function(t){var e=0,n=t>>16&255,a=t>>8&255,s=255&t;for(tR=new r(256),tG=new r(256),tB=new r(256),e=0;256>e;e++)tR[e]=i(e&n),tG[e]=i(e&a),tB[e]=i(e&s);return this.set(tR,tG,tB)},replace:function(t,e){if(t==e)return this;var n=t>>16&255,r=t>>8&255,i=255&t,a=e>>16&255,l=e>>8&255,u=255&e,o=s(),c=s(),h=s();return o[n]=a,c[r]=l,h[i]=u,this.set(o,c,h)},extract:function(e,n,r){if(!n||!n.length)return this;r=r||0;var a,s,l=r>>16&255,o=r>>8&255,c=255&r,h=u(l),_=u(o),f=u(c);switch(e){case t.CHANNEL.BLUE:for(a=n[0],s=n[1];s>=a;)f[a]=i(a),a++;break;case t.CHANNEL.GREEN:for(a=n[0],s=n[1];s>=a;)_[a]=i(a),a++;break;case t.CHANNEL.RED:default:for(a=n[0],s=n[1];s>=a;)h[a]=i(a),a++}return this.set(h,_,f)},gammaCorrection:function(t,e,n){t=t||1,e=e||t,n=n||e,t=1/t,e=1/e,n=1/n;var a=new r(256),s=new r(256),l=new r(256),u=0;for(u=0;256>u;u++)a[u]=i(~~(255*c(_*u,t))),s[u]=i(~~(255*c(_*u,e))),l[u]=i(~~(255*c(_*u,n)));return this.set(a,s,l)},exposure:function(t){t===e&&(t=1);var n=0,a=new r(256);for(n=0;256>n;n++)a[n]=i(~~(255*(1-h(-t*n*_))));return this.set(a)},set:function(t,e,n,r){if(!t)return this;e=e||t,n=n||e;var a,l,u,c,h,_=this._tableR||s(),f=o(_);if(e&&n){for(a=this._tableG||o(_),l=this._tableB||o(a),u=o(a),c=o(l),h=0;256>h;h++)_[h]=i(t[i(f[h])]),a[h]=i(e[i(u[h])]),l[h]=i(n[i(c[h])]);this._tableR=_,this._tableG=a,this._tableB=l}else{for(h=0;256>h;h++)_[h]=i(t[i(f[h])]);this._tableR=_,this._tableG=this._tableR,this._tableB=this._tableR}return this},reset:function(){return this._tableR=this._tableG=this._tableB=this._tableA=null,this},combineWith:function(t){return this.set(t.getTable(0),t.getTable(1),t.getTable(2))},getTable:function(e){switch(e=e||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA;case t.CHANNEL.BLUE:return this._tableB;case t.CHANNEL.GREEN:return this._tableG;case t.CHANNEL.RED:default:return this._tableR}},setTable:function(e,n){switch(n=n||t.CHANNEL.RED){case t.CHANNEL.ALPHA:return this._tableA=e,this;case t.CHANNEL.BLUE:return this._tableB=e,this;case t.CHANNEL.GREEN:return this._tableG=e,this;case t.CHANNEL.RED:default:return this._tableR=e,this}},_apply:function(t,e,n){var r=this;if(!r._isOn||!r._tableR)return t;var i,a,s,l,u,o=t.length,c=(o>>2)%4,h=r._tableR,_=r._tableG,f=r._tableB,m=r._tableA;if(m){for(i=0;o>i;i+=16)a=t[i],s=t[i+1],l=t[i+2],u=t[i+3],t[i]=h[a],t[i+1]=_[s],t[i+2]=f[l],t[i+3]=m[u],a=t[i+4],s=t[i+5],l=t[i+6],u=t[i+7],t[i+4]=h[a],t[i+5]=_[s],t[i+6]=f[l],t[i+7]=m[u],a=t[i+8],s=t[i+9],l=t[i+10],u=t[i+11],t[i+8]=h[a],t[i+9]=_[s],t[i+10]=f[l],t[i+11]=m[u],a=t[i+12],s=t[i+13],l=t[i+14],u=t[i+15],t[i+12]=h[a],t[i+13]=_[s],t[i+14]=f[l],t[i+15]=m[u];if(c)for(c<<=2,i=o-c;o>i;i+=4)a=t[i],s=t[i+1],l=t[i+2],u=t[i+3],t[i]=h[a],t[i+1]=_[s],t[i+2]=f[l],t[i+3]=m[u]}else{for(i=0;o>i;i+=16)a=t[i],s=t[i+1],l=t[i+2],t[i]=h[a],t[i+1]=_[s],t[i+2]=f[l],a=t[i+4],s=t[i+5],l=t[i+6],t[i+4]=h[a],t[i+5]=_[s],t[i+6]=f[l],a=t[i+8],s=t[i+9],l=t[i+10],t[i+8]=h[a],t[i+9]=_[s],t[i+10]=f[l],a=t[i+12],s=t[i+13],l=t[i+14],t[i+12]=h[a],t[i+13]=_[s],t[i+14]=f[l];if(c)for(c<<=2,i=o-c;o>i;i+=4)a=t[i],s=t[i+1],l=t[i+2],t[i]=h[a],t[i+1]=_[s],t[i+2]=f[l]}return t},canRun:function(){return this._isOn&&this._tableR}});f.prototype.posterize=f.prototype.levels=f.prototype.quantize}(e),!function(t,e){var r=t.ImArray,i=t.ImArrayCopy,a=t.Util.Array.typed,s=t.MODE,l=t.Array16I,u=Math.min,o=(Math.max,Math.floor);t.DisplacementMapFilter=t.Class(t.Filter,{name:"DisplacementMapFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&e.setMap(t)},path:n,_map:null,map:null,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,red:0,green:0,blue:0,alpha:0,mode:s.CLAMP,dispose:function(){var t=this;return t.$super("dispose"),t._map=null,t.map=null,t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.red=null,t.green=null,t.blue=null,t.alpha=null,t.mode=null,t},serialize:function(){var t=this,e=t.map;return{filter:t.name,_isOn:!!t._isOn,params:{_map:t._map||(e?{data:e.getData(),width:e.width,height:e.height}:null),scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color,red:t.red,green:t.green,blue:t.blue,alpha:t.alpha,mode:t.mode}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n.map=null,n._map=e._map,n._map&&(n._map.data=a(n._map.data,r)),n.scaleX=e.scaleX,n.scaleY=e.scaleY,n.startX=e.startX,n.startY=e.startY,n.componentX=e.componentX,n.componentY=e.componentY,n.color=e.color,n.red=e.red,n.green=e.green,n.blue=e.blue,n.alpha=e.alpha,n.mode=e.mode),n},reset:function(){var t=this;return t._map=null,t.map=null,t},getMap:function(){return this.map},setMap:function(t){var e=this;return t&&(e.map=t,e._map=null),e},setColor:function(t){var e=this;return e.color=t,e.alpha=t>>24&255,e.red=t>>16&255,e.green=t>>8&255,e.blue=255&t,e},_apply:function(t,e,n){var r=this,a=r.map;if(!r._isOn||!a&&!r._map)return t;var c,h,_,f,m,p,d,v,g,N,b,w,A,E,C,y,x,L,R,M,O,H,k,I,G,Y,F,X,P,T,B,z=r._map||{data:a.getData(),width:a.width,height:a.height},S=.00390625*r.scaleX,U=.00390625*r.scaleY,W=r.componentX,D=r.componentY,$=r.alpha,q=r.red,j=r.green,Q=r.blue,J=r.mode,K=s.IGNORE,V=(s.CLAMP,s.COLOR),Z=s.WRAP;for(c=z.data,h=z.width,_=z.height,f=c.length>>2,p=u(h,e),d=u(_,n),X=t.length,Y=p*d<<2,F=X>>2,g=o(r.startX*(e-1)),v=o(r.startY*(n-1)),N=v*e,b=-g,w=-v,A=e-g-1,E=n-v-1,m=new l(f<<1),P=new i(t),y=0,x=0,L=0,R=0,C=0;f>C;C++,y+=2,x++)x>=h&&(x=0,L++,R+=h),k=x+R<<2,m[y]=o((c[k+W]-128)*S),m[y+1]=o((c[k+D]-128)*U);for(x=0,L=0,R=0,M=0,C=0;Y>C;C+=4,x++)if(x>=p&&(x=0,L++,R+=e,M+=h),!(w>L||L>E||b>x||x>A)){if(H=x+g,O=L+v,I=H+R+N<<2,y=x+M<<1,T=H+m[y],B=O+m[y+1],B>=n||0>B||T>=e||0>T){if(J==K)continue;if(J==V){t[I]=q,t[I+1]=j,t[I+2]=Q,t[I+3]=$;continue}J==Z?(B>E?B-=n:0>B&&(B+=n),T>A?T-=e:0>T&&(T+=e)):(B>E?B=E:0>B&&(B=0),T>A?T=A:0>T&&(T=0))}G=T+B*e<<2,t[I]=P[G],t[I+1]=P[G+1],t[I+2]=P[G+2],t[I+3]=P[G+3]}return t},canRun:function(){return this._isOn&&(this._map||this.map)}})}(e),!function(t,e){var r,i=t.ImArray,a=t.ImArrayCopy,s=t.Util.Array.typed,l=t.CONST.PI,u=t.CONST.PI2,o=t.CONST.PI_2,c=t.MODE,h=(t.CONST.toRad,1.5*l),_=Math.sqrt,f=Math.atan2,m=Math.atan,p=Math.sin,d=Math.cos,v=Math.floor,g=Math.round,N=Math.asin,b=Math.tan,w=(Math.abs,Math.max),A=t.GeometricMapFilter=t.Class(t.Filter,{name:"GeometricMapFilter",constructor:function(t){var e=this;e.$super("constructor"),t&&e.generic(t)},path:n,_map:null,_mapName:null,inverseTransform:null,matrix:null,centerX:0,centerY:0,dx:0,dy:0,angle:0,radius:0,wavelength:0,amplitude:0,phase:0,xAmplitude:0,yAmplitude:0,xWavelength:0,yWavelength:0,mode:c.CLAMP,dispose:function(){var t=this;return t.$super("dispose"),t._map=null,t._mapName=null,t.inverseTransform=null,t.matrix=null,t.centerX=null,t.centerY=null,t.dx=null,t.dy=null,t.angle=null,t.radius=null,t.wavelength=null,t.amplitude=null,t.phase=null,t.xAmplitude=null,t.yAmplitude=null,t.xWavelength=null,t.yWavelength=null,t.mode=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_mapName:t._mapName,inverseTransform:t.inverseTransform?t.inverseTransform.toString():null,matrix:t.matrix,centerX:t.centerX,centerY:t.centerY,dx:t.dx,dy:t.dy,angle:t.angle,radius:t.radius,wavelength:t.wavelength,amplitude:t.amplitude,phase:t.phase,xAmplitude:t.xAmplitude,yAmplitude:t.yAmplitude,xWavelength:t.xWavelength,yWavelength:t.yWavelength,mode:t.mode}}},unserialize:function(e){var n,i=this;return e&&i.name===e.filter&&(i._isOn=!!e._isOn,n=e.params,i.inverseTransform=null,i.matrix=s(n.matrix,Array),i.centerX=n.centerX,i.centerY=n.centerY,i.dx=n.dx,i.dy=n.dy,i.angle=n.angle,i.radius=n.radius,i.wavelength=n.wavelength,i.amplitude=n.amplitude,i.phase=n.phase,i.xAmplitude=n.xAmplitude,i.yAmplitude=n.yAmplitude,i.xWavelength=n.xWavelength,i.yWavelength=n.yWavelength,i.mode=n.mode,n.inverseTransform&&(i.inverseTransform=new Function("FILTER",'"use strict"; return '+n.inverseTransform)(t)),i._mapName=n._mapName,i._map=null,i._mapName&&r[i._mapName]&&(i._map=r[i._mapName])),i},generic:function(t){var e=this;return t&&(e.inverseTransform=t,e._mapName="generic",e._map=r.generic),e},affine:function(t){var e=this;return t&&(e.matrix=t,e._mapName="affine",e._map=r.affine),e},flipX:function(){var t=this;return t._mapName="flipX",t._map=r.flipX,t},flipY:function(){var t=this;return t._mapName="flipY",t._map=r.flipY,t},flipXY:function(){var t=this;return t._mapName="flipXY",t._map=r.flipXY,t},rotateCW:function(){var t=this;return t._mapName="rotateCW",t._map=r.rotateCW,t},rotateCCW:function(){var t=this;return t._mapName="rotateCCW",t._map=r.rotateCCW,t},polar:function(t,e){var n=this;return n.centerX=t||0,n.centerY=e||0,n._mapName="polar",n._map=r.polar,n},cartesian:function(t,e){var n=this;return n.centerX=t||0,n.centerY=e||0,n._mapName="cartesian",n._map=r.cartesian,n},twirl:function(t,e,n,i){var a=this;return a.angle=t||0,a.radius=e||0,a.centerX=n||0,a.centerY=i||0,a._mapName="twirl",a._map=r.twirl,a},sphere:function(t,e,n){var i=this;return i.radius=t||0,i.centerX=e||0,i.centerY=n||0,i._mapName="sphere",i._map=r.sphere,i},ripple:function(t,n,i,a,s,l){var u=this;return u.radius=t!==e?t:50,u.centerX=s||0,u.centerY=l||0,u.wavelength=n!==e?n:16,u.amplitude=i!==e?i:10,u.phase=a||0,u._mapName="ripple",u._map=r.ripple,u},shift:function(t,n){var i=this;return i.dx=t!==e?t:0,i.dy=n!==e?n:i.dx,i._mapName="shift",i._map=r.shift,i},reset:function(){var t=this;return t._mapName=null,t._map=null,t},getMap:function(){return this._map},setMap:function(t){var e=this;return e._mapName=null,e._map=t,e},_apply:function(t,e,n,r){var i=this;return i._isOn&&i._map?i._map(i,t,e,n,r):t},canRun:function(){return this._isOn&&this._map}});A.prototype.translate=A.prototype.shift,r={generic:function(t,e,n,r){var a,s,l,u,o,h,_,f=e.length,m=new i(f),p=t.inverseTransform,d=t.mode,v=c.CLAMP,g=c.WRAP;for(a=0,s=0,l=0;f>l;l+=4,a++){if(a>=n&&(a=0,s++),o=p([a,s],n,r),h=~~o[0],_=~~o[1],0>h||h>=n||0>_||_>=r)switch(d){case g:_>=r?_-=r:0>_&&(_+=r),h>=n?h-=n:0>h&&(h+=n);break;case v:default:_>=r?_=r-1:0>_&&(_=0),h>=n?h=n-1:0>h&&(h=0)}u=h+_*n<<2,m[l]=e[u],m[l+1]=e[u+1],m[l+2]=e[u+2],m[l+3]=e[u+3]}return m},affine:function(t,e,n,r){var a,s,l,u,o,h,_,f,m,p=e.length,d=p>>2,v=new i(p),g=t.matrix,N=g[0],b=g[1],w=g[3],A=g[4],E=g[2],C=g[5],y=t.mode,x=c.CLAMP,L=c.WRAP,R=n-1,M=d-n;for(a=0,s=0,o=C*n,h=w*n,_=A*n,l=0;p>l;l+=4,a++){if(a>=n&&(a=0,s++),f=~~(N*a+b*s+E),m=~~(h*a+_*s+o),0>f||f>R||0>m||m>M)switch(y){case L:m>M?m-=d:0>m&&(m+=d),f>=n?f-=n:0>f&&(f+=n);break;case x:default:m>M?m=M:0>m&&(m=0),f>R?f=R:0>f&&(f=0)}u=f+m<<2,v[l]=e[u],v[l+1]=e[u+1],v[l+2]=e[u+2],v[l+3]=e[u+3]}return v},shift:function(t,e,n,r){var a,s,l,u,o,c=e.length,h=new i(c),_=-t.dx,f=-t.dy;for(0>_&&(_+=n),0>f&&(f+=r),a=0,s=0,l=0,u=0;c>u;u+=4,a++)a>=n&&(a=0,s++,l+=n),o=(a+_)%n+(s+f)%r*n<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},flipX:function(t,e,n,r){var a,s,l,u,o,c=e.length,h=new i(c);for(a=0,s=0,l=0,u=0;c>u;u+=4,a++)a>=n&&(a=0,s++,l+=n),o=n-1-a+l<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},flipY:function(t,e,n,r){var a,s,l,u,o,c=e.length,h=new i(c);for(a=0,s=0,l=(r-1)*n,u=0;c>u;u+=4,a++)a>=n&&(a=0,s++,l-=n),o=a+l<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},flipXY:function(t,e,n,r){var a,s,l,u,o,c,h=e.length,_=new i(h);for(a=0,s=0,u=(r-1)*n,o=0;h>o;o+=4,a++)a>=n&&(a=0,s++,l+=n,u-=n),c=n-1-a+u<<2,_[o]=e[c],_[o+1]=e[c+1],_[o+2]=e[c+2],_[o+3]=e[c+3];return _},rotateCW:function(t,e,n,r){var a,s,l,u,o,c=e.length,h=new i(c),_=c>>2;for(a=0,s=0,l=_-1,u=0;c>u;u+=4,a++,l-=n)a>=n&&(a=0,l=_-1,s++),o=s+l<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},rotateCCW:function(t,e,n,r){var a,s,l,u,o,c=e.length,h=new i(c);for(a=0,s=0,l=0,u=0;c>u;u+=4,a++,l+=n)a>=n&&(a=0,l=0,s++),o=n-1-s+l<<2,h[u]=e[o],h[u+1]=e[o+1],h[u+2]=e[o+2],h[u+3]=e[o+3];return h},twirl:function(t,e,n,r){if(0>=t.radius)return e;var i,s,l,u,o,h,m,g,N=e.length,b=new a(e),w=t.centerX,A=t.centerY,E=t.angle,C=t.radius,y=t.mode,x=c.CLAMP,L=c.WRAP,R=E/C,M=n-1,O=r-1;for(w=v(w*(n-1)),A=v(A*(r-1)),i=0,s=0,l=0;N>l;l+=4,i++)if(i>=n&&(i=0,s++),h=i-w,m=s-A,o=_(h*h+m*m),C>o){if(g=f(m,h)+R*(C-o),h=~~(w+o*d(g)),m=~~(A+o*p(g)),0>h||h>M||0>m||m>O)switch(y){case L:m>O?m-=r:0>m&&(m+=r),h>M?h-=n:0>h&&(h+=n);break;case x:default:m>O?m=O:0>m&&(m=0),h>M?h=M:0>h&&(h=0)}u=h+m*n<<2,e[l]=b[u],e[l+1]=b[u+1],e[l+2]=b[u+2],e[l+3]=b[u+3]}return e},sphere:function(t,e,n,r){if(0>=t.radius)return e;var i,s,l,u,o,h,f,m,p,d,g,w,A,E=e.length,C=new a(e),y=t.centerX,x=t.centerY,L=t.radius,R=t.mode,M=c.CLAMP,O=c.WRAP,H=L*L,k=.555556,I=1-k,G=n-1,Y=r-1;for(y=v(y*(n-1)),x=v(x*(r-1)),i=0,s=0,l=0;E>l;l+=4,i++)if(i>=n&&(i=0,s++),o=i-y,h=s-x,w=o*o,A=h*h,f=w+A,H>f){if(d=H-f,g=_(d),m=N(o/_(w+d))*I,p=N(h/_(A+d))*I,o=~~(i-g*b(m)),h=~~(s-g*b(p)),0>o||o>G||0>h||h>Y)switch(R){case O:h>Y?h-=r:0>h&&(h+=r),o>G?o-=n:0>o&&(o+=n);break;case M:default:h>Y?h=Y:0>h&&(h=0),o>G?o=G:0>o&&(o=0)}u=o+h*n<<2,e[l]=C[u],e[l+1]=C[u+1],e[l+2]=C[u+2],e[l+3]=C[u+3]}return e},ripple:function(t,e,n,r){if(0>=t.radius)return e;var i,s,l,u,o,h,f,m,d,g,N,b=e.length,w=new a(e),A=c.CLAMP,E=c.WRAP,C=n-1,y=r-1,x=t.centerX,L=t.centerY,R=t.radius,M=t.mode,O=R*R,H=t.wavelength,k=t.amplitude,I=t.phase;for(x=v(x*(n-1)),L=v(L*(r-1)),i=0,s=0,l=0;b>l;l+=4,i++)if(i>=n&&(i=0,s++),h=i-x,f=s-L,g=h*h,N=f*f,d=g+N,O>d){if(o=_(d),m=k*p(o/H*Math.PI*2-I),m*=(R-o)/R,o&&(m*=H/o),h=~~(i+h*m),f=~~(s+f*m),0>h||h>C||0>f||f>y)switch(M){case E:f>y?f-=r:0>f&&(f+=r),h>C?h-=n:0>h&&(h+=n);break;case A:default:f>y?f=y:0>f&&(f=0),h>C?h=C:0>h&&(h=0)}u=h+f*n<<2,e[l]=w[u],e[l+1]=w[u+1],e[l+2]=w[u+2],e[l+3]=w[u+3]}return e},polar:function(t,e,n,r){var i,s,f,p,d,v,N,b,A,E,C,y,x=e.length,L=new a(e),R=c.CLAMP,M=c.WRAP,O=n-1,H=r-1,k=0,I=t.mode;for(C=~~(.5*n+.5),y=~~(.5*r+.5),E=w(y,C),i=0,s=0,f=0;x>f;f+=4,i++){if(i>=n&&(i=0,s++),
p=i-C,d=s-y,A=0,p>=0?d>0?(A=l-m(p/d),k=_(p*p+d*d)):0>d?(A=m(p/d),k=_(p*p+d*d)):(A=o,k=p):0>p&&(0>d?(A=u-m(p/d),k=_(p*p+d*d)):d>0?(A=l+m(p/d),k=_(p*p+d*d)):(A=h,k=-p)),v=n-1-(n-1)/u*A,N=r*k/E,v=g(v),N=g(N),0>v||v>O||0>N||N>H)switch(I){case M:N>H?N-=r:0>N&&(N+=r),v>O?v-=n:0>v&&(v+=n);break;case R:default:N>H?N=H:0>N&&(N=0),v>O?v=O:0>v&&(v=0)}b=v+N*n<<2,e[f]=L[b],e[f+1]=L[b+1],e[f+2]=L[b+2],e[f+3]=L[b+3]}return e},cartesian:function(t,e,n,r){var i,s,_,f,m,v,N,b,A,E,C,y,x,L=e.length,R=new a(e),M=c.CLAMP,O=c.WRAP,H=n-1,k=r-1,I=0,G=t.mode;for(y=~~(.5*n+.5),x=~~(.5*r+.5),C=w(x,y),i=0,s=0,_=0;L>_;_+=4,i++){if(i>=n&&(i=0,s++),A=i/n*u,E=A>=h?u-A:A>=l?A-l:A>=o?l-A:A,I=C*(s/r),N=-I*p(E),b=I*d(E),A>=h?(f=y-N,m=x-b):A>=l?(f=y-N,m=x+b):A>=o?(f=y+N,m=x+b):(f=y+N,m=x-b),f=g(f),m=g(m),0>f||f>H||0>m||m>k)switch(G){case O:m>k?m-=r:0>m&&(m+=r),f>H?f-=n:0>f&&(f+=n);break;case M:default:m>k?m=k:0>m&&(m=0),f>H?f=H:0>f&&(f=0)}v=f+m*n<<2,e[_]=R[v],e[_+1]=R[v+1],e[_+2]=R[v+2],e[_+3]=R[v+3]}return e}}}(e),!function(t,e){function r(t,e,n,r){var i,a=t.length,s=new C(t.length);for(n=n||1,r=r||1,i=0;a>i;)s[i]=n*t[i]+r*e[i],i++;return s}function i(t,e){var n,r,i,a=t.length,s=[],l=0;for(n=0;a>n;n++)for(r=0;a>r;r++)i=t[n]*e[r],l+=i,s.push(i);return{kernel:s,sum:l}}function a(t){var e,n=new Array(t);for(e=0;t>e;)n[e]=1,e++;return n}function s(t){var e,n,r,i,a=L.length;if(t--,a>t)e=new C(L[t]);else for(e=new C(L[a-1]);t>=a;){for(n=e,e=new C(n.length+1),e[0]=1,r=0,i=n.length-1;i>r;r++)e[r+1]=n[r]+n[r+1];e[n.length]=1,40>a&&L.push(new Array(e)),a++}return e}function l(t){var e,n=t>>1,r=-n,i=new Array(t);for(e=0;t>e;)i[e]=r,r++,e++;return i}function u(t){var e=s(t);return i(e,e)}function o(t,e){var n=s(t),r=l(t);return 1==e?i(r.reverse(),n):i(n,r)}function c(t,e){var n=a(t),r=l(t);return 1==e?i(r.reverse(),n):i(n,r)}function h(t,e,n){e=e||1,n=n||e;var r,i=t*t,a=i>>1,s=new C(i);for(r=0;i>r;)s[r]=e,r++;return s[a]=n,s}function _(t,e,n,r){var i,a,s,l,u,o=t*t,c=t>>1,h=o>>1,_=new C(o);for(l=0,i=0;c>=i;i++){for(a=0,u=0,s=0;c>=s;s++)_[h+i+a]=l+u,_[h-i-a]=-l-u,_[h-i+a]=-l+u,_[h+i-a]=l-u,a+=t,u+=n;l+=e}return _[h]=r||1,_}function f(t,e,n,r){var i,a,s,l,u,o,c=t*t,h=t>>1,_=c>>1,f=new C(c),m=new C(c),d=1/t,v=1e-8;for(p(e)>v?(u=1,o=n/e):(u=e/n,o=1),i=0,s=0,l=0,a=o*t;h>=i;)m[_+i]=~~(_+s+l+.5),m[_-i]=~~(_-s-l+.5),i++,s+=u,l+=a;for(i=0;h>=i;)f[m[_+i]]=f[m[_-i]]=d,i++;return f[_]=r||1,f}var m=(t.CONST.SQRT2,t.CONST.toRad),p=(t.CONST.toDeg,Math.abs),d=Math.sqrt,v=Math.sin,g=Math.cos,N=t.Util.Array.typed,b=t.Util.Filter,w=t._notSupportClamp,A=b.integral_convolution,E=b.separable_convolution,C=t.Array32F,y=t.ImArray,x=(t.Array32F,t.Array16I),L=(t.Array8U,[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]]),R=t.ConvolutionMatrixFilter=t.Class(t.Filter,{name:"ConvolutionMatrixFilter",constructor:function(t,e,n,r){var i=this;i.$super("constructor"),i._coeff=new C([1,0]),t&&t.length?i.set(t,~~(d(t.length)+.5),e||1,n||0):(i._matrix=null,i._dim=0),i._matrix2=null,i._dim2=0,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._rgba=!!r},path:n,_dim:0,_dim2:0,_matrix:null,_matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,_rgba:!1,_webglInstance:null,dispose:function(){var t=this;return t.$super("dispose"),t._webglInstance=null,t._dim=null,t._dim2=null,t._matrix=null,t._matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t._rgba=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_dim:t._dim,_dim2:t._dim2,_matrix:t._matrix,_matrix2:t._matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2,_rgba:t._rgba}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._dim2=e._dim2,n._matrix=N(e._matrix,C),n._matrix2=N(e._matrix2,C),n._mat=N(e._mat,C),n._mat2=N(e._mat2,C),n._coeff=N(e._coeff,C),n._isGrad=e._isGrad,n._doIntegral=e._doIntegral,n._doSeparable=e._doSeparable,n._indices=N(e._indices,x),n._indices2=N(e._indices2,x),n._indicesf=N(e._indicesf,x),n._indicesf2=N(e._indicesf2,x),n._rgba=e._rgba),n},rgba:function(t){var e=this;return arguments.length?(e._rgba=!!t,e):e._rgba},lowPass:function(t){return t=t===e?3:t%2?t:t+1,this.set(h(t),t,1/(t*t),0),this._doIntegral=1,this},highPass:function(t,n){t=t===e?3:t%2?t:t+1,n=n===e?1:n;var r=t*t,i=-n/r,a=h(t,i,1+i);return this.set(a,t,1,0),this._doIntegral=1,this},glow:function(t,n){return t=t===e?.5:t,this.highPass(n,-t)},sharpen:function(t,n){return t=t===e?.5:t,this.highPass(n,t)},verticalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(a(t),1,1/t,0),this._dim2=t,this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:t%2?t:t+1,this.set(a(t),t,1/t,0),this._dim2=1,this._doIntegral=1,this},directionalBlur:function(t,n){n=n===e?3:n%2?n:n+1,t*=m;var r=g(t),i=-v(t),a=f(n,r,i,1/n);return this.set(a,n,1,0)},fastGauss:function(t,n){return n=n===e?3:n%2?n:n+1,t=~~(t||1),1>t?t=1:t>3&&(t=3),this.set(h(n),n,1/(n*n),0),this._doIntegral=t,this},binomialLowPass:function(t){t=t===e?3:t%2?t:t+1;var n=s(t),r=1<<t-1,i=1/r;this.set(n,t,i,i),this._matrix2=new C(n);var a=this._computeIndices(this._matrix2,this._dim2);return this._indices2=a[0],this._indicesf2=a[1],this._mat2=a[2],this._doSeparable=!0,this},binomialHighPass:function(t){t=t===e?3:t%2?t:t+1;var n=u(t);return this.set(r(h(t),new C(n.kernel),1,-1/n.sum),t,1,0)},prewittX:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,0);return this.set(n.kernel,t,1,0)},prewittY:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,1);return this.set(n.kernel,t,1,0)},prewittDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=m;var i=g(t),a=v(t),s=c(n,0),l=c(n,1);return this.set(r(new C(s.kernel),new C(l.kernel),i,a),n,1,0)},prewitt:function(t){t=t===e?3:t%2?t:t+1;var n=c(t,0),r=c(t,1);this.set(n.kernel,t,1,0),this._isGrad=!0,this._matrix2=new C(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this},sobelX:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,0);return this.set(n.kernel,t,1,0)},sobelY:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,1);return this.set(n.kernel,t,1,0)},sobelDirectional:function(t,n){n=n===e?3:n%2?n:n+1,t*=m;var i=g(t),a=v(t),s=o(n,0),l=o(n,1);return this.set(r(new C(s.kernel),new C(l.kernel),i,a),n,1,0)},sobel:function(t){t=t===e?3:t%2?t:t+1;var n=o(t,0),r=o(t,1);this.set(n.kernel,t,1,0),this._matrix2=new C(r.kernel);var i=this._computeIndices(this._matrix2,this._dim2);return this._indices2=i[0],this._indicesf2=i[1],this._mat2=i[2],this._isGrad=!0,this},laplace:function(t){t=t===e?3:t%2?t:t+1;var n=t*t,r=h(t,-1,n-1);return this.set(r,t,1,0),this._doIntegral=1,this},emboss:function(t,n,r){r=r===e?3:r%2?r:r+1,t=t===e?-.25*Math.PI:t*m,n=n||1;var i=n*g(t),a=-n*v(t),s=_(r,i,a,1);return this.set(s,r,1,0)},edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,r){var i=this;i._matrix2=null,i._dim2=0,i._indices2=i._indicesf2=null,i._mat2=null,i._isGrad=!1,i._doIntegral=0,i._doSeparable=!1,i._matrix=new C(t),i._dim=e,i._coeff[0]=n||1,i._coeff[1]=r||0;var a=i._computeIndices(i._matrix,i._dim);return i._indices=a[0],i._indicesf=a[1],i._mat=a[2],i},_computeIndices:function(t,e){var n,r,i,a=[],s=[],l=[],u=t.length,o=e,c=o>>1;for(r=0,i=0,n=0;u>n;)s.push(r-c),s.push(i-c),t[n]&&(a.push(r-c),a.push(i-c),l.push(t[n])),n++,r++,r>=o&&(r=0,i++);return[new x(a),new x(s),new C(l)]},reset:function(){var t=this;return t._matrix=t._matrix2=null,t._mat=t._mat2=null,t._dim=t._dim2=0,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},combineWith:function(t){return this},getMatrix:function(){return this._matrix},setMatrix:function(t,e){return this.set(t,e)},_apply:function(t,e,n){var r=this,i=r._rgba;if(!r._isOn||!r._matrix)return t;if(r._doIntegral)return r._matrix2?A(i,t,e,n,r._matrix,r._matrix2,r._dim,r._dim2,r._coeff[0],r._coeff[1],r._doIntegral):A(i,t,e,n,r._matrix,null,r._dim,r._dim,r._coeff[0],r._coeff[1],r._doIntegral);if(r._doSeparable)return E(i,t,e,n,r._mat,r._mat2,r._indices,r._indices2,r._coeff[0],r._coeff[1]);var a,s,l,u,o,c,h,_,f,m,d,v,g,N,b,C,L,R,M,O,H,k,I,G,Y,F=t.length,X=F>>2,P=new y(F),T=e-1,B=X-e,z=r._coeff[0],S=r._coeff[1],U=r._matrix,W=r._matrix2,D=r._isGrad;if(W){for(I=r._indicesf.length,Y=new x(r._indicesf),h=0;I>h;h+=2)Y[h+1]*=e;for(G=U.length,_=0,f=0,o=0;F>o;o+=4,_++){for(_>=e&&(_=0,f+=e),g=N=b=C=L=R=M=O=0,h=0,c=0;G>h;h++,c+=2)m=_+Y[c],d=f+Y[c+1],m>=0&&T>=m&&d>=0&&B>=d&&(v=m+d<<2,H=U[h],g+=t[v]*H,N+=t[v+1]*H,b+=t[v+2]*H,C+=t[v+3]*H,k=W[h],L+=t[v]*k,R+=t[v+1]*k,M+=t[v+2]*k,O+=t[v+3]*k);D?(a=p(g)+p(L),s=p(N)+p(R),l=p(b)+p(M)):(a=z*g+S*L,s=z*N+S*R,l=z*b+S*M),w&&(a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l),P[o]=~~a,P[o+1]=~~s,P[o+2]=~~l,i?(u=D?p(C)+p(O):z*C+S*O,w&&(u=0>u?0:u>255?255:u),P[o+3]=~~u):P[o+3]=t[o+3]}}else{for(I=r._indices.length,Y=new x(r._indices),h=0;I>h;h+=2)Y[h+1]*=e;for(U=r._mat,G=U.length,_=0,f=0,o=0;F>o;o+=4,_++){for(_>=e&&(_=0,f+=e),g=N=b=C=0,h=0,c=0;G>h;h++,c+=2)m=_+Y[c],d=f+Y[c+1],m>=0&&T>=m&&d>=0&&B>=d&&(v=m+d<<2,H=U[h],g+=t[v]*H,N+=t[v+1]*H,b+=t[v+2]*H,C+=t[v+3]*H);a=z*g+S,s=z*N+S,l=z*b+S,w&&(a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,l=0>l?0:l>255?255:l),P[o]=~~a,P[o+1]=~~s,P[o+2]=~~l,i?(u=z*C+S,w&&(u=0>u?0:u>255?255:u),P[o+3]=~~u):P[o+3]=t[o+3]}}return P},canRun:function(){return this._isOn&&this._matrix}});R.prototype.bump=R.prototype.emboss,R.prototype.boxBlur=R.prototype.lowPass,R.prototype.gaussBlur=R.prototype.binomialLowPass,R.prototype.gradX=R.prototype.prewittX,R.prototype.gradY=R.prototype.prewittY,R.prototype.gradDirectional=R.prototype.prewittDirectional,R.prototype.grad=R.prototype.prewitt}(e),!function(t,e){var r,i=t.ImArray,a=t.Array8U,s=t.Array32I,l=Math.sqrt,u=t.Util.Array.typed,o=function(t){var e,n=t*t,r=new a(n);for(e=0;n>e;e++)r[e]=1;return r},c=o(3);t.MorphologicalFilter=t.Class(t.Filter,{name:"MorphologicalFilter",constructor:function(){var t=this;t.$super("constructor"),t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null},path:n,_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var t=this;return t.$super("dispose"),t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._structureElement=u(e._structureElement,a),n._indices=u(e._indices,s),n._filterName=e._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName])),n},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},set:function(t,e){var n=this;n._filterName=e,n._filter=r[e],t&&t.length?(n._structureElement=new a(t),n._dim=~~(l(n._structureElement.length)+.5)):t&&t===t-0?(n._structureElement=o(t),n._dim=t):(n._structureElement=c,n._dim=3);var i,u,h,_=[],t=n._structureElement,f=t.length,m=n._dim,p=m>>1;for(u=0,h=0,i=0;f>i;)t[i]&&(_.push(u-p),_.push(h-p)),i++,u++,u>=m&&(u=0,h++);return n._indices=new s(_),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null,t},_apply:function(t,e,n){var r=this;return r._isOn&&r._dim&&r._filter?r._filter(r,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}});r={dilate:function(t,e,n,r){var a,l,u,o,c,h,_,f,m,p,d,v,g,N,b=t._structureElement,w=(b.length,t._dim,new s(t._indices)),A=e.length,E=A>>2,C=new i(A),y=w.length,x=y>>1,L=n-1,R=E-n;for(u=0;y>u;u+=2)w[u+1]*=n;for(o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=0,g=0,N=0,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],m>v&&(v=m),p>g&&(g=p),d>N&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}return C},erode:function(t,e,n,r){var a,l,u,o,c,h,_,f,m,p,d,v,g,N,b=t._structureElement,w=(b.length,t._dim,new s(t._indices)),A=e.length,E=A>>2,C=new i(A),y=w.length,x=y>>1,L=n-1,R=E-n;for(u=0;y>u;u+=2)w[u+1]*=n;for(o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,N=255,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),N>d&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}return C},open:function(t,e,n,r){var a,l,u,o,c,h,_,f,m,p,d,v,g,N,b=t._structureElement,w=(b.length,t._dim,new s(t._indices)),A=e.length,E=A>>2,C=new i(A),y=w.length,x=y>>1,L=n-1,R=E-n;for(u=0;y>u;u+=2)w[u+1]*=n;for(o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,N=255,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),N>d&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}for(e=C,C=new i(A),o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,N=255,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),N>d&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}return C},close:function(t,e,n,r){var a,l,u,o,c,h,_,f,m,p,d,v,g,N,b=t._structureElement,w=(b.length,t._dim,new s(t._indices)),A=e.length,E=A>>2,C=new i(A),y=w.length,x=y>>1,L=n-1,R=E-n;for(u=0;y>u;u+=2)w[u+1]*=n;for(o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,N=255,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),N>d&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}for(e=C,C=new i(A),o=0,c=0,a=0;A>a;a+=4,o++){for(o>=n&&(o=0,c+=n),v=255,g=255,N=255,l=0;x>l;l+=2)h=o+w[l],_=c+w[l+1],h>=0&&L>=h&&_>=0&&R>=_&&(f=h+_<<2,m=e[f],p=e[f+1],d=e[f+2],v>m&&(v=m),g>p&&(g=p),N>d&&(N=d));C[a]=v,C[a+1]=g,C[a+2]=N,C[a+3]=e[a+3]}return C}}}(e),!function(t,e){var r,i=t.ImArray,a=t.Array32I,s=t.Util.Array.typed,l=(Math.min,Math.max,t.StatisticalFilter=t.Class(t.Filter,{name:"StatisticalFilter",constructor:function(){var t=this;t.$super("constructor"),t._dim=0,t._indices=null,t._filterName=null,t._filter=null},path:n,_dim:0,_indices:null,_filter:null,_filterName:null,dispose:function(){var t=this;return t.$super("dispose"),t._dim=null,t._indices=null,t._filter=null,t._filterName=null,t},serialize:function(){var t=this;return{filter:t.name,_isOn:!!t._isOn,params:{_filterName:t._filterName,_dim:t._dim,_indices:t._indices}}},unserialize:function(t){var e,n=this;return t&&n.name===t.filter&&(n._isOn=!!t._isOn,e=t.params,n._dim=e._dim,n._indices=s(e._indices,a),n._filterName=e._filterName,n._filterName&&r[n._filterName]&&(n._filter=r[n._filterName])),n},median:function(t){return this.set(null==t?3:1&t?t:t+1,"median")},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,"minimum")},maximum:function(t){return this.set(null==t?3:1&t?t:t+1,"maximum")},set:function(t,e){var n=this;n._filterName=e,n._filter=r[e],n._dim=t;var i,s,l,u=[],o=t*t,c=t,h=c>>1;for(s=0,l=0,i=0;o>i;)u.push(s-h),u.push(l-h),i++,s++,s>=c&&(s=0,l++);return n._indices=new a(u),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._indices=null,t},_apply:function(t,e,n){var r=this;return r._isOn&&r._dim?r._filter(r,t,e,n):t},canRun:function(){return this._isOn&&this._dim}}));l.prototype.erode=l.prototype.minimum,l.prototype.dilate=l.prototype.maximum,r={median:function(t,e,n,r){var s,l,u,o,c,h,_,f,m,p,d,v,g,N,b,w,A,E,C=t._dim,y=C*C,x=new a(t._indices),L=e.length,R=L>>2,M=new i(L),O=y<<1,H=n-1,k=R-n;for(f=[],m=[],p=[],l=0;O>l;l+=2)x[l+1]*=n;for(s=0,u=0,o=0;L>s;){for(f.length=0,m.length=0,p.length=0,l=0;O>l;)c=u+x[l],h=o+x[l+1],c>=0&&H>=c&&h>=0&&k>=h&&(_=c+h<<2,d=e[_],v=e[_+1],g=e[_+2],f.push(d),m.push(v),p.push(g)),l+=2;f.sort(),m.sort(),p.sort(),A=f.length,E=A>>>1,N=1&A?f[E]:~~(.5*f[E-1]+.5*f[E]),b=1&A?m[E]:~~(.5*m[E-1]+.5*m[E]),w=1&A?p[E]:~~(.5*p[E-1]+.5*p[E]),M[s]=N,M[s+1]=b,M[s+2]=w,M[s+3]=e[s+3],s+=4,u++,u>=n&&(u=0,o+=n)}return M},maximum:function(t,e,n,r){var s,l,u,o,c,h,_,f,m,p,d,v,g,N=t._dim,b=N*N,w=new a(t._indices),A=e.length,E=A>>2,C=new i(A),y=b<<1,x=n-1,L=E-n;for(l=0;y>l;l+=2)w[l+1]*=n;for(s=0,u=0,o=0;A>s;){for(d=0,v=0,g=0,l=0;y>l;)c=u+w[l],h=o+w[l+1],c>=0&&x>=c&&h>=0&&L>=h&&(_=c+h<<2,f=e[_],m=e[_+1],p=e[_+2],f>d&&(d=f),m>v&&(v=m),p>g&&(g=p)),l+=2;C[s]=d,C[s+1]=v,C[s+2]=g,C[s+3]=e[s+3],s+=4,u++,u>=n&&(u=0,o+=n)}return C},minimum:function(t,e,n,r){var s,l,u,o,c,h,_,f,m,p,d,v,g,N=t._dim,b=N*N,w=new a(t._indices),A=e.length,E=A>>2,C=new i(A),y=b<<1,x=n-1,L=E-n;for(l=0;y>l;l+=2)w[l+1]*=n;for(s=0,u=0,o=0;A>s;){for(d=255,v=255,g=255,l=0;y>l;)c=u+w[l],h=o+w[l+1],c>=0&&x>=c&&h>=0&&L>=h&&(_=c+h<<2,f=e[_],m=e[_+1],p=e[_+2],d>f&&(d=f),v>m&&(v=m),g>p&&(g=p)),l+=2;C[s]=d,C[s+1]=v,C[s+2]=g,C[s+3]=e[s+3],s+=4,u++,u>=n&&(u=0,o+=n)}return C}}}(e),e});
/**
*
*   FILTER.js Plugins
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,r){"use strict";"object"==typeof module&&module.exports?module.exports=r.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(n,t){return r.moduleUri=n.uri,r.call(e,t),t}):(r.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(r){"use strict";var n=r.getPath(e.moduleUri);return!function(e){var r=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,r){var n=this;n.min=e||-127,n.max=r||127},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{min:e.min,max:e.max}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.min=r.min,n.max=r.max),n},apply:function(e,n,a){var i=this;if(!i._isOn)return e;var s,o,l,u,h,c,f,d,p=i.max-i.min,_=i.min,m=e.length;if(r)for(s=0;m>s;s+=4)l=e[s],u=e[s+1],h=e[s+2],o=p*t()+_,c=l+o,f=u+o,d=h+o,0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),0>d?d=0:d>255&&(d=255),e[s]=~~c,e[s+1]=~~f,e[s+2]=~~d;else for(s=0;m>s;s+=4)l=e[s],u=e[s+1],h=e[s+2],o=p*t()+_,c=l+o,f=u+o,d=h+o,e[s]=~~c,e[s+1]=~~f,e[s+2]=~~d;return e}})}(r),!function(e){var r=e.Util.Image.perlin;e.Create({name:"PerlinNoiseFilter",_baseX:1,_baseY:1,_octaves:1,_offsets:null,_colors:!1,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:n,init:function(e,r,n,t,a,i,s,o){var l=this;l._baseX=e||1,l._baseY=r||1,l._seed=s||0,l._stitch=!!t,l._fractal=!1!==a,l._perlin=!!o,l.octaves(n||1,i)},seed:function(e){var r=this;return r._seed=e||0,r},octaves:function(e,r){var n=this;for(n._octaves=e||1,n._offsets=r?r.slice(0):[];n._offsets.length<n._octaves;)n._offsets.push([0,0]);return n},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},colors:function(e){return arguments.length||(e=!0),this._colors=!!e,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_seed:e._seed||0,_stitch:e._stitch,_colors:e._colors,_fractal:e._fractal,_perlin:e._perlin}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n._baseX=r._baseX,n._baseY=r._baseY,n._octaves=r._octaves,n._offsets=r._offsets,n._seed=r._seed||0,n._stitch=r._stitch,n._colors=r._colors,n._fractal=r._fractal,n._perlin=r._perlin),n},apply:function(e,n,t){var a=this;return a._isOn&&r?(a._seed&&(r.seed(a._seed),a._seed=0),r(e,n,t,a._stitch,!a._colors,a._baseX,a._baseY,a._octaves,a._offsets,1,.5,a._perlin)):e}})}(r),!function(e,r){var t=e.Util.Image,a=e.Util.Array.typed;e.Create({name:"GradientFilter",colors:null,stops:null,angle:0,path:n,init:function(e,r,n){var t=this;t.setColors(e,r),t.angle=n||0},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.angle=null,e.$super("dispose"),e},setColors:function(e,r){var n=this;if(e&&e.length){var a=t.colors_stops(e,r);n.colors=a[0],n.stops=a[1]}return n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{angle:e.angle,colors:e.colors,stops:e.stops}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.angle=r.angle,n.colors=a(r.colors,Array),n.stops=a(r.stops,Array)),n},apply:function(e,r,n){var a=this;return a._isOn&&a.colors?t.gradient(e,r,n,a.colors,a.stops,a.angle,t.lerp):e}}),e.Create({name:"RadialGradientFilter",colors:null,stops:null,centerX:0,centerY:0,radiusX:1,radiusY:1,init:function(e,r,n,t,a,i){var s=this;s.setColors(e,r),s.centerX=n||0,s.centerY=t||0,s.radiusX=a||1,s.radiusY=i||1},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.centerX=null,e.centerY=null,e.radiusX=null,e.radiusY=null,e.$super("dispose"),e},setColors:function(e,r){var n=this;if(e&&e.length){var a=t.colors_stops(e,r);n.colors=a[0],n.stops=a[1]}return n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radiusX:e.radiusX,radiusY:e.radiusY,colors:e.colors,stops:e.stops}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.centerX=r.centerX||0,n.centerY=r.centerY||0,n.radiusX=r.radiusX||1,n.radiusY=r.radiusY||1,n.colors=a(r.colors,Array),n.stops=a(r.stops,Array)),n},apply:function(e,r,n){var a=this;return a._isOn&&a.colors?t.radial_gradient(e,r,n,a.colors,a.stops,a.centerX,a.centerY,a.radiusX,a.radiusY,t.lerp):e}})}(r),!function(e){var r=(e._notSupportClamp,Math.min),t=Math.floor,a=e.CHANNEL.RED;e.CHANNEL.GREEN,e.CHANNEL.BLUE,e.CHANNEL.ALPHA;e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,path:n,init:function(e,r,n,t,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=r||a,s.dstChannel=n||a,s.centerX=t||0,s.centerY=i||0,e&&s.setSrc(e)},dispose:function(){var e=this;return e.srcImg=null,e._srcImg=null,e.$super("dispose"),e},setSrc:function(e){var r=this;return e&&(r.srcImg=e,r._srcImg=null),r},serialize:function(){var e=this,r=e.srcImg;return{filter:e.name,_isOn:!!e._isOn,params:{_srcImg:e._srcImg||(r?{data:r.getData(),width:r.width,height:r.height}:null),centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t.srcImg=null,t._srcImg=n._srcImg,t._srcImg&&(t._srcImg.data=e.Util.Array.typed(t._srcImg.data,e.ImArray)),t.centerX=n.centerX,t.centerY=n.centerY,t.srcChannel=n.srcChannel,t.dstChannel=n.dstChannel),t},apply:function(e,n,a){var i=this,s=i.srcImg;if(!i._isOn||!s&&!i._srcImg)return e;var o,l,u,h,c,f,d=i._srcImg||{data:s.getData(),width:s.width,height:s.height},p=d.data,_=d.width,m=d.height,g=e.length,y=(p.length,i.srcChannel),v=i.dstChannel,b=r(n,_),C=r(a,m),O=i.centerX||0,w=i.centerY||0,M=_>>1,I=m>>1;for(O=t(O*(n-1))-M,w=t(w*(a-1))-I,o=0,l=0,u=0,o=0;g>o;o+=4,l++)l>=n&&(l=0,u++),c=l-O,f=u-w,c>=0&&b>c&&f>=0&&C>f&&(h=c+f*_<<2,e[o+v]=p[h+y]);return e}})}(r),!function(e){var r=(e._notSupportClamp,Math.min),t=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,path:n,init:function(e,r,n){var t=this;t.centerX=r||0,t.centerY=n||0,t._alphaMask=null,t.alphaMask=null,e&&t.setMask(e)},dispose:function(){var e=this;return e.alphaMask=null,e._alphaMask=null,e.$super("dispose"),e},setMask:function(e){var r=this;return e&&(r.alphaMask=e,r._alphaMask=null),r},serialize:function(){var e=this,r=e.alphaMask;return{filter:e.name,_isOn:!!e._isOn,params:{_alphaMask:e._alphaMask||(r?{data:r.getData(),width:r.width,height:r.height}:null),centerX:e.centerX,centerY:e.centerY}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t.alphaMask=null,t._alphaMask=n._alphaMask,t._alphaMask&&(t._alphaMask.data=e.Util.Array.typed(t._alphaMask.data,e.ImArray)),t.centerX=n.centerX,t.centerY=n.centerY),t},apply:function(e,n,a){var i=this,s=i.alphaMask;if(!i._isOn||!s&&!i._alphaMask)return e;var o,l,u,h,c,f,d=i._alphaMask||{data:s.getData(),width:s.width,height:s.height},p=d.data,_=d.width,m=d.height,g=e.length,y=(p.length,r(n,_)),v=r(a,m),b=i.centerX||0,C=i.centerY||0,O=_>>1,w=m>>1;for(b=t(b*(n-1))-O,C=t(C*(a-1))-w,l=0,u=0,o=0;g>o;o+=4,l++)l>=n&&(l=0,u++),c=l-b,f=u-C,c>=0&&y>c&&f>=0&&v>f?(h=c+f*_<<2,e[o+3]=p[h+3]):e[o+3]=0;return e}})}(r),!function(e){var r=e._notSupportClamp,t=e.Array32F,a=Math.min,i=Math.max;e.Util.Array.subarray;e.Create({name:"HistogramEqualizeFilter",path:n,apply:function(e,n,s){var o=this;if(!o._isOn)return e;var l,u,h,c,f,d,p,_,m,g,y=0,v=255,b=e.length,C=b>>2,O=1/C;for(_=new t(256),g=0;b>g;g+=4)l=e[g],u=e[g+1],h=e[g+2],c=~~(0+.299*l+.587*u+.114*h),f=~~(128-.168736*l-.331264*u+.5*h),d=~~(128+.5*l-.418688*u-.081312*h),d=0>d?0:d>255?255:d,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,e[g]=d,e[g+1]=c,e[g+2]=f,_[c]+=O,y=i(c,y),v=a(c,v);for(m=0,g=0;256>g;g+=32)m+=_[g],_[g]=m,m+=_[g+1],_[g+1]=m,m+=_[g+2],_[g+2]=m,m+=_[g+3],_[g+3]=m,m+=_[g+4],_[g+4]=m,m+=_[g+5],_[g+5]=m,m+=_[g+6],_[g+6]=m,m+=_[g+7],_[g+7]=m,m+=_[g+8],_[g+8]=m,m+=_[g+9],_[g+9]=m,m+=_[g+10],_[g+10]=m,m+=_[g+11],_[g+11]=m,m+=_[g+12],_[g+12]=m,m+=_[g+13],_[g+13]=m,m+=_[g+14],_[g+14]=m,m+=_[g+15],_[g+15]=m,m+=_[g+16],_[g+16]=m,m+=_[g+17],_[g+17]=m,m+=_[g+18],_[g+18]=m,m+=_[g+19],_[g+19]=m,m+=_[g+20],_[g+20]=m,m+=_[g+21],_[g+21]=m,m+=_[g+22],_[g+22]=m,m+=_[g+23],_[g+23]=m,m+=_[g+24],_[g+24]=m,m+=_[g+25],_[g+25]=m,m+=_[g+26],_[g+26]=m,m+=_[g+27],_[g+27]=m,m+=_[g+28],_[g+28]=m,m+=_[g+29],_[g+29]=m,m+=_[g+30],_[g+30]=m,m+=_[g+31],_[g+31]=m;if(p=y-v,r)for(g=0;b>g;g+=4)c=_[e[g+1]]*p+v,f=e[g+2],d=e[g],l=~~(c+1.402*(d-128)),u=~~(c-.34414*(f-128)-.71414*(d-128)),h=~~(c+1.772*(f-128)),l=0>l?0:l>255?255:l,u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,e[g]=l,e[g+1]=u,e[g+2]=h;else for(g=0;b>g;g+=4)c=_[e[g+1]]*p+v,f=e[g+2],d=e[g],l=~~(c+1.402*(d-128)),u=~~(c-.34414*(f-128)-.71414*(d-128)),h=~~(c+1.772*(f-128)),e[g]=l,e[g+1]=u,e[g+2]=h;return e}}),e.Create({name:"GrayscaleHistogramEqualizeFilter",path:n,apply:function(e,n,s){var o=this;if(!o._isOn)return e;var l,u,h,c,f,d,p=0,_=255,m=e.length,g=m>>2,y=1/g;for(c=new t(256),d=0;m>d;d+=4)l=e[d],c[l]+=y,p=i(l,p),_=a(l,_);for(f=0,d=0;256>d;d+=32)f+=c[d],c[d]=f,f+=c[d+1],c[d+1]=f,f+=c[d+2],c[d+2]=f,f+=c[d+3],c[d+3]=f,f+=c[d+4],c[d+4]=f,f+=c[d+5],c[d+5]=f,f+=c[d+6],c[d+6]=f,f+=c[d+7],c[d+7]=f,f+=c[d+8],c[d+8]=f,f+=c[d+9],c[d+9]=f,f+=c[d+10],c[d+10]=f,f+=c[d+11],c[d+11]=f,f+=c[d+12],c[d+12]=f,f+=c[d+13],c[d+13]=f,f+=c[d+14],c[d+14]=f,f+=c[d+15],c[d+15]=f,f+=c[d+16],c[d+16]=f,f+=c[d+17],c[d+17]=f,f+=c[d+18],c[d+18]=f,f+=c[d+19],c[d+19]=f,f+=c[d+20],c[d+20]=f,f+=c[d+21],c[d+21]=f,f+=c[d+22],c[d+22]=f,f+=c[d+23],c[d+23]=f,f+=c[d+24],c[d+24]=f,f+=c[d+25],c[d+25]=f,f+=c[d+26],c[d+26]=f,f+=c[d+27],c[d+27]=f,f+=c[d+28],c[d+28]=f,f+=c[d+29],c[d+29]=f,f+=c[d+30],c[d+30]=f,f+=c[d+31],c[d+31]=f;if(h=p-_,r)for(d=0;m>d;d+=4)l=e[d],u=c[l]*h+_,u=0>u?0:u>255?255:u,u=~~u,e[d]=u,e[d+1]=u,e[d+2]=u;else for(d=0;m>d;d+=4)l=e[d],u=~~(c[l]*h+_),e[d]=u,e[d+1]=u,e[d+2]=u;return e}}),e.Create({name:"RGBHistogramEqualizeFilter",path:n,apply:function(e,n,s){var o=this;if(!o._isOn)return e;var l,u,h,c,f,d,p,_,m,g,y,v,b,C,O,w,M=0,I=0,z=0,Y=255,X=255,x=255,A=e.length,H=A>>2,F=1/H;for(p=new t(256),_=new t(256),m=new t(256),w=0;A>w;w+=4)l=e[w],u=e[w+1],h=e[w+2],p[l]+=F,_[u]+=F,m[h]+=F,M=i(l,M),I=i(u,I),z=i(h,z),Y=a(l,Y),X=a(u,X),x=a(h,x);for(g=y=v=0,w=0;256>w;w+=32)g+=p[w],p[w]=g,g+=p[w+1],p[w+1]=g,g+=p[w+2],p[w+2]=g,g+=p[w+3],p[w+3]=g,g+=p[w+4],p[w+4]=g,g+=p[w+5],p[w+5]=g,g+=p[w+6],p[w+6]=g,g+=p[w+7],p[w+7]=g,g+=p[w+8],p[w+8]=g,g+=p[w+9],p[w+9]=g,g+=p[w+10],p[w+10]=g,g+=p[w+11],p[w+11]=g,g+=p[w+12],p[w+12]=g,g+=p[w+13],p[w+13]=g,g+=p[w+14],p[w+14]=g,g+=p[w+15],p[w+15]=g,g+=p[w+16],p[w+16]=g,g+=p[w+17],p[w+17]=g,g+=p[w+18],p[w+18]=g,g+=p[w+19],p[w+19]=g,g+=p[w+20],p[w+20]=g,g+=p[w+21],p[w+21]=g,g+=p[w+22],p[w+22]=g,g+=p[w+23],p[w+23]=g,g+=p[w+24],p[w+24]=g,g+=p[w+25],p[w+25]=g,g+=p[w+26],p[w+26]=g,g+=p[w+27],p[w+27]=g,g+=p[w+28],p[w+28]=g,g+=p[w+29],p[w+29]=g,g+=p[w+30],p[w+30]=g,g+=p[w+31],p[w+31]=g,y+=_[w],_[w]=y,y+=_[w+1],_[w+1]=y,y+=_[w+2],_[w+2]=y,y+=_[w+3],_[w+3]=y,y+=_[w+4],_[w+4]=y,y+=_[w+5],_[w+5]=y,y+=_[w+6],_[w+6]=y,y+=_[w+7],_[w+7]=y,y+=_[w+8],_[w+8]=y,y+=_[w+9],_[w+9]=y,y+=_[w+10],_[w+10]=y,y+=_[w+11],_[w+11]=y,y+=_[w+12],_[w+12]=y,y+=_[w+13],_[w+13]=y,y+=_[w+14],_[w+14]=y,y+=_[w+15],_[w+15]=y,y+=_[w+16],_[w+16]=y,y+=_[w+17],_[w+17]=y,y+=_[w+18],_[w+18]=y,y+=_[w+19],_[w+19]=y,y+=_[w+20],_[w+20]=y,y+=_[w+21],_[w+21]=y,y+=_[w+22],_[w+22]=y,y+=_[w+23],_[w+23]=y,y+=_[w+24],_[w+24]=y,y+=_[w+25],_[w+25]=y,y+=_[w+26],_[w+26]=y,y+=_[w+27],_[w+27]=y,y+=_[w+28],_[w+28]=y,y+=_[w+29],_[w+29]=y,y+=_[w+30],_[w+30]=y,y+=_[w+31],_[w+31]=y,v+=m[w],m[w]=v,v+=m[w+1],m[w+1]=v,v+=m[w+2],m[w+2]=v,v+=m[w+3],m[w+3]=v,v+=m[w+4],m[w+4]=v,v+=m[w+5],m[w+5]=v,v+=m[w+6],m[w+6]=v,v+=m[w+7],m[w+7]=v,v+=m[w+8],m[w+8]=v,v+=m[w+9],m[w+9]=v,v+=m[w+10],m[w+10]=v,v+=m[w+11],m[w+11]=v,v+=m[w+12],m[w+12]=v,v+=m[w+13],m[w+13]=v,v+=m[w+14],m[w+14]=v,v+=m[w+15],m[w+15]=v,v+=m[w+16],m[w+16]=v,v+=m[w+17],m[w+17]=v,v+=m[w+18],m[w+18]=v,v+=m[w+19],m[w+19]=v,v+=m[w+20],m[w+20]=v,v+=m[w+21],m[w+21]=v,v+=m[w+22],m[w+22]=v,v+=m[w+23],m[w+23]=v,v+=m[w+24],m[w+24]=v,v+=m[w+25],m[w+25]=v,v+=m[w+26],m[w+26]=v,v+=m[w+27],m[w+27]=v,v+=m[w+28],m[w+28]=v,v+=m[w+29],m[w+29]=v,v+=m[w+30],m[w+30]=v,v+=m[w+31],m[w+31]=v;if(c=M-Y,f=I-X,d=z-x,r)for(w=0;A>w;w+=4)l=e[w],u=e[w+1],h=e[w+2],b=p[l]*c+Y,C=_[u]*f+X,O=m[h]*d+x,b=0>b?0:b>255?255:b,C=0>C?0:C>255?255:C,O=0>O?0:O>255?255:O,e[w]=~~b,e[w+1]=~~C,e[w+2]=~~O;else for(w=0;A>w;w+=4)l=e[w],u=e[w+1],h=e[w+2],b=p[l]*c+Y,C=_[u]*f+X,O=m[h]*d+x,e[w]=~~b,e[w+1]=~~C,e[w+2]=~~O;return e}})}(r),!function(e){var r=Math.sqrt,t=e._notSupportClamp,a=e.Array32F;e.Create({name:"PixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.scale=r.scale),n},apply:function(e,n,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,p,_,m,g,y,v,b,C,O,w,M,I,z,Y,X,x,A,H,F,k,N,L,S,q,U,E,R,P,T,D,G,$,j,W,B,V,Q,J,K,Z=e.length,ee=Z>>>2,re=(n<<1)+n;for(o=~~(r(ee)*s.scale*.01),l=n*o,u=i%o,h=n%o,c=(u-1)*n,_=1/(o*o),m=1/(h*o),g=1/(u*o),y=1/(h*u),v=_,b=m,C=g,O=y,Y=o-1,X=(o-1)*n,T=0,G=n-1,D=0,$=ee-n,w=new a(3*ee),x=0,A=0,H=0,M=I=z=0,H=0;n>H;H++,x+=4,A+=3)M+=e[x],I+=e[x+1],z+=e[x+2],w[A]=M,w[A+1]=I,w[A+2]=z;for(A=0,H=0,M=I=z=0,x=re+n;Z>x;x+=4,A+=3,H++)H>=n&&(H=0,M=I=z=0),M+=e[x],I+=e[x+1],z+=e[x+2],w[A+re]=w[A]+M,w[A+re+1]=w[A+1]+I,w[A+re+2]=w[A+2]+z;for(H=0,F=0,k=0,U=H,E=k,R=U+Y,P=E+X,R=R>G?G:R,P=P>$?$:P,j=U+E,V=R+P,W=R+E,B=U+P,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,V=(V<<1)+V,p=v,Q=p*(w[V]-w[W]-w[B]+w[j]),J=p*(w[V+1]-w[W+1]-w[B+1]+w[j+1]),K=p*(w[V+2]-w[W+2]-w[B+2]+w[j+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K,N=0,L=0,S=0,x=0;Z>x;x+=4)q=N+H+S+k<<2,e[q]=Q,e[q+1]=J,e[q+2]=K,N++,(N+H>=n||N>=o)&&(N=0,L++,S+=n),(L+F>=i||L>=o)&&(H+=o,H>=n&&(H=0,F+=o,k+=l),N=0,L=0,S=0,U=H,E=k,R=U+Y,P=E+X,R=R>G?G:R,P=P>$?$:P,j=U+E,V=R+P,W=R+E,B=U+P,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,V=(V<<1)+V,f=h+U===R+1,d=c+E===P,p=f&&d?O:f?b:d?C:v,Q=p*(w[V]-w[W]-w[B]+w[j]),J=p*(w[V+1]-w[W+1]-w[B+1]+w[j+1]),K=p*(w[V+2]-w[W+2]-w[B+2]+w[j+2]),t&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K);return e}})}(r),!function(e){var r=Math.sqrt,t=(Math.SQRT2,Math.min,e._notSupportClamp),a=e.Array32F;e.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.scale=r.scale),n},apply:function(e,n,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,p,_,m,g,y,v,b,C,O,w,M,I,z,Y,X,x,A,H,F,k,N,L,S,q,U,E,R,P,T,D,G,$,j,W,B,V,Q,J,K,Z,ee,re,ne,te,ae=e.length,ie=ae>>>2,se=(n<<1)+n;for(o=~~(r(ie)*s.scale*.01),l=o>>1,u=o-1,h=n*o,c=i%o,f=n%o,d=(c-1)*n,g=1/(o*o),y=1/(f*o),v=1/(c*o),b=1/(f*c),C=2*g,O=2*y,w=2*v,M=2*b,x=u,A=u*n,P=0,D=n-1,T=0,G=ie-n,I=new a(3*ie),H=0,F=0,k=0,z=Y=X=0,k=0;n>k;k++,H+=4,F+=3)z+=e[H],Y+=e[H+1],X+=e[H+2],I[F]=z,I[F+1]=Y,I[F+2]=X;for(F=0,k=0,z=Y=X=0,H=se+n;ae>H;H+=4,F+=3,k++)k>=n&&(k=0,z=Y=X=0),z+=e[H],Y+=e[H+1],X+=e[H+2],I[F+se]=I[F]+z,I[F+se+1]=I[F+1]+Y,I[F+se+2]=I[F+2]+X;for(k=0,N=0,q=k,U=N,E=k-l+x,R=N+A,E=E>D?D:E,R=R>G?G:R,$=q+U,B=E+R,j=E+U,W=q+R,$=($<<1)+$,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,m=C,K=m*(I[B]-I[j]-I[W]+I[$]),Z=m*(I[B+1]-I[j+1]-I[W+1]+I[$+1]),ee=m*(I[B+2]-I[j+2]-I[W+2]+I[$+2]),q=k+l,E=k+x,E=E>D?D:E,$=q+U,B=E+R,j=E+U,W=q+R,$=($<<1)+$,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,re=m*(I[B]-I[j]-I[W]+I[$]),ne=m*(I[B+1]-I[j+1]-I[W+1]+I[$+1]),te=m*(I[B+2]-I[j+2]-I[W+2]+I[$+2]),t&&(K=0>K?0:K>255?255:K,Z=0>Z?0:Z>255?255:Z,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,te=0>te?0:te>255?255:te),K=~~K,Z=~~Z,ee=~~ee,re=~~re,ne=~~ne,te=~~te,V=K,Q=Z,J=ee,L=0,S=0,H=0;ae>H;H+=4)e[H]=V,e[H+1]=Q,e[H+2]=J,k++,L++,k>=n&&(L=0,k=0,S++,N+=n,S>=o&&(S=0)),L>=o&&(L=0),0===L&&(q=k,U=N,E=k-l+x,R=N+A,E=E>D?D:E,R=R>G?G:R,$=q+U,B=E+R,j=E+U,W=q+R,$=($<<1)+$,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,p=f+q===E+l+1,_=U+d===R,m=p&&_?M:p?O:_?w:C,K=m*(I[B]-I[j]-I[W]+I[$]),Z=m*(I[B+1]-I[j+1]-I[W+1]+I[$+1]),ee=m*(I[B+2]-I[j+2]-I[W+2]+I[$+2]),q=k+l,E=k+x,E=E>D?D:E,$=q+U,B=E+R,j=E+U,W=q+R,$=($<<1)+$,j=(j<<1)+j,W=(W<<1)+W,B=(B<<1)+B,p=f+q===E+l+1,m=p&&_?M:p?O:_?w:C,re=m*(I[B]-I[j]-I[W]+I[$]),ne=m*(I[B+1]-I[j+1]-I[W+1]+I[$+1]),te=m*(I[B+2]-I[j+2]-I[W+2]+I[$+2]),t&&(K=0>K?0:K>255?255:K,Z=0>Z?0:Z>255?255:Z,ee=0>ee?0:ee>255?255:ee,re=0>re?0:re>255?255:re,ne=0>ne?0:ne>255?255:ne,te=0>te?0:te>255?255:te),K=~~K,Z=~~Z,ee=~~ee,re=~~re,ne=~~ne,te=~~te,V=K,Q=Z,J=ee),L+S>u&&(V=re,Q=ne,J=te);return e}})}(r),!function(e,r){var t=7/16,a=3/16,i=5/16,s=1/16,o=e.Array32F,l=e.Color.clamp,u=e.Color.RGB2YCbCr,h=e.Color.YCbCr2RGB;e.Create({name:"HalftoneFilter",_threshold:.4,_size:1,_grayscale:!1,init:function(e,n,t){var a=this;a._size=e||1,a._threshold=l(r===n?.4:n,0,1),a._grayscale=!!t},path:n,size:function(e){return this._size=e,this},threshold:function(e){return this._threshold=l(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this._grayscale=!!e,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_size:e._size,_threshold:e._threshold,_grayscale:e._grayscale}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n._size=r._size,n._threshold=r._threshold,n._grayscale=r._grayscale),n},apply:function(e,r,n){var c,f,d,p,_,m,g,y,v,b,C,O,w,M,I,z,Y,X=this,x=e.length,A=x>>>2,H=new o(3*A),F=X._size,k=F*F,N=1/k,L=255*X._threshold,S=S<<1,q=!X._grayscale,U=F*r,E=t,R=a,P=i,T=s;for(g=0,y=0,m=0;n>g;){for(O=w=M=0,v=0,b=0,C=0;F>b;)c=m+y+v+C<<2,f=3*(m+y+v+C),O+=e[c]+H[f],w+=e[c+1]+H[f+1],M+=e[c+2]+H[f+2],v++,v>=F&&(v=0,b++,C+=r);if(O*=N,w*=N,M*=N,_=q?u([O,w,M]):[O,w,M],d=_[0],d>L?q?(_[0]=l(~~d,0,255),p=h(_)):p=[255,255,255]:p=[0,0,0],c=m+y<<2,I=e[c]-p[0],z=e[c+1]-p[1],Y=e[c+2]-p[2],r>m+F)for(v=F,b=0,C=0;F>b;)f=3*(m+y+v+C),H[f]+=E*I,H[f+1]+=E*z,H[f+2]+=E*Y,v++,v>=S&&(v=F,b++,C+=r);if(n>g+F&&m>F)for(v=-F,b=F,C=0;S>b;)f=3*(m+y+v+C),H[f]+=R*I,H[f+1]+=R*z,H[f+2]+=R*Y,v++,v>=0&&(v=-F,b++,C+=r);if(n>g+F)for(v=0,b=F,C=0;S>b;)f=3*(m+y+v+C),H[f]+=P*I,H[f+1]+=P*z,H[f+2]+=P*Y,v++,v>=F&&(v=0,b++,C+=r);if(n>g+F&&r>m+F)for(v=F,b=F,C=0;S>b;)f=3*(m+y+v+C),H[f]+=T*I,H[f+1]+=T*z,H[f+2]+=T*Y,v++,v>=S&&(v=F,b++,C+=r);for(v=0,b=0,C=0;F>b;)c=m+y+v+C<<2,e[c]=p[0],e[c+1]=p[1],e[c+2]=p[2],v++,v>=F&&(v=0,b++,C+=r);m+=F,m>=r&&(m=0,g+=F,y+=U)}return e}})}(r),!function(e,r){var t="hasOwnProperty",a=Math.min,i=Math.round,s=e._notSupportClamp,o=e.Color.Combine;e.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendImage:null,startX:0,startY:0,path:n,init:function(e,r){var n=this;n.startX=0,n.startY=0,n._blendImage=null,n.blendImage=null,n._blendMode=null,e&&n.setImage(e),r&&n.setMode(r)},dispose:function(){var e=this;return e.blendImage=null,e._blendImage=null,e._blendMode=null,e.$super("dispose"),e},setImage:function(e){var r=this;return e&&(r.blendImage=e,r._blendImage=null),r},setMode:function(e){var r=this;return e?(r._blendMode=(""+e).toLowerCase(),o[t](r._blendMode)||(r._blendMode=null)):r._blendMode=null,r},serialize:function(){var e=this,r=e.blendImage;return{filter:e.name,_isOn:!!e._isOn,params:{_blendImage:e._blendImage||(r?{data:r.getData(),width:r.width,height:r.height}:null),_blendMode:e._blendMode,startX:e.startX,startY:e.startY}}},unserialize:function(r){var n,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,n=r.params,t.startX=n.startX,t.startY=n.startY,t.blendImage=null,t._blendImage=n._blendImage,t._blendImage&&(t._blendImage.data=e.Util.Array.typed(t._blendImage.data,e.ImArray)),t.setMode(n._blendMode)),t},reset:function(){var e=this;return e.startX=0,e.startY=0,e._blendMode=null,e},apply:function(e,r,n){var t=this,l=t.blendImage;if(!t._isOn||!t._blendMode||!l&&!t._blendImage)return e;var u,h,c,f,d,p,_,m,g,y,v,b,C,O,w=t._blendImage||{data:l.getData(),width:l.width,height:l.height},M=t.startX||0,I=t.startY||0,z=0,Y=0,X=o[t._blendMode];if(0>M&&(z=-M,M=0),0>I&&(Y=-I,I=0),f=w.width,d=w.height,M>=r||I>=n)return e;if(z>=f||Y>=d)return e;if(M=i(M),I=i(I),z=i(z),Y=i(Y),u=a(r-M,f-z),h=a(n-I,d-Y),0>=u||0>=h)return e;for(c=w.data,y=M,v=I*r,b=z,C=Y*f,p=M+u,_=z+u,m=0,g=h*u;g>m;)O=b+C<<2,c[O+3]&&X(e,c,y+v<<2,O,s),m++,y++,y>=p&&(y=M,v+=r),b++,b>=_&&(b=z,C+=f);return e}})}(r),!function(e,r){var t=e.ImArray,a=e.Util.Filter.integral_convolution,i=new e.Array32F([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]);e.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:3,path:n,init:function(e,r,n,t,a){var i=this;i.offsetX=e||0,i.offsetY=r||0,i.color=n||0,i.opacity=null==t?1:+t,i.quality=a||3},dispose:function(){var e=this;return e.offsetX=null,e.offsetY=null,e.color=null,e.opacity=null,e.quality=null,e.$super("dispose"),e},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{offsetX:e.offsetX,offsetY:e.offsetY,color:e.color,opacity:e.opacity,quality:e.quality}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.offsetX=r.offsetX,n.offsetY=r.offsetY,n.color=r.color,n.opacity=r.opacity,n.quality=r.quality),n},apply:function(e,r,n){var s=this;if(!s._isOn)return e;var o,l,u,h,c,f,d,p,_=s.color||0,m=~~s.quality,g=s.offsetX||0,y=s.offsetY||0,v=s.opacity,b=_>>>16&255,C=_>>>8&255,O=255&_,w=e.length,M=w>>>2;if(0>v&&(v=0),v>1&&(v=1),0===v)return e;for(0>=m&&(m=1),m>3&&(m=3),p=new t(w),o=0;w>o;o+=4)d=e[o+3],d>0?(p[o]=b,p[o+1]=C,p[o+2]=O,p[o+3]=~~(v*d)):(p[o]=0,p[o+1]=0,p[o+2]=0,p[o+3]=0);for(p=a(!1,p,r,n,i,null,3,3,1,0,m),y*=r,l=0,u=0,f=0;w>f;f+=4,l++)l>=r&&(l=0,u+=r),h=l+g,c=u+y,0>h||h>=r||0>c||c>=M||(o=h+c<<2,d=e[o+3],v=p[f+3],255!==d&&0!==v&&(v/=255,b=~~(e[o]+(p[f]-e[o])*v),C=~~(e[o+1]+(p[f+1]-e[o+1])*v),O=~~(e[o+2]+(p[f+2]-e[o+2])*v),e[o]=b,e[o+1]=C,e[o+2]=O));return e}})}(r),!function(e){var r=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,s=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,r,n,t){var a=this;a.centerX=e||0,a.centerY=r||0,a.radius=n||10,a.amount=t||10},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.centerX=r.centerX,n.centerY=r.centerY,n.radius=r.radius,n.amount=r.amount),n},apply:function(e,n,o){var l=this;if(!l._isOn)return e;var u,h,c,f,d,p,_,m,g,y,v,b,C,O,w,M,I,z,Y,X,x,A,H,F,k,N,L,S,q,U,E,R,P,T=e.length,D=l.centerX||0,G=l.centerY||0,$=l.radius,j=l.amount;if(0>=j)return e;for(u=T>>2,U=0,E=n-1,R=0,P=u-n,D=a(D*(n-1)),G=a(G*(o-1)),c=(u<<1)+u,_=(n<<1)+n,h=new s(c),m=0,g=0,y=0,f=d=p=0,y=0;n>y;y++,m+=4,g+=3)f+=e[m],d+=e[m+1],p+=e[m+2],h[g]=f,h[g+1]=d,h[g+2]=p;for(m=_+n,g=0,y=0,f=d=p=0,m=_+n;T>m;m+=4,g+=3,y++)y>=n&&(y=0,f=d=p=0),f+=e[m],d+=e[m+1],p+=e[m+2],h[g+_]=h[g]+f,h[g+_+1]=h[g+1]+d,h[g+_+2]=h[g+2]+p;for(y=0,v=0,b=0,m=0;T>m;m+=4,y++)y>=n&&(y=0,v++,b+=n),O=y-D,w=v-G,C=t(O)+t(w),M=C>$?~~r((C-$)*j):~~(C/$+.5),M>0&&(I=M*n,z=.25/(M*M),Y=y-M,X=b-I,x=y+M,A=b+I,U>Y?Y=U:x>E&&(x=E),R>X?X=R:A>P&&(A=P),H=Y+X,N=x+A,F=x+X,k=Y+A,H=(H<<1)+H,F=(F<<1)+F,k=(k<<1)+k,N=(N<<1)+N,L=z*(h[N]-h[F]-h[k]+h[H]),S=z*(h[N+1]-h[F+1]-h[k+1]+h[H+1]),q=z*(h[N+2]-h[F+2]-h[k+2]+h[H+2]),i&&(L=0>L?0:L>255?255:L,S=0>S?0:S>255?255:S,q=0>q?0:q>255?255:q),e[m]=~~L,e[m+1]=~~S,e[m+2]=~~q);return e}})}(r),!function(e){e.Create({name:"SeamlessTileFilter",type:0,init:function(e){var r=this;r.type=e||0},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{type:e.type}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.type=r.type),n},apply:function(r,n,t){var a,i,s,o,l,u,h,c,f,d,p,_,m,g,y,v=this,b=v.type,C=e.Interpolation.bilinear,O=e.ImArray,w=Math.sqrt;for(n!==t?r=C(r,n,t,_=n>t?n:t,_):_=n,m=Math.round(_/2),g=_*_,y=r.length,a=new O(y),i=new O(y),s=new e.Array8U(g),c=0,f=0,d=0;y>d;d+=4,c++)c>=_&&(c=0,f++),p=(c+m)%_+(f+m)%_*_<<2,a[p]=r[d],a[p+1]=r[d+1],a[p+2]=r[d+2],a[p+3]=r[d+3];for(c=0,f=0;m>c;f++){switch(f>=m&&(f=0,c++),b){case 0:h=w((c-m)*(c-m)+(f-m)*(f-m))/m;break;case 1:h=m-f>m-c?(f-m)/m:(c-_/2)/m;break;case 2:default:h=m-f>m-c?w((f-_)*(f-_)+(c-_)*(c-_))/(1.13*_):w((c-_)*(c-_)+(f-_)*(f-_))/(1.13*_)}h=255-255*h,1>h?h=1:h>255&&(h=255),s[c+f*_]=h,s[c+(_-1-f)*_]=h,s[_-1-c+f*_]=h,s[_-1-c+(_-1-f)*_]=h}for(f=0,c=0;_>f;c++)c>=_&&(c=0,f++),p=c+f*_,o=s[p],l=s[(c+m)%_+(f+m)%_*_],u=o+l,o/=u,l/=u,p<<=2,i[p]=~~(o*r[p]+l*a[p]),i[p+1]=~~(o*r[p+1]+l*a[p+1]),i[p+2]=~~(o*r[p+2]+l*a[p+2]),i[p+3]=r[p+3];return n!==t&&(i=C(i,_,_,n,t)),i}})}(r),!function(e){var r=e.Util.Array.typed,t=Math.abs,a=(Math.min,Math.max,Math.ceil),i=e.MODE.TILE,s=e.MODE.STRETCH,o=e.Array8U,l=e.Array32U;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,borderColor:null,tolerance:0,path:n,init:function(e,r,n,t,a){var i=this;i.x=e||0,i.y=r||0,i.color=n||0,i.tolerance=t||0,i.borderColor=a===+a?+a:null},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{color:e.color,borderColor:e.borderColor,x:e.x,y:e.y,tolerance:e.tolerance}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.color=r.color,n.borderColor=r.borderColor,n.x=r.x,n.y=r.y,n.tolerance=r.tolerance),n},apply:function(e,r,n){var a,i,s,l,u,h,c,f,d,p,_,m,g=this,y=~~(255*(g.tolerance>=1?.999:g.tolerance)),v=g.color||0,b=g.borderColor,C=b===+b,O=r<<2,w=g.x,M=g.y,I=e.length,z=0,Y=I-O,X=0,x=r-1<<2;if(f=M*r<<2,w<<=2,X>w||w>x||z>f||f>Y)return e;if(a=new o(3),i=new o(3),i[0]=v>>>16&255,i[1]=v>>>8&255,i[2]=255&v,C){if(a[0]=b>>>16&255,a[1]=b>>>8&255,a[2]=255&b,t(a[0]-e[w+f])<=y&&t(a[1]-e[w+f+1])<=y&&t(a[2]-e[w+f+2])<=y)return e}else{if(e[w+f]===i[0]&&e[w+f+1]===i[1]&&e[w+f+2]===i[2])return e;a[0]=e[w+f],a[1]=e[w+f+1],a[2]=e[w+f+2]}for(d=new Array(I>>>2),p=0,f+O>=z&&Y>=f+O&&(d[p++]=[f,w,w,O]),d[p++]=[f+O,w,w,-O];p>0;){if(_=d[--p],f=_[0]+(O=_[3]),h=_[1],c=_[2],C)for(u=h;u>=X&&(l=u+f,!(t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y));u-=4)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];else for(u=h;u>=X&&(l=u+f,t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y);u-=4)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2];if(u>=h){if(l=u+f,C)for(;c>=u&&t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y;)u+=4,l=u+f;else for(;c>=u&&!(t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y);)u+=4,l=u+f;s=u,m=c>=u}else s=u+4,h>s&&f-O>=z&&Y>=f-O&&(d[p++]=[f,s,h-4,-O]),u=h+4,m=!0;for(;m;){if(l=u+f,C)for(;x>=u&&!(t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y);)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],u+=4,l=u+f;else for(;x>=u&&t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y;)e[l]=i[0],e[l+1]=i[1],e[l+2]=i[2],u+=4,l=u+f;if(f+O>=z&&Y>=f+O&&(d[p++]=[f,s,u-4,O]),u>c+4&&f-O>=z&&Y>=f-O&&(d[p++]=[f,c+4,u-4,-O]),l=u+f,C)for(;c>=u&&t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y;)u+=4,l=u+f;else for(;c>=u&&!(t(a[0]-e[l])<=y&&t(a[1]-e[l+1])<=y&&t(a[2]-e[l+2])<=y);)u+=4,l=u+f;s=u,m=c>=u}}return e}}),e.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,pattern:null,_pattern:null,mode:i,borderColor:null,path:n,init:function(e,r,n,t,a,s,o,l){var u=this;u.x=e||0,u.y=r||0,u.offsetX=t||0,u.offsetY=a||0,n&&u.setPattern(n),u.mode=s||i,u.tolerance=o||0,u.borderColor=l===+l?+l:null},dispose:function(){var e=this;return e.pattern=null,e._pattern=null,e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.mode=null,e.borderColor=null,e.$super("dispose"),e},setPattern:function(e){var r=this;return e&&(r.pattern=e,r._pattern=null),r},serialize:function(){var e=this,r=e.pattern;return{filter:e.name,_isOn:!!e._isOn,params:{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,mode:e.mode,borderColor:e.borderColor,_pattern:e._pattern||(r?{data:r.getData(),width:r.width,height:r.height}:null)}}},unserialize:function(n){var t,a=this;return n&&a.name===n.filter&&(a._isOn=!!n._isOn,t=n.params,a.x=t.x,a.y=t.y,a.offsetX=t.offsetX,a.offsetY=t.offsetY,a.tolerance=t.tolerance,a.mode=t.mode,a.borderColor=t.borderColor,a.pattern=null,a._pattern=t._pattern,a._pattern&&(a._pattern.data=r(a._pattern.data,e.ImArray))),a},apply:function(e,r,n){var i=this,u=i.pattern;if(!i._isOn||!u&&!i._pattern)return e;var h,c,f,d,p,_,m,g,y,v,b,C,O,w,M,I,z=i._pattern||{data:u.getData(),width:u.width,height:u.height},Y=~~(255*(i.tolerance>=1?.999:i.tolerance)),X=i.mode,x=i.borderColor,A=x===+x,H=r<<2,F=z.data,k=z.width,N=z.height,L=i.x,S=i.y,q=i.offsetX||0,U=i.offsetY||0,E=e.length,R=E>>>2,P=0,T=E-H,D=0,G=r-1<<2;if(0>q&&(q+=k),0>U&&(U+=N),p=S,g=S*r<<2,L<<=2,D>L||L>G||P>g||g>T)return e;if(h=new o(3),A){if(h[0]=x>>>16&255,h[1]=x>>>8&255,h[2]=255&x,t(h[0]-e[L+g])<=Y&&t(h[1]-e[L+g+1])<=Y&&t(h[2]-e[L+g+2])<=Y)return e}else h[0]=e[L+g],h[1]=e[L+g+1],h[2]=e[L+g+2];for(C=new Array(R),O=0,w=new l(a(R/32)),g+H>=P&&T>=g+H&&(C[O++]=[g,L,L,H,p+1]),C[O++]=[g+H,L,L,-H,p];O>0;){if(M=C[--O],g=M[0]+(H=M[3]),_=M[1],m=M[2],p=M[4],A)for(d=_;d>=D&&(f=d+g,!(w[f>>>7]&1<<(f>>>2&31)||t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y));d-=4)w[f>>>7]|=1<<(f>>>2&31),s===X?(v=~~(k*(d>>>2)/r),b=~~(N*p/n)):(v=((d>>>2)+q)%k,b=(p+U)%N),y=v+b*k<<2,e[f]=F[y],e[f+1]=F[y+1],e[f+2]=F[y+2];else for(d=_;d>=D&&(f=d+g,!(w[f>>>7]&1<<(f>>>2&31))&&t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y);d-=4)w[f>>>7]|=1<<(f>>>2&31),s===X?(v=~~(k*(d>>>2)/r),b=~~(N*p/n)):(v=((d>>>2)+q)%k,b=(p+U)%N),y=v+b*k<<2,e[f]=F[y],e[f+1]=F[y+1],e[f+2]=F[y+2];if(d>=_){if(f=d+g,A)for(;m>=d&&w[f>>>7]&1<<(f>>>2&31)||t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y;)d+=4,f=d+g;else for(;m>=d&&!(!(w[f>>>7]&1<<(f>>>2&31))&&t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y);)d+=4,f=d+g;c=d,I=m>=d}else c=d+4,_>c&&g-H>=P&&T>=g-H&&(C[O++]=[g,c,_-4,-H,H>0?p-1:p+1]),d=_+4,I=!0;for(;I;){if(f=d+g,A)for(;G>=d&&!(w[f>>>7]&1<<(f>>>2&31))&&!(t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y);)w[f>>>7]|=1<<(f>>>2&31),s===X?(v=~~(k*(d>>>2)/r),b=~~(N*p/n)):(v=((d>>>2)+q)%k,b=(p+U)%N),y=v+b*k<<2,e[f]=F[y],e[f+1]=F[y+1],e[f+2]=F[y+2],d+=4,f=d+g;else for(;G>=d&&!(w[f>>>7]&1<<(f>>>2&31))&&t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y;)w[f>>>7]|=1<<(f>>>2&31),s===X?(v=~~(k*(d>>>2)/r),b=~~(N*p/n)):(v=((d>>>2)+q)%k,b=(p+U)%N),y=v+b*k<<2,e[f]=F[y],e[f+1]=F[y+1],e[f+2]=F[y+2],d+=4,f=d+g;if(g+H>=P&&T>=g+H&&(C[O++]=[g,c,d-4,H,H>0?p+1:p-1]),d>m+4&&g-H>=P&&T>=g-H&&(C[O++]=[g,m+4,d-4,-H,H>0?p-1:p+1]),f=d+g,A)for(;m>=d&&w[f>>>7]&1<<(f>>>2&31)||t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y;)d+=4,f=d+g;else for(;m>=d&&!(!(w[f>>>7]&1<<(f>>>2&31))&&t(h[0]-e[f])<=Y&&t(h[1]-e[f+1])<=Y&&t(h[2]-e[f+2])<=Y);)d+=4,f=d+g;c=d,I=m>=d}}return e}})}(r),!function(e){var r=e._notSupportClamp,t=e.Color.RGB2HSV,a=e.Util.Array.subarray;e.Create({name:"HSVConverterFilter",path:n,apply:function(e,n,i){var s=this;if(!s._isOn)return e;var o,l,u,h,c,f=e.length;if(r)for(o=0;f>o;o+=4)l=t(a(e,o,o+3)),u=.7083333333333334*l[0],c=255*l[1],h=l[2],u=0>u?0:u>255?255:u,h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,e[o]=~~u,e[o+1]=~~h,e[o+2]=~~c;else for(o=0;f>o;o+=4)l=t(a(e,o,o+3)),u=.7083333333333334*l[0],c=255*l[1],h=l[2],e[o]=~~u,e[o+1]=~~h,e[o+2]=~~c;return e}})}(r),!function(e){var r=e.Util.Array.typed,t=e.Color.hue;e.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,asHue:!1,init:function(e,r,n){var t=this;t.thresholds=e,t.quantizedColors=r||null,
t.asHue=!!n},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{thresholds:e.thresholds,quantizedColors:e.quantizedColors,asHue:e.asHue}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.thresholds=r(n.thresholds,Array),t.quantizedColors=r(n.quantizedColors,Array),t.asHue=n.asHue),t},apply:function(e,r,n){var a=this;if(!(a._isOn&&a.thresholds&&a.thresholds.length&&a.quantizedColors&&a.quantizedColors.length))return e;var i,s,o,l,u=e.length,h=a.thresholds,c=h.length,f=a.quantizedColors,d=f.length;if(a.asHue){for(o=0;u>o;o+=4)if(0!==e[o+3]){for(s=t(e[o],e[o+1],e[o+2]),l=0;c>l&&s>h[l];)l++;i=d>l?f[l]:16777215,e[o]=i>>>16&255,e[o+1]=i>>>8&255,e[o+2]=255&i}}else for(o=0;u>o;o+=4)if(0!==e[o+3]){for(i=e[o]<<16|e[o+1]<<8|255&e[o+2],l=0;c>l&&i>h[l];)l++;i=d>l?f[l]:16777215,e[o]=i>>>16&255,e[o+1]=i>>>8&255,e[o+2]=255&i}return e}})}(r),!function(e){var r=e.Color.hue;e.Create({name:"HueExtractorFilter",minHue:0,maxHue:360,background:0,init:function(e,r,n){var t=this;t.minHue=e,t.maxHue=r,t.background=n||0},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{minHue:e.minHue,maxHue:e.maxHue,background:e.background||0}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.minHue=r.minHue,n.maxHue=r.maxHue,n.background=r.background||0),n},apply:function(e,n,t){var a=this;if(!a._isOn)return e;var i,s,o,l,u,h,c=a.background||0,f=e.length,d=a.minHue,p=a.maxHue;for(i=c>>>16&255,s=c>>>8&255,o=255&c,l=c>>>24&255,u=0;f>u;u+=4)h=r(e[u],e[u+1],e[u+2]),(d>h||h>p)&&(e[u]=i,e[u+1]=s,e[u+2]=o,e[u+3]=l);return e}})}(r),!function(e){function r(e,r,n,t,a,i){var s,o,h,y,v,b=e.length,C=new u(b),O=new u(b),w=new u(b),M=new u(b),I=new u(i),z=new u(i),Y=a*a,X=2*Y,x=_*Y;for(s=0;i>s&&(o=g(-(s*s)/X),!(c>=o&&s>=2));s++)h=g(-((v=s-.5)*v)/X),y=g(-((v=s+.5)*v)/X),I[s]=(o+h+y)/3/x,z[s]=y-h;var v,A,H,F,k,N,L,S,q,U=s-1,E=r-(s-1),R=r*(s-1),P=r*(n-(s-1));for(v=U;E>v;v++)for(A=R;P>A;A+=r){for(H=v+A,F=e[H]*I[0],k=F,N=1,L=r;s>N;)k+=I[N]*(e[H-L]+e[H+L]),F+=I[N]*(e[H-N]+e[H+N]),L+=r,N++;O[H]=k,C[H]=F}for(v=U;E>v;v++)for(A=R;P>A;A+=r){for(S=0,H=v+A,q=1;s>q;q++)S+=z[q]*(O[H-q]-O[H+q]);w[H]=S}for(v=s;r-s>v;v++)for(A=R;P>A;A+=r){for(S=0,H=v+A,L=r,q=1;s>q;q++)S+=z[q]*(C[H-L]-C[H+L]),L+=r;M[H]=S}U=s,E=r-s,R=r*s,P=r*(n-s);var T,D,G,$,j,W,B,V,Q,J,K,Z,ee,re,ne,te,ae,ie,se,oe;for(v=U;E>v;v++)for(A=R;P>A;A+=r)H=v+A,T=H-r,D=H+r,$=H-1,G=H+1,j=T-1,W=T+1,B=D-1,V=D+1,Q=w[H],J=M[H],K=l(Q,J),ee=l(w[T],M[T]),re=l(w[D],M[D]),te=l(w[$],M[$]),ne=l(w[G],M[G]),ie=l(w[W],M[W]),oe=l(w[V],M[V]),se=l(w[B],M[B]),ae=l(w[j],M[j]),(0>=Q*J?m(Q)>=m(J)?(Z=m(Q*K))>=m(J*ie-(Q+J)*ne)&&Z>m(J*se-(Q+J)*te):(Z=m(J*K))>=m(Q*ie-(J+Q)*ee)&&Z>m(Q*se-(J+Q)*re):m(Q)>=Math.abs(J)?(Z=m(Q*K))>=m(J*oe+(Q-J)*ne)&&Z>m(J*ae+(Q-J)*te):(Z=m(J*K))>=m(Q*oe+(J-Q)*re)&&Z>m(Q*ae+(J-Q)*ee))?t[H]=K>=d?p:Math.floor(f*K):t[H]=0}function t(e,r,n,t,i,s){var o,l,u,h=0,c=e.length;for(o=0;c>o;o++)e[o]=0;for(u=0,l=0,h=0;c>h;h++,u++)u>=r&&(u=0,l++),0===e[h]&&t[h]>=s&&a(e,r,n,t,u,l,h,i)}function a(e,r,n,t,i,s,o,l){var u,h,c,f=0==i?i:i-1,d=i==r-1?i:i+1,p=0==s?s:s-1,_=s==n-1?s:s+1;for(e[o]=t[o],u=f,h=p;d>=u&&_>=h;){if(c=u+h*r,(h!=s||u!=i)&&0===e[c]&&t[c]>=l)return void a(e,r,n,t,u,h,c,l);h++,h>_&&(h=p,u++)}}function i(r,n){var t,a,i,s,o,l=r.length,u=e.LUMA[0],h=e.LUMA[1],c=e.LUMA[2];for(t=0,a=0;l>t;t+=4,a++)i=r[t],s=r[t+1],o=r[t+2],n[a]=~~(u*i+h*s+c*o+.5)}function s(e){var r,n,t,a,i,s=new h(256),o=new h(256),l=e.length;for(r=0;l>r;r++)s[e[r]]++;for(n=0,t=0,r=0;256>r;r++){for(n+=s[r],i=255*n/l,a=t+1;i>=a;a++)o[a]=r;t=i}for(r=0;l>r;r++)e[r]=o[e[r]]}function o(e,r){var n,t,a,i=e.length;for(n=0,t=0;i>n;n+=4,t++)a=r[t]>0?255:0,e[n]=e[n+1]=e[n+2]=a}var l,u=e.Array32F,h=e.Array32I,c=.005,f=100,d=1e3,p=f*d,_=e.CONST.PI2,m=Math.abs,g=Math.exp;l=Math.hypot?Math.hypot:function(e,r){return m(e)+m(r)},e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:n,init:function(e,r,n,t,a){var i=this;i.low=arguments.length<1?2.5:e,i.high=arguments.length<2?7.5:r,i.gaussRadius=arguments.length<3?2:n,i.gaussWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},thresholds:function(e,r){var n=this;return n.low=e,n.high=r,n},kernel:function(e,r){var n=this;return n.gaussRadius=e,n.gaussWidth=r,n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{low:e.low,high:e.high,gaussRadius:e.gaussRadius,gaussWidth:e.gaussWidth,contrastNormalized:e.contrastNormalized}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.low=r.low,n.high=r.high,n.gaussRadius=r.gaussRadius,n.gaussWidth=r.gaussWidth,n.contrastNormalized=r.contrastNormalized),n},apply:function(e,n,a){var l,u,c,d,p=this,_=e.length>>2;return c=new h(_),d=new h(_),l=Math.round(p.low*f),u=Math.round(p.high*f),i(e,c),p.contrastNormalized&&s(c),r(c,n,a,d,p.gaussRadius,p.gaussWidth),t(c,n,a,d,l,u),o(e,c),e}})}(r),!function(e,r){function t(e,r,n,t,a,i,s){var o,l,u,h,c,f,d,p=e.length;for(h=0,u=0,o=l=0;r>h;)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[h]=d,a[h]=o,i[h]=l,s[h]=d,h++,u+=4;for(c=0,f=1,h=r,u=r<<2,o=l=0;p>u;)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,t[h]=d,a[h]=a[h-r]+o,i[h]=i[h-r]+l,s[h]=s[h+1-r]+(d+t[h-r])+(f>1?s[h-r-r]:0)+(c>0?s[h-1-r]:0),c++,h++,u+=4,c>=r&&(c=0,f++,o=l=0)}function a(e,r,n,t){var a,i,s,o,l,u,h,c,p,_,m,g=e.length,y=new f(g);for(a=0;r>a;a++)y[a]=0,y[a+r]=0,y[a+g-r]=0,y[a+g-r-r]=0,t[a]=0,t[a+g-r]=0;for(i=0,s=0;n>i;i++,s+=r)y[0+s]=0,y[1+s]=0,y[r-1+s]=0,y[r-2+s]=0,t[0+s]=0,t[r-1+s]=0;for(a=2;r-2>a;a++)for(o=0,i=2,s=r<<1;n-2>i;i++,s+=r)h=a+s,c=h+r,p=c+r,_=h-r,m=_-r,o=0+(e[m-2]<<1)+(e[_-2]<<2)+(e[h-2]<<2)+e[h-2]+(e[c-2]<<2)+(e[p-2]<<1)+(e[m-1]<<2)+(e[_-1]<<3)+e[_-1]+(e[h-1]<<4)-(e[h-1]<<2)+(e[c-1]<<3)+e[c-1]+(e[p-1]<<2)+(e[m]<<2)+e[m]+(e[_]<<4)-(e[_]<<2)+(e[h]<<4)-e[h]+(e[c]<<4)-(e[c]<<2)+(e[p]<<2)+e[p]+(e[m+1]<<2)+(e[_+1]<<3)+e[_+1]+(e[h+1]<<4)-(e[h+1]<<2)+(e[c+1]<<3)+e[c+1]+(e[p+1]<<2)+(e[m+2]<<1)+(e[_+2]<<2)+(e[h+2]<<2)+e[h+2]+(e[c+2]<<2)+(e[p+2]<<1),y[h]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1;r-1>a;a++)for(i=1,s=r;n-1>i;i++,s+=r)h=s+a,c=h+r,_=h-r,l=0-y[_-1]+y[_+1]-y[h-1]-y[h-1]+y[h+1]+y[h+1]-y[c-1]+y[c+1],u=0+y[_-1]+y[_]+y[_]+y[_+1]-y[c-1]-y[c]-y[c]-y[c+1],t[h]=d(l)+d(u);for(a=0,o=0;r>a;)o+=t[a],t[a]=o,a++;for(a=r,s=0,o=0;g>a;)o+=t[a],t[a]=t[a-r]+o,a++,s++,s>=r&&(s=0,o=0);return t}function i(e,r){var n=.2*p(r.width,e.width),t=.2*p(r.height,e.height);return!!(d(e.x-r.x)<=n&&d(e.y-r.y)<=t&&d(e.width-r.width)<=n&&d(e.height-r.height)<=t)}function s(e,r){e.x+=r.x,e.y+=r.y,e.width+=r.width,e.height+=r.height}function o(e,r){return!!(e.x>=r.x&&e.y>=r.y&&e.x+e.width<=r.x+r.width&&e.y+e.height<=r.y+r.height)}function l(e){e.x=~~(e.x+.5),e.y=~~(e.y+.5),e.width=~~(e.width+.5),e.height=~~(e.height+.5)}function u(e,r){return r.area-e.area}function h(e,r){var n,t,a,h,c,f,d,p=e.length,_=new Array(p),m=[],g=0,y=!1;for(a=0;p>a;a++)_[a]=0;for(a=0;p>a;a++){for(y=!1,h=0;a>h;h++)i(e[h],e[a])&&(y=!0,_[a]=_[h]);y||(_[a]=g,g++)}for(n=new Array(g),t=new Array(g),a=0;g>a;a++)n[a]=0,t[a]={x:0,y:0,width:0,height:0};for(a=0;p>a;a++)d=_[a],n[d]++,s(t[d],e[a]);for(a=0;g>a;a++)c=n[a],c>=r&&(f=1/(c+c),d={x:f*(2*t[a].x+c),y:f*(2*t[a].y+c),width:f*(2*t[a].width+c),height:f*(2*t[a].height+c)},m.push(d));for(p=m.length,a=0;p>a;a++)for(h=a+1;p>h;h++)!m[a].inside&&o(m[a],m[h])?m[a].inside=!0:!m[h].inside&&o(m[h],m[a])&&(m[h].inside=!0);for(a=p;--a>=0;)m[a].inside?m.splice(a,1):(l(m[a]),m[a].area=m[a].width*m[a].height);return m.sort(u)}var c=e.Array32F,f=e.Array8U,d=Math.abs,p=Math.max,_=Math.min,m=(Math.floor,Math.round,Math.sqrt),g=e.Util.Array.typed_obj,y="hasOwnProperty";e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,n,t,a,i,s){var o=this;o.objects=null,o.haardata=e||null,o.baseScale=r===n?1:n,o.scaleIncrement=r===t?1.25:t,o.stepIncrement=r===a?.5:a,o.minNeighbors=r===i?1:i,o.doCannyPruning=r===s?!0:!!s,o._haarchanged=!!o.haardata},path:n,dispose:function(){var e=this;return e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var r=this;return r.haardata=e,r._haarchanged=!0,r},params:function(e){var r=this;return e&&(e[y]("haardata")&&(r.haardata=e.haardata,r._haarchanged=!0),e[y]("baseScale")&&(r.baseScale=e.baseScale),e[y]("scaleIncrement")&&(r.scaleIncrement=e.scaleIncrement),e[y]("stepIncrement")&&(r.stepIncrement=e.stepIncrement),e[y]("minNeighbors")&&(r.minNeighbors=e.minNeighbors),e[y]("doCannyPruning")&&(r.doCannyPruning=e.doCannyPruning),e[y]("cannyLow")&&(r.cannyLow=e.cannyLow),e[y]("cannyHigh")&&(r.cannyHigh=e.cannyHigh)),r},serialize:function(){var e=this,r={filter:e.name,_isOn:!!e._isOn,params:{baseScale:e.baseScale,scaleIncrement:e.scaleIncrement,stepIncrement:e.stepIncrement,minNeighbors:e.minNeighbors,doCannyPruning:e.doCannyPruning,cannyLow:e.cannyLow,cannyHigh:e.cannyHigh}};return e._haarchanged&&(r.params.haardata=g(e.haardata),e._haarchanged=!1),r},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,r[y]("haardata")&&(n.haardata=g(r.haardata,1)),n.baseScale=r.baseScale,n.scaleIncrement=r.scaleIncrement,n.stepIncrement=r.stepIncrement,n.minNeighbors=r.minNeighbors,n.doCannyPruning=r.doCannyPruning,n.cannyLow=r.cannyLow,n.cannyHigh=r.cannyHigh),n},getMeta:function(){return e.isWorker?g(this.objects):this.objects},setMeta:function(e){return this.objects="string"==typeof e?g(e,1):e,this},apply:function(e,r,n){var i,s,o,l,u,d,p,g,y,v,b,C,O,w,M,I,z,Y,X,x,A,H,F,k,N,L,S,q,U,E,R,P,T,D,G,$,j,W,B,k,V,Q,J,K,Z,ee,re,ne,te,ae,ie,se,oe,le,ue,he,ce,fe,de,pe=this,_e=e.length>>>2,me=pe.haardata,ge=me.stages,ye=pe.baseScale,ve=pe.scaleIncrement,be=pe.stepIncrement,Ce=pe.minNeighbors,Oe=pe.doCannyPruning,we=pe.cannyLow,Me=pe.cannyHigh,Ie=me.size1,ze=me.size2,Ye=_(r/Ie,n/ze),Xe=[],xe=_e-1,Ae=0,He=0,Fe=ge.length;for(t(e,r,n,s=new f(_e),o=new c(_e),l=new c(_e),u=new c(_e)),Oe&&a(s,r,n,d=new c(_e)),N=0,L=r-1,S=0,q=_e-r,i=ye;Ye>=i;){for(y=~~(i*Ie),p=~~(y*be),v=~~(i*ze),g=~~(v*be),M=v*r,I=g*r,b=He*I,A=r-y,H=n-v,U=y*v,E=1/U,O=He,w=b;H>O;O+=g,w+=I)for(C=Ae;A>C;C+=p)if(z=C-1+w-r,Y=z+y,X=z+M,x=X+y,z=0>z?0:z>xe?xe:z,Y=0>Y?0:Y>xe?xe:Y,X=0>X?0:X>xe?xe:X,x=0>x?0:x>xe?xe:x,!(Oe&&(D=E*(d[x]-d[X]-d[Y]+d[z]),we>D||D>Me))){for(R=E*(o[x]-o[X]-o[Y]+o[z]),P=E*(l[x]-l[X]-l[Y]+l[z]),T=P-R*R,T=T>1?m(T):1,G=!0,F=0;Fe>F;F++){for($=ge[F],j=$.thres,W=$.trees,B=W.length,de=0,k=0;B>k;k++)for(J=W[k].feats,V=0;;){if(K=J[V],Z=K.rects,ee=Z.length,re=K.thres,ne=0,K.tilt)for(te=0;ee>te;te++)ae=Z[te],ie=C+~~(i*ae[0]),se=(O-1+~~(i*ae[1]))*r,oe=C+~~(i*(ae[0]+ae[2])),le=(O-1+~~(i*(ae[1]+ae[2])))*r,ue=C+~~(i*(ae[0]-ae[3])),he=(O-1+~~(i*(ae[1]+ae[3])))*r,ce=C+~~(i*(ae[0]+ae[2]-ae[3])),fe=(O-1+~~(i*(ae[1]+ae[2]+ae[3])))*r,ie=N>ie?N:ie>L?L:ie,oe=N>oe?N:oe>L?L:oe,ue=N>ue?N:ue>L?L:ue,ce=N>ce?N:ce>L?L:ce,se=S>se?S:se>q?q:se,le=S>le?S:le>q?q:le,he=S>he?S:he>q?q:he,fe=S>fe?S:fe>q?q:fe,ne+=ae[4]*(u[ce+fe]-u[ue+he]-u[oe+le]+u[ie+se]);else for(te=0;ee>te;te++)ae=Z[te],ie=C-1+~~(i*ae[0]),oe=C-1+~~(i*(ae[0]+ae[2])),se=r*(O-1+~~(i*ae[1])),le=r*(O-1+~~(i*(ae[1]+ae[3]))),ie=N>ie?N:ie>L?L:ie,oe=N>oe?N:oe>L?L:oe,se=S>se?S:se>q?q:se,le=S>le?S:le>q?q:le,ne+=ae[4]*(o[oe+le]-o[ie+le]-o[oe+se]+o[ie+se]);if(Q=re*T>ne*E?0:1){if(K.has_r){de+=K.r_val;break}V=K.r_node}else{if(K.has_l){de+=K.l_val;break}V=K.l_node}}if(G=de>j,!G)break}G&&Xe.push({x:C,y:O,width:y,height:v})}i*=ve}return pe.objects=h(Xe,Ce),e}})}(r),!function(e,r){function t(e,r){for(;r[e][1]!==e;)r[e][1]=r[r[e][1]][1],e=r[e][1];return e}function a(e,r,n){var a=t(e,n),i=t(r,n);a!==i&&(n[a][1]=i)}function i(e){var r=e.highest;return r+1>e.length&&Array.prototype.push.apply(e,new Array(l)),e[r]=[r,r],++e.highest,r}function s(e,r,n){return 0===e[r+3]&&0===e[n+3]||e[r]===e[n]&&e[r+1]===e[n+1]&&e[r+2]===e[n+2]&&e[r+3]===e[n+3]}var o=e.Array32U,l=20;e.Create({name:"ConnectedComponentsFilter",connectivity:4,init:function(e){var r=this;r.connectivity=8===e?8:4},path:n,serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{connectivity:e.connectivity}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.connectivity=r.connectivity),n},apply:function(e,r,n){var u=this;if(!u._isOn)return e;var h,c,f,d,p,_,m,g,y,v,b,C=e.length,O=C>>>2,w=r<<2,M=8===u.connectivity?8:4,I=8===M,z=I?-1:0,Y=4*z;for(y=new Array(l),y.highest=0,v=new o(O),v[0]=i(y),p=1,h=4;r>p;p++,h+4)v[p]=s(e,h,h-4)?v[p-1]:i(y);for(_=1,g=r,h=w;n>_;_++,g+=r,h+=w)for(v[g]=s(e,h,h-w)?v[g-r]:i(y),p=1,c=4;r>p;p++,c+=4){for(d=s(e,h+c,h+c-4)?v[g+p-1]:-1,m=z,f=Y;1>m;m++,f+=4)s(e,h+c,h-w+c+f)&&(d>=0?a(d,v[g-r+p+m],y):d=v[g-r+p+m]);v[g+p]=d>=0?d:i(y),I&&s(e,h+c-4,h-w+c)&&a(v[g+p-1],v[g-r+p],y)}var X=y.highest>0?y.highest-1:1;for(p=0,h=0;C>h;h+=4,p++)b=~~(255-255*y[t(v[p],y)][0]/X),e[h]=b,e[h+1]=b,e[h+2]=b,e[h+3]=255;return e}})}(r),r});

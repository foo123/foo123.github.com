/**
*
*   Classy.js
*   @version: 0.9.3
*   @built on 2016-07-19 17:09:27
*
*   Object-Oriented micro-framework for JavaScript
*   https://github.com/foo123/classy.js
*
**/!function(e,n,i){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=i.call(e)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return i.moduleUri=n.uri,i.call(e)}):n in e||(e[n]=i.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[n]})}(this,"Classy",function(){"use strict";var e=void 0,n="constructor",i="prototype",t="__proto__",r="__static__",l="__private__",u="$super",a="$static",o="$latestatic",f="$class",c=2,s=4,b=8,d=256,m=Object,p=m[i],v=Function,g=v[i],h=String,y=Number,x=RegExp,w=Array,j=p.toString,E=(g.call.bind(g.toString),"hasOwnProperty"),_="propertyIsEnumerable",q=m.keys,I=m.defineProperty,$=function(e){return typeof e},A=function(e){throw new TypeError(e)},P=2,S=3,T=4,C=8,M=9,N=16,O=32,R=64,F=128,L=256,U=512,V=1024,k={"[object Array]":N,"[object RegExp]":F,"[object Number]":P,"[object String]":C,"[object Function]":R,"[object Object]":O},B=function(n){var i;return null===n?L:!0===n||!1===n?T:e===n?U:(i=j.call(n),i=k[i]||V,P===i||n instanceof y?isNaN(n)?S:P:C===i||n instanceof h?1===n.length?M:C:N===i||n instanceof w?N:F===i||n instanceof x?F:R===i||n instanceof v?R:O===i?O:V)},D=function(e,n){var i,t=n.length,r=[].concat(e);for(i=0;t>i;i++)-1<r.indexOf(n[i])||r.push(n[i]);return r},z=function(e,n){O!==B(e)&&A("bad desc");var i={};if(e[E]("enumerable")&&(i.enumerable=!!n.enumerable),e[E]("configurable")&&(i.configurable=!!n.configurable),e[E]("value")&&(i.value=n.value),e[E]("writable")&&(i.writable=!!e.writable),e[E]("get")){var t=e.get;R!==B(t)&&"undefined"!==t&&A("bad get"),i.get=t}if(e[E]("set")){var r=e.set;R!==B(r)&&"undefined"!==r&&A("bad set"),i.set=r}return("get"in i||"set"in i)&&("value"in i||"writable"in i)&&A("identity-confused descriptor"),i},G=m.defineProperties||function(e,n){"object"===$(e)&&null!==e||A("bad obj"),n=m(n);for(var i=q(n),t=[],r=0;r<i.length;r++)t.push([i[r],z(n[i[r]],e)]);for(var r=0;r<t.length;r++)I(e,t[r][0],t[r][1]);return e},H=function(){},J=m.create||function(e,n){var r,l=function(){};return l[i]=e,r=new l,r[t]=e,"object"===$(n)&&G(r,n),r},K=function(){var e,n,i,t,r,l,u,a=arguments;for(n=a[0]||{},e=a.length,l=1;e>l;l++)if(i=a[l],O===B(i))for(r in i)i[E](r)&&i[_](r)&&(t=i[r],u=B(t),P&u?n[r]=0+t:(C|N)&u?n[r]=t.slice(0):n[r]=t);return n},Q=function(e,i,t){var r,l,u=!!i;if(u||t)if(r={},i=u?i+"$":i,t&&R===B(t))for(l in e)e[E](l)&&(n!==l?(u&&R===B(e[l])&&(r[i+l]=e[l]),r[t(l,e[l])]=e[l]):r[l]=e[l]);else for(l in e)e[E](l)&&(n!==l?(u&&R===B(e[l])&&(r[i+l]=e[l]),t&&l in t?r[t[l]]=e[l]:r[l]=e[l]):r[l]=e[l]);else r=e;return r},W=function(e){var n=e[u]||H,i=e[u+"v"]||H,t=null;return[function(i,r,l,u,a,o,f,c,s,b,d){var m,p;return t===i?m=n.call(this,i,r,l,u,a,o,f,c,s,b,d):(p=e[i])&&(t=i,m=p.call(this,r,l,u,a,o,f,c,s,b,d),t=null),m},function(n,r){var l,u;return t===n?l=i.call(this,n,r):(u=e[n])&&(t=n,l=r&&r.length?u.apply(this,r):u.call(this),t=null),l}]},X=function(e,n){return this instanceof X?(this.factory=e,void(this.qualifier=(P===B(n)?n:0)|c)):new X(e,n)},Y=function(e,n){return this instanceof Y?(this.prop=e,void(this.qualifier=(P===B(n)?n:0)|c)):new Y(e,n)},Z=function(t,c,p,v){t=t||m,c=c||{};var g,h,y,x,w,j,_,I,$,A,S=t[a]||null,T=t[o]||{},M=t[i],F=null,L=K({},T),U=null,V={};c[E](n)||(c[n]=function(){}),g=c[n],c[E](l)&&(V=c[l]||{},delete c[l]),c[E](r)&&(F=c[r],U=q(F),delete c[r]);for($ in c)if(c[E]($)){if(A=c[$],A instanceof X){if(b&A.qualifier){d&A.qualifier?L[$]=A:((F=F||{})[$]=A.factory(t,V,g),(U=U||[]).push($)),delete c[$];continue}if(s&A.qualifier){V[$]=A,delete c[$];continue}A=c[$]=A.factory(M,V,g)}R===B(A)&&(A[u]=M[$]||H)}for($ in V)V[E]($)&&(A=V[$],A instanceof X&&(A=V[$]=A.factory(M,V,g)),R!==B(A)&&delete V[$]);if(g[i]=Q(J(M),p,v),g[i]=K(g[i],c),h=W(M),w={},w[f]=w[n]={value:g,enumerable:!1,writable:!0,configurable:!0},w[u]={value:h[0],enumerable:!1,writable:!0,configurable:!0},w[u+"v"]={value:h[1],enumerable:!1,writable:!0,configurable:!0},G(g[i],w),w={},S||U)for(S=D(S||[],U||[]),x=S.length,y=0;x>y;y++){if(j=S[y],_=null,F&&e!==F[j]){if((A=F[j])instanceof X){if((b|d)&A.qualifier){L[j]=A;continue}_=A.factory(t,V,g)}else{if(L[E](j))continue;_=F[j]}R===B(_)&&(_[u]=t[j]||H)}else e!==t[j]&&(I=B(t[j]),_=O===I?K(null,t[j]):(C|N)&I?t[j].slice(0):P&I?0+t[j]:t[j]);w[j]={value:_,enumerable:!1,writable:!0,configurable:!0}}for(j in L)L[E](j)&&(_=L[j].factory(t,V,g),w[j]={value:_,enumerable:!1,writable:!0,configurable:!0});return w[a]={value:S,enumerable:!1,writable:!0,configurable:!0},w[o]={value:L,enumerable:!1,writable:!0,configurable:!0},w[u]={value:t,enumerable:!1,writable:!0,configurable:!0},G(g,w),g},ee=K,ne=K,ie=function(n){var t,r,l,c;if(R===B(n)){if(u in n&&(n[u]=e),f in n&&(n[f]=e),o in n&&(n[o]=e),a in n){for(l=n[a],t=0,r=l.length;r>t;t++)c=l[t],c in n&&(R===B(n[c])&&n[c][u]&&(n[c][u]=e),n[c]=e);n[a]=e}l=n[i];for(c in l)R===B(l[c])&&(l[c][u]&&(l[c][u]=e),l[c]=e);l[u]=e,l[u+"v"]=e}},te=function(){var e=arguments,n=e.length,t=null;if(b===e[0])return e[1]||{};if(n>=2){var r=B(e[0]);r=R===r?{Extends:e[0]}:O===r?e[0]:{Extends:m};var l,u,a=e[1]||{},o={},f=r[E]("Extends")?r.Extends:r[E]("extends")?r["extends"]:m,c=r[E]("Implements")?r.Implements:r[E]("implements")?r["implements"]:null,s=r[E]("Mixin")?r.Mixin:r[E]("mixin")?r.mixin:null,d=null;if(c=c?[].concat(c):null,s=s?[].concat(s):null)for(l=0,u=s.length;u>l;l++)O===B(s[l])?s[l][E]("mixin")&&s[l].mixin&&s[l].mixin[i]&&(d=Q(s[l].mixin[i],s[l].namespace||null,s[l].as||null),o=ne(o,d)):s[l][i]&&(d=s[l][i],o=ne(o,d));if(c)for(l=0,u=c.length;u>l;l++)O===B(c[l])?c[l][E]("implements")&&c[l]["implements"]&&c[l]["implements"][i]&&(d=Q(c[l]["implements"][i],c[l].namespace||null,c[l].as||null),o=ee(o,d)):c[l][i]&&(d=c[l][i],o=ee(o,d));t=O===B(f)?Z(f["extends"]||m,K(o,a),f.namespace||null,f.as||null):Z(f,K(o,a))}else t=Z(m,e[0]);return t},re={VERSION:"0.9.3",PUBLIC:c,STATIC:b,LATE:d,PRIVATE:s,Type:B,Create:J,Merge:K,Alias:Q,Implements:ee,Mixin:ne,Extends:Z,Dispose:ie,Method:X,Prop:Y,Class:te};return re});
/**
*
*   Asynchronous.js
*   @version: 0.5.1
*
*   Simple JavaScript class to manage asynchronous, parallel, linear, sequential and interleaved tasks
*   https://github.com/foo123/asynchronous.js
*
**/
!function(n,e,t){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(n.$deps=n.$deps||{})&&(n.EXPORTED_SYMBOLS=[e])&&(n[e]=n.$deps[e]=t.call(n)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[e]=t.call(n)):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(e,[],function(r){r(e,t.call(n))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["module"],function(e){return t.moduleUri=e.uri,t.call(n)}):e in n||(n[e]=t.call(n)||1)&&"function"==typeof define&&define.amd&&define(function(){return n[e]})}(this,"Asynchronous",function n(e){"use strict";function t(n){var e,t=[];if(n)for(e in n)n[c](e)&&t.push(e+"="+(!0===n[e]||1===n[e]?"yes":!1===n[e]||0===n[e]?"no":n[e]));return t.join(",")}function r(n,e){n.$runmode=M,n.$running=!1}function o(n,e){var t,r=n,o=r.$queue;if(r.$runmode=x,o){for(;o.length&&(!o[0]||!o[0].canRun());)o.shift();o.length?(r.$running=!0,t=o.shift(),e?t.runWithArgs(e):t.run(),t.complete()):r.$running=!1}}function i(n,e){var t,r=n,o=r.$queue,s=0;if(r.$runmode=R,o&&o.length){for(r.$running=!0;s<o.length;)t=o[s],t&&t.canRun()?(e?t.runWithArgs(e):t.run(),t.isFinished()?(o.shift(),t.complete()):s++):o.shift();r.$running=!1,r.$timer=N(v(i,r),r.$interval)}}function s(n,e){var t,r=n,o=r.$queue;r.$runmode=O,o&&o.length&&(t=o[0],t&&t.canRun()?(r.$running=!0,e?t.runWithArgs(e):t.run(),t.isFinished()&&(o.shift(),t.complete())):o.shift(),r.$running=!1,r.$timer=N(v(s,r),r.$interval))}var u,l="prototype",c="hasOwnProperty",a=Object,f=Array,p=Function,d=p[l],h=a[l],m=f[l],$=(JSON.parse,JSON.stringify),g=function(){},v=function(n,e){return function(){return n(e)}},w=d.call.bind(m.slice),y=h.toString,b=function(n){return"function"==typeof n},S=function(n,e){return n instanceof e},N=setTimeout,k=clearTimeout,j=e,E=0,T=1,q=2,W=60,A=0,R=1,x=2,M=3,O=4,C="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"],L="undefined"!=typeof global&&"[object global]"===y.call(global),I=L&&"undefined"!=typeof process.send,U=!C&&!L&&"undefined"!=typeof SharedWorkerGlobalScope&&"function"==typeof importScripts,B=!C&&!L&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,D=!(C||L||B||U||"undefined"==typeof navigator||"undefined"==typeof document),F=(D&&!!window.opener,D&&window.self!==window.top,"function"==typeof define&&define.amd),P=L||"function"==typeof Worker||"function"==typeof SharedWorker,_=L?this:U||B?self||this:window||this,z=L?module.$deps:U||B?self||this:window||this,G=(L?global:U||B?self||this:window||this,I||U||B),J=I&&0===process.listenerCount("message")||U&&!_.onconnect||B&&!_.onmessage,V=J?function un(n){un.handler&&un.handler(I?n:n.data)}:g,K=null,Q={},X=(L?require("os").cpus().length:4,L?null:"undefined"!=typeof _.webkitURL?_.webkitURL:"undefined"!=typeof _.URL?_.URL:null),Y=function(n,e){return n&&X?X.createObjectURL(new Blob(n.push?n:[n],e||{type:"text/javascript"})):n},H=function ln(n){var e;return L?{file:__filename,path:__dirname}:U||B?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:F&&n?{file:e=n,path:e.split("/").slice(0,-1).join("/")}:D&&(e=document.getElementsByTagName("script"))&&e.length?(ln.link||(ln.link=document.createElement("a")),ln.link.href=e[e.length-1].src,e=ln.link.href,{file:e,path:e.split("/").slice(0,-1).join("/")}):{path:null,file:null}},Z=H(n.moduleUri),nn=Z.file,en=function(n,e){if(n=n||{},e)for(var t in e)e[c](t)&&(n[t]=e[t]);return n},tn=0;Q[nn]=1,L?(u=function(n){var e=this;e.process=require("child_process").fork(n),e.process.on("message",function(n){e.onmessage&&e.onmessage(n)}),e.process.on("error",function(n){e.onerror&&e.onerror(n)})},u.Shared=u,u[l]={constructor:u,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.send(n),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}):(u=function(n){var e=this;e.process=new Worker(n),e.process.onmessage=function(n){e.onmessage&&e.onmessage(n.data)},e.process.onerror=function(n){e.onerror&&e.onerror(n)}},u.Shared=u,u[l]={constructor:u,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.postMessage(n),this},terminate:function(){return this.process&&(this.process.terminate(),this.process=null),this}},"function"==typeof SharedWorker&&(u.Shared=function(n){var e=this;e.process=new SharedWorker(n),e.process.port.start(),e.process.port.onmessage=function(n){e.onmessage&&e.onmessage(n.data)},e.process.port.onerror=e.process.onerror=function(n){e.onerror&&e.onerror(n)}},u.Shared[l]={constructor:u.Shared,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.port.postMessage(n),this},terminate:function(){return this.process&&(this.process.port.close(),this.process=null),this}})),J&&(U?(_.close=g,_.postMessage=g,_.onconnect=function(n){var e=n.ports[0];_.close=function(){e.close()},_.postMessage=function(n){e.postMessage(n)},e.addEventListener("message",V),e.start()}):B?_.onmessage=V:I&&(_.close=function(){process.exit()},_.postMessage=function(n){process.send(n)},_.importScripts=function(n){try{new Function("",require("fs").readFileSync(n).toString()).call(z)}catch(e){throw e}},process.on("message",V)));var rn=function cn(n){var e=this;return e instanceof cn?(e.$id=(++tn).toString(16),void(e.options=en({width:400,height:400,toolbar:0,location:0,directories:0,status:0,menubar:0,scrollbars:1,resizable:1},n))):new cn(n)};rn[l]={constructor:rn,options:null,$id:null,$window:null,dispose:function(){var n=this;return n.$window&&n.close(),n.$window=null,n.$id=null,n.options=null,n},close:function(){var n=this;return n.$window&&(n.$window.closed||n.$window.close(),n.$window=null),n},ready:function(n,e){var t=this,r=function o(){!t.$window||n&&!t.$window[n]?setTimeout(o,60):e()};return setTimeout(r,0),t},open:function(n){var e=this;return!e.$window&&n&&(e.$window=window.open(n.push?Y(["\ufeff"].concat(n),{type:"text/html;charset=utf-8"}):n,e.$id,t(e.options))),e},write:function(n){var e=this;return e.$window&&n&&e.$window.document.write(n),e}};var on=function an(n){if(n instanceof an)return n;if(!(this instanceof an))return new an(n);var t,r=this,o=null,i=null,s=null,u=!1,l=!1,c=!1,a=!1,f=!1,p=!1,d=null,h=0,m=1,$=null,g=null,v=null,w=e;r.queue=function(n){return arguments.length?(o=n,r):o},r.jumpNext=function(n){o&&o.jumpNext(!1,n)},r.abort=function(n){o&&(o.abort(!1),n&&(o.dispose(),o=null))},r.dispose=function(){o&&(o.dispose(),o=null)},r.task=function(n){return i=n,r},n&&r.task(n),r.run=t=function(){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,w=i(),u=!0,i.jumpNext=null,i.abort=null,i.dispose=null,w},r.runWithArgs=function(n){return i.jumpNext=r.jumpNext,i.abort=r.abort,i.dispose=r.dispose,w=i.apply(null,n),u=!0,i.jumpNext=null,i.abort=null,i.dispose=null,w},r.canRun=function(){return i&&(!u||l||c||a||f||p)?(l||c)&&h>=$?!1:c&&!d?!1:!a&&!f||w!==g:!1},r.iif=function(n,e,t){return n?r.task(e):arguments.length>2&&r.task(t),r},r.until=function(n){return w=e,d=null,g=n,f=!0,p=!1,l=!1,c=!1,a=!1,r.run=t,r},r.untilNot=function(n){return w=e,d=null,v=n,p=!0,f=!1,l=!1,c=!1,a=!1,r.run=t,r},r.loop=function(n,t,o){return w=e,d=null,h=t||0,m=o||1,$=n,l=!0,f=!1,p=!1,c=!1,a=!1,r.run=function(){var n;return n=i(h),h+=m,w=n,u=!0,n},r},r.each=function(n){return w=e,d=n,h=0,m=1,$=n?n.length||0:0,c=!0,f=!1,p=!1,l=!1,a=!1,r.run=function(){var n;return n=i(d[h],h),h++,w=n,u=!0,n},r},r.recurse=function(n,e){return d=null,w=n,g=e,a=!0,f=!1,p=!1,l=!1,c=!1,r.run=function(){var n;return n=i(w),w=n,u=!0,n},r},r.isFinished=function(){var n=!u||p||f||l||c||a;return n&&(f||a)&&w===g&&(n=!1),n&&p&&w!==v&&(n=!1),n&&(l||c)&&h>=$&&(n=!1),!n},r.onComplete=function(n){return s=n||null,r},r.complete=function(){return s&&b(s)&&s(),r}},sn=function fn(n,e){if(S(n,on))return n;if(b(n))return new on(n);if(!S(this,fn))return new fn(n,e);var t=this;t.$interval=arguments.length?parseInt(n,10)||W:W,t.$timer=null,t.$runmode=A,t.$running=!1,t.$queue=[],J&&!1!==e&&t.initThread()};return sn.VERSION="0.5.1",sn.Thread=u,sn.Task=on,sn.BrowserWindow=rn,sn.MODE={NONE:A,INTERLEAVE:R,LINEAR:x,PARALLEL:M,SEQUENCE:O},sn.Platform={UNDEFINED:j,UNKNOWN:E,NODE:T,BROWSER:q},sn.supportsMultiThreading=function(){return P},sn.isPlatform=function(n){return T===n?L:q===n?D:e},sn.isThread=function(n,e){return e=!0===e?J:!0,T===n?e&&I:q===n?e&&(U||B):e&&G},sn.path=H,sn.blob=Y,sn.load=function(n,e,t){if(n){var r=function(){n=n.split(".");for(var e=z;n.length;)n[0]&&n[0].length&&e[n[0]]&&(e=e[n[0]]),n.shift();return e&&_!==e?b(e)?!1!==t?new e:e():e:void 0};return e&&e.length&&sn.importScripts(e.join?e.join(","):e),r()}return null},sn.listen=J?function(n){V.handler=n}:g,sn.send=J?function(n){_.postMessage(n)}:g,sn.importScripts=J?function(n){if(n&&n.length){n.split&&(n=n.split(","));for(var e=0,t=n.length;t>e;e++){var r=n[e];r&&r.length&&1!==Q[r]&&(_.importScripts(r),Q[r]=1)}}}:g,sn.close=J?function(){_.close()}:g,sn.log="undefined"!=typeof console?function(n){console.log(n||"")}:g,sn.serialize=function(n){n=n||new sn(0,!1);var e=function(e){var t=function(){var t=this,r=arguments;n.step(function(){e.apply(t,r)}),n.$running||n.run(x)};return t.free=function(){return e},t};return e.free=function(){n&&n.dispose(),n=null},e},sn[l]={constructor:sn,$interval:W,$timer:null,$queue:null,$thread:null,$events:null,$runmode:A,$running:!1,dispose:function(n){var e=this;return e.unfork(!0),e.$timer&&k(e.$timer),e.$thread=null,e.$timer=null,e.$interval=null,e.$queue=null,e.$runmode=A,e.$running=!1,J&&!0===n&&sn.close(),e},empty:function(){var n=this;return n.$timer&&k(n.$timer),n.$timer=null,n.$queue=[],n.$runmode=A,n.$running=!1,n},interval:function(n){return arguments.length?(this.$interval=parseInt(n,10)||this.$interval,this):this.$interval},fork:function(n,e,t,r){var o,i,s,l=this;if(!l.$thread){if(!P)throw l.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");L?(i="Asynchronous: Thread (Process): ",s="Asynchronous: Thread (Process) Error: "):(i="Asynchronous: Thread (Worker): ",s="Asynchronous: Thread (Worker) Error: "),l.$events=l.$events||{},o=l.$thread=!0===r?new u.Shared(nn):new u(nn),o.onmessage=function(n){if(n.event){var e=n.event,t=n.data||null;l.$events&&l.$events[e]?l.$events[e](t):"console.log"!==e&&"console.error"!==e||sn.log(("console.error"===e?s:i)+(t||""))}},o.onerror=function(n){if(!l.$events||!l.$events.error)throw new Error(s+n.toString());l.$events.error(n)},l.send("initThread",{component:n||null,asInstance:!1!==t,imports:e?[].concat(e).join(","):null})}return l},unfork:function(n){var e=this;return e.$thread&&(!0===n?e.$thread.terminate():e.send("dispose")),e.$thread=null,e.$events=null,e},initThread:function(){var n=this;return J&&(n.$events={},sn.listen(function(e){var t=e.event,r=e.data||null;t&&n.$events[t]?n.$events[t](r):"dispose"===t&&(n.dispose(),sn.close())})),n},listen:function(n,e){return n&&b(e)&&this.$events&&(this.$events[n]=e),this},unlisten:function(n,e){return n&&this.$events&&this.$events[n]&&(2>arguments.length||e===this.$events[n])&&delete this.$events[n],this},send:function(n,e){return n&&(J?sn.send({event:n,data:e||null}):this.$thread&&this.$thread.postMessage({event:n,data:e||null})),this},task:function(n){return S(n,on)?n:b(n)?on(n):void 0},iif:function(){var n=arguments,e=new on;return e.iif.apply(e,n)},until:function(){var n=w(arguments),e=new on(n.pop());return e.until.apply(e,n)},untilNot:function(){var n=w(arguments),e=new on(n.pop());return e.untilNot.apply(e,n)},loop:function(){var n=w(arguments),e=new on(n.pop());return e.loop.apply(e,n)},each:function(){var n=w(arguments),e=new on(n.pop());return e.each.apply(e,n)},recurse:function(){var n=w(arguments),e=new on(n.pop());return e.recurse.apply(e,n)},step:function(n){var e=this;return n&&e.$queue.push(e.task(n).queue(e)),e},steps:function(){var n,e,t=this,r=arguments;for(e=r.length,n=0;e>n;n++)t.step(r[n]);return t},jumpNext:function(n,e){var t=this,r=t.$queue;return e=e||0,!1!==n?function(){return e<r.length&&(e>0&&r.splice(0,e),t.run(t.$runmode)),t}:(e<r.length&&(e>0&&r.splice(0,e),t.run(t.$runmode)),t)},jumpNextWithArgs:function(n,e,t){var r=this,o=r.$queue;return e=e||0,!1!==n?function(){return e<o.length&&(e>0&&o.splice(0,e),r.run(r.$runmode,arguments)),r}:(e<o.length&&(e>0&&o.splice(0,e),r.run(r.$runmode,t)),r)},abort:function(n,e){var t=this;return!1!==n?function(){return e&&e>0?N(function(){t.empty()},e):t.empty(),t}:(e&&e>0?N(function(){t.empty()},e):t.empty(),t)},run:function(n,e){var t=this;return arguments.length?t.$runmode=n:n=t.$runmode,e=e||null,O===n?s(t,e):R===n?i(t,e):x===n?o(t,e):M===n&&r(t,e),t}},J&&(sn.log=function(n){sn.send({event:"console.log",data:"string"!=typeof n?$(n):n})},sn.listen(function(n){var e=n.event,t=n.data||null;switch(e){case"initThread":t&&t.component&&(K&&(b(K.dispose)&&K.dispose(),K=null),K=sn.load(t.component,t.imports,t.asInstance));break;case"dispose":K&&(b(K.dispose)&&K.dispose(),K=null),sn.close()}})),sn});
/**
*
*   FILTER.js
*   @version: 0.9.5
*   @built on 2016-08-16 22:32:37
*   @dependencies: Classy.js, Asynchronous.js
*
*   JavaScript Image Processing Library
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e,r){"use strict";function n(t,e,r,n){return t?e.map(function(e,a){return(r?t[a]:t[e])||(n?n(e):null)}):[]}var a="Classy,Asynchronous".split(/\s*,\s*/);"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[e]=r.apply(t,n(module.$deps,a,!1,function(t){return require("./"+t.toLowerCase())}))):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["module"].concat(a),function(e){return r.moduleUri=e.uri,r.apply(t,n(Array.prototype.slice.call(arguments,1),a,!0))}):e in t||(t[e]=r.apply(t,n(t,a)))&&"function"==typeof define&&define.amd&&define(function(){return t[e]})}(this,"FILTER",function e(r,n){"use strict";var a={VERSION:"0.9.5",Classy:r,Asynchronous:n,Class:r.Class,Path:n.path(e.moduleUri)};return!function(t,e,r){var n,a,i="prototype",o="hasOwnProperty",s=Object.keys,l=(Object[i],Function[i],Array[i]),u=e.Path,h=e.Classy.Merge,f=e.Asynchronous,c=f.isPlatform(f.Platform.NODE),d=f.isPlatform(f.Platform.BROWSER),g=f.supportsMultiThreading(),p=f.isThread(null,!0),m=f.isThread(),v="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",_="undefined"!=typeof navigator&&navigator.platform?navigator.platform:"",y="undefined"!=typeof navigator&&navigator.vendor?navigator.vendor:"",w=function(){},C=function(t){return function e(){var r=this;return r instanceof e?(r.$super("constructor"),void t.apply(r,1===arguments.length&&!0===arguments[0].__arguments__?arguments[0]:arguments)):arguments.length?(arguments.__arguments__=!0,new e(arguments)):new e}},I=(e.devicePixelRatio=(d&&!m?window.devicePixelRatio:1)||1,e._notSupportClamp="undefined"==typeof Uint8ClampedArray),R=0,b=Math.min,A=Math.max,x=e.Browser={isNode:c,isBrowser:d,isWorker:p,isInsideWorker:m,supportsWorker:g,isPhantom:/PhantomJS/.test(v),isOpera:d&&/Opera|OPR\//.test(v),isFirefox:d&&/Firefox\//.test(v),isChrome:d&&/Chrome\//.test(v),isSafari:d&&/Apple Computer/.test(y),isKhtml:d&&/KHTML\//.test(v),isIE:d&&(/MSIE \d/.test(v)||/Trident\/\d/.test(v)),isGecko:d&&/gecko\/\d/i.test(v),isWebkit:d&&/WebKit\//.test(v),isMac_geLion:d&&/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(v),isMac_geMountainLion:d&&/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(v),isMobile:!1,isIOS:/AppleWebKit/.test(v)&&/Mobile\/\w+/.test(v),isWin:/windows/i.test(_),isMac:!1,isIE_lt8:!1,isIE_lt9:!1,isQtWebkit:!1};x.isMobile=x.isIOS||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(v),x.isMac=x.isIOS||/Mac/.test(_),x.isIE_lt8=x.isIE&&!m&&(null==document.documentMode||document.documentMode<8),x.isIE_lt9=x.isIE&&!m&&(null==document.documentMode||document.documentMode<9),x.isQtWebkit=x.isWebkit&&/Qt\/\d+\.\d+/.test(v),e.getPath=f.path,e.uuid=function(t){return[t||"filter",(new Date).getTime(),++R].join("_")},e.Array=Array,e.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,e.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,e.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,e.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,e.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,e.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,e.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,e.ImArray=I?e.Array8U:Uint8ClampedArray,e.ImArrayCopy=x.isOpera?e.Array8U:e.ImArray,e.ColorTable=e.ImArrayCopy,e.AffineMatrix=e.ColorMatrix=e.ConvolutionMatrix=e.Array32F,e.CHANNEL={R:0,G:1,B:2,A:3,RED:0,GREEN:1,BLUE:2,ALPHA:3,Y:1,CB:2,CR:0,H:0,S:2,V:1,I:1,HUE:0,SATURATION:2,INTENSITY:1,CY:2,MA:0,YE:1,K:3,CYAN:2,MAGENTA:0,YELLOW:1,BLACK:3},e.STRIDE={CHANNEL:[0,0,1],X:[0,1,4],Y:[1,0,4],RGB:[0,1,2],ARGB:[3,0,1,2],RGBA:[0,1,2,3],BGR:[2,1,0],ABGR:[3,2,1,0],BGRA:[2,1,0,3]},e.MODE={IGNORE:0,WRAP:1,CLAMP:2,COLOR:3,COLOR32:3,TILE:4,STRETCH:5,INTENSITY:6,HUE:7,SATURATION:8,GRAY:9,GRAYSCALE:9,RGB:10,RGBA:11,HSV:12,CMY:13,CMYK:13,PATTERN:14,COLOR8:15,COLORMASK:16,COLORMASK32:16,COLORMASK8:17,MATRIX:18,LINEAR:19,RADIAL:20,NONLINEAR:21,STATISTICAL:22,ADAPTIVE:23,THRESHOLD:24},e.LUMA=new e.Array32F([.212671,.71516,.072169]),e.FORMAT={IMAGE:1024,DATA:2048,PNG:2,JPG:3,JPEG:4,GIF:5,BMP:6,TGA:7,RGBE:8},e.MIME={PNG:"image/png",JPG:"image/jpeg",JPEG:"image/jpeg",GIF:"image/gif",BMP:"image/bmp"},e.CONSTANTS=e.CONST={X:0,Y:1,Z:2,PI:Math.PI,PI2:2*Math.PI,PI_2:Math.PI/2,toRad:Math.PI/180,toDeg:180/Math.PI},n=c?function(t,e){return null==t||t instanceof e?t:Array.isArray(t)?Array===e?t:new e(t):(null==t.length&&(t.length=Object.keys(t).length),Array===e?Array.prototype.slice.call(t):new e(Array.prototype.slice.call(t)))}:function(t,e){return t},I=e._notSupportClamp=I||x.isOpera,e.Util={Array:{hasClampedArray:"undefined"!=typeof Uint8ClampedArray,hasArrayset:"undefined"!=typeof Int16Array&&"function"==typeof Int16Array[i].set,hasSubarray:"function"==typeof e.Array32F[i].subarray,typed:n,typed_obj:c?function(t,e){return null==t?t:e?JSON.parse(t):JSON.stringify(t)}:function(t){return t}},String:{},List:{},Math:{},IO:{},Filter:{},Image:{},GLSL:{},SVG:{}},e.IO={},e.Codec={},e.Interpolation={},e.Transform={},e.MachineLearning=e.ML={},e.GLSL={},e.SVG={},e.NotImplemented=function(t){return t?function(){throw new Error('Method "'+t+'" not Implemented!')}:function(){throw new Error("Method not Implemented!")}},a=e.log=p?f.log:"undefine"!=typeof console&&console.log?function(t){console.log(t)}:function(t){},e.warning=function(t){a("WARNING: "+t)},e.error=function(t,e){if(a("ERROR: "+t),e)throw new Error(t)};var M=e.FilterThread=e.Class(f,{path:u,name:null,_listener:null,_rand:null,constructor:function(){var t=this,r=null;p&&t.initThread().listen("load",function(t){t&&t.filter&&(r&&(r.dispose(!0),r=null),r=f.load("FILTER."+t.filter))}).listen("import",function(t){t&&t["import"]&&t["import"].length&&f.importScripts(t["import"].join?t["import"].join(","):t["import"])}).listen("apply",function(a){if(r&&a&&a.im){var i=a.im;i[0]=n(i[0],e.ImArray),a.params&&r.unserializeFilter(a.params),a.inputs&&r.unserializeInputs(a.inputs,i),i=r._apply(i[0],i[1],i[2]),t.send("apply",{im:r._update?i:!1,meta:r.hasMeta?r.getMeta(!0):null})}else t.send("apply",{im:null})}).listen("dispose",function(e){r&&(r.dispose(!0),r=null),t.dispose(!0)})},dispose:function(t){var e=this;return e.path=null,e.name=null,e._rand=null,e._listener&&(e._listener.cb=null,e._listener=null),e.$super("dispose",t),e},thread:function(t,e){var r=this;return arguments.length||(t=!0),t=!!t,t&&!r.$thread?(null===r._rand&&(r._rand=c?"":(-1===r.path.file.indexOf("?")?"?":"&")+(new Date).getTime()),r.fork("FILTER.FilterThread",u.file!==r.path.file?[u.file,r.path.file+r._rand]:r.path.file+r._rand),e&&e.length&&r.send("import",{"import":e.join?e.join(","):e}),r.send("load",{filter:r.name}),r.listen("apply",r._listener=function n(t){n.cb&&n.cb(t)})):!t&&r.$thread&&(r._listener.cb=null,r._listener=null,r.unfork()),r},sources:function(){if(!arguments.length)return this;var t=arguments[0]instanceof Array?arguments[0]:l.slice.call(arguments);if(t.length){var e,r=[];for(e=0;e<t.length;e++)r.push(f.blob("function"==typeof t[e]?t[e].toString():t[e]));this.send("import",{"import":r.join(",")})}return this},scripts:function(){if(!arguments.length)return this;var t=arguments[0]instanceof Array?arguments[0]:l.slice.call(arguments);return t.length&&this.send("import",{"import":t.join(",")}),this}}),S=e.Filter=e.Class(M,{name:"Filter",constructor:function(){var t=this;t._inputs={}},id:null,_isOn:!0,_update:!0,_inputs:null,_meta:null,onComplete:null,mode:0,selection:null,hasInputs:!1,hasMeta:!1,dispose:function(){var t=this;return t.name=null,t.id=null,t._isOn=null,t._update=null,t._inputs=null,t._meta=null,t.onComplete=null,t.mode=null,t.selection=null,t.hasInputs=null,t.hasMeta=null,t.$super("dispose"),t},worker:M[i].thread,setInput:function(t,e){var r=this;return t=String(t),null===e?r._inputs[t]&&delete r._inputs[t]:r._inputs[t]=[null,e],r},unsetInput:function(t){var e=this;return t=String(t),e._inputs[t]&&delete e._inputs[t],e},delInput:null,resetInputs:function(){return this._inputs={},this},input:function(t){var e=this._inputs[String(t)];return e?((null==e[0]||e[1]&&e[1]._refresh)&&(e[0]=e[1].getSelectedData()),e[0]||null):null},getInput:null,serialize:function(){return null},unserialize:function(t){return this},serializeInputs:function(t){if(!this.hasInputs)return null;var e,r,n,a=this._inputs,i=s(a),o=i.length;if(!o)return null;for(n={},r=0;o>r;r++)e=a[i[r]],(null==e[0]||e[1]&&e[1]._refresh)&&(n[i[r]]=t===e[1]?!0:e[1].getSelectedData());return n},unserializeInputs:function(t,r){var a=this;if(!t||!a.hasInputs)return a;var i,o,l=a._inputs,u=s(t),h=u.length,f=e.ImArray;for(o=0;h>o;o++)i=t[u[o]],i&&(!0===i?i=r:i[0]=n(i[0],f),l[u[o]]=[i,null]);return a},serializeFilter:function(){var t=this;return{filter:t.name,_isOn:t._isOn,_update:t._update,mode:t.mode,selection:t.selection,params:t.serialize()}},unserializeFilter:function(t){var e=this;return t&&e.name===t.filter&&(e._isOn=t._isOn,e._update=t._update,e.mode=t.mode||0,e.selection=t.selection||null,e._isOn&&t.params&&e.unserialize(t.params)),e},select:function(t,e,r,n){var a=this;return!1===t?a.selection=null:a.selection=[b(1,A(0,t||0)),b(1,A(0,e||0)),b(1,A(0,r||0)),b(1,A(0,n||0))],a},deselect:function(){return this.selection=null,this},complete:function(t){return this.onComplete=t||null,this},setMode:function(t){return this.mode=t,this},getMode:function(){return this.mode},isOn:function(){return this._isOn},update:function(t){return arguments.length||(t=!0),this._update=!!t,this},turnOn:function(t){return arguments.length||(t=!0),this._isOn=!!t,this},toggle:function(){return this._isOn=!this._isOn,this},reset:function(){return this.resetInputs(),this},canRun:function(){return this._isOn},meta:function(t){return this._meta},getMeta:null,setMeta:function(t,e){return this._meta=t,this},combineWith:function(t){return this},_apply:function(t,e,r,n){return t},apply:function(t,r,a){var i,o,s=this;return s.canRun()?(arguments.length<3&&(r&&r.setSelectedData?a=null:"function"==typeof r?(a=r,r=t):(r=t,a=null)),t&&r&&(a=a||s.onComplete,i=t.getSelectedData(),s.$thread?(s._listener.cb=function(t){s._listener.cb=null,t&&(t.meta&&s.setMeta(t.meta,!0),t.im&&s._update&&(s.hasMeta&&null!=s._meta._IMG_WIDTH&&r.dimensions(s._meta._IMG_WIDTH,s._meta._IMG_HEIGHT),r.setSelectedData(n(t.im,e.ImArray)))),a&&a.call(s)},s.send("apply",{im:i,params:s.serializeFilter(),inputs:s.serializeInputs(t)})):(o=s._apply(i[0],i[1],i[2],{src:t,dst:r}),s._update&&(s.hasMeta&&null!=s._meta._IMG_WIDTH&&r.dimensions(s._meta._IMG_WIDTH,s._meta._IMG_HEIGHT),r.setSelectedData(o)),a&&a.call(s))),t):t},toString:function(){return"[FILTER: "+this.name+"]"}});e.Filter[i].getMeta=e.Filter[i].meta,e.Filter[i].getInput=e.Filter[i].input,e.Filter[i].delInput=e.Filter[i].unsetInput,e.Filter.get=function(t){if(!t||!t.length)return null;if(-1<t.indexOf(".")){t=t.split(".");var r,n,a=t.length,i=e;for(r=0;a>r;r++){if(n=t[r],!i[n])return null;i=i[n]}return i}return e[t]||null},e.Create=function(t){t=h({init:w,name:"PluginFilter"},t);var r=t.name;return t.constructor=C(t.init),null==t._apply&&"function"==typeof t.apply&&(t._apply=t.apply),"function"==typeof t.meta&&t.meta!==S[i].meta?t.getMeta=t.meta:"function"==typeof t.getMeta&&t.getMeta!==S[i].getMeta&&(t.meta=t.getMeta),delete t.init,t[o]("apply")&&delete t.apply,e[r]=e.Class(S,t)}}(this,a),!function(t,e){function r(t){return t.toString().match(ut)[1]||""}function n(t,e,r){r=r||0;var n,a,i=e.length,o=31&i;for(n=0;i>n;n+=32)a=n,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a,t[a+r]=e[a],++a;if(o)for(a=i-o;i>a;a++)t[a+r]=e[a]}function a(t,e,r){return t>r?r:e>t?e:t}function i(t){return Z(2,tt(at(t)))}function o(t,e){var r=new U(2);return r[0]=t||0,r[1]=e||0,r}function s(t,e,r){var n=new U(3);return n[0]=t||0,n[1]=e||0,n[2]=r||0,n}function l(t,e,r){return o(t[0]+r*(e[0]-t[0]),t[1]+r*(e[1]-t[1]))}function u(t,e,r){return s(t[0]+r*(e[0]-t[0]),t[1]+r*(e[1]-t[1]),t[2]+r*(e[2]-t[2]))}function h(t,e){return t[0]*e[1]-e[0]*t[1]}function f(t,e){var r;return 0>t&&(t=-t),0>e&&(e=-e),0===t?e:0===e?t:t>e?(r=e/t,t*Q(1+r*r)):(r=t/e,e*Q(1+r*r))}function c(t,e){var r,n,a,i,s;return r=o(t[0]-e[0],t[1]-e[1]),0===r[1]&&0===r[0]?null:(n=o(0,0),0===r[0]&&(n[0]=10),0===r[1]&&(n[1]=10),0!==r[1]&&0!==r[0]&&(a=r[1]/r[0],i=-r[0]/r[1],n[0]=10,n[1]=i*n[0]),s=f(n[0],n[1]),n[0]/=s,n[1]/=s,0>h(r,n)&&(n[0]=-n[0],n[1]=-n[1]),n)}function d(t,e,r,n,a,i,o){i=rt(i,e-1),o=rt(o,r-1);var s,l,u,h,f=i-n+1,c=o-a+1,d=f*c<<2,g=new B(d),p=f<<2;for(s=a,l=a*e,u=0;o>=s;s++,l+=e,u+=p)h=l+n<<2,g.set(t.subarray(h,h+p),u);return g}function g(t,e,r,a,i,o,s){o=rt(o,e-1),s=rt(s,r-1);var l,u,h,f,c=o-a+1,d=s-i+1,g=c*d<<2,p=new B(g),m=c<<2;for(l=i,u=i*e,h=0;s>=l;l++,u+=e,h+=m)f=u+a<<2,n(p,t.slice(f,f+m),h);return p}function p(t,e,r,n,a,i,o){n=n||0,a=a||0,i=i||0,o=o||0;var s,l,u,h,f=e+i+n,c=r+o+a,d=f*c<<2,g=new B(d),p=e<<2,m=f<<2,v=o*m,_=i<<2;for(s=0,l=0,u=v;r>s;s++,l+=e,u+=m)h=l<<2,g.set(t.subarray(h,h+p),_+u);return g}function m(t,e,r,a,i,o,s){a=a||0,i=i||0,o=o||0,s=s||0;var l,u,h,f,c=e+o+a,d=r+s+i,g=c*d<<2,p=new B(g),m=e<<2,v=c<<2,_=s*v,y=o<<2;for(l=0,u=0,h=_;r>l;l++,u+=e,h+=v)f=u<<2,n(p,t.slice(f,f+m),y+h);return p}function v(t,e,r,n,a,i,o,s){if(n=rt(n,e-1),a=rt(a,r-1),i=rt(i,e-1),o=rt(o,r-1),0===n&&0===a&&e===i+1&&r===o+1)return!0===s?t:new N(t);if(!t.length||n>i||a>o)return new B(0);var l,u,h,f,c=i-n+1,d=o-a+1,g=c*d<<2,p=new B(g);for(l=n,u=a,h=0;o>=u;h+=4,l++)l>i&&(l=n,u++),f=u*e+l<<2,p[h]=t[f],p[h+1]=t[f+1],p[h+2]=t[f+2],p[h+3]=t[f+3];return p}function _(t,e,r,n,a,i,o,s,l,u,h,f){var c,d,g,p;if(!(t.length&&n.length&&a&&i&&e&&r))return t;for(o=rt(o,a-1),s=rt(s,i-1),h=rt(h,e-1),f=rt(f,r-1),l=rt(l,a-1),u=rt(u,i-1),h-=o,f-=s,g=o,p=s;u>=p;g++)g>l&&(g=o,p++),p+f>=r||g+h>=e||(c=p*a+g<<2,d=(p+f)*e+g+h<<2,t[d]=n[c],t[d+1]=n[c+1],t[d+2]=n[c+2],t[d+3]=n[c+3]);return t}function y(t,e,r,n,a,i,o,s){if(a=rt(a,e-1),i=rt(i,r-1),o=rt(o,e-1),s=rt(s,r-1),!t.length||a>o||i>s)return t;var l,u,h,f=255&n[0],c=255&n[1],d=255&n[2],g=3<n.length?255&n[3]:255;for(l=a,u=i;s>=u;l++)l>o&&(l=a,u++),h=u*e+l<<2,t[h]=f,t[h+1]=c,t[h+2]=d,t[h+3]=g;return t}function w(t,e,r,n){n=n||0;var a,i,o,s,l=t.length,u=l>>>2,h=e<<2,f=(31&e)<<2,c=new U(u);for(o=0,a=0,i=n;i<rowlen;i+=128)a+=t[i],c[o++]=a,a+=t[i+4],c[o++]=a,a+=t[i+8],c[o++]=a,a+=t[i+12],c[o++]=a,a+=t[i+16],c[o++]=a,a+=t[i+20],c[o++]=a,a+=t[i+24],c[o++]=a,a+=t[i+28],c[o++]=a,a+=t[i+32],c[o++]=a,a+=t[i+36],c[o++]=a,a+=t[i+40],c[o++]=a,a+=t[i+44],c[o++]=a,a+=t[i+48],c[o++]=a,a+=t[i+52],c[o++]=a,a+=t[i+56],c[o++]=a,a+=t[i+60],c[o++]=a,a+=t[i+64],c[o++]=a,a+=t[i+68],c[o++]=a,a+=t[i+72],c[o++]=a,a+=t[i+76],c[o++]=a,a+=t[i+80],c[o++]=a,a+=t[i+84],c[o++]=a,a+=t[i+88],c[o++]=a,a+=t[i+92],c[o++]=a,a+=t[i+96],c[o++]=a,a+=t[i+100],c[o++]=a,a+=t[i+104],c[o++]=a,a+=t[i+108],c[o++]=a,a+=t[i+112],c[o++]=a,a+=t[i+116],c[o++]=a,a+=t[i+120],c[o++]=a,a+=t[i+124],c[o++]=a;if(f)for(i=rowlen-f+n;i<rowlen;i+=4,o++)a+=t[i],c[o]=a;for(s=0,o=0,a=0,i=h+n;l>i;i+=128)a+=t[i],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+4],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+8],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+12],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+16],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+20],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+24],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+28],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+32],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+36],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+40],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+44],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+48],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+52],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+56],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+60],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+64],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+68],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+72],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+76],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+80],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+84],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+88],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+92],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+96],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+100],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+104],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+108],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+112],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+116],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+120],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0),a+=t[i+124],c[o+e]=c[o]+a,++o,++s>=e&&(s=0,a=0);if(f)for(i=l-f+n;l>i;i+=4,s++,o++)s>=e&&(s=0,a=0),a+=t[i],c[o+e]=c[o]+a;return c}function C(t,e,r,n,a){n=n||0;var i,o,s,l=t.length,u=l>>>2,h=(31&u)<<2;for(o=new U(256),i=n;l>i;i+=128)o[t[i]]++,o[t[i+4]]++,o[t[i+8]]++,o[t[i+12]]++,o[t[i+16]]++,o[t[i+20]]++,o[t[i+24]]++,o[t[i+28]]++,o[t[i+32]]++,o[t[i+36]]++,o[t[i+40]]++,o[t[i+44]]++,o[t[i+48]]++,o[t[i+52]]++,o[t[i+56]]++,o[t[i+60]]++,o[t[i+64]]++,o[t[i+68]]++,o[t[i+72]]++,o[t[i+76]]++,o[t[i+80]]++,o[t[i+84]]++,o[t[i+88]]++,o[t[i+92]]++,o[t[i+96]]++,o[t[i+100]]++,o[t[i+104]]++,o[t[i+108]]++,o[t[i+112]]++,o[t[i+116]]++,o[t[i+120]]++,o[t[i+124]]++;if(h)for(i=l-h+n;l>i;i+=4)o[t[i]]++;if(!0===a)return o;for(s=0,i=0;256>i;i+=64)s+=o[i],o[i]=s,s+=o[i+1],o[i+1]=s,s+=o[i+2],o[i+2]=s,s+=o[i+3],o[i+3]=s,s+=o[i+4],o[i+4]=s,s+=o[i+5],o[i+5]=s,s+=o[i+6],o[i+6]=s,s+=o[i+7],o[i+7]=s,s+=o[i+8],o[i+8]=s,s+=o[i+9],o[i+9]=s,s+=o[i+10],o[i+10]=s,s+=o[i+11],o[i+11]=s,s+=o[i+12],o[i+12]=s,s+=o[i+13],o[i+13]=s,s+=o[i+14],o[i+14]=s,s+=o[i+15],o[i+15]=s,s+=o[i+16],o[i+16]=s,s+=o[i+17],o[i+17]=s,s+=o[i+18],o[i+18]=s,s+=o[i+19],o[i+19]=s,s+=o[i+20],o[i+20]=s,s+=o[i+21],o[i+21]=s,s+=o[i+22],o[i+22]=s,s+=o[i+23],o[i+23]=s,s+=o[i+24],o[i+24]=s,s+=o[i+25],o[i+25]=s,s+=o[i+26],o[i+26]=s,s+=o[i+27],o[i+27]=s,s+=o[i+28],o[i+28]=s,s+=o[i+29],o[i+29]=s,s+=o[i+30],o[i+30]=s,s+=o[i+31],o[i+31]=s,s+=o[i+32],o[i+32]=s,s+=o[i+33],o[i+33]=s,s+=o[i+34],o[i+34]=s,s+=o[i+35],o[i+35]=s,s+=o[i+36],o[i+36]=s,s+=o[i+37],o[i+37]=s,s+=o[i+38],o[i+38]=s,s+=o[i+39],o[i+39]=s,s+=o[i+40],o[i+40]=s,s+=o[i+41],o[i+41]=s,s+=o[i+42],o[i+42]=s,s+=o[i+43],o[i+43]=s,s+=o[i+44],o[i+44]=s,s+=o[i+45],o[i+45]=s,s+=o[i+46],o[i+46]=s,s+=o[i+47],o[i+47]=s,s+=o[i+48],o[i+48]=s,s+=o[i+49],o[i+49]=s,s+=o[i+50],o[i+50]=s,s+=o[i+51],o[i+51]=s,s+=o[i+52],o[i+52]=s,s+=o[i+53],o[i+53]=s,s+=o[i+54],o[i+54]=s,s+=o[i+55],o[i+55]=s,s+=o[i+56],o[i+56]=s,s+=o[i+57],o[i+57]=s,s+=o[i+58],o[i+58]=s,s+=o[i+59],o[i+59]=s,s+=o[i+60],o[i+60]=s,s+=o[i+61],o[i+61]=s,s+=o[i+62],o[i+62]=s,s+=o[i+63],o[i+63]=s;return o}function I(t,e,r,n){return null}function R(t,e,r,n,a,i){var o,s,l,u,h,f,c,d=t.length,g=e<<2,p=(31&e)<<2;for(h=0,u=0,o=s=0;g>u;u+=128)l=t[u],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+4],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+8],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+12],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+16],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+20],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+24],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+28],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+32],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+36],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+40],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+44],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+48],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+52],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+56],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+60],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+64],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+68],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+72],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+76],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+80],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+84],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+88],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+92],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+96],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+100],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+104],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+108],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+112],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+116],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+120],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h,l=t[u+124],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s,++h;if(p)for(u=g-p;g>u;u+=4,h++)l=t[u],o+=l,n[h]=o,i[h]=l,s+=l*l,a[h]=s;for(f=0,c=1,h=0,o=0,s=0,u=g;d>u;u+=128)l=t[u],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+4],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+8],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+12],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+16],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+20],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+24],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+28],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+32],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+36],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+40],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+44],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+48],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+52],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+56],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+60],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+64],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+68],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+72],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+76],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+80],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+84],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+88],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+92],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+96],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+100],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+104],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+108],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+112],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+116],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+120],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0),l=t[u+124],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0),++h,++f>=e&&(f=0,c++,o=s=0);if(p)for(u=d-p;d>u;u+=4,f++,h++)f>=e&&(f=0,c++,o=s=0),l=t[u],o+=l,n[h+e]=n[h]+o,s+=l*l,a[h+e]=a[h]+s,i[h+e]=i[h+1-e]+(l+t[h-e<<2])+(c>1?i[h-e-e]:0)+(f>0?i[h-1-e]:0)}function b(t,e,r,n,a,i){var o,s,l,u,h,f,c,d,g,p,m,v,_,y=n.length,w=e-1,C=r-1,I=e-2,R=r-2,b=e<<1,A=e<<2;for(_=new K(y),o=2,s=2,l=b;I>o;s++,l+=e)s>=R&&(s=2,l=b,o++),d=o+l<<2,g=d+A,p=g+A,m=d-A,v=m-A,u=(t[v-8]<<1)+(t[m-8]<<2)+(t[d-8]<<2)+t[d-8]+(t[g-8]<<2)+(t[p-8]<<1)+(t[v-4]<<2)+(t[m-4]<<3)+t[m-4]+(t[d-4]<<4)-(t[d-4]<<2)+(t[g-4]<<3)+t[g-4]+(t[p-4]<<2)+(t[v]<<2)+t[v]+(t[m]<<4)-(t[m]<<2)+(t[d]<<4)-t[d]+(t[g]<<4)-(t[g]<<2)+(t[p]<<2)+t[p]+(t[v+4]<<2)+(t[m+4]<<3)+t[m+4]+(t[d+4]<<4)-(t[d+4]<<2)+(t[g+4]<<3)+t[g+4]+(t[p+4]<<2)+(t[v+8]<<1)+(t[m+8]<<2)+(t[d+8]<<2)+t[d+8]+(t[g+8]<<2)+(t[p+8]<<1),_[d]=(103*u+8192&4294967295)>>>14&255|0;if(a){for(o=1,s=1,l=e;w>o;s++,l+=e)s>=C&&(s=1,l=e,o++),d=l+o,g=d+e,m=d-e,n[d]=_[m+1]-_[m-1]-_[d-1]-_[d-1]+_[d+1]+_[d+1]-_[g-1]+_[g+1],a[d]=_[m-1]+_[m]+_[m]+_[m+1]-_[g-1]-_[g]-_[g]-_[g+1];if(i){for(o=0,u=h=0;e>o;o++)u+=n[o],h+=a[o],n[o]=u,a[o]=h;for(o=e,l=0,u=h=0;y>o;o++,l++)l>=e&&(l=0,u=h=0),u+=n[o],n[o]=n[o-e]+u,h+=a[o],a[o]=a[o-e]+h}}else{for(o=1,s=1,l=e;w>o;s++,l+=e)s>=C&&(s=1,l=e,o++),d=l+o,g=d+e,m=d-e,f=_[m+1]-_[m-1]-_[d-1]-_[d-1]+_[d+1]+_[d+1]-_[g-1]+_[g+1],c=_[m-1]+_[m]+_[m]+_[m+1]-_[g-1]-_[g]-_[g]-_[g+1],n[d]=nt(f)+nt(c);if(i){for(o=0,u=0;e>o;o++)u+=n[o],n[o]=u;for(o=e,l=0,u=0;y>o;o++,l++)l>=e&&(l=0,u=0),u+=n[o],n[o]=n[o-e]+u}}}function A(t,e,r,n,a,i,o,s,l,u,h){var f,c,d,g,p,m,v,_,y,w,C,I,R,b,A,x,M,S,D,E,O,G,L,T,k,P,F,H,N,Y,K,W,j,X,z,$,q,V,J,Q,Z,tt,et,rt,nt,at,ot,st,lt=e.length,ut=lt>>>2,ht=o,ft=s,ct=r<<2;if(_=ht*ft,m=ht>>>1,v=r*(ft>>>1),C=-m-1,R=-v-r,I=m,b=v,Y=0,W=r-1,K=0,j=ut-r,y=e,e=new B(lt),h=h||1,it.GRAY===t)if(c=ut,w=r,f=new U(c),i)for(E=a[0],O=a[_>>>1],G=O-E,L=i[0],T=i[_>>>1],k=T-L,ot=0;h>ot;ot++){for(st=e,e=y,y=st,A=0,x=0,d=0,M=0;r>M;M++,A+=4,x++)d+=e[A],f[x]=d;for(x=0,M=0,d=0,A=ct;lt>A;A+=4,x++,M++)M>=r&&(M=0,d=0),d+=e[A],f[x+w]=f[x]+d;for(M=0,S=0,D=0,A=0;lt>A;A+=4,M++)M>=r&&(M=0,S++,D+=r),P=M+C,F=D+R,H=M+I,N=D+b,P=Y>P?Y:P,H=H>W?W:H,F=K>F?K:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,Z=E*(f[q]-f[z]-f[$]+f[X])+G*e[A],rt=L*(f[q]-f[z]-f[$]+f[X])+k*e[A],V=l*Z+u*rt,y[A]=0|V,y[A+1]=0|V,y[A+2]=0|V,y[A+3]=e[A+3]}else for(E=a[0],O=a[_>>>1],G=O-E,ot=0;h>ot;ot++){for(st=e,e=y,y=st,A=0,x=0,d=0,M=0;r>M;M++,A+=4,x++)d+=e[A],f[x]=d;for(x=0,M=0,d=0,A=ct;lt>A;A+=4,x++,M++)M>=r&&(M=0,d=0),d+=e[A],f[x+w]=f[x]+d;for(M=0,S=0,D=0,A=0;lt>A;A+=4,M++)M>=r&&(M=0,S++,D+=r),P=M+C,F=D+R,H=M+I,N=D+b,P=Y>P?Y:P,H=H>W?W:H,F=K>F?K:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,Z=E*(f[q]-f[z]-f[$]+f[X])+G*e[A],V=l*Z+u,y[A]=0|V,y[A+1]=0|V,y[A+2]=0|V,y[A+3]=e[A+3]}else if(c=(ut<<1)+ut,w=(r<<1)+r,f=new U(c),i)for(E=a[0],O=a[_>>>1],G=O-E,L=i[0],T=i[_>>>1],k=T-L,ot=0;h>ot;ot++){for(st=e,e=y,y=st,A=0,x=0,d=g=p=0,M=0;r>M;M++,A+=4,x+=3)d+=e[A],g+=e[A+1],p+=e[A+2],f[x]=d,f[x+1]=g,f[x+2]=p;for(x=0,M=0,d=g=p=0,A=ct;lt>A;A+=4,x+=3,M++)M>=r&&(M=0,d=g=p=0),d+=e[A],g+=e[A+1],p+=e[A+2],f[x+w]=f[x]+d,f[x+w+1]=f[x+1]+g,f[x+w+2]=f[x+2]+p;for(M=0,S=0,D=0,A=0;lt>A;A+=4,M++)M>=r&&(M=0,S++,D+=r),P=M+C,F=D+R,H=M+I,N=D+b,P=Y>P?Y:P,H=H>W?W:H,F=K>F?K:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,X=(X<<1)+X,z=(z<<1)+z,$=($<<1)+$,q=(q<<1)+q,Z=E*(f[q]-f[z]-f[$]+f[X])+G*e[A],tt=E*(f[q+1]-f[z+1]-f[$+1]+f[X+1])+G*e[A+1],et=E*(f[q+2]-f[z+2]-f[$+2]+f[X+2])+G*e[A+2],rt=L*(f[q]-f[z]-f[$]+f[X])+k*e[A],nt=L*(f[q+1]-f[z+1]-f[$+1]+f[X+1])+k*e[A+1],at=L*(f[q+2]-f[z+2]-f[$+2]+f[X+2])+k*e[A+2],V=l*Z+u*rt,J=l*tt+u*nt,Q=l*et+u*at,y[A]=0|V,y[A+1]=0|J,y[A+2]=0|Q,y[A+3]=e[A+3]}else for(E=a[0],O=a[_>>>1],G=O-E,ot=0;h>ot;ot++){for(st=e,e=y,y=st,A=0,x=0,d=g=p=0,M=0;r>M;M++,A+=4,x+=3)d+=e[A],g+=e[A+1],p+=e[A+2],f[x]=d,f[x+1]=g,f[x+2]=p;for(x=0,M=0,d=g=p=0,A=ct;lt>A;A+=4,x+=3,M++)M>=r&&(M=0,d=g=p=0),d+=e[A],g+=e[A+1],p+=e[A+2],f[x+w]=f[x]+d,f[x+w+1]=f[x+1]+g,f[x+w+2]=f[x+2]+p;for(M=0,S=0,D=0,A=0;lt>A;A+=4,M++)M>=r&&(M=0,S++,D+=r),P=M+C,F=D+R,H=M+I,N=D+b,P=Y>P?Y:P,H=H>W?W:H,F=K>F?K:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,X=(X<<1)+X,z=(z<<1)+z,$=($<<1)+$,q=(q<<1)+q,Z=E*(f[q]-f[z]-f[$]+f[X])+G*e[A],tt=E*(f[q+1]-f[z+1]-f[$+1]+f[X+1])+G*e[A+1],et=E*(f[q+2]-f[z+2]-f[$+2]+f[X+2])+G*e[A+2],V=l*Z+u,J=l*tt+u,Q=l*et+u,y[A]=0|V,y[A+1]=0|J,y[A+2]=0|Q,y[A+3]=e[A+3]}return y}function x(t,e,r,n,a,i,o,s,l,u,h){var f,c,d,g,p,m,v,_,y,w,C,I,R,b,A,x,M,S,D,E,O,G,L,T,k,P,F,H,N,Y,K,W,j,X,z,$,q,V,J,Q,Z,tt,et,rt,nt,at,ot,st,lt=e.length,ut=lt>>>2,ht=o,ft=s,ct=r<<2;if(_=ht*ft,m=ht>>>1,v=r*(ft>>>1),C=-m-1,R=-v-r,I=m,b=v,Y=0,W=r-1,K=0,j=ut-r,y=e,e=new B(lt),h=h||1,it.GRAY===t)if(c=ut,w=r,f=new U(c),i)for(E=a[0],O=a[_>>>1],G=O-E,L=i[0],T=i[_>>>1],k=T-L,ot=0;h>ot;ot++){for(st=e,e=y,y=st,A=0,x=0,d=0,M=0;r>M;M++,A+=4,x++)d+=e[A],f[x]=d;for(x=0,M=0,d=0,A=ct;lt>A;A+=4,x++,M++)M>=r&&(M=0,d=0),d+=e[A],f[x+w]=f[x]+d;for(M=0,S=0,D=0,A=0;lt>A;A+=4,M++)M>=r&&(M=0,S++,D+=r),P=M+C,F=D+R,H=M+I,N=D+b,P=Y>P?Y:P,H=H>W?W:H,F=K>F?K:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,Z=E*(f[q]-f[z]-f[$]+f[X])+G*e[A],rt=L*(f[q]-f[z]-f[$]+f[X])+k*e[A],V=l*Z+u*rt,V=0>V?0:V>255?255:V,y[A]=0|V,y[A+1]=0|V,y[A+2]=0|V,y[A+3]=e[A+3]}else for(E=a[0],O=a[_>>>1],G=O-E,ot=0;h>ot;ot++){for(st=e,e=y,y=st,A=0,x=0,d=0,M=0;r>M;M++,A+=4,x++)d+=e[A],f[x]=d;for(x=0,M=0,d=0,A=ct;lt>A;A+=4,x++,M++)M>=r&&(M=0,d=0),d+=e[A],f[x+w]=f[x]+d;for(M=0,S=0,D=0,A=0;lt>A;A+=4,M++)M>=r&&(M=0,S++,D+=r),P=M+C,F=D+R,H=M+I,N=D+b,P=Y>P?Y:P,H=H>W?W:H,F=K>F?K:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,Z=E*(f[q]-f[z]-f[$]+f[X])+G*e[A],V=l*Z+u,V=0>V?0:V>255?255:V,y[A]=0|V,y[A+1]=0|V,y[A+2]=0|V,y[A+3]=e[A+3]}else if(c=(ut<<1)+ut,w=(r<<1)+r,f=new U(c),i)for(E=a[0],O=a[_>>>1],G=O-E,L=i[0],T=i[_>>>1],k=T-L,ot=0;h>ot;ot++){for(st=e,e=y,y=st,A=0,x=0,d=g=p=0,M=0;r>M;M++,A+=4,x+=3)d+=e[A],g+=e[A+1],p+=e[A+2],f[x]=d,f[x+1]=g,f[x+2]=p;for(x=0,M=0,d=g=p=0,A=ct;lt>A;A+=4,x+=3,M++)M>=r&&(M=0,d=g=p=0),d+=e[A],g+=e[A+1],p+=e[A+2],f[x+w]=f[x]+d,f[x+w+1]=f[x+1]+g,f[x+w+2]=f[x+2]+p;for(M=0,S=0,D=0,A=0;lt>A;A+=4,M++)M>=r&&(M=0,S++,D+=r),P=M+C,F=D+R,H=M+I,N=D+b,P=Y>P?Y:P,H=H>W?W:H,F=K>F?K:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,X=(X<<1)+X,z=(z<<1)+z,$=($<<1)+$,q=(q<<1)+q,Z=E*(f[q]-f[z]-f[$]+f[X])+G*e[A],tt=E*(f[q+1]-f[z+1]-f[$+1]+f[X+1])+G*e[A+1],et=E*(f[q+2]-f[z+2]-f[$+2]+f[X+2])+G*e[A+2],rt=L*(f[q]-f[z]-f[$]+f[X])+k*e[A],nt=L*(f[q+1]-f[z+1]-f[$+1]+f[X+1])+k*e[A+1],at=L*(f[q+2]-f[z+2]-f[$+2]+f[X+2])+k*e[A+2],V=l*Z+u*rt,J=l*tt+u*nt,Q=l*et+u*at,V=0>V?0:V>255?255:V,J=0>J?0:J>255?255:J,Q=0>Q?0:Q>255?255:Q,y[A]=0|V,y[A+1]=0|J,y[A+2]=0|Q,y[A+3]=e[A+3]}else for(E=a[0],O=a[_>>>1],G=O-E,ot=0;h>ot;ot++){for(st=e,e=y,y=st,A=0,x=0,d=g=p=0,M=0;r>M;M++,A+=4,x+=3)d+=e[A],g+=e[A+1],p+=e[A+2],f[x]=d,f[x+1]=g,f[x+2]=p;for(x=0,M=0,d=g=p=0,A=ct;lt>A;A+=4,x+=3,M++)M>=r&&(M=0,d=g=p=0),d+=e[A],g+=e[A+1],p+=e[A+2],f[x+w]=f[x]+d,f[x+w+1]=f[x+1]+g,f[x+w+2]=f[x+2]+p;for(M=0,S=0,D=0,A=0;lt>A;A+=4,M++)M>=r&&(M=0,S++,D+=r),P=M+C,F=D+R,H=M+I,
N=D+b,P=Y>P?Y:P,H=H>W?W:H,F=K>F?K:F,N=N>j?j:N,X=P+F,q=H+N,z=H+F,$=P+N,X=(X<<1)+X,z=(z<<1)+z,$=($<<1)+$,q=(q<<1)+q,Z=E*(f[q]-f[z]-f[$]+f[X])+G*e[A],tt=E*(f[q+1]-f[z+1]-f[$+1]+f[X+1])+G*e[A+1],et=E*(f[q+2]-f[z+2]-f[$+2]+f[X+2])+G*e[A+2],V=l*Z+u,J=l*tt+u,Q=l*et+u,V=0>V?0:V>255?255:V,J=0>J?0:J>255?255:J,Q=0>Q?0:Q>255?255:Q,y[A]=0|V,y[A+1]=0|J,y[A+2]=0|Q,y[A+3]=e[A+3]}return y}function M(t,e,r,n,a,i,o,s,l,u){var h,f,c,d,g,p,m,v,_,y,w,C,I,R,b,A,x,M,S,D,E,O,G,L,T,k,P,F,H=e.length,N=H>>>2;for(A=r-1,x=N-r,m=new Y(o),w=0,d=o.length;d>w;w+=2)m[w+1]*=r;for(v=new Y(s),w=0,d=s.length;d>w;w+=2)v[w+1]*=r;if(P=2,f=a,c=o,k=l,p=m,g=e,e=new B(H),it.GRAY===t)for(;P--;){for(F=e,e=g,g=F,h=f.length,d=c.length,C=0,I=0,_=0;H>_;_+=4,C++){for(C>=r&&(C=0,I+=r),O=G=L=T=0,w=0,y=0;h>w;w++,y+=2)R=C+p[y],b=I+p[y+1],R>=0&&A>=R&&b>=0&&x>=b&&(srcOff=R+b<<2,E=f[w],O+=e[srcOff]*E);M=k*O,g[_]=0|M,g[_+1]=0|M,g[_+2]=0|M,g[_+3]=e[_+3]}f=i,c=s,k=u,p=v}else for(;P--;){for(F=e,e=g,g=F,h=f.length,d=c.length,C=0,I=0,_=0;H>_;_+=4,C++){for(C>=r&&(C=0,I+=r),O=G=L=T=0,w=0,y=0;h>w;w++,y+=2)R=C+p[y],b=I+p[y+1],R>=0&&A>=R&&b>=0&&x>=b&&(srcOff=R+b<<2,E=f[w],O+=e[srcOff]*E,G+=e[srcOff+1]*E,L+=e[srcOff+2]*E);M=k*O,S=k*G,D=k*L,g[_]=0|M,g[_+1]=0|S,g[_+2]=0|D,g[_+3]=e[_+3]}f=i,c=s,k=u,p=v}return g}function S(t,e,r,n,a,i,o,s,l,u){var h,f,c,d,g,p,m,v,_,y,w,C,I,R,b,A,x,M,S,D,E,O,G,L,T,k,P,F,H=e.length,N=H>>>2;for(A=r-1,x=N-r,m=new Y(o),w=0,d=o.length;d>w;w+=2)m[w+1]*=r;for(v=new Y(s),w=0,d=s.length;d>w;w+=2)v[w+1]*=r;if(P=2,f=a,c=o,k=l,p=m,g=e,e=new B(H),it.GRAY===t)for(;P--;){for(F=e,e=g,g=F,h=f.length,d=c.length,C=0,I=0,_=0;H>_;_+=4,C++){for(C>=r&&(C=0,I+=r),O=G=L=T=0,w=0,y=0;h>w;w++,y+=2)R=C+p[y],b=I+p[y+1],R>=0&&A>=R&&b>=0&&x>=b&&(srcOff=R+b<<2,E=f[w],O+=e[srcOff]*E);M=k*O,M=0>M?0:M>255?255:M,g[_]=0|M,g[_+1]=0|M,g[_+2]=0|M,g[_+3]=e[_+3]}f=i,c=s,k=u,p=v}else for(;P--;){for(F=e,e=g,g=F,h=f.length,d=c.length,C=0,I=0,_=0;H>_;_+=4,C++){for(C>=r&&(C=0,I+=r),O=G=L=T=0,w=0,y=0;h>w;w++,y+=2)R=C+p[y],b=I+p[y+1],R>=0&&A>=R&&b>=0&&x>=b&&(srcOff=R+b<<2,E=f[w],O+=e[srcOff]*E,G+=e[srcOff+1]*E,L+=e[srcOff+2]*E);M=k*O,S=k*G,D=k*L,M=0>M?0:M>255?255:M,S=0>S?0:S>255?255:S,D=0>D?0:D>255?255:D,g[_]=0|M,g[_+1]=0|S,g[_+2]=0|D,g[_+3]=e[_+3]}f=i,c=s,k=u,p=v}return g}function D(t,e){null==e&&(e=0),null==t&&(t=1);var r,n=new W(256);for(r=0;256>r;r+=32)n[r]=0|a(e+t*r,0,255),n[r+1]=0|a(e+t*(r+1),0,255),n[r+2]=0|a(e+t*(r+2),0,255),n[r+3]=0|a(e+t*(r+3),0,255),n[r+4]=0|a(e+t*(r+4),0,255),n[r+5]=0|a(e+t*(r+5),0,255),n[r+6]=0|a(e+t*(r+6),0,255),n[r+7]=0|a(e+t*(r+7),0,255),n[r+8]=0|a(e+t*(r+8),0,255),n[r+9]=0|a(e+t*(r+9),0,255),n[r+10]=0|a(e+t*(r+10),0,255),n[r+11]=0|a(e+t*(r+11),0,255),n[r+12]=0|a(e+t*(r+12),0,255),n[r+13]=0|a(e+t*(r+13),0,255),n[r+14]=0|a(e+t*(r+14),0,255),n[r+15]=0|a(e+t*(r+15),0,255),n[r+16]=0|a(e+t*(r+16),0,255),n[r+17]=0|a(e+t*(r+17),0,255),n[r+18]=0|a(e+t*(r+18),0,255),n[r+19]=0|a(e+t*(r+19),0,255),n[r+20]=0|a(e+t*(r+20),0,255),n[r+21]=0|a(e+t*(r+21),0,255),n[r+22]=0|a(e+t*(r+22),0,255),n[r+23]=0|a(e+t*(r+23),0,255),n[r+24]=0|a(e+t*(r+24),0,255),n[r+25]=0|a(e+t*(r+25),0,255),n[r+26]=0|a(e+t*(r+26),0,255),n[r+27]=0|a(e+t*(r+27),0,255),n[r+28]=0|a(e+t*(r+28),0,255),n[r+29]=0|a(e+t*(r+29),0,255),n[r+30]=0|a(e+t*(r+30),0,255),n[r+31]=0|a(e+t*(r+31),0,255);return n}function E(t,e){var r,n=new W(256);for(r=0;256>r;r+=64)n[r]=a(t[a(e[r],0,255)],0,255),n[r+1]=a(t[a(e[r+1],0,255)],0,255),n[r+2]=a(t[a(e[r+2],0,255)],0,255),n[r+3]=a(t[a(e[r+3],0,255)],0,255),n[r+4]=a(t[a(e[r+4],0,255)],0,255),n[r+5]=a(t[a(e[r+5],0,255)],0,255),n[r+6]=a(t[a(e[r+6],0,255)],0,255),n[r+7]=a(t[a(e[r+7],0,255)],0,255),n[r+8]=a(t[a(e[r+8],0,255)],0,255),n[r+9]=a(t[a(e[r+9],0,255)],0,255),n[r+10]=a(t[a(e[r+10],0,255)],0,255),n[r+11]=a(t[a(e[r+11],0,255)],0,255),n[r+12]=a(t[a(e[r+12],0,255)],0,255),n[r+13]=a(t[a(e[r+13],0,255)],0,255),n[r+14]=a(t[a(e[r+14],0,255)],0,255),n[r+15]=a(t[a(e[r+15],0,255)],0,255),n[r+16]=a(t[a(e[r+16],0,255)],0,255),n[r+17]=a(t[a(e[r+17],0,255)],0,255),n[r+18]=a(t[a(e[r+18],0,255)],0,255),n[r+19]=a(t[a(e[r+19],0,255)],0,255),n[r+20]=a(t[a(e[r+20],0,255)],0,255),n[r+21]=a(t[a(e[r+21],0,255)],0,255),n[r+22]=a(t[a(e[r+22],0,255)],0,255),n[r+23]=a(t[a(e[r+23],0,255)],0,255),n[r+24]=a(t[a(e[r+24],0,255)],0,255),n[r+25]=a(t[a(e[r+25],0,255)],0,255),n[r+26]=a(t[a(e[r+26],0,255)],0,255),n[r+27]=a(t[a(e[r+27],0,255)],0,255),n[r+28]=a(t[a(e[r+28],0,255)],0,255),n[r+29]=a(t[a(e[r+29],0,255)],0,255),n[r+30]=a(t[a(e[r+30],0,255)],0,255),n[r+31]=a(t[a(e[r+31],0,255)],0,255),n[r+32]=a(t[a(e[r+32],0,255)],0,255),n[r+33]=a(t[a(e[r+33],0,255)],0,255),n[r+34]=a(t[a(e[r+34],0,255)],0,255),n[r+35]=a(t[a(e[r+35],0,255)],0,255),n[r+36]=a(t[a(e[r+36],0,255)],0,255),n[r+37]=a(t[a(e[r+37],0,255)],0,255),n[r+38]=a(t[a(e[r+38],0,255)],0,255),n[r+39]=a(t[a(e[r+39],0,255)],0,255),n[r+40]=a(t[a(e[r+40],0,255)],0,255),n[r+41]=a(t[a(e[r+41],0,255)],0,255),n[r+42]=a(t[a(e[r+42],0,255)],0,255),n[r+43]=a(t[a(e[r+43],0,255)],0,255),n[r+44]=a(t[a(e[r+44],0,255)],0,255),n[r+45]=a(t[a(e[r+45],0,255)],0,255),n[r+46]=a(t[a(e[r+46],0,255)],0,255),n[r+47]=a(t[a(e[r+47],0,255)],0,255),n[r+48]=a(t[a(e[r+48],0,255)],0,255),n[r+49]=a(t[a(e[r+49],0,255)],0,255),n[r+50]=a(t[a(e[r+50],0,255)],0,255),n[r+51]=a(t[a(e[r+51],0,255)],0,255),n[r+52]=a(t[a(e[r+52],0,255)],0,255),n[r+53]=a(t[a(e[r+53],0,255)],0,255),n[r+54]=a(t[a(e[r+54],0,255)],0,255),n[r+55]=a(t[a(e[r+55],0,255)],0,255),n[r+56]=a(t[a(e[r+56],0,255)],0,255),n[r+57]=a(t[a(e[r+57],0,255)],0,255),n[r+58]=a(t[a(e[r+58],0,255)],0,255),n[r+59]=a(t[a(e[r+59],0,255)],0,255),n[r+60]=a(t[a(e[r+60],0,255)],0,255),n[r+61]=a(t[a(e[r+61],0,255)],0,255),n[r+62]=a(t[a(e[r+62],0,255)],0,255),n[r+63]=a(t[a(e[r+63],0,255)],0,255);return n}function O(){return new j([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0])}function G(t,e){var r=new j(20);return r[0]=e[0]*t[0]+e[1]*t[5]+e[2]*t[10]+e[3]*t[15],r[1]=e[0]*t[1]+e[1]*t[6]+e[2]*t[11]+e[3]*t[16],r[2]=e[0]*t[2]+e[1]*t[7]+e[2]*t[12]+e[3]*t[17],r[3]=e[0]*t[3]+e[1]*t[8]+e[2]*t[13]+e[3]*t[18],r[4]=e[0]*t[4]+e[1]*t[9]+e[2]*t[14]+e[3]*t[19]+e[4],r[5]=e[5]*t[0]+e[6]*t[5]+e[7]*t[10]+e[8]*t[15],r[6]=e[5]*t[1]+e[6]*t[6]+e[7]*t[11]+e[8]*t[16],r[7]=e[5]*t[2]+e[6]*t[7]+e[7]*t[12]+e[8]*t[17],r[8]=e[5]*t[3]+e[6]*t[8]+e[7]*t[13]+e[8]*t[18],r[9]=e[5]*t[4]+e[6]*t[9]+e[7]*t[14]+e[8]*t[19]+e[9],r[10]=e[10]*t[0]+e[11]*t[5]+e[12]*t[10]+e[13]*t[15],r[11]=e[10]*t[1]+e[11]*t[6]+e[12]*t[11]+e[13]*t[16],r[12]=e[10]*t[2]+e[11]*t[7]+e[12]*t[12]+e[13]*t[17],r[13]=e[10]*t[3]+e[11]*t[8]+e[12]*t[13]+e[13]*t[18],r[14]=e[10]*t[4]+e[11]*t[9]+e[12]*t[14]+e[13]*t[19]+e[14],r[15]=e[15]*t[0]+e[16]*t[5]+e[17]*t[10]+e[18]*t[15],r[16]=e[15]*t[1]+e[16]*t[6]+e[17]*t[11]+e[18]*t[16],r[17]=e[15]*t[2]+e[16]*t[7]+e[17]*t[12]+e[18]*t[17],r[18]=e[15]*t[3]+e[16]*t[8]+e[17]*t[13]+e[18]*t[18],r[19]=e[15]*t[4]+e[16]*t[9]+e[17]*t[14]+e[18]*t[19]+e[19],r}function L(t,e,r,n,a,i,o,s,l){var u=new j(20);return u[5*i+e]=t[0],u[5*i+r]=t[1],u[5*i+n]=t[2],u[5*i+a]=t[3],u[5*i+4]=t[4],u[5*o+e]=t[5],u[5*o+r]=t[6],u[5*o+n]=t[7],u[5*o+a]=t[8],u[5*o+4]=t[9],u[5*s+e]=t[10],u[5*s+r]=t[11],u[5*s+n]=t[12],u[5*s+a]=t[13],u[5*s+4]=t[14],u[5*l+e]=t[15],u[5*l+r]=t[16],u[5*l+n]=t[17],u[5*l+a]=t[18],u[5*l+4]=t[19],u}function T(t,e){var r=new X(8);return r[0]=t[0]*e[0]+t[1]*e[4],r[1]=t[0]*e[1]+t[1]*e[5],r[2]=t[0]*e[2]+t[1]*e[6]+t[2],r[3]=t[0]*e[3]+t[1]*e[7]+t[3],r[4]=t[4]*e[0]+t[5]*e[4],r[5]=t[4]*e[1]+t[5]*e[5],r[6]=t[4]*e[2]+t[5]*e[6]+t[6],r[7]=t[4]*e[3]+t[5]*e[7]+t[7],r}function k(){return new X([1,0,0,0,0,1,0,0])}function P(t,e,r,n,a){a=a||Array,r=r||1,n=n||1;for(var i=0,o=t.length,s=new a(o);o>i;i++)s[i]=r*t[i]+n*e[i];return s}function F(t,e,r){r=r||Array,e===+e&&(e=[e]);var n,a,i=t.length,o=e.length,s=new r(i*o);for(n=0,a=0;i>n;)s[n*o+a]=t[n]*e[a],++a>=o&&(a=0,n++);return s}function H(t){return t.replace(st,"\\$1")}var B=t.ImArray,N=t.ImArrayCopy,U=t.Array32F,Y=(t.Array64F,t.Array16I),K=t.Array8U,W=t.ColorTable,j=t.ColorMatrix,X=t.AffineMatrix,z=(t.ConvolutionMatrix,t.Util.Math),$=t.Util.String,q=t.Util.Array,V=t.Util.Image,J=t.Util.Filter,Q=Math.sqrt,Z=Math.pow,tt=Math.ceil,et=Math.log,rt=(Math.sin,Math.cos,Math.min),nt=(Math.max,Math.abs),at=(Math.PI,Math.log2||function(t){return et(t)/Math.LN2}),it=t.MODE,ot=t._notSupportClamp,st=(t._noTypedArraySet,/([.*+?^${}()|\[\]\/\\\-])/g),lt=/^\s+|\s+$/g,ut=/^function[^{]+{([\s\S]*)}$/;z.clamp=a,z.closest_power2=i,z.Geometry={Point2:o,Point3:s,enorm2:f,cross2:h,normal2:c,interpolate2:l,interpolate3:u},q.arrayset=q.hasArrayset?function(t,e,r){t.set(e,r||0)}:n,q.subarray=q.hasSubarray?function(t,e,r){return t.subarray(e,r)}:function(t,e,r){return t.slice(e,r)},$.esc=H,$.trim=String.prototype.trim?function(t){return t.trim()}:function(t){return t.replace(lt,"")},$.function_body=r,V.crop=t.Interpolation.crop=q.hasArrayset?d:g,V.pad=t.Interpolation.pad=q.hasArrayset?p:m,V.get_data=v,V.set_data=_,V.fill=y,V.integral=w,V.histogram=C,V.spectrum=I,J.ct_eye=D,J.ct_multiply=E,J.cm_eye=O,J.cm_multiply=G,J.cm_rechannel=L,J.am_eye=k,J.am_multiply=T,J.cm_combine=P,J.cm_convolve=F,J.integral_convolution=ot?x:A,J.separable_convolution=ot?S:M,J.SAT=R,J.GRAD=b}(a),!function(t,e){var r=t.Util.Math.clamp,n=t.ImArray;t.Interpolation.bilinear=function(t,e,a,i,o){var s,l,u,h,f,c,d,g,p,m,v,_,y,w,C,I,R,b,A,x=i*o<<2,M=new n(x),S=(e-1)/i,D=(a-1)/o,E=e<<2;for(p=0,m=0,v=0,_=0,w=0,R=0,A=0,I=0;x>I;I+=4,m++,v+=S)m>=i&&(m=0,v=0,p++,_+=D,w=~~_,A=_-w,R=w*e),y=~~v,b=v-y,f=(1-b)*(1-A),c=b*(1-A),d=A*(1-b),g=b*A,C=R+y<<2,s=t[C],l=t[C+4],u=t[C+E],h=t[C+E+4],M[I]=r(~~(s*f+l*c+u*d+h*g+.5),0,255),s=t[C+1],l=t[C+5],u=t[C+E+1],h=t[C+E+5],M[I+1]=r(~~(s*f+l*c+u*d+h*g+.5),0,255),s=t[C+2],l=t[C+6],u=t[C+E+2],h=t[C+E+6],M[I+2]=r(~~(s*f+l*c+u*d+h*g+.5),0,255),s=t[C+3],l=t[C+7],u=t[C+E+3],h=t[C+E+7],M[I+3]=r(~~(s*f+l*c+u*d+h*g+.5),0,255);return M}}(a),!function(e,r){function n(t,e,r,n,a){t[e]=255&(r[0]+a*(n[0]-r[0])|0),t[e+1]=255&(r[1]+a*(n[1]-r[1])|0),t[e+2]=255&(r[2]+a*(n[2]-r[2])|0),t[e+3]=255&(r[3]+a*(n[3]-r[3])|0)}var a=Math.sqrt,i=Math.round,o=(Math.floor,Math.min),s=Math.max,l=Math.abs,u=Math.sin,h=Math.cos,f=Math.PI,c=2*f,d=f/2,g=3*d,p=e.Util.Math.clamp,m=e.Util.String.esc,v=e.Util.String.trim,_=e.LUMA,y=(e.CHANNEL,1/255),w=100/255,C=2.55,I={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},R=e.Color=e.Class({__static__:{clamp:p,clampPixel:function(t){return o(255,s(t,0))},color24:function(t,e,r){return(255&t)<<16|(255&e)<<8|255&r},color32:function(t,e,r,n){return(255&n)<<24|(255&t)<<16|(255&e)<<8|255&r},rgb24:function(t){return[t>>>16&255,t>>>8&255,255&t]},rgba32:function(t){return[t>>>16&255,t>>>8&255,255&t,t>>>24&255]},intensity:function(t,e,r){return~~(_[0]*t+_[1]*e+_[2]*r)},hue:function(t,e,r){var n=s(t,e,r);return t===e&&e===r?0:t===n?60*l(e-r)/(n-o(t,e,r)):e===n?120+60*l(r-t)/(n-o(t,e,r)):240+60*l(t-e)/(n-o(t,e,r))},saturation:function(t,e,r){var n=s(t,e,r);return t===e&&e===r?0:255*(n-o(t,e,r))/n},dist:function(t,e,r,n){var i=t[r+0]-e[n+0],o=t[r+1]-e[n+1],s=t[r+2]-e[n+2];return a(i*i+o*o+s*s)},RGB2Gray:function(t,e){var r=_[0]*t[e+0]+_[1]*t[e+1]+_[2]*t[e+2]|0;return t[e+0]=r,t[e+1]=r,t[e+2]=r,t},RGB2Color:function(t,e){return(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},RGBA2Color:function(t,e){return(255&t[e+3])<<24|(255&t[e+0])<<16|(255&t[e+1])<<8|255&t[e+2]},Color2RGBA:function(t,e,r){return t=0|t,e[r+0]=t>>>16&255,e[r+1]=t>>>8&255,e[r+2]=255&t,e[r+3]=t>>>24&255,e},RGB2YCbCr:function(t,e){var r=t[e+0],n=t[e+1],a=t[e+2];return t[e+0]=0+.299*r+.587*n+.114*a|0,t[e+1]=128-.168736*r-.331264*n+.5*a|0,t[e+2]=128+.5*r-.418688*n-.081312*a|0,t},YCbCr2RGB:function(t,e){var r=t[e+0],n=t[e+1],a=t[e+2];return t[e+0]=r+1.402*(a-128)|0,t[e+1]=r-.34414*(n-128)-.71414*(a-128)|0,t[e+2]=r+1.772*(n-128)|0,t},RGB2HSV:function(t,e){var r,n,a,i,u,h,f=t[e+0],c=t[e+1],d=t[e+2];return n=s(f,c,d),h=n,f===c&&c===d?(u=0,i=0):(r=o(f,c,d),a=n-r,u=a/n,i=f===n?60*l(c-d)/a:c===n?120+60*l(d-f)/a:240+60*l(f-c)/a),t[e+0]=.7083333333333334*i,t[e+1]=255*u,t[e+2]=h,t},HSV2RGB:function(t,e){var r,n,a,i,o,s,l,u,h=1.411764705882353*t[e+0],f=.00392156862745098*t[e+1],c=t[e+2];return 0===f?s=l=u=c:(h/=60,r=~~h,n=h-r,a=c*(1-f),i=c*(1-f*n),o=c*(1-f*(1-n)),0===r?(s=c,l=o,u=a):1===r?(s=i,l=c,u=a):2===r?(s=a,l=c,u=o):3===r?(s=a,l=i,u=c):4===r?(s=o,l=a,u=c):(s=c,l=a,u=i)),t[e+0]=s,t[e+1]=l,t[e+2]=u,t},RGB2CMYK:function(t,e){var r,n=0,a=0,i=0,s=0,l=t[e+0],u=t[e+1],h=t[e+2];return 0===l&&0===u&&0===h?t:(n=255-l,a=255-u,i=255-h,s=o(n,a,i),r=255===s?0:255/(255-s),t[e+0]=(n-s)*r,t[e+1]=(a-s)*r,t[e+2]=(i-s)*r,t)},toString:function(){return"[FILTER: "+this.name+"]"},C2F:y,C2P:w,P2C:C,Keywords:I,hexieRE:/^#([0-9a-fA-F]{8})\b/,hexRE:/^#([0-9a-fA-F]{3,6})\b/,rgbRE:/^(rgba?)\b\s*\(([^\)]*)\)/i,hslRE:/^(hsla?)\b\s*\(([^\)]*)\)/i,keywordRE:new RegExp("^("+Object.keys(I).map(m).join("|")+")\\b","i"),colorstopRE:/^\s+(\d+(\.\d+)?%?)/,col2per:function(t,e){return t*w+(e||"")},per2col:function(t){return t*C},rgb2cmyk:function(t,e,r,n){var a,s,l=0,u=0,h=0,f=0;return n&&(t=p(i(t*C),0,255),e=p(i(e*C),0,255),r=p(i(r*C),0,255)),0===t&&0===e&&0===r?[0,0,0,1]:(l=1-t*y,u=1-e*y,h=1-r*y,a=o(l,u,h),s=1/(1-a),l=(l-a)*s,u=(u-a)*s,h=(h-a)*s,f=a,[l,u,h,f])},cmyk2rgb:function(t,e,r,n){var a,o,s=0,l=0,u=0;return 0===t&&0===e&&0===r?[0,0,0]:(a=n,o=1-a,t=t*o+a,e=e*o+a,r=r*o+a,s=255*(1-t),l=255*(1-e),u=255*(1-r),[p(i(s),0,255),p(i(l),0,255),p(i(u),0,255)])},rgb2hex:function(t,e,r,n,a){var o;return a&&(t=p(i(t*C),0,255),e=p(i(e*C),0,255),r=p(i(r*C),0,255)),t=16>t?"0"+t.toString(16):t.toString(16),e=16>e?"0"+e.toString(16):e.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),o=n&&t[0]===t[1]&&e[0]===e[1]&&r[0]===r[1]?"#"+t[0]+e[0]+r[0]:"#"+t+e+r},rgb2hexIE:function(t,e,r,n,a){var o;return a&&(t=p(i(t*C),0,255),e=p(i(e*C),0,255),r=p(i(r*C),0,255),n=p(i(n*C),0,255)),t=16>t?"0"+t.toString(16):t.toString(16),e=16>e?"0"+e.toString(16):e.toString(16),r=16>r?"0"+r.toString(16):r.toString(16),n=16>n?"0"+n.toString(16):n.toString(16),o="#"+n+t+e+r},hex2rgb:function(t){return!t||3>t.length?[0,0,0]:6>t.length?[p(parseInt(t[0]+t[0],16),0,255),p(parseInt(t[1]+t[1],16),0,255),p(parseInt(t[2]+t[2],16),0,255)]:[p(parseInt(t[0]+t[1],16),0,255),p(parseInt(t[2]+t[3],16),0,255),p(parseInt(t[4]+t[5],16),0,255)]},hue2rgb:function(t,e,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?t+6*(e-t)*r:.5>r?e:2/3>r?t+(e-t)*(2/3-r)*6:t},hsl2rgb:function(t,e,r){var n,a,o,s,l,u=R.hue2rgb;return t=(t+360)%360/360,e*=.01,r*=.01,0===e?(n=1,a=1,o=1):(l=.5>r?r*(1+e):r+e-r*e,s=2*r-l,n=u(s,l,t+1/3),a=u(s,l,t),o=u(s,l,t-1/3)),[p(i(255*n),0,255),p(i(255*a),0,255),p(i(255*o),0,255)]},rgb2hsl:function(t,e,r,n){var a,l,u,h,f,c;return n?(t*=.01,e*=.01,r*=.01):(t*=y,e*=y,r*=y),l=s(t,e,r),a=o(t,e,r),f=.5*(l+a),l===a?u=h=0:(c=l-a,h=f>.5?c/(2-s-o):c/(s+o),u=l==t?(e-r)/c+(r>e?6:0):l==e?(r-t)/c+2:(t-e)/c+4,u/=6),[i(360*u)%360,p(100*h,0,100),p(100*f,0,100)]},parse:function(t,e,r,n){var a,i,o,s,l,u=0,h=0;if("hsl"===r||!r&&(a=t.match(R.hslRE))){if("hsl"===r){l="hsla"===t[0].toLowerCase();var f=t[1].split(",").map(v)}else{u=a[0].length,h=0,l="hsla"===a[1].toLowerCase();var f=a[2].split(",").map(v)}var c=f[0]?f[0]:"0",t=f[1]?f[1]:"0",d=f[2]?f[2]:"0",g=l&&null!=f[3]?f[3]:"1";return c=parseFloat(c,10),t="%"===t.slice(-1)?parseFloat(t,10):parseFloat(t,10)*w,d="%"===d.slice(-1)?parseFloat(d,10):parseFloat(d,10)*w,g=parseFloat(g,10),s=(new R).fromHSL([c,t,d,g]),e&&(o=t.substr(u),(i=o.match(R.colorstopRE))&&(s.colorStop(i[1]),h=i[0].length)),n?s:[s,0,u+h]}if("rgb"===r||!r&&(a=t.match(R.rgbRE))){if("rgb"===r){l="rgba"===t[0].toLowerCase();var f=t[1].split(",").map(v)}else{u=a[0].length,h=0,l="rgba"===a[1].toLowerCase();var f=a[2].split(",").map(v)}var p=f[0]?f[0]:"0",m=f[1]?f[1]:"0",_=f[2]?f[2]:"0",g=l&&null!=f[3]?f[3]:"1";return p="%"===p.slice(-1)?2.55*parseFloat(p,10):parseFloat(p,10),m="%"===m.slice(-1)?2.55*parseFloat(m,10):parseFloat(m,10),_="%"===_.slice(-1)?2.55*parseFloat(_,10):parseFloat(_,10),g=parseFloat(g,10),s=(new R).fromRGB([p,m,_,g]),e&&(o=t.substr(u),(i=o.match(R.colorstopRE))&&(s.colorStop(i[1]),h=i[0].length)),n?s:[s,0,u+h]}if("hex"===r||!r&&(a=t.match(R.hexRE))){if("hex"===r)var f=R.hex2rgb(t[0]);else{u=a[0].length,h=0;var f=R.hex2rgb(a[1])}var y=f[0]?f[0]:0,C=f[1]?f[1]:0,I=f[2]?f[2]:0,g=null!=f[3]?f[3]:255;return s=(new R).fromHEX([y,C,I,g]),e&&(o=t.substr(u),(i=o.match(R.colorstopRE))&&(s.colorStop(i[1]),h=i[0].length)),n?s:[s,0,u+h]}if("keyword"===r||!r&&(a=t.match(R.keywordRE))){if("keyword"===r)var f=t[0];else{u=a[0].length,h=0;var f=a[1]}return s=(new R).fromKeyword(f),e&&(o=t.substr(u),(i=o.match(R.colorstopRE))&&(s.colorStop(i[1]),h=i[0].length)),n?s:[s,0,u+h]}return null},fromString:function(t,e,r){return R.parse(t,e,r,1)},fromRGB:function(t){return(new R).fromRGB(t)},fromHSL:function(t){return(new R).fromHSL(t)},fromCMYK:function(t){return(new R).fromCMYK(t)},fromHEX:function(t){return(new R).fromHEX(t)},fromKeyword:function(t){return(new R).fromKeyword(t)},fromPixel:function(t){return(new R).fromPixel(t)}},constructor:function b(t,e){return this instanceof b?(this.reset(),void(t&&this.set(t,e))):new b(t,e)},name:"Color",col:null,cstop:null,kword:null,clone:function(){var t=new R;return t.col=this.col.slice(),t.cstop=this.cstop+"",t.kword=this.kword,t},reset:function(){return this.col=[0,0,0,1],this.cstop="",this.kword=null,this},set:function(t,e){return t&&(r!==t[0]&&(this.col[0]=p(t[0],0,255)),r!==t[1]&&(this.col[1]=p(t[1],0,255)),r!==t[2]&&(this.col[2]=p(t[2],0,255)),r!==t[3]?this.col[3]=p(t[3],0,1):this.col[3]=1,e&&(this.cstop=e),this.kword=null),this},colorStop:function(t){return this.cstop=t,this},isTransparent:function(){return 1>this.col[3]},isKeyword:function(){return!!this.kword},fromPixel:function(t){return t=t||0,this.col=[p(t>>16&255,0,255),p(t>>8&255,0,255),p(255&t,0,255),p((t>>24&255)*y,0,1)],this.kword=null,this},fromKeyword:function(t){return t=t.toLowerCase(),R.Keywords[t]&&(this.col=R.Keywords[t].slice(),this.kword=t),this},fromHEX:function(t){return this.col[0]=t[0]?p(parseInt(t[0],10),0,255):0,this.col[1]=t[1]?p(parseInt(t[1],10),0,255):0,this.col[2]=t[2]?p(parseInt(t[2],10),0,255):0,this.col[3]=r!==t[3]?p(parseInt(t[3],10)*y,0,1):1,this.kword=null,this},fromRGB:function(t){return this.col[0]=t[0]?p(i(t[0]),0,255):0,this.col[1]=t[1]?p(i(t[1]),0,255):0,this.col[2]=t[2]?p(i(t[2]),0,255):0,this.col[3]=r!==t[3]?p(t[3],0,1):1,this.kword=null,this},fromCMYK:function(t){var e=R.cmyk2rgb(t[0]||0,t[1]||0,t[2]||0,t[3]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=r!==t[4]?p(t[4],0,1):1,this.kword=null,this},fromHSL:function(t){var e=R.hsl2rgb(t[0]||0,t[1]||0,t[2]||0);return this.col[0]=e[0],this.col[1]=e[1],this.col[2]=e[2],this.col[3]=r!==t[3]?p(t[3],0,1):1,this.kword=null,this},toPixel:function(t){return t?p(255*this.col[3],0,255)<<24|this.col[0]<<16|this.col[1]<<8|255&this.col[2]:this.col[0]<<16|this.col[1]<<8|255&this.col[2]},toCMYK:function(t,e,r){var n=R.rgb2cmyk(this.col[0],this.col[1],this.col[2]);return r?n:n.concat(this.col[3])},toKeyword:function(t,e,r){return this.kword?this.kword:this.toHEX(1,e,r)},toHEX:function(t,e,r){return r?R.rgb2hexIE(this.col[0],this.col[1],this.col[2],p(i(255*this.col[3]),0,255)):R.rgb2hex(this.col[0],this.col[1],this.col[2],e)},toRGB:function(t,e,r){var n=this.col[3];return t?(e&&(n=1>n&&n>0?n.toString().slice(1):n),r||1==this.col[3]?"rgb("+this.col.slice(0,3).join(",")+")":"rgba("+this.col.slice(0,3).concat(n).join(",")+")"):r?this.col.slice(0,3):this.col.slice()},toHSL:function(t,e,r){var n=this.col[3],a=R.rgb2hsl(this.col[0],this.col[1],this.col[2]);return t?(e&&(a[1]=0==a[1]?a[1]:a[1]+"%",a[2]=0==a[2]?a[2]:a[2]+"%",n=1>n&&n>0?n.toString().slice(1):n),r||1==this.col[3]?"hsl("+[a[0],a[1],a[2]].join(",")+")":"hsla("+[a[0],a[1],a[2],n].join(",")+")"):r?a:a.concat(this.col[3])},toColorStop:function(t){var e=this.cstop;return t?(e=e.length?e+",":"",1>this.col[3]?"color-stop("+e+this.toRGB(1,1)+")":"color-stop("+e+this.toHEX(1,1)+")"):(e=e.length?" "+e:"",1>this.col[3]?this.toRGB(1,1)+e:this.toHEX(1,1)+e)},toString:function(t,e){return t=t?t.toLowerCase():"hex","rgb"==t||"rgba"==t?this.toRGB(1,!1!==e,"rgb"==t):"hsl"==t||"hsla"==t?this.toHSL(1,!1!==e,"hsl"==t):"keyword"==t?this.toKeyword(1):this.toHEX(1,!1!==e,"hexie"==t)}});R.toGray=R.intensity,R.Gradient={interpolate:n,stops:function(t,e){e=e?e.slice():e,t=t?t.slice():t;var r,n=t.length;if(e){if(e.length<n){var a=e.length,i=e[a-1];for(r=a;n>r;r++)e.push(r+1===n?1:i+(r-a+1)/(n-1))}}else if(1===n)e=[1];else for(e=new Array(n),r=0;n>r;r++)e[r]=r+1===n?1:r/(n-1);return 1!=e[e.length-1]&&(e.push(1),t.push(t[t.length-1])),[t,e]},linear:function(t,e,r,n,a,i,s){var p,m,v,_,y,w,C,I,R,b,A,x=t.length;if(i=i||0,0>i&&(i+=c),i>c&&(i-=c),R=l(u(i)),b=l(h(i)),A=b*e+R*r,R/=A,b/=A,i>d&&f>=i)for(m=0,v=0,p=0;x>p;p+=4,m++){for(m>=e&&(m=0,v++),y=e-1-m,w=v,_=o(1,b*y+R*w),I=0;_>a[I];)++I;C=0===I?0:I-1,s(t,p,n[C],n[I],a[I]>a[C]?(_-a[C])/(a[I]-a[C]):_)}else if(i>f&&g>=i)for(m=0,v=0,p=0;x>p;p+=4,m++){for(m>=e&&(m=0,v++),y=e-1-m,w=r-1-v,_=o(1,b*y+R*w),I=0;_>a[I];)++I;C=0===I?0:I-1,s(t,p,n[C],n[I],a[I]>a[C]?(_-a[C])/(a[I]-a[C]):_)}else if(i>g&&c>i)for(m=0,v=0,p=0;x>p;p+=4,m++){for(m>=e&&(m=0,v++),y=m,w=r-1-v,_=o(1,b*y+R*w),I=0;_>a[I];)++I;C=0===I?0:I-1,s(t,p,n[C],n[I],a[I]>a[C]?(_-a[C])/(a[I]-a[C]):_)}else for(m=0,v=0,p=0;x>p;p+=4,m++){for(m>=e&&(m=0,v++),y=m,w=v,_=o(1,b*y+R*w),I=0;_>a[I];)++I;C=0===I?0:I-1,s(t,p,n[C],n[I],a[I]>a[C]?(_-a[C])/(a[I]-a[C]):_)}return t},linearPoint:function(e,r,a,i,s,p,m,v,_){var y,w,C,I,R,b,A;if(R=l(u(_)),b=l(h(_)),A=b*s+R*p,R/=A,b/=A,_>d&&f>=_){for(y=s-1-a,w=i,t=o(1,b*y+R*w),I=0;t>v[I];)++I;C=0===I?0:I-1,n(e,r,m[C],m[I],v[I]>v[C]?(t-v[C])/(v[I]-v[C]):t)}else if(_>f&&g>=_){for(y=s-1-a,w=p-1-i,t=o(1,b*y+R*w),I=0;t>v[I];)++I;C=0===I?0:I-1,n(e,r,m[C],m[I],v[I]>v[C]?(t-v[C])/(v[I]-v[C]):t)}else if(_>g&&c>_){for(y=a,w=p-1-i,t=o(1,b*y+R*w),I=0;t>v[I];)++I;C=0===I?0:I-1,n(e,r,m[C],m[I],v[I]>v[C]?(t-v[C])/(v[I]-v[C]):t)}else{for(y=a,w=i,t=o(1,b*y+R*w),I=0;t>v[I];)++I;C=0===I?0:I-1,n(e,r,m[C],m[I],v[I]>v[C]?(t-v[C])/(v[I]-v[C]):t)}return e},radial:function(t,e,r,n,i,s,l,u,h,f){var c,d,g,p,m,v,_,y,w=t.length;for(s=s||0,l=l||0,u=u||1,h=h||1,h>u?(u/=h,h=1):u>h?(h/=u,u=1):(h=1,u=1),d=0,g=0,c=0;w>c;c+=4,d++){for(d>=e&&(d=0,g++),m=u*(d-s)/(e-s),v=h*(g-l)/(r-l),p=o(1,a(m*m+v*v)),y=0;p>i[y];)++y;_=0===y?0:y-1,f(t,c,n[_],n[y],i[y]>i[_]?(p-i[_])/(i[y]-i[_]):p)}return t},radialPoint:function(t,e,r,i,s,l,u,h,f,c,d,g){var p,m,v,_,y;for(m=d*(r-f)/(s-f),v=g*(i-c)/(l-c),p=o(1,a(m*m+v*v)),y=0;p>h[y];)++y;return _=0===y?0:y-1,n(t,e,u[_],u[y],h[y]>h[_]?(p-h[_])/(h[y]-h[_]):p),t}},R.Blend={normal:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=d,s=g,l=p,h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},lighten:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=h>d?h:d,s=f>g?f:g,l=c>p?c:p,h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},darken:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=h>d?d:h,s=f>g?g:f,l=c>p?p:c,h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},multiply:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=h*d*.003921568627451,s=f*g*.003921568627451,l=c*p*.003921568627451,h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},average:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=.5*(h+d),s=.5*(f+g),l=.5*(c+p),h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},add:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=h+d,s=f+g,l=c+p,h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},subtract:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=255>h+d?0:h+d-255,s=255>f+g?0:f+g-255,l=255>c+p?0:c+p-255,h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},difference:function(t,e,r,n,a,i){var o,s,u,h=a*e[n+3]*.003921568627451,f=t[r],c=t[r+1],d=t[r+2],g=e[n],p=e[n+1],m=e[n+2];o=l(g-f),s=l(p-c),u=l(m-d),f+=h*(o-f),c+=h*(s-c),d+=h*(u-d),i&&(f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d),t[r]=0|f,t[r+1]=0|c,t[r+2]=0|d},negation:function(t,e,r,n,a,i){var o,s,u,h=a*e[n+3]*.003921568627451,f=t[r],c=t[r+1],d=t[r+2],g=e[n],p=e[n+1],m=e[n+2];o=255-l(255-g-f),s=255-l(255-p-c),u=255-l(255-m-d),f+=h*(o-f),c+=h*(s-c),d+=h*(u-d),i&&(f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d),t[r]=0|f,t[r+1]=0|c,t[r+2]=0|d},screen:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=255-((255-d)*(255-h)>>8),s=255-((255-g)*(255-f)>>8),l=255-((255-p)*(255-c)>>8),h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},exclusion:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=d+h-2*d*h*.003921568627451,s=g+f-2*g*f*.003921568627451,l=p+c-2*p*c*.003921568627451,h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},overlay:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=128>h?2*d*h*.003921568627451:255-2*(255-d)*(255-h)*.003921568627451,s=128>f?2*g*f*.003921568627451:255-2*(255-g)*(255-f)*.003921568627451,o=128>c?2*p*c*.003921568627451:255-2*(255-p)*(255-c)*.003921568627451,h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},softlight:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=128>h?2*((d>>1)+64)*(.003921568627451*h):255-2*(255-((d>>1)+64))*(255-h)*.003921568627451,s=128>f?2*((g>>1)+64)*(.003921568627451*f):255-2*(255-((g>>1)+64))*(255-f)*.003921568627451,l=128>c?2*((p>>1)+64)*(.003921568627451*c):255-2*(255-((p>>1)+64))*(255-c)*.003921568627451,h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},hardlight:function(t,e,r,n,a,i){var o,s,l,u=a*e[n+3]*.003921568627451,h=t[r],f=t[r+1],c=t[r+2],d=e[n],g=e[n+1],p=e[n+2];o=128>d?2*h*d*.003921568627451:255-2*(255-h)*(255-d)*.003921568627451,s=128>g?2*f*g*.003921568627451:255-2*(255-f)*(255-g)*.003921568627451,l=128>p?2*c*p*.003921568627451:255-2*(255-c)*(255-p)*.003921568627451,h+=u*(o-h),f+=u*(s-f),c+=u*(l-c),i&&(h=0>h?0:h>255?255:h,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c),t[r]=0|h,t[r+1]=0|f,t[r+2]=0|c},colordodge:function(t,e,r,n,a,i){var s,l,u,h=a*e[n+3]*.003921568627451,f=t[r],c=t[r+1],d=t[r+2],g=e[n],p=e[n+1],m=e[n+2];s=255===f?f:o(255,(g<<8)/(255-f)),l=255===c?c:o(255,(p<<8)/(255-c)),u=255===d?d:o(255,(m<<8)/(255-d)),f+=h*(s-f),c+=h*(l-c),d+=h*(u-d),i&&(f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d),t[r]=0|f,t[r+1]=0|c,t[r+2]=0|d},colorburn:function(t,e,r,n,a,i){var o,l,u,h=a*e[n+3]*.003921568627451,f=t[r],c=t[r+1],d=t[r+2],g=e[n],p=e[n+1],m=e[n+2];o=0===f?f:s(0,255-(255-g<<8)/f),l=0===c?c:s(0,255-(255-p<<8)/c),u=0===d?d:s(0,255-(255-m<<8)/d),f+=h*(o-f),c+=h*(l-c),d+=h*(u-d),i&&(f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d),t[r]=0|f,t[r+1]=0|c,t[r+2]=0|d},linearlight:function(t,e,r,n,a,i){var o,s,l,u,h=a*e[n+3]*.003921568627451,f=t[r],c=t[r+1],d=t[r+2],g=e[n],p=e[n+1],m=e[n+2];128>f?(u=2*f,o=255>u+g?0:u+g-255):(u=2*(f-128),o=u+g),128>c?(u=2*c,s=255>u+p?0:u+p-255):(u=2*(c-128),s=u+p),128>d?(u=2*d,l=255>u+m?0:u+m-255):(u=2*(d-128),l=u+m),f+=h*(o-f),c+=h*(s-c),d+=h*(l-d),i&&(f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d),t[r]=0|f,t[r+1]=0|c,t[r+2]=0|d},reflect:function(t,e,r,n,a,i){var s,l,u,h=a*e[n+3]*.003921568627451,f=t[r],c=t[r+1],d=t[r+2],g=e[n],p=e[n+1],m=e[n+2];s=255===f?f:o(255,g*g/(255-f)),l=255===c?c:o(255,p*p/(255-c)),u=255===d?d:o(255,m*m/(255-d)),
f+=h*(s-f),c+=h*(l-c),d+=h*(u-d),i&&(f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d),t[r]=0|f,t[r+1]=0|c,t[r+2]=0|d},glow:function(t,e,r,n,a,i){var s,l,u,h=a*e[n+3]*.003921568627451,f=t[r],c=t[r+1],d=t[r+2],g=e[n],p=e[n+1],m=e[n+2];s=255===g?g:o(255,f*f/(255-g)),l=255===p?p:o(255,c*c/(255-p)),u=255===m?m:o(255,d*d/(255-m)),f+=h*(s-f),c+=h*(l-c),d+=h*(u-d),i&&(f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d),t[r]=0|f,t[r+1]=0|c,t[r+2]=0|d},phoenix:function(t,e,r,n,a,i){var l,u,h,f=a*e[n+3]*.003921568627451,c=t[r],d=t[r+1],g=t[r+2],p=e[n],m=e[n+1],v=e[n+2];l=o(p,c)-s(p,c)+255,u=o(m,d)-s(m,d)+255,h=o(v,g)-s(v,g)+255,c+=f*(l-c),d+=f*(u-d),g+=f*(h-g),i&&(c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g),t[r]=0|c,t[r+1]=0|d,t[r+2]=0|g},vividlight:function(t,e,r,n,a,i){var l,u,h,f,c=a*e[n+3]*.003921568627451,d=t[r],g=t[r+1],p=t[r+2],m=e[n],v=e[n+1],_=e[n+2];128>d?(f=2*d,l=0===f?f:s(0,255-(255-m<<8)/f)):(f=2*(d-128),l=255===f?f:o(255,(m<<8)/(255-f))),128>g?(f=2*g,u=0===f?f:s(0,255-(255-v<<8)/f)):(f=2*(g-128),u=255===f?f:o(255,(v<<8)/(255-f))),128>p?(f=2*p,h=0===f?f:s(0,255-(255-_<<8)/f)):(f=2*(g-128),h=255===f?f:o(255,(_<<8)/(255-f))),d+=c*(l-d),g+=c*(u-g),p+=c*(h-p),i&&(d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,p=0>p?0:p>255?255:p),t[r]=0|d,t[r+1]=0|g,t[r+2]=0|p},pinlight:function(t,e,r,n,a,i){var o,s,l,u,h=a*e[n+3]*.003921568627451,f=t[r],c=t[r+1],d=t[r+2],g=e[n],p=e[n+1],m=e[n+2];128>f?(u=2*f,o=u>g?u:g):(u=2*(f-128),o=u>g?g:u),128>c?(u=2*c,s=u>p?u:p):(u=2*(f-128),s=u>p?p:u),128>d?(u=2*d,l=u>m?u:m):(u=2*(d-128),l=u>m?m:u),f+=h*(o-f),c+=h*(s-c),d+=h*(l-d),i&&(f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d),t[r]=0|f,t[r+1]=0|c,t[r+2]=0|d},hardmix:function(t,e,r,n,a,i){var l,u,h,f,c=a*e[n+3]*.003921568627451,d=t[r],g=t[r+1],p=t[r+2],m=e[n],v=e[n+1],_=e[n+2];128>d?(f=2*d,l=0===f?f:s(0,255-(255-m<<8)/f)):(f=2*(d-128),l=255===f?f:o(255,(m<<8)/(255-f))),l=128>l?0:255,128>g?(f=2*g,u=0===f?f:s(0,255-(255-v<<8)/f)):(f=2*(g-128),u=255===f?f:o(255,(v<<8)/(255-f))),u=128>u?0:255,128>p?(f=2*p,h=0===f?f:s(0,255-(255-_<<8)/f)):(f=2*(p-128),h=255===f?f:o(255,(_<<8)/(255-f))),h=128>h?0:255,d+=c*(l-d),g+=c*(u-g),p+=c*(h-p),i&&(d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,p=0>p?0:p>255?255:p),t[r]=0|d,t[r+1]=0|g,t[r+2]=0|p}},R.Blend.lineardodge=R.Blend.add,R.Blend.linearburn=R.Blend.subtract,R.Combine=R.Blend}(a),!function(t,e){var r,n,a=t.ImArray,i=t.Util.Image,o=t.Color,s=Math.min,l=Math.max,u=t.Interpolation.bilinear,h=i.get_data,f=i.set_data,c=i.fill;n=t.Class({constructor:function(t){var e=this;e._cnv=t,e._transform={scale:[1,1],translate:[0,0],rotate:[0,0]},e._data=null},_cnv:null,_w:0,_h:0,_transform:null,_data:null,fillStyle:null,dispose:function(){var t=this;return t._cnv=null,t._data=null,t._transform=null,t},fillRect:function(t,e,r,n){var a,i=this,s=i._w,l=i._h,u=i.fillStyle;null==t&&(t=0),null==e&&(e=0),null==r&&(r=s),null==n&&(n=l),u===+u?a=o.Color2RGBA(u,[0,0,0,0],0):u&&u.substr?(a=o.fromString(u).toRGB(!1),a[3]=255*a[3]|0):a=u&&2<u.length?u:[0,0,0,0],c(i._data,s,l,a,t,e,t+r-1,e+n-1)},clearRect:function(t,e,r,n){var a=this,i=a._w,o=a._h;null==t&&(t=0),null==e&&(e=0),null==r&&(r=i),null==n&&(n=o),c(a._data,i,o,[0,0,0,0],t,e,t+r-1,e+n-1)},drawImage:function(t,e,r,n,i,o,s,l,c){var d=this,g=d._w,p=d._h,m=t._ctx._w,v=t._ctx._h,_=t._ctx._data,y=arguments.length;3===y?(d._data||(g=d._w=m,p=d._h=v,d._data=new a(g*p<<2)),o=e,s=r,f(d._data,g,p,_,m,v,0,0,m-1,v-1,o,s)):5===y?(d._data||(g=d._w=n,p=d._h=i,d._data=new a(g*p<<2)),o=e,s=r,l=n,c=i,m===l&&v===c?f(d._data,g,p,_,l,c,0,0,l-1,c-1,o,s):f(d._data,g,p,u(_,m,v,l,c),l,c,0,0,l-1,c-1,o,s)):(d._data||(g=d._w=l,p=d._h=c,d._data=new a(g*p<<2)),n===l&&i===c?f(d._data,g,p,h(_,m,v,e,r,e+n-1,r+i-1,!0),l,c,0,0,l-1,c-1,o,s):f(d._data,g,p,u(h(_,m,v,e,r,e+n-1,r+i-1,!0),n,i,l,c),l,c,0,0,l-1,c-1,o,s))},createImageData:function(t,e){var r=this;return r._data=new a(t*e<<2),r._w=t,r._h=e,r},putImageData:function(t,e,r){var n=this,a=n._w,i=n._h,o=t.width,s=t.height;null==e&&(e=0),null==r&&(r=0),f(n._data,a,i,t.data,o,s,0,0,o-1,s-1,e,r)},getImageData:function(t,e,r,n){var a,i,o,u,f=this,c=f._w,d=f._h;return null==t&&(t=0),null==e&&(e=0),null==r&&(r=c),null==n&&(n=d),a=l(0,s(t,r-1,c-1)),i=l(0,s(e,n-1,d-1)),o=s(a+r-1,r-1,c-1),u=s(i+n-1,n-1,d-1),{data:h(f._data,c,d,a,i,o,u),width:o-a+1,height:u-i+1}},scale:function(t,e){var r=this;return r._transform.scale[0]=t,r._transform.scale[1]=e,r},translate:function(t,e){var r=this;return r._transform.translate[0]=t,r._transform.translate[1]=e,r}}),r=t.CanvasProxy=t.Class({constructor:function(t,e){var r=this;r.width=t||0,r.height=e||0,r.style={},r._ctx=null},_ctx:null,width:null,height:null,style:null,dispose:function(){var t=this;return t.width=null,t.height=null,t.style=null,t._ctx&&(t._ctx.dispose(),t._ctx=null),t},getContext:function(e,r){var a=this;return-1<e.indexOf("webgl")?t.GL(a,r):(a._ctx||(a._ctx=new n(a)),a._ctx)},toDataURL:function(t){return""}}),t.Canvas=function(e,n){var a=t.Browser.isNode?new r:document.createElement("canvas");return e=e||0,n=n||0,a.style.width=e+"px",a.style.height=n+"px",a.width=e*t.devicePixelRatio,a.height=n*t.devicePixelRatio,a};var d=null;t.GL=t.Browser.isNode?function(t,e){return null}:function(t,e){e=e||{depth:!1,alpha:!0,premultipliedAlpha:!1,antialias:!0,stencil:!1,preserveDrawingBuffer:!1};var r=null;if(d)r=t.getContext(d,e);else{var n,a=["webgl2","experimental-webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"],i=a.length;for(n=0;i>n;++n){try{r=t.getContext(a[n],e)}catch(o){r=null}if(r){d=a[n];break}}}return r}}(a),!function(t,e){function r(t,e,r,n){return n=n||k,n&L&&(t.width=e,t.oCanvas.style.width=e+"px",t.oCanvas.width=e*o,t._restorable&&(t.iCanvas.style.width=t.oCanvas.style.width,t.iCanvas.width=t.oCanvas.width),t.tmpCanvas&&(t.tmpCanvas.style.width=t.oCanvas.style.width,t.tmpCanvas.width=t.oCanvas.width)),n&T&&(t.height=r,t.oCanvas.style.height=r+"px",t.oCanvas.height=r*o,t._restorable&&(t.iCanvas.style.height=t.oCanvas.style.height,t.iCanvas.height=t.oCanvas.height),t.tmpCanvas&&(t.tmpCanvas.style.height=t.oCanvas.style.height,t.tmpCanvas.height=t.oCanvas.height)),t}function n(t,e){var r=t.width,n=t.height;return e=e||255,t._restorable&&e&x&&t._refresh&x&&(t.iData=t.ictx.getImageData(0,0,r,n),t._refresh&=~x),e&M&&t._refresh&M&&(t.oData=t.octx.getImageData(0,0,r,n),t._refresh&=~M),t}function a(t,e){if(t.selection){var r=t.selection,n=t.width-1,a=t.height-1,i=w(r[0]*n),o=w(r[1]*a),s=w(r[2]*n)-i+1,l=w(r[3]*a)-o+1;e=e||255,t._restorable&&e&S&&t._refresh&S&&(t.iDataSel=t.ictx.getImageData(i,o,s,l),t._refresh&=~S),e&D&&t._refresh&D&&(t.oDataSel=t.octx.getImageData(i,o,s,l),t._refresh&=~D)}return t}var i="prototype",o=t.devicePixelRatio,s=t.ImArray,l=t.ImArrayCopy,u=(t.Array32F,t.CHANNEL,t.FORMAT),h=t.MIME,f=0,c=t.Color,d=c.Gradient,g=t.Util.Image,p=t.Canvas,m=t.CanvasProxy,v=t.Util.Array,_=v.arrayset,y=v.subarray,w=(Math.min,Math.floor),C=1,I=2,R=4,b=8,A=C|I|R|b,x=1,M=2,S=4,D=8,E=16,O=32,G=64,L=2,T=4,k=L|T,P=S|D,F=x|M,H=~P,B=~E,N=~O;g.scale=g.resize=t.Interpolation.bilinear;var U=t.Image=t.Class({name:"Image",constructor:function K(t){var e=this,r=0,n=0;return e instanceof K?(e.id=++f,e.width=r,e.height=n,e.tmpCanvas=null,e.iCanvas=p(r,n),e.oCanvas=p(r,n),e.iData=null,e.iDataSel=null,e.oData=null,e.oDataSel=null,e.ictx=e.iCanvas.getContext("2d"),e.octx=e.oCanvas.getContext("2d"),e.domElement=e.oCanvas,e._gl=null,e._restorable=!0,e.gray=!1,e.selection=null,e._histogram=[null,null,null,null],e._integral=[null,null,null,null],e._spectrum=[null,null,null,null],e._refresh=0,e._hstRefresh=0,e._intRefresh=0,e._spcRefresh=0,void(t&&e.image(t))):new K(t)},id:null,width:0,height:0,gray:!1,selection:null,tmpCanvas:null,iCanvas:null,oCanvas:null,ictx:null,octx:null,iData:null,iDataSel:null,oData:null,oDataSel:null,domElement:null,_restorable:!0,_gl:e,_histogram:null,_integral:null,_spectrum:null,_refresh:0,_hstRefresh:0,_intRefresh:0,_spcRefresh:0,dispose:function(){var t=this;return t.id=null,t.width=t.height=null,t.selection=t.gray=null,t.iData=t.iDataSel=t.oData=t.oDataSel=null,t.domElement=t.tmpCanvas=t.iCanvas=t.oCanvas=t.ictx=t.octx=null,t._restorable=t._gl=null,t._histogram=t._integral=t._spectrum=null,t._hstRefresh=t._intRefresh=t._spcRefresh=t._refresh=null,t},clone:function(t){return new U(!0===t?this.iCanvas:this.oCanvas)},gl:function(r){return e===this._gl&&(this._gl=t.GL(this.oCanvas,r)),this._gl},grayscale:function(t){var e=this;return arguments.length?(e.gray=!!t,e):e.gray},restorable:function(t){var e=this;return arguments.length||(t=!0),e._restorable=!!t,e},apply:function(t,e){return t.apply(this,this,e||null),this},apply2:function(t,e,r){return t.apply(this,e,r||null),this},select:function(t,e,r,n){var a=this,i=arguments.length;return!1===t?(a.selection=null,a.iDataSel=null,a.oDataSel=null,a._refresh&=H):(1>i&&(t=0),2>i&&(e=0),3>i&&(r=1),4>i&&(n=1),a.selection=[0>t?0:t>1?1:t,0>e?0:e>1?1:e,0>r?0:r>1?1:r,0>n?0:n>1?1:n],a._refresh|=P),a},deselect:function(){var t=this;return t.selection=null,t.iDataSel=null,t.oDataSel=null,t._refresh&=H,t},store:function(){var t=this;return t._restorable&&(t.ictx.drawImage(t.oCanvas,0,0),t._refresh|=x,t.selection&&(t._refresh|=S)),t},restore:function(){var t=this;return t._restorable&&(t.octx.drawImage(t.iCanvas,0,0),t._refresh|=M|E|O|G,t._hstRefresh=A,t._intRefresh=A,t._spcRefresh=A,t.selection&&(t._refresh|=D)),t},dimensions:function(t,e,n){var a=this;return a._refresh|=F|E|O|G,a._hstRefresh=A,a._intRefresh=A,a._spcRefresh=A,a.selection&&(a._refresh|=P),r(a,t,e,k),a},setDimensions:null,scale:function(t,e){var r=this;if(t=t||1,e=e||t,1===t&&1===e)return r;r.tmpCanvas=r.tmpCanvas||p(r.width,r.height);var n=r.tmpCanvas.getContext("2d"),a=r.width,i=r.height;return n.scale(t,e),a=r.width=t*a+.5|0,i=r.height=e*i+.5|0,n.drawImage(r.oCanvas,0,0),r.oCanvas.style.width=a+"px",r.oCanvas.style.height=i+"px",r.oCanvas.width=a*o,r.oCanvas.height=i*o,r.octx.drawImage(r.tmpCanvas,0,0),r._restorable&&(n.drawImage(r.iCanvas,0,0),r.iCanvas.style.width=r.oCanvas.style.width,r.iCanvas.style.height=r.oCanvas.style.height,r.iCanvas.width=r.oCanvas.width,r.iCanvas.height=r.oCanvas.height,r.ictx.drawImage(r.tmpCanvas,0,0)),r.tmpCanvas.width=r.oCanvas.width,r.tmpCanvas.height=r.oCanvas.height,r._refresh|=F|E|O|G,r._hstRefresh=A,r._intRefresh=A,r._spcRefresh=A,r.selection&&(r._refresh|=P),r},flipHorizontal:function(){var t=this;t.tmpCanvas=t.tmpCanvas||p(t.width,t.height);var e=t.tmpCanvas.getContext("2d");return e.translate(t.width,0),e.scale(-1,1),e.drawImage(t.oCanvas,0,0),t.octx.drawImage(t.tmpCanvas,0,0),t._restorable&&(e.drawImage(t.iCanvas,0,0),t.ictx.drawImage(t.tmpCanvas,0,0)),t._refresh|=F|O|G,t._intRefresh=A,t.selection&&(t._refresh|=P),t},flipVertical:function(){var t=this;t.tmpCanvas=t.tmpCanvas||p(t.width,t.height);var e=t.tmpCanvas.getContext("2d");return e.translate(0,t.height),e.scale(1,-1),e.drawImage(t.oCanvas,0,0),t.octx.drawImage(t.tmpCanvas,0,0),t._restorable&&(e.drawImage(t.iCanvas,0,0),t.ictx.drawImage(t.tmpCanvas,0,0)),t._refresh|=F|O|G,t._intRefresh=A,t.selection&&(t._refresh|=P),t},clear:function(){var t=this,e=t.width,r=t.height;return e&&r&&(t._restorable&&t.ictx.clearRect(0,0,e,r),t.octx.clearRect(0,0,e,r),t._refresh|=F|E|O|G,t._hstRefresh=A,t._intRefresh=A,t._spcRefresh=A,t.selection&&(t._refresh|=P)),t},crop:function(t,e,r,n){var a,i,s,l,u,h,f,c,d=this,g=d.selection,m=d.width,v=d.height;if(arguments.length)u=t,h=e,f=r-t+1,c=n-e+1;else{if(!g)return d;a=w(g[0]*(m-1)),i=w(g[1]*(v-1)),s=w(g[2]*(m-1))-a+1,l=w(g[3]*(v-1))-i+1,u=a,h=i,f=s,c=l,g[0]=0,g[1]=0,g[2]=1,g[3]=1}d.tmpCanvas=d.tmpCanvas||p(d.width,d.height);var _=d.tmpCanvas.getContext("2d");return _.drawImage(d.oCanvas,0,0,m,v,u,h,f,c),d.oCanvas.style.width=f+"px",d.oCanvas.style.height=c+"px",d.oCanvas.width=f*o,d.oCanvas.height=c*o,d.octx.drawImage(d.tmpCanvas,0,0),d._restorable&&(_.drawImage(d.iCanvas,0,0,m,v,u,h,f,c),d.iCanvas.style.width=d.oCanvas.style.width,d.iCanvas.style.height=d.oCanvas.style.height,d.iCanvas.width=d.oCanvas.width,d.iCanvas.height=d.oCanvas.height,d.ictx.drawImage(d.tmpCanvas,0,0)),d.tmpCanvas.width=d.oCanvas.width,d.tmpCanvas.height=d.oCanvas.height,d._refresh|=F|E|O|G,d._hstRefresh=A,d._intRefresh=A,d._spcRefresh=A,g&&(d._refresh|=P),d},fill:function(t,r,n,a,i){var o,s,l,u,h=this,f=h.selection,c=h.width,d=h.height;f?(o=w(f[0]*(c-1)),s=w(f[1]*(d-1)),l=w(f[2]*(c-1))-o+1,u=w(f[3]*(d-1))-s+1):(o=0,s=0,l=c,u=d),e===r&&(r=o),e===n&&(n=s),e===a&&(a=l),e===i&&(i=u),a&&!c&&i&&!d&&h.createImageData(a,i);var g=h.ictx,p=h.octx;return t=t||0,h._restorable&&(g.fillStyle=t,g.fillRect(r,n,a,i)),p.fillStyle=t,p.fillRect(r,n,a,i),h._refresh|=F|E|O|G,h._hstRefresh=A,h._intRefresh=A,h._spcRefresh=A,f&&(h._refresh|=P),h},getData:function(t){var e,r=this;return r._restorable&&!t?(r._refresh&x&&n(r,x),e=r.iData):(r._refresh&M&&n(r,M),e=r.oData),new l(e.data)},getSelectedData:function(t){var e,r=this;return r.selection?r._restorable&&!t?(r._refresh&S&&a(r,S),e=r.iDataSel):(r._refresh&D&&a(r,D),e=r.oDataSel):r._restorable&&!t?(r._refresh&x&&n(r,x),e=r.iData):(r._refresh&M&&n(r,M),e=r.oData),[new l(e.data),e.width,e.height]},setData:v.hasArrayset?function(t){var e=this;return e._refresh&M&&n(e,M),e.oData.data.set(t),e.octx.putImageData(e.oData,0,0),e._refresh|=E|O|G,e._hstRefresh=A,e._intRefresh=A,e._spcRefresh=A,e.selection&&(e._refresh|=D),e}:function(t){var e=this;return e._refresh&M&&n(e,M),_(e.oData.data,t),e.octx.putImageData(e.oData,0,0),e._refresh|=E|O|G,e._hstRefresh=A,e._intRefresh=A,e._spcRefresh=A,e.selection&&(e._refresh|=D),e},setSelectedData:v.hasArrayset?function(t){var e=this;if(e.selection){var r=e.selection,i=e.width-1,o=e.height-1,s=w(r[0]*i),l=w(r[1]*o);e._refresh&D&&a(e,D),e.oDataSel.data.set(t),e.octx.putImageData(e.oDataSel,s,l),e._refresh|=M}else e._refresh&M&&n(e,M),e.oData.data.set(t),e.octx.putImageData(e.oData,0,0);return e._refresh|=E|O|G,e._hstRefresh=A,e._intRefresh=A,e._spcRefresh=A,e}:function(t){var e=this;if(e.selection){var r=e.selection,i=e.width-1,o=e.height-1,s=w(r[0]*i),l=w(r[1]*o);e._refresh&D&&a(e,D),_(e.oDataSel.data,t),e.octx.putImageData(e.oDataSel,s,l),e._refresh|=M}else e._refresh&M&&n(e,M),_(e.oData.data,t),e.octx.putImageData(e.oData,0,0);return e._refresh|=E|O|G,e._hstRefresh=A,e._intRefresh=A,e._spcRefresh=A,e},createImageData:function(t,e){var n,a,i=this;return r(i,t,e,k),i._restorable&&(n=i.ictx=i.iCanvas.getContext("2d"),n.createImageData(t,e)),a=i.octx=i.oCanvas.getContext("2d"),a.createImageData(t,e),i._refresh|=F,i.selection&&(i._refresh|=P),i},image:v.hasArrayset?function(t){if(!t)return this;var e,a,i,o,s,l,u,h=this;return t instanceof U&&(t=t.oCanvas),s="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,l="undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||t instanceof m,u="undefined"!=typeof Image&&t instanceof Image,s?(i=t.videoWidth,o=t.videoHeight):(i=t.width,o=t.height),u||l||s?(r(h,i,o,k),h._restorable&&(e=h.ictx=h.iCanvas.getContext("2d"),e.drawImage(t,0,0)),a=h.octx=h.oCanvas.getContext("2d"),a.drawImage(t,0,0),h._refresh|=F):(h.oData||(h.createImageData(i,o),n(h,F)),h._restorable&&(e=h.ictx=h.iCanvas.getContext("2d"),h.iData.data.set(t.data),e.putImageData(h.iData,0,0)),a=h.octx=h.oCanvas.getContext("2d"),h.oData.data.set(t.data),a.putImageData(h.oData,0,0)),h._refresh|=E|O|G,h._hstRefresh=A,h._intRefresh=A,h._spcRefresh=A,h.selection&&(h._refresh|=P),h}:function(t){if(!t)return this;var e,a,i,o,s,l,u,h=this;return t instanceof U&&(t=t.oCanvas),s="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,l="undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||t instanceof m,u="undefined"!=typeof Image&&t instanceof Image,s?(i=t.videoWidth,o=t.videoHeight):(i=t.width,o=t.height),u||l||s?(r(h,i,o,k),h._restorable&&(e=h.ictx=h.iCanvas.getContext("2d"),e.drawImage(t,0,0)),a=h.octx=h.oCanvas.getContext("2d"),a.drawImage(t,0,0)):(h.oData||(h.createImageData(i,o),n(h,F)),h._restorable&&(e=h.ictx=h.iCanvas.getContext("2d"),_(h.iData.data,t.data),e.putImageData(h.iData,0,0)),a=h.octx=h.oCanvas.getContext("2d"),_(h.oData.data,t.data),a.putImageData(h.oData,0,0)),h._refresh|=E|O|G,h._hstRefresh=A,h._intRefresh=A,h._spcRefresh=A,h.selection&&(h._refresh|=P),h},setImage:null,getPixel:function(t,e){var r,a=this,i=a.width,o=a.height;return 0>t||t>=i||0>e||e>=o?null:(a._refresh&M&&n(a,M),r=(e*i+t|0)<<2,y(a.oData.data,r,r+4))},setPixel:function(t,e,r){var n=this,a=n.width,i=n.height;return 0>t||t>=a||0>e||e>=i?n:(n.octx.putImageData(r,t,e),n._refresh|=M|E|O|G,n._hstRefresh=A,n._intRefresh=A,n._spcRefresh=A,n.selection&&(n._refresh|=D),n)},getPixelData:function(){return this._refresh&M&&n(this,M),this.oData},setPixelData:function(t){var e=this;return e.octx.putImageData(t,0,0),e._refresh|=M|E|O|G,e._hstRefresh=A,e._intRefresh=A,e._spcRefresh=A,e.selection&&(e._refresh|=D),e},integral:function(t){var e,r=this,n=r.gray,a=g.integral,i=r._integral;if(null==t){if(r._refresh&O){var o,s=r.getPixelData().data,l=r.width,u=r.height;i[0]=o=a(s,l,u,0),i[1]=n?o:a(s,l,u,1),i[2]=n?o:a(s,l,u,2),i[3]=null,r._intRefresh=0,r._refresh&=N}}else t=t||0,e=1<<t,(r._refresh&O||r._intRefresh&e)&&(!n||r._intRefresh&C?!n||r._intRefresh&I?!n||r._intRefresh&R?i[t]=a(r.getPixelData().data,r.width,r.height,t):i[t]=i[2]:i[t]=i[1]:i[t]=i[0],r._intRefresh&=~e,r._refresh&=N);return null==t?i:i[t||0]},sat:null,histogram:function(t,e){var r,n=this,a=n.gray,i=g.histogram,o=n._histogram;if(null==t){if(n._refresh&E){var s,l=n.getPixelData().data,u=n.width,h=n.height;o[0]=s=i(l,u,h,0,e),o[1]=a?s:i(l,u,h,1,e),o[2]=a?s:i(l,u,h,2,e),o[3]=null,n._hstRefresh=0,n._refresh&=B}}else t=t||0,r=1<<t,(n._refresh&E||n._hstRefresh&r)&&(!a||n._hstRefresh&C?!a||n._hstRefresh&I?!a||n._hstRefresh&R?o[t]=i(n.getPixelData().data,n.width,n.height,t,e):o[t]=o[2]:o[t]=o[1]:o[t]=o[0],n._hstRefresh&=~r,n._refresh&=B);return null==t?o:o[t||0]},spectrum:function(t){var e=this,r=e._spectrum;return null==t?r:r[t||0]},fft:null,linearGradient:function(t,e,r,n){var a=this,i=a.width,o=a.height,l=d.stops(t,e);return a.setData(d.linear(new s(i*o<<2),i,o,l[0],l[1],r,n||d.interpolate)),a},radialGradient:function(t,e,r,n,a,i,o){var l=this,u=l.width,h=l.height,f=d.stops(t,e);return l.setData(d.radial(new s(u*h<<2),u,h,f[0],f[1],r,n,a,i,o||d.interpolate)),l},perlinNoise:function(t,e,r,n,a,i,o,l,u,h){var f=this,c=f.width,d=f.height;return g.perlin&&(t&&g.perlin.seed(t),f.setData(g.perlin(new s(c*d<<2),c,d,e,r,n,a,i,o,l,u,h)),f.gray=!!r),f},toImage:function(t,e){t=t||0,e=e||1;var r=this.oCanvas,n=null,a=16&t;if(n=u.JPG===a?r.toDataURL(h.JPG,e):u.GIF===a?r.toDataURL(h.GIF,e):r.toDataURL(h.PNG,e),t&u.IMAGE){var i=new Image;return i.src=n,i}return n},toString:function(){return"[FILTER Image: "+this.name+"]"}});U[i].setImage=U[i].image,U[i].setDimensions=U[i].dimensions,U[i].sat=U[i].integral,U[i].fft=U[i].spectrum,U.LinearGradient=U.Gradient=function(t,e,r,n,a,i){return(new U).restorable(!1).createImageData(t,e).linearGradient(r,n,a,i||d.interpolate)},U.RadialGradient=function(t,e,r,n,a,i,o,s,l){return(new U).restorable(!1).createImageData(t,e).radialGradient(r,n,a,i,o,s,l||d.interpolate)},U.PerlinNoise=function(t,e,r,n,a,i,o,s,l,u,h,f){return(new U).restorable(!1).createImageData(t,e).perlinNoise(r,n,a,i,o,s,l,u,h,f)};var Y=t.ScaledImage=t.Class(U,{name:"ScaledImage",constructor:function W(t,e,r){var n=this;return n instanceof W?(n.scaleX=t||1,n.scaleY=e||n.scaleX,void n.$super("constructor",r)):new W(t,e,r)},scaleX:1,scaleY:1,dispose:function(){var t=this;return t.scaleX=null,t.scaleY=null,t.$super("dispose"),t},clone:function(t){var e=this;return new Y(e.scaleX,e.scaleY,!0===t?e.iCanvas:e.oCanvas)},setScale:function(t,e){var r=this,n=arguments.length;return n>0&&null!=t&&(r.scaleX=t,r.scaleY=t),n>1&&null!=e&&(r.scaleY=e),r},image:function(t){if(!t)return this;var e,n,a,i,o,s,l,u,h,f=this,c=f.scaleX,d=f.scaleY;return t instanceof U&&(t=t.oCanvas),l="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement,u="undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||t instanceof m,h="undefined"!=typeof Image&&t instanceof Image,l?(a=t.videoWidth,i=t.videoHeight):(a=t.width,i=t.height),(h||u||l)&&(o=c*a+.5|0,s=d*i+.5|0,r(f,o,s,k),f._restorable&&(e=f.ictx=f.iCanvas.getContext("2d"),e.drawImage(t,0,0,a,i,0,0,o,s)),n=f.octx=f.oCanvas.getContext("2d"),n.drawImage(t,0,0,a,i,0,0,o,s),f._refresh|=F|E|O|G,f._hstRefresh=A,f._intRefresh=A,f._spcRefresh=A,f.selection&&(f._refresh|=P)),f}});Y[i].setImage=Y[i].image}(a),!function(t,e){t.IO.Loader=t.IO.Reader=t.Class({name:"IO.Loader",__static__:{load:t.Classy.Method(function(t,e,r){return function(t,e,n){return(new r).load(t,e,n)}},t.Classy.LATE|t.Classy.STATIC)},constructor:function(){},_crossOrigin:null,_responseType:null,dispose:function(){var t=this;return t._crossOrigin=null,t._responseType=null,t},load:function(t,e,r){return null},responseType:function(t){var e=this;return arguments.length?(e._responseType=t,e):e._responseType},crossOrigin:function(t){var e=this;return arguments.length?(e._crossOrigin=t,e):e._crossOrigin}}),t.IO.Loader.prototype.read=t.IO.Loader.prototype.load,t.IO.Writer=t.Class({name:"IO.Writer",__static__:{write:t.Classy.Method(function(t,e,r){return function(t,e,n,a){return(new r).write(t,e,n,a)}},t.Classy.LATE|t.Classy.STATIC)},constructor:function(){},_encoding:null,dispose:function(){var t=this;return t._encoding=null,t},write:function(t,e,r,n){return null},encoding:function(t){var e=this;return arguments.length?(e._encoding=t,e):e._encoding}})}(a),!function(t,e){function r(t){var e,r;for(t>0&&1>t&&(t*=65536),t=f(t),256>t&&(t|=t<<8),r=0;256>r;r++)e=1&r?d[r]^255&t:d[r]^t>>8&255,g[r]=g[r+256]=e}function n(t,e,r){var n=7&t,a=4>n?e:r,i=4>n?r:e;return(1&n?-a:a)+(2&n?-2*i:2*i)}function a(t,e){var r,a,i,o,s,l=.366025403,u=.211324865,h=(t+e)*l,c=t+h,d=e+h,p=f(c),m=f(d),v=(p+m)*u,_=p-v,y=m-v,w=t-_,C=e-y;w>C?(o=1,s=0):(o=0,s=1);var I=w-o+u,R=C-s+u,b=w-1+2*u,A=C-1+2*u,x=255&p,M=255&m,S=.5-w*w-C*C;0>S?r=0:(S*=S,r=S*S*n(g[x+g[M]],w,C));var D=.5-I*I-R*R;0>D?a=0:(D*=D,a=D*D*n(g[x+o+g[M+s]],I,R));var E=.5-b*b-A*A;return 0>E?i=0:(E*=E,i=E*E*n(g[x+1+g[M+1]],b,A)),40*(r+a+i)}function i(t){return t*t*t*(t*(6*t-15)+10)}function o(t,e,r){return e+t*(r-e)}function s(t,e){var r,a,s,l,u,h,c,d,p,m,v,_,y,w;return r=f(t),a=f(e),u=t-r,h=e-a,c=u-1,d=h-1,s=r+1&255,l=a+1&255,r=255&r,a=255&a,m=i(h),p=i(u),v=n(g[r+g[a]],u,h),_=n(g[r+g[l]],u,d),y=o(m,v,_),v=n(g[s+g[a]],c,h),_=n(g[s+g[l]],c,d),w=o(m,v,_),.507*o(p,y,w)}function l(t,e,r,n,a,i,o,s,l,u,h,f,c){var d,g,p,m,v=0,_=f,y=1,w=0;for(d=0;u>d;d++)g=(n+h[d][0])%i,p=(a+h[d][1])%o,v+=r(_*g*s,_*p*l)*y,_*=2,w+=y,y*=c;m=~~(255*(.5*v/w+.5)),t[e]=m,t[e+1]=m,t[e+2]=m,t[e+3]=255}function u(t,e,r,n,a,i,o,s,l,u,h,f,c){var d,g,p,m,v=0,_=f,y=1,w=0;for(d=0;u>d;d++)g=(n+h[d][0])%i,p=(a+h[d][1])%o,v+=r(_*g*s,_*p*l)*y,_*=2,w+=y,y*=c;m=~~(16777215*(.5*v/w+.5)),t[e]=m>>>16&255,t[e+1]=m>>>8&255,t[e+2]=255&m,t[e+3]=255}var h=t.Util.Image,f=(t.Image,Math.floor),c=(Math.sin,Math.cos,t.CONST.PI2,t.Array8U),d=new c([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180]),g=new c(d);h.perlin=function(t,e,r,n,i,o,h,f,c,d,g,p){var m,v,_,y,w,C,I=1/o,R=1/h,b=p?s:a,A=i?l:u,x=t.length,M=e>>>1,S=r>>>1;if(d=d||1,g=g||.5,f=f||1,c=c||[[0,0]],n)for(m=0,v=0,w=0;x>w;w+=4,m++)m>=e&&(m=0,v++),_=m>M?e-1-m:m,y=v>S?r-1-v:v,m>_||v>y?(C=y*e+_<<2,t[w]=t[C],t[w+1]=t[C+1],t[w+2]=t[C+2],t[w+3]=255):A(t,w,b,_,y,e,r,I,R,f,c,d,g);else for(m=0,v=0,w=0;x>w;w+=4,m++)m>=e&&(m=0,v++),A(t,w,b,m,v,e,r,I,R,f,c,d,g);return t},h.perlin.seed=r}(a),a});
/**
*
*   FILTER.js I/O Classes
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (I/O Loaders)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n){"use strict";"object"==typeof module&&module.exports?module.exports=n.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_IO")?define("FILTER_IO",["module","FILTER"],function(t,r){return n.moduleUri=t.uri,n.call(e,r),r}):(n.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(n){"use strict";n.getPath(e.moduleUri);return!function(e,n){function t(e,n,t){var r="";if(!e)return xhr?xhr:r;var o,i,l,c,f,d=u(e);if(t){for(i=0,l=d.length;l>i;i++)o=d[i],t.setHeader(o,e[o]);return t}if(n){for(i=0,l=d.length;l>i;i++)if(o=d[i],"[object Array]"===s.call(e[o]))for(c=0,f=e[o].length;f>c;c++)n.setRequestHeader(o,String(e[o][c]));else n.setRequestHeader(o,String(e[o]));return n}for(i=0,l=d.length;l>i;i++)if(o=d[i],"[object Array]"===s.call(e[o]))for(r.length&&(r+=a),r+=o+": "+String(e[o][0]),c=1,f=e[o].length;f>c;c++)r+=a+String(e[o][c]);else r.length&&(r+=a),r+=o+": "+String(e[o]);return r}function r(e,n){var t,r,s,u,l={},c=null;if(e)for(n=!0===n,e=e.split(a),r=0,s=e.length;s>r;r++)u=e[r],t=u.split(":"),t.length>1?(c=i(t.shift()),n&&(c=c.toLowerCase()),l[o](c)?("string"==typeof l[c]&&(l[c]=[l[c]]),l[c].push(i(t.join(":")))):l[c]=i(t.join(":"))):t[0].length&&c&&(l[c]=a+t[0]);return l}var o="hasOwnProperty",s=Object.prototype.toString,u=Object.keys,a="\r\n",i=e.Util.String.trim;e.Util.Http={Header:{encode:t,decode:r}};var l=e.Util.XHR=function c(e,n){var t=this,r=!1;t.readyState=c.UNSENT,t.status=null,t.statusText=null,t.responseType="text",t.responseURL=null,t.response=null,t.responseText=null,t.responseXml=null,t._rawHeaders=null,t._headers=null,t.send=function(n){return r||c.UNSENT!==t.readyState?t:(e&&e(n),t.readyState=c.OPENED,t)},t.abort=function(){return r?t:(r=!0,n&&n(),t)},t.getAllResponseHeaders=function(e){return c.DONE!==t.readyState?null:!0===e?t._headers:t._rawHeaders},t.getResponseHeader=function(e,n){if(null==e||c.DONE!==t.readyState)return null;var r=t._headers||{};return!1!==n&&(e=e.toLowerCase()),r[o](e)?r[e]:null},t.dispose=function(){return t.readyState=null,t.status=null,t.statusText=null,t.responseType=null,t.responseURL=null,t.response=null,t.responseText=null,t.responseXml=null,t._rawHeaders=null,t._headers=null,t.getAllResponseHeaders=null,t.getResponseHeader=null,t.send=null,t.abort=null,t}};l.UNSENT=0,l.OPENED=1,l.HEADERS_RECEIVED=2,l.LOADING=3,l.DONE=4,l.create=e.Browser.isNode?function(e,n){if(e=e||{},!e.url)return null;var r,o,u="[object Object]"===s.call(e.url)?e.url:require("url").parse(e.url),a={method:e.method||"GET",agent:!1,protocol:u.protocol,host:u.hostname,hostname:u.hostname,port:u.port||80,path:(u.pathname||"/")+(u.query?"?"+u.query:"")};return"file:"===a.protocol?(o=new l(function(n){o.readyState=l.OPENED,require("fs").readFile(a.path,{encoding:"arraybuffer"===o.responseType?null:o.responseType,flag:"r"},function(n,t){o.readyState=l.DONE,o.responseUrl=a.path,e.onLoadStart&&e.onLoadStart(o),e.onLoadEnd&&e.onLoadEnd(o),n?(o.status=500,o.statusText=n.toString(),e.onRequestError?e.onRequestError(o):e.onError&&e.onError(o)):(o.status=200,o.statusText=null,o.response=t,"arraybuffer"!==o.responseType?(o.responseText=t,o.responseXml=null):(o.responseText=null,o.responseXml=null),e.onComplete&&e.onComplete(o))})},function(){}),o.responseType=e.responseType||"text",arguments.length>1&&o.send(n),o):(o=new l(function(e){null!=e&&(e=String(e),r.setHeader("Content-Length",String(e.length)),r.write(e)),r.end()},function(){r.abort()}),r=("https:"===a.protocol?require("https").request:require("http").request)(a,function(n){var t="",r=0;o.readyState=l.OPENED,e.onStateChange&&e.onStateChange(o),o.readyState=l.HEADERS_RECEIVED,o._rawHeaders=n.rawHeaders.join("\r\n"),o._headers=n.headers,o.responseURL=n.url||null,o.status=n.statusCode||null,o.statusText=n.statusMessage||null,e.onStateChange&&e.onStateChange(o),n.on("data",function(n){r||(r=1,o.readyState=l.LOADING,e.onStateChange&&e.onStateChange(o),e.onLoadStart&&e.onLoadStart(o)),t+=n.toString(),e.onProgress&&e.onProgress(o)}),n.on("end",function(){o.readyState=l.DONE,o.responseType="text",o.response=o.responseText=t,e.onStateChange&&e.onStateChange(o),e.onLoadEnd&&e.onLoadEnd(o),l.DONE===o.readyState&&(200===o.status?e.onComplete&&e.onComplete(o):e.onRequestError?e.onRequestError(o):e.onError&&e.onError(o))}),n.on("error",function(n){o.statusText=n.toString(),e.onError&&e.onError(o)})}),r.setTimeout(e.timeout||3e4,function(n){e.onTimeout&&e.onTimeout(o)}),r.on("abort",function(n){e.onAbort&&e.onAbort(o)}),r.on("error",function(n){o.statusText=n.toString(),e.onError&&e.onError(o)}),e.headers&&t(e.headers,null,r),arguments.length>1&&o.send(n),o)}:function(e,n){if(e=e||{},!e.url)return null;var o="undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),s=new l(function(e){o.send(e)},function(){o.abort()}),u=function(e,n){return e.readyState=n.readyState,e.status=n.status,e.statusText=n.statusText,e.responseURL=n.responseURL,e.response=n.response,"arraybuffer"!==n.responseType?(e.responseText=n.responseText,e.responseXml=n.responseXml):(e.responseText=null,e.responseXml=null),e};return s.getAllResponseHeaders=function(e){var n=o.getAllResponseHeaders();return!0===e?r(n):n},s.getResponseHeader=function(e){return o.getResponseHeader(e)},o.open(e.method||"GET",e.url,!e.sync),s.responseType=o.responseType=e.responseType||"text",o.timeout=e.timeout||3e4,e.onProgress&&(o.onprogress=function(){e.onProgress(u(s,o))}),e.onLoadStart&&(o.onloadstart=function(){e.onLoadStart(u(s,o))}),e.onLoadEnd&&(o.onloadend=function(){e.onLoadEnd(u(s,o))}),!e.sync&&e.onStateChange&&(o.onreadystatechange=function(){e.onStateChange(u(s,o))}),o.onload=function(){u(s,o),l.DONE===o.readyState&&(200===o.status?e.onComplete&&e.onComplete(s):e.onRequestError?e.onRequestError(s):e.onError&&e.onError(s))},o.onabort=function(){e.onAbort&&e.onAbort(u(s,o))},o.onerror=function(){e.onError&&e.onError(u(s,o))},o.ontimeout=function(){e.onTimeout&&e.onTimeout(u(s,o))},e.headers&&t(e.headers,o),e.mimeType&&o.overrideMimeType(e.mimeType),arguments.length>1&&s.send(n),s}}(n),!function(e,n){e.IO.XHRLoader=e.Class(e.IO.Loader,{name:"IO.XHRLoader",constructor:function t(){var e=this;return e instanceof t?void 0:new t},load:function(n,t,r){var o=this;return e.Util.XHR.create({url:n,responseType:o._responseType,onComplete:function(e){"function"==typeof t&&t(e.response)},onError:function(e){"function"==typeof r&&r(e.statusText)}},null),o}})}(n),!function(e,n){var t=e.IO.Loader,r=e.Util.XHR,o=e.Image,s=e.Class,u=e.IO.FileLoader=e.IO.FileReader=s(t,{name:"IO.FileLoader",constructor:function a(){var e=this;return e instanceof a?void 0:new a},load:function(n,t,o){var s=this;return e.Browser.isNode?require("fs").readFile("file://"===n.slice(0,7)?n.slice(7):n,{encoding:"arraybuffer"===s._responseType?null:s._responseType,flag:"r"},function(e,n){e?"function"==typeof o&&o(e.toString()):"function"==typeof t&&t(n)}):r.create({url:n,responseType:s._responseType,onComplete:function(e){"function"==typeof t&&t(e.response)},onError:function(e){"function"==typeof o&&o(e.statusText)}},null),s}});e.IO.BinaryLoader=e.IO.BinaryReader=s(u,{name:"IO.BinaryLoader",constructor:function i(e){var n=this;return n instanceof i?void(n._decoder="function"==typeof e?e:null):new i(e)},_decoder:null,_encoder:null,dispose:function(){var e=this;return e._decoder=null,e._encoder=null,e.$super("dispose"),e},decoder:function(e){var n=this;return n._decoder="function"==typeof e?e:null,n},encoder:function(e){var n=this;return n._encoder="function"==typeof e?e:null,n},load:function(e,n,t){var r=this,s=new o,u=r._decoder;return"function"==typeof u&&r.responseType("arraybuffer").$super("load",e,function(e){var r={},o=u(e,r);return o?(s.image(o),void("function"==typeof n&&n(s,r))):void("function"==typeof t&&t(s,r,e))},t),s}})}(n),!function(e,n){var t=e.Class,r=e.IO.FileWriter=t(e.IO.Writer,{name:"IO.FileWriter",constructor:function o(){var e=this;return e instanceof o?void 0:new o},write:function(n,t,r,o){var s=this;return e.Browser.isNode&&require("fs").writeFile("file://"===n.slice(0,7)?n.slice(7):n,t,{encoding:"arraybuffer"===s._encoding?null:s._encoding,flag:"w"},function(e){e?"function"==typeof o&&o(e.toString()):"function"==typeof r&&r(n)}),s}});e.IO.BinaryWriter=t(r,{name:"IO.BinaryWriter",constructor:function s(e){var n=this;return n instanceof s?void(n._encoder="function"==typeof e?e:null):new s(e)},_encoder:null,dispose:function(){var e=this;return e._encoder=null,e.$super("dispose"),e},encoder:function(e){var n=this;return n._encoder="function"==typeof e?e:null,n},write:function(e,n,t,r){var o=this,s=o._encoder;return n&&"function"==typeof s&&o.encoding("arraybuffer").$super("write",e,s(n.getPixelData()),t,r),o}})}(n),!function(e,n){var t=e.Image;e.IO.HTMLImageLoader=e.Class(e.IO.Loader,{name:"IO.HTMLImageLoader",constructor:function r(){return this instanceof r?void this.$super("constructor"):new r},load:function(e,n,r){var o,s=this,u=new t;return o=new Image,o.onload=function(e){u.setImage(o),"function"==typeof n&&n(u,o)},o.onerror=function(e){"function"==typeof r&&r(u,o)},o.crossOrigin=s._crossOrigin||"",o.src=e,u}})}(n),n});
/**
*
*   FILTER.js Codecs
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Image Codecs)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,r){"use strict";"object"==typeof module&&module.exports?module.exports=r.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_CODECS")?define("FILTER_CODECS",["module","FILTER"],function(t,a){return r.moduleUri=t.uri,r.call(e,a),a}):(r.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(r){"use strict";r.getPath(e.moduleUri);return!function(e,r){var t=function(){function e(){this.pos=0,this.bufferLength=0,this.eof=!1,this.buffer=null}return e.prototype={ensureBuffer:function(e){var r=this.buffer,t=r?r.byteLength:0;if(t>e)return r;for(var a=512;e>a;)a<<=1;for(var n=new Uint8Array(a),o=0;t>o;++o)n[o]=r[o];return this.buffer=n},getByte:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(e){var r=this.pos;if(e){this.ensureBuffer(r+e);for(var t=r+e;!this.eof&&this.bufferLength<t;)this.readBlock();var a=this.bufferLength;t>a&&(t=a)}else{for(;!this.eof;)this.readBlock();var t=this.bufferLength}return this.pos=t,this.buffer.subarray(r,t)},lookChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var e=this.pos;this.bufferLength<=e;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(e,r,t){for(var a=e+r;this.bufferLength<=a&&!this.eof;)this.readBlock();return new Stream(this.buffer,e,r,t)},skip:function(e){e||(e=1),this.pos+=e},reset:function(){this.pos=0}},e}(),a=function(){function e(e){throw new Error(e)}function r(r){var a=0,n=r[a++],o=r[a++];-1!=n&&-1!=o||e("Invalid header in flate stream"),8!=(15&n)&&e("Unknown compression method in flate stream"),((n<<8)+o)%31!=0&&e("Bad FCHECK in flate stream"),32&o&&e("FDICT bit set in flate stream"),this.bytes=r,this.bytesPos=a,this.codeSize=0,this.codeBuf=0,t.call(this)}var a=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),o=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),i=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59e4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],s=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];return r.prototype=Object.create(t.prototype),r.prototype.getBits=function(r){for(var t,a=this.codeSize,n=this.codeBuf,o=this.bytes,i=this.bytesPos;r>a;)"undefined"==typeof(t=o[i++])&&e("Bad encoding in flate stream"),n|=t<<a,a+=8;return t=n&(1<<r)-1,this.codeBuf=n>>r,this.codeSize=a-=r,this.bytesPos=i,t},r.prototype.getCode=function(r){for(var t=r[0],a=r[1],n=this.codeSize,o=this.codeBuf,i=this.bytes,s=this.bytesPos;a>n;){var f;"undefined"==typeof(f=i[s++])&&e("Bad encoding in flate stream"),o|=f<<n,n+=8}var c=t[o&(1<<a)-1],l=c>>16,d=65535&c;return(0==n||l>n||0==l)&&e("Bad encoding in flate stream"),this.codeBuf=o>>l,this.codeSize=n-l,this.bytesPos=s,d},r.prototype.generateHuffmanTable=function(e){for(var r=e.length,t=0,a=0;r>a;++a)e[a]>t&&(t=e[a]);for(var n=1<<t,o=new Uint32Array(n),i=1,s=0,f=2;t>=i;++i,s<<=1,f<<=1)for(var c=0;r>c;++c)if(e[c]==i){for(var l=0,d=s,a=0;i>a;++a)l=l<<1|1&d,d>>=1;for(var a=l;n>a;a+=f)o[a]=i<<16|c;++s}return[o,t]},r.prototype.readBlock=function(){function r(e,r,t,a,n){for(var o=e.getBits(t)+a;o-- >0;)r[A++]=n}var t=this.getBits(3);if(1&t&&(this.eof=!0),t>>=1,0==t){var f,c=this.bytes,l=this.bytesPos;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream");var d=f;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream"),d|=f<<8,"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream");var h=f;"undefined"==typeof(f=c[l++])&&e("Bad block header in flate stream"),h|=f<<8,h!=(65535&~d)&&e("Bad uncompressed block length in flate stream"),this.codeBuf=0,this.codeSize=0;var u=this.bufferLength,p=this.ensureBuffer(u+d),v=u+d;this.bufferLength=v;for(var g=u;v>g;++g){if("undefined"==typeof(f=c[l++])){this.eof=!0;break}p[g]=f}return void(this.bytesPos=l)}var m,y;if(1==t)m=i,y=s;else if(2==t){for(var b=this.getBits(5)+257,w=this.getBits(5)+1,U=this.getBits(4)+4,k=Array(a.length),A=0;U>A;)k[a[A++]]=this.getBits(3);for(var I=this.generateHuffmanTable(k),B=0,A=0,C=b+w,L=new Array(C);C>A;){var x=this.getCode(I);16==x?r(this,L,2,3,B):17==x?r(this,L,3,3,B=0):18==x?r(this,L,7,11,B=0):L[A++]=B=x}m=this.generateHuffmanTable(L.slice(0,b)),y=this.generateHuffmanTable(L.slice(b,C))}else e("Unknown block type in flate stream");for(var p=this.buffer,E=p?p.length:0,P=this.bufferLength;;){var S=this.getCode(m);if(256>S)P+1>=E&&(p=this.ensureBuffer(P+1),E=p.length),p[P++]=S;else{if(256==S)return void(this.bufferLength=P);S-=257,S=n[S];var T=S>>16;T>0&&(T=this.getBits(T));var B=(65535&S)+T;S=this.getCode(y),S=o[S],T=S>>16,T>0&&(T=this.getBits(T));var z=(65535&S)+T;P+B>=E&&(p=this.ensureBuffer(P+B),E=p.length);for(var G=0;B>G;++G,++P)p[P]=p[P-z]}}},r}();e.Util.ZLib={DecodeStream:t,FlateStream:a}}(r),!function(e,r){function t(r){return new e.Util.ZLib.FlateStream(r)}function a(){}a.prototype={constructor:a,data:null,pos:null,palette:null,imgData:null,transparency:null,animation:null,text:null,width:0,height:0,bits:null,colorType:null,compressionMethod:null,filterMethod:null,interlaceMethod:null,hasAlphaChannel:null,colors:null,colorSpace:null,pixelBitlength:null,readData:function(e){var r,t,a,n,o,i,s,f,c,l,d,h,u,p,v=this;for(v.data=e,v.pos=8,v.palette=[],v.imgData=[],v.transparency={},v.animation=null,v.text={},o=null;;){switch(r=v.readUInt32(),c=function(){var e,r;for(r=[],i=e=0;4>e;i=++e)r.push(String.fromCharCode(this.data[this.pos++]));return r}.call(v).join("")){case"IHDR":v.width=v.readUInt32(),v.height=v.readUInt32(),v.bits=v.data[v.pos++],v.colorType=v.data[v.pos++],v.compressionMethod=v.data[v.pos++],v.filterMethod=v.data[v.pos++],v.interlaceMethod=v.data[v.pos++];break;case"acTL":v.animation={numFrames:v.readUInt32(),numPlays:v.readUInt32()||1/0,frames:[]};break;case"PLTE":v.palette=v.read(r);break;case"fcTL":o&&v.animation.frames.push(o),v.pos+=4,o={width:v.readUInt32(),height:v.readUInt32(),xOffset:v.readUInt32(),yOffset:v.readUInt32()},n=v.readUInt16(),a=v.readUInt16()||100,o.delay=1e3*n/a,o.disposeOp=v.data[v.pos++],o.blendOp=v.data[v.pos++],o.data=[];break;case"IDAT":case"fdAT":for("fdAT"===c&&(v.pos+=4,r-=4),e=(null!=o?o.data:void 0)||v.imgData,i=h=0;r>=0?r>h:h>r;i=r>=0?++h:--h)e.push(v.data[v.pos++]);break;case"tRNS":switch(v.transparency={},v.colorType){case 3:if(v.transparency.indexed=v.read(r),l=255-v.transparency.indexed.length,l>0)for(i=u=0;l>=0?l>u:u>l;i=l>=0?++u:--u)v.transparency.indexed.push(255);break;case 0:v.transparency.grayscale=v.read(r)[0];break;case 2:v.transparency.rgb=v.read(r)}break;case"tEXt":d=v.read(r),s=d.indexOf(0),f=String.fromCharCode.apply(String,d.slice(0,s)),v.text[f]=String.fromCharCode.apply(String,d.slice(s+1));break;case"IEND":return o&&v.animation.frames.push(o),v.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(v),v.hasAlphaChannel=4===(p=v.colorType)||6===p,t=v.colors+(v.hasAlphaChannel?1:0),v.pixelBitlength=v.bits*t,v.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(v),void(v.imgData=new Uint8Array(v.imgData));default:v.pos+=r}if(v.pos+=4,v.pos>v.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(e){var r,t,a,n=this;for(a=[],r=t=0;e>=0?e>t:t>e;r=e>=0?++t:--t)a.push(n.data[n.pos++]);return a},readUInt32:function(){var e,r,t,a,n=this;return e=n.data[n.pos++]<<24,r=n.data[n.pos++]<<16,t=n.data[n.pos++]<<8,a=n.data[n.pos++],e|r|t|a},readUInt16:function(){var e,r,t=this;return e=t.data[t.pos++]<<8,r=t.data[t.pos++],e|r},decodePixels:function(e){var r,a,n,o,i,s,f,c,l,d,h,u,p,v,g,m,y,b,w,U,k,A,I,B=this;if(null==e&&(e=B.imgData),0===e.length)return new Uint8Array(0);for(e=t(e),e=e.getBytes(),u=B.pixelBitlength/8,m=u*B.width,p=new Uint8Array(m*B.height),s=e.length,g=0,v=0,a=0;s>v;){switch(e[v++]){case 0:for(o=w=0;m>w;o=w+=1)p[a++]=e[v++];break;case 1:for(o=U=0;m>U;o=U+=1)r=e[v++],i=u>o?0:p[a-u],p[a++]=(r+i)%256;break;case 2:for(o=k=0;m>k;o=k+=1)r=e[v++],n=(o-o%u)/u,y=g&&p[(g-1)*m+n*u+o%u],p[a++]=(y+r)%256;break;case 3:for(o=A=0;m>A;o=A+=1)r=e[v++],n=(o-o%u)/u,i=u>o?0:p[a-u],y=g&&p[(g-1)*m+n*u+o%u],p[a++]=(r+Math.floor((i+y)/2))%256;break;case 4:for(o=I=0;m>I;o=I+=1)r=e[v++],n=(o-o%u)/u,i=u>o?0:p[a-u],0===g?y=b=0:(y=p[(g-1)*m+n*u+o%u],b=n&&p[(g-1)*m+(n-1)*u+o%u]),f=i+y-b,c=Math.abs(f-i),d=Math.abs(f-y),h=Math.abs(f-b),l=d>=c&&h>=c?i:h>=d?y:b,p[a++]=(r+l)%256;break;default:throw new Error("Invalid filter algorithm: "+e[v-1])}g++}return p},decodePalette:function(){var e,r,t,a,n,o,i,s,f,c,l=this;for(a=l.palette,i=l.transparency.indexed||[],o=new Uint8Array((i.length||0)+a.length),n=0,t=a.length,e=0,r=s=0,f=a.length;f>s;r=s+=3)o[n++]=a[r],o[n++]=a[r+1],o[n++]=a[r+2],o[n++]=null!=(c=i[e++])?c:255;return o},copyToImageData:function(e,r){var t,a,n,o,i,s,f,c,l,d,h,u=this;if(a=u.colors,l=null,t=u.hasAlphaChannel,u.palette.length&&(l=null!=(h=u._decodedPalette)?h:u._decodedPalette=u.decodePalette(),a=4,t=!0),n=e.data||e,c=n.length,i=l||r,o=s=0,1===a)for(;c>o;)f=l?4*r[o/4]:s,d=i[f++],n[o++]=d,n[o++]=d,n[o++]=d,n[o++]=t?i[f++]:255,s=f;else for(;c>o;)f=l?4*r[o/4]:s,n[o++]=i[f++],n[o++]=i[f++],n[o++]=i[f++],n[o++]=t?i[f++]:255,s=f},decode:function(){var e,r=this;return e=new Uint8Array(r.width*r.height*4),r.copyToImageData(e,r.decodePixels()),e}},e.Codec.PNG={encoder:e.NotImplemented("PNG.encoder"),decoder:function(e,r){var t=new a;return t.readData(new Uint8Array(e)),{width:t.width,height:t.height,data:t.decode()}}}}(r),!function(e,r){function t(){}function a(e,r){for(var t,a,n=0,o=[],i=16;i>0&&!e[i-1];)i--;o.push({children:[],index:0});var s,f=o[0];for(t=0;i>t;t++){for(a=0;a<e[t];a++){for(f=o.pop(),f.children[f.index]=r[n];f.index>0;)f=o.pop();for(f.index++,o.push(f);o.length<=t;)o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s;n++}i>t+1&&(o.push(s={children:[],index:0}),f.children[f.index]=s.children,f=s)}return o[0].children}function n(e,r,t,a,n,o,i,s,c){function l(){if(T>0)return T--,S>>T&1;if(S=e[r++],255==S){var t=e[r++];if(t)throw"unexpected marker: "+(S<<8|t).toString(16)}return T=7,S>>>7}function d(e){for(var r,t=e;null!==(r=l());){if(t=t[r],"number"==typeof t)return t;if("object"!=typeof t)throw"invalid huffman sequence"}return null}function h(e){for(var r=0;e>0;){var t=l();if(null===t)return;r=r<<1|t,e--}return r}function u(e){var r=h(e);return r>=1<<e-1?r:r+(-1<<e)+1}function p(e,r){var t=d(e.huffmanTableDC),a=0===t?0:u(t);r[0]=e.pred+=a;for(var n=1;64>n;){var o=d(e.huffmanTableAC),i=15&o,s=o>>4;if(0!==i){n+=s;var c=f[n];r[c]=u(i),n++}else{if(15>s)break;n+=16}}}function v(e,r){var t=d(e.huffmanTableDC),a=0===t?0:u(t)<<c;r[0]=e.pred+=a}function g(e,r){r[0]|=l()<<c}function m(e,r){if(z>0)return void z--;for(var t=o,a=i;a>=t;){var n=d(e.huffmanTableAC),s=15&n,l=n>>4;if(0!==s){t+=l;var p=f[t];r[p]=u(s)*(1<<c),t++}else{if(15>l){z=h(l)+(1<<l)-1;break}t+=16}}}function y(e,r){for(var t=o,a=i,n=0;a>=t;){var s=f[t];switch(G){case 0:var p=d(e.huffmanTableAC),v=15&p,n=p>>4;if(0===v)15>n?(z=h(n)+(1<<n),G=4):(n=16,G=1);else{if(1!==v)throw"invalid ACn encoding";U=u(v),G=n?2:3}continue;case 1:case 2:r[s]?r[s]+=l()<<c:(n--,0===n&&(G=2==G?3:0));break;case 3:r[s]?r[s]+=l()<<c:(r[s]=U<<c,G=0);break;case 4:r[s]&&(r[s]+=l()<<c)}t++}4===G&&(z--,0===z&&(G=0))}function b(e,r,t,a,n){var o=t/x|0,i=t%x,s=o*e.v+a,f=i*e.h+n;r(e,e.blocks[s][f])}function w(e,r,t){var a=t/e.blocksPerLine|0,n=t%e.blocksPerLine;r(e,e.blocks[a][n])}var U,k,A,I,B,C,L,x=(t.precision,t.samplesPerLine,t.scanLines,t.mcusPerLine),E=t.progressive,P=(t.maxH,t.maxV,r),S=0,T=0,z=0,G=0,_=a.length;L=E?0===o?0===s?v:g:0===s?m:y:p;var M,D,R=0;D=1==_?a[0].blocksPerLine*a[0].blocksPerColumn:x*t.mcusPerColumn,n||(n=D);for(var F,X;D>R;){for(A=0;_>A;A++)a[A].pred=0;if(z=0,1==_)for(k=a[0],C=0;n>C;C++)w(k,L,R),R++;else for(C=0;n>C;C++){for(A=0;_>A;A++)for(k=a[A],F=k.h,X=k.v,I=0;X>I;I++)for(B=0;F>B;B++)b(k,L,R,I,B);if(R++,R===D)break}if(T=0,M=e[r]<<8|e[r+1],65280>M)throw"marker was not found";if(!(M>=65488&&65495>=M))break;r+=2}return r-P}function o(e,r){function t(e,t,a){var n,o,i,s,f,m,y,b,w,U,k=r.quantizationTable,A=a;for(U=0;64>U;U++)A[U]=e[U]*k[U];for(U=0;8>U;++U){var I=8*U;0!=A[1+I]||0!=A[2+I]||0!=A[3+I]||0!=A[4+I]||0!=A[5+I]||0!=A[6+I]||0!=A[7+I]?(n=v*A[0+I]+128>>8,o=v*A[4+I]+128>>8,i=A[2+I],s=A[6+I],f=g*(A[1+I]-A[7+I])+128>>8,b=g*(A[1+I]+A[7+I])+128>>8,m=A[3+I]<<4,y=A[5+I]<<4,w=n-o+1>>1,n=n+o+1>>1,o=w,w=i*p+s*u+128>>8,i=i*u-s*p+128>>8,s=w,w=f-y+1>>1,f=f+y+1>>1,y=w,w=b+m+1>>1,m=b-m+1>>1,b=w,w=n-s+1>>1,n=n+s+1>>1,s=w,w=o-i+1>>1,o=o+i+1>>1,i=w,w=f*h+b*d+2048>>12,f=f*d-b*h+2048>>12,b=w,w=m*l+y*c+2048>>12,m=m*c-y*l+2048>>12,y=w,A[0+I]=n+b,A[7+I]=n-b,A[1+I]=o+y,A[6+I]=o-y,A[2+I]=i+m,A[5+I]=i-m,A[3+I]=s+f,A[4+I]=s-f):(w=v*A[0+I]+512>>10,A[0+I]=w,A[1+I]=w,A[2+I]=w,A[3+I]=w,A[4+I]=w,A[5+I]=w,A[6+I]=w,A[7+I]=w)}for(U=0;8>U;++U){var B=U;0!=A[8+B]||0!=A[16+B]||0!=A[24+B]||0!=A[32+B]||0!=A[40+B]||0!=A[48+B]||0!=A[56+B]?(n=v*A[0+B]+2048>>12,o=v*A[32+B]+2048>>12,i=A[16+B],s=A[48+B],f=g*(A[8+B]-A[56+B])+2048>>12,b=g*(A[8+B]+A[56+B])+2048>>12,m=A[24+B],y=A[40+B],w=n-o+1>>1,n=n+o+1>>1,o=w,w=i*p+s*u+2048>>12,i=i*u-s*p+2048>>12,s=w,w=f-y+1>>1,f=f+y+1>>1,y=w,w=b+m+1>>1,m=b-m+1>>1,b=w,w=n-s+1>>1,n=n+s+1>>1,s=w,w=o-i+1>>1,o=o+i+1>>1,i=w,w=f*h+b*d+2048>>12,f=f*d-b*h+2048>>12,b=w,w=m*l+y*c+2048>>12,m=m*c-y*l+2048>>12,y=w,A[0+B]=n+b,A[56+B]=n-b,A[8+B]=o+y,A[48+B]=o-y,A[16+B]=i+m,A[40+B]=i-m,A[24+B]=s+f,A[32+B]=s-f):(w=v*a[U+0]+8192>>14,A[0+B]=w,A[8+B]=w,A[16+B]=w,A[24+B]=w,A[32+B]=w,A[40+B]=w,A[48+B]=w,A[56+B]=w)}for(U=0;64>U;++U){var C=128+(A[U]+8>>4);t[U]=0>C?0:C>255?255:C}}for(var a,n,o=[],i=r.blocksPerLine,s=r.blocksPerColumn,f=i<<3,m=new Int32Array(64),y=new Uint8Array(64),b=0;s>b;b++){var w=b<<3;for(a=0;8>a;a++)o.push(new Uint8Array(f));for(var U=0;i>U;U++){t(r.blocks[b][U],y,m);var k=0,A=U<<3;for(n=0;8>n;n++){var I=o[w+n];for(a=0;8>a;a++)I[A+a]=y[k++]}}}return o}function i(e){return 0>e?0:e>255?255:e}function s(e){function r(e){for(var r=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],t=0;64>t;t++){var a=I((r[t]*e+50)/100);1>a?a=1:a>255&&(a=255),B[O[t]]=a}for(var n=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],o=0;64>o;o++){var i=I((n[o]*e+50)/100);1>i?i=1:i>255&&(i=255),C[O[o]]=i}for(var s=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],f=0,c=0;8>c;c++)for(var l=0;8>l;l++)L[f]=1/(B[O[f]]*s[c]*s[l]*8),x[f]=1/(C[O[f]]*s[c]*s[l]*8),f++}function t(e,r){for(var t=0,a=0,n=new Array,o=1;16>=o;o++){for(var i=1;i<=e[o];i++)n[r[a]]=[],n[r[a]][0]=t,n[r[a]][1]=o,a++,t++;t*=2}return n}function a(){b=t(H,N),w=t(j,$),U=t(q,Y),k=t(J,V)}function n(){for(var e=1,r=2,t=1;15>=t;t++){for(var a=e;r>a;a++)P[32767+a]=t,E[32767+a]=[],E[32767+a][1]=t,E[32767+a][0]=a;for(var n=-(r-1);-e>=n;n++)P[32767+n]=t,E[32767+n]=[],E[32767+n][1]=t,E[32767+n][0]=r-1+n;e<<=1,r<<=1}}function o(){for(var e=0;256>e;e++)X[e]=19595*e,X[e+256>>0]=38470*e,X[e+512>>0]=7471*e+32768,X[e+768>>0]=-11059*e,X[e+1024>>0]=-21709*e,X[e+1280>>0]=32768*e+8421375,X[e+1536>>0]=-27439*e,X[e+1792>>0]=-5329*e}function i(e){for(var r=e[0],t=e[1]-1;t>=0;)r&1<<t&&(G|=1<<_),t--,_--,0>_&&(255==G?(s(255),s(0)):s(G),_=7,G=0)}function s(e){z.push(e)}function f(e){s(e>>8&255),s(255&e)}function c(e,r){var t,a,n,o,i,s,f,c,l,d=0;const h=8,u=64;for(l=0;h>l;++l){t=e[d],a=e[d+1],n=e[d+2],o=e[d+3],i=e[d+4],s=e[d+5],f=e[d+6],c=e[d+7];var p=t+c,v=t-c,g=a+f,m=a-f,y=n+s,b=n-s,w=o+i,U=o-i,k=p+w,A=p-w,I=g+y,B=g-y;e[d]=k+I,e[d+4]=k-I;var C=.707106781*(B+A);e[d+2]=A+C,e[d+6]=A-C,k=U+b,I=b+m,B=m+v;var L=.382683433*(k-B),x=.5411961*k+L,E=1.306562965*B+L,P=.707106781*I,T=v+P,z=v-P;e[d+5]=z+x,e[d+3]=z-x,e[d+1]=T+E,e[d+7]=T-E,d+=8}for(d=0,l=0;h>l;++l){t=e[d],a=e[d+8],n=e[d+16],o=e[d+24],i=e[d+32],s=e[d+40],f=e[d+48],c=e[d+56];var G=t+c,_=t-c,M=a+f,D=a-f,R=n+s,F=n-s,X=o+i,O=o-i,H=G+X,N=G-X,q=M+R,Y=M-R;e[d]=H+q,e[d+32]=H-q;var j=.707106781*(Y+N);e[d+16]=N+j,e[d+48]=N-j,H=O+F,q=F+D,Y=D+_;var $=.382683433*(H-Y),J=.5411961*H+$,V=1.306562965*Y+$,W=.707106781*q,Z=_+W,K=_-W;e[d+40]=K+J,e[d+24]=K-J,e[d+8]=Z+V,e[d+56]=Z-V,d++}var Q;for(l=0;u>l;++l)Q=e[l]*r[l],S[l]=Q>0?Q+.5|0:Q-.5|0;return S}function l(){f(65504),f(16),s(74),s(70),s(73),s(70),s(0),s(1),s(1),s(0),f(1),f(1),s(0),s(0)}function d(e,r){f(65472),f(17),s(8),f(r),f(e),s(3),s(1),s(17),s(0),s(2),s(17),s(1),s(3),s(17),s(1)}function h(){f(65499),f(132),s(0);for(var e=0;64>e;e++)s(B[e]);s(1);for(var r=0;64>r;r++)s(C[r])}function u(){f(65476),f(418),s(0);for(var e=0;16>e;e++)s(H[e+1]);for(var r=0;11>=r;r++)s(N[r]);s(16);for(var t=0;16>t;t++)s(q[t+1]);for(var a=0;161>=a;a++)s(Y[a]);s(1);for(var n=0;16>n;n++)s(j[n+1]);for(var o=0;11>=o;o++)s($[o]);s(17);for(var i=0;16>i;i++)s(J[i+1]);for(var c=0;161>=c;c++)s(V[c])}function p(){f(65498),f(12),s(3),s(1),s(0),s(2),s(17),s(3),s(17),s(0),s(63),s(0)}function v(e,r,t,a,n){var o,s=n[0],f=n[240];const l=16,d=63,h=64;for(var u=c(e,r),p=0;h>p;++p)T[O[p]]=u[p];var v=T[0]-t;t=T[0],0==v?i(a[0]):(o=32767+v,i(a[P[o]]),i(E[o]));for(var g=63;g>0&&0==T[g];g--);if(0==g)return i(s),t;for(var m,y=1;g>=y;){for(var b=y;0==T[y]&&g>=y;++y);var w=y-b;if(w>=l){m=w>>4;for(var U=1;m>=U;++U)i(f);w=15&w}o=32767+T[y],i(n[(w<<4)+P[o]]),i(E[o]),y++}return g!=d&&i(s),t}function g(){for(var e=String.fromCharCode,r=0;256>r;r++)F[r]=e(r)}function m(e){if(0>=e&&(e=1),e>100&&(e=100),A!==e){var t=0;t=50>e?Math.floor(5e3/e):Math.floor(200-2*e),r(t),A=e}}function y(){e||(e=50),g(),a(),n(),o(),m(e)}var b,w,U,k,A,I=(Math.round,Math.floor),B=new Array(64),C=new Array(64),L=new Array(64),x=new Array(64),E=new Array(65535),P=new Array(65535),S=new Array(64),T=new Array(64),z=[],G=0,_=7,M=new Array(64),D=new Array(64),R=new Array(64),F=new Array(256),X=new Array(2048),O=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],H=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],N=[0,1,2,3,4,5,6,7,8,9,10,11],q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],Y=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],j=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],$=[0,1,2,3,4,5,6,7,8,9,10,11],J=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],V=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(e,r){r&&m(r),z=new Array,G=0,_=7,f(65496),l(),h(),d(e.width,e.height),u(),p();var t=0,a=0,n=0;G=0,_=7,this.encode.displayName="_encode_";for(var o,s,c,g,y,A,I,B,C,E=e.data,P=e.width,S=e.height,T=4*P,F=0;S>F;){for(o=0;T>o;){for(y=T*F+o,A=y,I=-1,B=0,C=0;64>C;C++)B=C>>3,I=4*(7&C),A=y+B*T+I,F+B>=S&&(A-=T*(F+1+B-S)),o+I>=T&&(A-=o+I-T+4),s=E[A++],c=E[A++],g=E[A++],M[C]=(X[s]+X[c+256>>0]+X[g+512>>0]>>16)-128,D[C]=(X[s+768>>0]+X[c+1024>>0]+X[g+1280>>0]>>16)-128,R[C]=(X[s+1280>>0]+X[c+1536>>0]+X[g+1792>>0]>>16)-128;t=v(M,L,t,b,U),a=v(D,x,a,w,k),n=v(R,x,n,w,k),o+=32}F+=8}if(_>=0){var O=[];O[1]=_+1,O[0]=(1<<_+1)-1,i(O)}return f(65497),new Uint8Array(z)},y()}var f=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),c=4017,l=799,d=3406,h=2276,u=1567,p=3784,v=5793,g=2896;t.prototype={constructor:t,parse:function(e){function r(){var r=e[l]<<8|e[l+1];return l+=2,r}function t(){var t=r(),a=e.subarray(l,l+t-2);return l+=a.length,a}function i(e){var r,t,a=0,n=0;for(t in e.components)e.components.hasOwnProperty(t)&&(r=e.components[t],a<r.h&&(a=r.h),n<r.v&&(n=r.v));var o=Math.ceil(e.samplesPerLine/8/a),i=Math.ceil(e.scanLines/8/n);for(t in e.components)if(e.components.hasOwnProperty(t)){r=e.components[t];for(var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*r.h/a),f=Math.ceil(Math.ceil(e.scanLines/8)*r.v/n),c=o*r.h,l=i*r.v,d=[],h=0;l>h;h++){for(var u=[],p=0;c>p;p++)u.push(new Int32Array(64));d.push(u)}r.blocksPerLine=s,r.blocksPerColumn=f,r.blocks=d}e.maxH=a,e.maxV=n,e.mcusPerLine=o,e.mcusPerColumn=i}var s,c,l=0,d=(e.length,null),h=null,u=[],p=[],v=[],g=[],m=r();if(65496!=m)throw"SOI not found";for(m=r();65497!=m;){var y,b;switch(m){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=t();65504===m&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(d={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])}),65518===m&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&0===w[5]&&(h={version:w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:for(var U=r(),k=U+l-2;k>l;){var A=e[l++],I=new Int32Array(64);if(A>>4===0)for(b=0;64>b;b++){var B=f[b];I[B]=e[l++]}else{if(A>>4!==1)throw"DQT: invalid table spec";for(b=0;64>b;b++){var B=f[b];I[B]=r()}}u[15&A]=I}break;case 65472:case 65473:case 65474:r(),s={},s.extended=65473===m,s.progressive=65474===m,s.precision=e[l++],s.scanLines=r(),s.samplesPerLine=r(),s.components={},s.componentsOrder=[];var C,L=e[l++];for(y=0;L>y;y++){C=e[l];var x=e[l+1]>>4,E=15&e[l+1],P=e[l+2];s.componentsOrder.push(C),s.components[C]={h:x,v:E,quantizationIdx:P},l+=3}i(s),p.push(s);break;case 65476:var S=r();for(y=2;S>y;){var T=e[l++],z=new Uint8Array(16),G=0;for(b=0;16>b;b++,l++)G+=z[b]=e[l];var _=new Uint8Array(G);for(b=0;G>b;b++,l++)_[b]=e[l];y+=17+G,(T>>4===0?g:v)[15&T]=a(z,_)}break;case 65501:r(),c=r();break;case 65498:var M,D=(r(),e[l++]),R=[];for(y=0;D>y;y++){M=s.components[e[l++]];var F=e[l++];M.huffmanTableDC=g[F>>4],M.huffmanTableAC=v[15&F],R.push(M)}var X=e[l++],O=e[l++],H=e[l++],N=n(e,l,s,R,c,X,O,H>>4,15&H);l+=N;break;default:if(255==e[l-3]&&e[l-2]>=192&&e[l-2]<=254){l-=3;break}throw"unknown JPEG marker "+m.toString(16)}m=r()}if(1!=p.length)throw"only single frame JPEGs supported";for(var y=0;y<p.length;y++){var q=p[y].components;for(var b in q)q[b].quantizationTable=u[q[b].quantizationIdx],delete q[b].quantizationIdx}this.width=s.samplesPerLine,this.height=s.scanLines,this.jfif=d,this.adobe=h,this.components=[];for(var y=0;y<s.componentsOrder.length;y++){var M=s.components[s.componentsOrder[y]];this.components.push({lines:o(s,M),scaleX:M.h/s.maxH,scaleY:M.v/s.maxV})}},getData:function(e,r){var t,a,n,o,s,f,c,l,d,h,u,p,v,g,m,y,b,w,U,k,A,I=this.width/e,B=this.height/r,C=0,L=e*r*this.components.length,x=new Uint8Array(L);switch(this.components.length){case 1:for(t=this.components[0],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],d=0;e>d;d++)u=s[0|d*t.scaleX*I],x[C++]=u;break;case 2:for(t=this.components[0],a=this.components[1],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],d=0;e>d;d++)u=s[0|d*t.scaleX*I],x[C++]=u,u=f[0|d*a.scaleX*I],x[C++]=u;break;case 3:for(A=!0,this.adobe&&this.adobe.transformCode?A=!0:"undefined"!=typeof this.colorTransform&&(A=!!this.colorTransform),t=this.components[0],a=this.components[1],n=this.components[2],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],c=n.lines[0|h*n.scaleY*B],d=0;e>d;d++)A?(u=s[0|d*t.scaleX*I],p=f[0|d*a.scaleX*I],v=c[0|d*n.scaleX*I],w=i(u+1.402*(v-128)),U=i(u-.3441363*(p-128)-.71413636*(v-128)),k=i(u+1.772*(p-128))):(w=s[0|d*t.scaleX*I],U=f[0|d*a.scaleX*I],k=c[0|d*n.scaleX*I]),x[C++]=w,x[C++]=U,x[C++]=k;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";for(A=!1,this.adobe&&this.adobe.transformCode?A=!0:"undefined"!=typeof this.colorTransform&&(A=!!this.colorTransform),t=this.components[0],a=this.components[1],n=this.components[2],o=this.components[3],h=0;r>h;h++)for(s=t.lines[0|h*t.scaleY*B],f=a.lines[0|h*a.scaleY*B],c=n.lines[0|h*n.scaleY*B],l=o.lines[0|h*o.scaleY*B],d=0;e>d;d++)A?(u=s[0|d*t.scaleX*I],p=f[0|d*a.scaleX*I],v=c[0|d*n.scaleX*I],g=l[0|d*o.scaleX*I],m=255-i(u+1.402*(v-128)),y=255-i(u-.3441363*(p-128)-.71413636*(v-128)),b=255-i(u+1.772*(p-128))):(m=s[0|d*t.scaleX*I],y=f[0|d*a.scaleX*I],b=c[0|d*n.scaleX*I],g=l[0|d*o.scaleX*I]),x[C++]=m,x[C++]=y,x[C++]=b,x[C++]=g;break;default:throw"Unsupported color mode"}return x},copyToImageData:function(e){var r,t,a,n,o,s,f,c,l,d=e.width,h=e.height,u=e.data,p=this.getData(d,h),v=0,g=0;switch(this.components.length){case 1:for(t=0;h>t;t++)for(r=0;d>r;r++)a=p[v++],u[g++]=a,u[g++]=a,u[g++]=a,u[g++]=255;break;case 3:for(t=0;h>t;t++)for(r=0;d>r;r++)f=p[v++],c=p[v++],l=p[v++],u[g++]=f,u[g++]=c,u[g++]=l,u[g++]=255;break;case 4:for(t=0;h>t;t++)for(r=0;d>r;r++)o=p[v++],s=p[v++],a=p[v++],n=p[v++],f=255-i(o*(1-n/255)+n),c=255-i(s*(1-n/255)+n),l=255-i(a*(1-n/255)+n),u[g++]=f,u[g++]=c,u[g++]=l,u[g++]=255;break;default:throw"Unsupported color mode"}}};e.Codec.JPEG=e.Codec.JPG={encoder:function(e,r){r=r||{};var t="undefined"==typeof r.quality?100:r.quality,a=new s(t);return new Buffer(a.encode(e))},decoder:function(e,r){var a=new t;a.parse(new Uint8Array(e));var n={width:a.width,height:a.height,data:new Uint8Array(a.width*a.height*4)};return a.copyToImageData(n),n}}}(r),!function(e,r){function t(e){var r=this;if(r.pos=0,r.buffer=e,r.flag=[String.fromCharCode(r.buffer[r.pos++]),String.fromCharCode(r.buffer[r.pos++])].join(""),"BM"!==r.flag)throw new Error("Invalid BMP File");r.parseHeader(),r.parseBGR()}function a(e){var r=this;r.data=e.data,r.width=e.width,r.height=e.height,r.extraBytes=r.width%4,r.rgbSize=r.height*(3*r.width+r.extraBytes),r.headerInfoSize=40,r.flag="BM",r.reserved=0,r.offset=54,r.fileSize=r.rgbSize+r.offset,r.planes=1,r.bitPP=24,r.compress=0,r.hr=0,r.vr=0,r.colors=0,r.importantColors=0}t.prototype={constructor:t,pos:0,buffer:null,flag:null,fileSize:null,reserved:null,offset:null,headerSize:null,width:0,height:0,planes:null,bitPP:null,compress:null,rawSize:null,hr:null,vr:null,colors:null,importantColors:null,palette:null,data:null,readUInt8:function(e){return this.buffer[e++]},readUInt16LE:function(e){var r,t,a=this;return r=a.buffer[e++],t=a.buffer[e++],r|t<<8},readUInt32LE:function(e){var r,t,a,n,o=this;return r=o.buffer[e++],t=o.buffer[e++],a=o.buffer[e++],n=o.buffer[e++],r|t<<8|a<<16|n<<24},parseHeader:function(){var e=this;if(e.fileSize=e.readUInt32LE(e.pos),e.pos+=4,e.reserved=e.readUInt32LE(e.pos),e.pos+=4,e.offset=e.readUInt32LE(e.pos),e.pos+=4,e.headerSize=e.readUInt32LE(e.pos),e.pos+=4,e.width=e.readUInt32LE(e.pos),e.pos+=4,e.height=e.readUInt32LE(e.pos),e.pos+=4,e.planes=e.readUInt16LE(e.pos),e.pos+=2,e.bitPP=e.readUInt16LE(e.pos),e.pos+=2,e.compress=e.readUInt32LE(e.pos),e.pos+=4,e.rawSize=e.readUInt32LE(e.pos),e.pos+=4,
e.hr=e.readUInt32LE(e.pos),e.pos+=4,e.vr=e.readUInt32LE(e.pos),e.pos+=4,e.colors=e.readUInt32LE(e.pos),e.pos+=4,e.importantColors=e.readUInt32LE(e.pos),e.pos+=4,e.bitPP<24){var r=0===e.colors?1<<e.bitPP:e.colors;e.palette=new Array(r);for(var t=0;r>t;t++){var a=e.readUInt8(e.pos++),n=e.readUInt8(e.pos++),o=e.readUInt8(e.pos++),i=e.readUInt8(e.pos++);e.palette[t]={red:o,green:n,blue:a,quad:i}}}},parseBGR:function(){var e=this;e.pos=e.offset;var r="bit"+e.bitPP,t=e.width*e.height*4;try{e.data=new Uint8Array(t),e[r]()}catch(a){console.log("bit decode error:"+a)}},bit1:function(){var e,r,t,a,n,o,i=this,s=i.palette,f=i.width,c=i.height,l=Math.ceil(f/8),d=l%4;for(e=c-1;e>=0;e--){for(r=0;l>r;r++)for(t=i.readUInt8(i.pos++),a=e*f*4+8*r*4,n=0;8>n&&f>8*r+n;n++)o=s[t>>7-n&1],i.data[a+4*n]=o.blue,i.data[a+4*n+1]=o.green,i.data[a+4*n+2]=o.red,i.data[a+4*n+3]=255;0!=d&&(i.pos+=4-d)}},bit4:function(){var e,r,t,a,n,o,i,s=this,f=s.palette,c=s.width,l=s.height,d=Math.ceil(c/2),h=d%4;for(e=l-1;e>=0;e--){for(r=0;d>r&&(t=s.readUInt8(s.pos++),a=e*c*4+2*r*4,n=t>>4,o=15&t,i=f[n],s.data[a]=i.blue,s.data[a+1]=i.green,s.data[a+2]=i.red,s.data[a+3]=255,!(2*r+1>=c));r++)i=f[o],s.data[a+4]=i.blue,s.data[a+4+1]=i.green,s.data[a+4+2]=i.red,s.data[a+4+3]=255;0!=h&&(s.pos+=4-h)}},bit8:function(){var e,r,t,a,n,o=this,i=o.palette,s=o.width,f=o.height,c=s%4;for(e=f-1;e>=0;e--){for(r=0;s>r;r++)t=o.readUInt8(o.pos++),a=e*s*4+4*r,t<i.length?(n=i[t],o.data[a]=n.blue,o.data[a+1]=n.green,o.data[a+2]=n.red,o.data[a+3]=255):(o.data[a]=255,o.data[a+1]=255,o.data[a+2]=255,o.data[a+3]=255);0!=c&&(o.pos+=4-c)}},bit24:function(){var e,r,t,a,n,o,i=this,s=(i.palette,i.width),f=i.height,c=s%4;for(e=f-1;e>=0;e--){for(r=0;s>r;r++)a=i.readUInt8(i.pos++),n=i.readUInt8(i.pos++),o=i.readUInt8(i.pos++),t=e*s*4+4*r,i.data[t]=o,i.data[t+1]=n,i.data[t+2]=a,i.data[t+3]=255;i.pos+=c}},getData:function(){return this.data}},a.prototype={constructor:a,flag:null,fileSize:null,reserved:null,offset:null,headerSize:null,width:0,height:0,planes:null,bitPP:null,compress:null,rawSize:null,hr:null,vr:null,colors:null,importantColors:null,palette:null,extraBytes:null,rgbSize:null,headerInfoSize:null,data:null,write:function(e,r){for(var t=0;t<r.length;t++)e.push(r.charCodeAt(t))},writeUInt8:function(e,r){e.push(255&r)},writeUInt16LE:function(e,r){e.push(255&r,r>>>8&255)},writeUInt32LE:function(e,r){e.push(255&r,r>>>8&255,r>>>16&255,r>>>24&255)},fill:function(e,r,t,a){for(var n=t;a>n;n++)e[n]=r},encode:function(){var e=this,r=e.width,t=e.height,a=[],n=new Array(e.offset+e.rgbSize);e.write(a,e.flag),e.writeUInt32LE(a,e.fileSize),e.writeUInt32LE(a,e.reserved),e.writeUInt32LE(a,e.offset),e.writeUInt32LE(a,e.headerInfoSize),e.writeUInt32LE(a,r),e.writeUInt32LE(a,t),e.writeUInt16LE(a,e.planes),e.writeUInt16LE(a,e.bitPP),e.writeUInt32LE(a,e.compress),e.writeUInt32LE(a,e.rgbSize),e.writeUInt32LE(a,e.hr),e.writeUInt32LE(a,e.vr),e.writeUInt32LE(a,e.colors),e.writeUInt32LE(a,e.importantColors);var o,i,s,f,c,l,d,h=0,u=3*r+e.extraBytes;for(o=t-1;o>=0;o--){for(i=0;r>i;i++)s=o*u+3*i,f=e.data[h++],c=e.data[h++],l=e.data[h++],h++,n[s+2]=f,n[s+1]=c,n[s]=l;e.extraBytes>0&&(d=o*u+3*r,e.fill(n,0,d,d+e.extraBytes))}return new Uint8Array(a.concat(n))}},e.Codec.BMP={encoder:function(e,r){"undefined"==typeof r.quality?100:r.quality;return new Buffer(new a(e).encode())},decoder:function(e,r){var a=new t(new Uint8Array(e));return{data:a.data,width:a.width,height:a.height}}}}(r),!function(e,r){function t(e){return e.reduce(function(e,r){return 2*e+r},0)}function a(e){for(var r=[],t=7;t>=0;t--)r.push(!!(e&1<<t));return r}function n(e,r){for(var t,a,n=0,o=function(e){for(var t=0,a=0;e>a;a++)r.charCodeAt(n>>3)&1<<(7&n)&&(t|=1<<a),n++;return t},i=[],s=1<<e,f=s+1,c=e+1,l=[],d=function(){l=[],c=e+1;for(var r=0;s>r;r++)l[r]=[r];l[s]=[],l[f]=null};;)if(a=t,t=o(c),t!==s){if(t===f)break;if(t<l.length)a!==s&&l.push(l[a].concat(l[t][0]));else{if(t!==l.length)throw new Error("Invalid LZW code.");l.push(l[a].concat(l[a][0]))}i.push.apply(i,l[t]),l.length===1<<c&&12>c&&c++}else d();return i}function o(e){var r=this;r.data=e,r.len=r.data.length,r.pos=0,r.readByte=function(){var r=this;if(r.pos>=r.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[r.pos++]:255&e.charCodeAt(r.pos++)},r.readBytes=function(e){for(var r=this,t=[],a=0;e>a;a++)t.push(r.readByte());return t},r.read=function(e){for(var r=this,t="",a=0;e>a;a++)t+=String.fromCharCode(r.readByte());return t},r.readUnsigned=function(){var e=this,r=e.readBytes(2);return(r[1]<<8)+r[0]}}function i(e,r){r||(r={});var o=function(r){for(var t=[],a=0;r>a;a++)t.push(e.readBytes(3));return t},i=function(){var r,t;t="";do r=e.readByte(),t+=e.read(r);while(0!==r);return t},s=function(){var n={};if(n.sig=e.read(3),n.ver=e.read(3),"GIF"!==n.sig)throw new Error("Not a GIF file.");n.width=e.readUnsigned(),n.height=e.readUnsigned();var i=a(e.readByte());n.gctFlag=i.shift(),n.colorRes=t(i.splice(0,3)),n.sorted=i.shift(),n.gctSize=t(i.splice(0,3)),n.bgColor=e.readByte(),n.pixelAspectRatio=e.readByte(),n.gctFlag&&(n.gct=o(1<<n.gctSize+1)),r.hdr&&r.hdr(n)},f=function(n){var o=function(n){var o=(e.readByte(),a(e.readByte()));n.reserved=o.splice(0,3),n.disposalMethod=t(o.splice(0,3)),n.userInput=o.shift(),n.transparencyGiven=o.shift(),n.delayTime=e.readUnsigned(),n.transparencyIndex=e.readByte(),n.terminator=e.readByte(),r.gce&&r.gce(n)},s=function(e){e.comment=i(),r.com&&r.com(e)},f=function(t){e.readByte();t.ptHeader=e.readBytes(12),t.ptData=i(),r.pte&&r.pte(t)},c=function(t){var a=function(t){e.readByte();t.unknown=e.readByte(),t.iterations=e.readUnsigned(),t.terminator=e.readByte(),r.app&&r.app.NETSCAPE&&r.app.NETSCAPE(t)},n=function(e){e.appData=i(),r.app&&r.app[e.identifier]&&r.app[e.identifier](e)};e.readByte();switch(t.identifier=e.read(8),t.authCode=e.read(3),t.identifier){case"NETSCAPE":a(t);break;default:n(t)}},l=function(e){e.data=i(),r.unknown&&r.unknown(e)};switch(n.label=e.readByte(),n.label){case 249:n.extType="gce",o(n);break;case 254:n.extType="com",s(n);break;case 1:n.extType="pte",f(n);break;case 255:n.extType="app",c(n);break;default:n.extType="unknown",l(n)}},c=function(s){var f=function(e,r){for(var t=new Array(e.length),a=e.length/r,n=function(a,n){var o=e.slice(n*r,(n+1)*r);t.splice.apply(t,[a*r,r].concat(o))},o=[0,4,2,1],i=[8,8,4,2],s=0,f=0;4>f;f++)for(var c=o[f];a>c;c+=i[f])n(c,s),s++;return t};s.leftPos=e.readUnsigned(),s.topPos=e.readUnsigned(),s.width=e.readUnsigned(),s.height=e.readUnsigned();var c=a(e.readByte());s.lctFlag=c.shift(),s.interlaced=c.shift(),s.sorted=c.shift(),s.reserved=c.splice(0,2),s.lctSize=t(c.splice(0,3)),s.lctFlag&&(s.lct=o(1<<s.lctSize+1)),s.lzwMinCodeSize=e.readByte();var l=i();s.pixels=n(s.lzwMinCodeSize,l),s.interlaced&&(s.pixels=f(s.pixels,s.width)),r.img&&r.img(s)},l=function(){var t={};switch(t.sentinel=e.readByte(),String.fromCharCode(t.sentinel)){case"!":t.type="ext",f(t);break;case",":t.type="img",c(t);break;case";":t.type="eof",r.eof&&r.eof(t);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&l()},d=function(){s(),l()};d()}e.Codec.GIF={encoder:e.NotImplemented("GIF.encoder"),decoder:function(r,t){var a,n=null,s={width:0,height:0,data:null};return i(new o(new Uint8Array(r)),{hdr:function(e){a=e},gce:function(e){n=e.transparencyGiven?e.transparencyIndex:null},img:function(r){var t=r.lctFlag?r.lct:a.gct,o=new e.ImArray(r.width*r.height*4);r.pixels.forEach(function(e,r){e!==n&&(o[(r<<2)+0]=t[e][0],o[(r<<2)+1]=t[e][1],o[(r<<2)+2]=t[e][2],o[(r<<2)+3]=255)}),s.width=r.width,s.height=r.height,s.data=o}}),s}}}(r),!function(e,r){function t(e){switch(e.image_type){case u:case g:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&d("TGA.tgaCheckHeader: Invalid type colormap data for indexed type");break;case p:case v:case m:case y:e.colormap_type&&d("TGA.tgaCheckHeader: Invalid type colormap data for colormap type");break;case h:d("TGA.tgaCheckHeader: No data");default:d('TGA.tgaCheckHeader: Invalid type " '+e.image_type+'"')}(e.width<=0||e.height<=0)&&d("TGA.tgaCheckHeader: Invalid image size"),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&d('TGA.tgaCheckHeader: Invalid pixel size "'+e.pixel_size+'"')}function a(e,r,t,a,n){var o,i,s,f;if(i=t.pixel_size>>3,s=t.width*t.height*i,r&&(f=n.subarray(a,a+=t.colormap_length*(t.colormap_size>>3))),e){o=new Uint8Array(s);for(var c,l,d,h=0,u=new Uint8Array(i);s>h;)if(c=n[a++],l=(127&c)+1,128&c){for(d=0;i>d;++d)u[d]=n[a++];for(d=0;l>d;++d)o.set(u,h+d*i);h+=i*l}else{for(l*=i,d=0;l>d;++d)o[h+d]=n[a++];h+=l}}else o=n.subarray(a,a+=r?t.width*t.height:s);return{pixel_data:o,palettes:f}}function n(e,r,t,a,n,o,i,s,f,c){var l,d,h,u=c,p=0,v=e.width;for(h=t;h!==n;h+=a)for(d=o;d!==s;d+=i,p++)l=f[p],r[4*(d+v*h)+3]=255,r[4*(d+v*h)+2]=u[3*l+0],r[4*(d+v*h)+1]=u[3*l+1],r[4*(d+v*h)+0]=u[3*l+2];return r}function o(e,r,t,a,n,o,i,s,f){var c,l,d,h=0,u=e.width;for(d=t;d!==n;d+=a)for(l=o;l!==s;l+=i,h+=2)c=f[h+0]+(f[h+1]<<8),r[4*(l+u*d)+0]=(31744&c)>>7,r[4*(l+u*d)+1]=(992&c)>>2,r[4*(l+u*d)+2]=(31&c)>>3,r[4*(l+u*d)+3]=32768&c?0:255;return r}function i(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=3)r[4*(c+h*l)+3]=255,r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+1]=f[d+1],r[4*(c+h*l)+0]=f[d+2];return r}function s(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=4)r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+1]=f[d+1],r[4*(c+h*l)+0]=f[d+2],r[4*(c+h*l)+3]=f[d+3];return r}function f(e,r,t,a,n,o,i,s,f){var c,l,d,h=0,u=e.width;for(d=t;d!==n;d+=a)for(l=o;l!==s;l+=i,h++)c=f[h],r[4*(l+u*d)+0]=c,r[4*(l+u*d)+1]=c,r[4*(l+u*d)+2]=c,r[4*(l+u*d)+3]=255;return r}function c(e,r,t,a,n,o,i,s,f){var c,l,d=0,h=e.width;for(l=t;l!==n;l+=a)for(c=o;c!==s;c+=i,d+=2)r[4*(c+h*l)+0]=f[d+0],r[4*(c+h*l)+1]=f[d+0],r[4*(c+h*l)+2]=f[d+0],r[4*(c+h*l)+3]=f[d+1];return r}function l(e,r,t,a,l,h){var u,p,v,g,m,y,B=new Uint8Array(r*t*4);switch((e.flags&b)>>w){default:case A:u=0,v=1,m=r,p=0,g=1,y=t;break;case U:u=0,v=1,m=r,p=t-1,g=-1,y=-1;break;case I:u=r-1,v=-1,m=-1,p=0,g=1,y=t;break;case k:u=r-1,v=-1,m=-1,p=t-1,g=-1,y=-1}if(h)switch(e.pixel_size){case 8:f(e,B,p,g,y,u,v,m,a);break;case 16:c(e,B,p,g,y,u,v,m,a);break;default:d("TGA.getTgaRGBA: not support this format")}else switch(e.pixel_size){case 8:n(e,B,p,g,y,u,v,m,a,l);break;case 16:o(e,B,p,g,y,u,v,m,a);break;case 24:i(e,B,p,g,y,u,v,m,a);break;case 32:s(e,B,p,g,y,u,v,m,a);break;default:d("TGA.getTgaRGBA: not support this format")}return B}var d=function(r){e.error(r,!0)},h=0,u=1,p=2,v=3,g=9,m=10,y=11,b=48,w=4,U=0,k=1,A=2,I=3;e.Codec.TGA={encoder:e.NotImplemented("TGA.encoder"),decoder:function(e,r){e.length<19&&d("TGA: Not enough data to contain header.");var n=new Uint8Array(e),o=0,i={id_length:n[o++],colormap_type:n[o++],image_type:n[o++],colormap_index:n[o++]|n[o++]<<8,colormap_length:n[o++]|n[o++]<<8,colormap_size:n[o++],origin:[n[o++]|n[o++]<<8,n[o++]|n[o++]<<8],width:n[o++]|n[o++]<<8,height:n[o++]|n[o++]<<8,pixel_size:n[o++],flags:n[o++]};t(i),i.id_length+o>e.length&&d("TGA: No data"),o+=i.id_length;var s=!1,f=!1,c=!1;switch(i.image_type){case g:s=!0,f=!0;break;case u:f=!0;break;case m:s=!0;break;case p:break;case y:s=!0,c=!0;break;case v:c=!0}var h=a(s,f,i,o,n),b=l(i,i.width,i.height,h.pixel_data,h.palettes,c);return{width:i.width,height:i.height,data:b}}}}(r),!function(e,r){var t=function(r){e.error(r,!0)},a="hasOwnproperty",n=Array.prototype.push,o=Array.prototype.slice,i=-1,s=1,f=2,c=3,l=4,d=function(e,r){switch(e){case s:t("RGBE Read Error: "+(r||""));break;case f:t("RGBE Write Error: "+(r||""));break;case c:t("RGBE Bad File Format: "+(r||""));break;case l:default:t("RGBE: Error: "+(r||""))}return i},h=4,u=1,p=2,v=4,g="\n",m=function(e,r,t){r=r?r:1024;for(var a=e.pos,n=-1,o=0,i="",s=128,f=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+s)));0>(n=f.indexOf(g))&&r>o&&a<e.byteLength;)i+=f,o+=f.length,a+=s,f+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+s)));return n>-1?(!1!==t&&(e.pos+=o+n+1),i+f.slice(0,n)):!1},y=function(e,r){var t,a,i=r.length;for(b=new Uint16Array(i),t=0;i>t;t++)a=r.charCodeAt(t),b[t]=a;n.apply(e,o.call(new Uint8Array(b)))},w=function(e,r){n.apply(e,o.call(r))},U=/^#\?(\S+)$/,k=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,A=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,I=/^\s*FORMAT=(\S+)\s*$/,B=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,C=function(e){var r,t,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(r=m(e)))return d(s,"no header found");if(!(t=r.match(U)))return d(c,"bad initial token");for(a.valid|=u,a.programtype=t[1],a.string+=r+"\n";;){if(r=m(e),!1===r)break;if(a.string+=r+"\n","#"!==r.charAt(0)){if((t=r.match(k))&&(a.gamma=parseFloat(t[1],10)),(t=r.match(A))&&(a.exposure=parseFloat(t[1],10)),(t=r.match(I))&&(a.valid|=p,a.format=t[1]),(t=r.match(B))&&(a.valid|=v,a.height=parseInt(t[1],10),a.width=parseInt(t[2],10)),a.valid&p&&a.valid&v)break}else a.comments+=r+"\n"}return a.valid&p?a.valid&v?a:d(c,"missing image size specifier"):d(c,"missing format specifier")},L=function(e,r,t,n){var o="RGBE";n=n||{},n[a]("programtype")&&(o=n.programtype),y(e,"#?"+o+"\n"),n[a]("gamma")&&y(e,"GAMMA="+n.gamma+"\n"),n[a]("exposure")&&y(e,"EXPOSURE="+n.exposure+"\n"),y(e,"FORMAT=32-bit_rle_rgbe\n\n"),y(e,"-Y "+~~t+" +X "+~~r+"\n")},x=function(e,r,t){var a,n,o,i,f,h,u,p,v,g,m,y,b,w=r,U=t;if(8>w||w>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(w!==(e[2]<<8|e[3]))return d(c,"wrong scanline width");if(a=new Uint8Array(4*r*t),!a||!a.length)return d(l,"unable to allocate buffer space");for(n=0,o=0,p=4*w,b=new Uint8Array(4),h=new Uint8Array(p);U>0&&o<e.byteLength;){if(o+4>e.byteLength)return d(s);if(b[0]=e[o++],b[1]=e[o++],b[2]=e[o++],b[3]=e[o++],2!=b[0]||2!=b[1]||(b[2]<<8|b[3])!=w)return d(c,"bad rgbe scanline format");for(u=0;p>u&&o<e.byteLength;){if(i=e[o++],y=i>128,y&&(i-=128),0===i||u+i>p)return d(c,"bad scanline data");if(y)for(f=e[o++],v=0;i>v;v++)h[u++]=f;else h.set(e.subarray(o,o+i),u),u+=i,o+=i}for(g=w,v=0;g>v;v++)m=0,a[n]=h[v+m],m+=w,a[n+1]=h[v+m],m+=w,a[n+2]=h[v+m],m+=w,a[n+3]=h[v+m],n+=4;U--}return a},E=function(e,r,t){var a,n,o,i,s,f=4,c=new Uint8Array(2);for(a=0;t>a;){for(n=a,o=i=0;f>o&&t>n;)for(n+=o,i=o,o=1;t>n+o&&127>o&&r[n]==r[n+o];)o++;for(i>1&&i==n-a&&(c[0]=128+i,c[1]=r[a],w(e,c),a=n);n>a;)s=n-a,s>128&&(s=128),c[0]=s,w(e,c),w(e,r.subarray(a,s)),a+=s;o>=f&&(c[0]=128+o,c[1]=r[n],w(e,c),a+=o)}},P=function(e,r,t,a){var n,o,i,s=new Uint8Array(4);if(8>t||t>32767)return void w(e,r);for(n=new Uint8Array(4*t),i=0;a-- >0;){for(s[0]=2,s[1]=2,s[2]=t>>8,s[3]=255&t,w(e,s),o=0;t>o;o++)s[0]=r[datapos+0],s[1]=r[datapos+1],s[2]=r[datapos+2],s[3]=r[datapos+3],n[o]=s[0],n[o+t]=s[1],n[o+2*t]=s[2],n[o+3*t]=s[3],i+=h;for(o=0;4>o;o++)E(e,n[o*t],t)}};e.Codec.HDR=e.Codec.RGBE={encoder:function(e,r){r=r||{};var t=[];return L(t,e.width,e.height,r),P(t,e.data,r.scanline_width||0,r.num_scanlines||0),new Buffer(new Uint8Array(t))},decoder:function(e,r){var t=new Uint8Array(e);t.byteLength;t.pos=0;var a=C(t);if(i!==a){var n=a.width,o=a.height,s=x(t.subarray(t.pos),n,o);if(i!==s)return r&&(r.header=a.string,r.gamma=a.gamma,r.exposure=a.exposure),{width:n,height:o,data:s}}return null}}}(r),r});
/**
*
*   FILTER.js Generic Filters
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Generic Filters)
*   https://github.com/foo123/FILTER.js
*
**/!function(t,e){"use strict";"object"==typeof module&&module.exports?module.exports=e.call(t,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_FILTERS")?define("FILTER_FILTERS",["module","FILTER"],function(n,i){return e.moduleUri=n.uri,e.call(t,i),i}):(e.call(t,t.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return t.FILTER})}(this,function t(e){"use strict";var n=e.getPath(t.moduleUri);return!function(t,e){var i=(Object.prototype,Function.prototype,Array.prototype),r=i.slice,l=i.splice,a=i.push,s=t.Filter.get,o=t.Create({name:"CompositeFilter",init:function(t){var e=this;e.filters=t&&t.length?t:[]},path:n,filters:null,hasInputs:!0,_stable:!0,dispose:function(t){var e,n=this,i=n.filters;if(!0===t)for(e=0;e<i.length;e++)i[e]&&i[e].dispose(t),i[e]=null;return n.filters=null,n.$super("dispose"),n},serializeInputs:function(t){var e,n,i,r=this,l=r.filters,a=[],s=!1;for(e=0,n=l.length;n>e;e++)a.push(i=l[e].serializeInputs(t)),i&&(s=!0);return s?a:null},unserializeInputs:function(t,e){var n=this;if(!t)return n;var i,r,l=n.filters;for(i=0,r=l.length;r>i;i++)t[i]&&l[i].unserializeInputs(t[i],e);return n},serialize:function(){var t,e,n=this,i=n.filters,r=[];for(t=0,e=i.length;e>t;t++)r.push(i[t].serializeFilter());return{_stable:n._stable,filters:r}},unserialize:function(t){var e,n,i,r,l,a=this,o=a.filters;if(a._stable=t._stable,r=t.filters||[],n=r.length,i=o.length,n===i&&a._stable)for(e=0;n>e;e++)o[e].unserializeFilter(r[e]);else{for(e=0;i>e;e++)o[e]&&o[e].dispose(!0),o[e]=null;for(o=[],e=0;n>e;e++){if(l=r[e]&&r[e].filter?s(r[e].filter):null,!l)throw new Error('Filter "'+r[e].filter+'" could not be created');o.push((new l).unserializeFilter(r[e]))}a.filters=o}return a},setMeta:function(t,e){var n,i,r=this,l=r.filters;if(t&&t.filters&&(i=t.filters.length)&&l.length)for(n=0;i>n;n++)l[t.filters[n][0]].setMeta(t.filters[n][1],e);return t&&null!=t._IMG_WIDTH&&(r._meta={_IMG_WIDTH:t._IMG_WIDTH,_IMG_HEIGHT:t._IMG_HEIGHT},r.hasMeta=!0),r},stable:function(t){return arguments.length||(t=!0),this._stable=!!t,this},set:function(t){return t&&t.length&&(this.filters=t),this},filter:function(t,e){return arguments.length>1?(this.filters.length>t?this.filters[t]=e:this.filters.push(e),this):this.filters.length>t?this.filters[t]:null},get:null,push:function(){return arguments.length&&a.apply(this.filters,arguments),this},concat:null,pop:function(){return this.filters.pop()},shift:function(){return this.filters.shift()},unshift:function(){return arguments.length&&l.apply(this.filters,a.apply([0,0],arguments)),this},insertAt:function(t){var e=r.call(arguments);e.length;return argslen>1&&(e.shift(),l.apply(this.filters,[t,0].concat(e))),this},removeAt:function(t){return this.filters.splice(t,1)},remove:function(t){for(var e=this.filters.length;--e>=0;)t===this.filters[e]&&this.filters.splice(e,1);return this},reset:function(){return this.filters.length=0,this},empty:null,_apply:function(t,e,n,i){var r,l,a=this;if(l={filters:[]},a.filters.length){i=i||{},i.container=a,i.index=0;var s,o,u=a.filters,c=u.length;for(s=0;c>s;s++)o=u[s],o&&o._isOn&&(i.index=s,t=o._apply(t,e,n,i),o.hasMeta&&(l.filters.push([s,r=o.getMeta()]),null!=r._IMG_WIDTH&&(l._IMG_WIDTH=e=r._IMG_WIDTH,l._IMG_HEIGHT=n=r._IMG_HEIGHT)))}return l.filters.length>0?(a.hasMeta=!0,a._meta=l):(a.hasMeta=!1,a._meta=null),t},canRun:function(){return this._isOn&&this.filters.length},toString:function(){var t,e="	",n=this.filters,i=[],r=n.length;for(t=0;r>t;t++)i.push(e+n[t].toString().split("\n").join("\n"+e));return["[FILTER: "+this.name+"]","[",i.join("\n"),"]",""].join("\n")}});o.prototype.get=o.prototype.filter,o.prototype.empty=o.prototype.reset,o.prototype.concat=o.prototype.push,t.CompositionFilter=t.CompositeFilter}(e),!function(t,e){var i=Math.min,r=Math.max,l=(Math.floor,t.Array32F),a=t._notSupportClamp;t.Create({name:"AlgebraicFilter",init:function(t){var e=this;e.set(t)},path:n,matrix:null,raw:!1,hasInputs:!0,dispose:function(){var t=this;return t.matrix=null,t.raw=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix,raw:t.raw}},unserialize:function(t){var e=this;return e.matrix=t.matrix,e.raw=t.raw,e},fastGradient:function(t){return this},set:function(t){var e=this;return t&&t.length&&(e.matrix=t),e},setInputValues:function(t,n){var i,r=this,l=r.matrix;return n&&(l||(l=r.matrix=[1,0,0,0,0,null,null]),i=7*(t-1),null!=n.a&&(l[i]=+n.a),null!=n.b&&(l[i+1]=+n.b),null!=n.c&&(l[i+2]=+n.c),null!=n.tx&&(l[i+3]=+n.tx),null!=n.ty&&(l[i+4]=+n.ty),e!==n.co&&(l[i+5]=n.co),e!==n.ci&&(l[i+6]=n.ci)),r},reset:function(){var t=this;return t.matrix=null,t},_apply:function(t,e,n){var s=this,o=s.matrix;if(!o||!o.length)return t;var u,c,f,h,m,_,p,d,v,g,C,R,y,x,I,A,w,b,L,E,T,G,M,S,F,N,Y,B,O,H,X,z=o.length,D=t.length,U=D>>>2,V=new l(D);for(f=0,b=e,L=n,w=t,c=0;z>c;c+=7){if(E=i(e,b),T=i(n,L),X=E*T,R=o[c+0],y=o[c+1],x=o[c+2]||0,g=(o[c+3]||0)*(e-1)|0,C=(o[c+4]||0)*(n-1)*e|0,A=o[c+5],I=o[c+6],null!==I&&null!==A)for(d=0,p=C,v=0,u=0;X>u;u++,d++)d>=E&&(d=0,p+=e,v+=b),_=d+g,0>_||_>=e||0>p||p>=U||(h=_+p<<2,m=d+v<<2,V[h+A]=R*V[h+A]+y*w[m+I]+x);else if(null!==I)for(d=0,p=C,v=0,u=0;X>u;u++,d++)d>=E&&(d=0,p+=e,v+=b),_=d+g,0>_||_>=e||0>p||p>=U||(h=_+p<<2,m=d+v<<2,H=y*w[m+I]+x,V[h]=R*V[h]+H,V[h+1]=R*V[h+1]+H,V[h+2]=R*V[h+2]+H,V[h+3]=R*V[h+3]+H);else if(null!==A)for(G=(y>>>16&255)/255,M=(y>>>8&255)/255,S=(255&y)/255,F=(y>>>24&255)/255,N=x>>>16&255,Y=x>>>8&255,B=255&x,O=x>>>24&255,d=0,p=C,v=0,u=0;X>u;u++,d++)d>=E&&(d=0,p+=e,v+=b),_=d+g,0>_||_>=e||0>p||p>=U||(h=_+p<<2,m=d+v<<2,V[h+A]=R*V[h+A]+G*w[m]+N+M*w[m+1]+Y+S*w[m+2]+B+F*w[m+3]+O);else for(d=0,p=C,v=0,u=0;X>u;u++,d++)d>=E&&(d=0,p+=e,v+=b),_=d+g,0>_||_>=e||0>p||p>=U||(h=_+p<<2,m=d+v<<2,V[h]=R*V[h]+y*w[m]+x,V[h+1]=R*V[h+1]+y*w[m+1]+x,V[h+2]=R*V[h+2]+y*w[m+2]+x,V[h+3]=R*V[h+3]+y*w[m+3]+x);w=s.input(++f),b=w[1],L=w[2],w=w[0]}if(a)for(u=0;D>u;u+=4)t[u]=i(255,r(0,0|V[u])),t[u+1]=i(255,r(0,0|V[u+1])),t[u+2]=i(255,r(0,0|V[u+2])),t[u+3]=i(255,r(0,0|V[u+3]));else for(u=0;D>u;u+=4)t[u]=0|V[u],t[u+1]=0|V[u+1],t[u+2]=0|V[u+2],t[u+3]=0|V[u+3];return t}})}(e),!function(t,e){var i="hasOwnProperty",r=t.ImArray,l=(t.ImArrayCopy,Math.min),a=Math.round,s=t.Util.Array.hasArrayset,o=t.Util.Array.arrayset,u=t._notSupportClamp,c=t.Color.Blend;t.Create({name:"BlendFilter",init:function(t){var e=this;e.set(t)},path:n,matrix:null,hasInputs:!0,dispose:function(){var t=this;return t.matrix=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix}},unserialize:function(t){var e=this;return e.matrix=t.matrix,e},set:function(t){var e=this;return t&&t.length&&(e.matrix=t),e},setInputValues:function(t,n){var i,r=this,l=r.matrix;return n&&(l||(l=r.matrix=["normal",0,0,1,1]),i=t-1<<2,e!==n.mode&&(l[i]=n.mode||"normal"),null!=n.startX&&(l[i+1]=+n.startX),null!=n.startY&&(l[i+2]=+n.startY),null!=n.alpha&&(l[i+3]=+n.alpha),null!=n.enabled&&(l[i+4]=!!n.enabled)),r},reset:function(){var t=this;return t.matrix=null,t.resetInputs(),t},_apply:function(t,e,n){var f=this,h=f.matrix;if(!h||!h.length)return t;var m,_,p,d,v,g,C,R,y,x,I,A,w,b,L,E,T,G,M,S,F,N,Y,B,O,H=h.length,X=t.length;for(O=new r(X),s?O.set(t):o(O,t),m=0,_=1;H>m;m+=5,_++)if(h[m+4]&&(d=h[m+3]||0,0!==d&&(B=h[m]||"normal",Y=c[i](B)?c[B]:null,Y&&(p=f.input(_),p&&(I=p[0],A=p[1],w=p[2],v=h[m+1]||0,g=h[m+2]||0,C=0,R=0,0>v&&(C=-v,v=0),0>g&&(R=-g,g=0),!(v>=e||g>=n||C>=A||R>=w||(v=a(v),g=a(g),C=a(C),R=a(R),y=l(e-v,A-C),x=l(n-g,w-R),0>=y||0>=x)))))))for(G=v,M=g*e,S=C,F=R*A,b=v+y,L=C+y,E=0,T=x*y;T>E;E++)N=S+F<<2,0<I[N+3]&&Y(O,I,G+M<<2,N,d,u),++G>=b&&(G=v,M+=e),++S>=L&&(S=C,F+=A);return O}}),t.CombineFilter=t.BlendFilter}(e),!function(t,e){var i=t.CHANNEL,r=t.ColorTable,l=t.Color.clampPixel,a=t.Util.Filter,s=a.ct_eye,o=a.ct_multiply,u=Math.pow,c=Math.exp,f=1/255,h=t.Util.Array.typed,m=t.Create({name:"ColorTableFilter",init:function(t,e,n,r){var l=this;l.table=[null,null,null,null],t=t||null,e=e||t,n=n||e,r=r||null,l.table[i.R]=t,l.table[i.G]=e,l.table[i.B]=n,l.table[i.A]=r},path:n,table:null,dispose:function(){var t=this;return t.table=null,t.$super("dispose"),t},serialize:function(){var t=this;return{tableR:t.table[i.R],tableG:t.table[i.G],tableB:t.table[i.B],tableA:t.table[i.A]}},unserialize:function(t){var e=this;return e.table[i.R]=h(t.tableR,r),e.table[i.G]=h(t.tableG,r),e.table[i.B]=h(t.tableB,r),e.table[i.A]=h(t.tableA,r),e},channel:function(t){if(null==t)return this;var e,n,r;switch(t||i.R){case i.B:e=s(0,0),n=s(0,0),r=s();break;case i.G:e=s(0,0),n=s(),r=s(0,0);break;case i.R:default:e=s(),n=s(0,0),r=s(0,0)}return this.set(e,n,r)},redChannel:function(){return this.channel(i.R)},greenChannel:function(){return this.channel(i.G)},blueChannel:function(){return this.channel(i.B)},channelInvert:function(t){if(null==t)return this;var e,n,r;switch(t||i.R){case i.B:e=s(),n=s(),r=s(-1,255);break;case i.G:e=s(),n=s(-1,255),r=s();break;case i.R:default:e=s(-1,255),n=s(),r=s()}return this.set(e,n,r)},redInvert:function(){return this.channelInvert(i.R)},greenInvert:function(){return this.channelInvert(i.G)},blueInvert:function(){return this.channelInvert(i.B)},invert:function(){return this.set(s(-1,255))},thresholds:function(t,e,n){t.length||(t=[t]),e||(e=t),n||(n=e);var i,a,s=t.length,o=s+1,u=e.length,c=u+1,f=n.length,h=f+1,m=new r(256),_=new r(o),p=new r(256),d=new r(c),v=new r(256),g=new r(h),C=255/(o-1),R=255/(c-1),y=255/(h-1);for(i=0;o>i;)_[i]=C*i|0,i++;for(t[0]=255*t[0]|0,i=1;s>i;)t[i]=t[i-1]+255*t[i]|0,i++;for(i=0;c>i;)d[i]=R*i|0,i++;for(e[0]=255*e[0]|0,i=1;u>i;)e[i]=e[i-1]+255*e[i]|0,i++;for(i=0;h>i;)g[i]=y*i|0,i++;for(n[0]=255*n[0]|0,i=1;f>i;)n[i]=n[i-1]+255*n[i]|0,i++;for(i=0;256>i;i++){for(a=0;s>a&&i>t[a];)a++;for(m[i]=l(_[a]),a=0;u>a&&i>e[a];)a++;for(p[i]=l(d[a]),a=0;f>a&&i>n[a];)a++;v[i]=l(g[a])}return this.set(m,p,v)},threshold:function(t,e,n){return t=null==t?.5:t,e=null==e?t:e,n=null==n?e:n,this.thresholds([t],[e],[n])},quantize:function(t){null==t&&(t=64),2>t&&(t=2);var e,n=new r(256),i=new r(t),a=255/(t-1),s=t/256;for(e=0;t>e;)i[e]=a*e|0,e++;for(e=0;256>e;e++)n[e]=l(i[s*e|0]);return this.set(n)},posterize:null,binarize:function(){return this.quantize(2)},solarize:function(t,e){null==e&&(e=1),null==t&&(t=.5);var n,i,a,s=new r(256),o=2/255;if(-1===e)for(t*=256,n=0;256>n;n++)s[n]=n>t?255-n:n;else if(2===e)for(t=1-t,n=0;256>n;n++)i=o*n,a=t>i?255-255*i|0:255*i-255|0,s[n]=l(a);else for(n=0;256>n;n++)i=o*n,a=i>t?255-255*i|0:255*i-255|0,s[n]=l(a);return this.set(s)},solarize2:function(t){return this.solarize(t,2)},solarizeInverse:function(t){return this.solarize(t,-1)},mask:function(t){var e=0,n=new r(256),i=new r(256),a=new r(256),s=t>>>16&255,o=t>>>8&255,u=255&t;for(e=0;256>e;e++)n[e]=l(e&s),i[e]=l(e&o),a[e]=l(e&u);return this.set(n,i,a)},replace:function(t,e){if(t==e)return this;var n=t>>>16&255,i=t>>>8&255,r=255&t,l=e>>>16&255,a=e>>>8&255,o=255&e,u=s(),c=s(),f=s();return u[n]=l,c[i]=a,f[r]=o,this.set(u,c,f)},extract:function(t,e,n){if(!e||!e.length)return this;n=n||0;var r,a,o=n>>>16&255,u=n>>>8&255,c=255&n,f=s(0,o),h=s(0,u),m=s(0,c);switch(t||i.R){case i.B:for(r=e[0],a=e[1];a>=r;)m[r]=l(r),r++;break;case i.G:for(r=e[0],a=e[1];a>=r;)h[r]=l(r),r++;break;case i.R:default:for(r=e[0],a=e[1];a>=r;)f[r]=l(r),r++}return this.set(f,h,m)},gammaCorrection:function(t,e,n){t=t||1,e=e||t,n=n||e,t=1/t,e=1/e,n=1/n;var i=new r(256),a=new r(256),s=new r(256),o=0;for(o=0;256>o;o++)i[o]=l(255*u(f*o,t)|0),a[o]=l(255*u(f*o,e)|0),s[o]=l(255*u(f*o,n)|0);return this.set(i,a,s)},exposure:function(t){null==t&&(t=1);var e=0,n=new r(256);for(e=0;256>e;e++)n[e]=l(255*(1-c(-t*e*f))|0);return this.set(n)},set:function(t,e,n,r){if(!t)return this;var l,a,u=this.table,c=u[i.R]||s();return e||n?(e=e||t,n=n||e,l=u[i.G]||c,a=u[i.B]||l,u[i.R]=o(t,c),u[i.G]=o(e,l),u[i.B]=o(n,a)):(u[i.R]=o(t,c),u[i.G]=u[i.R],u[i.B]=u[i.R]),this},reset:function(){return this.table=[null,null,null,null],this},combineWith:function(t){return this.set(t.getTable(i.R),t.getTable(i.G),t.getTable(i.B))},getTable:function(t){return this.table[t||i.R]||null},setTable:function(t,e){return this.table[e||i.R]=t||null,this},_apply:function(t,e,n){var r=this,l=r.table;if(!l||!l[i.R])return t;var a,s,o=t.length,u=o>>>2,c=(15&u)<<2,f=l[0],h=l[1],m=l[2],_=l[3];if(_){for(s=0;o>s;s+=64)a=s,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]],t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],t[a]=_[t[a++]];if(c){for(a=o-c;o>a;a+=4)t[a]=f[t[a]];t[a+1]=h[t[a+1]],t[a+2]=m[t[a+2]],t[a+3]=_[t[a+3]]}}else{for(s=0;o>s;s+=64)a=s,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a,t[a]=f[t[a++]],t[a]=h[t[a++]],t[a]=m[t[a++]],++a;if(c){for(a=o-c;o>a;a+=4)t[a]=f[t[a]];t[a+1]=h[t[a+1]],t[a+2]=m[t[a+2]]}}return t},canRun:function(){return this._isOn&&this.table&&this.table[i.R]}});m.prototype.posterize=m.prototype.levels=m.prototype.quantize,t.TableLookupFilter=t.ColorTableFilter}(e),!function(t,e){var i=t.CHANNEL,r=t.ColorMatrix,l=t.Array8U,a=t.Util.Filter,s=(a.cm_eye,a.cm_multiply),o=a.cm_combine,u=a.cm_rechannel,c=Math.sin,f=Math.cos,h=t.CONST.toRad,m=(t.CONST.toDeg,t.Util.Array.typed),_=t._notSupportClamp,p=t.Create({name:"ColorMatrixFilter",init:function(t){var e=this;e.matrix=t&&t.length?new r(t):null},path:n,matrix:null,dispose:function(){var t=this;return t.matrix=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix}},unserialize:function(t){var e=this;return e.matrix=m(t.matrix,r),e},channel:function(t,e){t=t||0;var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255],r=i.A===t||e?1:0;return n[5*i.R+t]=i.R===t?1:r,n[5*i.G+t]=i.G===t?1:r,n[5*i.B+t]=i.B===t?1:r,this.set(n)},redChannel:function(t){return this.channel(i.R,t)},greenChannel:function(t){return this.channel(i.G,t)},blueChannel:function(t){return this.channel(i.B,t)},alphaChannel:function(t){return this.channel(i.A,!0)},maskChannel:function(t){if(t=t||0,i.A===t)return this;var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return e[5*t+t]=0,this.set(e)},swapChannels:function(t,e){if(t===e)return this;var n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return n[5*t+t]=0,n[5*e+e]=0,n[5*t+e]=1,n[5*e+t]=1,this.set(n)},invertChannel:function(t){if(t=t||0,i.A===t)return this;var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];return e[5*t+t]=-1,e[5*t+4]=255,this.set(e)},invertRed:function(){return this.invertChannel(i.R)},invertGreen:function(){return this.invertChannel(i.G)},invertBlue:function(){return this.invertChannel(i.B)},invertAlpha:function(){return this.invertChannel(i.A)},invert:function(){return this.set(u([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},desaturate:function(){var e=t.LUMA;return this.set(u([e[0],e[1],e[2],0,0,e[0],e[1],e[2],0,0,e[0],e[1],e[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},grayscale:null,saturate:function(e){var n,r,l,a,s=t.LUMA;return n=1-e,r=n*s[0],l=n*s[1],a=n*s[2],this.set(u([r+e,l,a,0,0,r,l+e,a,0,0,r,l,a+e,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},colorize:function(e,n){var r,l,a,s,o=t.LUMA;return null==n&&(n=1),r=(e>>16&255)/255,l=(e>>8&255)/255,a=(255&e)/255,s=1-n,this.set(u([s+n*r*o[0],n*r*o[1],n*r*o[2],0,0,n*l*o[0],s+n*l*o[1],n*l*o[2],0,0,n*a*o[0],n*a*o[1],s+n*a*o[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},contrast:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),t+=1,e+=1,n+=1,this.set(u([t,0,0,0,128*(1-t),0,e,0,0,128*(1-e),0,0,n,0,128*(1-n),0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},brightness:function(t,e,n){return null==e&&(e=t),null==n&&(n=t),this.set(u([1,0,0,0,t,0,1,0,0,e,0,0,1,0,n,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},adjustHue:function(e){e*=h;var n=f(e),r=c(e),l=t.LUMA;return this.set(u([l[0]+n*(1-l[0])+r*-l[0],l[1]+n*-l[1]+r*-l[1],l[2]+n*-l[2]+r*(1-l[2]),0,0,l[0]+n*-l[0]+.143*r,l[1]+n*(1-l[1])+.14*r,l[2]+n*-l[2]+r*-.283,0,0,l[0]+n*-l[0]+r*-(1-l[0]),l[1]+n*-l[1]+r*l[1],l[2]+n*(1-l[2])+r*l[2],0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},rotateHue:null,average:function(t,e,n){return null==t&&(t=.3333),null==e&&(e=.3333),null==n&&(n=.3333),this.set(u([t,e,n,0,0,t,e,n,0,0,t,e,n,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},quickContrastCorrection:function(t){return null==t&&(t=1.2),this.set(u([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},sepia:function(t){return null==t&&(t=.5),t>1?t=1:0>t&&(t=0),this.set(u([1-.607*t,.769*t,.189*t,0,0,.349*t,1-.314*t,.168*t,0,0,.272*t,.534*t,1-.869*t,0,0,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},sepia2:function(e){null==e&&(e=10),e>100&&(e=100),e*=2.55;var n=t.LUMA;return this.set(u([n[0],n[1],n[2],0,40,n[0],n[1],n[2],0,20,n[0],n[1],n[2],0,-e,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},threshold:function(e,n,r){null==n&&(n=256);var l=t.LUMA;return this.set(u(!1!==r?[l[0]*n,l[1]*n,l[2]*n,0,-(n-1)*e,l[0]*n,l[1]*n,l[2]*n,0,-(n-1)*e,l[0]*n,l[1]*n,l[2]*n,0,-(n-1)*e,0,0,0,1,0]:[n,0,0,0,-(n-1)*e,0,n,0,0,-(n-1)*e,0,0,n,0,-(n-1)*e,0,0,0,1,0],i.R,i.G,i.B,i.A,i.R,i.G,i.B,i.A))},thresholdRGB:function(t,e){return this.threshold(t,e,!1)},threshold_rgb:null,thresholdChannel:function(e,n,r,l){null==r&&(r=256);var a=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],s=t.LUMA;return i.A===e?(a[5*e+e]=r,a[5*e+4]=-r*n):!1!==l?(a[5*e+i.R]=s[0]*r,a[5*e+i.G]=s[1]*r,a[5*e+i.B]=s[2]*r,a[5*e+4]=-(r-1)*n):(a[5*e+i.R]=r,a[5*e+i.G]=r,a[5*e+i.B]=r,a[5*e+4]=-(r-1)*n),this.set(a)},thresholdRed:function(t,e,n){return this.thresholdChannel(i.R,t,e,n)},thresholdGreen:function(t,e,n){return this.thresholdChannel(i.G,t,e,n)},thresholdBlue:function(t,e,n){return this.thresholdChannel(i.B,t,e,n)},thresholdAlpha:function(t,e,n){return this.thresholdChannel(i.A,t,e,n)},threshold_alpha:null,RGB2YCbCr:function(){return this.set(u([.299,.587,.114,0,0,-.168736,-.331264,.5,0,128,.5,-.418688,-.081312,0,128,0,0,0,1,0],i.R,i.G,i.B,i.A,i.Y,i.CB,i.CR,i.A))},YCbCr2RGB:function(){return this.set(u([1,0,1.402,0,-179.456,1,-.34414,-.71414,0,135.45984,1,1.772,0,0,-226.816,0,0,0,1,0],i.Y,i.CB,i.CR,i.A,i.R,i.G,i.B,i.A))},blend:function(t,e){var n=this;return n.matrix=n.matrix?o(n.matrix,t.matrix,1-e,e,r):new r(t.matrix),n},set:function(t){var e=this;return e.matrix=e.matrix?s(e.matrix,t):new r(t),e},reset:function(){return this.matrix=null,this},combineWith:function(t){return this.set(t.matrix)},_apply:_?function(t,e,n){var i=this,a=i.matrix;if(!a)return t;var s,o=t.length,u=o>>>2,c=(7&u)<<2,f=new r(32),h=new l(4),m=new r(4);for(s=0;o>s;s+=32)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],f[0]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[1]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[2]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[3]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+4],h[1]=t[s+5],h[2]=t[s+6],h[3]=t[s+7],f[4]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[5]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[6]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[7]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+8],h[1]=t[s+9],h[2]=t[s+10],h[3]=t[s+11],f[8]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[9]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[10]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[11]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+12],h[1]=t[s+13],h[2]=t[s+14],h[3]=t[s+15],f[12]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[13]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[14]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[15]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+16],h[1]=t[s+17],h[2]=t[s+18],h[3]=t[s+19],f[16]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[17]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[18]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[19]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+20],h[1]=t[s+21],h[2]=t[s+22],h[3]=t[s+23],f[20]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[21]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[22]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[23]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+24],h[1]=t[s+25],h[2]=t[s+26],h[3]=t[s+27],f[24]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[25]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[26]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[27]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+28],h[1]=t[s+29],h[2]=t[s+30],h[3]=t[s+31],f[28]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[29]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[30]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[31]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],f[0]=f[0]<0?0:f[0]>255?255:f[0],f[1]=f[1]<0?0:f[1]>255?255:f[1],f[2]=f[2]<0?0:f[2]>255?255:f[2],f[3]=f[3]<0?0:f[3]>255?255:f[3],f[4]=f[4]<0?0:f[4]>255?255:f[4],f[5]=f[5]<0?0:f[5]>255?255:f[5],f[6]=f[6]<0?0:f[6]>255?255:f[6],f[7]=f[7]<0?0:f[7]>255?255:f[7],f[8]=f[8]<0?0:f[8]>255?255:f[8],f[9]=f[9]<0?0:f[9]>255?255:f[9],f[10]=f[10]<0?0:f[10]>255?255:f[10],f[11]=f[11]<0?0:f[11]>255?255:f[11],f[12]=f[12]<0?0:f[12]>255?255:f[12],f[13]=f[13]<0?0:f[13]>255?255:f[13],f[14]=f[14]<0?0:f[14]>255?255:f[14],f[15]=f[15]<0?0:f[15]>255?255:f[15],f[16]=f[16]<0?0:f[16]>255?255:f[16],f[17]=f[17]<0?0:f[17]>255?255:f[17],f[18]=f[18]<0?0:f[18]>255?255:f[18],f[19]=f[19]<0?0:f[19]>255?255:f[19],f[20]=f[20]<0?0:f[20]>255?255:f[20],f[21]=f[21]<0?0:f[21]>255?255:f[21],f[22]=f[22]<0?0:f[22]>255?255:f[22],f[23]=f[23]<0?0:f[23]>255?255:f[23],f[24]=f[24]<0?0:f[24]>255?255:f[24],f[25]=f[25]<0?0:f[25]>255?255:f[25],f[26]=f[26]<0?0:f[26]>255?255:f[26],f[27]=f[27]<0?0:f[27]>255?255:f[27],f[28]=f[28]<0?0:f[28]>255?255:f[28],f[29]=f[29]<0?0:f[29]>255?255:f[29],f[30]=f[30]<0?0:f[30]>255?255:f[30],f[31]=f[31]<0?0:f[31]>255?255:f[31],t[s]=0|f[0],t[s+1]=0|f[1],t[s+2]=0|f[2],t[s+3]=0|f[3],t[s+4]=0|f[4],t[s+5]=0|f[5],t[s+6]=0|f[6],t[s+7]=0|f[7],t[s+8]=0|f[8],t[s+9]=0|f[9],t[s+10]=0|f[10],t[s+11]=0|f[11],t[s+12]=0|f[12],t[s+13]=0|f[13],t[s+14]=0|f[14],t[s+15]=0|f[15],t[s+16]=0|f[16],t[s+17]=0|f[17],t[s+18]=0|f[18],t[s+19]=0|f[19],t[s+20]=0|f[20],t[s+21]=0|f[21],t[s+22]=0|f[22],t[s+23]=0|f[23],t[s+24]=0|f[24],t[s+25]=0|f[25],t[s+26]=0|f[26],t[s+27]=0|f[27],t[s+28]=0|f[28],t[s+29]=0|f[29],t[s+30]=0|f[30],t[s+31]=0|f[31];if(c)for(s=o-c;o>s;s+=4)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],m[0]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],m[1]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],m[2]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],m[3]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],m[0]=m[0]<0?0:m[0]>255?255:m[0],m[1]=m[1]<0?0:m[1]>255?255:m[1],m[2]=m[2]<0?0:m[2]>255?255:m[2],m[3]=m[3]<0?0:m[3]>255?255:m[3],t[s]=0|m[0],t[s+1]=0|m[1],t[s+2]=0|m[2],t[s+3]=0|m[3];return t}:function(t,e,n){var i=this,a=i.matrix;if(!a)return t;var s,o=t.length,u=o>>>2,c=(7&u)<<2,f=new r(32),h=new l(4),m=new r(4);for(s=0;o>s;s+=32)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],f[0]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[1]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[2]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[3]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+4],h[1]=t[s+5],h[2]=t[s+6],h[3]=t[s+7],f[4]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[5]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[6]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[7]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+8],h[1]=t[s+9],h[2]=t[s+10],h[3]=t[s+11],f[8]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[9]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[10]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[11]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+12],h[1]=t[s+13],h[2]=t[s+14],h[3]=t[s+15],f[12]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[13]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[14]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[15]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+16],h[1]=t[s+17],h[2]=t[s+18],h[3]=t[s+19],f[16]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[17]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[18]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[19]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+20],h[1]=t[s+21],h[2]=t[s+22],h[3]=t[s+23],f[20]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[21]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[22]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[23]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+24],h[1]=t[s+25],h[2]=t[s+26],h[3]=t[s+27],f[24]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[25]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[26]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[27]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],h[0]=t[s+28],h[1]=t[s+29],h[2]=t[s+30],h[3]=t[s+31],f[28]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],f[29]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],f[30]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],f[31]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],t[s]=0|f[0],t[s+1]=0|f[1],t[s+2]=0|f[2],t[s+3]=0|f[3],t[s+4]=0|f[4],t[s+5]=0|f[5],t[s+6]=0|f[6],t[s+7]=0|f[7],t[s+8]=0|f[8],t[s+9]=0|f[9],t[s+10]=0|f[10],t[s+11]=0|f[11],t[s+12]=0|f[12],t[s+13]=0|f[13],t[s+14]=0|f[14],t[s+15]=0|f[15],t[s+16]=0|f[16],t[s+17]=0|f[17],t[s+18]=0|f[18],t[s+19]=0|f[19],t[s+20]=0|f[20],t[s+21]=0|f[21],t[s+22]=0|f[22],t[s+23]=0|f[23],t[s+24]=0|f[24],t[s+25]=0|f[25],t[s+26]=0|f[26],t[s+27]=0|f[27],t[s+28]=0|f[28],t[s+29]=0|f[29],t[s+30]=0|f[30],t[s+31]=0|f[31];if(c)for(s=o-c;o>s;s+=4)h[0]=t[s],h[1]=t[s+1],h[2]=t[s+2],h[3]=t[s+3],m[0]=a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]+a[4],m[1]=a[5]*h[0]+a[6]*h[1]+a[7]*h[2]+a[8]*h[3]+a[9],m[2]=a[10]*h[0]+a[11]*h[1]+a[12]*h[2]+a[13]*h[3]+a[14],m[3]=a[15]*h[0]+a[16]*h[1]+a[17]*h[2]+a[18]*h[3]+a[19],t[s]=0|m[0],t[s+1]=0|m[1],t[s+2]=0|m[2],t[s+3]=0|m[3];return t},canRun:function(){return this._isOn&&this.matrix}});p.prototype.grayscale=p.prototype.desaturate,p.prototype.rotateHue=p.prototype.adjustHue,p.prototype.threshold_rgb=p.prototype.thresholdRGB,p.prototype.threshold_alpha=p.prototype.thresholdAlpha}(e),!function(t,e){function i(e,n){var i=n?o(n):"",r=o(e),l=s?"c[0] = 0>c[0] ? 0 : (255<c[0] ? 255: c[0]); c[1] = 0>c[1] ? 0 : (255<c[1] ? 255: c[1]); c[2] = 0>c[2] ? 0 : (255<c[2] ? 255: c[2]); c[3] = 0>c[3] ? 0 : (255<c[3] ? 255: c[3]);":"";return new Function("FILTER",'"use strict"; return function( im, w, h ){    var self = this;    if ( !self._map ) return im;    var x, y, i, imLen = im.length, imArea = imLen>>>2, rem = (imArea&7)<<2, c = new FILTER.ColorMatrix(4);    '+i+";        for (x=0,y=0,i=0; i<imLen; i+=32)    {        c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];        "+r+";        "+l+";        im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+4]; c[1] = im[i+5]; c[2] = im[i+6]; c[3] = im[i+7];        "+r+";        "+l+";        im[i+4] = c[0]|0; im[i+5] = c[1]|0; im[i+6] = c[2]|0; im[i+7] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+8]; c[1] = im[i+9]; c[2] = im[i+10]; c[3] = im[i+11];        "+r+";        "+l+";        im[i+8] = c[0]|0; im[i+9] = c[1]|0; im[i+10] = c[2]|0; im[i+11] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+12]; c[1] = im[i+13]; c[2] = im[i+14]; c[3] = im[i+15];        "+r+";        "+l+";        im[i+12] = c[0]|0; im[i+13] = c[1]|0; im[i+14] = c[2]|0; im[i+15] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+16]; c[1] = im[i+17]; c[2] = im[i+18]; c[3] = im[i+19];        "+r+";        "+l+";        im[i+16] = c[0]|0; im[i+17] = c[1]|0; im[i+18] = c[2]|0; im[i+19] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+20]; c[1] = im[i+21]; c[2] = im[i+22]; c[3] = im[i+23];        "+r+";        "+l+";        im[i+20] = c[0]|0; im[i+21] = c[1]|0; im[i+22] = c[2]|0; im[i+23] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+24]; c[1] = im[i+25]; c[2] = im[i+26]; c[3] = im[i+27];        "+r+";        "+l+";        im[i+24] = c[0]|0; im[i+25] = c[1]|0; im[i+26] = c[2]|0; im[i+27] = c[3]|0;                if (++x>=w) {x=0; y++;}        c[0] = im[i+28]; c[1] = im[i+29]; c[2] = im[i+30]; c[3] = im[i+31];        "+r+";        "+l+";        im[i+28] = c[0]|0; im[i+29] = c[1]|0; im[i+30] = c[2]|0; im[i+31] = c[3]|0;                if (++x>=w) {x=0; y++;}    }    if ( rem )    {        for (i=imLen-rem; i<imLen; i+=4,x++)        {            if (x>=w) {x=0; y++;}            c[0] = im[i]; c[1] = im[i+1]; c[2] = im[i+2]; c[3] = im[i+3];            "+r+";            "+l+";            im[i] = c[0]|0; im[i+1] = c[1]|0; im[i+2] = c[2]|0; im[i+3] = c[3]|0;        }    }    return im;};")(t)}var r,l=(t.CHANNEL,t.MODE),a=(t.Color,t.ColorMatrix,t.Util.Array.typed),s=t._notSupportClamp,o=t.Util.String.function_body,u=t.Create({name:"ColorMapFilter",init:function(t,e){var n=this;t&&n.set(t,e)},path:n,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,thresholds:null,quantizedColors:null,mode:l.COLOR,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.thresholds=null,t.quantizedColors=null,t.$super("dispose"),t},serialize:function(){var t,e=this;return t={_mapName:e._mapName||null,_map:"generic"===e._mapName&&e._map&&e._mapChanged?e._map.toString():null,_mapInit:"generic"===e._mapName&&e._mapInit&&e._mapChanged?e._mapInit.toString():null,thresholds:e.thresholds,quantizedColors:e.quantizedColors},e._mapChanged=!1,t},unserialize:function(t){var e=this;return e.thresholds=a(t.thresholds,Array),e.quantizedColors=a(t.quantizedColors,Array),!t._map&&t._mapName&&r.hasOwnProperty(t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},RGB2HSV:function(){return this.set("rgb2hsv")},HSV2RGB:function(){return this.set("hsv2rgb")},RGB2CMYK:function(){return this.set("rgb2cmyk")},hue:function(){return this.set("hue")},saturation:function(){return this.set("saturation")},quantize:function(t,e){var n=this;return n.thresholds=t,n.quantizedColors=e,n.set("quantize")},threshold:null,mask:function(t,e,n){var i=this;return i.thresholds=[t,e],i.quantizedColors=[n||0],i.set("mask")},extract:null,set:function(t,e){var n=this;return t&&r.hasOwnProperty(String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=r[n._mapName],n._mapInit=r["init__"+n._mapName],n._apply=i(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=T,n._mapInit=e||null,n._apply=i(n._map,n._mapInit),n._mapChanged=!0),n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,
t},canRun:function(){return this._isOn&&this._map}});u.prototype.threshold=u.prototype.quantize,u.prototype.extract=u.prototype.mask,r={rgb2hsv:"function( ){        if ( 0 !== c[3] )        {            RGB2HSV(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CH] = C0; c[CS] = C1; c[CV] = C2;        }    }",init__rgb2hsv:"function( ){        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, RGB2HSV = FILTER.Color.RGB2HSV;    }",hsv2rgb:"function( ){        if ( 0 !== c[3] )        {            C0 = c[CH]; C1 = c[CS]; C2 = c[CV];            c[0] = C0; c[1] = C1; c[2] = C2;            HSV2RGB(c, 0);        }    }",init__hsv2rgb:"function( ){        var C0, C1, C2, CH = FILTER.CHANNEL.H, CS = FILTER.CHANNEL.S, CV = FILTER.CHANNEL.V, HSV2RGB = FILTER.Color.HSV2RGB;    }",rgb2cmyk:"function( ){        if ( 0 !== c[3] )        {            RGB2CMYK(c, 0);            C0 = c[0]; C1 = c[1]; C2 = c[2];            c[CY] = C0; c[MA] = C1; c[YE] = C2;        }    }",init__rgb2cmyk:"function( ){        var C0, C1, C2, CY = FILTER.CHANNEL.CY, MA = FILTER.CHANNEL.MA, YE = FILTER.CHANNEL.YE, RGB2CMYK = FILTER.Color.RGB2CMYK;    }",hue:"function( ){        if ( 0 !== c[3] )        {            HHH = HUE(c[0], c[1], c[2])*0.70833333333333333333333333333333;            c[0] = HHH; c[1] = HHH; c[2] = HHH;        }    }",init__hue:"function( ){        var HUE = FILTER.Color.hue, HHH;    }",saturation:"function( ){        if ( 0 !== c[3] )        {            SSS = SATURATION(c[0], c[1], c[2]);            c[0] = SSS; c[1] = SSS; c[2] = SSS;        }    }",init__saturation:"function( ){        var SATURATION = FILTER.Color.saturation, SSS;    }",quantize:"function( ){        if ( 0 !== c[3] )        {            J = 0; V = VALUE(c[0], c[1], c[2]);            while (J<THRESH_LEN && V>THRESH[J]) J++;            COLVAL = J < COLORS_LEN ? COLORS[j] : 0xffffff;            c[0] = (COLVAL >>> 16) & 255; c[1] = (COLVAL >>> 8) & 255; c[2] = COLVAL & 255;        }    }",init__quantize:"function( ){        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            THRESH = self.thresholds, THRESH_LEN = THRESH.length,            COLORS = self.quantizedColors, COLORS_LEN = COLORS.length, J, COLVAL, V;    }",mask:"function( ){        if ( 0 !== c[3] )        {            V = VALUE(c[0], c[1], c[2]);            if ( (V < MIN_VALUE) || (V > MAX_VALUE) )            {                c[0] = COLVAL[0];                c[1] = COLVAL[1];                c[2] = COLVAL[2];                c[3] = COLVAL[3];            }        }    }",init__mask:"function( ){        var VALUE = FILTER.MODE.HUE === self.mode ? FILTER.Color.hue : (FILTER.MODE.SATURATION === self.mode ? FILTER.Color.saturation : (FILTER.MODE.INTENSITY === self.mode ? FILTER.Color.intensity : FILTER.Color.color24)),            MIN_VALUE = self.thresholds[0], MAX_VALUE = self.thresholds[self.thresholds.length-1],            COLVAL = [(self.quantizedColors[0] >>> 16) & 255, (self.quantizedColors[0] >>> 8) & 255, self.quantizedColors[0] & 255, (self.quantizedColors[0] >>> 24) & 255], V;    }"}}(e),!function(t,e){var i=t.ImArray,r=t.AffineMatrix,l=t.Util.Array.typed,a=t.Util.Filter,s=(a.am_eye,a.am_multiply),o=t.MODE,u=(t.CONST.toRad,Math.sin),c=Math.cos,f=Math.tan,h=t.Create({name:"AffineMatrixFilter",init:function(t){var e=this;e.matrix=t&&t.length?new r(t):null},path:n,matrix:null,mode:o.CLAMP,color:0,dispose:function(){var t=this;return t.matrix=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{matrix:t.matrix,color:t.color}},unserialize:function(t){var e=this;return e.matrix=l(t.matrix,r),e.color=t.color,e},flipX:function(){return this.set([-1,0,0,1,0,1,0,0])},flipY:function(){return this.set([1,0,0,0,0,-1,0,1])},flipXY:function(){return this.set([-1,0,0,1,0,-1,0,1])},translate:function(t,e,n){return this.set(n?[1,0,0,t,0,1,0,e]:[1,0,t,0,0,1,e,0])},shift:null,rotate:function(t){var e=u(t),n=c(t);return this.set([n,-e,0,0,e,n,0,0])},scale:function(t,e){return this.set([t,0,0,0,0,e,0,0])},skew:function(t,e){return this.set([1,t?f(t):0,0,0,e?f(e):0,1,0,0])},set:function(t){var e=this;return e.matrix=e.matrix?s(e.matrix,t):new r(t),e},reset:function(){return this.matrix=null,this},combineWith:function(t){return this.set(t.matrix)},_apply:function(t,e,n){var r=this,l=r.matrix;if(!l)return t;var a,s,u,c,f,h,m,_,p,d,v,g=t.length,C=g>>>2,R=e-1,y=C-e,x=new i(g),I=r.color||0,A=o.COLOR,w=(o.CLAMP,o.WRAP),b=o.IGNORE,L=l[0],E=l[1],T=l[2]+l[3]*R,G=l[4]*e,M=l[5],S=l[6]*e+l[7]*y,F=r.mode||b;if(A===F)for(v=I>>>24&255,_=I>>>16&255,p=I>>>8&255,d=255&I,a=0,s=0,u=0,h=0;g>h;h+=4,a++)a>=e&&(a=0,s++,u+=e),c=L*a+E*s+T,f=G*a+M*u+S,0>c||c>R||0>f||f>y?(x[h]=_,x[h+1]=p,x[h+2]=d,x[h+3]=v):(m=(0|c)+(0|f)<<2,x[h]=t[m],x[h+1]=t[m+1],x[h+2]=t[m+2],x[h+3]=t[m+3]);else if(b===F)for(a=0,s=0,u=0,h=0;g>h;h+=4,a++)a>=e&&(a=0,s++,u+=e),c=L*a+E*s+T,f=G*a+M*u+S,f=f>y||0>f?u:f,c=c>R||0>c?a:c,m=(0|c)+(0|f)<<2,x[h]=t[m],x[h+1]=t[m+1],x[h+2]=t[m+2],x[h+3]=t[m+3];else if(w===F)for(a=0,s=0,u=0,h=0;g>h;h+=4,a++)a>=e&&(a=0,s++,u+=e),c=L*a+E*s+T,f=G*a+M*u+S,f=f>y?f-C:0>f?f+C:f,c=c>R?c-e:0>c?c+e:c,m=(0|c)+(0|f)<<2,x[h]=t[m],x[h+1]=t[m+1],x[h+2]=t[m+2],x[h+3]=t[m+3];else for(a=0,s=0,u=0,h=0;g>h;h+=4,a++)a>=e&&(a=0,s++,u+=e),c=L*a+E*s+T,f=G*a+M*u+S,f=f>y?y:0>f?0:f,c=c>R?R:0>c?0:c,m=(0|c)+(0|f)<<2,x[h]=t[m],x[h+1]=t[m+1],x[h+2]=t[m+2],x[h+3]=t[m+3];return x},canRun:function(){return this._isOn&&this.matrix}});h.prototype.shift=h.prototype.translate}(e),!function(t,e){var i=(t.ImArray,t.ImArrayCopy),r=(t.Util.Array.typed,t.MODE),l=t.Array16I,a=Math.min,s=(Math.max,Math.floor);t.Create({name:"DisplacementMapFilter",init:function(t){var e=this;t&&e.setInput("map",t)},path:n,scaleX:1,scaleY:1,startX:0,startY:0,componentX:0,componentY:0,color:0,mode:r.CLAMP,hasInputs:!0,dispose:function(){var t=this;return t.scaleX=null,t.scaleY=null,t.startX=null,t.startY=null,t.componentX=null,t.componentY=null,t.color=null,t.$super("dispose"),t},serialize:function(){var t=this;return{scaleX:t.scaleX,scaleY:t.scaleY,startX:t.startX,startY:t.startY,componentX:t.componentX,componentY:t.componentY,color:t.color}},unserialize:function(t){var e=this;return e.scaleX=t.scaleX,e.scaleY=t.scaleY,e.startX=t.startX,e.startY=t.startY,e.componentX=t.componentX,e.componentY=t.componentY,e.color=t.color,e},reset:function(){return this.unsetInput("map"),this},_apply:function(t,e,n){var o,u=this;if(o=u.input("map"),!o)return t;var c,f,h,m,_,p,d,v,g,C,R,y,x,I,A,w,b,L,E,T,G,M,S,F,N,Y,B,O,H,X,z,D,U,V,q,k,P=u.color||0,j=e-1,W=n-1,$=.00390625*u.scaleX,J=.00390625*u.scaleY,K=u.componentX,Q=u.componentY,Z=r.IGNORE,tt=(r.CLAMP,r.COLOR),et=r.WRAP,nt=u.mode||Z;for(c=o[0],f=o[1],h=o[2],U=c.length,m=U>>>2,p=a(f,e),d=a(h,n),D=t.length,X=p*d<<2,z=D>>>2,x=s(u.startX*j),y=s(u.startY*W),I=y*e,A=-x,w=-y,b=j-x,L=W-y,_=new l(m<<1),V=new i(t),E=(15&m)<<2,G=0,T=0;U>T;T+=64)_[G++]=s((c[T+K]-128)*$),_[G++]=s((c[T+Q]-128)*J),_[G++]=s((c[T+4+K]-128)*$),_[G++]=s((c[T+4+Q]-128)*J),_[G++]=s((c[T+8+K]-128)*$),_[G++]=s((c[T+8+Q]-128)*J),_[G++]=s((c[T+12+K]-128)*$),_[G++]=s((c[T+12+Q]-128)*J),_[G++]=s((c[T+16+K]-128)*$),_[G++]=s((c[T+16+Q]-128)*J),_[G++]=s((c[T+20+K]-128)*$),_[G++]=s((c[T+20+Q]-128)*J),_[G++]=s((c[T+24+K]-128)*$),_[G++]=s((c[T+24+Q]-128)*J),_[G++]=s((c[T+28+K]-128)*$),_[G++]=s((c[T+28+Q]-128)*J),_[G++]=s((c[T+32+K]-128)*$),_[G++]=s((c[T+32+Q]-128)*J),_[G++]=s((c[T+36+K]-128)*$),_[G++]=s((c[T+36+Q]-128)*J),_[G++]=s((c[T+40+K]-128)*$),_[G++]=s((c[T+40+Q]-128)*J),_[G++]=s((c[T+44+K]-128)*$),_[G++]=s((c[T+44+Q]-128)*J),_[G++]=s((c[T+48+K]-128)*$),_[G++]=s((c[T+48+Q]-128)*J),_[G++]=s((c[T+52+K]-128)*$),_[G++]=s((c[T+52+Q]-128)*J),_[G++]=s((c[T+56+K]-128)*$),_[G++]=s((c[T+56+Q]-128)*J),_[G++]=s((c[T+60+K]-128)*$),_[G++]=s((c[T+60+Q]-128)*J);if(E)for(T=U-E;U>T;T+=4)_[G++]=s((c[T+K]-128)*$),_[G++]=s((c[T+Q]-128)*J);if(tt===nt)for(v=P>>>24&255,g=P>>>16&255,C=P>>>8&255,R=255&P,M=0,S=0,F=0,N=0,T=0;X>T;T+=4,M++)M>=p&&(M=0,S++,F+=e,N+=f),w>S||S>L||A>M||M>b||(B=M+x,Y=S+y,O=B+F+I<<2,G=M+N<<1,q=B+_[G],k=Y+_[G+1],k>W||0>k||q>j||0>q?(t[O]=g,t[O+1]=C,t[O+2]=R,t[O+3]=v):(H=q+k*e<<2,t[O]=V[H],t[O+1]=V[H+1],t[O+2]=V[H+2],t[O+3]=V[H+3]));else if(Z===nt)for(M=0,S=0,F=0,N=0,T=0;X>T;T+=4,M++)M>=p&&(M=0,S++,F+=e,N+=f),w>S||S>L||A>M||M>b||(B=M+x,Y=S+y,O=B+F+I<<2,G=M+N<<1,q=B+_[G],k=Y+_[G+1],k>W||0>k||q>j||0>q||(H=q+k*e<<2,t[O]=V[H],t[O+1]=V[H+1],t[O+2]=V[H+2],t[O+3]=V[H+3]));else if(et===nt)for(M=0,S=0,F=0,N=0,T=0;X>T;T+=4,M++)M>=p&&(M=0,S++,F+=e,N+=f),w>S||S>L||A>M||M>b||(B=M+x,Y=S+y,O=B+F+I<<2,G=M+N<<1,q=B+_[G],k=Y+_[G+1],k=k>W?k-n:0>k?k+n:k,q=q>j?q-e:0>q?q+e:q,H=q+k*e<<2,t[O]=V[H],t[O+1]=V[H+1],t[O+2]=V[H+2],t[O+3]=V[H+3]);else for(M=0,S=0,F=0,N=0,T=0;X>T;T+=4,M++)M>=p&&(M=0,S++,F+=e,N+=f),w>S||S>L||A>M||M>b||(B=M+x,Y=S+y,O=B+F+I<<2,G=M+N<<1,q=B+_[G],k=Y+_[G+1],k=k>W?W:0>k?0:k,q=q>j?j:0>q?0:q,H=q+k*e<<2,t[O]=V[H],t[O+1]=V[H+1],t[O+2]=V[H+2],t[O+3]=V[H+3]);return t}})}(e),!function(t,e){function i(e,n){var i=n?a(n):"",r=a(e);return new Function("FILTER",'"use strict"; return function( im, w, h ){    var self = this;    if ( !self._map ) return im;    var x, y, i, j, imLen = im.length, dst = new FILTER.ImArray(imLen), t = new FILTER.Array32F(2),        COLOR = FILTER.MODE.COLOR, CLAMP = FILTER.MODE.CLAMP, WRAP = FILTER.MODE.WRAP, IGNORE = FILTER.MODE.IGNORE,        mode = self.mode||IGNORE, color = self.color||0, r, g, b, a, bx = w-1, by = h-1;    '+i+";        if ( COLOR === mode )    {        a = (color >>> 24)&255;        r = (color >>> 16)&255;        g = (color >>> 8)&255;        b = (color)&255;            for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        if ( 0>t[0] || t[0]>bx || 0>t[1] || t[1]>by )            {                /* color */                dst[i] = r;   dst[i+1] = g;                dst[i+2] = b;  dst[i+3] = a;                continue;            }                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if ( IGNORE === mode )    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        /* ignore */            t[1] = t[1] > by || t[1] < 0 ? y : t[1];            t[0] = t[0] > bx || t[0] < 0 ? x : t[0];                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else if ( WRAP === mode )    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        /* wrap */            t[1] = t[1] > by ? t[1]-h : (t[1] < 0 ? t[1]+h : t[1]);            t[0] = t[0] > bx ? t[0]-w : (t[0] < 0 ? t[0]+w : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    else /*if ( CLAMP === mode )*/    {        for (x=0,y=0,i=0; i<imLen; i+=4,x++)        {            if (x>=w) { x=0; y++; }                        t[0] = x; t[1] = y;                        "+r+";                        /* clamp */            t[1] = t[1] > by ? by : (t[1] < 0 ? 0 : t[1]);            t[0] = t[0] > bx ? bx : (t[0] < 0 ? 0 : t[0]);                        j = ((t[0]|0) + (t[1]|0)*w) << 2;            dst[i] = im[j];   dst[i+1] = im[j+1];            dst[i+2] = im[j+2];  dst[i+3] = im[j+3];        }    }    return dst;};")(t)}var r,l=t.MODE,a=t.Util.String.function_body;t.Create({name:"GeometricMapFilter",init:function(t,e){var n=this;t&&n.set(t,e)},path:n,_map:null,_mapInit:null,_mapName:null,_mapChanged:!1,color:0,centerX:0,centerY:0,angle:0,radius:0,mode:l.CLAMP,dispose:function(){var t=this;return t._map=null,t._mapInit=null,t._mapName=null,t._mapChanged=null,t.color=0,t.centerX=null,t.centerY=null,t.angle=null,t.radius=null,t.$super("dispose"),t},serialize:function(){var t,e=this;return t={_mapName:e._mapName||null,_map:"generic"===e._mapName&&e._map&&e._mapChanged?e._map.toString():null,_mapInit:"generic"===e._mapName&&e._mapInit&&e._mapChanged?e._mapInit.toString():null,color:e.color,centerX:e.centerX,centerY:e.centerY,angle:e.angle,radius:e.radius},e._mapChanged=!1,t},unserialize:function(t){var e=this;return e.color=t.color,e.centerX=t.centerX,e.centerY=t.centerY,e.angle=t.angle,e.radius=t.radius,!t._map&&t._mapName&&r.hasOwnProperty(t._mapName)?e.set(t._mapName):t._map&&"generic"===t._mapName&&e.set(t._map,t._mapInit||null),e},polar:function(t,e){return this},cartesian:function(t,e){return this},twirl:function(t,e,n,i){var r=this;return r.angle=t||0,r.radius=e||0,r.centerX=n||0,r.centerY=i||0,r.set("twirl")},sphere:function(t,e,n){var i=this;return i.radius=t||0,i.centerX=e||0,i.centerY=n||0,i.set("sphere")},set:function(t,e){var n=this;return t&&r.hasOwnProperty(String(t))?(n._mapName!==String(t)&&(n._mapName=String(t),n._map=r[n._mapName],n._mapInit=r["init__"+n._mapName],n._apply=i(n._map,n._mapInit)),n._mapChanged=!1):t&&(n._mapName="generic",n._map=t,n._mapInit=e||null,n._apply=i(n._map,n._mapInit),n._mapChanged=!0),n},reset:function(){var t=this;return t._mapName=null,t._map=null,t._mapInit=null,t._mapChanged=!1,t},canRun:function(){return this._isOn&&this._map}}),r={twirl:"function( ){        TX = t[0]-CX; TY = t[1]-CY;        D = Sqrt(TX*TX + TY*TY);        if ( D < R )        {            theta = Atan2(TY, TX) + fact*(R-D);            t[0] = CX + D*Cos(theta);  t[1] = CY + D*Sin(theta);        }    }",init__twirl:"function( ){        var Sqrt = Math.sqrt, Atan2 = Math.atan2, Sin = Math.sin, Cos = Math.cos,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            angle = self.angle, R = self.radius, fact = angle/R,            D, TX, TY, theta;    }",sphere:"function( ){        TX = t[0]-CX;  TY = t[1]-CY;        TX2 = TX*TX; TY2 = TY*TY;        D2 = TX2 + TY2;        if ( D2 < R2 )        {            D2 = R2 - D2; D = Sqrt(D2);            thetax = Asin(TX / Sqrt(TX2 + D2)) * invrefraction;            thetay = Asin(TY / Sqrt(TY2 + D2)) * invrefraction;            t[0] = t[0] - D * Tan(thetax);  t[1] = t[1] - D * Tan(thetay);        }    }",init__sphere:"function( ){        var Sqrt = Math.sqrt, Asin = Math.asin, Tan = Math.tan,            CX = self.centerX*(w-1), CY = self.centerY*(h-1),            invrefraction = 1-0.555556,            R = self.radius, R2 = R*R,            D, TX, TY, TX2, TY2, R2, D2, thetax, thetay;    }"}}(e),!function(t,e){function i(t){for(var e=0,n=0,i=t.length;i>n;n++)e+=t[n];return e}function r(t,e){var n,i,r,l=[],a=[],s=[],o=t.length,u=e,c=u>>>1;for(i=0,r=0,n=0;o>n;)a.push(i-c),a.push(r-c),t[n]&&(l.push(i-c),l.push(r-c),s.push(t[n])),n++,i++,i>=u&&(i=0,r++);return[new g(l),new g(a),new d(s)]}function l(t,e){var n,i,r,l=new Array(t);for(n=0,i=0,r=0;t>r;r++,n++)l[r]=e(n,i,t);return l}function a(t){var e,n=new Array(t);for(e=0;t>e;e++)n[e]=1;return n}function s(t,e){var n,i=t>>>1,r=new Array(t);if(e)for(n=0;t>n;n++)r[t-1-n]=n-i;else for(n=0;t>n;n++)r[n]=n-i;return r}function o(t){var e,n,i,r,l=M.length;if(t--,l>t)e=M[t];else for(e=M[l-1];t>=l;){for(n=e,e=new Array(n.length+1),e[0]=1,i=0,r=n.length-1;r>i;i++)e[i+1]=n[i]+n[i+1];e[n.length]=1,20>l&&M.push(e),l++}return e.slice()}function u(t){var e=o(t);return x(e,e)}function c(t,e){return 1===e?x(s(t,1),o(t)):x(o(t),s(t,0))}function f(t,e){return 1===e?x(s(t,1),a(t)):x(a(t),s(t,0))}function h(t,e,n){e=e||1,n=n||e;var i,r=t*t,l=new d(r);for(i=0;t>i;i++)l[i]=e;return l[r>>>1]=n,l}function m(t,e,n,i){var r,l,a,s,o,u=t*t,c=t>>>1,f=u>>>1,h=new d(u);for(s=0,r=0;c>=r;r++,s+=e)for(l=0,o=0,a=0;c>=a;a++,l+=t,o+=n)h[f+r+l]=s+o,h[f-r-l]=-s-o,h[f-r+l]=-s+o,h[f+r-l]=s-o;return h[f]=i||1,h}function _(t,e,n,i){var r,l,a,s,o,u,c=t*t,f=t>>1,h=c>>1,m=new d(c),_=new d(c),p=1/t,v=1e-8;for(L(e)>v?(o=1,u=n/e):(o=e/n,u=1),r=0,a=0,s=0,l=u*t;f>=r;)_[h+r]=h+a+s+.5|0,_[h-r]=h-a-s+.5|0,r++,a+=o,s+=l;for(r=0;f>=r;)m[_[h+r]]=m[_[h-r]]=p,r++;return m[h]=i||1,m}var p=t.Util.Filter,d=t.ConvolutionMatrix,v=t.ImArray,g=(t.Array32F,t.Array16I),C=(t.Array8U,p.integral_convolution),R=p.separable_convolution,y=p.cm_combine,x=p.cm_convolve,I=t.MODE,A=t.Util.Array.typed,w=t._notSupportClamp,b=(Math.SQRT2,t.CONST.toRad),L=(t.CONST.toDeg,Math.abs),E=Math.sqrt,T=Math.sin,G=Math.cos,M=[[1],[1,1],[1,2,1],[1,3,3,1],[1,4,6,4,1],[1,5,10,10,5,1],[1,6,15,20,15,6,1],[1,7,21,35,35,21,7,1],[1,8,28,56,70,56,28,8,1]],S=t.Create({name:"ConvolutionMatrixFilter",init:function(t,e,n,i){var r=this;r._coeff=new d([1,0]),r.matrix2=null,r.dim2=0,r._isGrad=!1,r._doIntegral=0,r._doSeparable=!1,t&&t.length?r.set(t,E(t.length)+.5|0,e||1,n||0):(r.matrix=null,r.dim=0),r.mode=i||I.RGB},path:n,dim:0,dim2:0,matrix:null,matrix2:null,_mat:null,_mat2:null,_coeff:null,_isGrad:!1,_doIntegral:0,_doSeparable:!1,_indices:null,_indices2:null,_indicesf:null,_indicesf2:null,mode:I.RGB,dispose:function(){var t=this;return t.dim=null,t.dim2=null,t.matrix=null,t.matrix2=null,t._mat=null,t._mat2=null,t._coeff=null,t._isGrad=null,t._doIntegral=null,t._doSeparable=null,t._indices=null,t._indices2=null,t._indicesf=null,t._indicesf2=null,t.$super("dispose"),t},serialize:function(){var t=this;return{dim:t.dim,dim2:t.dim2,matrix:t.matrix,matrix2:t.matrix2,_mat:t._mat,_mat2:t._mat2,_coeff:t._coeff,_isGrad:t._isGrad,_doIntegral:t._doIntegral,_doSeparable:t._doSeparable,_indices:t._indices,_indices2:t._indices2,_indicesf:t._indicesf,_indicesf2:t._indicesf2}},unserialize:function(t){var e=this;return e.dim=t.dim,e.dim2=t.dim2,e.matrix=A(t.matrix,d),e.matrix2=A(t.matrix2,d),e._mat=A(t._mat,d),e._mat2=A(t._mat2,d),e._coeff=A(t._coeff,d),e._isGrad=t._isGrad,e._doIntegral=t._doIntegral,e._doSeparable=t._doSeparable,e._indices=A(t._indices,g),e._indices2=A(t._indices2,g),e._indicesf=A(t._indicesf,g),e._indicesf2=A(t._indicesf2,g),e},functional:function(t,n){n=n===e?3:1&n?n:n+1;var r=l(n,t),a=1/i(r);return this.set(r,n,a,a,n,r),this._doSeparable=!0,this},fastGauss:function(t,n){return n=n===e?3:1&n?n:n+1,t=0|(t||1),1>t?t=1:t>7&&(t=7),this.set(h(n),n,1/(n*n),0),this._doIntegral=t,this},lowPass:function(t){return t=t===e?3:1&t?t:t+1,this.set(h(t),t,1/(t*t),0),this._doIntegral=1,this},boxBlur:null,highPass:function(t,n){t=t===e?3:1&t?t:t+1,n=n===e?1:n;var i=-n/(t*t);return this.set(h(t,i,1+i),t,1,0),this._doIntegral=1,this},glow:function(t,n){return t=t===e?.5:t,this.highPass(n,-t)},sharpen:function(t,n){return t=t===e?.5:t,this.highPass(n,t)},verticalBlur:function(t){return t=t===e?3:1&t?t:t+1,this.set(a(t),1,1/t,0,t),this._doIntegral=1,this},horizontalBlur:function(t){return t=t===e?3:1&t?t:t+1,this.set(a(t),t,1/t,0,1),this._doIntegral=1,this},directionalBlur:function(t,n){return n=n===e?3:1&n?n:n+1,t*=b,this.set(_(n,G(t),-T(t),1/n),n,1,0)},binomialLowPass:function(t){t=t===e?3:1&t?t:t+1;var n=o(t),i=1/(1<<t-1);return this.set(n,t,i,i,t,n),this._doSeparable=!0,this},gaussBlur:null,binomialHighPass:function(t){t=t===e?3:1&t?t:t+1;var n=u(t);return this.set(y(h(t),n,1,-1/i(n)),t,1,0)},prewittX:function(t){return t=t===e?3:1&t?t:t+1,this.set(a(t),t,1,0,t,s(t,0)),this._doSeparable=!0,this},gradX:null,prewittY:function(t){return t=t===e?3:1&t?t:t+1,this.set(s(t,1),t,1,0,t,a(t)),this._doSeparable=!0,this},gradY:null,prewittDirectional:function(t,n){return n=n===e?3:1&n?n:n+1,t*=b,this.set(y(f(n,0),f(n,1),G(t),T(t)),n,1,0)},gradDirectional:null,prewitt:function(t){return t=t===e?3:1&t?t:t+1,this.set(f(t,0),t,1,0,t,f(t,1)),this._isGrad=!0,this},grad:null,sobelX:function(t){return t=t===e?3:1&t?t:t+1,this.set(o(t),t,1,0,t,s(t,0)),this._doSeparable=!0,this},sobelY:function(t){return t=t===e?3:1&t?t:t+1,this.set(s(t,1),t,1,0,t,o(t)),this._doSeparable=!0,this},sobelDirectional:function(t,n){return n=n===e?3:1&n?n:n+1,t*=b,this.set(y(c(n,0),c(n,1),G(t),T(t)),n,1,0)},sobel:function(t){return t=t===e?3:1&t?t:t+1,this.set(c(t,0),t,1,0,t,c(t,1)),this._isGrad=!0,this},laplace:function(t){return t=t===e?3:1&t?t:t+1,this.set(h(t,-1,t*t-1),t,1,0),this._doIntegral=1,this},emboss:function(t,n,i){return i=i===e?3:1&i?i:i+1,t=t===e?-.25*Math.PI:t*b,n=n||1,this.set(m(i,n*G(t),-n*T(t),1),i,1,0)},bump:null,edges:function(t){return t=t||1,this.set([0,t,0,t,-4*t,t,0,t,0],3,1,0)},set:function(t,e,n,i,l,a){var s,o=this;return o._isGrad=!1,o._doIntegral=0,o._doSeparable=!1,o.matrix2=null,o.dim2=0,o._indices2=o._indicesf2=null,o._mat2=null,o.matrix=new d(t),o.dim=e,o._coeff[0]=n||1,o._coeff[1]=i||0,s=r(o.matrix,o.dim),o._indices=s[0],o._indicesf=s[1],o._mat=s[2],a?(o.matrix2=new d(a),o.dim2=l,s=r(o.matrix2,o.dim2),o._indices2=s[0],o._indicesf2=s[1],o._mat2=s[2]):l&&(o.dim2=l),o},reset:function(){var t=this;return t.matrix=t.matrix2=null,t.dim=t.dim2=0,t._mat=t._mat2=null,t._indices=t._indices2=t._indicesf=t._indicesf2=null,t._isGrad=!1,t._doIntegral=0,t._doSeparable=!1,t},combineWith:function(t){var e=this;return t.matrix?e.matrix?e.set(x(e.matrix,t.matrix),e.dim*t.dim,e._coeff[0]*t._coeff[0]):e.set(t.matrix,t.dim,t._coeff[0],t._coeff[1]):e},_apply:w?function(t,e,n){var i=this,r=i.mode;if(!i.matrix)return t;if(i._doIntegral)return i.matrix2?C(r,t,e,n,i.matrix,i.matrix2,i.dim,i.dim2,i._coeff[0],i._coeff[1],i._doIntegral):C(r,t,e,n,i.matrix,null,i.dim,i.dim,i._coeff[0],i._coeff[1],i._doIntegral);if(i._doSeparable)return R(r,t,e,n,i._mat,i._mat2,i._indices,i._indices2,i._coeff[0],i._coeff[1]);var l,a,s,o,u,c,f,h,m,_,p,d,y,x,A,w,b,E,T,G,M,S,F,N,Y=t.length,B=Y>>>2,O=new v(Y),H=e-1,X=B-e,z=i._coeff[0],D=i._coeff[1],U=i.matrix,V=i.matrix2,q=i._isGrad;if(I.GRAY===r)if(V){for(S=i._indicesf.length,N=new g(i._indicesf),c=0;S>c;c+=2)N[c+1]*=e;for(F=U.length,f=0,h=0,o=0;Y>o;o+=4,f++){for(f>=e&&(f=0,h+=e),d=y=x=A=w=b=E=T=0,c=0,u=0;F>c;c++,u+=2)m=f+N[u],_=h+N[u+1],0>m||m>H||0>_||_>X||(p=m+_<<2,G=U[c],d+=t[p]*G,M=V[c],w+=t[p]*M);l=q?L(d)+L(w):z*d+D*w,l=0>l?0:l>255?255:l,O[o]=0|l,O[o+1]=0|l,O[o+2]=0|l,O[o+3]=t[o+3]}}else{for(S=i._indices.length,N=new g(i._indices),c=0;S>c;c+=2)N[c+1]*=e;for(U=i._mat,F=U.length,f=0,h=0,o=0;Y>o;o+=4,f++){for(f>=e&&(f=0,h+=e),d=y=x=A=0,c=0,u=0;F>c;c++,u+=2)m=f+N[u],_=h+N[u+1],0>m||m>H||0>_||_>X||(p=m+_<<2,G=U[c],d+=t[p]*G);l=z*d+D,l=0>l?0:l>255?255:l,O[o]=0|l,O[o+1]=0|l,O[o+2]=0|l,O[o+3]=t[o+3]}}else if(V){for(S=i._indicesf.length,N=new g(i._indicesf),c=0;S>c;c+=2)N[c+1]*=e;for(F=U.length,f=0,h=0,o=0;Y>o;o+=4,f++){for(f>=e&&(f=0,h+=e),d=y=x=A=w=b=E=T=0,c=0,u=0;F>c;c++,u+=2)m=f+N[u],_=h+N[u+1],0>m||m>H||0>_||_>X||(p=m+_<<2,G=U[c],d+=t[p]*G,y+=t[p+1]*G,x+=t[p+2]*G,M=V[c],w+=t[p]*M,b+=t[p+1]*M,E+=t[p+2]*M);q?(l=L(d)+L(w),a=L(y)+L(b),s=L(x)+L(E)):(l=z*d+D*w,a=z*y+D*b,s=z*x+D*E),l=0>l?0:l>255?255:l,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,O[o]=0|l,O[o+1]=0|a,O[o+2]=0|s,O[o+3]=t[o+3]}}else{for(S=i._indices.length,N=new g(i._indices),c=0;S>c;c+=2)N[c+1]*=e;for(U=i._mat,F=U.length,f=0,h=0,o=0;Y>o;o+=4,f++){for(f>=e&&(f=0,h+=e),d=y=x=A=0,c=0,u=0;F>c;c++,u+=2)m=f+N[u],_=h+N[u+1],0>m||m>H||0>_||_>X||(p=m+_<<2,G=U[c],d+=t[p]*G,y+=t[p+1]*G,x+=t[p+2]*G);l=z*d+D,a=z*y+D,s=z*x+D,l=0>l?0:l>255?255:l,a=0>a?0:a>255?255:a,s=0>s?0:s>255?255:s,O[o]=0|l,O[o+1]=0|a,O[o+2]=0|s,O[o+3]=t[o+3]}}return O}:function(t,e,n){var i=this,r=i.mode;if(!i.matrix)return t;if(i._doIntegral)return i.matrix2?C(r,t,e,n,i.matrix,i.matrix2,i.dim,i.dim2,i._coeff[0],i._coeff[1],i._doIntegral):C(r,t,e,n,i.matrix,null,i.dim,i.dim,i._coeff[0],i._coeff[1],i._doIntegral);if(i._doSeparable)return R(r,t,e,n,i._mat,i._mat2,i._indices,i._indices2,i._coeff[0],i._coeff[1]);var l,a,s,o,u,c,f,h,m,_,p,d,y,x,A,w,b,E,T,G,M,S,F,N,Y=t.length,B=Y>>>2,O=new v(Y),H=e-1,X=B-e,z=i._coeff[0],D=i._coeff[1],U=i.matrix,V=i.matrix2,q=i._isGrad;if(I.GRAY===r)if(V){for(S=i._indicesf.length,N=new g(i._indicesf),c=0;S>c;c+=2)N[c+1]*=e;for(F=U.length,f=0,h=0,o=0;Y>o;o+=4,f++){for(f>=e&&(f=0,h+=e),d=y=x=A=w=b=E=T=0,c=0,u=0;F>c;c++,u+=2)m=f+N[u],_=h+N[u+1],0>m||m>H||0>_||_>X||(p=m+_<<2,G=U[c],d+=t[p]*G,M=V[c],w+=t[p]*M);l=q?L(d)+L(w):z*d+D*w,O[o]=0|l,O[o+1]=0|l,O[o+2]=0|l,O[o+3]=t[o+3]}}else{for(S=i._indices.length,N=new g(i._indices),c=0;S>c;c+=2)N[c+1]*=e;for(U=i._mat,F=U.length,f=0,h=0,o=0;Y>o;o+=4,f++){for(f>=e&&(f=0,h+=e),d=y=x=A=0,c=0,u=0;F>c;c++,u+=2)m=f+N[u],_=h+N[u+1],0>m||m>H||0>_||_>X||(p=m+_<<2,G=U[c],d+=t[p]*G);l=z*d+D,O[o]=0|l,O[o+1]=0|l,O[o+2]=0|l,O[o+3]=t[o+3]}}else if(V){for(S=i._indicesf.length,N=new g(i._indicesf),c=0;S>c;c+=2)N[c+1]*=e;for(F=U.length,f=0,h=0,o=0;Y>o;o+=4,f++){for(f>=e&&(f=0,h+=e),d=y=x=A=w=b=E=T=0,c=0,u=0;F>c;c++,u+=2)m=f+N[u],_=h+N[u+1],0>m||m>H||0>_||_>X||(p=m+_<<2,G=U[c],d+=t[p]*G,y+=t[p+1]*G,x+=t[p+2]*G,M=V[c],w+=t[p]*M,b+=t[p+1]*M,E+=t[p+2]*M);q?(l=L(d)+L(w),a=L(y)+L(b),s=L(x)+L(E)):(l=z*d+D*w,a=z*y+D*b,s=z*x+D*E),O[o]=0|l,O[o+1]=0|a,O[o+2]=0|s,O[o+3]=t[o+3]}}else{for(S=i._indices.length,N=new g(i._indices),c=0;S>c;c+=2)N[c+1]*=e;for(U=i._mat,F=U.length,f=0,h=0,o=0;Y>o;o+=4,f++){for(f>=e&&(f=0,h+=e),d=y=x=A=0,c=0,u=0;F>c;c++,u+=2)m=f+N[u],_=h+N[u+1],0>m||m>H||0>_||_>X||(p=m+_<<2,G=U[c],d+=t[p]*G,y+=t[p+1]*G,x+=t[p+2]*G);l=z*d+D,a=z*y+D,s=z*x+D,O[o]=0|l,O[o+1]=0|a,O[o+2]=0|s,O[o+3]=t[o+3]}}return O},canRun:function(){return this._isOn&&this.matrix}});S.prototype.gradX=S.prototype.prewittX,S.prototype.gradY=S.prototype.prewittY,S.prototype.gradDirectional=S.prototype.prewittDirectional,S.prototype.grad=S.prototype.prewitt,S.prototype.bump=S.prototype.emboss,S.prototype.boxBlur=S.prototype.lowPass,S.prototype.gaussBlur=S.prototype.binomialLowPass}(e),!function(t,e){var i,r=t.ImArray,l=t.Array8U,a=t.Array32I,s=Math.sqrt,o=t.Util.Array.typed,u=function(t){var e,n=t*t,i=new l(n);for(e=0;n>e;e++)i[e]=1;return i},c=u(3);t.Create({name:"MorphologicalFilter",init:function(){var t=this;t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null},path:n,_filterName:null,_filter:null,_dim:0,_structureElement:null,_indices:null,dispose:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=null,t._structureElement=null,t._indices=null,t.$super("dispose"),t},serialize:function(){var t=this;return{_filterName:t._filterName,_dim:t._dim,_structureElement:t._structureElement,_indices:t._indices}},unserialize:function(t){var e=this;return e._dim=t._dim,e._structureElement=o(t._structureElement,l),e._indices=o(t._indices,a),e._filterName=t._filterName,e._filterName&&i[e._filterName]&&(e._filter=i[e._filterName]),e},erode:function(t){return this.set(t,"erode")},dilate:function(t){return this.set(t,"dilate")},opening:function(t){return this.set(t,"open")},closing:function(t){return this.set(t,"close")},set:function(t,e){var n=this;n._filterName=e,n._filter=i[e],t&&t.length?(n._structureElement=new l(t),n._dim=s(n._structureElement.length)+.5|0):t&&t===+t?(n._structureElement=u(t),n._dim=t):(n._structureElement=c,n._dim=3);var r,o,f,h=[],t=n._structureElement,m=t.length,_=n._dim,p=_>>>1;for(o=0,f=0,r=0;m>r;r++,o++)o>=_&&(o=0,f++),t[r]&&(h.push(o-p),h.push(f-p));return n._indices=new a(h),n},reset:function(){var t=this;return t._filterName=null,t._filter=null,t._dim=0,t._structureElement=null,t._indices=null,t},_apply:function(t,e,n){var i=this;return i._dim&&i._filter?i._filter(i,t,e,n):t},canRun:function(){return this._isOn&&this._dim&&this._filter}}),i={dilate:function(t,e,n,i){var l,s,o,u,c,f,h,m,_,p,d,v,g,C=t._structureElement,R=(C.length,t._dim,t._indices),y=R.length,x=y>>>1,I=new a(y),A=e.length,w=A>>>2,b=new r(A),L=n-1,E=w-n;for(s=0;y>s;s+=2)I[s]=R[s],I[s+1]=R[s+1]*n;for(o=0,u=0,l=0;A>l;l+=4,o++){for(o>=n&&(o=0,u+=n),d=v=g=0,s=0;x>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=e[h],_=e[h+1],p=e[h+2],m>d&&(d=m),_>v&&(v=_),p>g&&(g=p));b[l]=d,b[l+1]=v,b[l+2]=g,b[l+3]=e[l+3]}return b},erode:function(t,e,n,i){var l,s,o,u,c,f,h,m,_,p,d,v,g,C=t._structureElement,R=(C.length,t._dim,t._indices),y=R.length,x=y>>>1,I=new a(y),A=e.length,w=A>>>2,b=new r(A),L=n-1,E=w-n;for(s=0;y>s;s+=2)I[s]=R[s],I[s+1]=R[s+1]*n;for(o=0,u=0,l=0;A>l;l+=4,o++){for(o>=n&&(o=0,u+=n),d=v=g=255,s=0;x>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=e[h],_=e[h+1],p=e[h+2],d>m&&(d=m),v>_&&(v=_),g>p&&(g=p));b[l]=d,b[l+1]=v,b[l+2]=g,b[l+3]=e[l+3]}return b},open:function(t,e,n,i){var l,s,o,u,c,f,h,m,_,p,d,v,g,C=t._structureElement,R=(C.length,t._dim,t._indices),y=R.length,x=y>>>1,I=new a(y),A=e.length,w=A>>>2,b=new r(A),L=n-1,E=w-n;for(s=0;y>s;s+=2)I[s]=R[s],I[s+1]=R[s+1]*n;for(o=0,u=0,l=0;A>l;l+=4,o++){for(o>=n&&(o=0,u+=n),d=v=g=255,s=0;x>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=e[h],_=e[h+1],p=e[h+2],d>m&&(d=m),v>_&&(v=_),g>p&&(g=p));b[l]=d,b[l+1]=v,b[l+2]=g,b[l+3]=e[l+3]}var T=e;for(e=b,b=T,o=0,u=0,l=0;A>l;l+=4,o++){for(o>=n&&(o=0,u+=n),d=v=g=0,s=0;x>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=e[h],_=e[h+1],p=e[h+2],m>d&&(d=m),_>v&&(v=_),p>g&&(g=p));b[l]=d,b[l+1]=v,b[l+2]=g,b[l+3]=e[l+3]}return b},close:function(t,e,n,i){var l,s,o,u,c,f,h,m,_,p,d,v,g,C=t._structureElement,R=(C.length,t._dim,t._indices),y=R.length,x=y>>>1,I=new a(y),A=e.length,w=A>>>2,b=new r(A),L=n-1,E=w-n;for(s=0;y>s;s+=2)I[s]=R[s],I[s+1]=R[s+1]*n;for(o=0,u=0,l=0;A>l;l+=4,o++){for(o>=n&&(o=0,u+=n),d=v=g=0,s=0;x>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=e[h],_=e[h+1],p=e[h+2],m>d&&(d=m),_>v&&(v=_),p>g&&(g=p));b[l]=d,b[l+1]=v,b[l+2]=g,b[l+3]=e[l+3]}var T=e;for(e=b,b=T,o=0,u=0,l=0;A>l;l+=4,o++){for(o>=n&&(o=0,u+=n),d=v=g=255,s=0;x>s;s+=2)c=o+I[s],f=u+I[s+1],0>c||c>L||0>f||f>E||(h=c+f<<2,m=e[h],_=e[h+1],p=e[h+2],d>m&&(d=m),v>_&&(v=_),g>p&&(g=p));b[l]=d,b[l+1]=v,b[l+2]=g,b[l+3]=e[l+3]}return b}}}(e),!function(t,e){var i,r=t.ImArray,l=t.Array32I,a=t.Array32U,s=t.MODE,o=t.Util.Array.typed,u=Math.min,c=Math.max,f=t.Create({name:"StatisticalFilter",init:function(){var t=this;t.d=0,t.k=0,t._gray=!1,t._filter=null,t._indices=null,t.mode=s.RGB},path:n,d:0,k:0,_filter:null,_indices:null,mode:s.RGB,dispose:function(){var t=this;return t.d=null,t.k=null,t._filter=null,t._indices=null,t.$super("dispose"),t},serialize:function(){var t=this;return{d:t.d,k:t.k,_filter:t._filter,_indices:t._indices}},unserialize:function(t){var e=this;return e.d=t.d,e.k=t.k,e._filter=t._filter,e._indices=o(t._indices,l),e},kth:function(t,e){return this.set(null==e?3:1&e?e:e+1,t)},median:function(t){return this.set(null==t?3:1&t?t:t+1,.5)},minimum:function(t){return this.set(null==t?3:1&t?t:t+1,0)},erode:null,maximum:function(t){return this.set(null==t?3:1&t?t:t+1,1)},dilate:null,set:function(t,e){var n=this;n.d=t=t||3,n.k=e=u(1,c(0,e||0)),n._filter=0===e?"0th":1===e?"1th":"kth";var i,r,a,s=t*t<<1,o=t>>>1,f=new l(s);for(r=0,a=0,i=0;s>i;i+=2,r++)r>=t&&(r=0,a++),f[i]=r-o,f[i+1]=a-o;return n._indices=f,n},reset:function(){var t=this;return t.d=0,t.k=0,t._filter=null,t._indices=null,t},_apply:function(t,e,n){var r=this;return r.d?i[r._filter](r,t,e,n):t},canRun:function(){return this._isOn&&this.d}});f.prototype.erode=f.prototype.minimum,f.prototype.dilate=f.prototype.maximum,i={"1th":function(t,e,n,i){var a,o,u,c,f,h,m,_,p,d,v,g,C,R=(t.d,e.length),y=R>>>2,x=new r(R),I=n-1,A=y-n,w=t._indices,b=w.length,L=new l(b);for(o=0;b>o;o+=2)L[o]=w[o],L[o+1]=w[o+1]*n;if(s.GRAY===t.mode)for(a=0,u=0,c=0;R>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=0,o=0;b>o;o+=2)f=u+L[o],h=c+L[o+1],0>f||f>I||0>h||h>A||(m=f+h<<2,p=e[m],p>g&&(g=p));x[a]=g,x[a+1]=g,x[a+2]=g,x[a+3]=e[a+3]}else for(a=0,u=0,c=0;R>a;a+=4,u++){for(u>=n&&(u=0,c+=n),v=g=C=0,o=0;b>o;o+=2)f=u+L[o],h=c+L[o+1],0>f||f>I||0>h||h>A||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],_>v&&(v=_),p>g&&(g=p),d>C&&(C=d));x[a]=v,x[a+1]=g,x[a+2]=C,x[a+3]=e[a+3]}return x},"0th":function(t,e,n,i){var a,o,u,c,f,h,m,_,p,d,v,g,C,R=(t.d,e.length),y=R>>>2,x=new r(R),I=n-1,A=y-n,w=t._indices,b=w.length,L=new l(b);for(o=0;b>o;o+=2)L[o]=w[o],L[o+1]=w[o+1]*n;if(s.GRAY===t.mode)for(a=0,u=0,c=0;R>a;a+=4,u++){for(u>=n&&(u=0,c+=n),g=255,o=0;b>o;o+=2)f=u+L[o],
h=c+L[o+1],0>f||f>I||0>h||h>A||(m=f+h<<2,p=e[m],g>p&&(g=p));x[a]=g,x[a+1]=g,x[a+2]=g,x[a+3]=e[a+3]}else for(a=0,u=0,c=0;R>a;a+=4,u++){for(u>=n&&(u=0,c+=n),v=g=C=255,o=0;b>o;o+=2)f=u+L[o],h=c+L[o+1],0>f||f>I||0>h||h>A||(m=f+h<<2,_=e[m],p=e[m+1],d=e[m+2],v>_&&(v=_),g>p&&(g=p),C>d&&(C=d));x[a]=v,x[a+1]=g,x[a+2]=C,x[a+3]=e[a+3]}return x},kth:function(t,e,n,i){var o,u,c,f,h,m,_,p,d,v,g,C,R,y,x,I,A,w,b,L,E,T,G,M,S=(t.d,t.k),F=e.length,N=F>>>2,Y=new r(F),B=n-1,O=N-n,H=t._indices,X=H.length,z=new l(X);for(u=0;X>u;u+=2)z[u]=H[u],z[u+1]=H[u+1]*n;if(s.GRAY===t.mode)for(E=new a(256),o=0,c=0,f=0;F>o;o+=4,c++){for(c>=n&&(c=0,f+=n),G=0,C=255,x=0,u=0;X>u;u+=2)h=c+z[u],m=f+z[u+1],0>h||h>B||0>m||m>O||(_=h+m<<2,d=e[_],C>d&&(C=d),d>x&&(x=d),G++,E[d]++);for(G*=S,M=0,w=-1,u=C;x>=u;u++)M+=E[u],E[u]=0,0>w&&M>=G&&(w=u);Y[o]=w,Y[o+1]=w,Y[o+2]=w,Y[o+3]=e[o+3]}else for(L=new a(256),E=new a(256),T=new a(256),o=0,c=0,f=0;F>o;o+=4,c++){for(c>=n&&(c=0,f+=n),G=0,g=C=R=255,y=x=I=0,u=0;X>u;u+=2)h=c+z[u],m=f+z[u+1],0>h||h>B||0>m||m>O||(_=h+m<<2,p=e[_],d=e[_+1],v=e[_+2],L[p]++,E[d]++,T[v]++,G++,g>p&&(g=p),C>d&&(C=d),R>v&&(R=v),p>y&&(y=p),d>x&&(x=d),v>I&&(I=v));for(G*=S,M=0,A=-1,u=g;y>=u;u++)M+=L[u],L[u]=0,0>A&&M>=G&&(A=u);for(M=0,w=-1,u=C;x>=u;u++)M+=E[u],E[u]=0,0>w&&M>=G&&(w=u);for(M=0,b=-1,u=R;I>=u;u++)M+=T[u],T[u]=0,0>b&&M>=G&&(b=u);Y[o]=A,Y[o+1]=w,Y[o+2]=b,Y[o+3]=e[o+3]}return Y}}}(e),!function(t,e){var i="hasOwnProperty";t.Create({name:"InlineFilter",init:function(t,e){var n=this;n._params={},n.set(t,e)},path:n,_filter:null,_params:null,_changed:!1,dispose:function(){var t=this;return t._filter=null,t._params=null,t._changed=null,t.$super("dispose"),t},serialize:function(){var t,e=this;return t={_filter:!1===e._filter?!1:e._changed&&e._filter?e._filter.toString():null,_params:e._params},e._changed=!1,t},unserialize:function(e){var n=this;return null!=e._filter&&(n._filter=!1===e._filter?null:new Function("FILTER",'"use strict"; return '+e._filter+";")(t)),n._params=e._params||{},n},params:function(t){var e=this;if(arguments.length){for(var n in t)t[i](n)&&(e._params[n]=t[n]);return e}return e._params},set:function(t,e){var n=this;return!1===t?(n._filter=!1,n._changed=!0):("function"==typeof t&&(n._filter=t,n._changed=!0),e&&n.params(e)),n},_apply:function(t,e,n,i){var r=this;return r._filter?r._filter(r._params,t,e,n,i):t},canRun:function(){return this._isOn&&this._filter}}),t.CustomFilter=t.InlineFilter}(e),!function(t,e){var i=t.Interpolation;t.Create({name:"ResampleFilter",init:function(t,e,n){var i=this;i.sX=t||1,i.sY=e||1,i.interpolation=n},path:n,sX:1,sY:1,interpolation:null,hasMeta:!0,dispose:function(){var t=this;return t.sX=null,t.sY=null,t.interpolation=null,t.$super("dispose"),t},serialize:function(){var t=this;return{sX:t.sX,sY:t.sY,interpolation:t.interpolation}},unserialize:function(t){var e=this;return e.sX=t.sX,e.sY=t.sY,e.interpolation=t.interpolation,e},_apply:function(t,e,n){var r,l,a,s=this,o=s.sX,u=s.sY;return s.hasMeta=!1,s._meta=null,1===o&&1===u?t:(a=i[s.interpolation||"bilinear"])?(r=s.sX*e|0,l=s.sY*n|0,s.hasMeta=!0,s._meta={_IMG_WIDTH:r,_IMG_HEIGHT:l},a(t,e,n,r,l)):t}}),t.InterpolationFilter=t.ResizeFilter=t.RescaleFilter=t.ResampleFilter}(e),!function(t,e){var i=Math.max,r=Math.min,l=t.Util.Image.get_data;t.Create({name:"SelectionFilter",init:function(t){var e=this;e.selection=t||null},path:n,_apply:function(t,e,n){var a,s,o,u,c=this,f=c.selection;return c.hasMeta=!1,c._meta=null,f?(a=r(1,i(0,+f[0]))*(e-1)|0,s=r(1,i(0,+f[1]))*(n-1)|0,o=r(1,i(0,+f[2]))*(e-1)|0,u=r(1,i(0,+f[3]))*(n-1)|0,0===a&&0===s&&e===o+1&&n===u+1?t:(c.hasMeta=!0,c._meta={_IMG_WIDTH:o-a+1,_IMG_HEIGHT:u-s+1},l(t,e,n,a,s,o,u,!0))):t}}),t.CropFilter=t.SubSelectionFilter=t.SelectionFilter}(e),e});
/**
*
*   FILTER.js Plugins
*   @version: 0.9.5
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,r){"use strict";"object"==typeof module&&module.exports?module.exports=r.call(e,module.$deps&&module.$deps.FILTER||require("./FILTER".toLowerCase())):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified("FILTER_PLUGINS")?define("FILTER_PLUGINS",["module","FILTER"],function(n,t){return r.moduleUri=n.uri,r.call(e,t),t}):(r.call(e,e.FILTER)||1)&&"function"==typeof define&&define.amd&&define(function(){return e.FILTER})}(this,function e(r){"use strict";var n=r.getPath(e.moduleUri);return!function(e){var r=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,r){var n=this;n.min=e||-127,n.max=r||127},path:n,serialize:function(){var e=this;return{min:e.min,max:e.max}},unserialize:function(e){var r=this;return r.min=e.min,r.max=e.max,r},apply:function(e,n,a){var o=this;if(!o._isOn)return e;var i,l,s,c,u,f,h,p,d=o.max-o.min,y=o.min,v=e.length;if(r)for(i=0;v>i;i+=4)s=e[i],c=e[i+1],u=e[i+2],l=d*t()+y,f=s+l,h=c+l,p=u+l,0>f?f=0:f>255&&(f=255),0>h?h=0:h>255&&(h=255),0>p?p=0:p>255&&(p=255),e[i]=0|f,e[i+1]=0|h,e[i+2]=0|p;else for(i=0;v>i;i+=4)s=e[i],c=e[i+1],u=e[i+2],l=d*t()+y,f=s+l,h=c+l,p=u+l,e[i]=0|f,e[i+1]=0|h,e[i+2]=0|p;return e}})}(r),!function(e){var r=e.Util.Image.perlin,t=e.MODE;e.Create({name:"PerlinNoiseFilter",mode:t.GRAY,_baseX:1,_baseY:1,_octaves:1,_offsets:null,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,path:n,init:function(e,r,n,a,o,i,l,s){var c=this;c.mode=t.GRAY,c._baseX=e||1,c._baseY=r||1,c._seed=l||0,c._stitch=!!a,c._fractal=!1!==o,c._perlin=!!s,c.octaves(n||1,i)},seed:function(e){var r=this;return r._seed=e||0,r},octaves:function(e,r){var n=this;for(n._octaves=e||1,n._offsets=r?r.slice(0):[];n._offsets.length<n._octaves;)n._offsets.push([0,0]);return n},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},colors:function(e){return arguments.length||(e=!0),this.mode=e?t.COLOR:t.GRAY,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_seed:e._seed||0,_stitch:e._stitch,_fractal:e._fractal,_perlin:e._perlin}},unserialize:function(e){var r=this;return r._baseX=e._baseX,r._baseY=e._baseY,r._octaves=e._octaves,r._offsets=e._offsets,r._seed=e._seed||0,r._stitch=e._stitch,r._fractal=e._fractal,r._perlin=e._perlin,r},apply:function(e,n,a){var o=this;return r?(o._seed&&(r.seed(o._seed),o._seed=0),r(e,n,a,o._stitch,t.COLOR!==o.mode,o._baseX,o._baseY,o._octaves,o._offsets,1,.5,o._perlin)):e}})}(r),!function(e,r){var t=e.Color.Gradient,a=e.Util.Array.typed,o=Math.floor;e.Create({name:"GradientFilter",colors:null,stops:null,angle:0,path:n,init:function(e,r,n){var t=this;t.setColors(e,r),t.angle=n||0},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.angle=null,e.$super("dispose"),e},setColors:function(e,r){var n=this;if(e&&e.length){var a=t.stops(e,r);n.colors=a[0],n.stops=a[1]}return n},serialize:function(){var e=this;return{angle:e.angle,colors:e.colors,stops:e.stops}},unserialize:function(e){var r=this;return r.angle=e.angle,r.colors=a(e.colors,Array),r.stops=a(e.stops,Array),r},apply:function(e,r,n){var a=this;return a.colors?t.linear(e,r,n,a.colors,a.stops,a.angle,t.interpolate):e}}),e.Create({name:"RadialGradientFilter",colors:null,stops:null,centerX:0,centerY:0,radiusX:1,radiusY:1,init:function(e,r,n,t,a,o){var i=this;i.setColors(e,r),i.centerX=n||0,i.centerY=t||0,i.radiusX=a||1,i.radiusY=o||1},dispose:function(){var e=this;return e.colors=null,e.stops=null,e.centerX=null,e.centerY=null,e.radiusX=null,e.radiusY=null,e.$super("dispose"),e},setColors:function(e,r){var n=this;if(e&&e.length){var a=t.stops(e,r);n.colors=a[0],n.stops=a[1]}return n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radiusX:e.radiusX,radiusY:e.radiusY,colors:e.colors,stops:e.stops}}},unserialize:function(e){var r,n=this;return e&&n.name===e.filter&&(n._isOn=!!e._isOn,r=e.params,n.centerX=r.centerX||0,n.centerY=r.centerY||0,n.radiusX=r.radiusX||1,n.radiusY=r.radiusY||1,n.colors=a(r.colors,Array),n.stops=a(r.stops,Array)),n},apply:function(e,r,n){var a=this;return a.colors?t.radial(e,r,n,a.colors,a.stops,o((a.centerX||0)*(r-1)),o((a.centerY||0)*(n-1)),a.radiusX,a.radiusY,t.interpolate):e}})}(r),!function(e){var r=Math.min,t=Math.floor,a=e.CHANNEL,o=e.MODE;e.Create({name:"ChannelCopyFilter",srcChannel:a.R,dstChannel:a.R,centerX:0,centerY:0,color:0,hasInputs:!0,path:n,init:function(e,r,n,t,o){var i=this;i.srcChannel=e||a.R,i.dstChannel=r||a.R,i.centerX=n||0,i.centerY=t||0,i.color=o||0},dispose:function(){var e=this;return e.srcChannel=null,e.dstChannel=null,e.centerX=null,e.centerY=null,e.color=null,e.$super("dispose"),e},serialize:function(){var e=this;return{srcChannel:e.srcChannel,dstChannel:e.dstChannel,centerX:e.centerX,centerY:e.centerY,color:e.color}},unserialize:function(e){var r=this;return r.srcChannel=e.srcChannel,r.dstChannel=e.dstChannel,r.centerX=e.centerX,r.centerY=e.centerY,r.color=e.color,r},apply:function(e,n,a){var i,l=this;if(i=l.input("source"),!i)return e;var s,c,u,f,h,p,d,y,v,m,_=i[0],g=i[1],C=i[2],w=e.length,b=(_.length,l.srcChannel),Y=l.dstChannel,X=l.centerX||0,A=l.centerY||0,x=g>>>1,I=C>>>1,M=r(n,g),z=r(a,C),S=l.color||0,F=l.mode,O=o.COLOR32,R=o.COLOR8,L=o.COLORMASK32,E=o.COLORMASK8;for(O===F||L===F?(m=S>>>24&255,d=S>>>16&255,y=S>>>8&255,v=255&S):R!==F&&E!==F||(S&=255),X=t(X*(n-1))-x,A=t(A*(a-1))-I,c=0,u=0,s=0;w>s;s+=4,c++)c>=n&&(c=0,u++),h=c-X,p=u-A,0>h||h>=M||0>p||p>=z?O===F?(e[s]=d,e[s+1]=y,e[s+2]=v,e[s+3]=m):L===F?(e[s]=d&e[s],e[s+1]=y&e[s+1],e[s+2]=v&e[s+2],e[s+3]=m&e[s+3]):R===F?e[s+Y]=S:E===F&&(e[s+Y]=S&e[s+b]):(f=h+p*g<<2,e[s+Y]=_[f+b]);return e}})}(r),!function(e){var r=e._notSupportClamp,t=e.Array32F,a=e.MODE,o=Math.min,i=Math.max;e.Create({name:"HistogramEqualizeFilter",path:n,mode:a.INTENSITY,init:function(e){var r=this;r.mode=e||a.INTENSITY},_apply_rgb:function(e,n,a){var l,s,c,u,f,h,p,d,y,v,m,_,g,C,w,b,Y=0,X=0,A=0,x=255,I=255,M=255,z=e.length,S=z>>>2,F=(7&S)<<2;for(p=new t(256),d=new t(256),y=new t(256),b=0;z>b;b+=32)l=e[b],s=e[b+1],c=e[b+2],p[l]++,d[s]++,y[c]++,Y=i(l,Y),X=i(s,X),A=i(c,A),x=o(l,x),I=o(s,I),M=o(c,M),l=e[b+4],s=e[b+5],c=e[b+6],p[l]++,d[s]++,y[c]++,Y=i(l,Y),X=i(s,X),A=i(c,A),x=o(l,x),I=o(s,I),M=o(c,M),l=e[b+8],s=e[b+9],c=e[b+10],p[l]++,d[s]++,y[c]++,Y=i(l,Y),X=i(s,X),A=i(c,A),x=o(l,x),I=o(s,I),M=o(c,M),l=e[b+12],s=e[b+13],c=e[b+14],p[l]++,d[s]++,y[c]++,Y=i(l,Y),X=i(s,X),A=i(c,A),x=o(l,x),I=o(s,I),M=o(c,M),l=e[b+16],s=e[b+17],c=e[b+18],p[l]++,d[s]++,y[c]++,Y=i(l,Y),X=i(s,X),A=i(c,A),x=o(l,x),I=o(s,I),M=o(c,M),l=e[b+20],s=e[b+21],c=e[b+22],p[l]++,d[s]++,y[c]++,Y=i(l,Y),X=i(s,X),A=i(c,A),x=o(l,x),I=o(s,I),M=o(c,M),l=e[b+24],s=e[b+25],c=e[b+26],p[l]++,d[s]++,y[c]++,Y=i(l,Y),X=i(s,X),A=i(c,A),x=o(l,x),I=o(s,I),M=o(c,M),l=e[b+28],s=e[b+29],c=e[b+30],p[l]++,d[s]++,y[c]++,Y=i(l,Y),X=i(s,X),A=i(c,A),x=o(l,x),I=o(s,I),M=o(c,M);if(F)for(b=z-F;z>b;b+=4)l=e[b],s=e[b+1],c=e[b+2],p[l]++,d[s]++,y[c]++,Y=i(l,Y),X=i(s,X),A=i(c,A),x=o(l,x),I=o(s,I),M=o(c,M);for(v=m=_=0,b=0;256>b;b+=32)v+=p[b],p[b]=v,v+=p[b+1],p[b+1]=v,v+=p[b+2],p[b+2]=v,v+=p[b+3],p[b+3]=v,v+=p[b+4],p[b+4]=v,v+=p[b+5],p[b+5]=v,v+=p[b+6],p[b+6]=v,v+=p[b+7],p[b+7]=v,v+=p[b+8],p[b+8]=v,v+=p[b+9],p[b+9]=v,v+=p[b+10],p[b+10]=v,v+=p[b+11],p[b+11]=v,v+=p[b+12],p[b+12]=v,v+=p[b+13],p[b+13]=v,v+=p[b+14],p[b+14]=v,v+=p[b+15],p[b+15]=v,v+=p[b+16],p[b+16]=v,v+=p[b+17],p[b+17]=v,v+=p[b+18],p[b+18]=v,v+=p[b+19],p[b+19]=v,v+=p[b+20],p[b+20]=v,v+=p[b+21],p[b+21]=v,v+=p[b+22],p[b+22]=v,v+=p[b+23],p[b+23]=v,v+=p[b+24],p[b+24]=v,v+=p[b+25],p[b+25]=v,v+=p[b+26],p[b+26]=v,v+=p[b+27],p[b+27]=v,v+=p[b+28],p[b+28]=v,v+=p[b+29],p[b+29]=v,v+=p[b+30],p[b+30]=v,v+=p[b+31],p[b+31]=v,m+=d[b],d[b]=m,m+=d[b+1],d[b+1]=m,m+=d[b+2],d[b+2]=m,m+=d[b+3],d[b+3]=m,m+=d[b+4],d[b+4]=m,m+=d[b+5],d[b+5]=m,m+=d[b+6],d[b+6]=m,m+=d[b+7],d[b+7]=m,m+=d[b+8],d[b+8]=m,m+=d[b+9],d[b+9]=m,m+=d[b+10],d[b+10]=m,m+=d[b+11],d[b+11]=m,m+=d[b+12],d[b+12]=m,m+=d[b+13],d[b+13]=m,m+=d[b+14],d[b+14]=m,m+=d[b+15],d[b+15]=m,m+=d[b+16],d[b+16]=m,m+=d[b+17],d[b+17]=m,m+=d[b+18],d[b+18]=m,m+=d[b+19],d[b+19]=m,m+=d[b+20],d[b+20]=m,m+=d[b+21],d[b+21]=m,m+=d[b+22],d[b+22]=m,m+=d[b+23],d[b+23]=m,m+=d[b+24],d[b+24]=m,m+=d[b+25],d[b+25]=m,m+=d[b+26],d[b+26]=m,m+=d[b+27],d[b+27]=m,m+=d[b+28],d[b+28]=m,m+=d[b+29],d[b+29]=m,m+=d[b+30],d[b+30]=m,m+=d[b+31],d[b+31]=m,_+=y[b],y[b]=_,_+=y[b+1],y[b+1]=_,_+=y[b+2],y[b+2]=_,_+=y[b+3],y[b+3]=_,_+=y[b+4],y[b+4]=_,_+=y[b+5],y[b+5]=_,_+=y[b+6],y[b+6]=_,_+=y[b+7],y[b+7]=_,_+=y[b+8],y[b+8]=_,_+=y[b+9],y[b+9]=_,_+=y[b+10],y[b+10]=_,_+=y[b+11],y[b+11]=_,_+=y[b+12],y[b+12]=_,_+=y[b+13],y[b+13]=_,_+=y[b+14],y[b+14]=_,_+=y[b+15],y[b+15]=_,_+=y[b+16],y[b+16]=_,_+=y[b+17],y[b+17]=_,_+=y[b+18],y[b+18]=_,_+=y[b+19],y[b+19]=_,_+=y[b+20],y[b+20]=_,_+=y[b+21],y[b+21]=_,_+=y[b+22],y[b+22]=_,_+=y[b+23],y[b+23]=_,_+=y[b+24],y[b+24]=_,_+=y[b+25],y[b+25]=_,_+=y[b+26],y[b+26]=_,_+=y[b+27],y[b+27]=_,_+=y[b+28],y[b+28]=_,_+=y[b+29],y[b+29]=_,_+=y[b+30],y[b+30]=_,_+=y[b+31],y[b+31]=_;if(u=(Y-x)/S,f=(X-I)/S,h=(A-M)/S,r){for(b=0;z>b;b+=32)l=e[b],s=e[b+1],c=e[b+2],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~w,l=e[b+4],s=e[b+5],c=e[b+6],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+4]=~~g,e[b+5]=~~C,e[b+6]=~~w,l=e[b+8],s=e[b+9],c=e[b+10],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+8]=~~g,e[b+9]=~~C,e[b+10]=~~w,l=e[b+12],s=e[b+13],c=e[b+14],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+12]=~~g,e[b+13]=~~C,e[b+14]=~~w,l=e[b+16],s=e[b+17],c=e[b+18],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+16]=~~g,e[b+17]=~~C,e[b+18]=~~w,l=e[b+20],s=e[b+21],c=e[b+22],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+20]=~~g,e[b+21]=~~C,e[b+22]=~~w,l=e[b+24],s=e[b+25],c=e[b+26],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+24]=~~g,e[b+25]=~~C,e[b+26]=~~w,l=e[b+28],s=e[b+29],c=e[b+30],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b+28]=~~g,e[b+29]=~~C,e[b+30]=~~w;if(F)for(b=z-F;z>b;b+=4)l=e[b],s=e[b+1],c=e[b+2],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,g=0>g?0:g>255?255:g,C=0>C?0:C>255?255:C,w=0>w?0:w>255?255:w,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~w}else{for(b=0;z>b;b+=32)l=e[b],s=e[b+1],c=e[b+2],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~w,l=e[b+4],s=e[b+5],c=e[b+6],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,e[b+4]=~~g,e[b+5]=~~C,e[b+6]=~~w,l=e[b+8],s=e[b+9],c=e[b+10],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,e[b+8]=~~g,e[b+9]=~~C,e[b+10]=~~w,l=e[b+12],s=e[b+13],c=e[b+14],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,e[b+12]=~~g,e[b+13]=~~C,e[b+14]=~~w,l=e[b+16],s=e[b+17],c=e[b+18],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,e[b+16]=~~g,e[b+17]=~~C,e[b+18]=~~w,l=e[b+20],s=e[b+21],c=e[b+22],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,e[b+20]=~~g,e[b+21]=~~C,e[b+22]=~~w,l=e[b+24],s=e[b+25],c=e[b+26],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,e[b+24]=~~g,e[b+25]=~~C,e[b+26]=~~w,l=e[b+28],s=e[b+29],c=e[b+30],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,e[b+28]=~~g,e[b+29]=~~C,e[b+30]=~~w;if(F)for(b=z-F;z>b;b+=4)l=e[b],s=e[b+1],c=e[b+2],g=p[l]*u+x,C=d[s]*f+I,w=y[c]*h+M,e[b]=~~g,e[b+1]=~~C,e[b+2]=~~w}return e},apply:function(e,n,l){var s=this;if(!s._isOn)return e;if(a.RGB===s.mode)return s._apply_rgb(e,n,l);var c,u,f,h,p,d,y,v,m,_,g=0,C=255,w=e.length,b=w>>>2,Y=a.GRAY===s.mode,X=(7&b)<<2;if(v=new t(256),Y){for(_=0;w>_;_+=32)c=e[_],v[c]++,g=i(c,g),C=o(c,C),c=e[_+4],v[c]++,g=i(c,g),C=o(c,C),c=e[_+8],v[c]++,g=i(c,g),C=o(c,C),c=e[_+12],v[c]++,g=i(c,g),C=o(c,C),c=e[_+16],v[c]++,g=i(c,g),C=o(c,C),c=e[_+20],v[c]++,g=i(c,g),C=o(c,C),c=e[_+24],v[c]++,g=i(c,g),C=o(c,C),c=e[_+28],v[c]++,g=i(c,g),C=o(c,C);if(X)for(_=w-X;w>_;_+=4)c=e[_],v[c]++,g=i(c,g),C=o(c,C)}else{for(_=0;w>_;_+=32)c=e[_],u=e[_+1],f=e[_+2],h=~~(0+.299*c+.587*u+.114*f),p=~~(128-.168736*c-.331264*u+.5*f),d=~~(128+.5*c-.418688*u-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,e[_]=d,e[_+1]=h,e[_+2]=p,v[h]++,g=i(h,g),C=o(h,C),c=e[_+4],u=e[_+5],f=e[_+6],h=~~(0+.299*c+.587*u+.114*f),p=~~(128-.168736*c-.331264*u+.5*f),d=~~(128+.5*c-.418688*u-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,e[_+4]=d,e[_+5]=h,e[_+6]=p,v[h]++,g=i(h,g),C=o(h,C),c=e[_+8],u=e[_+9],f=e[_+10],h=~~(0+.299*c+.587*u+.114*f),p=~~(128-.168736*c-.331264*u+.5*f),d=~~(128+.5*c-.418688*u-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,e[_+8]=d,e[_+9]=h,e[_+10]=p,v[h]++,g=i(h,g),C=o(h,C),c=e[_+12],u=e[_+13],f=e[_+14],h=~~(0+.299*c+.587*u+.114*f),p=~~(128-.168736*c-.331264*u+.5*f),d=~~(128+.5*c-.418688*u-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,e[_+12]=d,e[_+13]=h,e[_+14]=p,v[h]++,g=i(h,g),C=o(h,C),c=e[_+16],u=e[_+17],f=e[_+18],h=~~(0+.299*c+.587*u+.114*f),p=~~(128-.168736*c-.331264*u+.5*f),d=~~(128+.5*c-.418688*u-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,e[_+16]=d,e[_+17]=h,e[_+18]=p,v[h]++,g=i(h,g),C=o(h,C),c=e[_+20],u=e[_+21],f=e[_+22],h=~~(0+.299*c+.587*u+.114*f),p=~~(128-.168736*c-.331264*u+.5*f),d=~~(128+.5*c-.418688*u-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,e[_+20]=d,e[_+21]=h,e[_+22]=p,v[h]++,g=i(h,g),C=o(h,C),c=e[_+24],u=e[_+25],f=e[_+26],h=~~(0+.299*c+.587*u+.114*f),p=~~(128-.168736*c-.331264*u+.5*f),d=~~(128+.5*c-.418688*u-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,e[_+24]=d,e[_+25]=h,e[_+26]=p,v[h]++,g=i(h,g),C=o(h,C),c=e[_+28],u=e[_+29],f=e[_+30],h=~~(0+.299*c+.587*u+.114*f),p=~~(128-.168736*c-.331264*u+.5*f),d=~~(128+.5*c-.418688*u-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,e[_+28]=d,e[_+29]=h,e[_+30]=p,v[h]++,g=i(h,g),C=o(h,C);if(X)for(_=w-X;w>_;_+=4)c=e[_],u=e[_+1],f=e[_+2],h=~~(0+.299*c+.587*u+.114*f),p=~~(128-.168736*c-.331264*u+.5*f),d=~~(128+.5*c-.418688*u-.081312*f),d=0>d?0:d>255?255:d,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,e[_]=d,e[_+1]=h,e[_+2]=p,v[h]++,g=i(h,g),C=o(h,C)}for(m=0,_=0;256>_;_+=32)m+=v[_],v[_]=m,m+=v[_+1],v[_+1]=m,m+=v[_+2],v[_+2]=m,m+=v[_+3],v[_+3]=m,m+=v[_+4],v[_+4]=m,m+=v[_+5],v[_+5]=m,m+=v[_+6],v[_+6]=m,m+=v[_+7],v[_+7]=m,m+=v[_+8],v[_+8]=m,m+=v[_+9],v[_+9]=m,m+=v[_+10],v[_+10]=m,m+=v[_+11],v[_+11]=m,m+=v[_+12],v[_+12]=m,m+=v[_+13],v[_+13]=m,m+=v[_+14],v[_+14]=m,m+=v[_+15],v[_+15]=m,m+=v[_+16],v[_+16]=m,m+=v[_+17],v[_+17]=m,m+=v[_+18],v[_+18]=m,m+=v[_+19],v[_+19]=m,m+=v[_+20],v[_+20]=m,m+=v[_+21],v[_+21]=m,m+=v[_+22],v[_+22]=m,m+=v[_+23],v[_+23]=m,m+=v[_+24],v[_+24]=m,m+=v[_+25],v[_+25]=m,m+=v[_+26],v[_+26]=m,m+=v[_+27],v[_+27]=m,m+=v[_+28],v[_+28]=m,m+=v[_+29],v[_+29]=m,m+=v[_+30],v[_+30]=m,m+=v[_+31],v[_+31]=m;if(y=(g-C)/b,r)if(Y){for(_=0;w>_;_+=32)c=~~(v[e[_]]*y+C),c=0>c?0:c>255?255:c,e[_]=c,e[_+1]=c,e[_+2]=c,c=~~(v[e[_+4]]*y+C),c=0>c?0:c>255?255:c,e[_+4]=c,e[_+5]=c,e[_+6]=c,c=~~(v[e[_+8]]*y+C),c=0>c?0:c>255?255:c,e[_+8]=c,e[_+9]=c,e[_+10]=c,c=~~(v[e[_+12]]*y+C),c=0>c?0:c>255?255:c,e[_+12]=c,e[_+13]=c,e[_+14]=c,c=~~(v[e[_+16]]*y+C),c=0>c?0:c>255?255:c,e[_+16]=c,e[_+17]=c,e[_+18]=c,c=~~(v[e[_+20]]*y+C),c=0>c?0:c>255?255:c,e[_+20]=c,e[_+21]=c,e[_+22]=c,c=~~(v[e[_+24]]*y+C),c=0>c?0:c>255?255:c,e[_+24]=c,e[_+25]=c,e[_+26]=c,c=~~(v[e[_+28]]*y+C),c=0>c?0:c>255?255:c,e[_+28]=c,e[_+29]=c,e[_+30]=c;if(X)for(_=w-X;w>_;_+=4)c=~~(v[e[_]]*y+C),c=0>c?0:c>255?255:c,e[_]=c,e[_+1]=c,e[_+2]=c}else{for(_=0;w>_;_+=32)h=v[e[_+1]]*y+C,p=e[_+2],d=e[_],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_]=c,e[_+1]=u,e[_+2]=f,h=v[e[_+5]]*y+C,p=e[_+6],d=e[_+4],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+4]=c,e[_+5]=u,e[_+6]=f,h=v[e[_+9]]*y+C,p=e[_+10],d=e[_+8],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+8]=c,e[_+9]=u,e[_+10]=f,h=v[e[_+13]]*y+C,p=e[_+14],d=e[_+12],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+12]=c,e[_+13]=u,e[_+14]=f,h=v[e[_+17]]*y+C,p=e[_+18],d=e[_+16],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+16]=c,e[_+17]=u,e[_+18]=f,h=v[e[_+21]]*y+C,p=e[_+22],d=e[_+20],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+20]=c,e[_+21]=u,e[_+22]=f,h=v[e[_+25]]*y+C,p=e[_+26],d=e[_+24],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+24]=c,e[_+25]=u,e[_+26]=f,h=v[e[_+29]]*y+C,p=e[_+30],d=e[_+28],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_+28]=c,e[_+29]=u,e[_+30]=f;if(X)for(_=w-X;w>_;_+=4)h=v[e[_+1]]*y+C,p=e[_+2],d=e[_],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),c=0>c?0:c>255?255:c,u=0>u?0:u>255?255:u,f=0>f?0:f>255?255:f,e[_]=c,e[_+1]=u,e[_+2]=f}else if(Y){for(_=0;w>_;_+=32)c=~~(v[e[_]]*y+C),e[_]=c,e[_+1]=c,e[_+2]=c,c=~~(v[e[_+4]]*y+C),e[_+4]=c,e[_+5]=c,e[_+6]=c,c=~~(v[e[_+8]]*y+C),e[_+8]=c,e[_+9]=c,e[_+10]=c,c=~~(v[e[_+12]]*y+C),e[_+12]=c,e[_+13]=c,e[_+14]=c,c=~~(v[e[_+16]]*y+C),e[_+16]=c,e[_+17]=c,e[_+18]=c,c=~~(v[e[_+20]]*y+C),e[_+20]=c,e[_+21]=c,e[_+22]=c,c=~~(v[e[_+24]]*y+C),e[_+24]=c,e[_+25]=c,e[_+26]=c,c=~~(v[e[_+28]]*y+C),e[_+28]=c,e[_+29]=c,e[_+30]=c;if(X)for(_=w-X;w>_;_+=4)c=~~(v[e[_]]*y+C),e[_]=c,e[_+1]=c,e[_+2]=c}else{for(_=0;w>_;_+=32)h=v[e[_+1]]*y+C,p=e[_+2],d=e[_],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),e[_]=c,e[_+1]=u,e[_+2]=f,h=v[e[_+5]]*y+C,p=e[_+6],d=e[_+4],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),e[_+4]=c,e[_+5]=u,e[_+6]=f,h=v[e[_+9]]*y+C,p=e[_+10],d=e[_+8],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),e[_+8]=c,e[_+9]=u,e[_+10]=f,h=v[e[_+13]]*y+C,p=e[_+14],d=e[_+12],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),e[_+12]=c,e[_+13]=u,e[_+14]=f,h=v[e[_+17]]*y+C,p=e[_+18],d=e[_+16],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),e[_+16]=c,e[_+17]=u,e[_+18]=f,h=v[e[_+21]]*y+C,p=e[_+22],d=e[_+20],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),e[_+20]=c,e[_+21]=u,e[_+22]=f,h=v[e[_+25]]*y+C,p=e[_+26],d=e[_+24],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),e[_+24]=c,e[_+25]=u,e[_+26]=f,h=v[e[_+29]]*y+C,p=e[_+30],d=e[_+28],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),e[_+28]=c,e[_+29]=u,e[_+30]=f;if(X)for(_=w-X;w>_;_+=4)h=v[e[_+1]]*y+C,p=e[_+2],d=e[_],c=~~(h+1.402*(d-128)),u=~~(h-.34414*(p-128)-.71414*(d-128)),f=~~(h+1.772*(p-128)),e[_]=c,e[_+1]=u,e[_+2]=f}return e}})}(r),!function(e){var r=e.ImArray,t=Math.sqrt,a=Math.min;Math.max,t(3);e.Create({name:"PixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:n,serialize:function(){var e=this;return{scale:e.scale}},unserialize:function(e){var r=this;return r.scale=e.scale,r},apply:function(e,n,o){var i=this;if(!i._isOn||i.scale<=1)return e;i.scale>100&&(i.scale=100);var l,s,c,u,f,h,p,d,y,v,m,_,g,C,w,b,Y,X,A,x,I,M=e.length,z=M>>>2,S=n-1,F=z-n;for(l=new r(M),s=t(z)*i.scale*.01|0,c=s-1,u=n*c,g=C=w=b=Y=0,_=0;M>_;_+=4)X=g-w,A=C-Y,x=a(S,X+c),I=a(F,A+u),f=X+A<<2,h=X+I<<2,p=x+A<<2,d=x+I<<2,y=e[f]+e[h]+e[p]+e[d],v=e[f+1]+e[h+1]+e[p+1]+e[d+1],m=e[f+2]+e[h+2]+e[p+2]+e[d+2],l[_]=.25*y|0,l[_+1]=.25*v|0,l[_+2]=.25*m|0,l[_+3]=e[_+3],g++,w++,g>=n&&(w=0,g=0,b++,Y+=n,C+=n,b>=s&&(b=0,Y=0)),w>=s&&(w=0);return l}}),e.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var r=this;r.scale=e||1},path:n,serialize:function(){var e=this;return{scale:e.scale}},unserialize:function(e){var r=this;return r.scale=e.scale,r},apply:function(e,n,o){var i=this;if(!i._isOn||i.scale<=1)return e;i.scale>100&&(i.scale=100);var l,s,c,u,f,h,p,d,y,v,m,_,g,C,w,b,Y,X,A,x,I=e.length,M=I>>>2,z=n-1,S=M-n;for(l=new r(I),s=t(M)*i.scale*.01|0,c=s-1,u=n*c,_=g=C=w=b=0,m=0;I>m;m+=4)Y=_-C,X=g-b,A=a(z,Y+c),x=a(S,X+u),C+w>c?(f=A+X<<2,h=A+x<<2,p=Y+X<<2):(f=Y+X<<2,h=Y+x<<2,p=A+X<<2),d=e[f]+e[h]+e[p],y=e[f+1]+e[h+1]+e[p+1],v=e[f+2]+e[h+2]+e[p+2],l[m]=.333*d|0,l[m+1]=.333*y|0,l[m+2]=.333*v|0,l[m+3]=e[m+3],_++,C++,_>=n&&(C=0,_=0,w++,b+=n,g+=n,w>=s&&(w=0,b=0)),C>=s&&(C=0);return l}})}(r),!function(e,r){var t=7/16,a=3/16,o=5/16,i=1/16,l=e.MODE,s=e.Array32F,c=e.Color.clamp,u=e.Color.intensity;e.Create({name:"HalftoneFilter",size:1,thresh:.4,mode:l.GRAY,init:function(e,r,n){var t=this;t.size=e||1,t.thresh=c(null==r?.4:r,0,1),t.mode=n||l.GRAY},path:n,threshold:function(e){return this.thresh=c(e,0,1),this},serialize:function(){var e=this;return{size:e.size,thresh:e.thresh}},unserialize:function(e){var r=this;return r.size=e.size,r.thresh=e.thresh,r},apply:function(e,r,n){var c,f,h,p,d,y,v,m,_,g,C,w,b,Y,X,A,x,I,M,z,S,F=this,O=e.length,R=O>>>2,L=new s(3*R),E=F.size,T=E*E,N=1/T,P=255*F.thresh,U=U<<1,q=l.RGB===F.mode,G=E*r,H=t,D=a,$=o,k=i;for(d=0,y=0,p=0;n>d;){if(g=C=w=0,q){for(v=0,m=0,_=0;E>m;)c=p+y+v+_<<2,f=3*(p+y+v+_),g+=e[c]+L[f],C+=e[c+1]+L[f+1],w+=e[c+2]+L[f+2],++v>=E&&(v=0,m++,_+=r);g*=N,C*=N,w*=N,h=u(g,C,w),h>P?(b=0|g,Y=0|C,X=0|w):(b=0,Y=0,X=0)}else{for(v=0,m=0,_=0;E>m;)c=p+y+v+_<<2,f=3*(p+y+v+_),g+=e[c]+L[f],++v>=E&&(v=0,m++,_+=r);h=g*N,h>P?(b=255,Y=255,X=255):(b=0,Y=0,X=0)}if(c=p+y<<2,A=e[c]-b,x=e[c+1]-Y,I=e[c+2]-X,r>p+E)for(M=H*A,z=H*x,S=H*I,v=E,m=0,_=0;E>m;)f=3*(p+y+v+_),L[f]+=M,L[f+1]+=z,L[f+2]+=S,++v>=U&&(v=E,m++,_+=r);if(n>d+E&&p>E)for(M=D*A,z=D*x,S=D*I,v=-E,m=E,_=0;U>m;)f=3*(p+y+v+_),L[f]+=M,L[f+1]+=z,L[f+2]+=S,++v>=0&&(v=-E,m++,_+=r);if(n>d+E)for(M=$*A,z=$*x,S=$*I,v=0,m=E,_=0;U>m;)f=3*(p+y+v+_),L[f]+=M,L[f+1]+=z,L[f+2]+=S,++v>=E&&(v=0,m++,_+=r);if(n>d+E&&r>p+E)for(M=k*A,z=k*x,S=k*I,v=E,m=E,_=0;U>m;)f=3*(p+y+v+_),L[f]+=M,L[f+1]+=z,L[f+2]+=S,++v>=U&&(v=E,m++,_+=r);for(v=0,m=0,_=0;E>m;)c=p+y+v+_<<2,e[c]=b,e[c+1]=Y,e[c+2]=X,++v>=E&&(v=0,m++,_+=r);p+=E,p>=r&&(p=0,d+=E,y+=G)}return e}})}(r),!function(e,r){var t=e.ImArray,a=e.Util.Filter.integral_convolution,o=new e.ConvolutionMatrix([1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9]);e.Create({name:"DropShadowFilter",offsetX:null,offsetY:null,color:0,opacity:1,quality:1,onlyShadow:!1,path:n,init:function(e,r,n,t,a,o){var i=this;i.offsetX=e||0,i.offsetY=r||0,i.color=n||0,i.opacity=null==t?1:+t,i.quality=0|(a||1),i.onlyShadow=!!o},dispose:function(){var e=this;return e.offsetX=null,e.offsetY=null,e.color=null,e.opacity=null,e.quality=null,e.onlyShadow=null,e.$super("dispose"),e},serialize:function(){var e=this;return{offsetX:e.offsetX,offsetY:e.offsetY,color:e.color,opacity:e.opacity,quality:e.quality,onlyShadow:e.onlyShadow}},unserialize:function(e){var r=this;return r.offsetX=e.offsetX,r.offsetY=e.offsetY,r.color=e.color,r.opacity=e.opacity,r.quality=e.quality,r.onlyShadow=e.onlyShadow,r},apply:function(e,r,n){var i=this;if(!i._isOn)return e;var l,s,c,u,f,h,p,d,y,v,m,_=i.color||0,g=i.opacity,C=i.quality,w=i.onlyShadow,b=i.offsetX||0,Y=i.offsetY||0,X=e.length,A=X>>>2;if(0>g&&(g=0),g>1&&(g=1),0===g)return e;for(l=_>>>16&255,s=_>>>8&255,c=255&_,0>=C&&(C=1),C>3&&(C=3),m=new t(X),u=0;X>u;u+=4)v=e[u+3],v>0&&(m[u]=l,m[u+1]=s,m[u+2]=c,m[u+3]=g*v|0);if(m=a(0,m,r,n,o,null,3,3,1,0,C),Y*=r,w)for(f=0,h=0,y=0;X>y;y+=4,f++)f>=r&&(f=0,h+=r),p=f+b,d=h+Y,0>p||p>=r||0>d||d>=A||(u=p+d<<2,e[u]=m[y],e[u+1]=m[y+1],e[u+2]=m[y+2],e[u+3]=m[y+3]);else for(f=0,h=0,y=0;X>y;y+=4,f++)f>=r&&(f=0,h+=r),p=f+b,d=h+Y,0>p||p>=r||0>d||d>=A||(u=p+d<<2,v=e[u+3],g=m[y+3],255!==v&&0!==g&&(g/=255,l=e[u]+(m[y]-e[u])*g,s=e[u+1]+(m[y+1]-e[u+1])*g,c=e[u+2]+(m[y+2]-e[u+2])*g,e[u]=0|l,e[u+1]=0|s,e[u+2]=0|c));return e}})}(r),!function(e){var r=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,o=e._notSupportClamp,i=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,r,n,t){var a=this;a.centerX=e||0,a.centerY=r||0,a.radius=n||10,a.amount=t||10},path:n,serialize:function(){var e=this;return{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}},unserialize:function(e){var r=this;return r.centerX=e.centerX,r.centerY=e.centerY,r.radius=e.radius,r.amount=e.amount,r},apply:function(e,n,l){var s=this;if(!s._isOn)return e;var c,u,f,h,p,d,y,v,m,_,g,C,w,b,Y,X,A,x,I,M,z,S,F,O,R,L,E,T,N,P,U,q,G,H=e.length,D=s.centerX||0,$=s.centerY||0,k=s.radius,j=s.amount;if(0>=j)return e;for(c=H>>>2,P=0,U=n-1,q=0,G=c-n,D=a(D*(n-1)),$=a($*(l-1)),f=(c<<1)+c,y=(n<<1)+n,u=new i(f),v=0,m=0,_=0,h=p=d=0,_=0;n>_;_++,v+=4,m+=3)h+=e[v],p+=e[v+1],d+=e[v+2],u[m]=h,u[m+1]=p,u[m+2]=d;for(v=y+n,m=0,_=0,h=p=d=0,v=y+n;H>v;v+=4,m+=3,_++)_>=n&&(_=0,h=p=d=0),h+=e[v],p+=e[v+1],d+=e[v+2],u[m+y]=u[m]+h,u[m+y+1]=u[m+1]+p,u[m+y+2]=u[m+2]+d;for(_=0,g=0,C=0,v=0;H>v;v+=4,_++)_>=n&&(_=0,g++,C+=n),b=_-D,Y=g-$,w=t(b)+t(Y),X=w>k?0|r((w-k)*j):w/k+.5|0,X>0&&(A=X*n,x=.25/(X*X),I=_-X,M=C-A,z=_+X,S=C+A,P>I?I=P:z>U&&(z=U),q>M?M=q:S>G&&(S=G),F=I+M,L=z+S,O=z+M,R=I+S,F=(F<<1)+F,O=(O<<1)+O,R=(R<<1)+R,L=(L<<1)+L,E=x*(u[L]-u[O]-u[R]+u[F]),T=x*(u[L+1]-u[O+1]-u[R+1]+u[F+1]),N=x*(u[L+2]-u[O+2]-u[R+2]+u[F+2]),o&&(E=0>E?0:E>255?255:E,T=0>T?0:T>255?255:T,N=0>N?0:N>255?255:N),e[v]=0|E,e[v+1]=0|T,e[v+2]=0|N);return e}})}(r),!function(e){e.Create({name:"SeamlessTileFilter",type:2,init:function(e){var r=this;r.type=null==e?2:e||0},path:n,serialize:function(){var e=this;return{type:e.type}},unserialize:function(e){var r=this;return r.type=e.type,r},apply:function(r,n,t){var a,o,i,l,s,c,u,f,h,p,d,y,v,m,_,g=this,C=g.type,w=e.Interpolation.bilinear,b=e.ImArray,Y=e.Array8U,X=Math.sqrt;for(n!==t?r=w(r,n,t,y=n>t?n:t,y):y=n,v=Math.round(y/2),m=y*y,_=r.length,a=new b(_),o=new b(_),i=new Y(m),f=0,h=0,p=0;_>p;p+=4,f++)f>=y&&(f=0,h++),d=(f+v)%y+(h+v)%y*y<<2,a[d]=r[p],a[d+1]=r[p+1],a[d+2]=r[p+2],a[d+3]=r[p+3];if(0===C)for(f=0,h=0;v>f;h++)h>=v&&(h=0,f++),u=255-255*X((f-v)*(f-v)+(h-v)*(h-v))/v,u=1>u?1:u>255?255:u,i[f+h*y]=u,i[f+(y-1-h)*y]=u,i[y-1-f+h*y]=u,i[y-1-f+(y-1-h)*y]=u;else if(1===C)for(f=0,h=0;v>f;h++)h>=v&&(h=0,f++),u=255-255*(v+f>v+h?(h-v)/v:(f-y/2)/v),u=1>u?1:u>255?255:u,i[f+h*y]=u,i[f+(y-1-h)*y]=u,i[y-1-f+h*y]=u,i[y-1-f+(y-1-h)*y]=u;else for(f=0,h=0;v>f;h++)h>=v&&(h=0,f++),u=255-255*(v+f>v+h?X((h-y)*(h-y)+(f-y)*(f-y))/(1.13*y):X((f-y)*(f-y)+(h-y)*(h-y))/(1.13*y)),u=1>u?1:u>255?255:u,i[f+h*y]=u,i[f+(y-1-h)*y]=u,i[y-1-f+h*y]=u,i[y-1-f+(y-1-h)*y]=u;for(h=0,f=0;y>h;f++)f>=y&&(f=0,h++),d=f+h*y,l=i[d],s=i[(f+v)%y+(h+v)%y*y],c=l+s,l/=c,s/=c,d<<=2,o[d]=~~(l*r[d]+s*a[d]),o[d+1]=~~(l*r[d+1]+s*a[d+1]),o[d+2]=~~(l*r[d+2]+s*a[d+2]),o[d+3]=r[d+3];return n!==t&&(o=w(o,y,y,n,t)),o}})}(r),!function(e){var r=(e.Util.Array.typed,Math.abs),t=(Math.min,Math.max,Math.ceil),a=e.MODE,o=e.Array8U,i=e.Array32U;e.Create({name:"FloodFillFilter",x:0,y:0,color:null,borderColor:null,tolerance:0,path:n,init:function(e,r,n,t,a){var o=this;o.x=e||0,o.y=r||0,o.color=n||0,o.tolerance=t||0,o.borderColor=a===+a?+a:null},serialize:function(){var e=this;return{color:e.color,borderColor:e.borderColor,x:e.x,y:e.y,tolerance:e.tolerance}},unserialize:function(e){var r=this;return r.color=e.color,r.borderColor=e.borderColor,r.x=e.x,r.y=e.y,r.tolerance=e.tolerance,r},apply:function(e,n,t){var a,i,l,s,c,u,f,h,p,d,y,v,m=this,_=255*(m.tolerance>=1?.999:m.tolerance)|0,g=m.color||0,C=m.borderColor,w=C===+C,b=n<<2,Y=m.x,X=m.y,A=e.length,x=0,I=A-b,M=0,z=n-1<<2;if(h=X*n<<2,Y<<=2,M>Y||Y>z||x>h||h>I)return e;if(a=new o(3),i=new o(3),i[0]=g>>>16&255,i[1]=g>>>8&255,i[2]=255&g,w){if(a[0]=C>>>16&255,a[1]=C>>>8&255,a[2]=255&C,r(a[0]-e[Y+h])<=_&&r(a[1]-e[Y+h+1])<=_&&r(a[2]-e[Y+h+2])<=_)return e}else{if(e[Y+h]===i[0]&&e[Y+h+1]===i[1]&&e[Y+h+2]===i[2])return e;a[0]=e[Y+h],a[1]=e[Y+h+1],a[2]=e[Y+h+2]}for(p=new Array(A>>>2),d=0,h+b>=x&&I>=h+b&&(p[d++]=[h,Y,Y,b]),p[d++]=[h+b,Y,Y,-b];d>0;){if(y=p[--d],h=y[0]+(b=y[3]),u=y[1],f=y[2],w)for(c=u;c>=M&&(s=c+h,!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_));c-=4)e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2];else for(c=u;c>=M&&(s=c+h,r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);c-=4)e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2];if(c>=u){if(s=c+h,w)for(;f>=c&&r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_;)c+=4,s=c+h;else for(;f>=c&&!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);)c+=4,s=c+h;l=c,v=f>=c}else l=c+4,u>l&&h-b>=x&&I>=h-b&&(p[d++]=[h,l,u-4,-b]),c=u+4,v=!0;for(;v;){if(s=c+h,w)for(;z>=c&&!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);)e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2],c+=4,s=c+h;else for(;z>=c&&r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_;)e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2],c+=4,s=c+h;if(h+b>=x&&I>=h+b&&(p[d++]=[h,l,c-4,b]),c>f+4&&h-b>=x&&I>=h-b&&(p[d++]=[h,f+4,c-4,-b]),s=c+h,w)for(;f>=c&&r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_;)c+=4,s=c+h;else for(;f>=c&&!(r(a[0]-e[s])<=_&&r(a[1]-e[s+1])<=_&&r(a[2]-e[s+2])<=_);)c+=4,s=c+h;l=c,v=f>=c}}return e}}),e.ColorFillFilter=e.FloodFillFilter,e.Create({name:"PatternFillFilter",x:0,y:0,offsetX:0,offsetY:0,tolerance:0,mode:a.TILE,borderColor:null,hasInputs:!0,path:n,init:function(e,r,n,t,o,i,l,s){var c=this;c.x=e||0,c.y=r||0,c.offsetX=t||0,c.offsetY=o||0,n&&c.setInput("pattern",n),c.mode=i||a.TILE,c.tolerance=l||0,c.borderColor=s===+s?+s:null},dispose:function(){var e=this;return e.x=null,e.y=null,e.offsetX=null,e.offsetY=null,e.tolerance=null,e.borderColor=null,e.$super("dispose"),e},serialize:function(){var e=this;return{x:e.x,y:e.y,offsetX:e.offsetX,offsetY:e.offsetY,tolerance:e.tolerance,borderColor:e.borderColor}},unserialize:function(e){var r=this;return r.x=e.x,r.y=e.y,r.offsetX=e.offsetX,r.offsetY=e.offsetY,r.tolerance=e.tolerance,r.borderColor=e.borderColor,r},apply:function(e,n,l){var s,c=this;if(s=c.input("pattern"),!s)return e;var u,f,h,p,d,y,v,m,_,g,C,w,b,Y,X,A,x=255*(c.tolerance>=1?.999:c.tolerance)|0,I=c.mode,M=c.borderColor,z=M===+M,S=n<<2,F=s[0],O=s[1],R=s[2],L=c.x,E=c.y,T=c.offsetX||0,N=c.offsetY||0,P=e.length,U=P>>>2,q=0,G=P-S,H=0,D=n-1<<2,$=a.STRETCH;if(0>T&&(T+=O),0>N&&(N+=R),d=E,m=E*n<<2,L<<=2,H>L||L>D||q>m||m>G)return e;if(u=new o(3),z){if(u[0]=M>>>16&255,u[1]=M>>>8&255,u[2]=255&M,r(u[0]-e[L+m])<=x&&r(u[1]-e[L+m+1])<=x&&r(u[2]-e[L+m+2])<=x)return e}else u[0]=e[L+m],u[1]=e[L+m+1],u[2]=e[L+m+2];for(w=new Array(U),b=0,Y=new i(t(U/32)),m+S>=q&&G>=m+S&&(w[b++]=[m,L,L,S,d+1]),w[b++]=[m+S,L,L,-S,d];b>0;){if(X=w[--b],m=X[0]+(S=X[3]),y=X[1],v=X[2],d=X[4],z)for(p=y;p>=H&&(h=p+m,!(Y[h>>>7]&1<<(h>>>2&31)||r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x));p-=4)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=O*(p>>>2)/n|0,C=R*d/l|0):(g=((p>>>2)+T)%O,C=(d+N)%R),_=g+C*O<<2,e[h]=F[_],e[h+1]=F[_+1],e[h+2]=F[_+2];else for(p=y;p>=H&&(h=p+m,!(Y[h>>>7]&1<<(h>>>2&31))&&r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x);p-=4)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=O*(p>>>2)/n|0,C=R*d/l|0):(g=((p>>>2)+T)%O,C=(d+N)%R),_=g+C*O<<2,e[h]=F[_],e[h+1]=F[_+1],e[h+2]=F[_+2];if(p>=y){if(h=p+m,z)for(;v>=p&&Y[h>>>7]&1<<(h>>>2&31)||r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x;)p+=4,h=p+m;else for(;v>=p&&!(!(Y[h>>>7]&1<<(h>>>2&31))&&r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x);)p+=4,h=p+m;f=p,A=v>=p}else f=p+4,y>f&&m-S>=q&&G>=m-S&&(w[b++]=[m,f,y-4,-S,S>0?d-1:d+1]),p=y+4,A=!0;for(;A;){if(h=p+m,z)for(;D>=p&&!(Y[h>>>7]&1<<(h>>>2&31))&&!(r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x);)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=O*(p>>>2)/n|0,C=R*d/l|0):(g=((p>>>2)+T)%O,C=(d+N)%R),_=g+C*O<<2,e[h]=F[_],
e[h+1]=F[_+1],e[h+2]=F[_+2],p+=4,h=p+m;else for(;D>=p&&!(Y[h>>>7]&1<<(h>>>2&31))&&r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x;)Y[h>>>7]|=1<<(h>>>2&31),$===I?(g=O*(p>>>2)/n|0,C=R*d/l|0):(g=((p>>>2)+T)%O,C=(d+N)%R),_=g+C*O<<2,e[h]=F[_],e[h+1]=F[_+1],e[h+2]=F[_+2],p+=4,h=p+m;if(m+S>=q&&G>=m+S&&(w[b++]=[m,f,p-4,S,S>0?d+1:d-1]),p>v+4&&m-S>=q&&G>=m-S&&(w[b++]=[m,v+4,p-4,-S,S>0?d-1:d+1]),h=p+m,z)for(;v>=p&&Y[h>>>7]&1<<(h>>>2&31)||r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x;)p+=4,h=p+m;else for(;v>=p&&!(!(Y[h>>>7]&1<<(h>>>2&31))&&r(u[0]-e[h])<=x&&r(u[1]-e[h+1])<=x&&r(u[2]-e[h+2])<=x);)p+=4,h=p+m;f=p,A=v>=p}}return e}})}(r),!function(e){function r(e,r,n,t){var a,i,l,v,m,_=2,g=14,C=(e.length,t.length),w=new o(C),b=new o(C),Y=new o(C),X=new o(C),A=new o(g),x=new o(g),I=_*_,M=2*I,z=h*I;for(a=0;g>a&&(i=p(-(a*a)/M),!(s>=i&&a>=2));a++)l=p(-((m=a-.5)*m)/M),v=p(-((m=a+.5)*m)/M),A[a]=(i+l+v)/3/z,x[a]=v-l;var m,S,F,O,R,L,E,T,N,P=a-1,U=r-(a-1),q=r*(a-1),G=r*(n-(a-1));for(m=P,S=q;U>m;S+=r){for(S>=G&&(S=q,m++),F=m+S,O=e[F<<2]*A[0],R=O,L=1,E=r;a>L;)R+=A[L]*(e[F-E<<2]+e[F+E<<2]),O+=A[L]*(e[F-L<<2]+e[F+L<<2]),E+=r,L++;b[F]=R,w[F]=O}for(m=P,S=q;U>m;S+=r){for(S>=G&&(S=q,m++),T=0,F=m+S,N=1;a>N;N++)T+=x[N]*(b[F-N]-b[F+N]);Y[F]=T}for(U=r-a,m=a,S=q;U>m;S+=r){for(S>=G&&(S=q,m++),T=0,F=m+S,E=r,N=1;a>N;N++)T+=x[N]*(w[F-E]-w[F+E]),E+=r;X[F]=T}P=a,U=r-a,q=r*a,G=r*(n-a);var H,D,$,k,j,B,K,W,J,Q,V,Z,ee,re,ne,te,ae,oe,ie,le;for(m=P,S=q;U>m;S+=r)S>=G&&(S=q,m++),F=m+S,H=F-r,D=F+r,k=F-1,$=F+1,j=H-1,B=H+1,K=D-1,W=D+1,J=Y[F],Q=X[F],V=d(J)+d(Q),ee=d(Y[H])+d(X[H]),re=d(Y[D])+d(X[D]),te=d(Y[k])+d(X[k]),ne=d(Y[$])+d(X[$]),oe=d(Y[B])+d(X[B]),le=d(Y[W])+d(X[W]),ie=d(Y[K])+d(X[K]),ae=d(Y[j])+d(X[j]),(0>=J*Q?d(J)>=d(Q)?(Z=d(J*V))>=d(Q*oe-(J+Q)*ne)&&Z>d(Q*ie-(J+Q)*te):(Z=d(Q*V))>=d(J*oe-(Q+J)*ee)&&Z>d(J*ie-(Q+J)*re):d(J)>=d(Q)?(Z=d(J*V))>=d(Q*le+(J-Q)*ne)&&Z>d(Q*ae+(J-Q)*te):(Z=d(Q*V))>=d(J*le+(Q-J)*re)&&Z>d(J*ae+(Q-J)*ee))?t[F]=V>=u?f:y(c*V):t[F]=0}function t(e,r,n,t,o,i){var l,s,c,u,f=e.length,h=f>>>2;for(l=0;f>l;l+=4)e[l]=e[l+1]=e[l+2]=0;for(u=0,c=0,s=0,l=0;h>s;s++,l=s<<2,u++)u>=r&&(u=0,c++),0===e[l]&&t[s]>=i&&a(e,r,n,t,u,c,l,o)}function a(e,r,n,t,o,i,l,s){var c,u,f,h,p,d=0===o?o:o-1,y=o===r-1?o:o+1,v=0===i?i:i-1,m=i===n-1?i:i+1,_=v*r;for(e[l]=e[l+1]=e[l+2]=255,c=d,u=v,f=_;y>=c&&m>=u;){if(p=c+f,h=p<<2,(u!==i||c!==o)&&0===e[h]&&t[p]>=s)return void a(e,r,n,t,c,u,h,s);u++,f+=r,u>m&&(u=v,f=_,c++)}}var o=e.Array32F,i=e.Array32I,l=e.Util.Filter,s=.005,c=100,u=1e3,f=c*u,h=2*Math.PI,p=Math.exp,d=Math.abs,y=Math.floor,v=Math.round;l.canny_gradient=r,e.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,path:n,init:function(e,r){var n=this;n.low=arguments.length<1?2.5:e,n.high=arguments.length<2?7.5:r},thresholds:function(e,r){var n=this;return n.low=e,n.high=r,n},serialize:function(){var e=this;return{low:e.low,high:e.high}},unserialize:function(e){var r=this;return r.low=e.low,r.high=e.high,r},apply:function(e,r,n){var a,o=this,s=e.length>>2,u=l.canny_gradient;return u(e,r,n,a=new i(s)),t(e,r,n,a,v(o.low*c),v(o.high*c)),e}})}(r),!function(e,r){function t(e,r,n,t,a,o,i,l,s,c,u,f,d,y,_,g,C){var w,b,Y,X,A,x,I,M,z,S,F,O,R,L,E,T,N,P,U,q,G,H,D,$,k,j,B,K,W,J,Q,V,Z,ee,U,re,ne,te,ae,oe,ie,le,se,ce,ue,fe,he,pe,de,ye,ve,me,_e,ge=null!=_,Ce=o-t+1,we=i-a+1,be=Ce*we,Ye=be-1,Xe=l.stages,Ae=Xe.length,xe=l.size1,Ie=l.size2,Me=h(Ce/xe,we/Ie),ze=t,Se=a;for(q=0,G=Ce-1,H=0,D=be-Ce,w=s,w=s;Me>=w;w*=c)for(X=w*xe|0,b=X*u|0,A=w*Ie|0,Y=A*u|0,S=A*Ce,F=Y*Ce,x=Se*F,T=Ce-X,N=we-A,$=X*A,k=1/$,M=Se,z=x;N>M;M+=Y,z+=F)for(I=ze;T>I;I+=b)if(O=I-1+z-Ce,R=O+X,L=O+S,E=L+X,O=0>O?0:O>Ye?Ye:O,R=0>R?0:R>Ye?Ye:R,L=0>L?0:L>Ye?Ye:L,E=0>E?0:E>Ye?Ye:E,!(ge&&(W=k*(_[E]-_[L]-_[R]+_[O]),g>W||W>C))){for(j=k*(f[E]-f[L]-f[R]+f[O]),B=k*(y[E]-y[L]-y[R]+y[O]),K=B-j*j,K=K>1?p(K):1,J=!1,P=0;Ae>P;P++){for(Q=Xe[P],V=Q.thres,Z=Q.trees,ee=Z.length,_e=0,U=0;ee>U;U++)for(ne=Z[U].feats,re=0;;){if(te=ne[re],ae=te.rects,oe=ae.length,ie=te.thres,le=0,te.tilt)for(se=0;oe>se;se++)ce=ae[se],ue=I+w*ce[0]|0,fe=(M-1+w*ce[1]|0)*Ce,he=I+w*(ce[0]+ce[2])|0,pe=(M-1+w*(ce[1]+ce[2])|0)*Ce,de=I+w*(ce[0]-ce[3])|0,ye=(M-1+w*(ce[1]+ce[3])|0)*Ce,ve=I+w*(ce[0]+ce[2]-ce[3])|0,me=(M-1+w*(ce[1]+ce[2]+ce[3])|0)*Ce,ue=q>ue?q:ue>G?G:ue,he=q>he?q:he>G?G:he,de=q>de?q:de>G?G:de,ve=q>ve?q:ve>G?G:ve,fe=H>fe?H:fe>D?D:fe,pe=H>pe?H:pe>D?D:pe,ye=H>ye?H:ye>D?D:ye,me=H>me?H:me>D?D:me,le+=ce[4]*(d[ve+me]-d[de+ye]-d[he+pe]+d[ue+fe]);else for(se=0;oe>se;se++)ce=ae[se],ue=I-1+w*ce[0]|0,he=I-1+w*(ce[0]+ce[2])|0,fe=Ce*(M-1+w*ce[1]|0),pe=Ce*(M-1+w*(ce[1]+ce[3])|0),ue=q>ue?q:ue>G?G:ue,he=q>he?q:he>G?G:he,fe=H>fe?H:fe>D?D:fe,pe=H>pe?H:pe>D?D:pe,le+=ce[4]*(f[he+pe]-f[ue+pe]-f[he+fe]+f[ue+fe]);if(ie*K>le*k){if(te.has_l){_e+=te.l_val;break}re=te.l_node}else{if(te.has_r){_e+=te.r_val;break}re=te.r_node}}if(J=_e>V,!J)break}J&&(e.count===e.length&&m.apply(e,new Array(v)),e[e.count++]=[I,M,X,A])}}function a(e,r,n){var t=f(r[2],e[2])*n,a=f(r[3],e[3])*n;return u(e[0]-r[0])<=t&&u(e[1]-r[1])<=a&&u(e[2]-r[2])<=t&&u(e[3]-r[3])<=a}function o(e,r){return e.x1>=r.x1&&e.y1>=r.y1&&e.x2<=r.x2&&e.y2<=r.y2}function i(e){e.x1=e.x1+.5|0,e.y1=e.y1+.5|0,e.x2=e.x2+.5|0,e.y2=e.y2+.5|0}function l(e,r){return r.area-e.area}function s(e,r,n){var t,s,c,u,f,h,p,d,y,v,m,_=e.length,g=new Array(_),C=[],w=0,b=!1;for(c=0;_>c;c++)g[c]=0;for(c=0;_>c;c++){for(b=!1,u=0;c>u;u++)a(e[u],e[c],n)&&(b=!0,g[c]=g[u]);b||(g[c]=w,w++)}for(t=new Array(w),s=new Array(w),c=0;w>c;c++)t[c]=0,s[c]=[0,0,0,0];for(c=0;_>c;c++)p=g[c],t[p]++,s[p][0]+=e[c][0],s[p][1]+=e[c][1],s[p][2]+=e[c][2],s[p][3]+=e[c][3];for(c=0;w>c;c++)f=t[c],f>=r&&(h=1/(f+f),d=h*(2*s[c][0]+f),y=h*(2*s[c][1]+f),v=h*(2*s[c][2]+f),m=h*(2*s[c][3]+f),C.push({x1:d,y1:y,x2:d+v-1,y2:y+m-1,x:d,y:y,width:v,height:m,area:0,inside:0}));for(_=C.length,c=0;_>c;c++)for(u=c+1;_>u;u++)!C[c].inside&&o(C[c],C[u])?C[c].inside=1:!C[u].inside&&o(C[u],C[c])&&(C[u].inside=1);for(c=_;--c>=0;)C[c].inside?C.splice(c,1):(i(C[c]),C[c].area=C[c].width*C[c].height);return C.sort(l)}var c=e.Array32F,u=(e.Array8U,Math.abs),f=Math.max,h=Math.min,p=(Math.floor,Math.round,Math.sqrt),d=(e.Util.Array.typed,e.Util.Array.typed_obj),y="hasOwnProperty",v=10,m=Array.prototype.push,_=e.Util.Filter,g=_.SAT,C=_.GRAD;_.haar_detect=t,_.merge_features=s,e.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,tolerance:.2,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,n,t,a,o,i,l){var s=this;s.haardata=e||null,s.baseScale=r===n?1:n,s.scaleIncrement=r===t?1.25:t,s.stepIncrement=r===a?.5:a,s.minNeighbors=r===o?1:o,s.doCannyPruning=r===i?!0:!!i,s.tolerance=null==l?.2:+l,s._haarchanged=!!s.haardata},path:n,dispose:function(){var e=this;return e.haardata=null,e.$super("dispose"),e},haar:function(e){var r=this;return r.haardata=e,r._haarchanged=!0,r},params:function(e){var r=this;return e&&(e[y]("haardata")&&(r.haardata=e.haardata,r._haarchanged=!0),e[y]("baseScale")&&(r.baseScale=e.baseScale),e[y]("scaleIncrement")&&(r.scaleIncrement=e.scaleIncrement),e[y]("stepIncrement")&&(r.stepIncrement=e.stepIncrement),e[y]("minNeighbors")&&(r.minNeighbors=e.minNeighbors),e[y]("doCannyPruning")&&(r.doCannyPruning=e.doCannyPruning),e[y]("tolerance")&&(r.tolerance=e.tolerance),e[y]("cannyLow")&&(r.cannyLow=e.cannyLow),e[y]("cannyHigh")&&(r.cannyHigh=e.cannyHigh),e[y]("selection")&&(r.selection=e.selection||null)),r},serialize:function(){var e,r=this;return e={baseScale:r.baseScale,scaleIncrement:r.scaleIncrement,stepIncrement:r.stepIncrement,minNeighbors:r.minNeighbors,doCannyPruning:r.doCannyPruning,tolerance:r.tolerance,cannyLow:r.cannyLow,cannyHigh:r.cannyHigh},r._haarchanged&&(e.haardata=d(r.haardata),r._haarchanged=!1),e},unserialize:function(e){var r=this;return e[y]("haardata")&&(r.haardata=d(e.haardata,1)),r.baseScale=e.baseScale,r.scaleIncrement=e.scaleIncrement,r.stepIncrement=e.stepIncrement,r.minNeighbors=e.minNeighbors,r.doCannyPruning=e.doCannyPruning,r.tolerance=e.tolerance,r.cannyLow=e.cannyLow,r.cannyHigh=e.cannyHigh,r},meta:function(r){return r&&e.isWorker?d(this._meta):this._meta},setMeta:function(e,r){return this._meta=r&&"string"==typeof e?d(e,1):e,this},apply:function(e,r,n,t){var a=this;if(!a.haardata)return e;var o,i,l,s,u,p=e.length>>>2,d=a.selection||null,y=null,m=null,w=null,b=null,Y=_.haar_detect,X=_.merge_features;return d?(o=h(r-1,f(0,d[0]*(r-1))),i=h(n-1,f(0,d[1]*(n-1))),l=h(r-1,f(0,d[2]*(r-1))),s=h(n-1,f(0,d[3]*(n-1)))):(o=0,i=0,l=r-1,s=n-1),t&&t.haarfilter_SAT?(y=t.haarfilter_SAT,m=t.haarfilter_SAT2,w=t.haarfilter_RSAT):(g(e,r,n,y=new c(p),m=new c(p),w=new c(p)),t&&(t.haarfilter_SAT=y,t.haarfilter_SAT2=m,t.haarfilter_RSAT=w)),a.doCannyPruning&&(t&&t.haarfilter_EDGES?b=t.haarfilter_EDGES:(C(e,r,n,b=new c(p),null,1),t&&(t.haarfilter_EDGES=b))),u=new Array(v),u.count=0,Y(u,r,n,o,i,l,s,a.haardata,a.baseScale,a.scaleIncrement,a.stepIncrement,y,w,m,b,a.cannyLow,a.cannyHigh),u.length>u.count&&(u.length=u.count),a._meta={objects:X(u,a.minNeighbors,a.tolerance)},e}})}(r),!function(e,r){function t(e,r){for(;r[e][1]!==e;)r[e][1]=r[r[e][1]][1],e=r[e][1];return e}function a(e,r,n){var a=t(e,n),o=t(r,n);a!==o&&(n[a][1]=o)}function o(e,r,n){var t=n.next;return t+1>n.length&&Array.prototype.push.apply(n,new Array(C)),n[t]=[t,t,0],++n.next,t}function i(e,r,n,t){return e}function l(e,r,n,t,a){return 0===e[r+3]&&0===e[n+3]||g(e[r]-e[n])<=t&&g(e[r+1]-e[n+1])<=t&&g(e[r+2]-e[n+2])<=t}function s(e,r,n,t,a){return g(r[n]-e[0])<=t&&g(r[n+1]-e[1])<=t&&g(r[n+2]-e[2])<=t}function c(e,r,n,t,a){if(0===e[r+3]&&0===e[n+3])return!0;var o=r>>>2,i=n>>>2;return null==a[o]&&(a[o]=v(e[r],e[r+1],e[r+2])),null==a[i]&&(a[i]=v(e[n],e[n+1],e[n+2])),g(a[o],a[i])<=t}function u(e,r,n,t,a){var o=n>>>2;return null==a[o]&&(a[o]=v(r[n],r[n+1],r[n+2])),g(a[o],e)<=t}function f(e,r,n,t,a){if(0===e[r+3]&&0===e[n+3])return!0;var o=r>>>2,i=n>>>2;return null==a[o]&&(a[o]=y(e[r],e[r+1],e[r+2])),null==a[i]&&(a[i]=y(e[n],e[n+1],e[n+2])),g(a[o],a[i])<=t}function h(e,r,n,t,a){var o=n>>>2;return null==a[o]&&(a[o]=y(r[n],r[n+1],r[n+2])),g(a[o],e)<=t}var p=e.Array32U,d=e.MODE,y=e.Color.hue,v=e.Color.intensity,m=Math.min,_=Math.max,g=Math.abs,C=20;e.Create({name:"ConnectedComponentsFilter",connectivity:4,tolerance:0,mode:d.COLOR,color:null,invert:!1,box:null,init:function(e,r,n,t,a){var o=this;o.connectivity=8===e?8:4,o.tolerance=r||0,o.mode=n||d.COLOR,o.color=null==t?null:t,o.invert=!!a},path:n,serialize:function(){var e=this;return{connectivity:e.connectivity,tolerance:e.tolerance,color:e.color,invert:e.invert}},unserialize:function(e){var r=this;return r.connectivity=e.connectivity,r.tolerance=e.tolerance,r.color=e.color,r.invert=e.invert,r},apply:function(e,r,n){var y=this;if(!y._isOn)return e;var v,g,w,b,Y,X,A,x,I,M,z,S,F=e.length,O=F>>>2,R=r<<2,L=y.mode||d.COLOR,E=y.invert,T=y.color,N=m(.999,_(0,y.tolerance||0)),P=8===y.connectivity?8:4,U=8===P,q=U?-1:0,G=q<<2,H=null,D=null,$=null,k=null,j=null!=T;for(I=new Array(C),I.next=0,M=new p(O),d.HUE===L?(N*=360,H=f,D=new Array(O),j&&($=h)):d.INTENSITY===L?(N*=255,H=c,D=new Array(O),j&&($=u)):(N*=255,H=l,j&&(T=[T>>>16&255,T>>>8&255,255&T],$=s)),k=j?o(0,0,I):null,M[0]=j&&!$(T,e,0,N,D)?k:o(0,0,I),Y=1,v=4;r>Y;Y++,v+4)M[Y]=j&&!$(T,e,v,N,D)?k:H(e,v,v-4,N,D)?i(M[Y-1],Y,0,I):o(Y,0,I);for(X=1,x=r,v=R;n>X;X++,x+=r,v+=R)for(M[x]=j&&!$(T,e,v,N,D)?k:H(e,v,v-R,N,D)?i(M[x-r],0,X,I):o(0,X,I),Y=1,g=4;r>Y;Y++,g+=4)if(!j||$(T,e,v+g,N,D)){for(b=k===M[x+Y-1]?-1:H(e,v+g,v+g-4,N,D)?i(M[x+Y-1],Y,X,I):-1,A=q,w=G;1>A;A++,w+=4)k!==M[x-r+Y+A]&&H(e,v+g,v-R+g+w,N,D)&&(b>=0?a(b,M[x-r+Y+A],I):b=i(M[x-r+Y+A],Y+A,X,I));M[x+Y]=b>=0?i(b,Y,X,I):o(Y,X,I),U&&k!==M[x+Y-1]&&k!==M[x-r+Y]&&H(e,v+g-4,v-R+g,N,D)&&a(M[x+Y-1],M[x-r+Y],I)}else M[x+Y]=k;if(0===k)for(v=0,z=I.next,S=0;z>v;v++)v===I[v][1]&&(I[v][2]=0===I[v][1]?0:++S);else for(v=0,z=I.next,S=0;z>v;v++)v===I[v][1]&&(I[v][2]=S++);if(S=S>0?S:1,E)for(Y=0,v=0;F>v;v+=4,Y++)T=I[t(M[Y],I)][2],T=255-255*T/S|0,e[v]=T,e[v+1]=T,e[v+2]=T;else for(Y=0,v=0;F>v;v+=4,Y++)T=I[t(M[Y],I)][2],T=255*T/S|0,e[v]=T,e[v+1]=T,e[v+2]=T;return e}})}(r),r});

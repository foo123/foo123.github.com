/**
*
*   FILTER.js Plugins
*   @version: 0.7-alpha
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(r,e,t,n){"use strict";function a(r,e,t,n,a){var i;return r?{file:__filename,path:__dirname}:e?{file:i=self.location.href,path:i.split("/").slice(0,-1).join("/")}:t&&a&&a.uri?{file:i=a.uri,path:i.split("/").slice(0,-1).join("/")}:n&&(i=document.getElementsByTagName("script"))&&i.length?{file:i=i[i.length-1].src,path:i.split("/").slice(0,-1).join("/")}:{file:null,path:null}}function i(r,e,t,n,a){var i,l=r.length,o=new Array(l);for(i=0;l>i;i++)o[i]=1===n?t[r[i]]||a(e[i]):2===n?a(r[i]):t[r[i]];return o}function l(r,e,t,n,a,i){var l,o,s,u,c,f,h,p=t.length;if(i){for(l=0;p>l;l++)t[l]in r||importScripts(e+n[l]);return a()}f=document.getElementsByTagName("head")[0],h=document.createElement("a"),o=/^\./,s=0,l=0,u=function(r,t){var n=0,a=document.createElement("script");a.type="text/javascript",a.language="javascript",a.onload=a.onreadystatechange=function(){n||a.readyState&&"loaded"!=a.readyState&&"complete"!=a.readyState||(n=1,a.onload=a.onreadystatechange=null,t(),f.removeChild(a),a=null)},o.test(r)&&(h.href=e+r,r=h.protocol+"//"+h.host+h.pathname+h.search+h.hash),a.src=r,f.appendChild(a)},c=function(){t[l]in r?++l>=p?a():t[l]in r?c():u(n[l],c):++s<30?setTimeout(c,30):(s=0,l++,c())};for(;p>l&&t[l]in r;)l++;p>l?u(n[l],c):a()}t=t||[[],[]];var o,s,u,c="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),f=!c&&"undefined"!=typeof navigator,h=!c&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,p="function"==typeof define&&define.amd,m=c&&"object"==typeof module&&module.exports,d=h?self:r,g=a(c,h,p,f),v=[].concat(t[0]),_=[].concat(t[1]),C=v.length,M=/\.js$/i;if(m)module.$deps=module.$deps||{},module.exports=module.$deps[e]=n.apply(r,[{NODE:module}].concat(i(v,_,module.$deps,1,require)))||1;else if(p&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)){if(!require.defined(e)){for(u={},s=0;C>s;s++)require.specified(v[s])||(u[v[s]]=_[s].replace(M,""));require.config({paths:u}),define(e,["require","exports","module"].concat(v),function(e,t,a){return n.apply(r,[{AMD:a}].concat(i(v,_,arguments,2,e)))})}}else e in d||l(d,g.path+"/",v,_,function(){d[e]=o=n.apply(r,[{}].concat(i(v,_,d)))||1,p&&define(e,["require"],function(){return o})},h)}(this,"FILTER_PLUGINS",[["FILTER"],["./filter.js"]],function(r,e){return r.FILTER_PLUGINS=e,!function(e){"use strict";var t=e._notSupportClamp,n=Math.random;e.NoiseFilter=e.Create({name:"NoiseFilter",min:-127,max:127,init:function(r,e){var t=this;t.min=r||-127,t.max=e||127},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{min:r.min,max:r.max}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.min=e.min,t.max=e.max),t},apply:function(r){var e=this;if(!e._isOn)return r;var a,i,l,o,s,u,c,f,h=e.max-e.min,p=e.min,m=r.length;if(t)for(a=0;m>a;a+=4)l=r[a],o=r[a+1],s=r[a+2],i=h*n()+p,u=l+i,c=o+i,f=s+i,0>u?u=0:u>255&&(u=255),0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),r[a]=~~u,r[a+1]=~~c,r[a+2]=~~f;else for(a=0;m>a;a+=4)l=r[a],o=r[a+1],s=r[a+2],i=h*n()+p,u=l+i,c=o+i,f=s+i,r[a]=~~u,r[a+1]=~~c,r[a+2]=~~f;return r}})}(e),!function(e){"use strict";var t=e._notSupportClamp,n=e.Array32F,a=e.Color.RGB2YCbCr,i=e.Color.YCbCr2RGB;e.HistogramEqualizeFilter=e.Create({name:"HistogramEqualizeFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var l,o,s,u,c,f,h,p,m,d,g,v=0,_=255,C=0,M=r.length,b=M>>2,y=1/b;for(c=new n(256),m=0;256>m;m+=4)c[m]=0,c[m+1]=0,c[m+2]=0,c[m+3]=0;for(m=0;M>m;m+=4)l=r[m],o=r[m+1],s=r[m+2],d=a({r:l,g:o,b:s}),l=r[m]=~~d.cr,o=r[m+1]=~~d.y,s=r[m+2]=~~d.cb,c[o]+=y,o>v?v=o:_>o&&(_=o);for(C=0,m=0;256>m;m+=4)C+=c[m],c[m]=C,C+=c[m+1],c[m+1]=C,C+=c[m+2],c[m+2]=C,C+=c[m+3],c[m+3]=C;if(u=v-_,t)for(m=0;M>m;m+=4)d={cr:r[m],y:r[m+1],cb:r[m+2]},d.y=c[d.y]*u+_,g=i(d),f=g.r,h=g.g,p=g.b,f=0>f?0:f>255?255:f,h=0>h?0:h>255?255:h,p=0>p?0:p>255?255:p,r[m]=~~f,r[m+1]=~~h,r[m+2]=~~p;else for(m=0;M>m;m+=4)d={cr:r[m],y:r[m+1],cb:r[m+2]},d.y=c[d.y]*u+_,g=i(d),r[m]=~~g.r,r[m+1]=~~g.g,r[m+2]=~~g.b;return r}})}(e),!function(e){"use strict";var t=e._notSupportClamp,n=e.Array32F;e.GrayscaleHistogramEqualizeFilter=e.Create({name:"GrayscaleHistogramEqualizeFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var a,i,l,o,s,u=0,c=255,f=0,h=r.length,p=h>>2,m=1/p;for(o=new n(256),s=0;256>s;s+=4)o[s]=0,o[s+1]=0,o[s+2]=0,o[s+3]=0;for(s=0;h>s;s+=4)a=r[s],o[a]+=m,a>u?u=a:c>a&&(c=a);for(f=0,s=0;256>s;s+=4)f+=o[s],o[s]=f,f+=o[s+1],o[s+1]=f,f+=o[s+2],o[s+2]=f,f+=o[s+3],o[s+3]=f;if(l=u-c,t)for(s=0;h>s;s+=4)a=r[s],i=o[a]*l+c,i=0>i?0:i>255?255:i,i=~~i,r[s]=i,r[s+1]=i,r[s+2]=i;else for(s=0;h>s;s+=4)a=r[s],i=~~(o[a]*l+c),r[s]=i,r[s+1]=i,r[s+2]=i;return r}})}(e),!function(e){"use strict";var t=e._notSupportClamp,n=e.Array32F;e.RGBHistogramEqualizeFilter=e.Create({name:"RGBHistogramEqualizeFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var a,i,l,o,s,u,c,f,h,p,m,d,g,v,_,C,M=0,b=0,y=0,O=255,F=255,I=255,z=r.length,A=z>>2,Y=1/A;for(c=new n(256),f=new n(256),h=new n(256),C=0;256>C;C+=4)c[C]=0,f[C]=0,h[C]=0,c[C+1]=0,f[C+1]=0,h[C+1]=0,c[C+2]=0,f[C+2]=0,h[C+2]=0,c[C+3]=0,f[C+3]=0,h[C+3]=0;for(C=0;z>C;C+=4)a=r[C],i=r[C+1],l=r[C+2],c[a]+=Y,f[i]+=Y,h[l]+=Y,a>M?M=a:O>a&&(O=a),i>b?b=i:F>i&&(F=i),l>y?y=l:I>l&&(I=l);for(p=m=d=0,C=0;256>C;C+=4)p+=c[C],c[C]=p,m+=f[C],f[C]=m,d+=h[C],h[C]=d,p+=c[C+1],c[C+1]=p,m+=f[C+1],f[C+1]=m,d+=h[C+1],h[C+1]=d,p+=c[C+2],c[C+2]=p,m+=f[C+2],f[C+2]=m,d+=h[C+2],h[C+2]=d,p+=c[C+3],c[C+3]=p,m+=f[C+3],f[C+3]=m,d+=h[C+3],h[C+3]=d;if(o=M-O,s=b-F,u=y-I,t)for(C=0;z>C;C+=4)a=r[C],i=r[C+1],l=r[C+2],g=c[a]*o+O,v=f[i]*s+F,_=h[l]*u+I,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,_=0>_?0:_>255?255:_,r[C]=~~g,r[C+1]=~~v,r[C+2]=~~_;else for(C=0;z>C;C+=4)a=r[C],i=r[C+1],l=r[C+2],g=c[a]*o+O,v=f[i]*s+F,_=h[l]*u+I,r[C]=~~g,r[C+1]=~~v,r[C+2]=~~_;return r}})}(e),!function(e){"use strict";var t=Math.sqrt,n=e._notSupportClamp,a=e.Array32F;e.PixelateFilter=e.Create({name:"PixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.scale=e.scale),t},apply:function(r,e,i){var l=this;if(!l._isOn||l.scale<=1)return r;l.scale>100&&(l.scale=100);var o,s,u,c,f,h,p,m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x,P,w,D,H,N,B,R,G,L,T,j,V,$,U,Q,W,J,K,Z=r.length,re=Z>>2,ee=(e<<1)+e;for(o=~~(t(re)*l.scale*.01),s=e*o,u=i%o,c=e%o,f=(u-1)*e,d=1/(o*o),g=1/(c*o),v=1/(u*o),_=1/(c*u),C=d,M=g,b=v,y=_,A=o-1,Y=(o-1)*e,G=0,T=e-1,L=0,j=re-e,O=new a(3*re),S=0,k=0,X=0,F=I=z=0,X=0;e>X;X++,S+=4,k+=3)F+=r[S],I+=r[S+1],z+=r[S+2],O[k]=F,O[k+1]=I,O[k+2]=z;for(k=0,X=0,F=I=z=0,S=ee+e;Z>S;S+=4,k+=3,X++)X>=e&&(X=0,F=I=z=0),F+=r[S],I+=r[S+1],z+=r[S+2],O[k+ee]=O[k]+F,O[k+ee+1]=O[k+1]+I,O[k+ee+2]=O[k+2]+z;for(X=0,q=0,E=0,H=X,N=E,B=H+A,R=N+Y,B=B>T?T:B,R=R>j?j:R,V=H+N,Q=B+R,$=B+N,U=H+R,V=(V<<1)+V,$=($<<1)+$,U=(U<<1)+U,Q=(Q<<1)+Q,m=C,W=m*(O[Q]-O[$]-O[U]+O[V]),J=m*(O[Q+1]-O[$+1]-O[U+1]+O[V+1]),K=m*(O[Q+2]-O[$+2]-O[U+2]+O[V+2]),n&&(W=0>W?0:W>255?255:W,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),W=~~W,J=~~J,K=~~K,x=0,P=0,w=0,S=0;Z>S;S+=4)D=x+X+w+E<<2,r[D]=W,r[D+1]=J,r[D+2]=K,x++,(x+X>=e||x>=o)&&(x=0,P++,w+=e),(P+q>=i||P>=o)&&(X+=o,X>=e&&(X=0,q+=o,E+=s),x=0,P=0,w=0,H=X,N=E,B=H+A,R=N+Y,B=B>T?T:B,R=R>j?j:R,V=H+N,Q=B+R,$=B+N,U=H+R,V=(V<<1)+V,$=($<<1)+$,U=(U<<1)+U,Q=(Q<<1)+Q,h=0==B-H-c+1,p=0==R-N-f,m=h&&p?y:h?M:p?b:C,W=m*(O[Q]-O[$]-O[U]+O[V]),J=m*(O[Q+1]-O[$+1]-O[U+1]+O[V+1]),K=m*(O[Q+2]-O[$+2]-O[U+2]+O[V+2]),n&&(W=0>W?0:W>255?255:W,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),W=~~W,J=~~J,K=~~K);return r}})}(e),!function(e){"use strict";var t=Math.sqrt,n=(Math.SQRT2,Math.min,e._notSupportClamp),a=e.Array32F;e.TriangularPixelateFilter=e.Create({name:"TriangularPixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.scale=e.scale),t},apply:function(r,e,i){var l=this;if(!l._isOn||l.scale<=1)return r;l.scale>100&&(l.scale=100);var o,s,u,c,f,h,p,m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x,P,w,D,H,N,B,R,G,L,T,j,V,$,U,Q,W,J,K,Z,re,ee,te,ne,ae,ie,le,oe=r.length,se=oe>>2,ue=(e<<1)+e;for(o=~~(t(se)*l.scale*.01),s=o>>1,u=o-1,c=e*o,f=i%o,h=e%o,p=(f-1)*e,v=1/(o*o),_=1/(h*o),C=1/(f*o),M=1/(h*f),b=2*v,y=2*_,O=2*C,F=2*M,S=u,k=u*e,T=0,V=e-1,j=0,$=se-e,I=new a(3*se),X=0,q=0,E=0,z=A=Y=0,E=0;e>E;E++,X+=4,q+=3)z+=r[X],A+=r[X+1],Y+=r[X+2],I[q]=z,I[q+1]=A,I[q+2]=Y;for(q=0,E=0,z=A=Y=0,X=ue+e;oe>X;X+=4,q+=3,E++)E>=e&&(E=0,z=A=Y=0),z+=r[X],A+=r[X+1],Y+=r[X+2],I[q+ue]=I[q]+z,I[q+ue+1]=I[q+1]+A,I[q+ue+2]=I[q+2]+Y;for(E=0,x=0,P=0,B=E,R=P,G=E-s+S,L=P+k,G=G>V?V:G,L=L>$?$:L,U=B+R,J=G+L,Q=G+R,W=B+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,J=(J<<1)+J,g=b,ee=g*(I[J]-I[Q]-I[W]+I[U]),te=g*(I[J+1]-I[Q+1]-I[W+1]+I[U+1]),ne=g*(I[J+2]-I[Q+2]-I[W+2]+I[U+2]),B=E+s,G=E+S,G=G>V?V:G,U=B+R,J=G+L,Q=G+R,W=B+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,J=(J<<1)+J,ae=g*(I[J]-I[Q]-I[W]+I[U]),ie=g*(I[J+1]-I[Q+1]-I[W+1]+I[U+1]),le=g*(I[J+2]-I[Q+2]-I[W+2]+I[U+2]),n&&(ee=0>ee?0:ee>255?255:ee,te=0>te?0:te>255?255:te,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie,le=0>le?0:le>255?255:le),ee=~~ee,te=~~te,ne=~~ne,ae=~~ae,ie=~~ie,le=~~le,K=ee,Z=te,re=ne,w=0,D=0,H=0,X=0;oe>X;X+=4)N=w+E+H+P<<2,r[N]=K,r[N+1]=Z,r[N+2]=re,w++,(w+E>=e||w>=o)&&(w=0,D++,H+=e,K=ee,Z=te,re=ne),w>u-D&&(K=ae,Z=ie,re=le),(D+x>=i||D>=o)&&(E+=o,E>=e&&(E=0,x+=o,P+=c),w=0,D=0,H=0,B=E,R=P,G=E-s+S,L=P+k,G=G>V?V:G,L=L>$?$:L,U=B+R,J=G+L,Q=G+R,W=B+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,J=(J<<1)+J,m=0==G-B+s-h+1,d=0==L-R-p,g=m&&d?F:m?y:d?O:b,ee=g*(I[J]-I[Q]-I[W]+I[U]),te=g*(I[J+1]-I[Q+1]-I[W+1]+I[U+1]),ne=g*(I[J+2]-I[Q+2]-I[W+2]+I[U+2]),B=E+s,G=E+S,G=G>V?V:G,U=B+R,J=G+L,Q=G+R,W=B+L,U=(U<<1)+U,Q=(Q<<1)+Q,W=(W<<1)+W,J=(J<<1)+J,m=0==G-B+s-h+1,g=m&&d?F:m?y:d?O:b,ae=g*(I[J]-I[Q]-I[W]+I[U]),ie=g*(I[J+1]-I[Q+1]-I[W+1]+I[U+1]),le=g*(I[J+2]-I[Q+2]-I[W+2]+I[U+2]),n&&(ee=0>ee?0:ee>255?255:ee,te=0>te?0:te>255?255:te,ne=0>ne?0:ne>255?255:ne,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie,le=0>le?0:le>255?255:le),ee=~~ee,te=~~te,ne=~~ne,ae=~~ae,ie=~~ie,le=~~le,K=ee,Z=te,re=ne);return r}})}(e),!function(e){"use strict";var t=e._notSupportClamp,n=e.Color.RGB2HSV,a=.7083333333333334;e.HSVConverterFilter=e.Create({name:"HSVConverterFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var i,l,o,s,u,c,f,h,p=r.length;if(t)for(s=0;p>s;s+=4)i=r[s],l=r[s+1],o=r[s+2],u=n({r:i,g:l,b:o}),c=u.h*a,h=255*u.s,f=u.v,0>c?c=0:c>255&&(c=255),0>f?f=0:f>255&&(f=255),0>h?h=0:h>255&&(h=255),r[s]=~~c,r[s+1]=~~f,r[s+2]=~~h;else for(s=0;p>s;s+=4)i=r[s],l=r[s+1],o=r[s+2],u=n({r:i,g:l,b:o}),c=u.h*a,h=255*u.s,f=u.v,r[s]=~~c,r[s+1]=~~f,r[s+2]=~~h;return r}})}(e),!function(e){"use strict";var t=(e._notSupportClamp,e.ImArray,e.Color.clampPixel),n=e.Color.RGB2HSV,a=(e.Color.HSV2RGB,e.Color.Color2RGBA);e.HueExtractorFilter=e.Create({name:"HueExtractorFilter",range:null,background:0,init:function(r,e){var t=this;t.range=r,t.background=e||0},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{range:r.range,background:r.background}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.range=e.range,t.background=e.background),t},apply:function(r){var e=this;if(!e._isOn||!e.range||!e.range.length)return r;var i,l,o,s,u,c,f,h,p,m,d=r.length,g=e.range[0],v=e.range[e.range.length-1];for(p=a(e.background||0),s=~~t(p.r),u=~~t(p.g),c=~~t(p.b),f=~~t(p.a),h=0;d>h;h+=4)i=r[h],l=r[h+1],o=r[h+2],m=n({r:i,g:l,b:o}).h,(g>m||m>v)&&(r[h]=s,r[h+1]=u,r[h+2]=c,r[h+3]=f);return r}})}(e),!function(e){"use strict";{var t=(e._notSupportClamp,Math.min),n=Math.floor,a=e.CHANNEL.RED;e.CHANNEL.GREEN,e.CHANNEL.BLUE,e.CHANNEL.ALPHA}e.ChannelCopyFilter=e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,init:function(r,e,t,n,i){var l=this;l._srcImg=null,l.srcImg=null,l.srcChannel=e||a,l.dstChannel=t||a,l.centerX=n||0,l.centerY=i||0,r&&l.setSrc(r)},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_srcImg:r._srcImg,centerX:r.centerX,centerY:r.centerY,srcChannel:r.srcChannel,dstChannel:r.dstChannel}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t._srcImg=e._srcImg,t.centerX=e.centerX,t.centerY=e.centerY,t.srcChannel=e.srcChannel,t.dstChannel=e.dstChannel),t},setSrc:function(r){var e=this;return r&&(e.srcImg=r,e._srcImg={data:r.getData(),width:r.width,height:r.height}),e},apply:function(r,e,a){var i=this;if(!i._isOn||!i._srcImg)return r;var l,o,s,u,c,f,h=i._srcImg.data,p=r.length,m=(h.length,i._srcImg.width),d=i._srcImg.height,g=i.srcChannel,v=i.dstChannel,_=t(e,m),C=t(a,d),M=i.centerX||0,b=i.centerY||0,y=m>>1,O=d>>1;for(M=n(M*(e-1))-y,b=n(b*(a-1))-O,l=0,o=0,s=0,l=0;p>l;l+=4,o++)o>=e&&(o=0,s++),c=o-M,f=s-b,c>=0&&_>c&&f>=0&&C>f&&(u=c+f*m<<2,r[l+v]=h[u+g]);return r}})}(e),!function(e){"use strict";var t=(e._notSupportClamp,Math.min),n=Math.floor;e.AlphaMaskFilter=e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,init:function(r,e,t){var n=this;n.centerX=e||0,n.centerY=t||0,n._alphaMask=null,n.alphaMask=null,r&&n.setMask(r)},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_alphaMask:r._alphaMask,centerX:r.centerX,centerY:r.centerY}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t._alphaMask=e._alphaMask,t.centerX=e.centerX,t.centerY=e.centerY),t},setMask:function(r){var e=this;return r&&(e.alphaMask=r,e._alphaMask={data:r.getData(),width:r.width,height:r.height}),e},apply:function(r,e,a){var i=this;if(!i._isOn||!i._alphaMask)return r;var l,o,s,u,c,f,h=i._alphaMask.data,p=i._alphaMask.width,m=i._alphaMask.height,d=r.length,g=(h.length,t(e,p)),v=t(a,m),_=i.centerX||0,C=i.centerY||0,M=p>>1,b=m>>1;for(_=n(_*(e-1))-M,C=n(C*(a-1))-b,o=0,s=0,l=0;d>l;l+=4,o++)o>=e&&(o=0,s++),c=o-_,f=s-C,c>=0&&g>c&&f>=0&&v>f?(u=c+f*p<<2,r[l+3]=h[u+3]):r[l+3]=0;return r}})}(e),!function(e,t){"use strict";var n,a=Math.min,i=Math.max,l=Math.round,o=(Math.floor,Math.abs),s=e._notSupportClamp;e.BlendFilter=e.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendMode:null,blendImage:null,startX:0,startY:0,amount:1,init:function(r,e,t){var n=this;n.startX=0,n.startY=0,n.amount=1,n._blendImage=null,n.blendImage=null,n._blendMode=null,n.blendMode=null,r&&n.setImage(r),e&&n.setMode(e,t)},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_blendImage:r._blendImage,_blendMode:r._blendMode,startX:r.startX,startY:r.startY,amount:r.amount}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t._blendImage=e._blendImage,t.startX=e.startX,t.startY=e.startY,t.setMode(e._blendMode,e.amount)),t},setImage:function(r){var e=this;return r&&(e.blendImage=r,e._blendImage={data:r.getData(),width:r.width,height:r.height}),e},setMode:function(r,e){var l=this;return r?(l._blendMode=(""+r).toLowerCase(),l.blendMode=n[l._blendMode]||null,l.amount=i(0,a(1,t===e?1:e))):(l._blendMode=null,l.blendMode=null),l},reset:function(){var r=this;return r.startX=0,r.startY=0,r.amount=1,r._blendMode=null,r.blendMode=null,r},apply:function(r,e,t){var n=this;if(!n._isOn||!n.blendMode||!n._blendImage)return r;var i,o,s,u,c,f=n.startX||0,h=n.startY||0,p=0,m=0,d=n._blendImage,g=n.amount||1;return u=d.width,c=d.height,0>f&&(p=-f,f=0),0>h&&(m=-h,h=0),f>=e||h>=t?r:p>=u||m>=c?r:(f=l(f),h=l(h),p=l(p),m=l(m),i=a(e-f,u-p),o=a(t-h,c-m),0>=i||0>=o?r:(s=d.data,n.blendMode(r,e,t,s,u,c,f,h,p,m,i,o,g)))}}),n={normal:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=A,X=Y,q=S,F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},lighten:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=F>A?F:A,X=I>Y?I:Y,q=z>S?z:S,F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},darken:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=F>A?A:F,X=I>Y?Y:I,q=z>S?S:z,F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},multiply:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=F*A*.003921568627451,X=I*Y*.003921568627451,q=z*S*.003921568627451,F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},average:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=.5*(F+A),X=.5*(I+Y),q=.5*(z+S),F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},add:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=F+A,X=I+Y,q=z+S,F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},subtract:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=255>F+A?0:F+A-255,X=255>I+Y?0:I+Y-255,q=255>z+S?0:z+S-255,F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},difference:function(r,e,t,n,a,i,l,u,c,f,h,p,m){var d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x;for(x=1-m,b=l,y=u*e,O=c,F=f*a,d=l+h,g=c+h,v=0,_=p*h;_>v;)C=b+y<<2,M=O+F<<2,I=r[C],z=r[C+1],A=r[C+2],Y=n[M],S=n[M+1],k=n[M+2],X=o(Y-I),q=o(S-z),E=o(k-A),I=X*m+I*x,z=q*m+z*x,A=E*m+A*x,s&&(I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z,A=0>A?0:A>255?255:A),r[C]=~~I,r[C+1]=~~z,r[C+2]=~~A,v++,b++,b>=d&&(b=l,y+=e),O++,O>=g&&(O=c,F+=a);return r},negation:function(r,e,t,n,a,i,l,u,c,f,h,p,m){var d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x;for(x=1-m,b=l,y=u*e,O=c,F=f*a,d=l+h,g=c+h,v=0,_=p*h;_>v;)C=b+y<<2,M=O+F<<2,I=r[C],z=r[C+1],A=r[C+2],Y=n[M],S=n[M+1],k=n[M+2],X=255-o(255-Y-I),q=255-o(255-S-z),E=255-o(255-k-A),I=X*m+I*x,z=q*m+z*x,A=E*m+A*x,s&&(I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z,A=0>A?0:A>255?255:A),r[C]=~~I,r[C+1]=~~z,r[C+2]=~~A,v++,b++,b>=d&&(b=l,y+=e),O++,O>=g&&(O=c,F+=a);return r},screen:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=255-((255-A)*(255-F)>>8),X=255-((255-Y)*(255-I)>>8),q=255-((255-S)*(255-z)>>8),F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},exclusion:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=A+F-2*A*F*.003921568627451,X=Y+I-2*Y*I*.003921568627451,q=S+z-2*S*z*.003921568627451,F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},overlay:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=128>F?2*A*F*.003921568627451:255-2*(255-A)*(255-F)*.003921568627451,X=128>I?2*Y*I*.003921568627451:255-2*(255-Y)*(255-I)*.003921568627451,k=128>z?2*S*z*.003921568627451:255-2*(255-S)*(255-z)*.003921568627451,F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},softlight:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=128>F?2*((A>>1)+64)*.003921568627451*F:255-2*(255-((A>>1)+64))*(255-F)*.003921568627451,X=128>I?2*((Y>>1)+64)*.003921568627451*I:255-2*(255-((Y>>1)+64))*(255-I)*.003921568627451,q=128>z?2*((S>>1)+64)*.003921568627451*z:255-2*(255-((S>>1)+64))*(255-z)*.003921568627451,F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},hardlight:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;for(E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],k=128>A?2*F*A*.003921568627451:255-2*(255-F)*(255-A)*.003921568627451,X=128>Y?2*I*Y*.003921568627451:255-2*(255-I)*(255-Y)*.003921568627451,q=128>S?2*z*S*.003921568627451:255-2*(255-z)*(255-S)*.003921568627451,F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},colordodge:function(r,e,t,n,i,l,o,u,c,f,h,p,m){var d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x;for(x=1-m,b=o,y=u*e,O=c,F=f*i,d=o+h,g=c+h,v=0,_=p*h;_>v;)C=b+y<<2,M=O+F<<2,I=r[C],z=r[C+1],A=r[C+2],Y=n[M],S=n[M+1],k=n[M+2],X=255==I?I:a(255,(Y<<8)/(255-I)),q=255==z?z:a(255,(S<<8)/(255-z)),E=255==A?I:a(255,(k<<8)/(255-A)),I=X*m+I*x,z=q*m+z*x,A=E*m+A*x,s&&(I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z,A=0>A?0:A>255?255:A),r[C]=~~I,r[C+1]=~~z,r[C+2]=~~A,v++,b++,b>=d&&(b=o,y+=e),O++,O>=g&&(O=c,F+=i);return r},colorburn:function(r,e,t,n,a,l,o,u,c,f,h,p,m){var d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x;for(x=1-m,b=o,y=u*e,O=c,F=f*a,d=o+h,g=c+h,v=0,_=p*h;_>v;)C=b+y<<2,M=O+F<<2,I=r[C],z=r[C+1],A=r[C+2],Y=n[M],S=n[M+1],k=n[M+2],X=0==I?I:i(0,255-(255-Y<<8)/I),q=0==z?z:i(0,255-(255-S<<8)/z),E=0==A?A:i(0,255-(255-k<<8)/A),I=X*m+I*x,z=q*m+z*x,A=E*m+A*x,s&&(I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z,A=0>A?0:A>255?255:A),r[C]=~~I,r[C+1]=~~z,r[C+2]=~~A,v++,b++,b>=d&&(b=o,y+=e),O++,O>=g&&(O=c,F+=a);return r},linearlight:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;for(var x;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],128>F?(x=2*F,k=255>x+A?0:x+A-255):(x=2*(F-128),k=x+A),128>I?(x=2*I,X=255>x+Y?0:x+Y-255):(x=2*(I-128),X=x+Y),128>z?(x=2*z,q=255>x+S?0:x+S-255):(x=2*(z-128),q=x+S),F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},reflect:function(r,e,t,n,i,l,o,u,c,f,h,p,m){var d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x;for(x=1-m,b=o,y=u*e,O=c,F=f*i,d=o+h,g=c+h,v=0,_=p*h;_>v;)C=b+y<<2,M=O+F<<2,I=r[C],z=r[C+1],A=r[C+2],Y=n[M],S=n[M+1],k=n[M+2],X=255==I?I:a(255,Y*Y/(255-I)),q=255==z?z:a(255,S*S/(255-z)),E=255==A?A:a(255,k*k/(255-A)),I=X*m+I*x,z=q*m+z*x,A=E*m+A*x,s&&(I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z,A=0>A?0:A>255?255:A),r[C]=~~I,r[C+1]=~~z,r[C+2]=~~A,v++,b++,b>=d&&(b=o,y+=e),O++,O>=g&&(O=c,F+=i);return r},glow:function(r,e,t,n,i,l,o,u,c,f,h,p,m){var d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x;for(x=1-m,b=o,y=u*e,O=c,F=f*i,d=o+h,g=c+h,v=0,_=p*h;_>v;)C=b+y<<2,M=O+F<<2,I=r[C],z=r[C+1],A=r[C+2],Y=n[M],S=n[M+1],k=n[M+2],X=255==Y?Y:a(255,I*I/(255-Y)),q=255==S?S:a(255,z*z/(255-S)),E=255==k?k:a(255,A*A/(255-k)),I=X*m+I*x,z=q*m+z*x,A=E*m+A*x,s&&(I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z,A=0>A?0:A>255?255:A),r[C]=~~I,r[C+1]=~~z,r[C+2]=~~A,v++,b++,b>=d&&(b=o,y+=e),O++,O>=g&&(O=c,F+=i);return r},phoenix:function(r,e,t,n,l,o,u,c,f,h,p,m,d){var g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x,P;for(P=1-d,y=u,O=c*e,F=f,I=h*l,g=u+p,v=f+p,_=0,C=m*p;C>_;)M=y+O<<2,b=F+I<<2,z=r[M],A=r[M+1],Y=r[M+2],S=n[b],k=n[b+1],X=n[b+2],q=a(S,z)-i(S,z)+255,E=a(k,A)-i(k,A)+255,x=a(X,Y)-i(X,Y)+255,z=q*d+z*P,A=E*d+A*P,Y=x*d+Y*P,s&&(z=0>z?0:z>255?255:z,A=0>A?0:A>255?255:A,Y=0>Y?0:Y>255?255:Y),r[M]=~~z,r[M+1]=~~A,r[M+2]=~~Y,_++,y++,y>=g&&(y=u,O+=e),F++,F>=v&&(F=f,I+=l);return r},vividlight:function(r,e,t,n,l,o,u,c,f,h,p,m,d){var g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x,P;P=1-d,y=u,O=c*e,F=f,I=h*l,g=u+p,v=f+p,_=0,C=m*p;for(var w;C>_;)M=y+O<<2,b=F+I<<2,z=r[M],A=r[M+1],Y=r[M+2],S=n[b],k=n[b+1],X=n[b+2],128>z?(w=2*z,q=0==w?w:i(0,255-(255-S<<8)/w)):(w=2*(z-128),q=255==w?w:a(255,(S<<8)/(255-w))),128>A?(w=2*A,E=0==w?w:i(0,255-(255-k<<8)/w)):(w=2*(A-128),E=255==w?w:a(255,(k<<8)/(255-w))),128>Y?(w=2*Y,x=0==w?w:i(0,255-(255-X<<8)/w)):(w=2*(A-128),x=255==w?w:a(255,(X<<8)/(255-w))),z=q*d+z*P,A=E*d+A*P,Y=x*d+Y*P,s&&(z=0>z?0:z>255?255:z,A=0>A?0:A>255?255:A,Y=0>Y?0:Y>255?255:Y),r[M]=~~z,r[M+1]=~~A,r[M+2]=~~Y,_++,y++,y>=g&&(y=u,O+=e),F++,F>=v&&(F=f,I+=l);return r},pinlight:function(r,e,t,n,a,i,l,o,u,c,f,h,p){var m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E;E=1-p,M=l,b=o*e,y=u,O=c*a,m=l+f,d=u+f,g=0,v=h*f;for(var x;v>g;)_=M+b<<2,C=y+O<<2,F=r[_],I=r[_+1],z=r[_+2],A=n[C],Y=n[C+1],S=n[C+2],128>F?(x=2*F,k=x>A?x:A):(x=2*(F-128),k=x>A?A:x),128>I?(x=2*I,X=x>Y?x:Y):(x=2*(F-128),X=x>Y?Y:x),128>z?(x=2*z,q=x>S?x:S):(x=2*(z-128),q=x>S?S:x),F=k*p+F*E,I=X*p+I*E,z=q*p+z*E,s&&(F=0>F?0:F>255?255:F,I=0>I?0:I>255?255:I,z=0>z?0:z>255?255:z),r[_]=~~F,r[_+1]=~~I,r[_+2]=~~z,g++,M++,M>=m&&(M=l,b+=e),y++,y>=d&&(y=u,O+=a);return r},hardmix:function(r,e,t,n,l,o,u,c,f,h,p,m,d){var g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x,P;P=1-d,y=u,O=c*e,F=f,I=h*l,g=u+p,v=f+p,_=0,C=m*p;for(var w;C>_;)M=y+O<<2,b=F+I<<2,z=r[M],A=r[M+1],Y=r[M+2],S=n[b],k=n[b+1],X=n[b+2],128>z?(w=2*z,q=0==w?w:i(0,255-(255-S<<8)/w)):(w=2*(z-128),q=255==w?w:a(255,(S<<8)/(255-w))),q=128>q?0:255,128>A?(w=2*A,E=0==w?w:i(0,255-(255-k<<8)/w)):(w=2*(A-128),E=255==w?w:a(255,(k<<8)/(255-w))),E=128>E?0:255,128>Y?(w=2*Y,x=0==w?w:i(0,255-(255-X<<8)/w)):(w=2*(Y-128),x=255==w?w:a(255,(X<<8)/(255-w))),x=128>x?0:255,z=q*d+z*P,A=E*d+A*P,Y=x*d+Y*P,s&&(z=0>z?0:z>255?255:z,A=0>A?0:A>255?255:A,Y=0>Y?0:Y>255?255:Y),r[M]=~~z,r[M+1]=~~A,r[M+2]=~~Y,_++,y++,y>=g&&(y=u,O+=e),F++,F>=v&&(F=f,I+=l);return r}},n.lineardodge=n.add,n.linearburn=n.subtract}(e),!function(e){"use strict";var t=(e._notSupportClamp,e.Color.RGBA2Color),n=e.Color.Color2RGBA;e.ThresholdFilter=e.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(r,e){var t=this;t.thresholds=r,t.quantizedColors=e||null},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{thresholds:r.thresholds,quantizedColors:r.quantizedColors}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.thresholds=e.thresholds,t.quantizedColors=e.quantizedColors),t},apply:function(r){var e=this;if(!(e._isOn&&e.thresholds&&e.thresholds.length&&e.quantizedColors&&e.quantizedColors.length))return r;var a,i,l,o,s,u,c,f,h=r.length,p=e.thresholds,m=p.length,d=e.quantizedColors,g=d.length;for(c=0;h>c;c+=4){for(s=t({r:r[c],g:r[c+1],b:r[c+2],a:r[c+3]}),f=0;m>f&&s>p[f];)f++;s=g>f?d[f]:255,u=n(s),a=u.r,i=u.g,l=u.b,o=u.a,r[c]=a,r[c+1]=i,r[c+2]=l,r[c+3]=o}return r}})}(e),!function(e){"use strict";var t=(Math.sqrt,Math.exp,Math.log),n=Math.abs,a=Math.floor,i=e._notSupportClamp,l=e.Array32F;e.BokehFilter=e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(r,e,t,n){var a=this;a.centerX=r||0,a.centerY=e||0,a.radius=t||10,a.amount=n||10},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{centerX:r.centerX,centerY:r.centerY,radius:r.radius,amount:r.amount}}},unserialize:function(r){var e,t=this;return r&&t.name===r.filter&&(t._isOn=!!r._isOn,e=r.params,t.centerX=e.centerX,t.centerY=e.centerY,t.radius=e.radius,t.amount=e.amount),t},apply:function(r,e,o){var s=this;if(!s._isOn)return r;var u,c,f,h,p,m,d,g,v,_,C,M,b,y,O,F,I,z,A,Y,S,k,X,q,E,x,P,w,D,H,N,B,R,G=r.length,L=s.centerX||0,T=s.centerY||0,j=s.radius,V=s.amount;if(0>=V)return r;for(u=G>>2,H=0,N=e-1,B=0,R=u-e,L=a(L*(e-1)),T=a(T*(o-1)),f=(u<<1)+u,d=(e<<1)+e,c=new l(f),g=0,v=0,_=0,h=p=m=0,_=0;e>_;_++,g+=4,v+=3)h+=r[g],p+=r[g+1],m+=r[g+2],c[v]=h,c[v+1]=p,c[v+2]=m;for(g=d+e,v=0,_=0,h=p=m=0,g=d+e;G>g;g+=4,v+=3,_++)_>=e&&(_=0,h=p=m=0),h+=r[g],p+=r[g+1],m+=r[g+2],c[v+d]=c[v]+h,c[v+d+1]=c[v+1]+p,c[v+d+2]=c[v+2]+m;for(_=0,C=0,M=0,g=0;G>g;g+=4,_++)_>=e&&(_=0,C++,M+=e),y=_-L,O=C-T,b=n(y)+n(O),F=b>j?~~t((b-j)*V):~~(b/j+.5),F>0&&(I=F*e,z=.25/(F*F),A=_-F,Y=M-I,S=_+F,k=M+I,H>A?A=H:S>N&&(S=N),B>Y?Y=B:k>R&&(k=R),X=A+Y,x=S+k,q=S+Y,E=A+k,X=(X<<1)+X,q=(q<<1)+q,E=(E<<1)+E,x=(x<<1)+x,P=z*(c[x]-c[q]-c[E]+c[X]),w=z*(c[x+1]-c[q+1]-c[E+1]+c[X+1]),D=z*(c[x+2]-c[q+2]-c[E+2]+c[X+2]),i&&(P=0>P?0:P>255?255:P,w=0>w?0:w>255?255:w,D=0>D?0:D>255?255:D),r[g]=~~P,r[g+1]=~~w,r[g+2]=~~D);return r}})}(e),r.FILTER_PLUGINS});
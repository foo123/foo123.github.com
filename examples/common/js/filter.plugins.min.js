/**
*
*   FILTER.js Plugins
*   @version: 0.7
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(e,n,t,r){"use strict";function a(e,n,t,r,a){var i;return e?{file:__filename,path:__dirname}:n?{file:i=self.location.href,path:i.split("/").slice(0,-1).join("/")}:t&&a&&a.uri?{file:i=a.uri,path:i.split("/").slice(0,-1).join("/")}:r&&(i=document.getElementsByTagName("script"))&&i.length?{file:i=i[i.length-1].src,path:i.split("/").slice(0,-1).join("/")}:{file:null,path:null}}function i(e,n,t,r,a){var i,s=e.length,o=new Array(s);for(i=0;s>i;i++)o[i]=1===r?t[e[i]]||a(n[i]):2===r?a(e[i]):t[e[i]];return o}function s(e,n,t,r,a,i){var s,o,l,u,h,c,f,d=t.length;if(i){for(s=0;d>s;s++)t[s]in e||importScripts(n+r[s]);return a()}c=document.getElementsByTagName("head")[0],f=document.createElement("a"),o=/^\./,l=0,s=0,u=function(e,t){var r=0,a=document.createElement("script");a.type="text/javascript",a.language="javascript",a.onload=a.onreadystatechange=function(){r||a.readyState&&"loaded"!=a.readyState&&"complete"!=a.readyState||(r=1,a.onload=a.onreadystatechange=null,t(),c.removeChild(a),a=null)},o.test(e)&&(f.href=n+e,e=f.protocol+"//"+f.host+f.pathname+f.search+f.hash),a.src=e,c.appendChild(a)},h=function(){t[s]in e?++s>=d?a():t[s]in e?h():u(r[s],h):++l<30?setTimeout(h,30):(l=0,s++,h())};for(;d>s&&t[s]in e;)s++;d>s?u(r[s],h):a()}t=t||[[],[]];var o,l,u,h="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),c=!h&&"undefined"!=typeof navigator,f=!h&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,d="function"==typeof define&&define.amd,g=h&&"object"==typeof module&&module.exports,p=f?self:e,m=a(h,f,d,c),_=[].concat(t[0]),v=[].concat(t[1]),y=_.length,b=/\.js$/i;if(g)module.$deps=module.$deps||{},module.exports=module.$deps[n]=r.apply(e,[{NODE:module}].concat(i(_,v,module.$deps,1,require)))||1;else if(d&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)){if(!require.defined(n)){for(u={},l=0;y>l;l++)require.specified(_[l])||(u[_[l]]=v[l].replace(b,""));require.config({paths:u}),define(n,["require","exports","module"].concat(_),function(n,t,a){return r.apply(e,[{AMD:a}].concat(i(_,v,arguments,2,n)))})}}else n in p||s(p,m.path+"/",_,v,function(){o=r.apply(e,[{}].concat(i(_,v,p))),d&&define(n,["require"],function(){return o})},f)}(this,"FILTER_PLUGINS",[["FILTER"],["./filter.js"]],function(e,n){return e.FILTER_PLUGINS=n,!function(n){"use strict";var t=n._notSupportClamp,r=Math.random;n.Create({name:"NoiseFilter",min:-127,max:127,init:function(e,n){var t=this;t.min=e||-127,t.max=n||127},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{min:e.min,max:e.max}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.min=n.min,t.max=n.max),t},apply:function(e){var n=this;if(!n._isOn)return e;var a,i,s,o,l,u,h,c,f=n.max-n.min,d=n.min,g=e.length;if(t)for(a=0;g>a;a+=4)s=e[a],o=e[a+1],l=e[a+2],i=f*r()+d,u=s+i,h=o+i,c=l+i,0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>c?c=0:c>255&&(c=255),e[a]=~~u,e[a+1]=~~h,e[a+2]=~~c;else for(a=0;g>a;a+=4)s=e[a],o=e[a+1],l=e[a+2],i=f*r()+d,u=s+i,h=o+i,c=l+i,e[a]=~~u,e[a+1]=~~h,e[a+2]=~~c;return e}})}(n),!function(n){"use strict";function t(e){var n,t;for(e>0&&1>e&&(e*=65536),e=u(e),256>e&&(e|=e<<8),t=0;256>t;t++)n=1&t?h[t]^255&e:h[t]^e>>8&255,c[t]=c[t+256]=n}function r(e,n,t){var r=7&e,a=4>r?n:t,i=4>r?t:n;return(1&r?-a:a)+(2&r?-2*i:2*i)}function a(e,n){var t,a,i,s,o,l=.366025403,h=.211324865,f=(e+n)*l,d=e+f,g=n+f,p=u(d),m=u(g),_=(p+m)*h,v=p-_,y=m-_,b=e-v,M=n-y;b>M?(s=1,o=0):(s=0,o=1);var C=b-s+h,w=M-o+h,O=b-1+2*h,I=M-1+2*h,z=255&p,A=255&m,x=.5-b*b-M*M;0>x?t=0:(x*=x,t=x*x*r(c[z+c[A]],b,M));var S=.5-C*C-w*w;0>S?a=0:(S*=S,a=S*S*r(c[z+s+c[A+o]],C,w));var P=.5-O*O-I*I;return 0>P?i=0:(P*=P,i=P*P*r(c[z+1+c[A+1]],O,I)),40*(t+a+i)}function i(e){return e*e*e*(e*(6*e-15)+10)}function s(e,n,t){return n+e*(t-n)}function o(e,n){var t,a,o,l,h,f,d,g,p,m,_,v,y,b;return t=u(e),a=u(n),h=e-t,f=n-a,d=h-1,g=f-1,o=t+1&255,l=a+1&255,t=255&t,a=255&a,m=i(f),p=i(h),_=r(c[t+c[a]],h,f),v=r(c[t+c[l]],h,g),y=s(m,_,v),_=r(c[o+c[a]],d,f),v=r(c[o+c[l]],d,g),b=s(m,_,v),.507*s(p,y,b)}function l(e,n,t,r,a,i,s,o,l,u,h,c){var f,d,g,p=0,m=h,_=1,v=0,y=a>>>1,b=i>>>1;for(f=0;l>f;f++)d=(t+u[f][0])%a,g=(r+u[f][1])%i,e&&(d>y&&(d=a-1-d),g>b&&(g=i-1-g)),p+=n(d/(s/m),g/(o/m))*_,m*=2,v+=_,_*=c;return p/v}var u=Math.floor,h=(Math.sin,Math.cos,n.CONSTANTS.PI2,new n.Array8U([151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180])),c=new n.Array8U(h);n.Create({name:"PerlinNoiseFilter",_baseX:1,_baseY:1,_octaves:1,_offsets:null,_colors:null,_seed:0,_stitch:!1,_fractal:!0,_perlin:!1,init:function(e,n,t,r,a,i,s,o,l){var u=this;u._baseX=e||1,u._baseY=n||1,u.octaves(t||1,i),u.colors(s||null),u._seed=o||0,u._stitch=!!r,u._fractal=!1!==a,u._perlin=!!l},path:n.getPath(e.AMD),seed:function(e){var n=this;return t(n._seed=e||0),n},octaves:function(e,n){var t=this;for(t._octaves=e||1,t._offsets=n?n.slice(0):[];t._offsets.length<t._octaves;)t._offsets.push([0,0]);return t},colors:function(e){var n=this;return n._colors=e||null,n},seamless:function(e){return arguments.length||(e=!0),this._stitch=!!e,this},turbulence:function(e){return arguments.length||(e=!0),this._fractal=!e,this},simplex:function(){return this._perlin=!1,this},perlin:function(){return this._perlin=!0,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_baseX:e._baseX,_baseY:e._baseY,_octaves:e._octaves,_offsets:e._offsets,_colors:e._colors,_seed:e._seed,_stitch:e._stitch,_fractal:e._fractal,_perlin:e._perlin}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t._baseX=n._baseX,t._baseY=n._baseY,t._octaves=n._octaves,t._offsets=n._offsets,t._colors=n._colors,t._seed=n._seed,t._stitch=n._stitch,t._fractal=n._fractal,t._perlin=n._perlin),t},apply:function(e,n,t){var r,i,s,h,c,f,d=this,g=d._baseX,p=d._baseY,m=d._octaves,_=d._offsets,v=d._colors,y=!v||!v.length,b=d._perlin,M=(!d._fractal,!!d._stitch),C=e.length;for(f=b?o:a,i=0,s=0,r=0;C>r;r+=4,i++)i>=n&&(i=0,s++),h=.5*l(M,f,i,s,n,t,g,p,m,_,1,.5)+.5,y?e[r]=e[r+1]=e[r+2]=~~(255*h):(c=v[u(h*(v.length-1))],e[r]=c[0],e[r+1]=c[1],e[r+2]=c[2]);return e}})}(n),!function(n){"use strict";var t=n._notSupportClamp,r=n.Array32F,a=n.Color.RGB2YCbCr,i=n.Color.YCbCr2RGB;n.Create({name:"HistogramEqualizeFilter",path:n.getPath(e.AMD),apply:function(e){var n=this;if(!n._isOn)return e;var s,o,l,u,h,c,f,d,g,p,m,_=0,v=255,y=0,b=e.length,M=b>>2,C=1/M;for(h=new r(256),g=0;256>g;g+=4)h[g]=0,h[g+1]=0,h[g+2]=0,h[g+3]=0;for(g=0;b>g;g+=4)p=a(e.subarray(g,g+3)),s=e[g]=~~p[2],o=e[g+1]=~~p[0],l=e[g+2]=~~p[1],h[o]+=C,o>_?_=o:v>o&&(v=o);for(y=0,g=0;256>g;g+=4)y+=h[g],h[g]=y,y+=h[g+1],h[g+1]=y,y+=h[g+2],h[g+2]=y,y+=h[g+3],h[g+3]=y;if(u=_-v,t)for(g=0;b>g;g+=4)p=[e[g+1],e[g+2],e[g]],p[0]=h[p[0]]*u+v,m=i(p),c=m[0],f=m[1],d=m[2],c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,e[g]=~~c,e[g+1]=~~f,e[g+2]=~~d;else for(g=0;b>g;g+=4)p=[e[g+1],e[g+2],e[g]],p[0]=h[p[0]]*u+v,m=i(p),e[g]=~~m[0],e[g+1]=~~m[1],e[g+2]=~~m[2];return e}}),n.Create({name:"GrayscaleHistogramEqualizeFilter",path:n.getPath(e.AMD),apply:function(e){var n=this;if(!n._isOn)return e;var a,i,s,o,l,u=0,h=255,c=0,f=e.length,d=f>>2,g=1/d;for(o=new r(256),l=0;256>l;l+=4)o[l]=0,o[l+1]=0,o[l+2]=0,o[l+3]=0;for(l=0;f>l;l+=4)a=e[l],o[a]+=g,a>u?u=a:h>a&&(h=a);for(c=0,l=0;256>l;l+=4)c+=o[l],o[l]=c,c+=o[l+1],o[l+1]=c,c+=o[l+2],o[l+2]=c,c+=o[l+3],o[l+3]=c;if(s=u-h,t)for(l=0;f>l;l+=4)a=e[l],i=o[a]*s+h,i=0>i?0:i>255?255:i,i=~~i,e[l]=i,e[l+1]=i,e[l+2]=i;else for(l=0;f>l;l+=4)a=e[l],i=~~(o[a]*s+h),e[l]=i,e[l+1]=i,e[l+2]=i;return e}}),n.Create({name:"RGBHistogramEqualizeFilter",path:n.getPath(e.AMD),apply:function(e){var n=this;if(!n._isOn)return e;var a,i,s,o,l,u,h,c,f,d,g,p,m,_,v,y,b=0,M=0,C=0,w=255,O=255,I=255,z=e.length,A=z>>2,x=1/A;for(h=new r(256),c=new r(256),f=new r(256),y=0;256>y;y+=4)h[y]=0,c[y]=0,f[y]=0,h[y+1]=0,c[y+1]=0,f[y+1]=0,h[y+2]=0,c[y+2]=0,f[y+2]=0,h[y+3]=0,c[y+3]=0,f[y+3]=0;for(y=0;z>y;y+=4)a=e[y],i=e[y+1],s=e[y+2],h[a]+=x,c[i]+=x,f[s]+=x,a>b?b=a:w>a&&(w=a),i>M?M=i:O>i&&(O=i),s>C?C=s:I>s&&(I=s);for(d=g=p=0,y=0;256>y;y+=4)d+=h[y],h[y]=d,g+=c[y],c[y]=g,p+=f[y],f[y]=p,d+=h[y+1],h[y+1]=d,g+=c[y+1],c[y+1]=g,p+=f[y+1],f[y+1]=p,d+=h[y+2],h[y+2]=d,g+=c[y+2],c[y+2]=g,p+=f[y+2],f[y+2]=p,d+=h[y+3],h[y+3]=d,g+=c[y+3],c[y+3]=g,p+=f[y+3],f[y+3]=p;if(o=b-w,l=M-O,u=C-I,t)for(y=0;z>y;y+=4)a=e[y],i=e[y+1],s=e[y+2],m=h[a]*o+w,_=c[i]*l+O,v=f[s]*u+I,m=0>m?0:m>255?255:m,_=0>_?0:_>255?255:_,v=0>v?0:v>255?255:v,e[y]=~~m,e[y+1]=~~_,e[y+2]=~~v;else for(y=0;z>y;y+=4)a=e[y],i=e[y+1],s=e[y+2],m=h[a]*o+w,_=c[i]*l+O,v=f[s]*u+I,e[y]=~~m,e[y+1]=~~_,e[y+2]=~~v;return e}})}(n),!function(n){"use strict";var t=Math.sqrt,r=n._notSupportClamp,a=n.Array32F;n.Create({name:"PixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.scale=n.scale),t},apply:function(e,n,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,g,p,m,_,v,y,b,M,C,w,O,I,z,A,x,S,P,N,Y,k,X,F,q,D,L,R,H,E,T,B,G,j,U,W,$,V,Q,J,K,Z=e.length,en=Z>>>2,nn=(n<<1)+n;for(o=~~(t(en)*s.scale*.01),l=n*o,u=i%o,h=n%o,c=(u-1)*n,p=1/(o*o),m=1/(h*o),_=1/(u*o),v=1/(h*u),y=p,b=m,M=_,C=v,A=o-1,x=(o-1)*n,T=0,G=n-1,B=0,j=en-n,w=new a(3*en),S=0,P=0,N=0,O=I=z=0,N=0;n>N;N++,S+=4,P+=3)O+=e[S],I+=e[S+1],z+=e[S+2],w[P]=O,w[P+1]=I,w[P+2]=z;for(P=0,N=0,O=I=z=0,S=nn+n;Z>S;S+=4,P+=3,N++)N>=n&&(N=0,O=I=z=0),O+=e[S],I+=e[S+1],z+=e[S+2],w[P+nn]=w[P]+O,w[P+nn+1]=w[P+1]+I,w[P+nn+2]=w[P+2]+z;for(N=0,Y=0,k=0,L=N,R=k,H=L+A,E=R+x,H=H>G?G:H,E=E>j?j:E,U=L+R,V=H+E,W=H+R,$=L+E,U=(U<<1)+U,W=(W<<1)+W,$=($<<1)+$,V=(V<<1)+V,g=y,Q=g*(w[V]-w[W]-w[$]+w[U]),J=g*(w[V+1]-w[W+1]-w[$+1]+w[U+1]),K=g*(w[V+2]-w[W+2]-w[$+2]+w[U+2]),r&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K,X=0,F=0,q=0,S=0;Z>S;S+=4)D=X+N+q+k<<2,e[D]=Q,e[D+1]=J,e[D+2]=K,X++,(X+N>=n||X>=o)&&(X=0,F++,q+=n),(F+Y>=i||F>=o)&&(N+=o,N>=n&&(N=0,Y+=o,k+=l),X=0,F=0,q=0,L=N,R=k,H=L+A,E=R+x,H=H>G?G:H,E=E>j?j:E,U=L+R,V=H+E,W=H+R,$=L+E,U=(U<<1)+U,W=(W<<1)+W,$=($<<1)+$,V=(V<<1)+V,f=0==H-L-h+1,d=0==E-R-c,g=f&&d?C:f?b:d?M:y,Q=g*(w[V]-w[W]-w[$]+w[U]),J=g*(w[V+1]-w[W+1]-w[$+1]+w[U+1]),K=g*(w[V+2]-w[W+2]-w[$+2]+w[U+2]),r&&(Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J,K=0>K?0:K>255?255:K),Q=~~Q,J=~~J,K=~~K);return e}})}(n),!function(n){"use strict";var t=Math.sqrt,r=(Math.SQRT2,Math.min,n._notSupportClamp),a=n.Array32F;n.Create({name:"TriangularPixelateFilter",scale:1,init:function(e){var n=this;n.scale=e||1},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{scale:e.scale}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.scale=n.scale),t},apply:function(e,n,i){var s=this;if(!s._isOn||s.scale<=1)return e;s.scale>100&&(s.scale=100);var o,l,u,h,c,f,d,g,p,m,_,v,y,b,M,C,w,O,I,z,A,x,S,P,N,Y,k,X,F,q,D,L,R,H,E,T,B,G,j,U,W,$,V,Q,J,K,Z,en,nn,tn,rn,an,sn,on,ln=e.length,un=ln>>>2,hn=(n<<1)+n;for(o=~~(t(un)*s.scale*.01),l=o>>1,u=o-1,h=n*o,c=i%o,f=n%o,d=(c-1)*n,_=1/(o*o),v=1/(f*o),y=1/(c*o),b=1/(f*c),M=2*_,C=2*v,w=2*y,O=2*b,S=u,P=u*n,G=0,U=n-1,j=0,W=un-n,I=new a(3*un),N=0,Y=0,k=0,z=A=x=0,k=0;n>k;k++,N+=4,Y+=3)z+=e[N],A+=e[N+1],x+=e[N+2],I[Y]=z,I[Y+1]=A,I[Y+2]=x;for(Y=0,k=0,z=A=x=0,N=hn+n;ln>N;N+=4,Y+=3,k++)k>=n&&(k=0,z=A=x=0),z+=e[N],A+=e[N+1],x+=e[N+2],I[Y+hn]=I[Y]+z,I[Y+hn+1]=I[Y+1]+A,I[Y+hn+2]=I[Y+2]+x;for(k=0,X=0,F=0,H=k,E=F,T=k-l+S,B=F+P,T=T>U?U:T,B=B>W?W:B,$=H+E,J=T+B,V=T+E,Q=H+B,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,m=M,nn=m*(I[J]-I[V]-I[Q]+I[$]),tn=m*(I[J+1]-I[V+1]-I[Q+1]+I[$+1]),rn=m*(I[J+2]-I[V+2]-I[Q+2]+I[$+2]),H=k+l,T=k+S,T=T>U?U:T,$=H+E,J=T+B,V=T+E,Q=H+B,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,an=m*(I[J]-I[V]-I[Q]+I[$]),sn=m*(I[J+1]-I[V+1]-I[Q+1]+I[$+1]),on=m*(I[J+2]-I[V+2]-I[Q+2]+I[$+2]),r&&(nn=0>nn?0:nn>255?255:nn,tn=0>tn?0:tn>255?255:tn,rn=0>rn?0:rn>255?255:rn,an=0>an?0:an>255?255:an,sn=0>sn?0:sn>255?255:sn,on=0>on?0:on>255?255:on),nn=~~nn,tn=~~tn,rn=~~rn,an=~~an,sn=~~sn,on=~~on,K=nn,Z=tn,en=rn,q=0,D=0,L=0,N=0;ln>N;N+=4)R=q+k+L+F<<2,e[R]=K,e[R+1]=Z,e[R+2]=en,q++,(q+k>=n||q>=o)&&(q=0,D++,L+=n,K=nn,Z=tn,en=rn),q>u-D&&(K=an,Z=sn,en=on),(D+X>=i||D>=o)&&(k+=o,k>=n&&(k=0,X+=o,F+=h),q=0,D=0,L=0,H=k,E=F,T=k-l+S,B=F+P,T=T>U?U:T,B=B>W?W:B,$=H+E,J=T+B,V=T+E,Q=H+B,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,g=0==T-H+l-f+1,p=0==B-E-d,m=g&&p?O:g?C:p?w:M,nn=m*(I[J]-I[V]-I[Q]+I[$]),tn=m*(I[J+1]-I[V+1]-I[Q+1]+I[$+1]),rn=m*(I[J+2]-I[V+2]-I[Q+2]+I[$+2]),H=k+l,T=k+S,T=T>U?U:T,$=H+E,J=T+B,V=T+E,Q=H+B,$=($<<1)+$,V=(V<<1)+V,Q=(Q<<1)+Q,J=(J<<1)+J,g=0==T-H+l-f+1,m=g&&p?O:g?C:p?w:M,an=m*(I[J]-I[V]-I[Q]+I[$]),sn=m*(I[J+1]-I[V+1]-I[Q+1]+I[$+1]),on=m*(I[J+2]-I[V+2]-I[Q+2]+I[$+2]),r&&(nn=0>nn?0:nn>255?255:nn,tn=0>tn?0:tn>255?255:tn,rn=0>rn?0:rn>255?255:rn,an=0>an?0:an>255?255:an,sn=0>sn?0:sn>255?255:sn,on=0>on?0:on>255?255:on),nn=~~nn,tn=~~tn,rn=~~rn,an=~~an,sn=~~sn,on=~~on,K=nn,Z=tn,en=rn);return e}})}(n),!function(n,t){"use strict";var r=7/16,a=3/16,i=5/16,s=1/16,o=n.Array32F,l=n.Color.clamp,u=n.Color.RGB2YCbCr,h=n.Color.YCbCr2RGB;n.Create({name:"HalftoneFilter",_threshold:.4,_size:1,_grayscale:!1,init:function(e,n,r){var a=this;a._size=e||1,a._threshold=l(t===n?.4:n,0,1),a._grayscale=!!r},path:n.getPath(e.AMD),size:function(e){return this._size=e,this},threshold:function(e){return this._threshold=l(e,0,1),this},grayscale:function(e){return arguments.length||(e=!0),this._grayscale=!!e,this},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_size:e._size,_threshold:e._threshold,_grayscale:e._grayscale}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t._size=n._size,t._threshold=n._threshold,t._grayscale=n._grayscale),t},apply:function(e,n,t){var c,f,d,g,p,m,_,v,y,b,M,C,w,O,I,z,A,x=this,S=e.length,P=S>>>2,N=new o(3*P),Y=x._size,k=Y*Y,X=1/k,F=255*x._threshold,q=q<<1,D=!x._grayscale,L=Y*n,R=r,H=a,E=i,T=s;for(_=0,v=0,m=0;t>_;){for(C=w=O=0,y=0,b=0,M=0;Y>b;)c=m+v+y+M<<2,f=3*(m+v+y+M),C+=e[c]+N[f],w+=e[c+1]+N[f+1],O+=e[c+2]+N[f+2],y++,y>=Y&&(y=0,b++,M+=n);if(C*=X,w*=X,O*=X,p=D?u([C,w,O]):[C,w,O],d=p[0],d>F?D?(p[0]=l(~~d,0,255),g=h(p)):g=[255,255,255]:g=[0,0,0],c=m+v<<2,I=e[c]-g[0],z=e[c+1]-g[1],A=e[c+2]-g[2],n>m+Y)for(y=Y,b=0,M=0;Y>b;)f=3*(m+v+y+M),N[f]+=R*I,N[f+1]+=R*z,N[f+2]+=R*A,y++,y>=q&&(y=Y,b++,M+=n);if(t>_+Y&&m>Y)for(y=-Y,b=Y,M=0;q>b;)f=3*(m+v+y+M),N[f]+=H*I,N[f+1]+=H*z,N[f+2]+=H*A,y++,y>=0&&(y=-Y,b++,M+=n);if(t>_+Y)for(y=0,b=Y,M=0;q>b;)f=3*(m+v+y+M),N[f]+=E*I,N[f+1]+=E*z,N[f+2]+=E*A,y++,y>=Y&&(y=0,b++,M+=n);if(t>_+Y&&n>m+Y)for(y=Y,b=Y,M=0;q>b;)f=3*(m+v+y+M),N[f]+=T*I,N[f+1]+=T*z,N[f+2]+=T*A,y++,y>=q&&(y=Y,b++,M+=n);for(y=0,b=0,M=0;Y>b;)c=m+v+y+M<<2,e[c]=g[0],e[c+1]=g[1],e[c+2]=g[2],y++,y>=Y&&(y=0,b++,M+=n);m+=Y,m>=n&&(m=0,_+=Y,v+=L)}return e}})}(n),!function(n){"use strict";var t=(Math.sqrt,Math.exp,Math.log),r=Math.abs,a=Math.floor,i=n._notSupportClamp,s=n.Array32F;n.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(e,n,t,r){var a=this;a.centerX=e||0,a.centerY=n||0,a.radius=t||10,a.amount=r||10},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{centerX:e.centerX,centerY:e.centerY,radius:e.radius,amount:e.amount}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.centerX=n.centerX,t.centerY=n.centerY,t.radius=n.radius,t.amount=n.amount),t},apply:function(e,n,o){var l=this;if(!l._isOn)return e;var u,h,c,f,d,g,p,m,_,v,y,b,M,C,w,O,I,z,A,x,S,P,N,Y,k,X,F,q,D,L,R,H,E,T=e.length,B=l.centerX||0,G=l.centerY||0,j=l.radius,U=l.amount;if(0>=U)return e;for(u=T>>2,L=0,R=n-1,H=0,E=u-n,B=a(B*(n-1)),G=a(G*(o-1)),c=(u<<1)+u,p=(n<<1)+n,h=new s(c),m=0,_=0,v=0,f=d=g=0,v=0;n>v;v++,m+=4,_+=3)f+=e[m],d+=e[m+1],g+=e[m+2],h[_]=f,h[_+1]=d,h[_+2]=g;for(m=p+n,_=0,v=0,f=d=g=0,m=p+n;T>m;m+=4,_+=3,v++)v>=n&&(v=0,f=d=g=0),f+=e[m],d+=e[m+1],g+=e[m+2],h[_+p]=h[_]+f,h[_+p+1]=h[_+1]+d,h[_+p+2]=h[_+2]+g;for(v=0,y=0,b=0,m=0;T>m;m+=4,v++)v>=n&&(v=0,y++,b+=n),C=v-B,w=y-G,M=r(C)+r(w),O=M>j?~~t((M-j)*U):~~(M/j+.5),O>0&&(I=O*n,z=.25/(O*O),A=v-O,x=b-I,S=v+O,P=b+I,L>A?A=L:S>R&&(S=R),H>x?x=H:P>E&&(P=E),N=A+x,X=S+P,Y=S+x,k=A+P,N=(N<<1)+N,Y=(Y<<1)+Y,k=(k<<1)+k,X=(X<<1)+X,F=z*(h[X]-h[Y]-h[k]+h[N]),q=z*(h[X+1]-h[Y+1]-h[k+1]+h[N+1]),D=z*(h[X+2]-h[Y+2]-h[k+2]+h[N+2]),i&&(F=0>F?0:F>255?255:F,q=0>q?0:q>255?255:q,D=0>D?0:D>255?255:D),e[m]=~~F,e[m+1]=~~q,e[m+2]=~~D);return e}})}(n),!function(n){"use strict";n.Create({name:"SeamlessTileFilter",type:0,init:function(e){var n=this;n.type=e||0},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{type:e.type}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.type=n.type),t},apply:function(e,t,r){var a,i,s,o,l,u,h,c,f,d,g,p,m,_,v,y=this,b=y.type;for(t!==r?e=n.Image.resize(e,t,r,p=t>r?t:r,p):p=t,m=Math.round(p/2),_=p*p,v=e.length,a=new n.ImArray(v),i=new n.ImArray(v),s=new n.Array8U(_),c=0,f=0,d=0;v>d;d+=4,c++)c>=p&&(c=0,f++),g=(c+m)%p+(f+m)%p*p<<2,a[g]=e[d],a[g+1]=e[d+1],a[g+2]=e[d+2],a[g+3]=e[d+3];for(c=0;m-1>=c;c++)for(f=0;m-1>=f;f++){switch(b){case 0:h=Math.sqrt((c-m)*(c-m)+(f-m)*(f-m))/m;break;case 1:h=m-f>m-c?(f-m)/m:(c-p/2)/m;break;case 2:default:h=m-f>m-c?Math.sqrt((f-p)*(f-p)+(c-p)*(c-p))/(1.13*p):Math.sqrt((c-p)*(c-p)+(f-p)*(f-p))/(1.13*p)}h=255-255*h,1>h?h=1:h>255&&(h=255),s[c+f*p]=h,s[c+(p-1-f)*p]=h,s[p-1-c+f*p]=h,s[p-1-c+(p-1-f)*p]=h}for(f=0;p-1>=f;f++)for(c=0;p-1>=c;c++)g=c+f*p,o=s[g],l=s[(c+m)%p+(f+m)%p*p],u=o+l,o/=u,l/=u,g<<=2,i[g]=~~(o*e[g]+l*a[g]),i[g+1]=~~(o*e[g+1]+l*a[g+1]),i[g+2]=~~(o*e[g+2]+l*a[g+2]),i[g+3]=e[g+3];return t!==r&&(i=n.Image.resize(i,p,p,t,r)),i}})}(n),!function(n){"use strict";n.Create({name:"FloodFillFilter",x:0,y:0,color:null,tolerance:0,path:n.getPath(e.AMD),init:function(e,n,t,r){var a=this;a.x=e||0,a.y=n||0,a.color=t||[0,0,0],a.tolerance=r||0},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{color:e.color,x:e.x,y:e.y,tolerance:e.tolerance}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.color=n.color,t.x=n.x,t.y=n.y,t.tolerance=n.tolerance),t},apply:function(e,n){var t,r,a,i,s,o,l,u,h,c,f=this,d=~~(255*(f.tolerance>=1?.999:f.tolerance)),g=f.color,p=n<<2,m=f.x,_=f.y,v=e.length,y=0,b=v-p,M=0,C=n-1<<2,w=Math.abs;if(l=_*n<<2,m<<=2,M>m||m>C||y>l||l>b||e[m+l]===g[0]&&e[m+l+1]===g[1]&&e[m+l+2]===g[2])return e;for(t=[e[m+l],e[m+l+1],e[m+l+2]],u=[],l+p>=y&&b>=l+p&&u.push([l,m,m,p]),u.push([l+p,m,m,-p]);u.length;){for(h=u.pop(),l=h[0]+(p=h[3]),s=h[1],o=h[2],i=s;i>=M&&(a=i+l,w(t[0]-e[a])<=d&&w(t[1]-e[a+1])<=d&&w(t[2]-e[a+2])<=d);i-=4)e[a]=g[0],e[a+1]=g[1],e[a+2]=g[2];if(i>=s){for(;o>=i&&!(w(t[0]-e[i+l])<=d&&w(t[1]-e[i+l+1])<=d&&w(t[2]-e[i+l+2])<=d);)i+=4;r=i,c=o>=i}else r=i+4,s>r&&l-p>=y&&b>=l-p&&u.push([l,r,s-4,-p]),i=s+4,c=!0;for(;c;){for(a=i+l;C>=i&&w(t[0]-e[a])<=d&&w(t[1]-e[a+1])<=d&&w(t[2]-e[a+2])<=d;)e[a]=g[0],e[a+1]=g[1],e[a+2]=g[2],i+=4,a=i+l;for(l+p>=y&&b>=l+p&&u.push([l,r,i-4,p]),i>o+4&&l-p>=y&&b>=l-p&&u.push([l,o+4,i-4,-p]);o>=i&&!(w(t[0]-e[i+l])<=d&&w(t[1]-e[i+l+1])<=d&&w(t[2]-e[i+l+2])<=d);)i+=4;r=i,c=o>=i}}return e}})}(n),!function(n){"use strict";var t=n._notSupportClamp,r=n.Color.RGB2HSV,a=.7083333333333334;n.Create({name:"HSVConverterFilter",path:n.getPath(e.AMD),apply:function(e){var n=this;if(!n._isOn)return e;var i,s,o,l,u,h=e.length;if(t)for(i=0;h>i;i+=4)s=r(e.subarray(i,i+3)),o=s[0]*a,u=255*s[1],l=s[2],0>o?o=0:o>255&&(o=255),0>l?l=0:l>255&&(l=255),0>u?u=0:u>255&&(u=255),e[i]=~~o,e[i+1]=~~l,e[i+2]=~~u;else for(i=0;h>i;i+=4)s=r(e.subarray(i,i+3)),o=s[0]*a,u=255*s[1],l=s[2],e[i]=~~o,e[i+1]=~~l,e[i+2]=~~u;return e}})}(n),!function(n){"use strict";var t=(n._notSupportClamp,n.Color.RGBA2Color),r=n.Color.Color2RGBA;n.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(e,n){var t=this;t.thresholds=e,t.quantizedColors=n||null},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{thresholds:e.thresholds,quantizedColors:e.quantizedColors}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.thresholds=n.thresholds,t.quantizedColors=n.quantizedColors),t},apply:function(e){var n=this;if(!(n._isOn&&n.thresholds&&n.thresholds.length&&n.quantizedColors&&n.quantizedColors.length))return e;var a,i,s,o,l=e.length,u=n.thresholds,h=u.length,c=n.quantizedColors,f=c.length;for(s=0;l>s;s+=4){for(a=t(e.subarray[s+4]),o=0;h>o&&a>u[o];)o++;a=f>o?c[o]:255,i=r(a),e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2],e[s+3]=i[3]}return e}})}(n),!function(n){"use strict";var t=(n._notSupportClamp,n.ImArray,n.Color.clampPixel),r=n.Color.RGB2HSV,a=(n.Color.HSV2RGB,n.Color.Color2RGBA);n.Create({name:"HueExtractorFilter",range:null,background:0,init:function(e,n){var t=this;t.range=e,t.background=n||0},path:n.getPath(e.AMD),serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{range:e.range,background:e.background}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.range=n.range,t.background=n.background),t},apply:function(e){var n=this;if(!n._isOn||!n.range||!n.range.length)return e;var i,s,o,l,u,h,c,f=e.length,d=n.range[0],g=n.range[n.range.length-1];for(h=a(n.background||0),i=~~t(h[0]),s=~~t(h[1]),o=~~t(h[2]),l=~~t(h[3]),u=0;f>u;u+=4)c=r(e.subarray(u,u+3))[0],(d>c||c>g)&&(e[u]=i,e[u+1]=s,e[u+2]=o,e[u+3]=l);return e}})}(n),!function(n){"use strict";function t(e,t,r,a,i,s){var o,h,_,v,y,b=e.length,M=new u(b),C=new u(b),w=new u(b),O=new u(b),I=new u(s),z=new u(s),A=i*i,x=2*A,S=n.CONSTANTS.PI2*A;for(o=0;s>o&&(h=m(-(o*o)/x),!(c>=h&&o>=2));o++)_=m(-((y=o-.5)*y)/x),v=m(-((y=o+.5)*y)/x),I[o]=(h+_+v)/3/S,z[o]=v-_;var y,P,N,Y,k,X,F,q,D,L=o-1,R=t-(o-1),H=t*(o-1),E=t*(r-(o-1));for(y=L;R>y;y++)for(P=H;E>P;P+=t){for(N=y+P,Y=e[N]*I[0],k=Y,X=1,F=t;o>X;)k+=I[X]*(e[N-F]+e[N+F]),Y+=I[X]*(e[N-X]+e[N+X]),F+=t,X++;C[N]=k,M[N]=Y}for(y=L;R>y;y++)for(P=H;E>P;P+=t){for(q=0,N=y+P,D=1;o>D;D++)q+=z[D]*(C[N-D]-C[N+D]);w[N]=q}for(y=o;t-o>y;y++)for(P=H;E>P;P+=t){for(q=0,N=y+P,F=t,D=1;o>D;D++)q+=z[D]*(M[N-F]-M[N+F]),F+=t;O[N]=q}L=o,R=t-o,H=t*o,E=t*(r-o);var T,B,G,j,U,W,$,V,Q,J,K,Z,en,nn,tn,rn,an,sn,on,ln;for(y=L;R>y;y++)for(P=H;E>P;P+=t)N=y+P,T=N-t,B=N+t,j=N-1,G=N+1,U=T-1,W=T+1,$=B-1,V=B+1,Q=w[N],J=O[N],K=l(Q,J),en=l(w[T],O[T]),nn=l(w[B],O[B]),rn=l(w[j],O[j]),tn=l(w[G],O[G]),sn=l(w[W],O[W]),ln=l(w[V],O[V]),on=l(w[$],O[$]),an=l(w[U],O[U]),a[N]=(0>=Q*J?p(Q)>=p(J)?(Z=p(Q*K))>=p(J*sn-(Q+J)*tn)&&Z>p(J*on-(Q+J)*rn):(Z=p(J*K))>=p(Q*sn-(J+Q)*en)&&Z>p(Q*on-(J+Q)*nn):p(Q)>=Math.abs(J)?(Z=p(Q*K))>=p(J*ln+(Q-J)*tn)&&Z>p(J*an+(Q-J)*rn):(Z=p(J*K))>=p(Q*ln+(J-Q)*nn)&&Z>p(Q*an+(J-Q)*en))?K>=d?g:Math.floor(f*K):0}function r(e,n,t,r,i,s){var o,l,u,h=0,c=e.length;for(o=0;c>o;o++)e[o]=0;for(u=0,l=0,h=0;c>h;h++,u++)u>=n&&(u=0,l++),0===e[h]&&r[h]>=s&&a(e,n,t,r,u,l,h,i)}function a(e,n,t,r,i,s,o,l){var u,h,c,f=0==i?i:i-1,d=i==n-1?i:i+1,g=0==s?s:s-1,p=s==t-1?s:s+1;for(e[o]=r[o],u=f,h=g;d>=u&&p>=h;){if(c=u+h*n,(h!=s||u!=i)&&0===e[c]&&r[c]>=l)return void a(e,n,t,r,u,h,c,l);h++,h>p&&(h=g,u++)}}function i(e,t){var r,a,i,s,o,l=e.length,u=n.LUMA[0],h=n.LUMA[1],c=n.LUMA[2];for(r=0,a=0;l>r;r+=4,a++)i=e[r],s=e[r+1],o=e[r+2],t[a]=~~(u*i+h*s+c*o+.5)}function s(e){var n,t,r,a,i,s=new h(256),o=new h(256),l=e.length;for(n=0;l>n;n++)s[e[n]]++;for(t=0,r=0,n=0;256>n;n++){for(t+=s[n],i=255*t/l,a=r+1;i>=a;a++)o[a]=n;r=i}for(n=0;l>n;n++)e[n]=o[e[n]]}function o(e,n){var t,r,a,i=e.length;for(t=0,r=0;i>t;t+=4,r++)a=n[r]>0?255:0,e[t]=e[t+1]=e[t+2]=a}var l,u=n.Array32F,h=n.Array32I,c=.005,f=100,d=1e3,g=f*d,p=(n.CONSTANTS.PI2,Math.abs),m=Math.exp;l=Math.hypot?Math.hypot:function(e,n){return p(e)+p(n)},n.Create({name:"CannyEdgesFilter",low:2.5,high:7.5,gaussRadius:2,gaussWidth:16,contrastNormalized:!1,path:n.getPath(e.AMD),init:function(e,n,t,r,a){var i=this;i.low=arguments.length<1?2.5:e,i.high=arguments.length<2?7.5:n,i.gaussRadius=arguments.length<3?2:t,i.gaussWidth=arguments.length<4?16:r,i.contrastNormalized=!!a},thresholds:function(e,n){var t=this;return t.low=e,t.high=n,t},kernel:function(e,n){var t=this;return t.gaussRadius=e,t.gaussWidth=n,t},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{low:e.low,high:e.high,gaussRadius:e.gaussRadius,gaussWidth:e.gaussWidth,contrastNormalized:e.contrastNormalized}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.low=n.low,t.high=n.high,t.gaussRadius=n.gaussRadius,t.gaussWidth=n.gaussWidth,t.contrastNormalized=n.contrastNormalized),t},apply:function(e,n,a){var l,u,c,d,g=this,p=e.length>>2;return c=new h(p),d=new h(p),l=Math.round(g.low*f),u=Math.round(g.high*f),i(e,c),g.contrastNormalized&&s(c),t(c,n,a,d,g.gaussRadius,g.gaussWidth),r(c,n,a,d,l,u),o(e,c),e}})}(n),!function(n,t){"use strict";function r(e,n,t,r,a,i,s){var o,l,u,h,c,f,d,g=e.length;for(h=0,u=0,o=l=0;n>h;)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,r[h]=d,a[h]=o,i[h]=l,s[h]=d,h++,u+=4;for(c=0,f=1,h=n,u=n<<2,o=l=0;g>u;)d=4899*e[u]+9617*e[u+1]+1868*e[u+2]+8192>>>14,d&=255,o+=d,l+=d*d,r[h]=d,a[h]=a[h-n]+o,i[h]=i[h-n]+l,s[h]=s[h+1-n]+(d+r[h-n])+(f>1?s[h-n-n]:0)+(c>0?s[h-1-n]:0),c++,h++,u+=4,c>=n&&(c=0,f++,o=l=0)}function a(e,n,t,r){var a,i,s,o,l,u,h,c,g,p,m,_=e.length,v=new f(_);for(a=0;n>a;a++)v[a]=0,v[a+n]=0,v[a+_-n]=0,v[a+_-n-n]=0,r[a]=0,r[a+_-n]=0;for(i=0,s=0;t>i;i++,s+=n)v[0+s]=0,v[1+s]=0,v[n-1+s]=0,v[n-2+s]=0,r[0+s]=0,r[n-1+s]=0;for(a=2;n-2>a;a++)for(o=0,i=2,s=n<<1;t-2>i;i++,s+=n)h=a+s,c=h+n,g=c+n,p=h-n,m=p-n,o=0+(e[m-2]<<1)+(e[p-2]<<2)+(e[h-2]<<2)+e[h-2]+(e[c-2]<<2)+(e[g-2]<<1)+(e[m-1]<<2)+(e[p-1]<<3)+e[p-1]+(e[h-1]<<4)-(e[h-1]<<2)+(e[c-1]<<3)+e[c-1]+(e[g-1]<<2)+(e[m]<<2)+e[m]+(e[p]<<4)-(e[p]<<2)+(e[h]<<4)-e[h]+(e[c]<<4)-(e[c]<<2)+(e[g]<<2)+e[g]+(e[m+1]<<2)+(e[p+1]<<3)+e[p+1]+(e[h+1]<<4)-(e[h+1]<<2)+(e[c+1]<<3)+e[c+1]+(e[g+1]<<2)+(e[m+2]<<1)+(e[p+2]<<2)+(e[h+2]<<2)+e[h+2]+(e[c+2]<<2)+(e[g+2]<<1),v[h]=((103*o+8192&4294967295)>>>14&255)>>>0;for(a=1;n-1>a;a++)for(i=1,s=n;t-1>i;i++,s+=n)h=s+a,c=h+n,p=h-n,l=0-v[p-1]+v[p+1]-v[h-1]-v[h-1]+v[h+1]+v[h+1]-v[c-1]+v[c+1],u=0+v[p-1]+v[p]+v[p]+v[p+1]-v[c-1]-v[c]-v[c]-v[c+1],r[h]=d(l)+d(u);for(a=0,o=0;n>a;)o+=r[a],r[a]=o,a++;for(a=n,s=0,o=0;_>a;)o+=r[a],r[a]=r[a-n]+o,a++,s++,s>=n&&(s=0,o=0);return r}function i(e,n){var t=.2*g(n.width,e.width),r=.2*g(n.height,e.height);return!!(d(e.x-n.x)<=t&&d(e.y-n.y)<=r&&d(e.width-n.width)<=t&&d(e.height-n.height)<=r)}function s(e,n){e.x+=n.x,e.y+=n.y,e.width+=n.width,e.height+=n.height}function o(e,n){return!!(e.x>=n.x&&e.y>=n.y&&e.x+e.width<=n.x+n.width&&e.y+e.height<=n.y+n.height)}function l(e){e.x=~~(e.x+.5),e.y=~~(e.y+.5),e.width=~~(e.width+.5),e.height=~~(e.height+.5)}function u(e,n){return n.area-e.area}function h(e,n){var t,r,a,h,c,f,d,g=e.length,p=new Array(g),m=[],_=0,v=!1;for(a=0;g>a;a++)p[a]=0;for(a=0;g>a;a++){for(v=!1,h=0;a>h;h++)i(e[h],e[a])&&(v=!0,p[a]=p[h]);v||(p[a]=_,_++)}for(t=new Array(_),r=new Array(_),a=0;_>a;a++)t[a]=0,r[a]={x:0,y:0,width:0,height:0};for(a=0;g>a;a++)d=p[a],t[d]++,s(r[d],e[a]);for(a=0;_>a;a++)c=t[a],c>=n&&(f=1/(c+c),d={x:f*(2*r[a].x+c),y:f*(2*r[a].y+c),width:f*(2*r[a].width+c),height:f*(2*r[a].height+c)},m.push(d));for(g=m.length,a=0;g>a;a++)for(h=a+1;g>h;h++)!m[a].inside&&o(m[a],m[h])?m[a].inside=!0:!m[h].inside&&o(m[h],m[a])&&(m[h].inside=!0);for(a=g;--a>=0;)m[a].inside?m.splice(a,1):(l(m[a]),m[a].area=m[a].width*m[a].height);return m.sort(u)}var c=n.Array32F,f=n.Array8U,d=Math.abs,g=Math.max,p=Math.min,m=(Math.floor,Math.round,Math.sqrt),_="hasOwnProperty";n.Create({name:"HaarDetectorFilter",_update:!1,hasMeta:!0,haardata:null,objects:null,baseScale:1,scaleIncrement:1.25,stepIncrement:.5,minNeighbors:1,doCannyPruning:!0,cannyLow:20,cannyHigh:100,_haarchanged:!1,init:function(e,n,r,a,i,s){var o=this;o.objects=null,o.haardata=e||null,o.baseScale=t===n?1:n,o.scaleIncrement=t===r?1.25:r,o.stepIncrement=t===a?.5:a,o.minNeighbors=t===i?1:i,o.doCannyPruning=t===s?!0:!!s,o._haarchanged=!!o.haardata},path:n.getPath(e.AMD),dispose:function(){var e=this;return e.objects=null,e.haardata=null,e.$super("dispose"),e},haar:function(e){var n=this;return n.haardata=e,n._haarchanged=!0,n},params:function(e){var n=this;return e&&(e[_]("baseScale")&&(n.baseScale=e.baseScale),e[_]("scaleIncrement")&&(n.scaleIncrement=e.scaleIncrement),e[_]("stepIncrement")&&(n.stepIncrement=e.stepIncrement),e[_]("minNeighbors")&&(n.minNeighbors=e.minNeighbors),e[_]("doCannyPruning")&&(n.doCannyPruning=e.doCannyPruning),e[_]("cannyLow")&&(n.cannyLow=e.cannyLow),e[_]("cannyHigh")&&(n.cannyHigh=e.cannyHigh)),n},serialize:function(){var e=this,n={filter:e.name,_isOn:!!e._isOn,params:{baseScale:e.baseScale,scaleIncrement:e.scaleIncrement,stepIncrement:e.stepIncrement,minNeighbors:e.minNeighbors,doCannyPruning:e.doCannyPruning,cannyLow:e.cannyLow,cannyHigh:e.cannyHigh}};return e._haarchanged&&(n.params.haardata=e.haardata,e._haarchanged=!1),n},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,n[_]("haardata")&&(t.haardata=n.haardata),t.baseScale=n.baseScale,t.scaleIncrement=n.scaleIncrement,t.stepIncrement=n.stepIncrement,t.minNeighbors=n.minNeighbors,t.doCannyPruning=n.doCannyPruning,t.cannyLow=n.cannyLow,t.cannyHigh=n.cannyHigh),t},getMeta:function(){return this.objects},setMeta:function(e){return this.objects=e,this},apply:function(e,n,t){var i,s,o,l,u,d,g,_,v,y,b,M,C,w,O,I,z,A,x,S,P,N,Y,k,X,F,q,D,L,R,H,E,T,B,G,j,U,W,$,k,V,Q,J,K,Z,en,nn,tn,rn,an,sn,on,ln,un,hn,cn,fn,dn,gn,pn=this,mn=e.length>>>2,_n=pn.haardata,vn=_n.stages,yn=pn.baseScale,bn=pn.scaleIncrement,Mn=pn.stepIncrement,Cn=pn.minNeighbors,wn=pn.doCannyPruning,On=pn.cannyLow,In=pn.cannyHigh,zn=_n.size1,An=_n.size2,xn=p(n/zn,t/An),Sn=[],Pn=mn-1,Nn=0,Yn=0,kn=vn.length;for(r(e,n,t,s=new f(mn),o=new c(mn),l=new c(mn),u=new c(mn)),wn&&a(s,n,t,d=new c(mn)),X=0,F=n-1,q=0,D=mn-n,i=yn;xn>=i;){for(v=~~(i*zn),g=~~(v*Mn),y=~~(i*An),_=~~(y*Mn),O=y*n,I=_*n,b=Yn*I,P=n-v,N=t-y,L=v*y,R=1/L,C=Yn,w=b;N>C;C+=_,w+=I)for(M=Nn;P>M;M+=g)if(z=M-1+w-n,A=z+v,x=z+O,S=x+v,z=0>z?0:z>Pn?Pn:z,A=0>A?0:A>Pn?Pn:A,x=0>x?0:x>Pn?Pn:x,S=0>S?0:S>Pn?Pn:S,!(wn&&(B=R*(d[S]-d[x]-d[A]+d[z]),On>B||B>In))){for(H=R*(o[S]-o[x]-o[A]+o[z]),E=R*(l[S]-l[x]-l[A]+l[z]),T=E-H*H,T=T>1?m(T):1,G=!0,Y=0;kn>Y;Y++){for(j=vn[Y],U=j.thres,W=j.trees,$=W.length,gn=0,k=0;$>k;k++)for(J=W[k].feats,V=0;;){if(K=J[V],Z=K.rects,en=Z.length,nn=K.thres,tn=0,K.tilt)for(rn=0;en>rn;rn++)an=Z[rn],sn=M+~~(i*an[0]),on=(C-1+~~(i*an[1]))*n,ln=M+~~(i*(an[0]+an[2])),un=(C-1+~~(i*(an[1]+an[2])))*n,hn=M+~~(i*(an[0]-an[3])),cn=(C-1+~~(i*(an[1]+an[3])))*n,fn=M+~~(i*(an[0]+an[2]-an[3])),dn=(C-1+~~(i*(an[1]+an[2]+an[3])))*n,sn=X>sn?X:sn>F?F:sn,ln=X>ln?X:ln>F?F:ln,hn=X>hn?X:hn>F?F:hn,fn=X>fn?X:fn>F?F:fn,on=q>on?q:on>D?D:on,un=q>un?q:un>D?D:un,cn=q>cn?q:cn>D?D:cn,dn=q>dn?q:dn>D?D:dn,tn+=an[4]*(u[fn+dn]-u[hn+cn]-u[ln+un]+u[sn+on]);
else for(rn=0;en>rn;rn++)an=Z[rn],sn=M-1+~~(i*an[0]),ln=M-1+~~(i*(an[0]+an[2])),on=n*(C-1+~~(i*an[1])),un=n*(C-1+~~(i*(an[1]+an[3]))),sn=X>sn?X:sn>F?F:sn,ln=X>ln?X:ln>F?F:ln,on=q>on?q:on>D?D:on,un=q>un?q:un>D?D:un,tn+=an[4]*(o[ln+un]-o[sn+un]-o[ln+on]+o[sn+on]);if(Q=nn*T>tn*R?0:1){if(K.has_r){gn+=K.r_val;break}V=K.r_node}else{if(K.has_l){gn+=K.l_val;break}V=K.l_node}}if(G=gn>U,!G)break}G&&Sn.push({x:M,y:C,width:v,height:y})}i*=bn}return pn.objects=h(Sn,Cn),e}})}(n),!function(n){"use strict";{var t=(n._notSupportClamp,Math.min),r=Math.floor,a=n.CHANNEL.RED;n.CHANNEL.GREEN,n.CHANNEL.BLUE,n.CHANNEL.ALPHA}n.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,path:n.getPath(e.AMD),init:function(e,n,t,r,i){var s=this;s._srcImg=null,s.srcImg=null,s.srcChannel=n||a,s.dstChannel=t||a,s.centerX=r||0,s.centerY=i||0,e&&s.setSrc(e)},dispose:function(){var e=this;return e.srcImg=null,e._srcImg=null,e.$super("dispose"),e},setSrc:function(e){var n=this;return e?(n.srcImg=e,n._srcImg={data:e.getData(),width:e.width,height:e.height}):(n.srcImg=null,n._srcImg=null),n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_srcImg:e._srcImg,centerX:e.centerX,centerY:e.centerY,srcChannel:e.srcChannel,dstChannel:e.dstChannel}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t._srcImg=n._srcImg,t.centerX=n.centerX,t.centerY=n.centerY,t.srcChannel=n.srcChannel,t.dstChannel=n.dstChannel),t},apply:function(e,n,a){var i=this;if(!i._isOn||!i._srcImg)return e;var s,o,l,u,h,c,f=i._srcImg.data,d=e.length,g=(f.length,i._srcImg.width),p=i._srcImg.height,m=i.srcChannel,_=i.dstChannel,v=t(n,g),y=t(a,p),b=i.centerX||0,M=i.centerY||0,C=g>>1,w=p>>1;for(b=r(b*(n-1))-C,M=r(M*(a-1))-w,s=0,o=0,l=0,s=0;d>s;s+=4,o++)o>=n&&(o=0,l++),h=o-b,c=l-M,h>=0&&v>h&&c>=0&&y>c&&(u=h+c*g<<2,e[s+_]=f[u+m]);return e}})}(n),!function(n){"use strict";var t=(n._notSupportClamp,Math.min),r=Math.floor;n.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,path:n.getPath(e.AMD),init:function(e,n,t){var r=this;r.centerX=n||0,r.centerY=t||0,r._alphaMask=null,r.alphaMask=null,e&&r.setMask(e)},dispose:function(){var e=this;return e.alphaMask=null,e._alphaMask=null,e.$super("dispose"),e},setMask:function(e){var n=this;return e?(n.alphaMask=e,n._alphaMask={data:e.getData(),width:e.width,height:e.height}):(n.alphaMask=null,n._alphaMask=null),n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_alphaMask:e._alphaMask,centerX:e.centerX,centerY:e.centerY}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t._alphaMask=n._alphaMask,t.centerX=n.centerX,t.centerY=n.centerY),t},apply:function(e,n,a){var i=this;if(!i._isOn||!i._alphaMask)return e;var s,o,l,u,h,c,f=i._alphaMask.data,d=i._alphaMask.width,g=i._alphaMask.height,p=e.length,m=(f.length,t(n,d)),_=t(a,g),v=i.centerX||0,y=i.centerY||0,b=d>>1,M=g>>1;for(v=r(v*(n-1))-b,y=r(y*(a-1))-M,o=0,l=0,s=0;p>s;s+=4,o++)o>=n&&(o=0,l++),h=o-v,c=l-y,h>=0&&m>h&&c>=0&&_>c?(u=h+c*d<<2,e[s+3]=f[u+3]):e[s+3]=0;return e}})}(n),!function(n){"use strict";var t,r="hasOwnProperty",a=Math.min,i=Math.max,s=Math.round,o=(Math.floor,Math.abs),l=n._notSupportClamp;t={normal:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=d,i=g,s=p,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},lighten:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=h>d?h:d,i=c>g?c:g,s=f>p?f:p,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},darken:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=h>d?d:h,i=c>g?g:c,s=f>p?p:f,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},multiply:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=h*d*.003921568627451,i=c*g*.003921568627451,s=f*p*.003921568627451,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},average:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=.5*(h+d),i=.5*(c+g),s=.5*(f+p),h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},add:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=h+d,i=c+g,s=f+p,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},subtract:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=255>h+d?0:h+d-255,i=255>c+g?0:c+g-255,s=255>f+p?0:f+p-255,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},difference:function(e,n,t,r){var a,i,s,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];a=o(g-c),i=o(p-f),s=o(m-d),c=a*u+c*h,f=i*u+f*h,d=s*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},negation:function(e,n,t,r){var a,i,s,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];a=255-o(255-g-c),i=255-o(255-p-f),s=255-o(255-m-d),c=a*u+c*h,f=i*u+f*h,d=s*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},screen:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=255-((255-d)*(255-h)>>8),i=255-((255-g)*(255-c)>>8),s=255-((255-p)*(255-f)>>8),h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},exclusion:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=d+h-2*d*h*.003921568627451,i=g+c-2*g*c*.003921568627451,s=p+f-2*p*f*.003921568627451,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},overlay:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=128>h?2*d*h*.003921568627451:255-2*(255-d)*(255-h)*.003921568627451,i=128>c?2*g*c*.003921568627451:255-2*(255-g)*(255-c)*.003921568627451,a=128>f?2*p*f*.003921568627451:255-2*(255-p)*(255-f)*.003921568627451,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},softlight:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=128>h?2*((d>>1)+64)*.003921568627451*h:255-2*(255-((d>>1)+64))*(255-h)*.003921568627451,i=128>c?2*((g>>1)+64)*.003921568627451*c:255-2*(255-((g>>1)+64))*(255-c)*.003921568627451,s=128>f?2*((p>>1)+64)*.003921568627451*f:255-2*(255-((p>>1)+64))*(255-f)*.003921568627451,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},hardlight:function(e,n,t,r){var a,i,s,o=.003921568627451*t[r+3],u=1-o,h=e[n],c=e[n+1],f=e[n+2],d=t[r],g=t[r+1],p=t[r+2];a=128>d?2*h*d*.003921568627451:255-2*(255-h)*(255-d)*.003921568627451,i=128>g?2*c*g*.003921568627451:255-2*(255-c)*(255-g)*.003921568627451,s=128>p?2*f*p*.003921568627451:255-2*(255-f)*(255-p)*.003921568627451,h=a*o+h*u,c=i*o+c*u,f=s*o+f*u,l&&(h=0>h?0:h>255?255:h,c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f),e[n]=~~h,e[n+1]=~~c,e[n+2]=~~f},colordodge:function(e,n,t,r){var i,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];i=255==c?c:a(255,(g<<8)/(255-c)),s=255==f?f:a(255,(p<<8)/(255-f)),o=255==d?c:a(255,(m<<8)/(255-d)),c=i*u+c*h,f=s*u+f*h,d=o*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},colorburn:function(e,n,t,r){var a,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];a=0==c?c:i(0,255-(255-g<<8)/c),s=0==f?f:i(0,255-(255-p<<8)/f),o=0==d?d:i(0,255-(255-m<<8)/d),c=a*u+c*h,f=s*u+f*h,d=o*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},linearlight:function(e,n,t,r){var a,i,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];128>c?(o=2*c,a=255>o+g?0:o+g-255):(o=2*(c-128),a=o+g),128>f?(o=2*f,i=255>o+p?0:o+p-255):(o=2*(f-128),i=o+p),128>d?(o=2*d,s=255>o+m?0:o+m-255):(o=2*(d-128),s=o+m),c=a*u+c*h,f=i*u+f*h,d=s*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},reflect:function(e,n,t,r){var i,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];i=255==c?c:a(255,g*g/(255-c)),s=255==f?f:a(255,p*p/(255-f)),o=255==d?d:a(255,m*m/(255-d)),c=i*u+c*h,f=s*u+f*h,d=o*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},glow:function(e,n,t,r){var i,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];i=255==g?g:a(255,c*c/(255-g)),s=255==p?p:a(255,f*f/(255-p)),o=255==m?m:a(255,d*d/(255-m)),c=i*u+c*h,f=s*u+f*h,d=o*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},phoenix:function(e,n,t,r){var s,o,u,h=.003921568627451*t[r+3],c=1-h,f=e[n],d=e[n+1],g=e[n+2],p=t[r],m=t[r+1],_=t[r+2];s=a(p,f)-i(p,f)+255,o=a(m,d)-i(m,d)+255,u=a(_,g)-i(_,g)+255,f=s*h+f*c,d=o*h+d*c,g=u*h+g*c,l&&(f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g),e[n]=~~f,e[n+1]=~~d,e[n+2]=~~g},vividlight:function(e,n,t,r){var s,o,u,h,c=.003921568627451*t[r+3],f=1-c,d=e[n],g=e[n+1],p=e[n+2],m=t[r],_=t[r+1],v=t[r+2];128>d?(h=2*d,s=0==h?h:i(0,255-(255-m<<8)/h)):(h=2*(d-128),s=255==h?h:a(255,(m<<8)/(255-h))),128>g?(h=2*g,o=0==h?h:i(0,255-(255-_<<8)/h)):(h=2*(g-128),o=255==h?h:a(255,(_<<8)/(255-h))),128>p?(h=2*p,u=0==h?h:i(0,255-(255-v<<8)/h)):(h=2*(g-128),u=255==h?h:a(255,(v<<8)/(255-h))),d=s*c+d*f,g=o*c+g*f,p=u*c+p*f,l&&(d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,p=0>p?0:p>255?255:p),e[n]=~~d,e[n+1]=~~g,e[n+2]=~~p},pinlight:function(e,n,t,r){var a,i,s,o,u=.003921568627451*t[r+3],h=1-u,c=e[n],f=e[n+1],d=e[n+2],g=t[r],p=t[r+1],m=t[r+2];128>c?(o=2*c,a=o>g?o:g):(o=2*(c-128),a=o>g?g:o),128>f?(o=2*f,i=o>p?o:p):(o=2*(c-128),i=o>p?p:o),128>d?(o=2*d,s=o>m?o:m):(o=2*(d-128),s=o>m?m:o),c=a*u+c*h,f=i*u+f*h,d=s*u+d*h,l&&(c=0>c?0:c>255?255:c,f=0>f?0:f>255?255:f,d=0>d?0:d>255?255:d),e[n]=~~c,e[n+1]=~~f,e[n+2]=~~d},hardmix:function(e,n,t,r){var s,o,u,h,c=.003921568627451*t[r+3],f=1-c,d=e[n],g=e[n+1],p=e[n+2],m=t[r],_=t[r+1],v=t[r+2];128>d?(h=2*d,s=0==h?h:i(0,255-(255-m<<8)/h)):(h=2*(d-128),s=255==h?h:a(255,(m<<8)/(255-h))),s=128>s?0:255,128>g?(h=2*g,o=0==h?h:i(0,255-(255-_<<8)/h)):(h=2*(g-128),o=255==h?h:a(255,(_<<8)/(255-h))),o=128>o?0:255,128>p?(h=2*p,u=0==h?h:i(0,255-(255-v<<8)/h)):(h=2*(p-128),u=255==h?h:a(255,(v<<8)/(255-h))),u=128>u?0:255,d=s*c+d*f,g=o*c+g*f,p=u*c+p*f,l&&(d=0>d?0:d>255?255:d,g=0>g?0:g>255?255:g,p=0>p?0:p>255?255:p),e[n]=~~d,e[n+1]=~~g,e[n+2]=~~p}},t.lineardodge=t.add,t.linearburn=t.subtract,n.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendImage:null,startX:0,startY:0,path:n.getPath(e.AMD),init:function(e,n){var t=this;t.startX=0,t.startY=0,t._blendImage=null,t.blendImage=null,t._blendMode=null,e&&t.setImage(e),n&&t.setMode(n)},dispose:function(){var e=this;return e.blendImage=null,e._blendImage=null,e._blendMode=null,e.$super("dispose"),e},setImage:function(e){var n=this;return e?(n.blendImage=e,n._blendImage={data:e.getData(),width:e.width,height:e.height}):(n.blendImage=null,n._blendImage=null),n},setMode:function(e){var n=this;return e?(n._blendMode=(""+e).toLowerCase(),t[r](n._blendMode)||(n._blendMode=null)):n._blendMode=null,n},serialize:function(){var e=this;return{filter:e.name,_isOn:!!e._isOn,params:{_blendImage:e._blendImage,_blendMode:e._blendMode,startX:e.startX,startY:e.startY}}},unserialize:function(e){var n,t=this;return e&&t.name===e.filter&&(t._isOn=!!e._isOn,n=e.params,t.startX=n.startX,t.startY=n.startY,t._blendImage=n._blendImage,t.setMode(n._blendMode)),t},reset:function(){var e=this;return e.startX=0,e.startY=0,e._blendMode=null,e},apply:function(e,n,r){var i=this;if(!i._isOn||!i._blendMode||!i._blendImage)return e;var o,l,u,h,c,f,d,g,p,m,_,v,y,b,M=i.startX||0,C=i.startY||0,w=0,O=0,I=i._blendImage,z=t[i._blendMode];if(0>M&&(w=-M,M=0),0>C&&(O=-C,C=0),h=I.width,c=I.height,M>=n||C>=r)return e;if(w>=h||O>=c)return e;if(M=s(M),C=s(C),w=s(w),O=s(O),o=a(n-M,h-w),l=a(r-C,c-O),0>=o||0>=l)return e;for(u=I.data,m=M,_=C*n,v=w,y=O*h,f=M+o,d=w+o,g=0,p=l*o;p>g;)b=v+y<<2,u[b+3]&&z(e,m+_<<2,u,b),g++,m++,m>=f&&(m=M,_+=n),v++,v>=d&&(v=w,y+=h);return e}})}(n),e.FILTER_PLUGINS});
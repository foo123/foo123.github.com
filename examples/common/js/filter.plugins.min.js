/**
*
*   FILTER.js Plugins
*   @version: 0.7-alpha2
*   @dependencies: Filter.js
*
*   JavaScript Image Processing Library (Plugins)
*   https://github.com/foo123/FILTER.js
*
**/!function(r,e,n,t){"use strict";function a(r,e,n,t,a){var i;return r?{file:__filename,path:__dirname}:e?{file:i=self.location.href,path:i.split("/").slice(0,-1).join("/")}:n&&a&&a.uri?{file:i=a.uri,path:i.split("/").slice(0,-1).join("/")}:t&&(i=document.getElementsByTagName("script"))&&i.length?{file:i=i[i.length-1].src,path:i.split("/").slice(0,-1).join("/")}:{file:null,path:null}}function i(r,e,n,t,a){var i,o=r.length,s=new Array(o);for(i=0;o>i;i++)s[i]=1===t?n[r[i]]||a(e[i]):2===t?a(r[i]):n[r[i]];return s}function o(r,e,n,t,a,i){var o,s,l,u,h,f,c,d=n.length;if(i){for(o=0;d>o;o++)n[o]in r||importScripts(e+t[o]);return a()}f=document.getElementsByTagName("head")[0],c=document.createElement("a"),s=/^\./,l=0,o=0,u=function(r,n){var t=0,a=document.createElement("script");a.type="text/javascript",a.language="javascript",a.onload=a.onreadystatechange=function(){t||a.readyState&&"loaded"!=a.readyState&&"complete"!=a.readyState||(t=1,a.onload=a.onreadystatechange=null,n(),f.removeChild(a),a=null)},s.test(r)&&(c.href=e+r,r=c.protocol+"//"+c.host+c.pathname+c.search+c.hash),a.src=r,f.appendChild(a)},h=function(){n[o]in r?++o>=d?a():n[o]in r?h():u(t[o],h):++l<30?setTimeout(h,30):(l=0,o++,h())};for(;d>o&&n[o]in r;)o++;d>o?u(t[o],h):a()}n=n||[[],[]];var s,l,u,h="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),f=!h&&"undefined"!=typeof navigator,c=!h&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,d="function"==typeof define&&define.amd,p=h&&"object"==typeof module&&module.exports,m=c?self:r,g=a(h,c,d,f),v=[].concat(n[0]),_=[].concat(n[1]),M=v.length,b=/\.js$/i;if(p)module.$deps=module.$deps||{},module.exports=module.$deps[e]=t.apply(r,[{NODE:module}].concat(i(v,_,module.$deps,1,require)))||1;else if(d&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)){if(!require.defined(e)){for(u={},l=0;M>l;l++)require.specified(v[l])||(u[v[l]]=_[l].replace(b,""));require.config({paths:u}),define(e,["require","exports","module"].concat(v),function(e,n,a){return t.apply(r,[{AMD:a}].concat(i(v,_,arguments,2,e)))})}}else e in m||o(m,g.path+"/",v,_,function(){m[e]=s=t.apply(r,[{}].concat(i(v,_,m)))||1,d&&define(e,["require"],function(){return s})},c)}(this,"FILTER_PLUGINS",[["FILTER"],["./filter.js"]],function(r,e){return r.FILTER_PLUGINS=e,!function(e){"use strict";var n=e._notSupportClamp,t=Math.random;e.Create({name:"NoiseFilter",min:-127,max:127,init:function(r,e){var n=this;n.min=r||-127,n.max=e||127},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{min:r.min,max:r.max}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.min=e.min,n.max=e.max),n},apply:function(r){var e=this;if(!e._isOn)return r;var a,i,o,s,l,u,h,f,c=e.max-e.min,d=e.min,p=r.length;if(n)for(a=0;p>a;a+=4)o=r[a],s=r[a+1],l=r[a+2],i=c*t()+d,u=o+i,h=s+i,f=l+i,0>u?u=0:u>255&&(u=255),0>h?h=0:h>255&&(h=255),0>f?f=0:f>255&&(f=255),r[a]=~~u,r[a+1]=~~h,r[a+2]=~~f;else for(a=0;p>a;a+=4)o=r[a],s=r[a+1],l=r[a+2],i=c*t()+d,u=o+i,h=s+i,f=l+i,r[a]=~~u,r[a+1]=~~h,r[a+2]=~~f;return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Array32F,a=e.Color.RGB2YCbCr,i=e.Color.YCbCr2RGB;e.Create({name:"HistogramEqualizeFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var o,s,l,u,h,f,c,d,p,m,g,v=0,_=255,M=0,b=r.length,C=b>>2,y=1/C;for(h=new t(256),p=0;256>p;p+=4)h[p]=0,h[p+1]=0,h[p+2]=0,h[p+3]=0;for(p=0;b>p;p+=4)o=r[p],s=r[p+1],l=r[p+2],m=a({r:o,g:s,b:l}),o=r[p]=~~m.cr,s=r[p+1]=~~m.y,l=r[p+2]=~~m.cb,h[s]+=y,s>v?v=s:_>s&&(_=s);for(M=0,p=0;256>p;p+=4)M+=h[p],h[p]=M,M+=h[p+1],h[p+1]=M,M+=h[p+2],h[p+2]=M,M+=h[p+3],h[p+3]=M;if(u=v-_,n)for(p=0;b>p;p+=4)m={cr:r[p],y:r[p+1],cb:r[p+2]},m.y=h[m.y]*u+_,g=i(m),f=g.r,c=g.g,d=g.b,f=0>f?0:f>255?255:f,c=0>c?0:c>255?255:c,d=0>d?0:d>255?255:d,r[p]=~~f,r[p+1]=~~c,r[p+2]=~~d;else for(p=0;b>p;p+=4)m={cr:r[p],y:r[p+1],cb:r[p+2]},m.y=h[m.y]*u+_,g=i(m),r[p]=~~g.r,r[p+1]=~~g.g,r[p+2]=~~g.b;return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Array32F;e.Create({name:"GrayscaleHistogramEqualizeFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var a,i,o,s,l,u=0,h=255,f=0,c=r.length,d=c>>2,p=1/d;for(s=new t(256),l=0;256>l;l+=4)s[l]=0,s[l+1]=0,s[l+2]=0,s[l+3]=0;for(l=0;c>l;l+=4)a=r[l],s[a]+=p,a>u?u=a:h>a&&(h=a);for(f=0,l=0;256>l;l+=4)f+=s[l],s[l]=f,f+=s[l+1],s[l+1]=f,f+=s[l+2],s[l+2]=f,f+=s[l+3],s[l+3]=f;if(o=u-h,n)for(l=0;c>l;l+=4)a=r[l],i=s[a]*o+h,i=0>i?0:i>255?255:i,i=~~i,r[l]=i,r[l+1]=i,r[l+2]=i;else for(l=0;c>l;l+=4)a=r[l],i=~~(s[a]*o+h),r[l]=i,r[l+1]=i,r[l+2]=i;return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Array32F;e.Create({name:"RGBHistogramEqualizeFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var a,i,o,s,l,u,h,f,c,d,p,m,g,v,_,M,b=0,C=0,y=0,O=255,w=255,z=255,Y=r.length,X=Y>>2,A=1/X;for(h=new t(256),f=new t(256),c=new t(256),M=0;256>M;M+=4)h[M]=0,f[M]=0,c[M]=0,h[M+1]=0,f[M+1]=0,c[M+1]=0,h[M+2]=0,f[M+2]=0,c[M+2]=0,h[M+3]=0,f[M+3]=0,c[M+3]=0;for(M=0;Y>M;M+=4)a=r[M],i=r[M+1],o=r[M+2],h[a]+=A,f[i]+=A,c[o]+=A,a>b?b=a:O>a&&(O=a),i>C?C=i:w>i&&(w=i),o>y?y=o:z>o&&(z=o);for(d=p=m=0,M=0;256>M;M+=4)d+=h[M],h[M]=d,p+=f[M],f[M]=p,m+=c[M],c[M]=m,d+=h[M+1],h[M+1]=d,p+=f[M+1],f[M+1]=p,m+=c[M+1],c[M+1]=m,d+=h[M+2],h[M+2]=d,p+=f[M+2],f[M+2]=p,m+=c[M+2],c[M+2]=m,d+=h[M+3],h[M+3]=d,p+=f[M+3],f[M+3]=p,m+=c[M+3],c[M+3]=m;if(s=b-O,l=C-w,u=y-z,n)for(M=0;Y>M;M+=4)a=r[M],i=r[M+1],o=r[M+2],g=h[a]*s+O,v=f[i]*l+w,_=c[o]*u+z,g=0>g?0:g>255?255:g,v=0>v?0:v>255?255:v,_=0>_?0:_>255?255:_,r[M]=~~g,r[M+1]=~~v,r[M+2]=~~_;else for(M=0;Y>M;M+=4)a=r[M],i=r[M+1],o=r[M+2],g=h[a]*s+O,v=f[i]*l+w,_=c[o]*u+z,r[M]=~~g,r[M+1]=~~v,r[M+2]=~~_;return r}})}(e),!function(e){"use strict";var n=Math.sqrt,t=e._notSupportClamp,a=e.Array32F;e.Create({name:"PixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.scale=e.scale),n},apply:function(r,e,i){var o=this;if(!o._isOn||o.scale<=1)return r;o.scale>100&&(o.scale=100);var s,l,u,h,f,c,d,p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N,P,T,R,D,E,B,G,K,L,H,j,W,$,U,V,Q,J,Z=r.length,re=Z>>2,ee=(e<<1)+e;for(s=~~(n(re)*o.scale*.01),l=e*s,u=i%s,h=e%s,f=(u-1)*e,m=1/(s*s),g=1/(h*s),v=1/(u*s),_=1/(h*u),M=m,b=g,C=v,y=_,X=s-1,A=(s-1)*e,G=0,L=e-1,K=0,H=re-e,O=new a(3*re),I=0,x=0,F=0,w=z=Y=0,F=0;e>F;F++,I+=4,x+=3)w+=r[I],z+=r[I+1],Y+=r[I+2],O[x]=w,O[x+1]=z,O[x+2]=Y;for(x=0,F=0,w=z=Y=0,I=ee+e;Z>I;I+=4,x+=3,F++)F>=e&&(F=0,w=z=Y=0),w+=r[I],z+=r[I+1],Y+=r[I+2],O[x+ee]=O[x]+w,O[x+ee+1]=O[x+1]+z,O[x+ee+2]=O[x+2]+Y;for(F=0,S=0,k=0,R=F,D=k,E=R+X,B=D+A,E=E>L?L:E,B=B>H?H:B,j=R+D,U=E+B,W=E+D,$=R+B,j=(j<<1)+j,W=(W<<1)+W,$=($<<1)+$,U=(U<<1)+U,p=M,V=p*(O[U]-O[W]-O[$]+O[j]),Q=p*(O[U+1]-O[W+1]-O[$+1]+O[j+1]),J=p*(O[U+2]-O[W+2]-O[$+2]+O[j+2]),t&&(V=0>V?0:V>255?255:V,Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J),V=~~V,Q=~~Q,J=~~J,q=0,N=0,P=0,I=0;Z>I;I+=4)T=q+F+P+k<<2,r[T]=V,r[T+1]=Q,r[T+2]=J,q++,(q+F>=e||q>=s)&&(q=0,N++,P+=e),(N+S>=i||N>=s)&&(F+=s,F>=e&&(F=0,S+=s,k+=l),q=0,N=0,P=0,R=F,D=k,E=R+X,B=D+A,E=E>L?L:E,B=B>H?H:B,j=R+D,U=E+B,W=E+D,$=R+B,j=(j<<1)+j,W=(W<<1)+W,$=($<<1)+$,U=(U<<1)+U,c=0==E-R-h+1,d=0==B-D-f,p=c&&d?y:c?b:d?C:M,V=p*(O[U]-O[W]-O[$]+O[j]),Q=p*(O[U+1]-O[W+1]-O[$+1]+O[j+1]),J=p*(O[U+2]-O[W+2]-O[$+2]+O[j+2]),t&&(V=0>V?0:V>255?255:V,Q=0>Q?0:Q>255?255:Q,J=0>J?0:J>255?255:J),V=~~V,Q=~~Q,J=~~J);return r}})}(e),!function(e){"use strict";var n=Math.sqrt,t=(Math.SQRT2,Math.min,e._notSupportClamp),a=e.Array32F;e.Create({name:"TriangularPixelateFilter",scale:1,init:function(r){var e=this;e.scale=r||1},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{scale:r.scale}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.scale=e.scale),n},apply:function(r,e,i){var o=this;if(!o._isOn||o.scale<=1)return r;o.scale>100&&(o.scale=100);var s,l,u,h,f,c,d,p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N,P,T,R,D,E,B,G,K,L,H,j,W,$,U,V,Q,J,Z,re,ee,ne,te,ae,ie,oe,se=r.length,le=se>>2,ue=(e<<1)+e;for(s=~~(n(le)*o.scale*.01),l=s>>1,u=s-1,h=e*s,f=i%s,c=e%s,d=(f-1)*e,v=1/(s*s),_=1/(c*s),M=1/(f*s),b=1/(c*f),C=2*v,y=2*_,O=2*M,w=2*b,I=u,x=u*e,L=0,j=e-1,H=0,W=le-e,z=new a(3*le),F=0,S=0,k=0,Y=X=A=0,k=0;e>k;k++,F+=4,S+=3)Y+=r[F],X+=r[F+1],A+=r[F+2],z[S]=Y,z[S+1]=X,z[S+2]=A;for(S=0,k=0,Y=X=A=0,F=ue+e;se>F;F+=4,S+=3,k++)k>=e&&(k=0,Y=X=A=0),Y+=r[F],X+=r[F+1],A+=r[F+2],z[S+ue]=z[S]+Y,z[S+ue+1]=z[S+1]+X,z[S+ue+2]=z[S+2]+A;for(k=0,q=0,N=0,E=k,B=N,G=k-l+I,K=N+x,G=G>j?j:G,K=K>W?W:K,$=E+B,Q=G+K,U=G+B,V=E+K,$=($<<1)+$,U=(U<<1)+U,V=(V<<1)+V,Q=(Q<<1)+Q,g=C,ee=g*(z[Q]-z[U]-z[V]+z[$]),ne=g*(z[Q+1]-z[U+1]-z[V+1]+z[$+1]),te=g*(z[Q+2]-z[U+2]-z[V+2]+z[$+2]),E=k+l,G=k+I,G=G>j?j:G,$=E+B,Q=G+K,U=G+B,V=E+K,$=($<<1)+$,U=(U<<1)+U,V=(V<<1)+V,Q=(Q<<1)+Q,ae=g*(z[Q]-z[U]-z[V]+z[$]),ie=g*(z[Q+1]-z[U+1]-z[V+1]+z[$+1]),oe=g*(z[Q+2]-z[U+2]-z[V+2]+z[$+2]),t&&(ee=0>ee?0:ee>255?255:ee,ne=0>ne?0:ne>255?255:ne,te=0>te?0:te>255?255:te,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie,oe=0>oe?0:oe>255?255:oe),ee=~~ee,ne=~~ne,te=~~te,ae=~~ae,ie=~~ie,oe=~~oe,J=ee,Z=ne,re=te,P=0,T=0,R=0,F=0;se>F;F+=4)D=P+k+R+N<<2,r[D]=J,r[D+1]=Z,r[D+2]=re,P++,(P+k>=e||P>=s)&&(P=0,T++,R+=e,J=ee,Z=ne,re=te),P>u-T&&(J=ae,Z=ie,re=oe),(T+q>=i||T>=s)&&(k+=s,k>=e&&(k=0,q+=s,N+=h),P=0,T=0,R=0,E=k,B=N,G=k-l+I,K=N+x,G=G>j?j:G,K=K>W?W:K,$=E+B,Q=G+K,U=G+B,V=E+K,$=($<<1)+$,U=(U<<1)+U,V=(V<<1)+V,Q=(Q<<1)+Q,p=0==G-E+l-c+1,m=0==K-B-d,g=p&&m?w:p?y:m?O:C,ee=g*(z[Q]-z[U]-z[V]+z[$]),ne=g*(z[Q+1]-z[U+1]-z[V+1]+z[$+1]),te=g*(z[Q+2]-z[U+2]-z[V+2]+z[$+2]),E=k+l,G=k+I,G=G>j?j:G,$=E+B,Q=G+K,U=G+B,V=E+K,$=($<<1)+$,U=(U<<1)+U,V=(V<<1)+V,Q=(Q<<1)+Q,p=0==G-E+l-c+1,g=p&&m?w:p?y:m?O:C,ae=g*(z[Q]-z[U]-z[V]+z[$]),ie=g*(z[Q+1]-z[U+1]-z[V+1]+z[$+1]),oe=g*(z[Q+2]-z[U+2]-z[V+2]+z[$+2]),t&&(ee=0>ee?0:ee>255?255:ee,ne=0>ne?0:ne>255?255:ne,te=0>te?0:te>255?255:te,ae=0>ae?0:ae>255?255:ae,ie=0>ie?0:ie>255?255:ie,oe=0>oe?0:oe>255?255:oe),ee=~~ee,ne=~~ne,te=~~te,ae=~~ae,ie=~~ie,oe=~~oe,J=ee,Z=ne,re=te);return r}})}(e),!function(e){"use strict";var n=e._notSupportClamp,t=e.Color.RGB2HSV,a=.7083333333333334;e.Create({name:"HSVConverterFilter",path:e.getPath(r.AMD),apply:function(r){var e=this;if(!e._isOn)return r;var i,o,s,l,u,h,f,c,d=r.length;if(n)for(l=0;d>l;l+=4)i=r[l],o=r[l+1],s=r[l+2],u=t({r:i,g:o,b:s}),h=u.h*a,c=255*u.s,f=u.v,0>h?h=0:h>255&&(h=255),0>f?f=0:f>255&&(f=255),0>c?c=0:c>255&&(c=255),r[l]=~~h,r[l+1]=~~f,r[l+2]=~~c;else for(l=0;d>l;l+=4)i=r[l],o=r[l+1],s=r[l+2],u=t({r:i,g:o,b:s}),h=u.h*a,c=255*u.s,f=u.v,r[l]=~~h,r[l+1]=~~f,r[l+2]=~~c;return r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,e.ImArray,e.Color.clampPixel),t=e.Color.RGB2HSV,a=(e.Color.HSV2RGB,e.Color.Color2RGBA);e.Create({name:"HueExtractorFilter",range:null,background:0,init:function(r,e){var n=this;n.range=r,n.background=e||0},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{range:r.range,background:r.background}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.range=e.range,n.background=e.background),n},apply:function(r){var e=this;if(!e._isOn||!e.range||!e.range.length)return r;var i,o,s,l,u,h,f,c,d,p,m=r.length,g=e.range[0],v=e.range[e.range.length-1];for(d=a(e.background||0),l=~~n(d.r),u=~~n(d.g),h=~~n(d.b),f=~~n(d.a),c=0;m>c;c+=4)i=r[c],o=r[c+1],s=r[c+2],p=t({r:i,g:o,b:s}).h,(g>p||p>v)&&(r[c]=l,r[c+1]=u,r[c+2]=h,r[c+3]=f);return r}})}(e),!function(e){"use strict";{var n=(e._notSupportClamp,Math.min),t=Math.floor,a=e.CHANNEL.RED;e.CHANNEL.GREEN,e.CHANNEL.BLUE,e.CHANNEL.ALPHA}e.Create({name:"ChannelCopyFilter",_srcImg:null,srcImg:null,centerX:0,centerY:0,srcChannel:0,dstChannel:0,init:function(r,e,n,t,i){var o=this;o._srcImg=null,o.srcImg=null,o.srcChannel=e||a,o.dstChannel=n||a,o.centerX=t||0,o.centerY=i||0,r&&o.setSrc(r)},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_srcImg:r._srcImg,centerX:r.centerX,centerY:r.centerY,srcChannel:r.srcChannel,dstChannel:r.dstChannel}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n._srcImg=e._srcImg,n.centerX=e.centerX,n.centerY=e.centerY,n.srcChannel=e.srcChannel,n.dstChannel=e.dstChannel),n},setSrc:function(r){var e=this;return r&&(e.srcImg=r,e._srcImg={data:r.getData(),width:r.width,height:r.height}),e},apply:function(r,e,a){var i=this;if(!i._isOn||!i._srcImg)return r;var o,s,l,u,h,f,c=i._srcImg.data,d=r.length,p=(c.length,i._srcImg.width),m=i._srcImg.height,g=i.srcChannel,v=i.dstChannel,_=n(e,p),M=n(a,m),b=i.centerX||0,C=i.centerY||0,y=p>>1,O=m>>1;for(b=t(b*(e-1))-y,C=t(C*(a-1))-O,o=0,s=0,l=0,o=0;d>o;o+=4,s++)s>=e&&(s=0,l++),h=s-b,f=l-C,h>=0&&_>h&&f>=0&&M>f&&(u=h+f*p<<2,r[o+v]=c[u+g]);return r}})}(e),!function(e){"use strict";var n=(e._notSupportClamp,Math.min),t=Math.floor;e.Create({name:"AlphaMaskFilter",_alphaMask:null,alphaMask:null,centerX:0,centerY:0,init:function(r,e,n){var t=this;t.centerX=e||0,t.centerY=n||0,t._alphaMask=null,t.alphaMask=null,r&&t.setMask(r)},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_alphaMask:r._alphaMask,centerX:r.centerX,centerY:r.centerY}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n._alphaMask=e._alphaMask,n.centerX=e.centerX,n.centerY=e.centerY),n},setMask:function(r){var e=this;return r&&(e.alphaMask=r,e._alphaMask={data:r.getData(),width:r.width,height:r.height}),e},apply:function(r,e,a){var i=this;if(!i._isOn||!i._alphaMask)return r;var o,s,l,u,h,f,c=i._alphaMask.data,d=i._alphaMask.width,p=i._alphaMask.height,m=r.length,g=(c.length,n(e,d)),v=n(a,p),_=i.centerX||0,M=i.centerY||0,b=d>>1,C=p>>1;for(_=t(_*(e-1))-b,M=t(M*(a-1))-C,s=0,l=0,o=0;m>o;o+=4,s++)s>=e&&(s=0,l++),h=s-_,f=l-M,h>=0&&g>h&&f>=0&&v>f?(u=h+f*d<<2,r[o+3]=c[u+3]):r[o+3]=0;return r}})}(e),!function(e,n){"use strict";var t,a=Math.min,i=Math.max,o=Math.round,s=(Math.floor,Math.abs),l=e._notSupportClamp;e.Create({name:"BlendFilter",_blendMode:null,_blendImage:null,blendMode:null,blendImage:null,startX:0,startY:0,amount:1,init:function(r,e,n){var t=this;t.startX=0,t.startY=0,t.amount=1,t._blendImage=null,t.blendImage=null,t._blendMode=null,t.blendMode=null,r&&t.setImage(r),e&&t.setMode(e,n)},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{_blendImage:r._blendImage,_blendMode:r._blendMode,startX:r.startX,startY:r.startY,amount:r.amount}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n._blendImage=e._blendImage,n.startX=e.startX,n.startY=e.startY,n.setMode(e._blendMode,e.amount)),n},setImage:function(r){var e=this;return r&&(e.blendImage=r,e._blendImage={data:r.getData(),width:r.width,height:r.height}),e},setMode:function(r,e){var o=this;return r?(o._blendMode=(""+r).toLowerCase(),o.blendMode=t[o._blendMode]||null,o.amount=i(0,a(1,n===e?1:e))):(o._blendMode=null,o.blendMode=null),o},reset:function(){var r=this;return r.startX=0,r.startY=0,r.amount=1,r._blendMode=null,r.blendMode=null,r},apply:function(r,e,n){var t=this;if(!t._isOn||!t.blendMode||!t._blendImage)return r;var i,s,l,u,h,f=t.startX||0,c=t.startY||0,d=0,p=0,m=t._blendImage,g=t.amount||1;return u=m.width,h=m.height,0>f&&(d=-f,f=0),0>c&&(p=-c,c=0),f>=e||c>=n?r:d>=u||p>=h?r:(f=o(f),c=o(c),d=o(d),p=o(p),i=a(e-f,u-d),s=a(n-c,h-p),0>=i||0>=s?r:(l=m.data,t.blendMode(r,e,n,l,u,h,f,c,d,p,i,s,g)))}}),t={normal:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=X,F=A,S=I,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},lighten:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=w>X?w:X,F=z>A?z:A,S=Y>I?Y:I,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},darken:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=w>X?X:w,F=z>A?A:z,S=Y>I?I:Y,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},multiply:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=w*X*.003921568627451,F=z*A*.003921568627451,S=Y*I*.003921568627451,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},average:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=.5*(w+X),F=.5*(z+A),S=.5*(Y+I),w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},add:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=w+X,F=z+A,S=Y+I,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},subtract:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=255>w+X?0:w+X-255,F=255>z+A?0:z+A-255,S=255>Y+I?0:Y+I-255,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},difference:function(r,e,n,t,a,i,o,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=o,y=u*e,O=h,w=f*a,m=o+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=s(A-z),S=s(I-Y),k=s(x-X),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=o,y+=e),O++,O>=g&&(O=h,w+=a);return r},negation:function(r,e,n,t,a,i,o,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=o,y=u*e,O=h,w=f*a,m=o+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=255-s(255-A-z),S=255-s(255-I-Y),k=255-s(255-x-X),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=o,y+=e),O++,O>=g&&(O=h,w+=a);return r},screen:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=255-((255-X)*(255-w)>>8),F=255-((255-A)*(255-z)>>8),S=255-((255-I)*(255-Y)>>8),w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},exclusion:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=X+w-2*X*w*.003921568627451,F=A+z-2*A*z*.003921568627451,S=I+Y-2*I*Y*.003921568627451,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},overlay:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=128>w?2*X*w*.003921568627451:255-2*(255-X)*(255-w)*.003921568627451,F=128>z?2*A*z*.003921568627451:255-2*(255-A)*(255-z)*.003921568627451,x=128>Y?2*I*Y*.003921568627451:255-2*(255-I)*(255-Y)*.003921568627451,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},softlight:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=128>w?2*((X>>1)+64)*.003921568627451*w:255-2*(255-((X>>1)+64))*(255-w)*.003921568627451,F=128>z?2*((A>>1)+64)*.003921568627451*z:255-2*(255-((A>>1)+64))*(255-z)*.003921568627451,S=128>Y?2*((I>>1)+64)*.003921568627451*Y:255-2*(255-((I>>1)+64))*(255-Y)*.003921568627451,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},hardlight:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;for(k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],x=128>X?2*w*X*.003921568627451:255-2*(255-w)*(255-X)*.003921568627451,F=128>A?2*z*A*.003921568627451:255-2*(255-z)*(255-A)*.003921568627451,S=128>I?2*Y*I*.003921568627451:255-2*(255-Y)*(255-I)*.003921568627451,w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},colordodge:function(r,e,n,t,i,o,s,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=s,y=u*e,O=h,w=f*i,m=s+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=255==z?z:a(255,(A<<8)/(255-z)),S=255==Y?Y:a(255,(I<<8)/(255-Y)),k=255==X?z:a(255,(x<<8)/(255-X)),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=s,y+=e),O++,O>=g&&(O=h,w+=i);return r},colorburn:function(r,e,n,t,a,o,s,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=s,y=u*e,O=h,w=f*a,m=s+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=0==z?z:i(0,255-(255-A<<8)/z),S=0==Y?Y:i(0,255-(255-I<<8)/Y),k=0==X?X:i(0,255-(255-x<<8)/X),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=s,y+=e),O++,O>=g&&(O=h,w+=a);return r},linearlight:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;for(var q;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],128>w?(q=2*w,x=255>q+X?0:q+X-255):(q=2*(w-128),x=q+X),128>z?(q=2*z,F=255>q+A?0:q+A-255):(q=2*(z-128),F=q+A),128>Y?(q=2*Y,S=255>q+I?0:q+I-255):(q=2*(Y-128),S=q+I),w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},reflect:function(r,e,n,t,i,o,s,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=s,y=u*e,O=h,w=f*i,m=s+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=255==z?z:a(255,A*A/(255-z)),S=255==Y?Y:a(255,I*I/(255-Y)),k=255==X?X:a(255,x*x/(255-X)),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=s,y+=e),O++,O>=g&&(O=h,w+=i);return r},glow:function(r,e,n,t,i,o,s,u,h,f,c,d,p){var m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q;for(q=1-p,C=s,y=u*e,O=h,w=f*i,m=s+c,g=h+c,v=0,_=d*c;_>v;)M=C+y<<2,b=O+w<<2,z=r[M],Y=r[M+1],X=r[M+2],A=t[b],I=t[b+1],x=t[b+2],F=255==A?A:a(255,z*z/(255-A)),S=255==I?I:a(255,Y*Y/(255-I)),k=255==x?x:a(255,X*X/(255-x)),z=F*p+z*q,Y=S*p+Y*q,X=k*p+X*q,l&&(z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X),r[M]=~~z,r[M+1]=~~Y,r[M+2]=~~X,v++,C++,C>=m&&(C=s,y+=e),O++,O>=g&&(O=h,w+=i);return r},phoenix:function(r,e,n,t,o,s,u,h,f,c,d,p,m){var g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N;for(N=1-m,y=u,O=h*e,w=f,z=c*o,g=u+d,v=f+d,_=0,M=p*d;M>_;)b=y+O<<2,C=w+z<<2,Y=r[b],X=r[b+1],A=r[b+2],I=t[C],x=t[C+1],F=t[C+2],S=a(I,Y)-i(I,Y)+255,k=a(x,X)-i(x,X)+255,q=a(F,A)-i(F,A)+255,Y=S*m+Y*N,X=k*m+X*N,A=q*m+A*N,l&&(Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X,A=0>A?0:A>255?255:A),r[b]=~~Y,r[b+1]=~~X,r[b+2]=~~A,_++,y++,y>=g&&(y=u,O+=e),w++,w>=v&&(w=f,z+=o);return r},vividlight:function(r,e,n,t,o,s,u,h,f,c,d,p,m){var g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N;N=1-m,y=u,O=h*e,w=f,z=c*o,g=u+d,v=f+d,_=0,M=p*d;for(var P;M>_;)b=y+O<<2,C=w+z<<2,Y=r[b],X=r[b+1],A=r[b+2],I=t[C],x=t[C+1],F=t[C+2],128>Y?(P=2*Y,S=0==P?P:i(0,255-(255-I<<8)/P)):(P=2*(Y-128),S=255==P?P:a(255,(I<<8)/(255-P))),128>X?(P=2*X,k=0==P?P:i(0,255-(255-x<<8)/P)):(P=2*(X-128),k=255==P?P:a(255,(x<<8)/(255-P))),128>A?(P=2*A,q=0==P?P:i(0,255-(255-F<<8)/P)):(P=2*(X-128),q=255==P?P:a(255,(F<<8)/(255-P))),Y=S*m+Y*N,X=k*m+X*N,A=q*m+A*N,l&&(Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X,A=0>A?0:A>255?255:A),r[b]=~~Y,r[b+1]=~~X,r[b+2]=~~A,_++,y++,y>=g&&(y=u,O+=e),w++,w>=v&&(w=f,z+=o);return r},pinlight:function(r,e,n,t,a,i,o,s,u,h,f,c,d){var p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k;k=1-d,b=o,C=s*e,y=u,O=h*a,p=o+f,m=u+f,g=0,v=c*f;for(var q;v>g;)_=b+C<<2,M=y+O<<2,w=r[_],z=r[_+1],Y=r[_+2],X=t[M],A=t[M+1],I=t[M+2],128>w?(q=2*w,x=q>X?q:X):(q=2*(w-128),x=q>X?X:q),128>z?(q=2*z,F=q>A?q:A):(q=2*(w-128),F=q>A?A:q),128>Y?(q=2*Y,S=q>I?q:I):(q=2*(Y-128),S=q>I?I:q),w=x*d+w*k,z=F*d+z*k,Y=S*d+Y*k,l&&(w=0>w?0:w>255?255:w,z=0>z?0:z>255?255:z,Y=0>Y?0:Y>255?255:Y),r[_]=~~w,r[_+1]=~~z,r[_+2]=~~Y,g++,b++,b>=p&&(b=o,C+=e),y++,y>=m&&(y=u,O+=a);return r},hardmix:function(r,e,n,t,o,s,u,h,f,c,d,p,m){var g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N;N=1-m,y=u,O=h*e,w=f,z=c*o,g=u+d,v=f+d,_=0,M=p*d;for(var P;M>_;)b=y+O<<2,C=w+z<<2,Y=r[b],X=r[b+1],A=r[b+2],I=t[C],x=t[C+1],F=t[C+2],128>Y?(P=2*Y,S=0==P?P:i(0,255-(255-I<<8)/P)):(P=2*(Y-128),S=255==P?P:a(255,(I<<8)/(255-P))),S=128>S?0:255,128>X?(P=2*X,k=0==P?P:i(0,255-(255-x<<8)/P)):(P=2*(X-128),k=255==P?P:a(255,(x<<8)/(255-P))),k=128>k?0:255,128>A?(P=2*A,q=0==P?P:i(0,255-(255-F<<8)/P)):(P=2*(A-128),q=255==P?P:a(255,(F<<8)/(255-P))),q=128>q?0:255,Y=S*m+Y*N,X=k*m+X*N,A=q*m+A*N,l&&(Y=0>Y?0:Y>255?255:Y,X=0>X?0:X>255?255:X,A=0>A?0:A>255?255:A),r[b]=~~Y,r[b+1]=~~X,r[b+2]=~~A,_++,y++,y>=g&&(y=u,O+=e),w++,w>=v&&(w=f,z+=o);return r}},t.lineardodge=t.add,t.linearburn=t.subtract}(e),!function(e){"use strict";var n=(e._notSupportClamp,e.Color.RGBA2Color),t=e.Color.Color2RGBA;e.Create({name:"ThresholdFilter",thresholds:null,quantizedColors:null,init:function(r,e){var n=this;n.thresholds=r,n.quantizedColors=e||null},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{thresholds:r.thresholds,quantizedColors:r.quantizedColors}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.thresholds=e.thresholds,n.quantizedColors=e.quantizedColors),n},apply:function(r){var e=this;if(!(e._isOn&&e.thresholds&&e.thresholds.length&&e.quantizedColors&&e.quantizedColors.length))return r;var a,i,o,s,l,u,h,f,c=r.length,d=e.thresholds,p=d.length,m=e.quantizedColors,g=m.length;for(h=0;c>h;h+=4){for(l=n({r:r[h],g:r[h+1],b:r[h+2],a:r[h+3]}),f=0;p>f&&l>d[f];)f++;l=g>f?m[f]:255,u=t(l),a=u.r,i=u.g,o=u.b,s=u.a,r[h]=a,r[h+1]=i,r[h+2]=o,r[h+3]=s}return r}})}(e),!function(e){"use strict";var n=(Math.sqrt,Math.exp,Math.log),t=Math.abs,a=Math.floor,i=e._notSupportClamp,o=e.Array32F;e.Create({name:"BokehFilter",centerX:0,centerY:0,radius:10,amount:10,init:function(r,e,n,t){var a=this;a.centerX=r||0,a.centerY=e||0,a.radius=n||10,a.amount=t||10},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{centerX:r.centerX,centerY:r.centerY,radius:r.radius,amount:r.amount}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.centerX=e.centerX,n.centerY=e.centerY,n.radius=e.radius,n.amount=e.amount),n},apply:function(r,e,s){var l=this;if(!l._isOn)return r;var u,h,f,c,d,p,m,g,v,_,M,b,C,y,O,w,z,Y,X,A,I,x,F,S,k,q,N,P,T,R,D,E,B,G=r.length,K=l.centerX||0,L=l.centerY||0,H=l.radius,j=l.amount;if(0>=j)return r;for(u=G>>2,R=0,D=e-1,E=0,B=u-e,K=a(K*(e-1)),L=a(L*(s-1)),f=(u<<1)+u,m=(e<<1)+e,h=new o(f),g=0,v=0,_=0,c=d=p=0,_=0;e>_;_++,g+=4,v+=3)c+=r[g],d+=r[g+1],p+=r[g+2],h[v]=c,h[v+1]=d,h[v+2]=p;for(g=m+e,v=0,_=0,c=d=p=0,g=m+e;G>g;g+=4,v+=3,_++)_>=e&&(_=0,c=d=p=0),c+=r[g],d+=r[g+1],p+=r[g+2],h[v+m]=h[v]+c,h[v+m+1]=h[v+1]+d,h[v+m+2]=h[v+2]+p;for(_=0,M=0,b=0,g=0;G>g;g+=4,_++)_>=e&&(_=0,M++,b+=e),y=_-K,O=M-L,C=t(y)+t(O),w=C>H?~~n((C-H)*j):~~(C/H+.5),w>0&&(z=w*e,Y=.25/(w*w),X=_-w,A=b-z,I=_+w,x=b+z,R>X?X=R:I>D&&(I=D),E>A?A=E:x>B&&(x=B),F=X+A,q=I+x,S=I+A,k=X+x,F=(F<<1)+F,S=(S<<1)+S,k=(k<<1)+k,q=(q<<1)+q,N=Y*(h[q]-h[S]-h[k]+h[F]),P=Y*(h[q+1]-h[S+1]-h[k+1]+h[F+1]),T=Y*(h[q+2]-h[S+2]-h[k+2]+h[F+2]),i&&(N=0>N?0:N>255?255:N,P=0>P?0:P>255?255:P,T=0>T?0:T>255?255:T),r[g]=~~N,r[g+1]=~~P,r[g+2]=~~T);return r}})}(e),!function(e){"use strict";e.Create({name:"FloodFillFilter",x:0,y:0,color:null,tolerance:0,path:e.getPath(r.AMD),init:function(r,e,n,t){var a=this;a.x=r||0,a.y=e||0,a.color=n||[0,0,0],a.tolerance=t||0},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{color:r.color,x:r.x,y:r.y,tolerance:r.tolerance}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.color=e.color,n.x=e.x,n.y=e.y,n.tolerance=e.tolerance),n},apply:function(r,e){var n,t,a,i,o,s,l,u,h,f,c=this,d=~~(255*(c.tolerance>=1?.999:c.tolerance)),p=c.color,m=e<<2,g=c.x,v=c.y,_=r.length,M=0,b=_-m,C=0,y=e-1<<2,O=Math.abs;if(l=v*e<<2,g<<=2,C>g||g>y||M>l||l>b||r[g+l]===p[0]&&r[g+l+1]===p[1]&&r[g+l+2]===p[2])return r;for(n=[r[g+l],r[g+l+1],r[g+l+2]],u=[],l+m>=M&&b>=l+m&&u.push([l,g,g,m]),u.push([l+m,g,g,-m]);u.length;){for(h=u.pop(),l=h[0]+(m=h[3]),o=h[1],s=h[2],i=o;i>=C&&(a=i+l,O(n[0]-r[a])<=d&&O(n[1]-r[a+1])<=d&&O(n[2]-r[a+2])<=d);i-=4)r[a]=p[0],r[a+1]=p[1],r[a+2]=p[2];if(i>=o){for(;s>=i&&!(O(n[0]-r[i+l])<=d&&O(n[1]-r[i+l+1])<=d&&O(n[2]-r[i+l+2])<=d);)i+=4;t=i,f=s>=i}else t=i+4,o>t&&l-m>=M&&b>=l-m&&u.push([l,t,o-4,-m]),i=o+4,f=!0;for(;f;){for(a=i+l;y>=i&&O(n[0]-r[a])<=d&&O(n[1]-r[a+1])<=d&&O(n[2]-r[a+2])<=d;)r[a]=p[0],r[a+1]=p[1],r[a+2]=p[2],i+=4,a=i+l;for(l+m>=M&&b>=l+m&&u.push([l,t,i-4,m]),i>s+4&&l-m>=M&&b>=l-m&&u.push([l,s+4,i-4,-m]);s>=i&&!(O(n[0]-r[i+l])<=d&&O(n[1]-r[i+l+1])<=d&&O(n[2]-r[i+l+2])<=d);)i+=4;t=i,f=s>=i}}return r}})}(e),!function(e){"use strict";function n(r,e){return Math.exp(-(r*r)/(2*e))}function t(r,e,t,a,i,o){var s,l,f,g,v=r.length,_=new h(v),M=new h(v),b=new h(v),C=new h(v),y=new h(o),O=new h(o),w=i*i,z=2*Math.PI*w;for(s=0;o>s&&(l=n(s,w),!(c>=l&&s>=2));s++)f=n(s-.5,w),g=n(s+.5,w),y[s]=(l+f+g)/3/z,O[s]=g-f;var Y,X,A,I,x,F,S,k,q,N=s-1,P=e-(s-1),T=e*(s-1),R=e*(t-(s-1));for(Y=N;P>Y;Y++)for(X=T;R>X;X+=e){for(A=Y+X,I=r[A]*y[0],x=I,F=1,S=e;s>F;)x+=y[F]*(r[A-S]+r[A+S]),I+=y[F]*(r[A-F]+r[A+F]),S+=e,F++;M[A]=x,_[A]=I}for(Y=N;P>Y;Y++)for(X=T;R>X;X+=e){for(k=0,A=Y+X,q=1;s>q;q++)k+=O[q]*(M[A-q]-M[A+q]);
b[A]=k}for(Y=s;e-s>Y;Y++)for(X=T;R>X;X+=e){for(k=0,A=Y+X,S=e,q=1;s>q;q++)k+=O[q]*(_[A-S]-_[A+S]),S+=e;C[A]=k}N=s,P=e-s,T=e*s,R=e*(t-s);var D,E,B,G,K,L,H,j,W,$,U,V,Q,J,Z,re,ee,ne,te,ae;for(Y=N;P>Y;Y++)for(X=T;R>X;X+=e)A=Y+X,D=A-e,E=A+e,G=A-1,B=A+1,K=D-1,L=D+1,H=E-1,j=E+1,W=b[A],$=C[A],U=u(W,$),Q=u(b[D],C[D]),J=u(b[E],C[E]),re=u(b[G],C[G]),Z=u(b[B],C[B]),ne=u(b[L],C[L]),ae=u(b[j],C[j]),te=u(b[H],C[H]),ee=u(b[K],C[K]),a[A]=(0>=W*$?Math.abs(W)>=Math.abs($)?(V=Math.abs(W*U))>=Math.abs($*ne-(W+$)*Z)&&V>Math.abs($*te-(W+$)*re):(V=Math.abs($*U))>=Math.abs(W*ne-($+W)*Q)&&V>Math.abs(W*te-($+W)*J):Math.abs(W)>=Math.abs($)?(V=Math.abs(W*U))>=Math.abs($*ae+(W-$)*Z)&&V>Math.abs($*ee+(W-$)*re):(V=Math.abs($*U))>=Math.abs(W*ae+($-W)*J)&&V>Math.abs(W*ee+($-W)*Q))?U>=p?m:Math.floor(d*U):0}function a(r,e,n,t,a,o){var s,l,u,h=0,f=r.length;for(s=0;f>s;s++)r[s]=0;for(u=0,l=0,h=0;f>h;h++,u++)u>=e&&(u=0,l++),0===r[h]&&t[h]>=o&&i(r,e,n,t,u,l,h,a)}function i(r,e,n,t,a,o,s,l){var u,h,f,c=0==a?a:a-1,d=a==e-1?a:a+1,p=0==o?o:o-1,m=o==n-1?o:o+1;for(r[s]=t[s],u=c,h=p;d>=u&&m>=h;){if(f=u+h*e,(h!=o||u!=a)&&0===r[f]&&t[f]>=l)return void i(r,e,n,t,u,h,f,l);h++,h>m&&(h=p,u++)}}function o(r,e){var n,t,a,i=r.length;for(n=0,t=0;i>n;n+=4,t++)a=e[t]>0?255:0,r[n]=r[n+1]=r[n+2]=a}function s(r,e){var n,t,a,i,o,s=r.length;for(n=0,t=0;s>n;n+=4,t++)a=r[n],i=r[n+1],o=r[n+2],e[t]=Math.round(.299*a+.587*i+.114*o)}function l(r){var e,n,t,a,i,o,s=new f(256),l=r.length;for(e=0;l>e;e++)s[r[e]]++;for(n=new f(256),t=0,a=0,e=0;256>e;e++){for(t+=s[e],o=255*t/l,i=a+1;o>=i;i++)n[i]=e;a=o}for(e=0;l>e;e++)r[e]=n[r[e]]}var u,h=e.Array32F,f=e.Array32I,c=.005,d=100,p=1e3,m=d*p;u=Math.hypot?Math.hypot:function(r,e){return Math.abs(r)+Math.abs(e)},e.Create({name:"CannyEdgesFilter",lowThreshold:2.5,highThreshold:7.5,gaussianKernelRadius:2,gaussianKernelWidth:16,contrastNormalized:!1,path:e.getPath(r.AMD),init:function(r,e,n,t,a){var i=this;i.lowThreshold=arguments.length<1?2.5:r,i.highThreshold=arguments.length<2?7.5:e,i.gaussianKernelRadius=arguments.length<3?2:n,i.gaussianKernelWidth=arguments.length<4?16:t,i.contrastNormalized=!!a},serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{lowThreshold:r.lowThreshold,highThreshold:r.highThreshold,gaussianKernelRadius:r.gaussianKernelRadius,gaussianKernelWidth:r.gaussianKernelWidth,contrastNormalized:r.contrastNormalized}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.lowThreshold=e.lowThreshold,n.highThreshold=e.highThreshold,n.gaussianKernelRadius=e.gaussianKernelRadius,n.gaussianKernelWidth=e.gaussianKernelWidth,n.contrastNormalized=e.contrastNormalized),n},apply:function(r,e,n){var i,u,h,c,p=this,m=r.length>>2;return h=new f(m),c=new f(m),i=Math.round(p.lowThreshold*d),u=Math.round(p.highThreshold*d),s(r,h),p.contrastNormalized&&l(h),t(h,e,n,c,p.gaussianKernelRadius,p.gaussianKernelWidth),a(h,e,n,c,i,u),o(r,h),r}})}(e),!function(e){"use strict";function n(r,e,n){var t=this;t.x=r,t.y=e,t.z=n}function t(r){r>0&&1>r&&(r*=65536),r=Math.floor(r),256>r&&(r|=r<<8);for(var e=0;256>e;e++){var n;n=1&e?h[e]^255&r:h[e]^r>>8&255,f[e]=f[e+256]=n,c[e]=c[e+256]=u[n%12]}}function a(r,e){var n,t,a,i,o,s=(r+e)*d,l=Math.floor(r+s),u=Math.floor(e+s),h=(l+u)*p,m=r-l+h,g=e-u+h;m>g?(i=1,o=0):(i=0,o=1);var v=m-i+p,_=g-o+p,M=m-1+2*p,b=g-1+2*p;l&=255,u&=255;var C=c[l+f[u]],y=c[l+i+f[u+o]],O=c[l+1+f[u+1]],w=.5-m*m-g*g;0>w?n=0:(w*=w,n=w*w*C.dot2(m,g));var z=.5-v*v-_*_;0>z?t=0:(z*=z,t=z*z*y.dot2(v,_));var Y=.5-M*M-b*b;return 0>Y?a=0:(Y*=Y,a=Y*Y*O.dot2(M,b)),70*(n+t+a)}function i(r){return r*r*r*(r*(6*r-15)+10)}function o(r,e,n){return(1-n)*r+n*e}function s(r,e){var n=Math.floor(r),t=Math.floor(e);r-=n,e-=t,n=255&n,t=255&t;var a=c[n+f[t]].dot2(r,e),s=c[n+f[t+1]].dot2(r,e-1),l=c[n+1+f[t]].dot2(r-1,e),u=c[n+1+f[t+1]].dot2(r-1,e-1),h=i(r);return o(o(a,l,h),o(s,u,h),i(e))}var l="prototype";n[l].dot2=function(r,e){return this.x*r+this.y*e},n[l].dot3=function(r,e,n){return this.x*r+this.y*e+this.z*n};var u=[new n(1,1,0),new n(-1,1,0),new n(1,-1,0),new n(-1,-1,0),new n(1,0,1),new n(-1,0,1),new n(1,0,-1),new n(-1,0,-1),new n(0,1,1),new n(0,-1,1),new n(0,1,-1),new n(0,-1,-1)],h=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],f=new Array(512),c=new Array(512),d=.5*(Math.sqrt(3)-1),p=(3-Math.sqrt(3))/6;e.Create({name:"PerlinNoiseFilter",baseX:1,baseY:1,offsetX:0,offsetY:0,seed:0,colors:null,perlin:!1,init:function(r,e,n,t,a,i,o){var s=this;s.baseX=r||1,s.baseY=e||1,s.offsetX=n||0,s.offsetY=t||0,s.seed=a||0,s.colors=i||null,s.perlin=!!o},path:e.getPath(r.AMD),serialize:function(){var r=this;return{filter:r.name,_isOn:!!r._isOn,params:{baseX:r.baseX,baseY:r.baseY,offsetX:r.offsetX,offsetY:r.offsetY,seed:r.seed,colors:r.colors,perlin:r.perlin}}},unserialize:function(r){var e,n=this;return r&&n.name===r.filter&&(n._isOn=!!r._isOn,e=r.params,n.baseX=e.baseX,n.baseY=e.baseY,n.offsetX=e.offsetX,n.offsetY=e.offsetY,n.seed=e.seed,n.colors=e.colors,n.perlin=e.perlin),n},apply:function(r,e,n){var i,o,l,u,h,f=this,c=f.baseX,d=f.baseY,p=f.offsetX,m=f.offsetY,g=f.colors,v=Math.floor,_=!g||!g.length,M=f.perlin,b=r.length;if(t(f.seed),i=0,o=0,l=0,M)for(i=0;b>i;i+=4,o++)o>=e&&(o=0,l++),u=.5*(1+s((o+p)%e/c,(l+m)%n/d)),_?r[i]=r[i+1]=r[i+2]=~~(255*u):(h=g[v(u*(g.length-1))],r[i]=h[0],r[i+1]=h[1],r[i+2]=h[2]);else for(i=0;b>i;i+=4,o++)o>=e&&(o=0,l++),u=.5*(1+a((o+p)%e/c,(l+m)%n/d)),_?r[i]=r[i+1]=r[i+2]=~~(255*u):(h=g[v(u*(g.length-1))],r[i]=h[0],r[i+1]=h[1],r[i+2]=h[2]);return r}})}(e),r.FILTER_PLUGINS});
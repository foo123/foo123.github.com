/**
*  PublishSubscribe
*  A simple publish-subscribe implementation for PHP, Python, Node/JS
*
*  @version: 0.3.5
*  https://github.com/foo123/PublishSubscribe
*
**/
!function(t,s,n){"use strict";var i,e="object"==typeof module&&module.exports,o="function"==typeof define&&define.amd;e?module.exports=(module.$deps=module.$deps||{})[s]=module.$deps[s]||n.call(t,{NODE:module})||1:o&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(s)?define(s,["require","exports","module"],function(s,i,e){return n.call(t,{AMD:e})}):s in t||(t[s]=i=n.call(t,{})||1)&&o&&define(s,[],function(){return i})}(this,"PublishSubscribe",function(){"use strict";function t(t,s,n,i,e){var o=this;o.target=t,o.topic=s?[].concat(s):[],n&&(o.originalTopic=[].concat(n)),o.tags=i?[].concat(i):[],o.namespaces=e?[].concat(e):[],o.data={},o.timestamp=y(),o._stopPropagation=!1,o._stopEvent=!1}function s(){return{notopics:{notags:{namespaces:{},list:[],oneOffs:0},tags:{}},topics:{}}}function n(t){return t.length>0}function i(t,s){var i,e,o,l;return s=String(s),i=s.indexOf(t[2]),e=s.indexOf(t[1]),i>-1?(l=s.slice(i).split(t[2]).filter(n).sort(),s=s.slice(0,i)):l=[],e>-1?(o=s.slice(e).split(t[1]).filter(n).sort(),s=s.slice(0,e)):o=[],s=s.split(t[0]).filter(n),[s,o,l]}function e(t,s){var n,e,o,l,p,u,a,c,f=[],r=[];for(s=i(t,s),n=s[2],e=s[1],s=s[0],o=s.length;o;)f.push(s.join(_)),s.pop(),o--;if(o=e.length,o>1){for(c=1<<o,l=c-1;l>=1;l--){for(a=[],p=0,u=1;o>p;p++,u=1<<p)l!==u&&l&u&&a.push(e[p]);a.length&&r.push(a.join(b))}r=r.concat(e)}else o&&r.push(e[0]);return[f.length?f[0]:"",f,r,n]}function o(t,s,n){var i,e;for(i=0;n>i;i++)e=s[i],e in t?t[e]++:t[e]=1}function l(t,s,n){var i,e;for(i=0;n>i;i++)e=s[i],e in t&&(t[e]--,t[e]<=0&&delete t[e])}function p(t,s,n){var i,e;for(i=0;n>i;i++)if(e=s[i],!(e in t)||0>=t[e])return!1;return!0}function u(t,s,n,i,e,o){if(n){if(i){if(o>0){if(i in t.topics[n].tags&&t.topics[n].tags[i].list.length&&p(t.topics[n].tags[i].namespaces,e,o))return s.push([n,i,!0,t.topics[n].tags[i]]),!0}else if(i in t.topics[n].tags&&t.topics[n].tags[i].list.length)return s.push([n,i,null,t.topics[n].tags[i]]),!0}else if(o>0){if(t.topics[n].notags.list.length&&p(t.topics[n].notags.namespaces,e,o))return s.push([n,null,!0,t.topics[n].notags]),!0}else if(t.topics[n].notags.list.length)return s.push([n,null,null,t.topics[n].notags]),!0}else if(i){if(o>0){if(i in t.notopics.tags&&t.notopics.tags[i].list.length&&p(t.notopics.tags[i].namespaces,e,o))return s.push([null,i,!0,t.notopics.tags[i]]),!0}else if(i in t.notopics.tags&&t.notopics.tags[i].list.length)return s.push([null,i,null,t.notopics.tags[i]]),!0}else if(o>0&&t.notopics.notags.list.length&&p(t.notopics.notags.namespaces,e,o))return s.push([null,null,!0,t.notopics.notags]),!0;return!1}function a(t,s,n){var i,o,l,p,a,c,f=e(t,n),r=f[1],g=f[2],h=f[3],d=f[0],m=[];if(a=g.length,c=h.length,i=r.length)for(;i;){if(o=r[0],s.topics[o])if(a>0)for(p=0;a>p;p++)l=g[p],u(s,m,o,l,h,c);else u(s,m,o,null,h,c);r.shift(),i--}if(a>0)for(p=0;a>p;p++)l=g[p],u(s,m,null,l,h,c);return u(s,m,null,null,h,c),[d,m,h]}function c(s,n,i,e,o){if(i){var l,u,c,f,r,g,h,d,m,v,O,y,$,S,P,j=a(n,i,e);for(d=j[0],O=j[2],$=O.length,j=j[1],c=j.length,S=null,c>0&&(S=new t(s),S.originalTopic=d?d.split(_):[]),l=0;c>l;l++){for(m=j[l][0],v=j[l][1],S.topic=m?m.split(_):[],S.tags=v?v.split(b):[],y=j[l][2],g=j[l][3],r=[],f=g.list.length,u=0;f>u;u++)(!y||g.list[u][2]&&p(g.list[u][2],O,$))&&r.push(g.list[u]);for(f=r.length,u=0;f>u&&(h=r[u],S.namespaces=y?h[3].slice(0):[],h[4]=1,P=h[0](S,o),!1!==P&&!S.eventStopped());u++);if((r=g.list)&&(f=r.length))if(g.oneOffs>0)for(u=f-1;u>=0;u--)h=r[u],h[1]&&h[4]>0&&(r.splice(u,1),g.oneOffs=g.oneOffs>0?g.oneOffs-1:0);else g.oneOffs=0;if(S.propagationStopped())break}S&&(S.dispose(),S=null)}}function f(t,s,n,e,l,p){if(s&&"function"==typeof e){n=i(t,n);var u,a,c,f,r,g=n[1].join(b),h=g.length,d=n[2],m=d.length;if(n=n[0].join(_),l=!0===l,p=!0===p,c={},m)for(r=0;m>r;r++)c[d[r]]=1;f=d.slice(0),a=null,n.length?(n in s.topics||(s.topics[n]={notags:{namespaces:{},list:[],oneOffs:0},tags:{}}),h?(g in s.topics[n].tags||(s.topics[n].tags[g]={namespaces:{},list:[],oneOffs:0}),a=s.topics[n].tags[g]):a=s.topics[n].notags):h?(g in s.notopics.tags||(s.notopics.tags[g]={namespaces:{},list:[],oneOffs:0}),a=s.notopics.tags[g]):m&&(a=s.notopics.notags),null!==a&&(u=m?[e,l,c,f,0]:[e,l,!1,[],0],p?a.list.unshift(u):a.list.push(u),l&&a.oneOffs++,m&&o(a.namespaces,d,m))}}function r(t,s,n,i,e){var o,u=t.list.length;if(s){if(null!=n&&u>0)for(;--u>=0;)n===t.list[u][0]&&(e&&t.list[u][2]&&p(t.list[u][2],i,e)?(o=O(t.list[u][2]),l(t.namespaces,o,o.length),t.list[u][1]&&(t.oneOffs=t.oneOffs>0?t.oneOffs-1:0),t.list.splice(u,1)):e||(t.list[u][2]&&(o=O(t.list[u][2]),l(t.namespaces,o,o.length)),t.list[u][1]&&(t.oneOffs=t.oneOffs>0?t.oneOffs-1:0),t.list.splice(u,1)))}else if(!s&&e>0&&u>0)for(;--u>=0;)t.list[u][2]&&p(t.list[u][2],i,e)&&(o=O(t.list[u][2]),l(t.namespaces,o,o.length),t.list[u][1]&&(t.oneOffs=t.oneOffs>0?t.oneOffs-1:0),t.list.splice(u,1));else!s&&u>0&&(t.list=[],t.oneOffs=0,t.namespaces={})}function g(t,s,n,e){if(s){n=i(t,n);var o,l,p,u,a=n[1].join(b),c=n[2],f=a.length,g=c.length;if(n=n[0].join(_),p=n.length,u=!(!e||"function"!=typeof e),u||(e=null),p&&n in s.topics)f&&a in s.topics[n].tags?(r(s.topics[n].tags[a],u,e,c,g),s.topics[n].tags[a].list.length||delete s.topics[n].tags[a]):f||r(s.topics[n].notags,u,e,c,g),s.topics[n].notags.list.length||O(s.topics[n].tags).length||delete s.topics[n];else if(!p&&(f||g))if(f){a in s.notopics.tags&&(r(s.notopics.tags[a],u,e,c,g),s.notopics.tags[a].list.length||delete s.notopics.tags[a]);for(o in s.topics)a in s.topics[o].tags&&(r(s.topics[o].tags[a],u,e,c,g),s.topics[o].tags[a].list.length||delete s.topics[o].tags[a])}else{r(s.notopics.notags,u,e,c,g);for(l in s.notopics.tags)r(s.notopics.tags[l],u,e,c,g),s.notopics.tags[l].list.length||delete s.notopics.tags[l];for(o in s.topics){r(s.topics[o].notags,u,e,c,g);for(l in s.topics[o].tags)r(s.topics[o].tags[l],u,e,c,g),s.topics[o].tags[l].list.length||delete s.topics[o].tags[l]}}}}var h="0.3.5",d="/",m="#",v="@",_="/",b="#",O=Object.keys,y=Date.now?Date.now:function(){return(new Date).getTime()};t.prototype={constructor:t,target:null,topic:null,originalTopic:null,tags:null,namespaces:null,data:null,timestamp:0,_stopPropagation:!1,_stopEvent:!1,dispose:function(){var t=this;return t.target=null,t.topic=null,t.originalTopic=null,t.tags=null,t.namespaces=null,t.data=null,t.timestamp=null,t._stopPropagation=!0,t._stopEvent=!0,t},propagate:function(t){return arguments.length||(t=!0),this._stopPropagation=!t,this},stop:function(t){return arguments.length||(t=!0),this._stopEvent=!!t,this},propagationStopped:function(){return this._stopPropagation},eventStopped:function(){return this._stopEvent}};var $=function(){return this instanceof $?void this.initPubSub():new $};return $.VERSION=h,$.Event=t,$.prototype={constructor:$,_seps:null,_pubsub$:null,initPubSub:function(){var t=this;return t._seps=[d,m,v],t._pubsub$=s(),t},disposePubSub:function(){var t=this;return t._seps=null,t._pubsub$=null,t},setSeparators:function(t){var s,n=this;return t&&(s=t.length)&&(s>0&&t[0]&&(n._seps[0]=t[0]),s>1&&t[1]&&(n._seps[1]=t[1]),s>2&&t[2]&&(n._seps[2]=t[2])),n},trigger:function(t,s,n){var i=this;return 3>arguments.length&&(n=0),n=+n,s=s||{},n>0?setTimeout(function(){c(i,i._seps,i._pubsub$,t,s)},n):c(i,i._seps,i._pubsub$,t,s),i},on:function(t,s){var n=this;return s&&"function"==typeof s&&f(n._seps,n._pubsub$,t,s),n},one:function(t,s){var n=this;return s&&"function"==typeof s&&f(n._seps,n._pubsub$,t,s,!0),n},on1:function(t,s){var n=this;return s&&"function"==typeof s&&f(n._seps,n._pubsub$,t,s,!1,!0),n},one1:function(t,s){var n=this;return s&&"function"==typeof s&&f(n._seps,n._pubsub$,t,s,!0,!0),n},off:function(t,s){var n=this;return g(n._seps,n._pubsub$,t,s||null),n}},$});
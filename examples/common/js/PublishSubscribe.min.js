/**
*  PublishSubscribe
*  A simple publish-subscribe implementation for PHP, Python, Node/JS
*
*  @version: 0.3.6
*  https://github.com/foo123/PublishSubscribe
*
**/
!function(t,s,n){"use strict";var e,o="object"==typeof module&&module.exports,i="function"==typeof define&&define.amd;o?module.exports=(module.$deps=module.$deps||{})[s]=module.$deps[s]||n.call(t,{NODE:module})||1:i&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(s)?define(s,["require","exports","module"],function(s,e,o){return n.call(t,{AMD:o})}):s in t||(t[s]=e=n.call(t,{})||1)&&i&&define(s,[],function(){return e})}(this,"PublishSubscribe",function(){"use strict";function t(t,s,n,e,o){var i=this;i.target=t,i.topic=s?[].concat(s):[],n&&(i.originalTopic=[].concat(n)),i.tags=e?[].concat(e):[],i.namespaces=o?[].concat(o):[],i.data={},i.timestamp=$(),i._stopPropagation=!1,i._stopEvent=!1}function s(){return{notopics:{notags:{namespaces:{},list:[],oneOffs:0},tags:{}},topics:{}}}function n(t){return t.length>0}function e(t,s){var e,o,i,l;return s=String(s),e=s.indexOf(t[2]),o=s.indexOf(t[1]),e>-1?(l=s.slice(e).split(t[2]).filter(n).sort(),s=s.slice(0,e)):l=[],o>-1?(i=s.slice(o).split(t[1]).filter(n).sort(),s=s.slice(0,o)):i=[],s=s.split(t[0]).filter(n),[s,i,l]}function o(t,s){var n,o,i,l,p,a,u,c,r=[],f=[];for(s=e(t,s),n=s[2],o=s[1],s=s[0],i=s.length;i;)r.push(s.join(v)),s.pop(),i--;if(i=o.length,i>1){for(c=1<<i,l=c-1;l>=1;l--){for(u=[],p=0,a=1;i>p;p++,a=1<<p)l!==a&&l&a&&u.push(o[p]);u.length&&f.push(u.join(b))}f=f.concat(o)}else i&&f.push(o[0]);return[r.length?r[0]:"",r,f,n]}function i(t,s,n){var e,o;for(e=0;n>e;e++)o="ns_"+s[e],t[y](o)?t[o]++:t[o]=1}function l(t,s,n){var e,o;for(e=0;n>e;e++)o="ns_"+s[e],t[y](o)&&(t[o]--,t[o]<=0&&delete t[o])}function p(t,s,n){var e,o;for(e=0;n>e;e++)if(o="ns_"+s[e],!t[y](o)||0>=t[o])return!1;return!0}function a(t,s,n,e,o,i){var l=n?"tp_"+n:!1,a=e?"tg_"+e:!1;if(l&&t.topics[y](l)){if(a&&t.topics[l].tags[y](a)){if(t.topics[l].tags[a].list.length&&(0>=i||p(t.topics[l].tags[a].namespaces,o,i)))return s.push([n,e,i>0,t.topics[l].tags[a]]),!0}else if(t.topics[l].notags.list.length&&(0>=i||p(t.topics[l].notags.namespaces,o,i)))return s.push([n,null,i>0,t.topics[l].notags]),!0}else if(a&&t.notopics.tags[y](a)){if(t.notopics.tags[a].list.length&&(0>=i||p(t.notopics.tags[a].namespaces,o,i)))return s.push([null,e,i>0,t.notopics.tags[a]]),!0}else if(t.notopics.notags.list.length&&(0>=i||p(t.notopics.notags.namespaces,o,i)))return s.push([null,null,!0,t.notopics.notags]),!0;return!1}function u(t,s,n){var e,i,l,p,u,c,r=o(t,n),f=r[1],g=r[2],h=r[3],_=r[0],d=[];if(u=g.length,c=h.length,e=f.length)for(;e;){if(i=f[0],s.topics[y]("tp_"+i))if(u>0)for(p=0;u>p;p++)l=g[p],a(s,d,i,l,h,c);else a(s,d,i,null,h,c);f.shift(),e--}if(u>0)for(p=0;u>p;p++)l=g[p],a(s,d,null,l,h,c);return a(s,d,null,null,h,c),[_,d,h]}function c(s,n,e,o,i){if(e){var l,a,c,r,f,g,h,_,d,m,O,y,$,S,P,j=u(n,e,o);for(_=j[0],O=j[2],$=O.length,j=j[1],c=j.length,S=null,c>0&&(S=new t(s),S.originalTopic=_?_.split(v):[]),l=0;c>l;l++){for(d=j[l][0],m=j[l][1],S.topic=d?d.split(v):[],S.tags=m?m.split(b):[],y=j[l][2],g=j[l][3],f=[],r=g.list.length,a=0;r>a;a++)(!y||g.list[a][2]&&p(g.list[a][2],O,$))&&f.push(g.list[a]);for(r=f.length,a=0;r>a&&(h=f[a],S.namespaces=y?h[3].slice(0):[],h[4]=1,P=h[0](S,i),!1!==P&&!S.eventStopped());a++);if((f=g.list)&&(r=f.length))if(g.oneOffs>0)for(a=r-1;a>=0;a--)h=f[a],h[1]&&h[4]>0&&(f.splice(a,1),g.oneOffs=g.oneOffs>0?g.oneOffs-1:0);else g.oneOffs=0;if(S.propagationStopped())break}S&&(S.dispose(),S=null)}}function r(t,s,n,o,l,p){if(s&&"function"==typeof o){n=e(t,n);var a,u,c,r,f,g,h,_=n[1].join(b),d=_.length,m=n[2],O=m.length;if(n=n[0].join(v),l=!0===l,p=!0===p,f={},O)for(h=0;O>h;h++)f["ns_"+m[h]]=1;g=m.slice(0),u=null,n.length?(c="tp_"+n,s.topics[y](c)||(s.topics[c]={notags:{namespaces:{},list:[],oneOffs:0},tags:{}}),d?(r="tg_"+_,s.topics[c].tags[y](r)||(s.topics[c].tags[r]={namespaces:{},list:[],oneOffs:0}),u=s.topics[c].tags[r]):u=s.topics[c].notags):d?(r="tg_"+_,s.notopics.tags[y](r)||(s.notopics.tags[r]={namespaces:{},list:[],oneOffs:0}),u=s.notopics.tags[r]):O&&(u=s.notopics.notags),null!==u&&(a=O?[o,l,f,g,0]:[o,l,!1,[],0],p?u.list.unshift(a):u.list.push(a),l&&u.oneOffs++,O&&i(u.namespaces,m,O))}}function f(t,s,n,e,o){var i,a=t.list.length;if(s){if(null!=n&&a>0)for(;--a>=0;)n===t.list[a][0]&&(o&&t.list[a][2]&&p(t.list[a][2],e,o)?(i=O(t.list[a][2]),l(t.namespaces,i,i.length),t.list[a][1]&&(t.oneOffs=t.oneOffs>0?t.oneOffs-1:0),t.list.splice(a,1)):o||(t.list[a][2]&&(i=O(t.list[a][2]),l(t.namespaces,i,i.length)),t.list[a][1]&&(t.oneOffs=t.oneOffs>0?t.oneOffs-1:0),t.list.splice(a,1)))}else if(!s&&o>0&&a>0)for(;--a>=0;)t.list[a][2]&&p(t.list[a][2],e,o)&&(i=O(t.list[a][2]),l(t.namespaces,i,i.length),t.list[a][1]&&(t.oneOffs=t.oneOffs>0?t.oneOffs-1:0),t.list.splice(a,1));else!s&&a>0&&(t.list=[],t.oneOffs=0,t.namespaces={})}function g(t,s,n,o){if(s){n=e(t,n);var i,l,p,a,u,c,r=n[1].join(b),g=n[2],h=r.length,_=g.length;if(n=n[0].join(v),u=n.length,p=u?"tp_"+n:!1,a=h?"tg_"+r:!1,c=!(!o||"function"!=typeof o),c||(o=null),u&&s.topics[y](p))h&&s.topics[p].tags[y](a)?(f(s.topics[p].tags[a],c,o,g,_),s.topics[p].tags[a].list.length||delete s.topics[p].tags[a]):h||f(s.topics[p].notags,c,o,g,_),s.topics[p].notags.list.length||O(s.topics[p].tags).length||delete s.topics[p];else if(!u&&(h||_))if(h){s.notopics.tags[y](a)&&(f(s.notopics.tags[a],c,o,g,_),s.notopics.tags[a].list.length||delete s.notopics.tags[a]);for(i in s.topics)s.topics[y](i)&&s.topics[i].tags[y](a)&&(f(s.topics[i].tags[a],c,o,g,_),s.topics[i].tags[a].list.length||delete s.topics[i].tags[a])}else{f(s.notopics.notags,c,o,g,_);for(l in s.notopics.tags)s.notopics.tags[y](l)&&(f(s.notopics.tags[l],c,o,g,_),s.notopics.tags[l].list.length||delete s.notopics.tags[l]);for(i in s.topics)if(s.topics[y](i)){f(s.topics[i].notags,c,o,g,_);for(l in s.topics[i].tags)s.topics[i].tags[y](l)&&(f(s.topics[i].tags[l],c,o,g,_),s.topics[i].tags[l].list.length||delete s.topics[i].tags[l])}}}}var h="0.3.6",_="/",d="#",m="@",v="/",b="#",O=Object.keys,y="hasOwnProperty",$=Date.now?Date.now:function(){return(new Date).getTime()};t.prototype={constructor:t,target:null,topic:null,originalTopic:null,tags:null,namespaces:null,data:null,timestamp:0,_stopPropagation:!1,_stopEvent:!1,dispose:function(){var t=this;return t.target=null,t.topic=null,t.originalTopic=null,t.tags=null,t.namespaces=null,t.data=null,t.timestamp=null,t._stopPropagation=!0,t._stopEvent=!0,t},propagate:function(t){return arguments.length||(t=!0),this._stopPropagation=!t,this},stop:function(t){return arguments.length||(t=!0),this._stopEvent=!!t,this},propagationStopped:function(){return this._stopPropagation},eventStopped:function(){return this._stopEvent}};var S=function(){return this instanceof S?void this.initPubSub():new S};return S.VERSION=h,S.Event=t,S.prototype={constructor:S,_seps:null,_pubsub$:null,initPubSub:function(){var t=this;return t._seps=[_,d,m],t._pubsub$=s(),t},disposePubSub:function(){var t=this;return t._seps=null,t._pubsub$=null,t},setSeparators:function(t){var s,n=this;return t&&(s=t.length)&&(s>0&&t[0]&&(n._seps[0]=t[0]),s>1&&t[1]&&(n._seps[1]=t[1]),s>2&&t[2]&&(n._seps[2]=t[2])),n},trigger:function(t,s,n){var e=this;return 3>arguments.length&&(n=0),n=+n,s=s||{},n>0?setTimeout(function(){c(e,e._seps,e._pubsub$,t,s)},n):c(e,e._seps,e._pubsub$,t,s),e},on:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s),n},one:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s,!0),n},on1:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s,!1,!0),n},one1:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s,!0,!0),n},off:function(t,s){var n=this;return g(n._seps,n._pubsub$,t,s||null),n}},S});
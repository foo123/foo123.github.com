/**
*  PublishSubscribe
*  A simple publish-subscribe implementation for PHP, Python, Node/JS
*
*  @version: 0.3.3
*  https://github.com/foo123/PublishSubscribe
*
**/
!function(t,s,n){"use strict";var i,o="object"==typeof module&&module.exports,e="function"==typeof define&&define.amd;o?module.exports=(module.$deps=module.$deps||{})[s]=module.$deps[s]||n.call(t,{NODE:module})||1:e&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(s)?define(s,["require","exports","module"],function(s,i,o){return n.call(t,{AMD:o})}):s in t||(t[s]=i=n.call(t,{})||1)&&e&&define(s,[],function(){return i})}(this,"PublishSubscribe",function(){"use strict";function t(t,s,n,i){var o=this;o.topic=t?[].concat(t):[],s&&(o.originalTopic=[].concat(s)),o.tags=n?[].concat(n):[],o.namespaces=i?[].concat(i):[],o.data={},o._stopPropagation=!1,o._stopEvent=!1}function s(){return{notopics:{notags:{namespaces:{},list:[]},tags:{}},topics:{}}}function n(t){return t.length>0}function i(t,s){var i,o,e,p;return s=String(s),i=s.indexOf(t[2]),o=s.indexOf(t[1]),i>-1?(p=s.slice(i).split(t[2]).filter(n).sort(),s=s.slice(0,i)):p=[],o>-1?(e=s.slice(o).split(t[1]).filter(n).sort(),s=s.slice(0,o)):e=[],s=s.split(t[0]).filter(n),[s,e,p]}function o(t,s){var n,o,e,p,l,c,a,u,r=[],g=[];for(s=i(t,s),n=s[2],o=s[1],s=s[0],e=s.length;e;)r.push(s.join(_)),s.pop(),e--;if(e=o.length,e>1){for(u=1<<e,p=u-1;p>=1;p--){for(a=[],l=0,c=1;e>l;l++,c=1<<l)p!==c&&p&c&&a.push(o[l]);a.length&&g.push(a.join(b))}g=g.concat(o)}else e&&g.push(o[0]);return[r.length?r[0]:"",r,g,n]}function e(t,s,n){var i,o;for(i=0;n>i;i++)o=s[i],o in t?t[o]++:t[o]=1}function p(t,s,n){var i,o;for(i=0;n>i;i++)o=s[i],o in t&&(t[o]--,t[o]<=0&&delete t[o])}function l(t,s,n){var i,o;for(i=0;n>i;i++)if(o=s[i],!(o in t)||0>=t[o])return!1;return!0}function c(t,s,n,i,o,e){if(n){if(i){if(e>0){if(i in t.topics[n].tags&&t.topics[n].tags[i].list.length&&l(t.topics[n].tags[i].namespaces,o,e))return s.push([n,i,!0,t.topics[n].tags[i]]),!0}else if(i in t.topics[n].tags&&t.topics[n].tags[i].list.length)return s.push([n,i,null,t.topics[n].tags[i]]),!0}else if(e>0){if(t.topics[n].notags.list.length&&l(t.topics[n].notags.namespaces,o,e))return s.push([n,null,!0,t.topics[n].notags]),!0}else if(t.topics[n].notags.list.length)return s.push([n,null,null,t.topics[n].notags]),!0}else if(i){if(e>0){if(i in t.notopics.tags&&t.notopics.tags[i].list.length&&l(t.notopics.tags[i].namespaces,o,e))return s.push([null,i,!0,t.notopics.tags[i]]),!0}else if(i in t.notopics.tags&&t.notopics.tags[i].list.length)return s.push([null,i,null,t.notopics.tags[i]]),!0}else if(e>0&&t.notopics.notags.list.length&&l(t.notopics.notags.namespaces,o,e))return s.push([null,null,!0,t.notopics.notags]),!0;return!1}function a(t,s,n){var i,e,p,l,a,u,r=o(t,n),g=r[1],f=r[2],h=r[3],d=r[0],m=[];if(a=f.length,u=h.length,i=g.length)for(;i;){if(e=g[0],s.topics[e])if(a>0)for(l=0;a>l;l++)p=f[l],c(s,m,e,p,h,u);else c(s,m,e,null,h,u);g.shift(),i--}if(a>0)for(l=0;a>l;l++)p=f[l],c(s,m,null,p,h,u);return c(s,m,null,null,h,u),[d,m,h]}function u(s,n,i,o){if(n){var e,p,c,u,r,g,f,h,d,m,v,y,$,S,P,j=a(s,n,i);for(h=j[0],v=j[2],$=v.length,j=j[1],c=j.length,S=null,c>0&&(S=new t,S.originalTopic=h?h.split(_):[]),e=0;c>e;e++){for(d=j[e][0],m=j[e][1],S.topic=d?d.split(_):[],S.tags=m?m.split(b):[],y=j[e][2],g=j[e][3],r=[],u=g.list.length,p=0;u>p;p++)(!y||g.list[p][2]&&l(g.list[p][2],v,$))&&r.push(g.list[p]);for(u=r.length,p=0;u>p&&(f=r[p],S.namespaces=y?f[3].slice(0):[],f[4]=1,P=f[0](S,o),!1!==P&&!S.eventStopped());p++);if((r=g.list)&&(u=r.length))for(p=u-1;p>=0;p--)f=r[p],f[1]&&f[4]>0&&r.splice(p,1);if(S.propagationStopped())break}S&&(S.dispose(),S=null)}}function r(t,s,n,o,p,l){if(s&&"function"==typeof o){n=i(t,n);var c,a,u,r,g=n[1].join(b),f=g.length,h=n[2],d=h.length;if(n=n[0].join(_),p=!0===p,l=!0===l,a={},d)for(r=0;d>r;r++)a[h[r]]=1;u=h.slice(0),n.length?(n in s.topics||(s.topics[n]={notags:{namespaces:{},list:[]},tags:{}}),f?(g in s.topics[n].tags||(s.topics[n].tags[g]={namespaces:{},list:[]}),d?(c=[o,p,a,u,0],l?s.topics[n].tags[g].list.unshift(c):s.topics[n].tags[g].list.push(c),e(s.topics[n].tags[g].namespaces,h,d)):(c=[o,p,!1,[],0],l?s.topics[n].tags[g].list.unshift(c):s.topics[n].tags[g].list.push(c))):d?(c=[o,p,a,u,0],l?s.topics[n].notags.list.unshift(c):s.topics[n].notags.list.push(c),e(s.topics[n].notags.namespaces,h,d)):(c=[o,p,!1,[],0],l?s.topics[n].notags.list.unshift(c):s.topics[n].notags.list.push(c))):f?(g in s.notopics.tags||(s.notopics.tags[g]={namespaces:{},list:[]}),d?(c=[o,p,a,u,0],l?s.notopics.tags[g].list.unshift(c):s.notopics.tags[g].list.push(c),e(s.notopics.tags[g].namespaces,h,d)):(c=[o,p,!1,[],0],l?s.notopics.tags[g].list.unshift(c):s.notopics.tags[g].list.push(c))):d&&(c=[o,p,a,u,0],l?s.notopics.notags.list.unshift(c):s.notopics.notags.list.push(c),e(s.notopics.notags.namespaces,h,d))}}function g(t,s,n,i,o){var e,c=t.list.length;if(s){if(null!=n&&c>0)for(;--c>=0;)n===t.list[c][0]&&(o&&t.list[c][2]&&l(t.list[c][2],i,o)?(e=y(t.list[c][2]),p(t.namespaces,e,e.length),t.list.splice(c,1)):o||(t.list[c][2]&&(e=y(t.list[c][2]),p(t.namespaces,e,e.length)),t.list.splice(c,1)))}else if(!s&&o>0&&c>0)for(;--c>=0;)t.list[c][2]&&l(t.list[c][2],i,o)&&(e=y(t.list[c][2]),p(t.namespaces,e,e.length),t.list.splice(c,1));else!s&&c>0&&(t.list=[],t.namespaces={})}function f(t,s,n,o){if(s){n=i(t,n);var e,p,l,c,a=n[1].join(b),u=n[2],r=a.length,f=u.length;if(n=n[0].join(_),l=n.length,c=!(!o||"function"!=typeof o),c||(o=null),l&&n in s.topics)r&&a in s.topics[n].tags?(g(s.topics[n].tags[a],c,o,u,f),s.topics[n].tags[a].list.length||delete s.topics[n].tags[a]):r||g(s.topics[n].notags,c,o,u,f),s.topics[n].notags.list.length||y(s.topics[n].tags).length||delete s.topics[n];else if(!l&&(r||f))if(r){a in s.notopics.tags&&(g(s.notopics.tags[a],c,o,u,f),s.notopics.tags[a].list.length||delete s.notopics.tags[a]);for(e in s.topics)a in s.topics[e].tags&&(g(s.topics[e].tags[a],c,o,u,f),s.topics[e].tags[a].list.length||delete s.topics[e].tags[a])}else{g(s.notopics.notags,c,o,u,f);for(p in s.notopics.tags)g(s.notopics.tags[p],c,o,u,f),s.notopics.tags[p].list.length||delete s.notopics.tags[p];for(e in s.topics){g(s.topics[e].notags,c,o,u,f);for(p in s.topics[e].tags)g(s.topics[e].tags[p],c,o,u,f),s.topics[e].tags[p].list.length||delete s.topics[e].tags[p]}}}}var h="0.3.3",d="/",m="#",v="@",_="/",b="#",y=Object.keys;t.prototype={constructor:t,topic:null,originalTopic:null,tags:null,namespaces:null,data:null,_stopPropagation:!1,_stopEvent:!1,dispose:function(){var t=this;return t.topic=null,t.originalTopic=null,t.tags=null,t.namespaces=null,t.data=null,t._stopPropagation=!0,t._stopEvent=!0,t},propagate:function(t){return arguments.length||(t=!0),this._stopPropagation=!t,this},stop:function(t){return arguments.length||(t=!0),this._stopEvent=!!t,this},propagationStopped:function(){return this._stopPropagation},eventStopped:function(){return this._stopEvent}};var $=function(){return this instanceof $?void this.initPubSub():new $};return $.VERSION=h,$.Event=t,$.prototype={constructor:$,_seps:null,_pubsub$:null,initPubSub:function(){var t=this;return t._seps=[d,m,v],t._pubsub$=s(),t},disposePubSub:function(){var t=this;return t._seps=null,t._pubsub$=null,t},setSeparators:function(t){if(t){var s=t.length;s>0&&t[0]&&(this._seps[0]=t[0]),s>1&&t[1]&&(this._seps[1]=t[1]),s>2&&t[2]&&(this._seps[2]=t[2])}return this},trigger:function(t,s,n){var i=this;return 3>arguments.length&&(n=0),n=+n,s=s||{},n>0?setTimeout(function(){u(i._seps,i._pubsub$,t,s)},n):u(i._seps,i._pubsub$,t,s),i},on:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s),n},one:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s,!0),n},on1:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s,!1,!0),n},one1:function(t,s){var n=this;return s&&"function"==typeof s&&r(n._seps,n._pubsub$,t,s,!0,!0),n},off:function(t,s){var n=this;return f(n._seps,n._pubsub$,t,s||null),n}},$});
/**
*
*   Asynchronous.js
*   @version: 0.4.2
*
*   Simple JavaScript class to manage asynchronous, parallel, linear, sequential and interleaved tasks
*   https://github.com/foo123/asynchronous.js
*
**/!function(n,e,r){"use strict";var t,o="object"==typeof module&&module.exports,s="function"==typeof define&&define.amd;o?module.exports=(module.$deps=module.$deps||{})[e]=module.$deps[e]||r.call(n,{NODE:module})||1:s&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["require","exports","module"],function(e,t,o){return r.call(n,{AMD:o})}):e in n||(n[e]=t=r.call(n,{})||1)&&s&&define(e,[],function(){return t})}(this,"Asynchronous",function(exports){return!function(root,exports,undef){"use strict";function runParallelised(n){n.$runmode=PARALLELISED,n.$running=!1}function runLinearised(n,e){var r,t=n,o=t.$queue;if(t.$runmode=LINEARISED,o){for(;o.length&&(!o[0]||!o[0].canRun());)o.shift();o.length?(t.$running=!0,r=o.shift(),e?r.runWithArgs(e):r.run(),r.complete()):t.$running=!1}}function runInterleaved(n,e){var r,t=n,o=t.$queue,s=0;if(t.$runmode=INTERLEAVED,o&&o.length){for(t.$running=!0;s<o.length;)r=o[s],r&&r.canRun()?(e?r.runWithArgs(e):r.run(),r.isFinished()?(o.shift(),r.complete()):s++):o.shift();t.$running=!1,t.$timer=SetTime(curry(runInterleaved,t),t.$interval)}}function runSequenced(n,e){var r,t=n,o=t.$queue;t.$runmode=SEQUENCED,o&&o.length&&(r=o[0],r&&r.canRun()?(t.$running=!0,e?r.runWithArgs(e):r.run(),r.isFinished()&&(o.shift(),r.complete())):o.shift(),t.$running=!1,t.$timer=SetTime(curry(runSequenced,t),t.$interval))}var PROTO="prototype",Obj=Object,Arr=Array,Func=Function,FP=Func[PROTO],OP=Obj[PROTO],AP=Arr[PROTO],slice=FP.call.bind(AP.slice),toString=FP.call.bind(OP.toString),typeOf=function(n){return typeof n},isFunction=function(n){return"function"==typeof n},is_instance=function(n,e){return n instanceof e},SetTime=setTimeout,ClearTime=clearTimeout,UNDEFINED=undef,UNKNOWN=0,NODE=1,BROWSER=2,DEFAULT_INTERVAL=60,NONE=0,INTERLEAVED=1,LINEARISED=2,PARALLELISED=3,SEQUENCED=4,isNode="undefined"!=typeof global&&"[object global]"===toString(global),isNodeProcess=!(!isNode||!process.env.NODE_UNIQUE_ID),isBrowser=!isNode&&"undefined"!=typeof navigator,isWebWorker=isBrowser&&"function"==typeof importScripts&&is_instance(navigator,WorkerNavigator),isAMD="function"==typeof define&&define.amd,supportsMultiThread=isNode||"function"==typeof Worker,isThread=isNodeProcess||isWebWorker,Thread,numProcessors=isNode?require("os").cpus().length:4,fromJSON=JSON.parse,toJSON=JSON.stringify,onMessage,curry=function(n,e){return function(){return n(e)}},URL=root.webkitURL||root.URL||null,blobURL=function(n,e){return URL?URL.createObjectURL(new Blob([n||""],{type:e||"text/javascript"})):n},path=function(n){var e;return isNode?{file:__filename,path:__dirname}:isWebWorker?{file:e=self.location.href,path:e.split("/").slice(0,-1).join("/")}:isAMD&&n&&n.uri?{file:e=n.uri,path:e.split("/").slice(0,-1).join("/")}:isBrowser&&(e=document.getElementsByTagName("script"))&&e.length?{file:e=e[e.length-1].src,path:e.split("/").slice(0,-1).join("/")}:{path:null,file:null}},thisPath=path(exports.AMD),tpf=thisPath.file,notThisPath=function(n){return!(!n||!n.length||n===tpf)};if(onMessage=isWebWorker?function(n){n&&(onmessage=n)}:isNodeProcess?function(n){n&&process.on("message",function(e){n(fromJSON(e))})}:function(){},isNode){var fs=require("fs"),ps=require("child_process");root.close=function(){process.exit()},root.postMessage=function(n){process.send(toJSON({data:n}))},root.importScripts=function(scripts){if(scripts){scripts=scripts.split(",");for(var i=0,src,ok;i<scripts.length;){ok=!0;try{src=fs.readFileSync(scripts[i++]),eval(src)}catch(e){ok=e}if(!0!==ok)throw ok}}},Thread=function(n){var e=this;e.process=ps.fork(n),e.process.on("message",function(n){e.onmessage&&e.onmessage(fromJSON(n))}),e.process.on("error",function(n){e.onerror&&e.onerror(n)})},Thread[PROTO]={constructor:Thread,process:null,onmessage:null,onerror:null,postMessage:function(n){return this.process&&this.process.send(toJSON({data:n})),this},terminate:function(){return this.process&&(this.process.kill(),this.process=null),this}}}else Thread=root.Worker;var Task=function(n){if(n instanceof Task)return n;if(!(this instanceof Task))return new Task(n);1>arguments.length&&(n=null);var e=this,r=null,t=null,o=!1,s=!1,i=!1,u=!1,a=!1,c=!1,l=null,f=0,p=1,h=null,d=null,m=null,g=undef,E=function(){return g=n(e),o=!0,g};e.task=function(r){return n=r,e},e.queue=function(n){return arguments.length?(r=n,e):r},e.jumpNext=function(n){r&&r.jumpNext(!1,n)},e.abort=function(n){r&&(r.abort(!1),n&&(r.dispose(),r=null))},e.dispose=function(){r&&(r.dispose(),r=null)},e.canRun=function(){return n&&(!o||s||i||u||a||c)?(s||i)&&f>=h?!1:i&&!l?!1:(u||a)&&g===d?!1:!0:!1},e.run=E,e.runWithArgs=function(e){return g=n.apply(null,e),o=!0,g},e.iif=function(r,t,o){return r?n=t:arguments.length>2&&(n=o),e},e.until=function(n){return g=undef,l=null,d=n,a=!0,c=!1,s=!1,i=!1,u=!1,e.run=E,e},e.untilNot=function(n){return g=undef,l=null,m=n,c=!0,a=!1,s=!1,i=!1,u=!1,e.run=E,e},e.loop=function(r,t,d){return g=undef,l=null,f=t||0,p=d||1,h=r,s=!0,a=!1,c=!1,i=!1,u=!1,e.run=function(){var e;return e=n(f),f+=p,g=e,o=!0,e},e},e.each=function(r){return g=undef,l=r,f=0,p=1,h=r?r.length||0:0,i=!0,a=!1,c=!1,s=!1,u=!1,e.run=function(){var e;return e=n(l[f],f),f++,g=e,o=!0,e},e},e.recurse=function(r,t){return l=null,g=r,d=t,u=!0,a=!1,c=!1,s=!1,i=!1,e.run=function(){var e;return e=n(g),g=e,o=!0,e},e},e.isFinished=function(){var n=!o||c||a||s||i||u;return n&&(a||u)&&g===d&&(n=!1),n&&c&&g!==m&&(n=!1),n&&(s||i)&&f>=h&&(n=!1),!n},e.onComplete=function(n){return t=n||null,e},e.complete=function(){return t&&isFunction(t)&&t(),e}},Asynchronous=exports.Asynchronous=function(n,e){if(is_instance(n,Task))return n;if(isFunction(n))return new Task(n);if(!is_instance(this,Asynchronous))return new Asynchronous(n);var r=this;r.$interval=arguments.length?parseInt(n,10):DEFAULT_INTERVAL,r.$timer=null,r.$runmode=NONE,r.$running=!1,r.$queue=[],isThread&&!1!==e&&r.initThread()};if(Asynchronous.VERSION="0.4.2",Asynchronous.Thread=Thread,Asynchronous.Task=Task,Asynchronous.MODE={NONE:NONE,INTERLEAVE:INTERLEAVED,LINEAR:LINEARISED,PARALLEL:PARALLELISED,SEQUENCE:SEQUENCED},Asynchronous.Platform={UNDEFINED:UNDEFINED,UNKNOWN:UNKNOWN,NODE:NODE,BROWSER:BROWSER},Asynchronous.supportsMultiThreading=function(){return supportsMultiThread},Asynchronous.isPlatform=function(n){return NODE===n?isNode:BROWSER===n?isBrowser:undef},Asynchronous.isThread=function(n){return NODE===n?isNodeProcess:BROWSER===n?isWebWorker:isThread},Asynchronous.path=path,Asynchronous.blob=blobURL,Asynchronous.load=function(n,e,r){if(n){e&&e.length&&(e=e.filter(notThisPath),e.length&&importScripts(e.join(","))),n=n.split(".");for(var t=root;n.length;)n[0]&&n[0].length&&t[n[0]]&&(t=t[n[0]]),n.shift();if(t&&root!==t)return isFunction(t)?!1!==r?new t:t():t}return null},Asynchronous.serialize=function(n){n=n||new Asynchronous;var e=function(e){var r=function(){var r=this,t=slice(arguments);n.step(function(){e.apply(r,t)}),n.$running||n.run(LINEARISED)};return r.free=function(){return e},r};return e.free=function(){n&&n.dispose(),n=null},e},Asynchronous[PROTO]={constructor:Asynchronous,$interval:DEFAULT_INTERVAL,$timer:null,$queue:null,$thread:null,$events:null,$runmode:NONE,$running:!1,dispose:function(){var n=this;return n.unfork(),n.$timer&&ClearTime(n.$timer),n.$thread=null,n.$timer=null,n.$interval=null,n.$queue=null,n.$runmode=NONE,n.$running=!1,n},empty:function(){var n=this;return n.$timer&&ClearTime(n.$timer),n.$timer=null,n.$queue=[],n.$runmode=NONE,n.$running=!1,n},interval:function(n){return arguments.length?(this.$interval=parseInt(n,10),this):this.$interval},fork:function(n,e,r){var t,o,s,i=this;if(!i.$thread){if(!supportsMultiThread)throw i.$thread=null,new Error("Asynchronous: Multi-Threading is NOT supported!");isNode?(o="Asynchronous: Thread (Process): ",s="Asynchronous: Thread (Process) Error: "):(o="Asynchronous: Thread (Worker): ",s="Asynchronous: Thread (Worker) Error: "),i.$events=i.$events||{},t=i.$thread=new Thread(tpf),t.onmessage=function(n){if(n.data.event){var e=n.data.event,r=n.data.data||null;i.$events&&i.$events[e]?i.$events[e](r):("console.log"===e||"console.error"===e)&&console.log(o+(r.output||""))}},t.onerror=function(n){if(!i.$events||!i.$events.error)throw new Error(s+n.message+" file: "+n.filename+" line: "+n.lineno);i.$events.error(n)},i.send("initThread",{component:n||null,asInstance:!1!==r,imports:e?[].concat(e):null})}return i},unfork:function(){var n=this;return n.$thread&&n.send("dispose"),n.$thread=null,n.$events=null,n},initThread:function(){var n=this;return isThread&&(n.$events={},onMessage(function(e){var r=e.data.event,t=e.data.data||null;r&&n.$events[r]?n.$events[r](t):"dispose"===r&&(n.dispose(),close())})),n},listen:function(n,e){return n&&isFunction(e)&&this.$events&&(this.$events[n]=e),this},unlisten:function(n,e){return n&&this.$events&&this.$events[n]&&(2>arguments.length||e===this.$events[n])&&delete this.$events[n],this},send:function(n,e){return n&&(isThread?postMessage({event:n,data:e||null}):this.$thread&&this.$thread.postMessage({event:n,data:e||null})),this},task:function(n){return is_instance(n,Task)?n:isFunction(n)?Task(n):void 0},iif:function(){var n=slice(arguments),e=new Task;return e.iif.apply(e,n)},until:function(){var n=slice(arguments),e=new Task(n.pop());return e.until.apply(e,n)},untilNot:function(){var n=slice(arguments),e=new Task(n.pop());return e.untilNot.apply(e,n)},loop:function(){var n=slice(arguments),e=new Task(n.pop());return e.loop.apply(e,n)},each:function(){var n=slice(arguments),e=new Task(n.pop());return e.each.apply(e,n)},recurse:function(){var n=slice(arguments),e=new Task(n.pop());return e.recurse.apply(e,n)},step:function(n){var e=this;return n&&e.$queue.push(e.task(n).queue(e)),e},steps:function(){var n,e,r=this,t=slice(arguments);for(e=t.length,n=0;e>n;n++)r.step(t[n]);return r},jumpNext:function(n,e){var r=this,t=r.$queue;return e=e||0,!1!==n?function(){return e<t.length&&(e>0&&t.splice(0,e),r.run(r.$runmode)),r}:(e<t.length&&(e>0&&t.splice(0,e),r.run(r.$runmode)),r)},jumpNextWithArgs:function(n,e,r){var t=this,o=t.$queue;return e=e||0,!1!==n?function(){return e<o.length&&(e>0&&o.splice(0,e),t.run(t.$runmode,slice(arguments))),t}:(e<o.length&&(e>0&&o.splice(0,e),t.run(t.$runmode,r)),t)},abort:function(n,e){var r=this;return!1!==n?function(){return e&&e>0?SetTime(function(){r.empty()},e):r.empty(),r}:(e&&e>0?SetTime(function(){r.empty()},e):r.empty(),r)},run:function(n,e){var r=this;return arguments.length?r.$runmode=n:n=r.$runmode,e=e||null,SEQUENCED===n?runSequenced(r,e):INTERLEAVED===n?runInterleaved(r,e):LINEARISED===n?runLinearised(r,e):PARALLELISED===n&&runParallelised(r,e),r}},isThread){var Component=null;root.console={log:function(n){postMessage({event:"console.log",data:{output:n||""}})},error:function(n){postMessage({event:"console.error",data:{output:n||""}})}},onMessage(function(n){var e=n.data.event,r=n.data.data||null;switch(e){case"initThread":r&&r.component&&(Component&&(isFunction(Component.dispose)&&Component.dispose(),Component=null),Component=Asynchronous.load(r.component,r.imports,r.asInstance));break;case"dispose":default:Component&&(isFunction(Component.dispose)&&Component.dispose(),Component=null),close()}})}}(this,exports),exports.Asynchronous});
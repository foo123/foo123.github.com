/**
*  Unicache
*  An agnostic caching framework for PHP, Node.js, Browser, Python
*
*  @version: 1.2.0
*  https://github.com/foo123/Unicache
*
**/
!function(e,t,n){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[t]=n.call(e)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["module"],function(t){return n.moduleUri=t.uri,n.call(e)}):t in e||(e[t]=n.call(e)||1)&&"function"==typeof define&&define.amd&&define(function(){return e[t]})}("undefined"!=typeof self?self:this,"UNICACHE",function(e){"use strict";var t=new Error("Not Implemented!"),n={};n.Cache=function(){},n.Cache.prototype={constructor:n.Cache,dispose:function(){return this},supportsSync:function(){return!1},prefix:"",setPrefix:function(e){return this.prefix=e?""+e:"",this},get:function(e,n){throw t},put:function(e,n,i,o){throw t},remove:function(e,n){throw t},clear:function(e){throw t},gc:function(e,n){throw t},getPromise:function(e){var t=this;return"function"==typeof Promise?new Promise(function(n,i){t.get(e,function(e,t){e?i(e):n(t)})}):null},putPromise:function(e,t,n){var i=this;return"function"==typeof Promise?new Promise(function(o,r){i.put(e,t,n,function(e,t){e?r(e):o(t)})}):null},removePromise:function(e){var t=this;return"function"==typeof Promise?new Promise(function(n,i){t.remove(e,function(e,t){e?i(e):n(t)})}):null},clearPromise:function(){var e=this;return"function"==typeof Promise?new Promise(function(t,n){e.clear(function(e,i){e?n(e):t(i)})}):null},gcPromise:function(e){var t=this;return"function"==typeof Promise?new Promise(function(n,i){t.gc(e,function(e,t){e?i(e):n(t)})}):null}};var i=n._={ESC_RE:/([[\]().?/*{}+$^:\\])/g,TRIM_RE:null,LTRIM_RE:null,RTRIM_RE:null,time:function(){return Math.floor((new Date).getTime()/1e3)},serialize:function(e){return JSON.stringify(e)},unserialize:function(e){return JSON.parse(e)},isset:function(e,t,n){var i=!(!e||!Object.prototype.hasOwnProperty.call(e,t));return!0===n?i&&null!=e[t]:i},trim:function(e,t){var n;return 2>arguments.length?(this.TRIM_RE||(this.TRIM_RE=new RegExp("^[ \\s ]+|[ \\s ]+$","g")),n=this.TRIM_RE):(t=(""+t).replace(this.ESC_RE,"\\$1"),n=new RegExp("^["+t+"]+|["+t+"]+$","g")),(""+e).replace(n,"")},ltrim:function(e,t){var n;return 2>arguments.length?(this.LTRIM_RE||(this.LTRIM_RE=new RegExp("^[ \\s ]+","g")),n=this.LTRIM_RE):(t=(""+t).replace(this.ESC_RE,"\\$1"),n=new RegExp("^["+t+"]+","g")),(""+e).replace(n,"")},rtrim:function(e,t){var n;return 2>arguments.length?(this.RTRIM_RE||(this.RTRIM_RE=new RegExp("[ \\s ]+$","g")),n=this.RTRIM_RE):(t=(""+t).replace(this.ESC_RE,"\\$1"),n=new RegExp("["+t+"]+$","g")),(""+e).replace(n,"")}};return n.Factory=function(){},n.Factory.VERSION="1.2.0",n.Factory.getCache=function(e){var t=i.isset(e,"cacheType",!0)?(""+e.cacheType).toUpperCase():"MEMORY",o=null;switch(t){case"INDEXEDDB":if(!n.IndexedDbCache||!n.IndexedDbCache.isSupported())throw new ReferenceError('UNICACHE: Cache "'+t+'" is NOT supported!');o=new n.IndexedDbCache;break;case"WEBSQL":if(!n.WebSqlCache||!n.WebSqlCache.isSupported())throw new ReferenceError('UNICACHE: Cache "'+t+'" is NOT supported!');o=new n.WebSqlCache;break;case"SESSIONSTORAGE":if(!n.SessionStorageCache||!n.SessionStorageCache.isSupported())throw new ReferenceError('UNICACHE: Cache "'+t+'" is NOT supported!');o=new n.SessionStorageCache;break;case"LOCALSTORAGE":if(!n.LocalStorageCache||!n.LocalStorageCache.isSupported())throw new ReferenceError('UNICACHE: Cache "'+t+'" is NOT supported!');o=new n.LocalStorageCache;break;case"COOKIE":if(!n.CookieCache||!n.CookieCache.isSupported())throw new ReferenceError('UNICACHE: Cache "'+t+'" is NOT supported!');o=new n.CookieCache;break;default:if(!n.MemoryCache||!n.MemoryCache.isSupported())throw new ReferenceError('UNICACHE: Cache "MEMORY" is NOT supported!');o=new n.MemoryCache}return o.setPrefix(i.isset(e,"prefix",!0)?e.prefix:""),o},function(e){var t="prototype",n=e._,i=e.MemoryCache=function(){this._cache={}};i[t]=Object.create(e.Cache[t]),i.isSupported=function(){return!0},i[t]._cache=null,i[t].dispose=function(){this._cache=null},i[t].supportsSync=function(){return!0},i[t].put=function(e,t,i,o){return this._cache[this.prefix+e]=[n.time()+i,t],"function"==typeof o&&o(null,!0),!0},i[t].get=function(e,t){var i;if(n.isset(this._cache,this.prefix+e,!0)){var o=this._cache[this.prefix+e];!o||n.time()>o[0]?(delete this._cache[this.prefix+e],i=!1):i=o[1]}else i=!1;if("function"!=typeof t)return i;t(null,i)},i[t].remove=function(e,t){var i;if(n.isset(this._cache,this.prefix+e)?(delete this._cache[this.prefix+e],i=!0):i=!1,"function"!=typeof t)return i;t(null,i)},i[t].clear=function(e){if(this.prefix.length)for(key in this._cache)n.isset(this._cache,key)&&0===key.indexOf(this.prefix)&&delete this._cache[key];else this._cache={};if("function"!=typeof e)return!0;e(null,!0)},i[t].gc=function(e,t){e=+e;var i=n.time(),o=this.prefix.length;for(key in this._cache)n.isset(this._cache,key)&&(o&&0!==key.indexOf(this.prefix)||this._cache[key][0]-i<e&&delete this._cache[key]);if("function"!=typeof t)return!0;t(null,!0)}}(n),function(e){function t(e){return decodeURIComponent(String(e))}function n(e){return encodeURIComponent(String(e)).split("!").join("%21").split("'").join("%27").split("(").join("%28").split(")").join("%29").split("*").join("%2A")}function i(e){return t(String(e).split("+").join("%20"))}function o(e){return n(String(e)).split("%20").join("+")}function r(e){var t,n,o,r,u,c,f={};for(t=0,n=(e=(e||document.cookie||"").split(";")).length;t<n;t++)-1!==(o=e[t]).indexOf("=")&&(c=a.trim(o).split("=",2),r=a.trim(c[0]),u=a.trim(c[1]),0===(r=i(r)).indexOf(s)&&r.length>s.length&&(u=i(u),f[r.slice(s.length)]=a.unserialize(u)));return f}function u(e){var t=!!e.raw,i=(t?s+String(e.name):o(s+String(e.name)))+"=";return null==e.value||""===e.value?i+="deleted; expires="+new Date(1e3*(a.time()-31536001)).toUTCString():(i+=t?String(e.value):n(e.value),0!==e.expires&&(i+="; expires="+new Date(1e3*e.expires).toUTCString())),e.path&&(i+="; path="+String(e.path)),e.domain&&(i+="; domain="+String(e.domain)),document.cookie=i}function c(e){u({name:e,value:null})}var f="prototype",s="UNICACHE_",a=e._,l=e.CookieCache=function(){this._cookie=r()};l[f]=Object.create(e.Cache[f]),l.isSupported=function(){return!0},l[f]._cookie=null,l[f].dispose=function(){this._cookie=null},l[f].supportsSync=function(){return!0},l[f].put=function(e,t,n,i){var o=this.prefix+e,r=[a.time()+n,t];return this._cookie[o]=r,u({name:o,value:a.serialize(r),expires:r[0]}),"function"==typeof i&&i(null,!0),!0},l[f].get=function(e,t){var n;if(a.isset(this._cookie,this.prefix+e,!0)){var i=this._cookie[this.prefix+e];!i||a.time()>i[0]?(delete this._cookie[this.prefix+e],c(this.prefix+e),n=!1):n=i[1]}else n=!1;if("function"!=typeof t)return n;t(null,n)},l[f].remove=function(e,t){var n;if(a.isset(this._cookie,this.prefix+e)?(delete this._cookie[this.prefix+e],c(this.prefix+e),n=!0):n=!1,"function"!=typeof t)return n;t(null,n)},l[f].clear=function(e){for(var t in this._cookie)a.isset(this._cookie,t)&&(this.prefix.length&&0!==t.indexOf(this.prefix)||(delete this._cookie[t],c(t)));if("function"!=typeof e)return!0;e(null,!0)},l[f].gc=function(e,t){e=+e;var n=a.time(),i=this.prefix.length;for(key in this._cookie)a.isset(this._cookie,key)&&(i&&0!==key.indexOf(this.prefix)||this._cookie[key][0]-n<e&&(delete this._cookie[key],c(key)));if("function"!=typeof t)return!0;t(null,!0)}}(n),function(e){function t(e){if(!((e=e||"localStorage")in a))return!1;try{var t="___UNICACHE___";return a[e].setItem(t,t),a[e].getItem(t),a[e].removeItem(t),!0}catch(e){return!1}}function n(e,t,n){a.localStorage.setItem(c+e,t),a.localStorage.setItem(f+e,+n)}function i(e){return{data:a.localStorage.getItem(c+e),expires:o(e)}}function o(e){var t=a.localStorage.getItem(f+e);return t?parseInt(t,10):null}function r(e){a.localStorage.removeItem(c+e),a.localStorage.removeItem(f+e)}var u="prototype",c="UNICACHE_",f="UNICACHEEXPIRES_",s=e._,a="undefined"!=typeof window?window:"undefined"!=typeof self?self:this,l=e.LocalStorageCache=function(){};l[u]=Object.create(e.Cache[u]),l.isSupported=function(){return t("localStorage")},l[u].supportsSync=function(){return!0},l[u].put=function(e,t,i,o){var r=[s.time()+i,t];return n(this.prefix+e,s.serialize(r),r[0]),"function"==typeof o&&o(null,!0),!0},l[u].get=function(e,t){var n,o=i(this.prefix+e),u=s.time();if(o.data?(o.data=s.unserialize(o.data),!o.data||o.data[0]<u||o.expires<u?(r(this.prefix+e),n=!1):n=o.data[1]):n=!1,"function"!=typeof t)return n;t(null,n)},l[u].remove=function(e,t){if(r(this.prefix+e),"function"!=typeof t)return!0;t(null,!0)},l[u].clear=function(e){for(var t,n=[],i=0,o=a.localStorage.length;i<o;i++)0===(t=a.localStorage.key(i)).indexOf(c)&&(t=t.slice(c.length),this.prefix.length&&0!==t.indexOf(this.prefix)||n.push(t));if(n.map(function(e){r(e)}),"function"!=typeof e)return!0;e(null,!0)},l[u].gc=function(e,t){e=+e;for(var n,i=s.time(),u=this.prefix.length,c=[],l=0,p=a.localStorage.length;l<p;l++)0===(n=a.localStorage.key(l)).indexOf(f)&&(n=n.slice(f.length),u&&0!==n.indexOf(this.prefix)||o(n)-i<e&&c.push(n));if(c.map(function(e){r(e)}),"function"!=typeof t)return!0;t(null,!0)}}(n),function(e){function t(e){if(!((e=e||"localStorage")in a))return!1;try{var t="___UNICACHE___";return a[e].setItem(t,t),a[e].getItem(t),a[e].removeItem(t),!0}catch(e){return!1}}function n(e,t,n){a.sessionStorage.setItem(c+e,t),a.sessionStorage.setItem(f+e,+n)}function i(e){return{data:a.sessionStorage.getItem(c+e),expires:o(e)}}function o(e){var t=a.sessionStorage.getItem(f+e);return t?parseInt(t,10):null}function r(e){a.sessionStorage.removeItem(c+e),a.sessionStorage.removeItem(f+e)}var u="prototype",c="UNICACHE_",f="UNICACHEEXPIRES_",s=e._,a="undefined"!=typeof window?window:"undefined"!=typeof self?self:this,l=e.SessionStorageCache=function(){};l[u]=Object.create(e.Cache[u]),l.isSupported=function(){return t("sessionStorage")},l[u].supportsSync=function(){return!0},l[u].put=function(e,t,i,o){var r=[s.time()+i,t];return n(this.prefix+e,s.serialize(r),r[0]),"function"==typeof o&&o(null,!0),!0},l[u].get=function(e,t){var n,o=i(this.prefix+e),u=s.time();if(o.data?(o.data=s.unserialize(o.data),!o.data||o.data[0]<u||o.expires<u?(r(this.prefix+e),n=!1):n=o.data[1]):n=!1,"function"!=typeof t)return n;t(null,n)},l[u].remove=function(e,t){if(r(this.prefix+e),"function"!=typeof t)return!0;t(null,!0)},l[u].clear=function(e){for(var t,n=[],i=0,o=a.sessionStorage.length;i<o;i++)0===(t=a.sessionStorage.key(i)).indexOf(c)&&(t=t.slice(c.length),this.prefix.length&&0!==t.indexOf(this.prefix)||n.push(t));if(n.map(function(e){r(e)}),"function"!=typeof e)return!0;e(null,!0)},l[u].gc=function(e,t){e=+e;for(var n,i=s.time(),u=this.prefix.length,c=[],l=0,p=a.sessionStorage.length;l<p;l++)0===(n=a.sessionStorage.key(l)).indexOf(f)&&(n=n.slice(f.length),u&&0!==n.indexOf(this.prefix)||o(n)-i<e&&c.push(n));if(c.map(function(e){r(e)}),"function"!=typeof t)return!0;t(null,!0)}}(n),function(e){function t(e,t,n,i,o,u){var c=e.transaction([t],"readwrite").objectStore(t).put([r.time()+o,i],n);c.onerror=function(e){"function"==typeof u&&u(new Error('Setting "'+n+'" failed!'),null)},c.onsuccess=function(e){"function"==typeof u&&u(null,!0)}}function n(e,t,n,i){var o=e.transaction([t],"readonly").objectStore(t).get(n);o.onerror=function(e){"function"==typeof i&&i(new Error('Retrieving "'+n+'" failed!'),null)},o.onsuccess=function(e){"function"==typeof i&&i(null,o.result)}}function i(e,t,n,i){var o=e.transaction([t],"readwrite").objectStore(t).delete(n);o.onerror=function(e){"function"==typeof i&&i(new Error('Deleting "'+n+'" failed!'),null)},o.onsuccess=function(e){"function"==typeof i&&i(null,!0)}}var o="prototype",r=e._,u="unicache_db_store_",c="undefined"!=typeof window?window:"undefined"!=typeof self?self:this,f=function(){var e={db:null,transaction:{READ_WRITE:"readwrite"},keyrange:null};try{void 0!==c.indexedDB?e.db=c.indexedDB:void 0!==c.webkitIndexedDB?e.db=c.webkitIndexedDB:void 0!==c.mozIndexedDB?e.db=c.mozIndexedDB:void 0!==c.OIndexedDB?e.db=c.OIndexedDB:void 0!==c.msIndexedDB&&(e.db=c.msIndexedDB)}catch(e){}try{void 0!==c.IDBTransaction?e.transaction=c.IDBTransaction:void 0!==c.webkitIDBTransaction?e.transaction=c.webkitIDBTransaction:void 0!==c.msIDBTransaction&&(e.transaction=c.msIDBTransaction)}catch(e){}try{void 0!==c.IDBKeyRange?e.keyrange=c.IDBKeyRange:void 0!==c.webkitIDBKeyRange?e.keyrange=c.webkitIDBKeyRange:void 0!==c.msIDBKeyRange&&(e.keyrange=c.msIDBKeyRange)}catch(e){}return e}(),s=e.IndexedDbCache=function(){this.queue=[]};s[o]=Object.create(e.Cache[o]),s.isSupported=function(){return!!f.db},s[o].request=null,s[o].db=null,s[o].queue=null,s[o].open=function(e){var t=this;return t.request?null==t.db?t.queue&&"function"==typeof e&&t.queue.push(e):!1===t.db?"function"==typeof e&&e(new Error("IndexedDB cannot be opened"),null):t.db&&"function"==typeof e&&e(null,t.db):(t.queue&&"function"==typeof e&&t.queue.push(e),t.request=f.db.open("unicache-indexeddb-cache-db",1),t.request.onerror=function(e){if(t.db=!1,t.queue){var n=new Error("IndexedDB Open Error with code "+t.request.errorCode);t.queue.map(function(e){e(n,null)}),t.queue=null}},t.request.onblocked=function(e){console.warn("UNICACHE: Please close all other tabs with this site open!")},t.request.onupgradeneeded=function(e){e.target.result.createObjectStore(u+t.prefix)},t.request.onsuccess=function(e){t.db=e.target.result,t.db.onclose=function(e){t.db=null},t.db.onversionchange=function(e){t.db.close(),t.db=null},t.queue&&(t.queue.map(function(e){e(null,t.db)}),t.queue=null)}),this},s[o].close=function(){return this.db&&(this.db.close(),this.db=null),this},s[o].dispose=function(){return this.close(),this.db=null,this.request=null,this.queue=null,e.Cache.call(this),this},s[o].supportsSync=function(){return!1},s[o].put=function(e,n,i,o){var r=this;r.open(function(c,f){c?"function"==typeof o&&o(c,null):t(f,u+r.prefix,e,n,+i,function(e,t){"function"==typeof o&&o(e,t)})})},s[o].get=function(e,t){var o=this;o.open(function(c,f){c?"function"==typeof t&&t(c,null):n(f,u+o.prefix,e,function(n,c){"function"==typeof t?n?t(n,null):c?c[0]<r.time()?(i(f,u+o.prefix,e),t(null,!1)):t(null,c[1]):t(null,!1):!n&&c&&c[0]<r.time()&&i(f,u+o.prefix,e)})})},s[o].remove=function(e,t){var n=this;n.open(function(o,r){o?"function"==typeof t&&t(o,null):i(r,u+n.prefix,e,function(e,n){"function"==typeof t&&t(e,n)})})},s[o].clear=function(e){var t=this;t.open(function(n,i){if(n)"function"==typeof e&&e(n,null);else{var o=i.transaction(u+t.prefix,"readwrite").objectStore(u+t.prefix).clear();o.onerror=function(t){"function"==typeof e&&e(new Error("Error clearing store "+t.target.errorCode),null)},o.onsuccess=function(t){"function"==typeof e&&e(null,!0)}}})},s[o].gc=function(e,t){e=+e;var n=r.time(),o=this;o.open(function(r,c){if(r)"function"==typeof t&&t(r,null);else{var f=c.transaction(u+o.prefix,"readwrite").objectStore(u+o.prefix).openCursor(),s=[];f.onerror=function(e){"function"==typeof t&&t(new Error("Error looping through store "+e.target.errorCode),null)},f.onsuccess=function(r){var f=r.target.result;f?(f.value[0]-n<e&&s.push(f.key),f.continue()):setTimeout(function(){s.map(function(e){i(c,u+o.prefix,e)}),"function"==typeof t&&t(null,!0)},10)}}})}}(n),function(e){e._;var t=e.WebSqlCache=function(){};t.prototype=Object.create(e.Cache.prototype),t.isSupported=function(){return!1}}(n),n});
/**
*   Dialect,
*   a simple and flexible Cross-Platform & Cross-Vendor SQL Query Builder for PHP, Python, JavaScript
*
*   @version: 1.4.1
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(n,e,l){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(n.$deps=n.$deps||{})&&(n.EXPORTED_SYMBOLS=[e],n[e]=n.$deps[e]=l.call(n)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[e]=l.call(n)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["module"],function(e){return l.moduleUri=e.uri,l.call(n)}):e in n||(n[e]=l.call(n)||1)&&"function"==typeof define&&define.amd&&define(function(){return n[e]})}("undefined"!=typeof self?self:this,"Dialect",function(p){"use strict";var n="prototype",i=Object.keys,l=Object[n].toString,g=Object[n].hasOwnProperty,x="charAt",E=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,y=/^\s+|\s+$/g,H=String[n].trim?function(e){return e.trim()}:function(e){return e.replace(y,"")},a=String.fromCharCode(0);function W(){return W.GUID+=1,e((new Date).getTime().toString(16),12)+"--"+e(W.GUID.toString(16),4)}function m(e){return"function"==typeof e}function o(e,n,l){var t=this;if(!(t instanceof o))return new o(e,n,l);t.id=null,t.tpl=null,t._renderer=null,t._args=[e||"",n||o.defaultArgs,l],t._parsed=!1}function V(e,n){return!(!e||!g.call(e,n))}function e(e,n,l,t){var s=String(e);if(l=l||"0",t)for(;s.length<n;)s+=l;else for(;s.length<n;)s=l+s;return s}function P(e,n,l){for(var t,s="";n<l&&(" "===(t=e[x](n))||"\r"===t||"\t"===t||"\v"===t||"\0"===t);)s+=t,++n;return s}function N(e,n){var l,t,s,i=e.length;if(i&&n.length)for(l="",s=0;s<i;++s)l+=t=e[x](s),"\n"===t&&(l+=n);else l=e;return l}function b(e,n,l,t){var s,i,r,o,a=0;if(n)for(s=e,i=n.length,r=0,a=1;r<i;){if(o=n[r++],null==s||null==s[o]){a=0;break}s=s[o]}if(!a&&l)for(s=e,i=l.length,r=0,a=1;r<i;){if(o=l[r++],null==s||null==s[o]){a=0;break}s=s[o]}if(!a&&null!=t&&t!==e){if(n)for(s=t,i=n.length,r=0,a=1;r<i;){if(o=n[r++],null==s||null==s[o]){a=0;break}s=s[o]}if(!a&&l)for(s=t,i=l.length,r=0,a=1;r<i;){if(o=l[r++],null==s||null==s[o]){a=0;break}s=s[o]}}return a?s:null}function X(e,n){this.prev=e||null,this.value=n||null}function K(e,n){n&&(n.next=this),this.node=e||null,this.prev=n||null,this.next=null}function A(e,n,l,t,s,i,r){var o,a,u,c,f,d,p,h,_=null,E="";if(-1===n.type){if((o=n.opt_args)&&o.value[5])for(;o;){if(u=b(e,(a=o.value)[1],[String(a[0])],a[6]?null:r),null===_&&n.name===a[0]&&(_=u),0===a[2]&&null==u||1===a[2]&&null!=u)return"";o=o.prev}}else _=b(e,n.key,[String(n.name)],n.loc?null:r);if(h=(c=R(_))?_.length:-1,c&&h>n.start)for(f=n.start,d=-1===n.end?h-1:Math.min(n.end,h-1),p=f;p<=d;++p)E+=T(e,n.tpl,l,t,p,i,r);else c||n.start!==n.end||(E=T(e,n.tpl,l,t,null,i,r));return E}function T(e,n,l,t,s,i,r){for(var o,a,u,c,f,d,p,h,_,E,T,g,v=i=i||"",I="";n;)-1===(o=n.node.type)?I+=A(e,n.node,l,t,0,n.node.algn?v:i,r):1===o?I+=(a=e,u=n.node,c=l,f=t,d=s,p=n.node.algn?v:i,h=r,T=E=_=void 0,g="",u.stpl&&(V(c,u.stpl)||V(O.subGlobal,u.stpl)||V(f,u.stpl)||V(f,"*")||V(O.fnGlobal,u.stpl)||V(O.fnGlobal,"*"))?(E=b(a,u.key,[String(u.name)],u.loc?null:h),V(c,u.stpl)||V(O.subGlobal,u.stpl)?g=null==(E=null==d||0===d&&u.start===u.end&&u.opt||!R(E)?E:d<E.length?E[d]:null)&&null!==u.dval?u.dval:(_=(V(c,u.stpl)?c:O.subGlobal)[u.stpl].node,T={},null!=E&&(R(E)?T[_.name]=E:T=E),A(T,_,c,f,0,u.algn?p:"",null==h?a:h)):(T=null,V(f,u.stpl)?T=f[u.stpl]:V(f,"*")?T=f["*"]:V(O.fnGlobal,u.stpl)?T=O.fnGlobal[u.stpl]:O.fnGlobal["*"]&&(T=O.fnGlobal["*"]),R(E)&&(E=(d=null!=d?d:u.start)<E.length?E[d]:null),g=null==(E=m(T)?T(E,{symbol:u,index:d,currentArguments:a,originalArguments:h,alignment:p}):String(T))&&null!==u.dval?u.dval:String(E),u.algn&&(g=N(g,p)))):u.opt&&null!=u.dval?g=u.dval:(g=null==(E=R(E=b(a,u.key,[String(u.name)],u.loc?null:h))?(d=null!=d?d:u.start)<E.length?E[d]:null:E)&&null!==u.dval?u.dval:String(E),u.algn&&(g=N(g,p))),g):0===o?(v+=n.node.algn,I+=n.node.val):100===o&&(I+="\n"+(v=i)),n=n.next;return I}function O(e,n,l){var t=this;if(!(t instanceof O))return new O(e,n,l);t.id=null,t.tpl=null,t.fn={},t._args=[e||"",n||O.defaultDelimiters,l||!1]}function h(e,n){return new RegExp(e,n||"")}function _(e){return e.replace(E,"\\$&")}function C(e){return e instanceof String||"[object String]"===l.call(e)}function R(e){return e instanceof Array||"[object Array]"===l.call(e)}function v(e){return e instanceof Object||"[object Object]"===l.call(e)}function I(e){var n=l.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===n||"[object String]"===n)&&!e.length||(e instanceof Object||"[object Object]"===n)&&!i(e).length||!e}function t(e){return parseInt(e||0,10)||0}function S(e){return e===+e&&isFinite(e)&&!(e%1)}function w(e){return e===+e&&isFinite(e)}function L(e){return R(e)?e:[e]}function u(e,n,l){var t,s,i,r="";for(arguments.length<3&&(l="\\"),arguments.length<2&&(n="\\\"'"+a),t=0,s=e.length;t<s;++t)i=e[x](t),r+=-1===n.indexOf(i)?i:0===i.charCodeAt(0)?"\\0":l+i;return r}function r(e,n,l,t){for(var s in l=!0===l,t=!0===t,n)!g.call(n,s)||!l&&g.call(e,s)||(e[s]=t&&n[s].slice?n[s].slice():n[s]);return e}function c(e,n){var l=e.length;if(!l)return[];var t,s,i=15&l,r=1&i,o=new Array(l);for(r&&(o[0]=n(e[0])),t=r;t<i;t+=2)o[s=t]=n(e[s]),o[t+1]=n(e[s+1]);for(t=i;t<l;t+=16)o[s=t]=n(e[s]),o[t+1]=n(e[s+1]),o[t+2]=n(e[s+2]),o[t+3]=n(e[s+3]),o[t+4]=n(e[s+4]),o[t+5]=n(e[s+5]),o[t+6]=n(e[s+6]),o[t+7]=n(e[s+7]),o[t+8]=n(e[s+8]),o[t+9]=n(e[s+9]),o[t+10]=n(e[s+10]),o[t+11]=n(e[s+11]),o[t+12]=n(e[s+12]),o[t+13]=n(e[s+13]),o[t+14]=n(e[s+14]),o[t+15]=n(e[s+15]);return o}function f(e,n){var l=e.length;if(!l)return[];var t,s,i=15&l,r=1&i,o=[];for(r&&n(e[0])&&o.push(e[0]),t=r;t<i;t+=2)n(e[s=t])&&o.push(e[s]),n(e[++s])&&o.push(e[s]);for(t=i;t<l;t+=16)n(e[s=t])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]),n(e[++s])&&o.push(e[s]);return o}function s(e,n,l){var t,s,i="";if(e&&e.length)for(l=null==l?",":l,i=e[0][n],t=1,s=e.length;t<s;++t)i+=l+e[t][n];return i}function D(e,n,l,t,s,i,r,o,a,u,c){var f=this;if(f._col=e,f.col=n,f._tbl=l,f.tbl=t,f._dtb=s,f.dtb=i,f._alias=r,f._qualified=a,f.qualified=u,f.full=f.qualified,f._func=null==c?[]:c,f._func.length)for(var d=0,p=f._func.length;d<p;++d)f.full=f._func[d]+"("+f.full+")";null!=f._alias?(f.alias=o,f.aliased=f.full+" AS "+f.alias):(f.alias=f.full,f.aliased=f.full)}W.GUID=0,o.VERSION="1.0.0",o.defaultArgs=/\$(-?[0-9]+)/g,o.guid=W,o.multisplit=function(e,n,l){var t,s,i,r,o,a,u,c,f,d;for(t in l=!!l,a=[[1,e]],n)if(g.call(n,t)){for(c=[],s=l?n[t]:t,i=[0,n[t]],r=0,f=a.length;r<f;++r)if(1===a[r][0]){if(d=(u=a[r][1].split(s)).length,c.push([1,u[0]]),1<d)for(o=0;o<d-1;++o)c.push(i),c.push([1,u[o+1]])}else c.push(a[r]);a=c}return a},o.multisplit_re=function(e,n){n=n.global?n:new RegExp(n.source,n.ignoreCase?"gi":"g");for(var l,t=[],s=0;l=n.exec(e);)t.push([1,e.slice(s,n.lastIndex-l[0].length)]),t.push([0,l[1]||l[0]]),s=n.lastIndex;return t.push([1,e.slice(s)]),t},o.arg=function(e,n){var l,t,s,i,r,o="args";if(arguments.length&&null!=e)for(i=(e=e.substr?e.length?e.split("."):[]:[e]).length,r=!(!n||!n.substr),l=0;l<i;++l)s=+(t=e[l]),isNaN(s)?o+='["'+t+'"]':o+="["+(t=s<0?r?n+-s:o+".length-"+-s:t)+"]";return o},o.compile=function(e,n){var l,t,s,i,r=e.length;if(!0===n)for(i='"use strict"; return (',l=0;l<r;++l)t=e[l][0],s=e[l][1],i+=t?s:o.arg(s);else for(i='"use strict"; var argslen=args.length; return (',l=0;l<r;++l)t=e[l][0],s=e[l][1],i+=t?"'"+s.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+o.arg(s,"argslen")+") + ";return i+=");",new Function("args",i)},o[n]={constructor:o,id:null,tpl:null,_parsed:!1,_args:null,_renderer:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._parsed=null,e._args=null,e._renderer=null,e},fixRenderer:function(){var e=this;return e.render="function"==typeof e._renderer?e._renderer:e.constructor[n].render,e},parse:function(){var e,n,l,t=this;return!1===t._parsed&&(t._parsed=!0,e=t._args[0],n=t._args[1],l=t._args[2],t._args=null,t.tpl=n instanceof RegExp?o.multisplit_re(e,n):o.multisplit(e,n),!0===l)&&(t._renderer=o.compile(t.tpl),t.fixRenderer()),t},render:function(e){var n=this;if(e=e||[],!1===n._parsed&&(n.parse(),m(n._renderer)))return n._renderer(e);for(var l,t=n.tpl,s=t.length,i=e.length,r="",o=0;o<s;++o)1===(l=t[o])[0]?r+=l[1]:r+=e[l=+(l=l[1])===l&&l<0?i+l:l];return r}},O.VERSION="3.0.0",O.defaultDelimiters=["<",">","[","]"],O.fnGlobal={},O.subGlobal={},O.guid=W,O.multisplit=function(e,n,l){var t,s,i,r,o,a,u,c,f,d,p,h,_,E,T,g,v,I,m,k,N,b=n[0],U=n[1],A=n[2],O=n[3],G=b.length,F=U.length,j=A.length,R=O.length,Y="#"+O,S=null,w=0,L=0,y=0,q=0,M=e.length,C=[b,G,U,F],D=[A,j,O,R],B=[null,0,null,0,null,0,null,0];for(l=!0===l,g={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},n=a=new K({type:0,val:"",algn:""}),h={},_={},T=E=v=I=null,C[1]<C[3]&&(c=C[0],C[2]=C[0],C[0]=c,f=C[1],C[3]=C[1],C[1]=f),D[1]<D[3]&&(c=D[0],D[2]=D[0],D[0]=c,f=D[1],D[3]=D[1],D[1]=f),f=s=t=0;t<4&&s<4;)C[t+1]<D[s+1]?(B[f]=D[s],B[f+1]=D[s+1],s+=2):(B[f]=C[t],B[f+1]=C[t+1],t+=2),f+=2;for(;t<4;)B[f]=C[t],B[f+1]=C[t+1],t+=2,f+=2;for(;s<4;)B[f]=D[s],B[f+1]=D[s+1],s+=2,f+=2;for(r=null,c="",f=0;f<M;)if("\\"===(o=e[x](f)))c+=f+1<M?e[x](f+1):"",f+=2;else if(N=null,B[0]===e.substr(f,B[1])?N=B[0]:B[2]===e.substr(f,B[3])?N=B[2]:B[4]===e.substr(f,B[5])?N=B[4]:B[6]===e.substr(f,B[7])&&(N=B[6]),b===N)f+=G,c.length&&(0===a.node.type?a.node.val+=c:a=new K({type:0,val:c,algn:""},a)),c="";else if(U===N){if(f+=F,i=c,c="",-1<(m=i.indexOf("|"))?(S=i.slice(m+1),i=i.slice(0,m)):S=null,"?"===(o=l?f<M?e[x](f):"":i[x](0))||"*"===o)L=1,s="*"===o?-(t=1):t=0,l?(f+=1)<M&&"!"===e[x](f)?f+=w=1:w=0:i="!"===i[x](1)?(w=1,i.slice(2)):(w=0,i.slice(1));else if("{"===o){if(l){for(c="",d=f+1,p=M;d<p&&"}"!==e[x](d);)c+=e[x](d++);f=d+1}else{for(c="",d=1,p=i.length;d<p&&"}"!==i[x](d);)c+=i[x](d++);i=i.slice(d+1)}L=1<(c=c.split(",")).length?(t=(t=H(c[0])).length?0|+t:0,s=(s=H(c[1])).length?0|+s:-1,1):(s=t=(t=H(c[0])).length?0|+t:0,0),c="",w=0}else s=t=w=L=0;w&&null==S&&(S=""),"@"===(o=i[x](0))?i=i.slice(y=1):y=0,"."===(o=i[x](0))?i=i.slice(q=1):q=0,i=(m=-1<i.indexOf(":")?i.split(":"):[i,null])[0],m=m[1],u=-1<i.indexOf(".")?i.split("."):null,E&&!V(_,E)&&(_[E]={}),":="+A===e.substr(f,2+j)&&(f+=2,T=m=m&&m.length?m:"grtpl--"+W(),E)&&i.length&&(_[E][i]=m),i.length&&(null==m&&E&&V(_,E)&&V(_[E],i)&&(m=_[E][i]),L&&!g.opt?(g.name=i,g.key=u,g.stpl=m,g.dval=S,g.opt=L,g.neg=w,g.algn=y,g.loc=q,v=new X(null,[i,u,w,g.start=t,g.end=s,L,q])):L?(t!==s&&g.start===g.end&&(g.name=i,g.key=u,g.stpl=m,g.dval=S,g.opt=L,g.neg=w,g.algn=y,g.loc=q,g.start=t,g.end=s),v=new X(v,[i,u,w,t,s,L,q])):null==g.name&&(g.name=i,g.key=u,g.stpl=m,g.dval=S,g.opt=0,g.neg=w,g.algn=y,g.loc=q,v=new X(null,[i,u,w,g.start=t,g.end=s,0,q])),0===a.node.type&&(a.node.algn=P(a.node.val,0,a.node.val.length)),a=new K({type:1,name:i,key:u,stpl:m,dval:S,opt:L,algn:y,loc:q,start:t,end:s},a))}else if(A===N)if(f+=j,c.length&&(0===a.node.type?a.node.val+=c:a=new K({type:0,val:c,algn:""},a)),c="","#"===e[x](f)){for(d=f+1,p=M;d<p&&Y!==e.substr(d,R+1);)c+=e[x](d++);f=d+R+1,0===a.node.type&&(a.node.algn=P(a.node.val,0,a.node.val.length)),a=new K({type:-100,val:c},a),c=""}else r=new X(r,[a,I,g,v,E,T]),T&&(E=T),g={type:1,name:T=null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},v=null,I=a=new K({type:0,val:"",algn:""});else O===N?(f+=R,u=a,m=I,N=g,k=v,r?(a=r.value[0],I=r.value[1],g=r.value[2],v=r.value[3],E=r.value[4],T=r.value[5],r=r.prev):a=null,c.length&&(0===u.node.type?u.node.val+=c:u=new K({type:0,val:c,algn:""},u)),c="",T?(h[T]=new K({type:2,name:N.name,key:N.key,loc:N.loc,algn:N.algn,start:N.start,end:N.end,opt_args:null,tpl:m}),T=null):(0===a.node.type&&(a.node.algn=P(a.node.val,0,a.node.val.length)),a=new K({type:-1,name:N.name,key:N.key,loc:N.loc,algn:N.algn,start:N.start,end:N.end,opt_args:k,tpl:m},a))):"\n"===(o=e[x](f++))?(c.length&&(0===a.node.type?a.node.val+=c:a=new K({type:0,val:c,algn:""},a)),c="",0===a.node.type&&(a.node.algn=P(a.node.val,0,a.node.val.length)),a=new K({type:100,val:"\n"},a)):c+=o;return c.length&&(0===a.node.type?a.node.val+=c:a=new K({type:0,val:c,algn:""},a)),0===a.node.type&&(a.node.algn=P(a.node.val,0,a.node.val.length)),[n,h]},O.align=N,O.main=T,O[n]={constructor:O,id:null,tpl:null,fn:null,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e.fn=null,e._args=null,e},parse:function(){var e=this;return null===e.tpl&&null!=e._args&&(e.tpl=O.multisplit(e._args[0],e._args[1],e._args[2]),e._args=null),e},render:function(e){var n=this;return null==n.tpl&&n.parse(),O.main(null==e?{}:e,n.tpl[0],n.tpl[1],n.fn)}};var B=/\s/,k=/[0-9]/,U=/[a-z_]/i;D.parse=function(e,n){if(e instanceof D)return e;for(var l,t,s,i,r,o,a,u,c,f,d,p,h,_,E,T,g,v,I,m,N,b,A,O=["AS"],R=(e=H(e)).length,S=(t=[[]])[l=0],w=[],L=[],y="",q=i=0,M=c=u=r=s=null;l<R;)if("("===(o=e.charAt(l++))&&1===l)++q;else if(0<q){if('"'===o||"`"===o||"'"===o||"["===o||"]"===o)if(u){if(u===o)if(f=('"'===o||"`"===o)&&n.qn[3]===o+o||"'"===o&&n.q[3]===o+o,d=('"'===o||"`"===o)&&n.qn[3]==="\\"+o||"'"===o&&n.q[3]==="\\"+o,f&&l<R&&o===e.charAt(l))++l;else if(d){if(p=!1,-1===n.e[1].indexOf("'\\'")||"'\\'"!==e.slice(c,l))for(h=l-2;0<=h&&"\\"===e.charAt(h);)p=!p,--h;p||(c=u=null)}else c=u=null}else u="["===o?"]":o,c=l-1;else if(!u)if("("===o)++q;else if(")"===o){if(--q<0){s=["paren",l];break}if(0===q){if(u){s=["quote",l];break}y=M=e.slice(0,l)}}}else{if('"'===o||"`"===o||"'"===o||"["===o||"]"===o){if(!r){if(y.length||"]"===o){s=["invalid",l];break}r="["===o?"]":o;continue}if(r===o){if(l<R&&o===e.charAt(l)){y+=o,++l;continue}if(!y.length){s=["invalid",l];break}S.unshift([1,y]),w.unshift(y),y="",r=null;continue}if(r){y+=o;continue}}if(r)y+=o;else if("*"===o){if(y.length){s=["invalid",l];break}S.unshift([10,"*"]),w.unshift(10)}else if("."===o){if(y.length&&(S.unshift([1,y]),w.unshift(y),y=""),!S.length||1!==S[0][0]){s=["invalid",l];break}S.unshift([0,"."]),w.unshift(0)}else if("("===o){if(++i,y.length&&(S.unshift([2,y]),L.unshift(y),y=""),!S.length||2!==S[0][0]&&1!==S[0][0]){s=["invalid",l];break}1===S[0][0]&&(S[0][0]=2,L.unshift(w.shift())),t.unshift([]),S=t[0]}else if(")"===o){if(--i,y.length&&(a=-1<O.indexOf(y.toUpperCase()),S.unshift([a?5:1,y]),w.unshift(a?5:y),y=""),t.length<2){s=["invalid",l];break}t[1].unshift([100,t.shift()]),S=t[0]}else if(B.test(o))y.length&&(a=-1<O.indexOf(y.toUpperCase()),S.unshift([a?5:1,y]),w.unshift(a?5:y),y="");else{if(k.test(o)){if(!y.length){s=["invalid",l];break}}else if(!U.test(o)){s=["invalid",l];break}y+=o}}if(y.length&&(S.unshift([1,y]),w.unshift(y),y=""),s=(s=(s=s||!i&&!q?s:["paren",R])||!r&&!u?s:["quote",R])||1===t.length?s:["invalid",R])throw m=s[1]-1,"paren"==(N=s[0])?new TypeError('Dialect: Mismatched parentheses "'+e+'" at position '+m+"."):"quote"==N?new TypeError('Dialect: Mismatched quotes "'+e+'" at position '+m+"."):new TypeError('Dialect: Invalid character "'+e+'" at position '+m+".");return N="",A=(m=null)!=M?(3<=w.length&&5===w[1]&&C(w[0])&&(m=w.shift(),N=n.quote_name(m),w.shift()),v=T=null,I=g="",E=b=_=M):(3<=w.length&&5===w[1]&&C(w[0])&&(m=w.shift(),N=n.quote_name(m),w.shift()),_=null,E="",w.length&&(C(w[0])||10===w[0])&&(10===w[0]?(w.shift(),_=E="*"):(_=w.shift(),E=n.quote_name(_))),T=null,g="",2<=w.length&&0===w[0]&&C(w[1])&&(w.shift(),T=w.shift(),g=n.quote_name(T)),v=null,I="",2<=w.length&&0===w[0]&&C(w[1])&&(w.shift(),v=w.shift(),I=n.quote_name(v)),b=(v?v+".":"")+(T?T+".":"")+(_||""),(v?I+".":"")+(T?g+".":"")+(_?E:"")),new D(_,E,T,g,v,I,m,N,b,A,L)},D[n]={constructor:D,_func:null,_col:null,col:null,_tbl:null,tbl:null,_dtb:null,dtb:null,_alias:null,alias:null,_qualified:null,qualified:null,full:null,aliased:null,cloned:function(e,n,l){var t=this;return n=arguments.length?n||e:(e=t._alias,t.alias),null==l&&(l=t._func),new D(t._col,t.col,t._tbl,t.tbl,t._dtb,t.dtb,e,n,t._qualified,t.qualified,l)},dispose:function(){var e=this;return e._func=null,e._col=null,e.col=null,e._tbl=null,e.tbl=null,e._dtb=null,e.dtb=null,e._alias=null,e.alias=null,e._qualified=null,e.qualified=null,e.full=null,e.aliased=null,e}};function d(e){var n=this;if(arguments.length||(e="mysql"),!(n instanceof d))return new d(e);if(!(e=e&&g.call(d.aliases,e)?d.aliases[e]:e)||!d.dialects[e]||!d.dialects[e].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+e+'"');n.clau=null,n.clus=null,n.tbls=null,n.cols=null,n.vews={},n.tpls={},n.db=null,n.escdb=null,n.escdbn=null,n.p="",n.type=e,n.clauses=d.dialects[n.type].clauses,n.q=d.dialects[n.type].quotes[0],n.qn=d.dialects[n.type].quotes[1],n.e=d.dialects[n.type].quotes[2]||["","","",""]}return d.VERSION="1.4.1",d.dialects={mysql:{quotes:[["'","'","\\'","\\'"],["`","`","``","``"],["","","",""]],functions:{strpos:["POSITION(",2," IN ",1,")"],strlen:["LENGTH(",1,")"],strlower:["LCASE(",1,")"],strupper:["UCASE(",1,")"],trim:["TRIM(",1,")"],quote:["QUOTE(",1,")"],random:"RAND()",now:"NOW()"},types:{SMALLINT:["TINYINT(",[1,"255"],") UNSIGNED"],SIGNED_SMALLINT:["TINYINT(",[1,"255"],")"],INT:["INT(",[1,"255"],") UNSIGNED"],SIGNED_INT:["INT(",[1,"255"],")"],BIGINT:["BIGINT(",[1,"255"],") UNSIGNED"],SIGNED_BIGINT:["BIGINT(",[1,"255"],")"],FLOAT:["FLOAT(",[1,"24"],")"],DOUBLE:["FLOAT(",[1,"53"],")"],BOOL:"TINYINT(1)",TIMESTAMP:"TIMESTAMP",DATETIME:"DATETIME",DATE:"DATE",TIME:"TIME",VARBINARY:["VARBINARY(",[1,"255"],")"],VARCHAR:["VARCHAR(",[1,"255"],")"],TEXT:"TEXT",BLOB:"BLOB",JSON:"JSON"},clauses:{start_transaction:"START TRANSACTION <type|>;",commit_transaction:"COMMIT;",rollback_transaction:"ROLLBACK;",transact:"START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]",create:"[<?view|>CREATE VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]UNIQUE KEY <name|> <type|> (<?uniquekey>[,<*uniquekey>])][[CONSTRAINT <?constraint> ]PRIMARY KEY <type|> (<?primarykey>)][[<?!index>KEY][<?index|>INDEX] <name|> <type|> (<?key>[,<*key>])][CHECK (<?check>)][<?column> <type>[ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ <?auto_increment|>AUTO_INCREMENT][ <?!primary><?unique|>UNIQUE KEY][ <?!unique><?primary|>PRIMARY KEY][ COMMENT '<?comment>'][ COLUMN_FORMAT <?format>][ STORAGE <?storage>]]][,\n<*col:COL>]]\n)][ <?options>:=[<opt:OPT>:=[[ENGINE=<?engine>][AUTO_INCREMENT=<?auto_increment>][CHARACTER SET=<?charset>][COLLATE=<?collation>]][, <*opt:OPT>]]][\nAS <?query>]]",alter:"ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]",drop:"DROP [<?view|>VIEW][<?!view>[<?temporary|>TEMPORARY ]TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]",union:"(<union_selects>)[\nUNION[<?union_all|> ALL]\n(<*union_selects>)][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]",delete:"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]"}},postgresql:{quotes:[["'","'","''","''"],['"','"','""','""'],["E","","E",""]],functions:{strpos:["position(",2," in ",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:"random()",now:"now()"},types:{SMALLINT:"SMALLSERIAL",SIGNED_SMALLINT:"SMALLINT",INT:"SERIAL",SIGNED_INT:"INTEGER",BIGINT:"BIGSERIAL",SIGNED_BIGINT:"BIGINT",FLOAT:"REAL",DOUBLE:"DOUBLE PRECISION",BOOL:"BOOLEAN",TIMESTAMP:"TIMESTAMP WITHOUT TIME ZONE",DATETIME:"TIMESTAMP WITHOUT TIME ZONE",DATE:"DATE",TIME:"TIME WITHOUT TIME ZONE",VARBINARY:"BYTEA",VARCHAR:["VARCHAR(",[1,"255"],")"],TEXT:"TEXT",BLOB:"BYTEA",JSON:"JSON"},clauses:{start_transaction:"START TRANSACTION <type|>;",commit_transaction:"COMMIT;",rollback_transaction:"ROLLBACK;",transact:"START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]",create:"[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[<?column> <type>[ COLLATE <?collation>][ CONSTRAINT <?constraint>][ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?unique|>UNIQUE][ <?primary|>PRIMARY KEY]]][,\n<*col:COL>]]\n)]]",alter:"ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]",drop:"DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]",union:"(<union_selects>)[\nUNION[<?union_all|> ALL]\n(<*union_selects>)][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",delete:"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]"}},transactsql:{quotes:[["'","'","''","''"],["[","]","[","]"],[""," ESCAPE '\\'","",""]],functions:{strpos:["CHARINDEX(",2,",",1,")"],strlen:["LEN(",1,")"],strlower:["LOWER(",1,")"],strupper:["UPPER(",1,")"],trim:["LTRIM(RTRIM(",1,"))"],quote:["QUOTENAME(",1,',"\'")'],random:"RAND()",now:"CURRENT_TIMESTAMP"},types:{SMALLINT:"SMALLINT",SIGNED_SMALLINT:"SMALLINT",INT:"INT",SIGNED_INT:"INT",BIGINT:"BIGINT",SIGNED_BIGINT:"BIGINT",FLOAT:["FLOAT(",[1,"24"],")"],DOUBLE:["FLOAT(",[1,"53"],")"],BOOL:"BIT",TIMESTAMP:"DATETIME",DATETIME:"DATETIME",DATE:"DATE",TIME:"TIME",VARBINARY:["VARBINARY(",[1,"255"],")"],VARCHAR:["VARCHAR(",[1,"255"],")"],TEXT:"TEXT",BLOB:"IMAGE",JSON:"TEXT"},clauses:{start_transaction:"BEGIN TRANSACTION <type|>;",commit_transaction:"COMMIT;",rollback_transaction:"ROLLBACK;",transact:"BEGIN TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]",create:"[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>[<?ifnotexists|>IF NOT EXISTS (SELECT * FROM sysobjects WHERE name=<create_table> AND xtype='U')\n]CREATE TABLE <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ [CONSTRAINT <?constraint> ]DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)][<?ifnotexists|>\nGO]]",alter:"ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]",drop:"DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]",union:"(<union_selects>)[\nUNION[<?union_all|> ALL]\n(<*union_selects>)][\nORDER BY <?order_conditions>[,<*order_conditions>]]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]",delete:"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]"}},sqlite:{quotes:[["'","'","''","''"],['"','"','""','""'],[""," ESCAPE '\\'","",""]],functions:{strpos:["instr(",2,",",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:"random()",now:"datetime('now')"},types:{SMALLINT:"INTEGER",SIGNED_SMALLINT:"INTEGER",INT:"INTEGER",SIGNED_INT:"INTEGER",BIGINT:"INTEGER",SIGNED_BIGINT:"INTEGER",FLOAT:"REAL",DOUBLE:"REAL",BOOL:"INTEGER",TIMESTAMP:"TEXT",DATETIME:"TEXT",DATE:"TEXT",TIME:"TEXT",VARBINARY:"BLOB",VARCHAR:"TEXT",TEXT:"TEXT",BLOB:"BLOB",JSON:"TEXT"},clauses:{start_transaction:"BEGIN <type|> TRANSACTION;",commit_transaction:"COMMIT;",rollback_transaction:"ROLLBACK;",transact:"BEGIN <type|> TRANSACTION;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]",create:"[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ <?auto_increment|>AUTOINCREMENT][ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)[ <?without_rowid|>WITHOUT ROWID]][AS <?query>]]",alter:"ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]",drop:"DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>",union:"(<union_selects>)[\nUNION[<?union_all|> ALL]\n(<*union_selects>)][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>]",delete:"[<?!order_conditions><?!count>DELETE FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]][DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nORDER BY <?order_conditions> [, <*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nLIMIT <?count> OFFSET <offset|0>\n)]"}}},d.aliases={mysqli:"mysql",mariadb:"mysql",sqlserver:"transactsql",postgres:"postgresql",postgre:"postgresql"},d.StringTemplate=o,d.GrammarTemplate=O,d.Ref=D,d[n]={constructor:d,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,escdbn:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e.vews=null,e.tpls=null,e.db=null,e.escdb=null,e.escdbn=null,e.p=null,e.type=null,e.clauses=null,e.q=null,e.qn=null,e.e=null,e},toString:function(){return this.sql()||""},driver:function(e){return arguments.length?(this.db=e||null,this):this.db},escape:function(e,n){return arguments.length<2&&(n=!1),arguments.length?(this.escdb=e&&m(e)?[e,!!n]:null,this):this.escdb},escapeId:function(e,n){return arguments.length<2&&(n=!1),arguments.length?(this.escdbn=e&&m(e)?[e,!!n]:null,this):this.escdbn},prefix:function(e){return arguments.length?(this.p=e&&e.length?String(e):"",this):this.p},reset:function(e){var n=this;if(e&&g.call(n.clauses,e))return n.clus={},n.tbls={},n.cols={},n.clau=e,n.clauses[n.clau]instanceof d.GrammarTemplate||(n.clauses[n.clau]=new d.GrammarTemplate(n.clauses[n.clau])),n;throw new TypeError('Dialect: SQL clause "'+e+'" does not exist for dialect "'+n.type+'"')},clear:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e},subquery:function(){var e,n,l=this,t=new d(l.type);return t.driver(l.driver()).prefix(l.prefix()),e=l.escape(),n=l.escapeId(),e&&t.escape(e[0],e[1]),n&&t.escapeId(n[0],n[1]),t.vews=l.vews,t},sql:function(){var e,n=this,l="";return n.clau&&g.call(n.clauses,n.clau)&&(e=r({},n.clus),g.call(n.clus,"select_columns")&&(e.select_columns=s(n.clus.select_columns,"aliased")),g.call(n.clus,"from_tables")&&(e.from_tables=s(n.clus.from_tables,"aliased")),g.call(n.clus,"insert_tables")&&(e.insert_tables=s(n.clus.insert_tables,"aliased")),g.call(n.clus,"insert_columns")&&(e.insert_columns=s(n.clus.insert_columns,"full")),g.call(n.clus,"update_tables")&&(e.update_tables=s(n.clus.update_tables,"aliased")),g.call(n.clus,"create_table")&&(e.create_table=s(n.clus.create_table,"full")),g.call(n.clus,"alter_table")&&(e.alter_table=s(n.clus.alter_table,"full")),g.call(n.clus,"drop_tables")&&(e.drop_tables=s(n.clus.drop_tables,"full")),g.call(n.clus,"where_conditions_required")&&(e.where_conditions=g.call(n.clus,"where_conditions")?"("+n.clus.where_conditions_required+") AND ("+n.clus.where_conditions+")":n.clus.where_conditions_required),g.call(n.clus,"having_conditions_required")&&(e.having_conditions=g.call(n.clus,"having_conditions")?"("+n.clus.having_conditions_required+") AND ("+n.clus.having_conditions+")":n.clus.having_conditions_required),l=n.clauses[n.clau].render(e)||""),l},createView:function(e){var n=this;return e&&n.clau&&(n.vews[e]={clau:n.clau,clus:n.clus,tbls:n.tbls,cols:n.cols},g.call(n.vews[e].clus,"where_conditions")&&(n.vews[e].clus.where_conditions&&(n.vews[e].clus.where_conditions_required=n.vews[e].clus.where_conditions),delete n.vews[e].clus.where_conditions),g.call(n.vews[e].clus,"having_conditions")&&(n.vews[e].clus.having_conditions&&(n.vews[e].clus.having_conditions_required=n.vews[e].clus.having_conditions),delete n.vews[e].clus.having_conditions),n.clear()),n},useView:function(e){var n=this;if(l=n.clus.select_columns,e=n.vews[e],n.clus=r(n.clus,e.clus,!0,!0),n.tbls=r({},e.tbls,!0),n.cols=r({},e.cols,!0),l){for(var l,t=[],s=0,i=(l=n.refs(l,n.cols,!0)).length;s<i;++s)"*"===l[s].full?t=t.concat(n.clus.select_columns):t.push(l[s]);n.clus.select_columns=t}return n},dropView:function(e){return e&&g.call(this.vews,e)&&delete this.vews[e],this},prepareTpl:function(e){var n,l,t,s,i;return I(e)||(i=1===(i=(n=arguments).length)?!(s=t=l=null):2===i?(l=n[1],s=t=null,!1):3===i?(t=n[1],s=n[2],!(l=null)):(l=n[1],t=n[2],s=n[3],!1),n=h((t=t?_(t):"%")+"(([rlfids]:)?[0-9a-zA-Z_]+)"+(s=s?_(s):"%")),t=new d.StringTemplate(i?this.sql():l,n),this.tpls[e]={sql:t,types:null}),this},prepared:function(e,n){var l,t,s,i,r,o,a,u,c,f=this;if(I(e)||!g.call(f.tpls,e))return"";if(l=f.tpls[e].sql,null==(t=f.tpls[e].types)){for(l.parse(),t={},o=0,a=l.tpl.length;o<a;++o)0===(u=l.tpl[o])[0]&&(1<(c=u[1].split(":")).length?(t[c[1]]=c[0],l.tpl[o][1]=c[1]):(t[c[0]]="s",l.tpl[o][1]=c[0]));f.tpls[e].types=t}for(c in s={},n)if(g.call(n,c))switch(i=n[c],g.call(t,c)?t[c]:"s"){case"r":R(i)?s[c]=i.join(","):s[c]=i;break;case"l":s[c]=f.like(i);break;case"f":if(R(i))for(r=L(i),s[c]=D.parse(r[0],f).aliased,o=1,a=r.length;o<a;++o)s[c]+=","+D.parse(r[o],f).aliased;else s[c]=D.parse(i,f).aliased;break;case"i":R(i)?s[c]=f.intval(L(i)).join(","):s[c]=f.intval(i);break;case"d":R(i)?s[c]=f.floatval(L(i)).join(","):s[c]=f.floatval(i);break;default:R(i)?s[c]=f.quote(L(i)).join(","):s[c]=f.quote(i)}return l.render(s)},prepare:function(e,n,l,t){var s,i,r,o,a,u,c,f,d,p=this;if(e&&n){for(s=h((l=l?_(l):"%")+"([rlfids]:)?([0-9a-zA-Z_]+)"+(t=t?_(t):"%")),d="";e.length&&(i=e.match(s));){if(r=i.index,o=i[0].length,f=i[2],g.call(n,f)){switch(i[1]?i[1].slice(0,-1):"s"){case"r":f=R(n[f])?n[f].join(","):n[f];break;case"l":f=p.like(n[f]);break;case"f":if(R(n[f]))for(c=L(n[f]),f=D.parse(c[0],p).aliased,a=1,u=c.length;a<u;++a)f+=","+D.parse(c[a],p).aliased;else f=D.parse(n[f],p).aliased;break;case"i":f=R(n[f])?p.intval(L(n[f])).join(","):p.intval(n[f]);break;case"d":f=R(n[f])?p.floatval(L(n[f])).join(","):p.floatval(n[f]);break;default:f=R(n[f])?p.quote(L(n[f])).join(","):p.quote(n[f])}d+=e.slice(0,r)+f}else d+=e.slice(0,r)+p.quote("");e=e.slice(r+o)}return e.length&&(d+=e),d}return e},dropTpl:function(e){return!I(e)&&g.call(this.tpls,e)&&(this.tpls[e].sql.dispose(),delete this.tpls[e]),this},StartTransaction:function(e,n){return this.clau!==(n=n||"start_transaction")&&this.reset(n),this.clus.type=e||null,this},CommitTransaction:function(e){return this.clau!==(e=e||"commit_transaction")&&this.reset(e),this},RollbackTransaction:function(e){return this.clau!==(e=e||"rollback_transaction")&&this.reset(e),this},Transaction:function(e,n){var l,t=this;return t.clau!==(n=n||"transact")&&t.reset(n),t.clus.type=(e=e||{}).type||null,t.clus.rollback=e.rollback?1:null,I(e.statements)||(l=L(l),t.clus.statements=t.clus.statements?t.clus.statements.concat(l):l),t},Create:function(e,n,l){var t=this;return t.clau!==(l=l||"create")&&t.reset(l),n=n||{ifnotexists:1},t.clus.create_table=t.refs(e,t.tbls),t.clus.view=n.view?1:null,t.clus.ifnotexists=n.ifnotexists?1:null,t.clus.temporary=n.temporary?1:null,t.clus.query=I(n.query)?null:n.query,I(n.columns)||(l=L(n.columns),t.clus.columns=t.clus.columns?t.clus.columns.concat(l):l),I(n.table)||(e=L(n.table),t.clus.options=t.clus.options?t.clus.options.concat(e):e),t},Alter:function(e,n,l){var t=this;return t.clau!==(l=l||"alter")&&t.reset(l),t.clus.alter_table=t.refs(e,t.tbls),t.clus.view=(n=n||{}).view?1:null,I(n.columns)||(l=L(n.columns),t.clus.columns=t.clus.columns?t.clus.columns.concat(l):l),I(n.table)||(e=L(n.table),t.clus.options=t.clus.options?t.clus.options.concat(e):e),t},Drop:function(e,n,l){var t=this;return t.clau!==(l=l||"drop")&&t.reset(l),l=R(e)?e[0]:e,g.call(t.vews,l)?t.dropView(l):(C(e)&&(e=e.split(",")),e=t.refs(null==e?"*":e,t.tbls),t.clus.view=(n=n||{ifexists:1}).view?1:null,t.clus.ifexists=n.ifexists?1:null,t.clus.temporary=n.temporary?1:null,t.clus.drop_tables=t.clus.drop_tables?t.clus.drop_tables.concat(e):e),t},Select:function(e,n){var l=this;return l.clau!==(n=n||"select")&&l.reset(n),C(e)&&(e=e.split(",")),e=l.refs(null==e?"*":e,l.cols),l.clus.select_columns=l.clus.select_columns?l.clus.select_columns.concat(e):e,l},Union:function(e,n,l){var t=this;return t.clau!==(l=l||"union")&&t.reset(l),t.clus.union_selects=t.clus.union_selects?t.clus.union_selects.concat(L(e)):L(e),t.clus.union_all=n?"":null,t},Insert:function(e,n,l){var t=this;return t.clau!==(l=l||"insert")&&t.reset(l),l=R(e)?e[0]:e,g.call(t.vews,l)&&t.clau===t.vews[l].clau?t.useView(l):(C(e)&&(e=e.split(",")),C(n)&&(n=n.split(",")),e=t.refs(e,t.tbls),n=t.refs(n,t.cols),t.clus.insert_tables=t.clus.insert_tables?t.clus.insert_tables.concat(e):e,t.clus.insert_columns=t.clus.insert_columns?t.clus.insert_columns.concat(n):n),t},Values:function(e){var n,l,t,s,i,r,o,a,u=this;if(!I(e)){for(n=(e=p!==e[0]&&R(e[0])?e:[e]).length,l=[],s=0;s<n;++s)if((a=L(e[s])).length){for(t=[],r=0,o=a.length;r<o;++r)v(i=a[r])?g.call(i,"raw")?t.push(i.raw):g.call(i,"integer")?t.push(u.intval(i.integer)):g.call(i,"int")?t.push(u.intval(i.int)):g.call(i,"float")?t.push(u.floatval(i.float)):g.call(i,"string")&&t.push(u.quote(i.string)):t.push(null===i?"NULL":w(i)?String(i):u.quote(i));l.push("("+t.join(",")+")")}l=l.join(","),u.clus.values_values&&(l=u.clus.values_values+","+l),u.clus.values_values=l}return u},Update:function(e,n){var l=this;return l.clau!==(n=n||"update")&&l.reset(n),n=R(e)?e[0]:e,g.call(l.vews,n)&&l.clau===l.vews[n].clau?l.useView(n):(C(e)&&(e=e.split(",")),e=l.refs(e,l.tbls),l.clus.update_tables=l.clus.update_tables?l.clus.update_tables.concat(e):e),l},Set:function(e){var n,l,t,s,i,r,o,a=this;if(!I(e)){for(t in n=[],o=a.cols,e)if(g.call(e,t))if(s=a.refs(t,o)[0].full,v(i=e[t])){if(g.call(i,"raw"))n.push(s+" = "+i.raw);else if(g.call(i,"integer"))n.push(s+" = "+a.intval(i.integer));else if(g.call(i,"int"))n.push(s+" = "+a.intval(i.int));else if(g.call(i,"float"))n.push(s+" = "+a.floatval(i.float));else if(g.call(i,"string"))n.push(s+" = "+a.quote(i.string));else if(g.call(i,"increment"))n.push(s+" = "+s+" + "+a.numval(i.increment));else if(g.call(i,"decrement"))n.push(s+" = "+s+" - "+a.numval(i.decrement));else if(g.call(i,"case")){if(l=s+" = CASE",g.call(i.case,"when")){for(r in i.case.when)g.call(i.case.when,r)&&(l+="\nWHEN "+a.conditions(i.case.when[r],!1)+" THEN "+a.quote(r));g.call(i.case,"else")&&(l+="\nELSE "+a.quote(i.case.else))}else for(r in i.case)g.call(i.case,r)&&(l+="\nWHEN "+a.conditions(i.case[r],!1)+" THEN "+a.quote(r));l+="\nEND",n.push(l)}}else n.push(s+" = "+(null===i?"NULL":w(i)?String(i):a.quote(i)));n=n.join(","),a.clus.set_values&&(n=a.clus.set_values+","+n),a.clus.set_values=n}return a},Delete:function(e){return this.clau!==(e=e||"delete")&&this.reset(e),this},From:function(e){var n,l=this;return I(e)||(n=R(e)?e[0]:e,g.call(l.vews,n)&&l.clau===l.vews[n].clau?l.useView(n):(C(e)&&(e=e.split(",")),e=l.refs(e,l.tbls),l.clus.from_tables=l.clus.from_tables?l.clus.from_tables.concat(e):e)),l},Join:function(e,n,l){var t,s,i,r=this;if(e=r.refs(e,r.tbls)[0].aliased,l=I(l)?null:l.toUpperCase(),I(n))t={table:e,type:l};else{if(C(n))n="("+(n=r.refs(n.split("="),r.cols))[0].full+"="+n[1].full+")";else{for(s in n)!g.call(n,s)||v(i=n[s])||(n[s]={eq:i,type:"identifier"});n="("+r.conditions(n,!1)+")"}t={table:e,type:l,cond:n}}return r.clus.join_clauses?r.clus.join_clauses.push(t):r.clus.join_clauses=[t],r},Where:function(e,n){var l=this;return I(e)||("OR"!==(n=n?String(n).toUpperCase():"AND")&&(n="AND"),e=l.conditions(e,!1),l.clus.where_conditions&&(e=l.clus.where_conditions+" "+n+" "+e),l.clus.where_conditions=e),l},Group:function(e){var n=this,e=n.refs(e,n.cols)[0].alias;return n.clus.group_conditions&&(e=n.clus.group_conditions+","+e),n.clus.group_conditions=e,n},Having:function(e,n){var l=this;return I(e)||("OR"!==(n=n?String(n).toUpperCase():"AND")&&(n="AND"),e=l.conditions(e,!0),l.clus.having_conditions&&(e=l.clus.having_conditions+" "+n+" "+e),l.clus.having_conditions=e),l},Order:function(e,n){var l=this;return"DESC"!==(n=n?String(n).toUpperCase():"ASC")&&(n="ASC"),e=l.refs(e,l.cols)[0].alias+" "+n,l.clus.order_conditions&&(e=l.clus.order_conditions+","+e),l.clus.order_conditions=e,l},Limit:function(e,n){return this.clus.count=t(e),this.clus.offset=t(n||0),this},Page:function(e,n){return e=t(e),n=t(n),this.Limit(n,e*n)},conditions:function(e,n){var l,t,s,i,r,o,a,u,c,f,d,p,h=this;if(I(e))return"";if(C(e))return e;for(s in t=[],f=h.cols,o=!(l="")===n?"alias":"full",e)if(g.call(e,s))if(v(r=e[s]))if(g.call(r,"raw"))t.push(String(r.raw));else if(g.call(r,"or")){for(var _=[],E=0,T=r.or.length;E<T;++E)d=r.or[E],_.push(h.conditions(d,n));t.push(_.join(" OR "))}else if(g.call(r,"and")){_=[];for(E=0,T=r.and.length;E<T;++E)d=r.and[E],_.push(h.conditions(d,n));t.push(_.join(" AND "))}else if(g.call(r,"either")){_=[];for(E=0,T=r.either.length;E<T;++E)(d={})[s]=r.either[E],_.push(h.conditions(d,n));t.push(_.join(" OR "))}else if(g.call(r,"together")){_=[];for(E=0,T=r.together.length;E<T;++E)(d={})[s]=r.together[E],_.push(h.conditions(d,n));t.push(_.join(" AND "))}else if(i=h.refs(s,f)[0][o],u=g.call(r,"type")?r.type:"string",g.call(r,"case")){if(_=i+" = CASE",g.call(r.case,"when")){for(p in r.case.when)g.call(r.case.when,p)&&(_+=" WHEN "+h.conditions(r.case.when[p],n)+" THEN "+h.quote(p));g.call(r.case,"else")&&(_+=" ELSE "+h.quote(r.case.else))}else for(p in r.case)g.call(r.case,p)&&(_+=" WHEN "+h.conditions(r.case[p],n)+" THEN "+h.quote(p));t.push(_+=" END")}else g.call(r,"multi_like")?t.push(h.multi_like(i,r.multi_like)):g.call(r,"like")?t.push(i+" LIKE "+("raw"===u?String(r.like):h.like(r.like))):g.call(r,"not_like")?t.push(i+" NOT LIKE "+("raw"===u?String(r.not_like):h.like(r.not_like))):g.call(r,"contains")?(c=String(r.contains),"raw"!==u&&(c=h.quote(c)),t.push(h.sql_function("strpos",[i,c])+" > 0")):g.call(r,"not_contains")?(c=String(r.not_contains),"raw"!==u&&(c=h.quote(c)),t.push(h.sql_function("strpos",[i,c])+" = 0")):g.call(r,"in")?(c=L(r.in),"raw"!==u&&(c="int"===u||"integer"===u||S(c[0])?h.intval(c):"float"===u||w(c[0])?h.floatval(c):h.quote(c)),t.push(i+" IN ("+c.join(",")+")")):g.call(r,"not_in")?(c=L(r.not_in),"raw"!==u&&(c="int"===u||"integer"===u||S(c[0])?h.intval(c):"float"===u||w(c[0])?h.floatval(c):h.quote(c)),t.push(i+" NOT IN ("+c.join(",")+")")):g.call(r,"between")?null==(c=L(r.between))[0]?("raw"!==u&&("int"===u||"integer"===u||S(c[1])?c[1]=h.intval(c[1]):"float"===u||w(c[1])?c[1]=h.floatval(c[1]):c[1]=h.quote(c[1])),t.push(i+" <= "+c[1])):null==c[1]?("raw"!==u&&("int"===u||"integer"===u||S(c[0])?c[0]=h.intval(c[0]):"float"===u||w(c[0])?c[0]=h.floatval(c[0]):c[0]=h.quote(c[0])),t.push(i+" >= "+c[0])):("raw"!==u&&(c="int"===u||"integer"===u||S(c[0])&&S(c[1])?h.intval(c):"float"===u||w(c[0])&&w(c[1])?h.floatval(c):h.quote(c)),t.push(i+" BETWEEN "+c[0]+" AND "+c[1])):g.call(r,"not_between")?null==(c=L(r.not_between))[0]?("raw"!==u&&("int"===u||"integer"===u||S(c[1])?c[1]=h.intval(c[1]):"float"===u||w(c[1])?c[1]=h.floatval(c[1]):c[1]=h.quote(c[1])),t.push(i+" > "+c[1])):null==c[1]?("raw"!==u&&("int"===u||"integer"===u||S(c[0])?c[0]=h.intval(c[0]):"float"===u||w(c[0])?c[0]=h.floatval(c[0]):c[0]=h.quote(c[0])),t.push(i+" < "+c[0])):("raw"!==u&&(c="int"===u||"integer"===u||S(c[0])&&S(c[1])?h.intval(c):"float"===u||w(c[0])&&w(c[1])?h.floatval(c):h.quote(c)),t.push(i+" < "+c[0]+" OR "+i+" > "+c[1])):g.call(r,"gt")||g.call(r,"gte")?(c=r[a=g.call(r,"gt")?"gt":"gte"],"raw"!==u&&(c="int"===u||"integer"===u||S(c)?h.intval(c):"float"===u||w(c)?h.floatval(c):"identifier"===u||"field"===u?h.refs(c,f)[0][o]:h.quote(c)),t.push(i+("gt"===a?" > ":" >= ")+c)):g.call(r,"lt")||g.call(r,"lte")?(c=r[a=g.call(r,"lt")?"lt":"lte"],"raw"!==u&&(c="int"===u||"integer"===u||S(c)?h.intval(c):"float"===u||w(c)?h.floatval(c):"identifier"===u||"field"===u?h.refs(c,f)[0][o]:h.quote(c)),t.push(i+("lt"===a?" < ":" <= ")+c)):g.call(r,"not_equal")||g.call(r,"not_eq")?(c=r[a=g.call(r,"not_eq")?"not_eq":"not_equal"],"raw"!==u&&null!==c&&(c="int"===u||"integer"===u||S(c)?h.intval(c):"float"===u||w(c)?h.floatval(c):"identifier"===u||"field"===u?h.refs(c,f)[0][o]:h.quote(c)),t.push(null===c?i+" IS NOT NULL":i+" <> "+c)):(g.call(r,"equal")||g.call(r,"eq"))&&(c=r[a=g.call(r,"eq")?"eq":"equal"],"raw"!==u&&null!==c&&(c="int"===u||"integer"===u||S(c)?h.intval(c):"float"===u||w(c)?h.floatval(c):"identifier"===u||"field"===u?h.refs(c,f)[0][o]:h.quote(c)),t.push(null===c?i+" IS NULL":i+" = "+c));else i=h.refs(s,f)[0][o],t.push(null===r?i+" IS NULL":i+" = "+(w(r)?String(r):h.quote(r)));return l=t.length?"("+t.join(") AND (")+")":l},joinConditions:function(e,n){var l,t,s,i,r,o,a,u,c,f,d=0;for(l in n)g.call(n,l)&&(t=D.parse(l,this)._col,g.call(e,t))&&(s=n[l],r=e[t].table,o=e[t].id,a=e[t].join,u=e[t].join_id,c=a+ ++d,i={},g.call(e[t],"key")&&t!==e[t].key?i[c+"."+(f=e[t].key)]=t:f=t,g.call(e[t],"value")?i[c+"."+e[t].value]=s:i[c+"."+f]=s,this.Join(a+" AS "+c,r+"."+o+"="+c+"."+u,"inner").Where(i),delete n[l]);return this},refs:function(e,n,l){var t,s,i;if(!0===l)for(r=0,o=e.length;r<o;++r)u=(a=e[r]).alias,c=a.qualified,"*"!==(s=a.full)&&(g.call(n,u)?e[r]=n[u]:g.call(n,s)?(i=(t=n[s]).alias,t.full!==s&&i!==u&&i===s&&(t=t.cloned(a.alias),e[r]=n[u]=t)):g.call(n,c)?((t=n[c]).qualified!==c&&(t=n[t.qualified]),t=a.full!==a.alias?t.cloned(a.alias,null,a._func):t.cloned(null,t.alias,a._func),(e[r]=n[t.alias]=t).alias===t.full||g.call(n,t.full)||(n[t.full]=t)):(n[u]=a,u===s||g.call(n,s)||(n[s]=a)));else{var r,o,a,u,c,f=L(e);for(e=[],r=0,o=f.length;r<o;++r)u=(a=D.parse(f[r],this)).alias,c=a.full,g.call(n,u)?a=n[u]:(n[u]=a,c===u||g.call(n,c)||(n[c]=a)),e.push(a)}return e},tbl:function(e){if(R(e)){for(var n=0,l=e.length;n<l;++n)e[n]=this.tbl(e[n]);return e}return this.p+String(e)},intval:function(e){if(R(e)){for(var n=0,l=e.length;n<l;++n)e[n]=this.intval(e[n]);return e}return S(e)?e:parseInt(String(e),10)},floatval:function(e){if(R(e)){for(var n=0,l=e.length;n<l;++n)e[n]=this.floatval(e[n]);return e}return w(e)?e:parseFloat(String(e),10)},numval:function(e){if(R(e)){for(var n=0,l=e.length;n<l;++n)e[n]=this.numval(e[n]);return e}return w(e)?e:parseFloat(String(e),10)},quote_name:function(e,n){var l,t,s,i,r=this.qn,o=this.escdbn;if(n=!0===n,R(e)){for(l=0,t=e.length,s=new Array(t);l<t;++l)s[l]=this.quote_name(e[l],n);return s}if(e=String(e),n&&r[0]===e.slice(0,r[0].length)&&r[1]===e.slice(-r[1].length))return e;if(o)return o[1]?o[0](e):r[0]+o[0](e)+r[1];for(l=0,t=e.length,s="";l<t;++l)i=e.charAt(l),r[0]===i?s+=r[2]:r[1]===i?s+=r[3]:s+=i;return r[0]+s+r[1]},quote:function(e){var n,l=this,t=l.q,s=l.e,i=l.escdb;if(R(e)){for(var r=0,o=e.length,a=new Array(o);r<o;++r)a[r]=l.quote(e[r]);return a}return n=-1!==(e=String(e)).indexOf("\\"),i?i[1]?i[0](e):(n?s[2]:"")+t[0]+i[0](e)+t[1]+(n?s[3]:""):(n?s[2]:"")+t[0]+l.esc(e)+t[1]+(n?s[3]:"")},esc:function(e){var n,l,t,s,i,r,o=this;if(R(e))for(l=0,t=e.length,r=new Array(t);l<t;++l)r[l]=o.esc(e[l]);else{if(o.escdb&&!o.escdb[1])return o.escdb[0](e);for(i=o.q,n=a+"\\",r="",l=0,t=(e=String(e)).length;l<t;++l)s=e.charAt(l),i[0]===s?r+=i[2]:i[1]===s?r+=i[3]:r+=u(s,n,"\\")}return r},esc_like:function(e){if(R(e)){for(var n=0,l=e.length,t=new Array(l);n<l;++n)t[n]=this.esc_like(e[n]);return t}return u(e,"_%","\\")},like:function(e){var n,l,t=this;if(R(e)){for(var s=0,i=e.length,r=new Array(i);s<i;++s)r[s]=t.like(e[s]);return r}return n=t.q,(l=t.escdb?["","","",""]:t.e)[0]+n[0]+"%"+t.esc_like(t.esc(e))+"%"+n[1]+l[1]},multi_like:function(e,n,l){var t,s,i,r,o,a,u;for(l=!1!==l,t=e+" LIKE ",s=n.split(","),r=0,o=(s=l?f(c(s,H),Boolean):s).length;r<o;++r){for(i=s[r].split("+"),a=0,u=(i=l?f(c(i,H),Boolean):i).length;a<u;++a)i[a]=t+this.like(i[a]);s[r]="("+i.join(" AND ")+")"}return s.join(" OR ")},sql_function:function(e,n){var l,t,s,i,r,o;if(!d.dialects[this.type].functions||!g.call(d.dialects[this.type].functions,e))throw new TypeError('Dialect: SQL function "'+e+'" does not exist for dialect "'+this.type+'"');if(R(e=d.dialects[this.type].functions[e])){for(o=(n=null!=n?L(n):[]).length,l="",t=!1,s=0,i=e.length;s<i;++s)r=e[s],l+=t?R(r)?0<r[0]&&o>=r[0]?String(n[r[0]-1]):String(null!=r[1]?r[1]:""):0<r&&r<=o?String(n[r-1]):"":String(r),t=!t;return l}return String(e)},sql_type:function(e,n){var l,t,s,i,r,o,a;if(e=String(e).toUpperCase(),!d.dialects[this.type].types||!g.call(d.dialects[this.type].types,e))throw new TypeError('Dialect: SQL type "'+e+'" does not exist for dialect "'+this.type+'"');if(R(t=d.dialects[this.type].types[e])){for(a=(n=null!=n?L(n):[]).length,l="",s=!1,i=0,r=t.length;i<r;++i)o=t[i],l+=s?R(o)?0<o[0]&&a>=o[0]?String(n[o[0]-1]):String(null!=o[1]?o[1]:""):0<o&&o<=a?String(n[o-1]):"":String(o),s=!s;return l}return String(t)}},d});
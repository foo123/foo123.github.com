/**
*   Dialect,
*   a simple and flexible Cross-Platform & Cross-Vendor SQL Query Builder for PHP, Python, JavaScript
*
*   @version: 1.4.0
*   https://github.com/foo123/Dialect
*
*   Abstract the construction of SQL queries
*   Support multiple DB vendors
*   Intuitive and Flexible API
**/
!function(n,e,l){"use strict";"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils.import?(n.$deps=n.$deps||{})&&(n.EXPORTED_SYMBOLS=[e])&&(n[e]=n.$deps[e]=l.call(n)):"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[e]=l.call(n)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(e)?define(e,["module"],function(e){return l.moduleUri=e.uri,l.call(n)}):e in n||(n[e]=l.call(n)||1)&&"function"==typeof define&&define.amd&&define(function(){return n[e]})}("undefined"!=typeof self?self:this,"Dialect",function(c){"use strict";var n="prototype",l=Object.keys,t=Object[n].toString,v=Object[n].hasOwnProperty,x="charAt",a="charCodeAt",s=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,i=/^\s+|\s+$/g,H=String[n].trim?function(e){return e.trim()}:function(e){return e.replace(i,"")},o=String.fromCharCode(0);function W(){return W.GUID+=1,e((new Date).getTime().toString(16),12)+"--"+e(W.GUID.toString(16),4)}function m(e){return"function"==typeof e}function u(e,n,l){var t=this;if(!(t instanceof u))return new u(e,n,l);t.id=null,t.tpl=null,t._renderer=null,t._args=[e||"",n||u.defaultArgs,l],t._parsed=!1}function P(e,n){return!(!e||!v.call(e,n))}function e(e,n,l,t){var s=String(e);if(l=l||"0",t)for(;s.length<n;)s+=l;else for(;s.length<n;)s=l+s;return s}function V(e,n,l){for(var t,s="";n<l&&(" "===(t=e[x](n))||"\r"===t||"\t"===t||"\v"===t||"\0"===t);)s+=t,++n;return s}function b(e,n){var l,t,s,i=e.length;if(i&&n.length)for(l="",s=0;s<i;++s)l+=t=e[x](s),"\n"===t&&(l+=n);else l=e;return l}function N(e,n,l,t){var s,i,r,a,o=0;if(n)for(s=e,i=n.length,r=0,o=1;r<i;){if(a=n[r++],null==s||null==s[a]){o=0;break}s=s[a]}if(!o&&l)for(s=e,i=l.length,r=0,o=1;r<i;){if(a=l[r++],null==s||null==s[a]){o=0;break}s=s[a]}if(!o&&null!=t&&t!==e){if(n)for(s=t,i=n.length,r=0,o=1;r<i;){if(a=n[r++],null==s||null==s[a]){o=0;break}s=s[a]}if(!o&&l)for(s=t,i=l.length,r=0,o=1;r<i;){if(a=l[r++],null==s||null==s[a]){o=0;break}s=s[a]}}return o?s:null}function X(e,n){this.prev=e||null,this.value=n||null}function K(e,n){n&&(n.next=this),this.node=e||null,this.prev=n||null,this.next=null}function A(e,n,l,t,s,i,r){var a,o,u,c,f,d,p,h,_=null,E="";if(-1===n.type){if((a=n.opt_args)&&a.value[5])for(;a;){if(u=N(e,(o=a.value)[1],[String(o[0])],o[6]?null:r),null===_&&n.name===o[0]&&(_=u),0===o[2]&&null==u||1===o[2]&&null!=u)return"";a=a.prev}}else _=N(e,n.key,[String(n.name)],n.loc?null:r);if(h=(c=R(_))?_.length:-1,c&&h>n.start)for(f=n.start,d=-1===n.end?h-1:Math.min(n.end,h-1),p=f;p<=d;++p)E+=T(e,n.tpl,l,t,p,i,r);else c||n.start!==n.end||(E=T(e,n.tpl,l,t,null,i,r));return E}function T(e,n,l,t,s,i,r){for(var a,o,u,c,f,d,p,h,_,E,T,v,g=i=i||"",I="";n;)-1===(a=n.node.type)?I+=A(e,n.node,l,t,0,n.node.algn?g:i,r):1===a?I+=(o=e,u=n.node,c=l,f=t,d=s,p=n.node.algn?g:i,h=r,v=T=E=_=void 0,v="",u.stpl&&(P(c,u.stpl)||P(O.subGlobal,u.stpl)||P(f,u.stpl)||P(f,"*")||P(O.fnGlobal,u.stpl)||P(O.fnGlobal,"*"))?(T=N(o,u.key,[String(u.name)],u.loc?null:h),P(c,u.stpl)||P(O.subGlobal,u.stpl)?(null==d||0===d&&u.start===u.end&&u.opt||!R(T)||(T=d<T.length?T[d]:null),v=null==T&&null!==u.dval?u.dval:(E=(P(c,u.stpl)?c:O.subGlobal)[u.stpl].node,_={},null!=T&&(R(T)?_[E.name]=T:_=T),A(_,E,c,f,0,u.algn?p:"",null==h?o:h))):(c=null,P(f,u.stpl)?c=f[u.stpl]:P(f,"*")?c=f["*"]:P(O.fnGlobal,u.stpl)?c=O.fnGlobal[u.stpl]:O.fnGlobal["*"]&&(c=O.fnGlobal["*"]),R(T)&&(T=(d=null!=d?d:u.start)<T.length?T[d]:null),v=null==(T=m(c)?c(T,{symbol:u,index:d,currentArguments:o,originalArguments:h,alignment:p}):String(c))&&null!==u.dval?u.dval:String(T),u.algn&&(v=b(v,p)))):u.opt&&null!=u.dval?v=u.dval:(R(T=N(o,u.key,[String(u.name)],u.loc?null:h))&&(T=(d=null!=d?d:u.start)<T.length?T[d]:null),v=null==T&&null!==u.dval?u.dval:String(T),u.algn&&(v=b(v,p))),v):0===a?(g+=n.node.algn,I+=n.node.val):100===a&&(I+="\n"+(g=i)),n=n.next;return I}function O(e,n,l){var t=this;if(!(t instanceof O))return new O(e,n,l);t.id=null,t.tpl=null,t.fn={},t._args=[e||"",n||O.defaultDelimiters,l||!1]}function h(e,n){return new RegExp(e,n||"")}function _(e){return e.replace(s,"\\$&")}function C(e){return e instanceof String||"[object String]"===t.call(e)}function R(e){return e instanceof Array||"[object Array]"===t.call(e)}function g(e){return e instanceof Object||"[object Object]"===t.call(e)}function I(e){var n=t.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===n||"[object String]"===n)&&!e.length||((e instanceof Object||"[object Object]"===n)&&!l(e).length||!e)}function r(e){return parseInt(e||0,10)||0}function w(e){return e===+e&&isFinite(e)&&!(e%1)}function S(e){return e===+e&&isFinite(e)}function y(e){return R(e)?e:[e]}function f(e,n,l){var t,s,i,r="";for(arguments.length<3&&(l="\\"),arguments.length<2&&(n="\\\"'"+o),t=0,s=e.length;t<s;++t)i=e[x](t),r+=-1===n.indexOf(i)?i:0===i[a](0)?"\\0":l+i;return r}function d(e,n,l,t){for(var s in l=!0===l,t=!0===t,n)v.call(n,s)&&(!l&&v.call(e,s)||(e[s]=t&&n[s].slice?n[s].slice():n[s]));return e}function p(e,n){var l=e.length;if(!l)return[];var t,s,i=15&l,r=1&i,a=new Array(l);for(r&&(a[0]=n(e[0])),t=r;t<i;t+=2)a[s=t]=n(e[s]),a[t+1]=n(e[s+1]);for(t=i;t<l;t+=16)a[s=t]=n(e[s]),a[t+1]=n(e[s+1]),a[t+2]=n(e[s+2]),a[t+3]=n(e[s+3]),a[t+4]=n(e[s+4]),a[t+5]=n(e[s+5]),a[t+6]=n(e[s+6]),a[t+7]=n(e[s+7]),a[t+8]=n(e[s+8]),a[t+9]=n(e[s+9]),a[t+10]=n(e[s+10]),a[t+11]=n(e[s+11]),a[t+12]=n(e[s+12]),a[t+13]=n(e[s+13]),a[t+14]=n(e[s+14]),a[t+15]=n(e[s+15]);return a}function E(e,n){var l=e.length;if(!l)return[];var t,s,i=15&l,r=1&i,a=[];for(r&&n(e[0])&&a.push(e[0]),t=r;t<i;t+=2)n(e[s=t])&&a.push(e[s]),n(e[++s])&&a.push(e[s]);for(t=i;t<l;t+=16)n(e[s=t])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]),n(e[++s])&&a.push(e[s]);return a}function L(e,n,l){var t,s,i="";if(e&&e.length)for(l=null==l?",":l,i=e[0][n],t=1,s=e.length;t<s;++t)i+=l+e[t][n];return i}function D(e,n,l,t,s,i,r,a,o,u,c){var f=this;if(f._col=e,f.col=n,f._tbl=l,f.tbl=t,f._dtb=s,f.dtb=i,f._alias=r,f._qualified=o,f.qualified=u,f.full=f.qualified,f._func=null==c?[]:c,f._func.length)for(var d=0,p=f._func.length;d<p;++d)f.full=f._func[d]+"("+f.full+")";null!=f._alias?(f.alias=a,f.aliased=f.full+" AS "+f.alias):(f.alias=f.full,f.aliased=f.full)}W.GUID=0,u.VERSION="1.0.0",u.defaultArgs=/\$(-?[0-9]+)/g,u.guid=W,u.multisplit=function(e,n,l){var t,s,i,r,a,o,u,c,f,d;for(t in l=!!l,o=[[1,e]],n)if(v.call(n,t)){for(c=[],s=l?n[t]:t,i=[0,n[t]],r=0,f=o.length;r<f;++r)if(1===o[r][0]){if(d=(u=o[r][1].split(s)).length,c.push([1,u[0]]),1<d)for(a=0;a<d-1;++a)c.push(i),c.push([1,u[a+1]])}else c.push(o[r]);o=c}return o},u.multisplit_re=function(e,n){n=n.global?n:new RegExp(n.source,n.ignoreCase?"gi":"g");for(var l,t=[],s=0;l=n.exec(e);)t.push([1,e.slice(s,n.lastIndex-l[0].length)]),t.push([0,l[1]?l[1]:l[0]]),s=n.lastIndex;return t.push([1,e.slice(s)]),t},u.arg=function(e,n){var l,t,s,i,r,a="args";if(arguments.length&&null!=e)for(i=(e=e.substr?e.length?e.split("."):[]:[e]).length,r=!(!n||!n.substr),l=0;l<i;++l)s=+(t=e[l]),isNaN(s)?a+='["'+t+'"]':(s<0&&(t=r?n+-s:a+".length-"+-s),a+="["+t+"]");return a},u.compile=function(e,n){var l,t,s,i,r=e.length;if(!0===n){for(i='"use strict"; return (',l=0;l<r;++l)t=e[l][0],s=e[l][1],i+=t?s:u.arg(s);i+=");"}else{for(i='"use strict"; var argslen=args.length; return (',l=0;l<r;++l)t=e[l][0],s=e[l][1],i+=t?"'"+s.replace(SQUOTE,"\\'").replace(NEWLINE,"' + \"\\n\" + '")+"'":" + String("+u.arg(s,"argslen")+") + ";i+=");"}return new Function("args",i)},u[n]={constructor:u,id:null,tpl:null,_parsed:!1,_args:null,_renderer:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e._parsed=null,e._args=null,e._renderer=null,e},fixRenderer:function(){var e=this;return e.render="function"==typeof e._renderer?e._renderer:e.constructor[n].render,e},parse:function(){var e,n,l,t=this;return!1===t._parsed&&(t._parsed=!0,e=t._args[0],n=t._args[1],l=t._args[2],t._args=null,t.tpl=n instanceof RegExp?u.multisplit_re(e,n):u.multisplit(e,n),!0===l&&(t._renderer=u.compile(t.tpl),t.fixRenderer())),t},render:function(e){var n=this;if(e=e||[],!1===n._parsed&&(n.parse(),m(n._renderer)))return n._renderer(e);for(var l,t=n.tpl,s=t.length,i=e.length,r="",a=0;a<s;++a)1===(l=t[a])[0]?r+=l[1]:(+(l=l[1])===l&&l<0&&(l=i+l),r+=e[l]);return r}},O.VERSION="3.0.0",O.defaultDelimiters=["<",">","[","]"],O.fnGlobal={},O.subGlobal={},O.guid=W,O.multisplit=function(e,n,l){var t,s,i,r,a,o,u,c,f,d,p,h,_,E,T,v,g,I,m,b,N,A=n[0],O=n[1],R=n[2],w=n[3],S=A.length,y=O.length,L=R.length,q=w.length,M="#"+w,C=null,D=0,B=0,k=0,U=0,G=e.length,F=[A,S,O,y],j=[R,L,w,q],Y=[null,0,null,0,null,0,null,0];for(l=!0===l,v={type:1,name:null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},n=o=new K({type:0,val:"",algn:""}),h={},_={},T=E=g=I=null,F[1]<F[3]&&(c=F[0],F[2]=F[0],F[0]=c,f=F[1],F[3]=F[1],F[1]=f),j[1]<j[3]&&(c=j[0],j[2]=j[0],j[0]=c,f=j[1],j[3]=j[1],j[1]=f),f=s=t=0;t<4&&s<4;)F[t+1]<j[s+1]?(Y[f]=j[s],Y[f+1]=j[s+1],s+=2):(Y[f]=F[t],Y[f+1]=F[t+1],t+=2),f+=2;for(;t<4;)Y[f]=F[t],Y[f+1]=F[t+1],t+=2,f+=2;for(;s<4;)Y[f]=j[s],Y[f+1]=j[s+1],s+=2,f+=2;for(r=null,c="",f=0;f<G;)if("\\"!==(a=e[x](f)))if(N=null,Y[0]===e.substr(f,Y[1])?N=Y[0]:Y[2]===e.substr(f,Y[3])?N=Y[2]:Y[4]===e.substr(f,Y[5])?N=Y[4]:Y[6]===e.substr(f,Y[7])&&(N=Y[6]),A===N)f+=S,c.length&&(0===o.node.type?o.node.val+=c:o=new K({type:0,val:c,algn:""},o)),c="";else if(O===N){if(f+=y,i=c,c="",-1<(u=i.indexOf("|"))?(C=i.slice(u+1),i=i.slice(0,u)):C=null,"?"===(a=l?f<G?e[x](f):"":i[x](0))||"*"===a)B=1,s="*"===a?-(t=1):t=0,l?(f+=1)<G&&"!"===e[x](f)?f+=D=1:D=0:i="!"===i[x](1)?(D=1,i.slice(2)):(D=0,i.slice(1));else if("{"===a){if(l){for(c="",d=f+1,p=G;d<p&&"}"!==e[x](d);)c+=e[x](d++);f=d+1}else{for(c="",d=1,p=i.length;d<p&&"}"!==i[x](d);)c+=i[x](d++);i=i.slice(d+1)}B=1<(c=c.split(",")).length?(t=(t=H(c[0])).length?0|+t:0,s=(s=H(c[1])).length?0|+s:-1,1):(s=t=(t=H(c[0])).length?0|+t:0,0),c="",D=0}else s=t=D=B=0;D&&null==C&&(C=""),"@"===(a=i[x](0))?(k=1,i=i.slice(1)):k=0,"."===(a=i[x](0))?(U=1,i=i.slice(1)):U=0,i=(b=-1<i.indexOf(":")?i.split(":"):[i,null])[0],b=b[1],m=-1<i.indexOf(".")?i.split("."):null,E&&!P(_,E)&&(_[E]={}),":="+R===e.substr(f,2+L)&&(f+=2,T=b=b&&b.length?b:"grtpl--"+W(),E&&i.length&&(_[E][i]=b)),i.length&&(null==b&&E&&P(_,E)&&P(_[E],i)&&(b=_[E][i]),B&&!v.opt?(v.name=i,v.key=m,v.stpl=b,v.dval=C,v.opt=B,v.neg=D,v.algn=k,v.loc=U,g=new X(null,[i,m,D,v.start=t,v.end=s,B,U])):B?(t!==s&&v.start===v.end&&(v.name=i,v.key=m,v.stpl=b,v.dval=C,v.opt=B,v.neg=D,v.algn=k,v.loc=U,v.start=t,v.end=s),g=new X(g,[i,m,D,t,s,B,U])):B||null!=v.name||(v.name=i,v.key=m,v.stpl=b,v.dval=C,v.opt=0,v.neg=D,v.algn=k,v.loc=U,g=new X(null,[i,m,D,v.start=t,v.end=s,0,U])),0===o.node.type&&(o.node.algn=V(o.node.val,0,o.node.val.length)),o=new K({type:1,name:i,key:m,stpl:b,dval:C,opt:B,algn:k,loc:U,start:t,end:s},o))}else if(R===N)if(f+=L,c.length&&(0===o.node.type?o.node.val+=c:o=new K({type:0,val:c,algn:""},o)),c="","#"!==e[x](f))r=new X(r,[o,I,v,g,E,T]),T&&(E=T),v={type:1,name:T=null,key:null,stpl:null,dval:null,opt:0,neg:0,algn:0,loc:0,start:0,end:0},g=null,I=o=new K({type:0,val:"",algn:""});else{for(d=f+1,p=G;d<p&&M!==e.substr(d,q+1);)c+=e[x](d++);f=d+q+1,0===o.node.type&&(o.node.algn=V(o.node.val,0,o.node.val.length)),o=new K({type:-100,val:c},o),c=""}else w===N?(f+=q,u=o,m=I,b=v,N=g,r?(o=r.value[0],I=r.value[1],v=r.value[2],g=r.value[3],E=r.value[4],T=r.value[5],r=r.prev):o=null,c.length&&(0===u.node.type?u.node.val+=c:u=new K({type:0,val:c,algn:""},u)),c="",T?(h[T]=new K({type:2,name:b.name,key:b.key,loc:b.loc,algn:b.algn,start:b.start,end:b.end,opt_args:null,tpl:m}),T=null):(0===o.node.type&&(o.node.algn=V(o.node.val,0,o.node.val.length)),o=new K({type:-1,name:b.name,key:b.key,loc:b.loc,algn:b.algn,start:b.start,end:b.end,opt_args:N,tpl:m},o))):"\n"===(a=e[x](f++))?(c.length&&(0===o.node.type?o.node.val+=c:o=new K({type:0,val:c,algn:""},o)),c="",0===o.node.type&&(o.node.algn=V(o.node.val,0,o.node.val.length)),o=new K({type:100,val:"\n"},o)):c+=a;else c+=f+1<G?e[x](f+1):"",f+=2;return c.length&&(0===o.node.type?o.node.val+=c:o=new K({type:0,val:c,algn:""},o)),0===o.node.type&&(o.node.algn=V(o.node.val,0,o.node.val.length)),[n,h]},O.align=b,O.main=T,O[n]={constructor:O,id:null,tpl:null,fn:null,_args:null,dispose:function(){var e=this;return e.id=null,e.tpl=null,e.fn=null,e._args=null,e},parse:function(){var e=this;return null===e.tpl&&null!=e._args&&(e.tpl=O.multisplit(e._args[0],e._args[1],e._args[2]),e._args=null),e},render:function(e){var n=this;return null==n.tpl&&n.parse(),O.main(null==e?{}:e,n.tpl[0],n.tpl[1],n.fn)}};var B=/\s/,k=/[0-9]/,U=/[a-z_]/i;D.parse=function(e,n){if(e instanceof D)return e;for(var l,t,s,i,r,a,o,u,c,f,d,p,h,_,E,T,v,g,I,m,b,N,A,O=["AS"],R=(e=H(e)).length,w=(t=[[]])[l=0],S=[],y=[],L="",q=i=0,M=c=u=r=s=null;l<R;)if("("!==(a=e.charAt(l++))||1!==l)if(0<q)if('"'!==a&&"`"!==a&&"'"!==a&&"["!==a&&"]"!==a){if(!u)if("("!==a){if(")"===a){if(--q<0){s=["paren",l];break}if(0===q){if(u){s=["quote",l];break}L=M=e.slice(0,l)}}}else++q}else if(u){if(u===a)if(f=('"'===a||"`"===a)&&n.qn[3]===a+a||"'"===a&&n.q[3]===a+a,d=('"'===a||"`"===a)&&n.qn[3]==="\\"+a||"'"===a&&n.q[3]==="\\"+a,f&&l<R&&a===e.charAt(l))++l;else if(d){if(p=!1,-1===n.e[1].indexOf("'\\'")||"'\\'"!==e.slice(c,l))for(h=l-2;0<=h&&"\\"===e.charAt(h);)p=!p,--h;p||(c=u=null)}else c=u=null}else u="["===a?"]":a,c=l-1;else{if('"'===a||"`"===a||"'"===a||"["===a||"]"===a){if(!r){if(L.length||"]"===a){s=["invalid",l];break}r="["===a?"]":a;continue}if(r===a){if(l<R&&a===e.charAt(l)){L+=a,++l;continue}if(!L.length){s=["invalid",l];break}w.unshift([1,L]),S.unshift(L),L="",r=null;continue}if(r){L+=a;continue}}if(r)L+=a;else if("*"===a){if(L.length){s=["invalid",l];break}w.unshift([10,"*"]),S.unshift(10)}else if("."===a){if(L.length&&(w.unshift([1,L]),S.unshift(L),L=""),!w.length||1!==w[0][0]){s=["invalid",l];break}w.unshift([0,"."]),S.unshift(0)}else if("("===a){if(++i,L.length&&(w.unshift([2,L]),y.unshift(L),L=""),!w.length||2!==w[0][0]&&1!==w[0][0]){s=["invalid",l];break}1===w[0][0]&&(w[0][0]=2,y.unshift(S.shift())),t.unshift([]),w=t[0]}else if(")"===a){if(--i,L.length&&(o=-1<O.indexOf(L.toUpperCase()),w.unshift([o?5:1,L]),S.unshift(o?5:L),L=""),t.length<2){s=["invalid",l];break}t[1].unshift([100,t.shift()]),w=t[0]}else if(B.test(a))L.length&&(o=-1<O.indexOf(L.toUpperCase()),w.unshift([o?5:1,L]),S.unshift(o?5:L),L="");else if(k.test(a)){if(!L.length){s=["invalid",l];break}L+=a}else{if(!U.test(a)){s=["invalid",l];break}L+=a}}else++q;if(L.length&&(w.unshift([1,L]),S.unshift(L),L=""),s||!i&&!q||(s=["paren",R]),s||!r&&!u||(s=["quote",R]),s||1===t.length||(s=["invalid",R]),s)throw A=s[1]-1,"paren"==(m=s[0])?new TypeError('Dialect: Mismatched parentheses "'+e+'" at position '+A+"."):"quote"==m?new TypeError('Dialect: Mismatched quotes "'+e+'" at position '+A+"."):new TypeError('Dialect: Invalid character "'+e+'" at position '+A+".");return b="",A=(m=null)!=M?(3<=S.length&&5===S[1]&&C(S[0])&&(m=S.shift(),b=n.quote_name(m),S.shift()),g=T=null,I=v="",E=N=_=M):(3<=S.length&&5===S[1]&&C(S[0])&&(m=S.shift(),b=n.quote_name(m),S.shift()),_=null,E="",S.length&&(C(S[0])||10===S[0])&&(10===S[0]?(S.shift(),_=E="*"):(_=S.shift(),E=n.quote_name(_))),T=null,v="",2<=S.length&&0===S[0]&&C(S[1])&&(S.shift(),T=S.shift(),v=n.quote_name(T)),g=null,I="",2<=S.length&&0===S[0]&&C(S[1])&&(S.shift(),g=S.shift(),I=n.quote_name(g)),N=(g?g+".":"")+(T?T+".":"")+(_||""),(g?I+".":"")+(T?v+".":"")+(_?E:"")),new D(_,E,T,v,g,I,m,b,N,A,y)},D[n]={constructor:D,_func:null,_col:null,col:null,_tbl:null,tbl:null,_dtb:null,dtb:null,_alias:null,alias:null,_qualified:null,qualified:null,full:null,aliased:null,cloned:function(e,n,l){var t=this;return n=arguments.length?n||e:(e=t._alias,t.alias),null==l&&(l=t._func),new D(t._col,t.col,t._tbl,t.tbl,t._dtb,t.dtb,e,n,t._qualified,t.qualified,l)},dispose:function(){var e=this;return e._func=null,e._col=null,e.col=null,e._tbl=null,e.tbl=null,e._dtb=null,e.dtb=null,e._alias=null,e.alias=null,e._qualified=null,e.qualified=null,e.full=null,e.aliased=null,e}};function q(e){var n=this;if(arguments.length||(e="mysql"),!(n instanceof q))return new q(e);if(e&&v.call(q.aliases,e)&&(e=q.aliases[e]),!e||!q.dialects[e]||!q.dialects[e].clauses)throw new TypeError('Dialect: SQL dialect does not exist for "'+e+'"');n.clau=null,n.clus=null,n.tbls=null,n.cols=null,n.vews={},n.tpls={},n.db=null,n.escdb=null,n.escdbn=null,n.p="",n.type=e,n.clauses=q.dialects[n.type].clauses,n.q=q.dialects[n.type].quotes[0],n.qn=q.dialects[n.type].quotes[1],n.e=q.dialects[n.type].quotes[2]||["","","",""]}return q.VERSION="1.4.0",q.dialects={mysql:{quotes:[["'","'","\\'","\\'"],["`","`","``","``"],["","","",""]],functions:{strpos:["POSITION(",2," IN ",1,")"],strlen:["LENGTH(",1,")"],strlower:["LCASE(",1,")"],strupper:["UCASE(",1,")"],trim:["TRIM(",1,")"],quote:["QUOTE(",1,")"],random:["RAND()"],now:["NOW()"]},types:{BINARY:"VARBINARY",SMALLINT:"TINYINT",MEDIUMINT:"MEDIUMINT",INT:"UNSIGNED INT",SIGNED_INT:"INT",BIGINT:"UNSIGNED BIGINT",SIGNED_BIGINT:"BIGINT",FLOAT:"FLOAT",DOUBLE:"DOUBLE",BOOL:"TINYINT",TIMESTAMP:"TIMESTAMP",DATETIME:"DATETIME",DATE:"DATE",TIME:"TIME",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"BLOB"},clauses:{start_transaction:"START TRANSACTION <type|>;",commit_transaction:"COMMIT;",rollback_transaction:"ROLLBACK;",transact:"START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]",create:"[<?view|>CREATE VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]UNIQUE KEY <name|> <type|> (<?uniquekey>[,<*uniquekey>])][[CONSTRAINT <?constraint> ]PRIMARY KEY <type|> (<?primarykey>)][[<?!index>KEY][<?index|>INDEX] <name|> <type|> (<?key>[,<*key>])][CHECK (<?check>)][<?column> <type>[ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ <?auto_increment|>AUTO_INCREMENT][ <?!primary><?unique|>UNIQUE KEY][ <?!unique><?primary|>PRIMARY KEY][ COMMENT '<?comment>'][ COLUMN_FORMAT <?format>][ STORAGE <?storage>]]][,\n<*col:COL>]]\n)][ <?options>:=[<opt:OPT>:=[[ENGINE=<?engine>][AUTO_INCREMENT=<?auto_increment>][CHARACTER SET=<?charset>][COLLATE=<?collation>]][, <*opt:OPT>]]][\nAS <?query>]]",alter:"ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]",drop:"DROP [<?view|>VIEW][<?!view>[<?temporary|>TEMPORARY ]TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]",union:"(<union_selects>)[\nUNION[<?union_all|> ALL]\n(<*union_selects>)][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]",delete:"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <offset|0>,<?count>]"}},postgresql:{quotes:[["'","'","''","''"],['"','"','""','""'],["E","","E",""]],functions:{strpos:["position(",2," in ",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["now()"]},types:{BINARY:"BYTEA",SMALLINT:"SMALLINT",MEDIUMINT:"INTEGER",INT:"SERIAL",SIGNED_INT:"INTEGER",BIGINT:"BIGSERIAL",SIGNED_BIGINT:"BIGINT",FLOAT:"REAL",DOUBLE:"DOUBLE PRECISION",BOOL:"BOOLEAN",TIMESTAMP:"TIMESTAMP WITHOUT TIME ZONE",DATETIME:"TIMESTAMP WITHOUT TIME ZONE",DATE:"DATE",TIME:"TIME WITHOUT TIME ZONE",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"BLOB"},clauses:{start_transaction:"START TRANSACTION <type|>;",commit_transaction:"COMMIT;",rollback_transaction:"ROLLBACK;",transact:"START TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]",create:"[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>:=[<col:COL>:=[[<?column> <type>[ COLLATE <?collation>][ CONSTRAINT <?constraint>][ <?!isnull><?isnotnull|>NOT NULL][ <?!isnotnull><?isnull|>NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?unique|>UNIQUE][ <?primary|>PRIMARY KEY]]][,\n<*col:COL>]]\n)]]",alter:"ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]",drop:"DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]",union:"(<union_selects>)[\nUNION[<?union_all|> ALL]\n(<*union_selects>)][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",delete:"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]"}},transactsql:{quotes:[["'","'","''","''"],["[","]","[","]"],[""," ESCAPE '\\'","",""]],functions:{strpos:["CHARINDEX(",2,",",1,")"],strlen:["LEN(",1,")"],strlower:["LOWER(",1,")"],strupper:["UPPER(",1,")"],trim:["LTRIM(RTRIM(",1,"))"],quote:["QUOTENAME(",1,',"\'")'],random:["RAND()"],now:["CURRENT_TIMESTAMP"]},types:{BINARY:"VARBINARY",SMALLINT:"TINYINT",MEDIUMINT:"SMALLINT",INT:"INT",SIGNED_INT:"INT",BIGINT:"BIGINT",SIGNED_BIGINT:"BIGINT",FLOAT:"FLOAT",DOUBLE:"REAL",BOOL:"BIT",TIMESTAMP:"DATETIME",DATETIME:"DATETIME",DATE:"DATE",TIME:"TIME",VARCHAR:"VARCHAR",TEXT:"TEXT",BLOB:"TEXT"},clauses:{start_transaction:"BEGIN TRANSACTION <type|>;",commit_transaction:"COMMIT;",rollback_transaction:"ROLLBACK;",transact:"BEGIN TRANSACTION  <type|>;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]",create:"[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>[<?ifnotexists|>IF NOT EXISTS (SELECT * FROM sysobjects WHERE name=<create_table> AND xtype='U')\n]CREATE TABLE <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ [CONSTRAINT <?constraint> ]DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)][<?ifnotexists|>\nGO]]",alter:"ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]",drop:"DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>[,<*drop_tables>]",union:"(<union_selects>)[\nUNION[<?union_all|> ALL]\n(<*union_selects>)][\nORDER BY <?order_conditions>[,<*order_conditions>]]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>][\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]][<?!order_conditions>[\nORDER BY 1\nOFFSET <offset|0> ROWS FETCH NEXT <?count> ROWS ONLY]]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]",delete:"DELETE \nFROM <from_tables>[,<*from_tables>][\nWHERE <?where_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]]"}},sqlite:{quotes:[["'","'","''","''"],['"','"','""','""'],[""," ESCAPE '\\'","",""]],functions:{strpos:["instr(",2,",",1,")"],strlen:["length(",1,")"],strlower:["lower(",1,")"],strupper:["upper(",1,")"],trim:["trim(",1,")"],quote:["quote(",1,")"],random:["random()"],now:["datetime('now')"]},types:{BINARY:"BLOB",SMALLINT:"INTEGER",MEDIUMINT:"INTEGER",INT:"INTEGER",SIGNED_INT:"INTEGER",BIGINT:"INTEGER",SIGNED_BIGINT:"INTEGER",FLOAT:"REAL",DOUBLE:"REAL",BOOL:"INTEGER",TIMESTAMP:"TEXT",DATETIME:"TEXT",DATE:"TEXT",TIME:"TEXT",VARCHAR:"TEXT",TEXT:"TEXT",BLOB:"BLOB"},clauses:{start_transaction:"BEGIN <type|> TRANSACTION;",commit_transaction:"COMMIT;",rollback_transaction:"ROLLBACK;",transact:"BEGIN <type|> TRANSACTION;\n<statements>;[\n<*statements>;]\n[<?rollback|>ROLLBACK;][<?!rollback>COMMIT;]",create:"[<?view|>CREATE[ <?temporary|>TEMPORARY] VIEW[ <?ifnotexists|>IF NOT EXISTS] <create_table> [(\n<?columns>[,\n<*columns>]\n)] AS <query>][<?!view>CREATE[ <?temporary|>TEMPORARY] TABLE[ <?ifnotexists|>IF NOT EXISTS] <create_table> [<?!query>(\n<columns>:=[<col:COL>:=[[[CONSTRAINT <?constraint> ]<?column> <type|>[ <?isnotnull|>NOT NULL][ DEFAULT <?default_value>][ CHECK (<?check>)][ <?!primary><?unique|>UNIQUE][ <?!unique><?primary|>PRIMARY KEY[ <?auto_increment|>AUTOINCREMENT][ COLLATE <?collation>]]]][,\n<*col:COL>]]\n)[ <?without_rowid|>WITHOUT ROWID]][AS <?query>]]",alter:"ALTER [<?view|>VIEW][<?!view>TABLE] <alter_table>\n<columns>[ <?options>]",drop:"DROP [<?view|>VIEW][<?!view>TABLE][ <?ifexists|>IF EXISTS] <drop_tables>",union:"(<union_selects>)[\nUNION[<?union_all|> ALL]\n(<*union_selects>)][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",select:"SELECT <select_columns>[,<*select_columns>]\nFROM <from_tables>[,<*from_tables>][\n<?join_clauses>:=[<join:JOIN>:=[[<?type> ]JOIN <table>[ ON <?cond>]][\n<*join:JOIN>]]][\nWHERE <?where_conditions>][\nGROUP BY <?group_conditions>[,<*group_conditions>]][\nHAVING <?having_conditions>][\nORDER BY <?order_conditions>[,<*order_conditions>]][\nLIMIT <?count> OFFSET <offset|0>]",insert:"INSERT INTO <insert_tables> (<insert_columns>[,<*insert_columns>])\n[VALUES <?values_values>[,<*values_values>]]",update:"UPDATE <update_tables>\nSET <set_values>[,<*set_values>][\nWHERE <?where_conditions>]",delete:"[<?!order_conditions><?!count>DELETE FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]][DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nORDER BY <?order_conditions> [, <*order_conditions>][\nLIMIT <?count> OFFSET <offset|0>]\n)][<?!order_conditions>DELETE FROM <from_tables> [, <*from_tables>] WHERE rowid IN (\nSELECT rowid FROM <from_tables> [, <*from_tables>][\nWHERE <?where_conditions>]\nLIMIT <?count> OFFSET <offset|0>\n)]"}}},q.aliases={mysqli:"mysql",mariadb:"mysql",sqlserver:"transactsql",postgres:"postgresql",postgre:"postgresql"},q.StringTemplate=u,q.GrammarTemplate=O,q.Ref=D,q[n]={constructor:q,clau:null,clus:null,tbls:null,cols:null,vews:null,tpls:null,db:null,escdb:null,escdbn:null,p:null,type:null,clauses:null,q:null,qn:null,e:null,dispose:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e.vews=null,e.tpls=null,e.db=null,e.escdb=null,e.escdbn=null,e.p=null,e.type=null,e.clauses=null,e.q=null,e.qn=null,e.e=null,e},toString:function(){return this.sql()||""},driver:function(e){return arguments.length?(this.db=e||null,this):this.db},escape:function(e,n){return arguments.length<2&&(n=!1),arguments.length?(this.escdb=e&&m(e)?[e,!!n]:null,this):this.escdb},escapeId:function(e,n){return arguments.length<2&&(n=!1),arguments.length?(this.escdbn=e&&m(e)?[e,!!n]:null,this):this.escdbn},prefix:function(e){return arguments.length?(this.p=e&&e.length?String(e):"",this):this.p},reset:function(e){var n=this;if(!e||!v.call(n.clauses,e))throw new TypeError('Dialect: SQL clause "'+e+'" does not exist for dialect "'+n.type+'"');return n.clus={},n.tbls={},n.cols={},n.clau=e,n.clauses[n.clau]instanceof q.GrammarTemplate||(n.clauses[n.clau]=new q.GrammarTemplate(n.clauses[n.clau])),n},clear:function(){var e=this;return e.clau=null,e.clus=null,e.tbls=null,e.cols=null,e},subquery:function(){var e,n,l=this,t=new q(l.type);return t.driver(l.driver()).prefix(l.prefix()),e=l.escape(),n=l.escapeId(),e&&t.escape(e[0],e[1]),n&&t.escapeId(n[0],n[1]),t.vews=l.vews,t},sql:function(){var e,n=this,l="";return n.clau&&v.call(n.clauses,n.clau)&&(e=d({},n.clus),v.call(n.clus,"select_columns")&&(e.select_columns=L(n.clus.select_columns,"aliased")),v.call(n.clus,"from_tables")&&(e.from_tables=L(n.clus.from_tables,"aliased")),v.call(n.clus,"insert_tables")&&(e.insert_tables=L(n.clus.insert_tables,"aliased")),v.call(n.clus,"insert_columns")&&(e.insert_columns=L(n.clus.insert_columns,"full")),v.call(n.clus,"update_tables")&&(e.update_tables=L(n.clus.update_tables,"aliased")),v.call(n.clus,"create_table")&&(e.create_table=L(n.clus.create_table,"full")),v.call(n.clus,"alter_table")&&(e.alter_table=L(n.clus.alter_table,"full")),v.call(n.clus,"drop_tables")&&(e.drop_tables=L(n.clus.drop_tables,"full")),v.call(n.clus,"where_conditions_required")&&(e.where_conditions=v.call(n.clus,"where_conditions")?"("+n.clus.where_conditions_required+") AND ("+n.clus.where_conditions+")":n.clus.where_conditions_required),v.call(n.clus,"having_conditions_required")&&(e.having_conditions=v.call(n.clus,"having_conditions")?"("+n.clus.having_conditions_required+") AND ("+n.clus.having_conditions+")":n.clus.having_conditions_required),l=n.clauses[n.clau].render(e)||""),l},createView:function(e){var n=this;return e&&n.clau&&(n.vews[e]={clau:n.clau,clus:n.clus,tbls:n.tbls,cols:n.cols},v.call(n.vews[e].clus,"where_conditions")&&(n.vews[e].clus.where_conditions&&(n.vews[e].clus.where_conditions_required=n.vews[e].clus.where_conditions),delete n.vews[e].clus.where_conditions),v.call(n.vews[e].clus,"having_conditions")&&(n.vews[e].clus.having_conditions&&(n.vews[e].clus.having_conditions_required=n.vews[e].clus.having_conditions),delete n.vews[e].clus.having_conditions),n.clear()),n},useView:function(e){var n,l=this,t=l.clus.select_columns;if(e=l.vews[e],l.clus=d(l.clus,e.clus,!0,!0),l.tbls=d({},e.tbls,!0),l.cols=d({},e.cols,!0),t){n=[];for(var s=0,i=(t=l.refs(t,l.cols,!0)).length;s<i;++s)"*"===t[s].full?n=n.concat(l.clus.select_columns):n.push(t[s]);l.clus.select_columns=n}return l},dropView:function(e){return e&&v.call(this.vews,e)&&delete this.vews[e],this},prepareTpl:function(e){var n,l,t,s,i;return I(e)||(i=1===(n=(i=arguments).length)?!(s=t=l=null):2===n?(l=i[1],s=t=null,!1):3===n?(t=i[1],s=i[2],!(l=null)):(l=i[1],t=i[2],s=i[3],!1),s=h((t=t?_(t):"%")+"(([rlfids]:)?[0-9a-zA-Z_]+)"+(s=s?_(s):"%")),s=new q.StringTemplate(i?this.sql():l,s),this.tpls[e]={sql:s,types:null}),this},prepared:function(e,n){var l,t,s,i,r,a,o,u,c,f=this;if(I(e)||!v.call(f.tpls,e))return"";if(l=f.tpls[e].sql,null==(t=f.tpls[e].types)){for(l.parse(),t={},a=0,o=l.tpl.length;a<o;++a)0===(u=l.tpl[a])[0]&&(1<(c=u[1].split(":")).length?(t[c[1]]=c[0],l.tpl[a][1]=c[1]):(t[c[0]]="s",l.tpl[a][1]=c[0]));f.tpls[e].types=t}for(c in s={},n)if(v.call(n,c))switch(i=n[c],v.call(t,c)?t[c]:"s"){case"r":R(i)?s[c]=i.join(","):s[c]=i;break;case"l":s[c]=f.like(i);break;case"f":if(R(i))for(r=y(i),s[c]=D.parse(r[0],f).aliased,a=1,o=r.length;a<o;++a)s[c]+=","+D.parse(r[a],f).aliased;else s[c]=D.parse(i,f).aliased;break;case"i":R(i)?s[c]=f.intval(y(i)).join(","):s[c]=f.intval(i);break;case"d":R(i)?s[c]=f.floatval(y(i)).join(","):s[c]=f.floatval(i);break;case"s":default:R(i)?s[c]=f.quote(y(i)).join(","):s[c]=f.quote(i)}return l.render(s)},prepare:function(e,n,l,t){var s,i,r,a,o,u,c,f,d,p=this;if(e&&n){for(s=h((l=l?_(l):"%")+"([rlfids]:)?([0-9a-zA-Z_]+)"+(t=t?_(t):"%")),d="";e.length&&(i=e.match(s));){if(r=i.index,a=i[0].length,f=i[2],v.call(n,f)){switch(i[1]?i[1].slice(0,-1):"s"){case"r":f=R(n[f])?n[f].join(","):n[f];break;case"l":f=p.like(n[f]);break;case"f":if(R(n[f]))for(c=y(n[f]),f=D.parse(c[0],p).aliased,o=1,u=c.length;o<u;++o)f+=","+D.parse(c[o],p).aliased;else f=D.parse(n[f],p).aliased;break;case"i":f=R(n[f])?p.intval(y(n[f])).join(","):p.intval(n[f]);break;case"d":f=R(n[f])?p.floatval(y(n[f])).join(","):p.floatval(n[f]);break;case"s":default:f=R(n[f])?p.quote(y(n[f])).join(","):p.quote(n[f])}d+=e.slice(0,r)+f}else d+=e.slice(0,r)+p.quote("");e=e.slice(r+a)}return e.length&&(d+=e),d}return e},dropTpl:function(e){return!I(e)&&v.call(this.tpls,e)&&(this.tpls[e].sql.dispose(),delete this.tpls[e]),this},StartTransaction:function(e,n){return n=n||"start_transaction",this.clau!==n&&this.reset(n),this.clus.type=e||null,this},CommitTransaction:function(e){return e=e||"commit_transaction",this.clau!==e&&this.reset(e),this},RollbackTransaction:function(e){return e=e||"rollback_transaction",this.clau!==e&&this.reset(e),this},Transaction:function(e,n){var l=this;return n=n||"transact",l.clau!==n&&l.reset(n),e=e||{},l.clus.type=e.type||null,l.clus.rollback=e.rollback?1:null,I(e.statements)||(e=y(void 0),l.clus.statements=l.clus.statements?l.clus.statements.concat(e):e),l},Create:function(e,n,l){var t=this;return l=l||"create",t.clau!==l&&t.reset(l),n=n||{ifnotexists:1},t.clus.create_table=t.refs(e,t.tbls),t.clus.view=n.view?1:null,t.clus.ifnotexists=n.ifnotexists?1:null,t.clus.temporary=n.temporary?1:null,t.clus.query=I(n.query)?null:n.query,I(n.columns)||(e=y(n.columns),t.clus.columns=t.clus.columns?t.clus.columns.concat(e):e),I(n.table)||(n=y(n.table),t.clus.options=t.clus.options?t.clus.options.concat(n):n),t},Alter:function(e,n,l){var t=this;return l=l||"alter",t.clau!==l&&t.reset(l),t.clus.alter_table=t.refs(e,t.tbls),n=n||{},t.clus.view=n.view?1:null,I(n.columns)||(e=y(n.columns),t.clus.columns=t.clus.columns?t.clus.columns.concat(e):e),I(n.table)||(n=y(n.table),t.clus.options=t.clus.options?t.clus.options.concat(n):n),t},Drop:function(e,n,l){var t=this;return l=l||"drop",t.clau!==l&&t.reset(l),l=R(e)?e[0]:e,v.call(t.vews,l)?t.dropView(l):(C(e)&&(e=e.split(",")),e=t.refs(null==e?"*":e,t.tbls),n=n||{ifexists:1},t.clus.view=n.view?1:null,t.clus.ifexists=n.ifexists?1:null,t.clus.temporary=n.temporary?1:null,t.clus.drop_tables=t.clus.drop_tables?t.clus.drop_tables.concat(e):e),t},Select:function(e,n){var l=this;return n=n||"select",l.clau!==n&&l.reset(n),C(e)&&(e=e.split(",")),e=l.refs(null==e?"*":e,l.cols),l.clus.select_columns=l.clus.select_columns?l.clus.select_columns.concat(e):e,l},Union:function(e,n,l){var t=this;return l=l||"union",t.clau!==l&&t.reset(l),t.clus.union_selects=t.clus.union_selects?t.clus.union_selects.concat(y(e)):y(e),t.clus.union_all=n?"":null,t},Insert:function(e,n,l){var t=this;return l=l||"insert",t.clau!==l&&t.reset(l),l=R(e)?e[0]:e,v.call(t.vews,l)&&t.clau===t.vews[l].clau?t.useView(l):(C(e)&&(e=e.split(",")),C(n)&&(n=n.split(",")),e=t.refs(e,t.tbls),n=t.refs(n,t.cols),t.clus.insert_tables=t.clus.insert_tables?t.clus.insert_tables.concat(e):e,t.clus.insert_columns=t.clus.insert_columns?t.clus.insert_columns.concat(n):n),t},Values:function(e){var n,l,t,s,i,r,a,o,u=this;if(I(e))return u;for(c!==e[0]&&R(e[0])||(e=[e]),n=e.length,l=[],s=0;s<n;++s)if((o=y(e[s])).length){for(t=[],r=0,a=o.length;r<a;++r)g(i=o[r])?v.call(i,"raw")?t.push(i.raw):v.call(i,"integer")?t.push(u.intval(i.integer)):v.call(i,"int")?t.push(u.intval(i.int)):v.call(i,"float")?t.push(u.floatval(i.float)):v.call(i,"string")&&t.push(u.quote(i.string)):t.push(null===i?"NULL":S(i)?String(i):u.quote(i));l.push("("+t.join(",")+")")}return l=l.join(","),u.clus.values_values&&(l=u.clus.values_values+","+l),u.clus.values_values=l,u},Update:function(e,n){var l=this;return n=n||"update",l.clau!==n&&l.reset(n),n=R(e)?e[0]:e,v.call(l.vews,n)&&l.clau===l.vews[n].clau?l.useView(n):(C(e)&&(e=e.split(",")),e=l.refs(e,l.tbls),l.clus.update_tables=l.clus.update_tables?l.clus.update_tables.concat(e):e),l},Set:function(e){var n,l,t,s,i,r,a=this;if(I(e))return a;for(t in n=[],r=a.cols,e)if(v.call(e,t))if(s=a.refs(t,r)[0].full,g(i=e[t])){if(v.call(i,"raw"))n.push(s+" = "+i.raw);else if(v.call(i,"integer"))n.push(s+" = "+a.intval(i.integer));else if(v.call(i,"int"))n.push(s+" = "+a.intval(i.int));else if(v.call(i,"float"))n.push(s+" = "+a.floatval(i.float));else if(v.call(i,"string"))n.push(s+" = "+a.quote(i.string));else if(v.call(i,"increment"))n.push(s+" = "+s+" + "+a.numval(i.increment));else if(v.call(i,"decrement"))n.push(s+" = "+s+" - "+a.numval(i.decrement));else if(v.call(i,"case")){if(l=s+" = CASE",v.call(i.case,"when")){for(case_value in i.case.when)v.call(i.case.when,case_value)&&(l+="\nWHEN "+a.conditions(i.case.when[case_value],!1)+" THEN "+a.quote(case_value));v.call(i.case,"else")&&(l+="\nELSE "+a.quote(i.case.else))}else for(case_value in i.case)v.call(i.case,case_value)&&(l+="\nWHEN "+a.conditions(i.case[case_value],!1)+" THEN "+a.quote(case_value));l+="\nEND",n.push(l)}}else n.push(s+" = "+(null===i?"NULL":S(i)?String(i):a.quote(i)));return n=n.join(","),a.clus.set_values&&(n=a.clus.set_values+","+n),a.clus.set_values=n,a},Delete:function(e){return e=e||"delete",this.clau!==e&&this.reset(e),this},From:function(e){var n,l=this;return I(e)||(n=R(e)?e[0]:e,v.call(l.vews,n)&&l.clau===l.vews[n].clau?l.useView(n):(C(e)&&(e=e.split(",")),e=l.refs(e,l.tbls),l.clus.from_tables=l.clus.from_tables?l.clus.from_tables.concat(e):e)),l},Join:function(e,n,l){var t,s,i,r=this;if(e=r.refs(e,r.tbls)[0].aliased,l=I(l)?null:l.toUpperCase(),I(n))t={table:e,type:l};else{if(C(n))n="("+(n=r.refs(n.split("="),r.cols))[0].full+"="+n[1].full+")";else{for(s in n)v.call(n,s)&&(g(i=n[s])||(n[s]={eq:i,type:"identifier"}));n="("+r.conditions(n,!1)+")"}t={table:e,type:l,cond:n}}return r.clus.join_clauses?r.clus.join_clauses.push(t):r.clus.join_clauses=[t],r},Where:function(e,n){var l=this;return I(e)||("OR"!==(n=n?String(n).toUpperCase():"AND")&&(n="AND"),e=l.conditions(e,!1),l.clus.where_conditions&&(e=l.clus.where_conditions+" "+n+" "+e),l.clus.where_conditions=e),l},Group:function(e){var n=this,e=n.refs(e,n.cols)[0].alias;return n.clus.group_conditions&&(e=n.clus.group_conditions+","+e),n.clus.group_conditions=e,n},Having:function(e,n){var l=this;return I(e)||("OR"!==(n=n?String(n).toUpperCase():"AND")&&(n="AND"),e=l.conditions(e,!0),l.clus.having_conditions&&(e=l.clus.having_conditions+" "+n+" "+e),l.clus.having_conditions=e),l},Order:function(e,n){var l=this;return"DESC"!==(n=n?String(n).toUpperCase():"ASC")&&(n="ASC"),n=l.refs(e,l.cols)[0].alias+" "+n,l.clus.order_conditions&&(n=l.clus.order_conditions+","+n),l.clus.order_conditions=n,l},Limit:function(e,n){return this.clus.count=r(e),this.clus.offset=r(n||0),this},Page:function(e,n){return e=r(e),n=r(n),this.Limit(n,e*n)},conditions:function(e,n){var l,t,s,i,r,a,o,u,c,f,d,p,h,_=this;if(I(e))return"";if(C(e))return e;for(s in l="",t=[],f=_.cols,a=!0===n?"alias":"full",e)if(v.call(e,s))if(g(r=e[s]))if(v.call(r,"raw"))t.push(String(r.raw));else if(v.call(r,"or")){d=[];for(var E=0,T=r.or.length;E<T;++E)p=r.or[E],d.push(_.conditions(p,n));t.push(d.join(" OR "))}else if(v.call(r,"and")){d=[];for(E=0,T=r.and.length;E<T;++E)p=r.and[E],d.push(_.conditions(p,n));t.push(d.join(" AND "))}else if(v.call(r,"either")){d=[];for(E=0,T=r.either.length;E<T;++E)(p={})[s]=r.either[E],d.push(_.conditions(p,n));t.push(d.join(" OR "))}else if(v.call(r,"together")){d=[];for(E=0,T=r.together.length;E<T;++E)(p={})[s]=r.together[E],d.push(_.conditions(p,n));t.push(d.join(" AND "))}else if(i=_.refs(s,f)[0][a],u=v.call(r,"type")?r.type:"string",v.call(r,"case")){if(d=i+" = CASE",v.call(r.case,"when")){for(h in r.case.when)v.call(r.case.when,h)&&(d+=" WHEN "+_.conditions(r.case.when[h],n)+" THEN "+_.quote(h));v.call(r.case,"else")&&(d+=" ELSE "+_.quote(r.case.else))}else for(h in r.case)v.call(r.case,h)&&(d+=" WHEN "+_.conditions(r.case[h],n)+" THEN "+_.quote(h));d+=" END",t.push(d)}else v.call(r,"multi_like")?t.push(_.multi_like(i,r.multi_like)):v.call(r,"like")?t.push(i+" LIKE "+("raw"===u?String(r.like):_.like(r.like))):v.call(r,"not_like")?t.push(i+" NOT LIKE "+("raw"===u?String(r.not_like):_.like(r.not_like))):v.call(r,"contains")?(c=String(r.contains),"raw"===u||(c=_.quote(c)),t.push(_.sql_function("strpos",[i,c])+" > 0")):v.call(r,"not_contains")?(c=String(r.not_contains),"raw"===u||(c=_.quote(c)),t.push(_.sql_function("strpos",[i,c])+" = 0")):v.call(r,"in")?(c=y(r.in),"raw"===u||(c="int"===u||"integer"===u||w(c[0])?_.intval(c):"float"===u||S(c[0])?_.floatval(c):_.quote(c)),t.push(i+" IN ("+c.join(",")+")")):v.call(r,"not_in")?(c=y(r.not_in),"raw"===u||(c="int"===u||"integer"===u||w(c[0])?_.intval(c):"float"===u||S(c[0])?_.floatval(c):_.quote(c)),t.push(i+" NOT IN ("+c.join(",")+")")):v.call(r,"between")?null==(c=y(r.between))[0]?("raw"===u||("int"===u||"integer"===u||w(c[1])?c[1]=_.intval(c[1]):"float"===u||S(c[1])?c[1]=_.floatval(c[1]):c[1]=_.quote(c[1])),t.push(i+" <= "+c[1])):null==c[1]?("raw"===u||("int"===u||"integer"===u||w(c[0])?c[0]=_.intval(c[0]):"float"===u||S(c[0])?c[0]=_.floatval(c[0]):c[0]=_.quote(c[0])),t.push(i+" >= "+c[0])):("raw"===u||(c="int"===u||"integer"===u||w(c[0])&&w(c[1])?_.intval(c):"float"===u||S(c[0])&&S(c[1])?_.floatval(c):_.quote(c)),t.push(i+" BETWEEN "+c[0]+" AND "+c[1])):v.call(r,"not_between")?null==(c=y(r.not_between))[0]?("raw"===u||("int"===u||"integer"===u||w(c[1])?c[1]=_.intval(c[1]):"float"===u||S(c[1])?c[1]=_.floatval(c[1]):c[1]=_.quote(c[1])),t.push(i+" > "+c[1])):null==c[1]?("raw"===u||("int"===u||"integer"===u||w(c[0])?c[0]=_.intval(c[0]):"float"===u||S(c[0])?c[0]=_.floatval(c[0]):c[0]=_.quote(c[0])),t.push(i+" < "+c[0])):("raw"===u||(c="int"===u||"integer"===u||w(c[0])&&w(c[1])?_.intval(c):"float"===u||S(c[0])&&S(c[1])?_.floatval(c):_.quote(c)),t.push(i+" < "+c[0]+" OR "+i+" > "+c[1])):v.call(r,"gt")||v.call(r,"gte")?(c=r[o=v.call(r,"gt")?"gt":"gte"],"raw"===u||(c="int"===u||"integer"===u||w(c)?_.intval(c):"float"===u||S(c)?_.floatval(c):"identifier"===u||"field"===u?_.refs(c,f)[0][a]:_.quote(c)),t.push(i+("gt"===o?" > ":" >= ")+c)):v.call(r,"lt")||v.call(r,"lte")?(c=r[o=v.call(r,"lt")?"lt":"lte"],"raw"===u||(c="int"===u||"integer"===u||w(c)?_.intval(c):"float"===u||S(c)?_.floatval(c):"identifier"===u||"field"===u?_.refs(c,f)[0][a]:_.quote(c)),t.push(i+("lt"===o?" < ":" <= ")+c)):v.call(r,"not_equal")||v.call(r,"not_eq")?(c=r[o=v.call(r,"not_eq")?"not_eq":"not_equal"],"raw"===u||null===c||(c="int"===u||"integer"===u||w(c)?_.intval(c):"float"===u||S(c)?_.floatval(c):"identifier"===u||"field"===u?_.refs(c,f)[0][a]:_.quote(c)),t.push(null===c?i+" IS NOT NULL":i+" <> "+c)):(v.call(r,"equal")||v.call(r,"eq"))&&(c=r[o=v.call(r,"eq")?"eq":"equal"],"raw"===u||null===c||(c="int"===u||"integer"===u||w(c)?_.intval(c):"float"===u||S(c)?_.floatval(c):"identifier"===u||"field"===u?_.refs(c,f)[0][a]:_.quote(c)),t.push(null===c?i+" IS NULL":i+" = "+c));else i=_.refs(s,f)[0][a],t.push(null===r?i+" IS NULL":i+" = "+(S(r)?String(r):_.quote(r)));return t.length&&(l="("+t.join(") AND (")+")"),l},joinConditions:function(e,n){var l,t,s,i,r,a,o,u,c,f,d=0;for(l in n)v.call(n,l)&&(t=D.parse(l,this)._col,v.call(e,t)&&(s=n[l],r=e[t].table,a=e[t].id,o=e[t].join,u=e[t].join_id,c=o+ ++d,i={},v.call(e[t],"key")&&t!==e[t].key?i[c+"."+(f=e[t].key)]=t:f=t,v.call(e[t],"value")?i[c+"."+e[t].value]=s:i[c+"."+f]=s,this.Join(o+" AS "+c,r+"."+a+"="+c+"."+u,"inner").Where(i),delete n[l]));return this},refs:function(e,n,l){var t,s,i;if(!0===l){for(r=0,a=e.length;r<a;++r)u=(o=e[r]).alias,c=o.qualified,"*"!==(s=o.full)&&(v.call(n,u)?e[r]=n[u]:v.call(n,s)?(i=(t=n[s]).alias,t.full!==s&&i!==u&&i===s&&(t=t.cloned(o.alias),e[r]=n[u]=t)):v.call(n,c)?((t=n[c]).qualified!==c&&(t=n[t.qualified]),t=o.full!==o.alias?t.cloned(o.alias,null,o._func):t.cloned(null,t.alias,o._func),(e[r]=n[t.alias]=t).alias===t.full||v.call(n,t.full)||(n[t.full]=t)):(n[u]=o,u===s||v.call(n,s)||(n[s]=o)))}else{var r,a,o,u,c,f=y(e);for(e=[],r=0,a=f.length;r<a;++r)u=(o=D.parse(f[r],this)).alias,c=o.full,v.call(n,u)?o=n[u]:(n[u]=o,c===u||v.call(n,c)||(n[c]=o)),e.push(o)}return e},tbl:function(e){if(R(e)){for(var n=0,l=e.length;n<l;++n)e[n]=this.tbl(e[n]);return e}return this.p+String(e)},intval:function(e){if(R(e)){for(var n=0,l=e.length;n<l;++n)e[n]=this.intval(e[n]);return e}return w(e)?e:parseInt(String(e),10)},floatval:function(e){if(R(e)){for(var n=0,l=e.length;n<l;++n)e[n]=this.floatval(e[n]);return e}return S(e)?e:parseFloat(String(e),10)},numval:function(e){if(R(e)){for(var n=0,l=e.length;n<l;++n)e[n]=this.numval(e[n]);return e}return S(e)?e:parseFloat(String(e),10)},quote_name:function(e,n){var l,t,s,i,r=this.qn,a=this.escdbn;if(n=!0===n,R(e)){for(l=0,t=e.length,s=new Array(t);l<t;++l)s[l]=this.quote_name(e[l],n);return s}if(e=String(e),n&&r[0]===e.slice(0,r[0].length)&&r[1]===e.slice(-r[1].length))return e;if(a)return a[1]?a[0](e):r[0]+a[0](e)+r[1];for(l=0,t=e.length,s="";l<t;++l)i=e.charAt(l),r[0]===i?s+=r[2]:r[1]===i?s+=r[3]:s+=i;return r[0]+s+r[1]},quote:function(e){var n,l=this,t=l.q,s=l.e,i=l.escdb;if(R(e)){for(var r=0,a=e.length,o=new Array(a);r<a;++r)o[r]=l.quote(e[r]);return o}return n=-1!==(e=String(e)).indexOf("\\"),i?i[1]?i[0](e):(n?s[2]:"")+t[0]+i[0](e)+t[1]+(n?s[3]:""):(n?s[2]:"")+t[0]+l.esc(e)+t[1]+(n?s[3]:"")},esc:function(e){var n,l,t,s,i,r,a=this;if(R(e)){for(l=0,t=e.length,r=new Array(t);l<t;++l)r[l]=a.esc(e[l]);return r}if(a.escdb&&!a.escdb[1])return a.escdb[0](e);for(i=a.q,n=o+"\\",r="",l=0,t=(e=String(e)).length;l<t;++l)s=e.charAt(l),i[0]===s?r+=i[2]:i[1]===s?r+=i[3]:r+=f(s,n,"\\");return r},esc_like:function(e){if(R(e)){for(var n=0,l=e.length,t=new Array(l);n<l;++n)t[n]=this.esc_like(e[n]);return t}return f(e,"_%","\\")},like:function(e){var n,l,t=this;if(R(e)){for(var s=0,i=e.length,r=new Array(i);s<i;++s)r[s]=t.like(e[s]);return r}return n=t.q,(l=t.escdb?["","","",""]:t.e)[0]+n[0]+"%"+t.esc_like(t.esc(e))+"%"+n[1]+l[1]},multi_like:function(e,n,l){var t,s,i,r,a,o,u;for(l=!1!==l,t=e+" LIKE ",s=n.split(","),l&&(s=E(p(s,H),Boolean)),r=0,a=s.length;r<a;++r){for(i=s[r].split("+"),l&&(i=E(p(i,H),Boolean)),o=0,u=i.length;o<u;++o)i[o]=t+this.like(i[o]);s[r]="("+i.join(" AND ")+")"}return s.join(" OR ")},sql_function:function(e,n){var l,t,s,i,r,a;if(!q.dialects[this.type].functions||!v.call(q.dialects[this.type].functions,e))throw new TypeError('Dialect: SQL function "'+e+'" does not exist for dialect "'+this.type+'"');for(e=q.dialects[this.type].functions[e],a=(n=null!=n?y(n):[]).length,l="",t=!1,s=0,i=e.length;s<i;++s)r=e[s],l+=t?0<r&&r<=a?String(n[r-1]):"":r,t=!t;return l},sql_type:function(e){if(e=String(e).toUpperCase(),!q.dialects[this.type].types||!v.call(q.dialects[this.type].types,e))throw new TypeError('Dialect: SQL type "'+e+'" does not exist for dialect "'+this.type+'"');return String(q.dialects[this.type].types[e])}},q});
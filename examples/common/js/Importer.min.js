/**
*  Importer
*  a simple loader manager for classes and assets with dependencies for PHP, Python, Node/XPCOM/JS
*
*  @version 0.3.4
*  https://github.com/foo123/Importer
**/
!function(e,t,n){"use strict";var r;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[t])&&(e[t]=n.call(e)):"object"==typeof module&&module.exports?module.exports=n.call(e):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(t,[],function(r){r(t,n.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e)}):t in e||(e[t]=r=n.call(e))&&"function"==typeof define&&define.amd&&define(function(){return r})}(this,"Importer",function(){"use strict";function e(e,t,n,r,i){var s,p,u,f,h,d,m=r.length,v=new Array(m);if(x||C||k){for(s=0;m>s;s++)n[y](r[s].cache_id)?v[s]=n[r[s].cache_id]:"class"!==r[s].type?v[s]=n[r[s].cache_id]=M(r[s].path,x?"UTF-8":"utf8"):r[s].name in t?v[s]=t[r[s].name]:(v[s]=B(r[s].name,r[s].path,t)||null,e.trigger("import-class",[e,r[s].id,r[s].name,r[s].path,v[s]]).trigger("import-class-"+r[s].id,[e,r[s].id,r[s].name,r[s].path,v[s]]));return i.apply(t,v)}f=o("head",0),p=0,s=0,h=function(e,t,r,i){var s,o;"style"===t||"script"===t?(o=l(e))&&t===o.tagName[_]()?i():z(r,"utf8",function(r){n[e]=r,c(t,r)[g]("id",e),i()}):"class"!==t?"template"===t&&(o=l(e))&&"script"===o.tagName[_]()?i():z(r,"utf8",function(r){n[e]=r,"template"!==t||l(e)||c("tpl",r)[g]("id",e),i()}):(o=l(e))&&"script"===o.tagName[_]()?i():(s=0,o=a("script"),o[g]("id",e),o[g]("type","text/javascript"),o[g]("language","javascript"),o.onload=o.onreadystatechange=function(){s||o.readyState&&"loaded"!=o.readyState&&"complete"!=o.readyState||(s=1,o.onload=o.onreadystatechange=null),i()},o[g]("src",r),f.appendChild(o))},d=function b(){var l;(l=n[y](r[s].cache_id))||r[s].name in t?(v[s]=(l?n[r[s].cache_id]:t[r[s].name])||null,e.trigger("import-class",[e,r[s].id,r[s].name,r[s].path,v[s]]).trigger("import-class-"+r[s].id,[e,r[s].id,r[s].name,r[s].path,v[s]]),++s>=m?i.apply(t,v):(l=n[y](r[s].cache_id))||r[s].name in t?(v[s]=(l?n[r[s].cache_id]:t[r[s].name])||null,b()):(t[r[s].name]=null,h(r[s].cache_id,r[s].type,r[s].path,b))):++p<4?setTimeout(b,20):(p=0,t[r[s].name]=null,e.trigger("import-class",[e,r[s].id,r[s].name,r[s].path,null]).trigger("import-class-"+r[s].id,[e,r[s].id,r[s].name,r[s].path,null]),s++,b())};for(;m>s&&((u=n[y](r[s].cache_id))||r[s].name in t);)v[s]=(u?n[r[s].cache_id]:t[r[s].name])||null,s++;m>s?h(r[s].cache_id,r[s].type,r[s].path,d):i.apply(t,v)}function t(e){return"function"==typeof e}function n(e){return e instanceof String||"[object String]"===v.call(e)}function r(e){return e instanceof Array||"[object Array]"===v.call(e)}function i(e){if(!e)return!0;var t=v.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===t||"[object String]"===t)&&!e.length}function s(e){return r(e)?e:[e]}function l(e){return document.getElementById(e)}function a(e){return document.createElement(e)}function o(e,t){var n=document.getElementsByTagName(e);return arguments.length>1?0>t?n[n.length+t]:n[t]:n}function p(e,t){var n,r,i,s,l,a=typeof t;if("object"===a){r=0;for(n in t)t[y](n)&&(i=t[n],s=i.selector,l=[].concat(i.rules).join("; "),"insertRule"in e.sheet?(e.sheet.insertRule(s+"{"+l+"}",r),i.css=e.sheet.cssRules[r]):"addRule"in e.sheet&&(e.sheet.addRule(s,l,r),i.css=e.sheet.rules[r]),r++)}else"string"===a&&(e.styleSheet?e.styleSheet.cssText=(e.styleSheet.cssText||"")+t:e.appendChild(document.createTextNode(t)));return t}function c(e,t,n){var r,i,s=null,l=null;switch(e){case"tpl-link":case"tpl":s=a("script"),s[g]("type","text/x-tpl"),s.appendChild(document.createTextNode(t)),document.head.appendChild(s);break;case"script-link":if(n)for(i=o("script"),r=i.length-1;r>=0;r--)if(i[r].src&&t===i[r].src){l=i[r];break}l?s=l:(s=a("script"),s[g]("type","text/javascript"),s[g]("language","javascript"),s[g]("src",t),document.head.appendChild(s));break;case"script":s=a("script"),s[g]("type","text/javascript"),s[g]("language","javascript"),s.appendChild(document.createTextNode(t)),document.head.appendChild(s);break;case"style-link":if(n)for(i=o("link"),r=i.length-1;r>=0;r--)if(t===i[r].href){l=i[r];break}l?s=l:(s=a("link"),s[g]("type","text/css"),s[g]("rel","stylesheet"),s[g]("media","all"),s[g]("href",t),document.head.appendChild(s));break;case"style":default:s=a("style"),s[g]("type","text/css"),s[g]("media","all"),s.appendChild(document.createTextNode("")),document.head.appendChild(s),t&&p(s,t)}return s}function u(e){return e.split(F).join(U)}function f(e){return e.split(U).join(F)}function h(){var e,t=arguments,n=".";return t.length?(x?n=OS.Path.join.apply(OS.Path,t):C?(e=require("path"),n=e.join.apply(e,t)):n=d.apply(null,t),n):n}function d(){var e,t,n,r,i,s,l,a,o,p=arguments,c=p.length,h=P;if(!c)return".";if(e=b.call(p,u).join(h),t=e.length,!t)return".";for(n=e.charAt(0),r=e.charAt(t-1),i=e.split(E).filter(Boolean),s=[],l=0,a=i.length-1;a>=0;)o=i[a],".."===o?l++:"."!==o&&(l?l--:s.push(i[a])),a--;return e=s.reverse().join(h),e||n||(e="."),e&&r===h&&(e+=h),(n===h?h:"")+f(e)}var m="prototype",y="hasOwnProperty",g="setAttribute",_="toLowerCase",v=Object[m].toString,b=Array[m].map,S=String[m].startsWith?function(e,t,n){return e.startsWith(t,n||0)}:function(e,t,n){return n=n||0,t===e.substr(n,t.length+n)},j=function(){},x="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"],C=!x&&"undefined"!=typeof global&&"[object global]"===v.call(global),k=!x&&!C&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,T=!x&&!C&&!k&&"undefined"!=typeof navigator,I=("function"==typeof define&&define.amd&&"function"==typeof require,!x&&!C&&"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"],x?Components.utils:null),A=x?Components.classes:null,q=x?Components.interfaces:null;x&&(I["import"]("resource://gre/modules/NetUtil.jsm"),I["import"]("resource://gre/modules/osfile.jsm"));var w,R=x?this:C?global:k?this:window,N=C?require("fs"):null,B=x?function(e,t,n){return I["import"](t,n),n[e]}:C?function(e,t){return require(t)}:k?function(e,t,n){return importScripts(t),n[e]}:j,O=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},E=/\/|\\/g,F="://",U="#PROTOCOL#",D=/[\-.\/\\:]+/g,P=x?function(){var e=A["@mozilla.org/file/directory_service;1"].getService(q.nsIProperties).get("ProfD",q.nsIFile);return e.append("abc"),e.append("abc"),e.path.substr(e.path.length-"abc".length-1,1)}():C?require("path").sep:"/",L=function(e){return A["@mozilla.org/network/io-service;1"].getService(q.nsIIOService).newURI(e,null,null).QueryInterface(q.nsIFileURL).file},M=x?function(e,t,n){var r,i,s,l;if(i=L(e),s=A["@mozilla.org/network/file-input-stream;1"].createInstance(q.nsIFileInputStream),"binary"===t){var a=A["@mozilla.org/binaryinputstream;1"].createInstance(q.nsIBinaryInputStream);s.init(i,-1,-1,!1),l=s.available(),a.setInputStream(s),a.readByteArray(l,r=new Uint8Array(l)),a.close()}else{var o=A["@mozilla.org/intl/converter-input-stream;1"].createInstance(q.nsIConverterInputStream),p={value:""},c=0;r=null,s.init(i,-1,0,0),o.init(s,t,0,0);do c=o.readString(4294967295,p),null===r&&(r=""),r+=p.value;while(0!=c);o.close(),null===r&&(r=null!=n?n:"")}return r}:C?function(e,t,n){var r=N.readFileSync(e,"binary"===t?{}:{encoding:t});return r?r:"binary"===t?null!=n?n:null:null!=n?n:""}:function(e,t,n){var r=O();return r.open("GET",e,!1),"binary"===t?k&&(r.responseType="arraybuffer"):(k&&(r.responseType="text"),r.setRequestHeader("Content-Type","text/plain; charset="+t),r.overrideMimeType("text/plain; charset="+t)),r.send(null),200===r.status?"binary"===t?r.response:r.responseText:"binary"===t?null!=n?n:null:null!=n?n:""},z=x?function(e,t,n,r){return NetUtil.asyncFetch(L(e),function(e,i){var s=null;if(Components.isSuccessCode(i))if("binary"===t){var l=A["@mozilla.org/binaryinputstream;1"].createInstance(q.nsIBinaryInputStream),a=e.available();l.setInputStream(e),l.readByteArray(a,s=new Uint8Array(a)),l.close()}else s=NetUtil.readInputStreamToString(e,e.available(),{charset:t});else s="binary"===t?null!=r?r:null:null!=r?r:"";n&&n(s)}),""}:C?function(e,t,n,r){return"binary"===t?N.readFile(e,function(e,t){n&&n(e?null!=r?r:null:t)}):N.readFile(e,{encoding:t},function(e,t){n&&n(e?null!=r?r:"":t)}),""}:function(e,t,n,r){var i=O();return i.open("GET",e,!0),"binary"===t?(i.responseType="arraybuffer",i.onload=function(){n&&n(200===i.status?i.response:null!=r?r:null)}):(i.responseType="text",i.setRequestHeader("Content-Type","text/plain; charset="+t),i.overrideMimeType("text/plain; charset="+t),i.onload=function(){n&&n(200===i.status?i.responseText:null!=r?r:"")}),i.send(null),""};return w=function H(e,t){var n=this;return n instanceof H?(n.base="",n.base_url="",n.base_path(e,t),n._classes={},n._assets={},n._hooks={},void(n._cache={})):new H(e,t)},w.VERSION="0.3.4",w.BASE="./",w.path_join=h,w.join_path=d,w[m]={constructor:w,base:null,base_url:null,_classes:null,_assets:null,_hooks:null,_cache:null,dispose:function(){var e=this;return e._classes=null,e._assets=null,e._hooks=null,e._cache=null,e.base=null,e.base_url=null,e},on:function(e,n,r){var s=this;return!i(e)&&t(n)&&(s._hooks[y](e)||(s._hooks[e]=[]),s._hooks[e].push([n,!0===r,0])),s},one:function(e,t){return this.on(e,t,!0)},off:function(e,t){var n,r,s=this;if(!i(e)&&!i(s._hooks[e]))if(!0===t)delete s._hooks[e];else if(t)for(n=s._hooks[e],r=n.length-1;r>=0;r--)t===n[r][0]&&n.splice(r,1);return s},trigger:function(e,t){var n,r,s,l,a=this;if(!i(e)&&!i(a._hooks[e])){for(n=a._hooks[e],t=t||[],r=0;r<n.length&&(s=n[r],s[1]&&s[2]||(s[2]=1,l=s[0].apply(null,t),!1!==l));r++);for(r=n.length-1;r>=0;r--)n[r][1]&&n[r][2]&&n.splice(r,1)}return a},base_path:function(e,t){var r=this;return n(e)&&e.length?r.base=e:!1===e&&(r.base=""),n(t)&&t.length?r.base_url=t:!1===t&&(r.base_url=""),r},get_path:function(e,t){return i(e)?t||"":!i(t)&&(S(e,"./")||S(e,"../")||S(e,".\\")||S(e,"..\\"))?d(t,e):e},path:function(e){var t=this;return t.get_path(e||"",C?t.base:t.base_url)},path_url:function(e){var t=this;return t.get_path(e||"",t.base_url)},register:function(e,t){var l,a,o,p,c,u,f,h,d,m=this,y=m._classes,g=m._assets;if(r(t)&&t.length)if(r(t[0])||(t=[t]),"classes"===e)for(l=0,a=t.length;a>l;l++)p=t[l],o=p[0],c=p[1],u=p[2],f=p[3]?p[3]:[],i(o)||i(c)||i(u)||(y[c]=[o,c,m.path(u),s(f),!1]);else if("assets"===e)for(l=0,a=t.length;a>l;l++)p=t[l],h=p[0],c=p[1],d=p[2],f=p[3]?p[3]:[],i(h)||i(c)||i(d)||(h=h[_](),"scripts-composite"===h||"styles-composite"===h?d=s(d):n(d)&&(d=m.path_url(d)),g[c]=[h,c,d,s(f),!1,!1]);return m},import_class:function(n,r){var s,l,a,o,p,c,u,f,h=this,d=h._classes,m="class-"+n,g=h._cache;if(g[y](m))t(r)&&r.call(h,g[m]);else{for(l=!1,f=[],s=[n];s.length;)if(n=s[0],d[y](n)&&!d[n][4])if(l=!0,R[y](d[n][0]))d[n][4]=!0,g["class-"+n]=R[d[n][0]];else{if(u=d[n][3],!i(u)){for(a=!1,o=u.length,p=o-1;p>=0;p--)c=u[p],d[y](c)&&!d[c][4]&&(a=!0,s.unshift(c));if(a)continue;s.shift()}d[n][4]=!0,f.push({id:n,type:"class",cache_id:"class-"+n,name:d[n][0],path:d[n][2]})}else d[y](n)?(l=!0,s.shift()):s.shift();l&&f.length?e(h,R,g,f,function(){var e,n,i=arguments;for(e=0,n=i.length;n>e;e++)g[f[e].cache_id]=i[e];t(r)&&r.call(h,g[m])}):t(r)&&r.call(h,null)}return h},import_asset:function(e){for(var t,n,i,s,a,o,p,u,f,h,d,m,_,v,b,S,j,x,C=this,k=[e],I=C._assets,A=[];k.length;)if(e=k[0],I[y](e)&&I[e][4]&&!I[e][5]){if(o=I[e],p=o[0],e=o[1],u=o[2],t=o[3],t&&t.length){for(n=!1,i=t.length,s=i-1;s>=0;s--)a=t[s],I[y](a)&&!I[a][5]&&(I[a][4]=!0,n=!0,k.unshift(a));if(n)continue;k.shift()}if(o[5]=!0,x={},C.trigger("import-asset",[C,e,p,u,x]).trigger("import-asset-"+e,[C,e,p,u,x]),null!=x["return"])A.push(x["return"]);else if(h="styles"===p||"styles-composite"===p,d="scripts"===p||"scripts-composite"===p,m="templates"===p,_="scripts-composite"===p||"styles-composite"===p,v=!_&&r(u),f=e.replace(D,"_"),h)if(T)if(v)A.push(j=l("importer-inline-style-"+f)||c("style",u[0])),j[g]("id","importer-inline-style-"+f);else if(_)for(b=0,S=u.length;S>b;b++)r(u[b])?(A.push(j=l("importer-inline-style-"+f+"-part-"+b)||c("style",u[b][0])),j[g]("id","importer-inline-style-"+f+"-part-"+b)):(A.push(j=l("importer-style-"+f+"-part-"+b)||c("style-link",C.path_url(u[b]),!0)),j[g]("id","importer-style-"+f+"-part-"+b));else A.push(j=l("importer-style-"+f)||c("style-link",C.path_url(u),!0)),j[g]("id","importer-style-"+f);else if(v)A.push('<style id="importer-inline-style-'+f+'" type="text/css" media="all">'+u[0]+"</style>");else if(_)for(b=0,S=u.length;S>b;b++)A.push(r(u[b])?'<style id="importer-inline-style-'+f+"-part-"+b+'" type="text/css" media="all">'+u[b][0]+"</style>":'<link id="importer-style-'+f+"-part-"+b+'" type="text/css" rel="stylesheet" href="'+C.path_url(u[b])+'" media="all" />');else A.push('<link id="importer-style-'+f+'" type="text/css" rel="stylesheet" href="'+C.path_url(u)+'" media="all" />');else if(d)if(T)if(v)A.push(j=l("importer-inline-script-"+f)||c("script","/*<![CDATA[*/ "+u[0]+" /*]]>*/")),j[g]("id","importer-inline-script-"+f);else if(_)for(b=0,S=u.length;S>b;b++)r(u[b])?(A.push(j=l("importer-inline-script-"+f+"-part-"+b)||c("script","/*<![CDATA[*/ "+u[b][0]+" /*]]>*/")),j[g]("id","importer-inline-script-"+f+"-part-"+b)):(A.push(j=l("importer-script-"+f+"-part-"+b)||c("script-link",C.path_url(u[b]),!0)),j[g]("id","importer-script-"+f+"-part-"+b));else A.push(j=l("importer-script-"+f)||c("script-link",C.path_url(u),!0)),j[g]("id","importer-script-"+f);else if(v)A.push('<script id="importer-inline-script-'+f+'" type="text/javascript">/*<![CDATA[*/ '+u[0]+" /*]]>*/</script>");else if(_)for(b=0,S=u.length;S>b;b++)A.push(r(u[b])?'<script id="importer-inline-script-'+f+"-part-"+b+'" type="text/javascript">/*<![CDATA[*/ '+u[b][0]+" /*]]>*/</script>":'<script id="importer-script-'+f+"-part-"+b+'" type="text/javascript" src="'+C.path_url(u[b])+'"></script>');else A.push('<script id="importer-script-'+f+'" type="text/javascript" src="'+C.path_url(u)+'"></script>');else m?T?(A.push(j=v?l("importer-inline-tpl-"+f)||c("tpl",u[0]):l("importer-inline-tpl-"+f)||c("tpl",C.get(u))),j[g]("id",v?"importer-inline-tpl-"+f:"importer-inline-tpl-"+f)):A.push(v?'<script id="importer-inline-tpl-'+f+'" type="text/x-tpl">'+u[0]+"</script>":'<script id="importer-inline-tpl-'+f+'" type="text/x-tpl">'+C.get(u)+"</script>"):A.push(v?u[0]:C.get(u))}else k.shift();return A},assets:function(e){var t,n,r,i,s,l,a=this,o=a._assets,p=[];arguments.length||(e="scripts"),e=e[_](),l=e+"-composite";for(n in o)o[y](n)&&(r=o[n],e!==r[0]&&l!==r[0]||!r[4]||r[5]||p.push(r[1]));if(T){for(i=0,s=p.length;s>i;i++)a.import_asset(p[i]);t=""}else{for(t=[],i=0,s=p.length;s>i;i++)t=t.concat(a.import_asset(p[i]));t=t.join("\n")}return t},enqueue:function(e,t,n,r){var s=this,l=s._assets;return i(e)||i(t)||(l[y](t)?(l[t][4]=!0,s.trigger("enqueue-asset",[s,t,e,l[t][2]]).trigger("enqueue-asset-"+t,[s,t,e,l[t][2]])):i(n)||(s.register("assets",[e,t,n,r]),l[t][4]=!0,s.trigger("enqueue-asset",[s,t,e,l[t][2]]).trigger("enqueue-asset-"+t,[s,t,e,l[t][2]]))),s},get:function(e,n,r){var s,l,a,o=this;return n=n||{},a=n[y]("default")?n["default"]:"",s=n.encoding||(x?"UTF-8":"utf8"),i(n.binary)||(s="binary"),r=r||n.complete||t(n)&&n,T?(l=o.path(e),z(l,s,function(e){t(r)&&r(e)},a)):(l=o.path(e),t(r)?z(l,s,r,a):M(l,s,a))},load:function(e,n,s,l){var a,o,p,c,u=this,f=arguments.length;return r(e)?(l=n,a=e.length,o=new Array(a),p=0,(c=function h(n){arguments.length&&(o[p]=n||null,p++),a>p?u.import_class(e[p],h):t(l)&&setTimeout(function(){l.apply(u,o)},10)})()):(4>f&&t(s)?(l=s,s=null):3>f&&t(n)&&(l=n,n=null,s=null),u._classes[y](e)||i(n)||u.register("classes",[e,e,u.path(n),s]),u._classes[y](e)&&!u._classes[e][4]?u.import_class(e,l):t(l)&&l.call(u,u._cache["class-"+e]||null)),u}},w.BASE=x?"./":C?__dirname:k?this.location.href.split("/").slice(0,-1).join("/"):(o("script",-1).src||"./").split("/").slice(0,-1).join("/"),w});
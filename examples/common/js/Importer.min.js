/**
*  Importer
*  a simple loader manager for classes and assets with dependencies for PHP, Python, Node/XPCOM/JS
*
*  @version 0.3.5
*  https://github.com/foo123/Importer
**/
!function(e,t,n){"use strict";var r;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[t])&&(e[t]=n.call(e)):"object"==typeof module&&module.exports?module.exports=n.call(e):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(t,[],function(r){r(t,n.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e)}):t in e||(e[t]=r=n.call(e))&&"function"==typeof define&&define.amd&&define(function(){return r})}(this,"Importer",function(){"use strict";function e(e,t,n,r,i){var s,l,a,c,h,d,m=r.length,y=new Array(m);if(x||I||A){for(s=0;m>s;s++)n[_](r[s].cache_id)?y[s]=n[r[s].cache_id]:"class"!==r[s].type?y[s]=n[r[s].cache_id]=X(r[s].path,x?"UTF-8":"utf8"):r[s].name in t?y[s]=t[r[s].name]:(y[s]=F(r[s].name,r[s].path,t)||null,e.trigger("import-class",[e,r[s].id,r[s].name,r[s].path,y[s]]).trigger("import-class-"+r[s].id,[e,r[s].id,r[s].name,r[s].path,y[s]]));return i.apply(t,y)}c=u("head",0),l=0,s=0,h=function(e,t,r,i){var s,l;"style"===t||"script"===t?(l=o(e))&&t===l.tagName[b]()?i():W(r,"utf8",function(r){n[e]=r,f(t,r)[v]("id",e),i()}):"class"!==t?"template"===t&&(l=o(e))&&"script"===l.tagName[b]()?i():W(r,"utf8",function(r){n[e]=r,"template"!==t||o(e)||f("tpl",r)[v]("id",e),i()}):(l=o(e))&&"script"===l.tagName[b]()?i():(s=0,l=p("script"),l[v]("id",e),l[v]("type","text/javascript"),l[v]("language","javascript"),l.onload=l.onreadystatechange=function(){s||l.readyState&&"loaded"!=l.readyState&&"complete"!=l.readyState||(s=1,l.onload=l.onreadystatechange=null),i()},l[v]("src",r),c.appendChild(l))},d=function g(){var a;(a=n[_](r[s].cache_id))||r[s].name in t?(y[s]=(a?n[r[s].cache_id]:t[r[s].name])||null,e.trigger("import-class",[e,r[s].id,r[s].name,r[s].path,y[s]]).trigger("import-class-"+r[s].id,[e,r[s].id,r[s].name,r[s].path,y[s]]),++s>=m?i.apply(t,y):(a=n[_](r[s].cache_id))||r[s].name in t?(y[s]=(a?n[r[s].cache_id]:t[r[s].name])||null,g()):(t[r[s].name]=null,h(r[s].cache_id,r[s].type,r[s].path,g))):++l<4?setTimeout(g,20):(l=0,t[r[s].name]=null,e.trigger("import-class",[e,r[s].id,r[s].name,r[s].path,null]).trigger("import-class-"+r[s].id,[e,r[s].id,r[s].name,r[s].path,null]),s++,g())};for(;m>s&&((a=n[_](r[s].cache_id))||r[s].name in t);)y[s]=(a?n[r[s].cache_id]:t[r[s].name])||null,s++;m>s?h(r[s].cache_id,r[s].type,r[s].path,d):i.apply(t,y)}function t(e){return"function"==typeof e}function n(e){return e instanceof String||"[object String]"===S.call(e)}function r(e){return e instanceof Array||"[object Array]"===S.call(e)}function i(e){if(!e)return!0;var t=S.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===t||"[object String]"===t)&&!e.length}function s(e){return r(e)?e:[e]}function l(e,t){var n,r,i=C(t);for(n=0,r=i.length;r>n;n++)e[i[n]]=t[i[n]];return e}function a(e,t){if(!e)return t?t:"";var n,r,i=C(e);if(t){for(n=0,r=i.length;r>n;n++)t[v](i[n],e[i[n]]);return t}var s=[];for(n=0,r=i.length;r>n;n++)s.push(i[n]+'="'+e[i[n]]+'"');return s.join(" ")}function o(e){return document.getElementById(e)}function p(e){return document.createElement(e)}function u(e,t){var n=document.getElementsByTagName(e);return arguments.length>1?0>t?n[n.length+t]:n[t]:n}function c(e,t){var n,r,i,s,l,a=typeof t;if("object"===a){r=0;for(n in t)t[_](n)&&(i=t[n],s=i.selector,l=[].concat(i.rules).join("; "),"insertRule"in e.sheet?(e.sheet.insertRule(s+"{"+l+"}",r),i.css=e.sheet.cssRules[r]):"addRule"in e.sheet&&(e.sheet.addRule(s,l,r),i.css=e.sheet.rules[r]),r++)}else"string"===a&&(e.styleSheet?e.styleSheet.cssText=(e.styleSheet.cssText||"")+t:e.appendChild(document.createTextNode(t)));return t}function f(e,t,n,r){var i,s,l=null,o=null;switch(e){case"tpl-link":case"tpl":l=p("script"),r?a(r,l):l[v]("type","text/x-tpl"),l.appendChild(document.createTextNode(t)),document.head.appendChild(l);break;case"script-link":if(n)for(s=u("script"),i=s.length-1;i>=0;i--)if(s[i].src&&t===s[i].src){o=s[i];break}o?l=o:(l=p("script"),r?a(r,l):(l[v]("type","text/javascript"),l[v]("language","javascript")),l[v]("src",t),document.head.appendChild(l));break;case"script":l=p("script"),r?a(r,l):(l[v]("type","text/javascript"),l[v]("language","javascript")),l.appendChild(document.createTextNode(t)),document.head.appendChild(l);break;case"style-link":if(n)for(s=u("link"),i=s.length-1;i>=0;i--)if(t===s[i].href){o=s[i];break}o?l=o:(l=p("link"),l[v]("rel","stylesheet"),r?a(r,l):(l[v]("type","text/css"),l[v]("media","all")),l[v]("href",t),document.head.appendChild(l));break;case"style":default:l=p("style"),r?a(r,l):(l[v]("type","text/css"),l[v]("media","all")),l.appendChild(document.createTextNode("")),document.head.appendChild(l),t&&c(l,t)}return l}function h(e){return e.split(P).join(L)}function d(e){return e.split(L).join(P)}function m(){var e,t=arguments,n=".";return t.length?(x?n=OS.Path.join.apply(OS.Path,t):I?(e=require("path"),n=e.join.apply(e,t)):n=y.apply(null,t),n):n}function y(){var e,t,n,r,i,s,l,a,o,p=arguments,u=p.length,c=z;if(!u)return".";if(e=j.call(p,h).join(c),t=e.length,!t)return".";for(n=e.charAt(0),r=e.charAt(t-1),i=e.split(D).filter(Boolean),s=[],l=0,a=i.length-1;a>=0;)o=i[a],".."===o?l++:"."!==o&&(l?l--:s.push(i[a])),a--;return e=s.reverse().join(c),e||n||(e="."),e&&r===c&&(e+=c),(n===c?c:"")+d(e)}var g="prototype",_="hasOwnProperty",v="setAttribute",b="toLowerCase",S=Object[g].toString,j=Array[g].map,C=Object.keys,k=String[g].startsWith?function(e,t,n){return e.startsWith(t,n||0)}:function(e,t,n){return n=n||0,t===e.substr(n,t.length+n)},T=function(){},x="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"],I=!x&&"undefined"!=typeof global&&"[object global]"===S.call(global),A=!x&&!I&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,q=!x&&!I&&!A&&"undefined"!=typeof navigator,w=("function"==typeof define&&define.amd&&"function"==typeof require,!x&&!I&&"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"],x?Components.utils:null),R=x?Components.classes:null,N=x?Components.interfaces:null;x&&(w["import"]("resource://gre/modules/NetUtil.jsm"),w["import"]("resource://gre/modules/osfile.jsm"));var O,B=x?this:I?global:A?this:window,E=I?require("fs"):null,F=x?function(e,t,n){return w["import"](t,n),n[e]}:I?function(e,t){return require(t)}:A?function(e,t,n){return importScripts(t),n[e]}:T,U=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},D=/\/|\\/g,P="://",L="#PROTOCOL#",M=/[\-.\/\\:]+/g,z=x?function(){var e=R["@mozilla.org/file/directory_service;1"].getService(N.nsIProperties).get("ProfD",N.nsIFile);return e.append("abc"),e.append("abc"),e.path.substr(e.path.length-"abc".length-1,1)}():I?require("path").sep:"/",H=function(e){return R["@mozilla.org/network/io-service;1"].getService(N.nsIIOService).newURI(e,null,null).QueryInterface(N.nsIFileURL).file},X=x?function(e,t,n){var r,i,s,l;if(i=H(e),s=R["@mozilla.org/network/file-input-stream;1"].createInstance(N.nsIFileInputStream),"binary"===t){var a=R["@mozilla.org/binaryinputstream;1"].createInstance(N.nsIBinaryInputStream);s.init(i,-1,-1,!1),l=s.available(),a.setInputStream(s),a.readByteArray(l,r=new Uint8Array(l)),a.close()}else{var o=R["@mozilla.org/intl/converter-input-stream;1"].createInstance(N.nsIConverterInputStream),p={value:""},u=0;r=null,s.init(i,-1,0,0),o.init(s,t,0,0);do u=o.readString(4294967295,p),null===r&&(r=""),r+=p.value;while(0!=u);o.close(),null===r&&(r=null!=n?n:"")}return r}:I?function(e,t,n){var r=E.readFileSync(e,"binary"===t?{}:{encoding:t});return r?r:"binary"===t?null!=n?n:null:null!=n?n:""}:function(e,t,n){var r=U();return r.open("GET",e,!1),"binary"===t?A&&(r.responseType="arraybuffer"):(A&&(r.responseType="text"),r.setRequestHeader("Content-Type","text/plain; charset="+t),r.overrideMimeType("text/plain; charset="+t)),r.send(null),200===r.status?"binary"===t?r.response:r.responseText:"binary"===t?null!=n?n:null:null!=n?n:""},W=x?function(e,t,n,r){return NetUtil.asyncFetch(H(e),function(e,i){var s=null;if(Components.isSuccessCode(i))if("binary"===t){var l=R["@mozilla.org/binaryinputstream;1"].createInstance(N.nsIBinaryInputStream),a=e.available();l.setInputStream(e),l.readByteArray(a,s=new Uint8Array(a)),l.close()}else s=NetUtil.readInputStreamToString(e,e.available(),{charset:t});else s="binary"===t?null!=r?r:null:null!=r?r:"";n&&n(s)}),""}:I?function(e,t,n,r){return"binary"===t?E.readFile(e,function(e,t){n&&n(e?null!=r?r:null:t)}):E.readFile(e,{encoding:t},function(e,t){n&&n(e?null!=r?r:"":t)}),""}:function(e,t,n,r){var i=U();return i.open("GET",e,!0),"binary"===t?(i.responseType="arraybuffer",i.onload=function(){n&&n(200===i.status?i.response:null!=r?r:null)}):(i.responseType="text",i.setRequestHeader("Content-Type","text/plain; charset="+t),i.overrideMimeType("text/plain; charset="+t),i.onload=function(){n&&n(200===i.status?i.responseText:null!=r?r:"")}),i.send(null),""};return O=function G(e,t){var n=this;return n instanceof G?(n.base="",n.base_url="",n.base_path(e,t),n._classes={},n._assets={},n._hooks={},void(n._cache={})):new G(e,t)},O.VERSION="0.3.5",O.BASE="./",O.path_join=m,O.join_path=y,O.attributes=a,O[g]={constructor:O,base:null,base_url:null,_classes:null,_assets:null,_hooks:null,_cache:null,dispose:function(){var e=this;return e._classes=null,e._assets=null,e._hooks=null,e._cache=null,e.base=null,e.base_url=null,e},on:function(e,n,r){var s=this;return!i(e)&&t(n)&&(s._hooks[_](e)||(s._hooks[e]=[]),s._hooks[e].push([n,!0===r,0])),s},one:function(e,t){return this.on(e,t,!0)},off:function(e,t){var n,r,s=this;if(!i(e)&&!i(s._hooks[e]))if(!0===t)delete s._hooks[e];else if(t)for(n=s._hooks[e],r=n.length-1;r>=0;r--)t===n[r][0]&&n.splice(r,1);return s},trigger:function(e,t){var n,r,s,l,a=this;if(!i(e)&&!i(a._hooks[e])){for(n=a._hooks[e],t=t||[],r=0;r<n.length&&(s=n[r],s[1]&&s[2]||(s[2]=1,l=s[0].apply(null,t),!1!==l));r++);for(r=n.length-1;r>=0;r--)n[r][1]&&n[r][2]&&n.splice(r,1)}return a},base_path:function(e,t){var r=this;return n(e)&&e.length?r.base=e:!1===e&&(r.base=""),n(t)&&t.length?r.base_url=t:!1===t&&(r.base_url=""),r},get_path:function(e,t){return i(e)?t||"":!i(t)&&(k(e,"./")||k(e,"../")||k(e,".\\")||k(e,"..\\"))?y(t,e):e},path:function(e){var t=this;return t.get_path(e||"",I?t.base:t.base_url)},path_url:function(e){var t=this;return t.get_path(e||"",t.base_url)},register:function(e,t){var l,a,o,p,u,c,f,h,d,m,y=this,g=y._classes,_=y._assets;if(r(t)&&t.length)if(r(t[0])||(t=[t]),"classes"===e)for(l=0,a=t.length;a>l;l++)p=t[l],o=p[0],u=p[1],c=p[2],f=p[3]?p[3]:[],i(o)||i(u)||i(c)||(g[u]=[o,u,y.path(c),s(f),!1]);else if("assets"===e)for(l=0,a=t.length;a>l;l++)p=t[l],d=p[0],u=p[1],m=p[2],f=p[3]?p[3]:[],h=p[4]?p[4]:{},i(d)||i(u)||i(m)||(d=d[b](),"scripts-composite"===d||"styles-composite"===d?m=s(m):n(m)&&(m=y.path_url(m)),_[u]=[d,u,m,s(f),h,!1,!1]);return y},import_class:function(n,r){var s,l,a,o,p,u,c,f,h=this,d=h._classes,m="class-"+n,y=h._cache;if(y[_](m))t(r)&&r.call(h,y[m]);else{for(l=!1,f=[],s=[n];s.length;)if(n=s[0],d[_](n)&&!d[n][4])if(l=!0,B[_](d[n][0]))d[n][4]=!0,y["class-"+n]=B[d[n][0]];else{if(c=d[n][3],!i(c)){for(a=!1,o=c.length,p=o-1;p>=0;p--)u=c[p],d[_](u)&&!d[u][4]&&(a=!0,s.unshift(u));if(a)continue;s.shift()}d[n][4]=!0,f.push({id:n,type:"class",cache_id:"class-"+n,name:d[n][0],path:d[n][2]})}else d[_](n)?(l=!0,s.shift()):s.shift();l&&f.length?e(h,B,y,f,function(){var e,n,i=arguments;for(e=0,n=i.length;n>e;e++)y[f[e].cache_id]=i[e];t(r)&&r.call(h,y[m])}):t(r)&&r.call(h,null)}return h},import_asset:function(e){for(var t,n,i,s,p,u,c,h,d,m,y,g,b,S,j,C,k,T,x,I,A=this,w=[e],R=A._assets,N=[];w.length;)if(e=w[0],R[_](e)&&R[e][5]&&!R[e][6]){if(h=R[e],d=h[0],e=h[1],m=h[2],t=h[3],n=h[4],t&&t.length){for(s=!1,p=t.length,u=p-1;u>=0;u--)c=t[u],R[_](c)&&!R[c][6]&&(R[c][5]=!0,s=!0,w.unshift(c));if(s)continue;w.shift()}if(h[6]=!0,I={},A.trigger("import-asset",[A,e,d,m,I]).trigger("import-asset-"+e,[A,e,d,m,I]),null!=I["return"])N.push(I["return"]);else if(g="styles"===d||"styles-composite"===d,b="scripts"===d||"scripts-composite"===d,S="templates"===d,j="scripts-composite"===d||"styles-composite"===d,C=!j&&r(m),y=e.replace(M,"_"),g)if(i=l({type:"text/css",media:"all"},n),q)if(C)N.push(x=o("importer-inline-style-"+y)||f("style",m[0],!1,i)),x[v]("id","importer-inline-style-"+y);else if(j)for(k=0,T=m.length;T>k;k++)r(m[k])?(N.push(x=o("importer-inline-style-"+y+"-part-"+k)||f("style",m[k][0],!1,i)),x[v]("id","importer-inline-style-"+y+"-part-"+k)):(N.push(x=o("importer-style-"+y+"-part-"+k)||f("style-link",A.path_url(m[k]),!0,i)),x[v]("id","importer-style-"+y+"-part-"+k));else N.push(x=o("importer-style-"+y)||f("style-link",A.path_url(m),!0,i)),x[v]("id","importer-style-"+y);else if(i=a(i),C)N.push('<style id="importer-inline-style-'+y+'" '+i+">"+m[0]+"</style>");else if(j)for(k=0,T=m.length;T>k;k++)N.push(r(m[k])?'<style id="importer-inline-style-'+y+"-part-"+k+'" '+i+">"+m[k][0]+"</style>":'<link id="importer-style-'+y+"-part-"+k+'" href="'+A.path_url(m[k])+'" rel="stylesheet" '+i+" />");else N.push('<link id="importer-style-'+y+'" href="'+A.path_url(m)+'" rel="stylesheet" '+i+" />");else if(b)if(i=l({type:"text/javascript"},n),q)if(C)N.push(x=o("importer-inline-script-"+y)||f("script","/*<![CDATA[*/ "+m[0]+" /*]]>*/",!1,i)),x[v]("id","importer-inline-script-"+y);else if(j)for(k=0,T=m.length;T>k;k++)r(m[k])?(N.push(x=o("importer-inline-script-"+y+"-part-"+k)||f("script","/*<![CDATA[*/ "+m[k][0]+" /*]]>*/",!1,i)),x[v]("id","importer-inline-script-"+y+"-part-"+k)):(N.push(x=o("importer-script-"+y+"-part-"+k)||f("script-link",A.path_url(m[k]),!0,i)),x[v]("id","importer-script-"+y+"-part-"+k));else N.push(x=o("importer-script-"+y)||f("script-link",A.path_url(m),!0,i)),x[v]("id","importer-script-"+y);else if(i=a(i),C)N.push('<script id="importer-inline-script-'+y+'" '+i+">/*<![CDATA[*/ "+m[0]+" /*]]>*/</script>");else if(j)for(k=0,T=m.length;T>k;k++)N.push(r(m[k])?'<script id="importer-inline-script-'+y+"-part-"+k+'" '+i+">/*<![CDATA[*/ "+m[k][0]+" /*]]>*/</script>":'<script id="importer-script-'+y+"-part-"+k+'" src="'+A.path_url(m[k])+'" '+i+"></script>");else N.push('<script id="importer-script-'+y+'" src="'+A.path_url(m)+'" '+i+"></script>");else S?(i=l({type:"text/x-tpl"},n),q?(N.push(x=C?o("importer-inline-tpl-"+y)||f("tpl",m[0],!1,i):o("importer-inline-tpl-"+y)||f("tpl",A.get(m),!1,i)),x[v]("id",C?"importer-inline-tpl-"+y:"importer-inline-tpl-"+y)):(i=a(i),N.push(C?'<script id="importer-inline-tpl-'+y+'" '+i+">"+m[0]+"</script>":'<script id="importer-inline-tpl-'+y+'" '+i+">"+A.get(m)+"</script>"))):N.push(C?m[0]:A.get(m))}else w.shift();return N},assets:function(e){var t,n,r,i,s,l,a=this,o=a._assets,p=[];arguments.length||(e="scripts"),e=e[b](),l=e+"-composite";for(n in o)o[_](n)&&(r=o[n],e!==r[0]&&l!==r[0]||!r[5]||r[6]||p.push(r[1]));if(q){for(i=0,s=p.length;s>i;i++)a.import_asset(p[i]);t=""}else{for(t=[],i=0,s=p.length;s>i;i++)t=t.concat(a.import_asset(p[i]));t=t.join("\n")}return t},enqueue:function(e,t,n,r,s){var l=this,a=l._assets;return i(e)||i(t)||(a[_](t)?(a[t][5]=!0,l.trigger("enqueue-asset",[l,t,e,a[t][2]]).trigger("enqueue-asset-"+t,[l,t,e,a[t][2]])):i(n)||(l.register("assets",[e,t,n,r,s]),a[t][5]=!0,l.trigger("enqueue-asset",[l,t,e,a[t][2]]).trigger("enqueue-asset-"+t,[l,t,e,a[t][2]]))),l},get:function(e,n,r){var s,l,a,o=this;return n=n||{},a=n[_]("default")?n["default"]:"",s=n.encoding||(x?"UTF-8":"utf8"),i(n.binary)||(s="binary"),r=r||n.complete||t(n)&&n,q?(l=o.path(e),W(l,s,function(e){t(r)&&r(e)},a)):(l=o.path(e),t(r)?W(l,s,r,a):X(l,s,a))},load:function(e,n,s,l){var a,o,p,u,c=this,f=arguments.length;return r(e)?(l=n,a=e.length,o=new Array(a),p=0,(u=function h(n){arguments.length&&(o[p]=n||null,p++),a>p?c.import_class(e[p],h):t(l)&&setTimeout(function(){l.apply(c,o)},10)})()):(4>f&&t(s)?(l=s,s=null):3>f&&t(n)&&(l=n,n=null,s=null),c._classes[_](e)||i(n)||c.register("classes",[e,e,c.path(n),s]),c._classes[_](e)&&!c._classes[e][4]?c.import_class(e,l):t(l)&&l.call(c,c._cache["class-"+e]||null)),c}},O.BASE=x?"./":I?__dirname:A?this.location.href.split("/").slice(0,-1).join("/"):(u("script",-1).src||"./").split("/").slice(0,-1).join("/"),O});
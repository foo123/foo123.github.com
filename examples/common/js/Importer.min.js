/**
*  Importer
*  a simple loader manager for classes and assets with dependencies for PHP, Python, Node/JS
*
*  @version 0.3.0
*  https://github.com/foo123/Importer
**/
!function(e,t,n){"use strict";var r,i="object"==typeof module&&module.exports,s="function"==typeof define&&define.amd;i?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||n.call(e,{NODE:module})||1:s&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,r,i){return n.call(e,{AMD:i})}):t in e||(e[t]=r=n.call(e,{})||1)&&s&&define(t,[],function(){return r})}(this,"Importer",function(){"use strict";function e(e){return"function"==typeof e}function t(e){return e instanceof String||"[object String]"===b.call(e)}function n(e){return e instanceof Array||"[object Array]"===b.call(e)}function r(e){if(!e)return!0;var t=b.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===t||"[object String]"===t)&&!e.length}function i(e){return n(e)?e:[e]}function s(e){return document.getElementById(e)}function a(e){return document.createElement(e)}function l(e,t){var n=document.getElementsByTagName(e);return arguments.length>1?0>t?n[n.length+t]:n[t]:n}function c(e,t){var n,r,i,s,a,l=typeof t;if("object"===l){r=0;for(n in t)t[m](n)&&(i=t[n],s=i.selector,a=[].concat(i.rules).join("; "),"insertRule"in e.sheet?(e.sheet.insertRule(s+"{"+a+"}",r),i.css=e.sheet.cssRules[r]):"addRule"in e.sheet&&(e.sheet.addRule(s,a,r),i.css=e.sheet.rules[r]),r++)}else"string"===l&&(e.styleSheet?e.styleSheet.cssText=(e.styleSheet.cssText||"")+t:e.appendChild(document.createTextNode(t)));return t}function o(e,t,n){var r,i,s=null,o=null;switch(e){case"tpl-link":case"tpl":s=a("script"),s[y]("type","text/x-tpl"),s.appendChild(document.createTextNode(t)),document.head.appendChild(s);break;case"script-link":if(n)for(i=l("script"),r=i.length-1;r>=0;r--)if(i[r].src&&t===i[r].src){o=i[r];break}o?s=o:(s=a("script"),s[y]("type","text/javascript"),s[y]("language","javascript"),s[y]("src",t),document.head.appendChild(s));break;case"script":s=a("script"),s[y]("type","text/javascript"),s[y]("language","javascript"),s.appendChild(document.createTextNode(t)),document.head.appendChild(s);break;case"style-link":if(n)for(i=l("link"),r=i.length-1;r>=0;r--)if(t===i[r].href){o=i[r];break}o?s=o:(s=a("link"),s[y]("type","text/css"),s[y]("rel","stylesheet"),s[y]("media","all"),s[y]("href",t),document.head.appendChild(s));break;case"style":default:s=a("style"),s[y]("type","text/css"),s[y]("media","all"),s.appendChild(document.createTextNode("")),document.head.appendChild(s),t&&c(s,t)}return s}function u(e,t,n,r,i){var c,u,p,h,f,d,g=r.length,b=new Array(g);if(x){for(c=0;g>c;c++)n[m](r[c].cache_id)?b[c]=n[r[c].cache_id]:"class"!==r[c].type?b[c]=n[r[c].cache_id]=M(r[c].path,"utf8"):r[c].name in t?b[c]=t[r[c].name]:(b[c]=require(r[c].path)||null,e.trigger("import-class",[e,r[c].id,r[c].name,r[c].path,b[c]]).trigger("import-class-"+r[c].id,[e,r[c].id,r[c].name,r[c].path,b[c]]));return i.apply(t,b)}if(T){for(c=0;g>c;c++)n[m](r[c].cache_id)?b[c]=n[r[c].cache_id]:"class"!==r[c].type?b[c]=n[r[c].cache_id]=M(r[c].path,"utf8"):r[c].name in t?b[c]=t[r[c].name]:(importScripts(r[c].path),b[c]=t[r[c].name]||null,e.trigger("import-class",[e,r[c].id,r[c].name,r[c].path,b[c]]).trigger("import-class-"+r[c].id,[e,r[c].id,r[c].name,r[c].path,b[c]]));return i.apply(t,b)}h=l("head",0),u=0,c=0,f=function(e,t,r,i){var l,c;"style"===t||"script"===t?(c=s(e))&&t===c.tagName[_]()?i():N(r,"utf8",function(r){n[e]=r,o(t,r)[y]("id",e),i()}):"class"!==t?"template"===t&&(c=s(e))&&"script"===c.tagName[_]()?i():N(r,"utf8",function(r){n[e]=r,"template"!==t||s(e)||o("tpl",r)[y]("id",e),i()}):(c=s(e))&&"script"===c.tagName[_]()?i():(l=0,c=a("script"),c[y]("id",e),c[y]("type","text/javascript"),c[y]("language","javascript"),c.onload=c.onreadystatechange=function(){l||c.readyState&&"loaded"!=c.readyState&&"complete"!=c.readyState||(l=1,c.onload=c.onreadystatechange=null),i()},c[y]("src",r),h.appendChild(c))},d=function v(){var s;(s=n[m](r[c].cache_id))||r[c].name in t?(b[c]=(s?n[r[c].cache_id]:t[r[c].name])||null,e.trigger("import-class",[e,r[c].id,r[c].name,r[c].path,b[c]]).trigger("import-class-"+r[c].id,[e,r[c].id,r[c].name,r[c].path,b[c]]),++c>=g?i.apply(t,b):(s=n[m](r[c].cache_id))||r[c].name in t?(b[c]=(s?n[r[c].cache_id]:t[r[c].name])||null,v()):(t[r[c].name]=null,f(r[c].cache_id,r[c].type,r[c].path,v))):++u<4?setTimeout(v,20):(u=0,t[r[c].name]=null,e.trigger("import-class",[e,r[c].id,r[c].name,r[c].path,null]).trigger("import-class-"+r[c].id,[e,r[c].id,r[c].name,r[c].path,null]),c++,v())};for(;g>c&&((p=n[m](r[c].cache_id))||r[c].name in t);)b[c]=(p?n[r[c].cache_id]:t[r[c].name])||null,c++;g>c?f(r[c].cache_id,r[c].type,r[c].path,d):i.apply(t,b)}function p(e){return e.split(q).join(w)}function h(e){return e.split(w).join(q)}function f(){var e,t,n,r,i,s,a,l,c,o=arguments,u=o.length,f=S;if(!u)return".";if(e=v.call(o,p).join(f),t=e.length,!t)return".";for(n=e.charAt(0),r=e.charAt(t-1),i=e.split(A).filter(Boolean),s=[],a=0,l=i.length-1;l>=0;)c=i[l],".."===c?a++:"."!==c&&(a?a--:s.push(i[l])),l--;return e=s.reverse().join(f),e||n||(e="."),e&&r===f&&(e+=f),(n===f?f:"")+h(e)}var d,g="prototype",m="hasOwnProperty",y="setAttribute",_="toLowerCase",b=Object[g].toString,v=Array[g].map,x="undefined"!=typeof global&&"[object global]"===b.call(global),T=!x&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,j=!x&&!T&&"undefined"!=typeof navigator,k=x?global:T?this:window,S="/",A=/\/|\\/g,q="://",w="#PROTOCOL#",C=/[\-.\/\\:]+/g,R=String[g].startsWith?function(e,t,n){return e.startsWith(t,n||0)}:function(e,t,n){return n=n||0,t===e.substr(n,t.length+n)},M=x?function(e,t){var n=require("fs");return"binary"===t?n.readFileSync(e):n.readFileSync(e,{encoding:t})}:function(e,t){var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return n.open("GET",e,!1),"binary"===t?T&&(n.responseType="arraybuffer"):(T&&(n.responseType="text"),n.setRequestHeader("Content-Type","text/plain; charset="+t),n.overrideMimeType("text/plain; charset="+t)),n.send(null),200===n.status?"binary"===t?n.response:n.responseText:"binary"===t?null:""},N=x?function(e,t,n){var r=require("fs");return"binary"===t?r.readFile(e,function(e,t){n&&n(e?null:t)}):r.readFile(e,{encoding:t},function(e,t){n&&n(e?"":t)}),""}:function(e,t,n){var r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return r.open("GET",e,!0),"binary"===t?(r.responseType="arraybuffer",r.onload=function(){n&&n(200===r.status?r.response:null)}):(r.responseType="text",r.setRequestHeader("Content-Type","text/plain; charset="+t),r.overrideMimeType("text/plain; charset="+t),r.onload=function(){n&&n(200===r.status?r.responseText:"")}),r.send(null),""};return d=function E(e,t){var n=this;return n instanceof E?(n.base="",n.base_url="",n.base_path(e,t),n._classes={},n._assets={},n._hooks={},void(n._cache={})):new E(e,t)},d.VERSION="0.3.0",d.BASE="./",d.join_path=f,d[g]={constructor:d,base:null,base_url:null,_classes:null,_assets:null,_hooks:null,_cache:null,dispose:function(){var e=this;return e._classes=null,e._assets=null,e._hooks=null,e._cache=null,e.base=null,e.base_url=null,e},on:function(t,n,i){var s=this;return!r(t)&&e(n)&&(s._hooks[m](t)||(s._hooks[t]=[]),s._hooks[t].push([n,!0===i,0])),s},one:function(e,t){return this.on(e,t,!0)},off:function(e,t){var n,i,s=this;if(!r(e)&&!r(s._hooks[e]))if(!0===t)delete s._hooks[e];else if(t)for(n=s._hooks[e],i=n.length-1;i>=0;i--)t===n[i][0]&&n.splice(i,1);return s},trigger:function(e,t){var n,i,s,a,l=this;if(!r(e)&&!r(l._hooks[e])){for(n=l._hooks[e],t=t||[],i=0;i<n.length&&(s=n[i],s[1]&&s[2]||(s[2]=1,a=s[0].apply(null,t),!1!==a));i++);for(i=n.length-1;i>=0;i--)n[i][1]&&n[i][2]&&n.splice(i,1)}return l},base_path:function(e,n){var r=this;return t(e)&&e.length?r.base=e:!1===e&&(r.base=""),t(n)&&n.length?r.base_url=n:!1===n&&(r.base_url=""),r},get_path:function(e,t){return r(e)?t||"":!r(t)&&(R(e,"./")||R(e,"../")||R(e,".\\")||R(e,"..\\"))?f(t,e):e},path:function(e){var t=this;return t.get_path(e||"",x?t.base:t.base_url)},path_url:function(e){var t=this;return t.get_path(e||"",t.base_url)},register:function(e,s){var a,l,c,o,u,p,h,f,d,g=this,m=g._classes,y=g._assets;if(n(s)&&s.length)if(n(s[0])||(s=[s]),"classes"===e)for(a=0,l=s.length;l>a;a++)o=s[a],c=o[0],u=o[1],p=o[2],h=o[3]?o[3]:[],r(c)||r(u)||r(p)||(m[u]=[c,u,g.path(p),i(h),!1]);else if("assets"===e)for(a=0,l=s.length;l>a;a++)o=s[a],f=o[0],u=o[1],d=o[2],h=o[3]?o[3]:[],r(f)||r(u)||r(d)||(y[u]=[f[_](),u,t(d)?g.path_url(d):d,i(h),!1,!1]);return g},import_class:function(t,n){var i,s,a,l,c,o,p,h,f=this,d=f._classes,g="class-"+t,y=f._cache;if(y[m](g))e(n)&&n.call(f,y[g]);else{for(s=!1,h=[],i=[t];i.length;)if(t=i[0],d[m](t)&&!d[t][4])if(s=!0,k[m](d[t][0]))d[t][4]=!0,y["class-"+t]=k[d[t][0]];else{if(p=d[t][3],!r(p)){for(a=!1,l=p.length,c=l-1;c>=0;c--)o=p[c],d[m](o)&&!d[o][4]&&(a=!0,i.unshift(o));if(a)continue;i.shift()}d[t][4]=!0,h.push({id:t,type:"class",cache_id:"class-"+t,name:d[t][0],path:d[t][2]})}else d[m](t)?(s=!0,i.shift()):i.shift();s&&h.length?u(f,k,y,h,function(){var t,r,i=arguments;for(t=0,r=i.length;r>t;t++)y[h[t].cache_id]=i[t];e(n)&&n.call(f,y[g])}):e(n)&&n.call(f,null)}return f},import_asset:function(e){for(var t,r,i,a,l,c,u,p,h,f,d,g,_,b,v,x=this,T=[e],k=x._assets,S=[];T.length;)if(e=T[0],k[m](e)&&k[e][4]&&!k[e][5]){if(c=k[e],u=c[0],e=c[1],p=c[2],t=c[3],t&&t.length){for(r=!1,i=t.length,a=i-1;a>=0;a--)l=t[a],k[m](l)&&!k[l][5]&&(k[l][4]=!0,r=!0,T.unshift(l));if(r)continue;T.shift()}c[5]=!0,v={},x.trigger("import-asset",[x,e,u,p,v]).trigger("import-asset-"+e,[x,e,u,p,v]),null!=v["return"]?S.push(v["return"]):(f="styles"===u,d="scripts"===u,g="templates"===u,_=n(p),h=e.replace(C,"_"),f?j?(S.push(b=_?s("importer-inline-style-"+h)||o("style",p[0]):s("importer-style-"+h)||o("style-link",x.path_url(p),!0)),b[y]("id",_?"importer-inline-style-"+h:"importer-style-"+h)):S.push(_?'<style id="importer-inline-style-'+h+'" type="text/css" media="all">'+p[0]+"</style>":'<link id="importer-style-'+h+'" type="text/css" rel="stylesheet" href="'+x.path_url(p)+'" media="all" />'):d?j?(S.push(b=_?s("importer-inline-script-"+h)||o("script","/*<![CDATA[*/ "+p[0]+" /*]]>*/"):s("importer-script-"+h)||o("script-link",x.path_url(p),!0)),b[y]("id",_?"importer-inline-script-"+h:"importer-script-"+h)):S.push(_?'<script id="importer-inline-script-'+h+'" type="text/javascript">/*<![CDATA[*/ '+p[0]+" /*]]>*/</script>":'<script id="importer-script-'+h+'" type="text/javascript" src="'+x.path_url(p)+'"></script>'):g?j?(S.push(b=_?s("importer-inline-tpl-"+h)||o("tpl",p[0]):s("importer-inline-tpl-"+h)||o("tpl",x.get(p))),b[y]("id",_?"importer-inline-tpl-"+h:"importer-inline-tpl-"+h)):S.push(_?'<script id="importer-inline-tpl-'+h+'" type="text/x-tpl">'+p[0]+"</script>":'<script id="importer-inline-tpl-'+h+'" type="text/x-tpl">'+x.get(p)+"</script>"):S.push(_?p[0]:x.get(p)))}else T.shift();return S},assets:function(e){var t,n,r,i,s,a=this,l=a._assets,c=[];arguments.length||(e="scripts"),e=e[_]();for(n in l)l[m](n)&&(r=l[n],e===r[0]&&r[4]&&!r[5]&&c.push(r[1]));if(j){for(i=0,s=c.length;s>i;i++)a.import_asset(c[i]);t=""}else{for(t=[],i=0,s=c.length;s>i;i++)t=t.concat(a.import_asset(c[i]));t=t.join("\n")}return t},enqueue:function(e,t,n,i){var s=this,a=s._assets;return r(e)||r(t)||(a[m](t)?(a[t][4]=!0,s.trigger("enqueue-asset",[s,t,e,a[t][2]]).trigger("enqueue-asset-"+t,[s,t,e,a[t][2]])):r(n)||(s.register("assets",[e,t,n,i]),a[t][4]=!0,s.trigger("enqueue-asset",[s,t,e,a[t][2]]).trigger("enqueue-asset-"+t,[s,t,e,a[t][2]]))),s},get:function(t,n,i){var s,a=this;return t=a.path(t),n=n||{},s=n.encoding||"utf8",r(n.binary)||(s="binary"),i=i||n.complete||e(n)&&n,j?N(t,s,function(t){e(i)&&i(t)}):e(i)?N(t,s,i):M(t,s)},load:function(t,i,s,a){var l,c,o,u,p=this,h=arguments.length;return n(t)?(a=i,l=t.length,c=new Array(l),o=0,(u=function f(n){arguments.length&&(c[o]=n||null,o++),l>o?p.import_class(t[o],f):e(a)&&setTimeout(function(){a.apply(p,c)},10)})()):(4>h&&e(s)?(a=s,s=null):3>h&&e(i)&&(a=i,i=null,s=null),p._classes[m](t)||r(i)||p.register("classes",[t,t,p.path(i),s]),p._classes[m](t)&&!p._classes[t][4]?p.import_class(t,a):e(a)&&a.call(p,p._cache["class-"+t]||null)),p}},d.BASE=x?__dirname:T?this.location.href.split("/").slice(0,-1).join("/"):(l("script",-1).src||"./").split("/").slice(0,-1).join("/"),d});
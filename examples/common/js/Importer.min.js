/**
*  Importer
*  a simple loader manager for classes and assets with dependencies for PHP, Python, Node/JS
*
*  @version 0.2.0
*  https://github.com/foo123/Importer
**/
!function(e,t,n){"use strict";var r,i="object"==typeof module&&module.exports,s="function"==typeof define&&define.amd;i?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||n.call(e,{NODE:module})||1:s&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,r,i){return n.call(e,{AMD:i})}):t in e||(e[t]=r=n.call(e,{})||1)&&s&&define(t,[],function(){return r})}(this,"Importer",function(){"use strict";function e(e){return"function"==typeof e}function t(e){return e instanceof String||"[object String]"===b.call(e)}function n(e){return e instanceof Array||"[object Array]"===b.call(e)}function r(e){if(!e)return!0;var t=b.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===t||"[object String]"===t)&&!e.length}function i(e){return n(e)?e:[e]}function s(e){return document.getElementById(e)}function a(e){return document.createElement(e)}function l(e,t){var n=document.getElementsByTagName(e);return arguments.length>1?0>t?n[n.length+t]:n[t]:n}function c(e,t){var n,r,i,s,a,l=typeof t;if("object"===l){r=0;for(n in t)t[g](n)&&(i=t[n],s=i.selector,a=[].concat(i.rules).join("; "),"insertRule"in e.sheet?(e.sheet.insertRule(s+"{"+a+"}",r),i.css=e.sheet.cssRules[r]):"addRule"in e.sheet&&(e.sheet.addRule(s,a,r),i.css=e.sheet.rules[r]),r++)}else"string"===l&&(e.styleSheet?e.styleSheet.cssText=(e.styleSheet.cssText||"")+t:e.appendChild(document.createTextNode(t)));return t}function u(e,t,n){var r,i,s=null,u=null;switch(e){case"tpl-link":case"tpl":s=a("script"),s[y]("type","text/x-tpl"),s.appendChild(document.createTextNode(t)),document.head.appendChild(s);break;case"script-link":if(n)for(i=l("script"),r=i.length-1;r>=0;r--)if(i[r].src&&t===i[r].src){u=i[r];break}u?s=u:(s=a("script"),s[y]("type","text/javascript"),s[y]("language","javascript"),s[y]("src",t),document.head.appendChild(s));break;case"script":s=a("script"),s[y]("type","text/javascript"),s[y]("language","javascript"),s.appendChild(document.createTextNode(t)),document.head.appendChild(s);break;case"style-link":if(n)for(i=l("link"),r=i.length-1;r>=0;r--)if(t===i[r].href){u=i[r];break}u?s=u:(s=a("link"),s[y]("type","text/css"),s[y]("rel","stylesheet"),s[y]("media","all"),s[y]("href",t),document.head.appendChild(s));break;case"style":default:s=a("style"),s[y]("type","text/css"),s[y]("media","all"),s.appendChild(document.createTextNode("")),document.head.appendChild(s),t&&c(s,t)}return s}function o(e,t,n,r,i){var c,o,p,h,f,d,m=r.length,b=new Array(m);if(x){for(c=0;m>c;c++)n[g](r[c].cache_id)?b[c]=n[r[c].cache_id]:"class"!==r[c].type?b[c]=n[r[c].cache_id]=M(r[c].path,"utf8"):r[c].name in t?b[c]=t[r[c].name]:(b[c]=require(r[c].path)||null,r[c].cb&&r[c].cb(e,r[c].id,r[c].name,r[c].path,b[c]));return i.apply(t,b)}if(j){for(c=0;m>c;c++)n[g](r[c].cache_id)?b[c]=n[r[c].cache_id]:"class"!==r[c].type?b[c]=n[r[c].cache_id]=M(r[c].path,"utf8"):r[c].name in t?b[c]=t[r[c].name]:(importScripts(r[c].path),b[c]=t[r[c].name]||null,r[c].cb&&r[c].cb(e,r[c].id,r[c].name,r[c].path,b[c]));return i.apply(t,b)}h=l("head",0),o=0,c=0,f=function(e,t,r,i){var l,c;"style"===t||"script"===t?(c=s(e))&&t===c.tagName[_]()?i():N(r,"utf8",function(r){n[e]=r,u(t,r)[y]("id",e),i()}):"class"!==t?"template"===t&&(c=s(e))&&"script"===c.tagName[_]()?i():N(r,"utf8",function(r){n[e]=r,"template"!==t||s(e)||u("tpl",r)[y]("id",e),i()}):(c=s(e))&&"script"===c.tagName[_]()?i():(l=0,c=a("script"),c[y]("id",e),c[y]("type","text/javascript"),c[y]("language","javascript"),c.onload=c.onreadystatechange=function(){l||c.readyState&&"loaded"!=c.readyState&&"complete"!=c.readyState||(l=1,c.onload=c.onreadystatechange=null),i()},c[y]("src",r),h.appendChild(c))},d=function v(){var s;(s=n[g](r[c].cache_id))||r[c].name in t?(b[c]=(s?n[r[c].cache_id]:t[r[c].name])||null,r[c].cb&&r[c].cb(e,r[c].id,r[c].name,r[c].path,b[c]),++c>=m?i.apply(t,b):(s=n[g](r[c].cache_id))||r[c].name in t?(b[c]=(s?n[r[c].cache_id]:t[r[c].name])||null,v()):(t[r[c].name]=null,f(r[c].cache_id,r[c].type,r[c].path,v))):++o<4?setTimeout(v,20):(o=0,t[r[c].name]=null,r[c].cb&&r[c].cb(e,r[c].id,r[c].name,r[c].path,null),c++,v())};for(;m>c&&((p=n[g](r[c].cache_id))||r[c].name in t);)b[c]=(p?n[r[c].cache_id]:t[r[c].name])||null,c++;m>c?f(r[c].cache_id,r[c].type,r[c].path,d):i.apply(t,b)}function p(e){return e.split(k).join(q)}function h(e){return e.split(q).join(k)}function f(){var e,t,n,r,i,s,a,l,c,u=arguments,o=u.length,f=S;if(!o)return".";if(e=v.call(u,p).join(f),t=e.length,!t)return".";for(n=e.charAt(0),r=e.charAt(t-1),i=e.split(C).filter(Boolean),s=[],a=0,l=i.length-1;l>=0;)c=i[l],".."===c?a++:"."!==c&&(a?a--:s.push(i[l])),l--;return e=s.reverse().join(f),e||n||(e="."),e&&r===f&&(e+=f),(n===f?f:"")+h(e)}var d,m="prototype",g="hasOwnProperty",y="setAttribute",_="toLowerCase",b=Object[m].toString,v=Array[m].map,x="undefined"!=typeof global&&"[object global]"===b.call(global),j=!x&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,T=!x&&!j&&"undefined"!=typeof navigator,A=x?global:j?this:window,S="/",C=/\/|\\/g,k="://",q="#PROTOCOL#",w=/[\-.\/\\:]+/g,R=String[m].startsWith?function(e,t,n){return e.startsWith(t,n||0)}:function(e,t,n){return n=n||0,t===e.substr(n,t.length+n)},M=x?function(e,t){return require("fs").readFileSync(e,{encoding:t})}:function(e,t){var n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return n.open("GET",e,!1),n.setRequestHeader("Content-Type","text/plain; charset="+t),n.overrideMimeType("text/plain; charset="+t),n.send(null),200===n.status?n.responseText:""},N=x?function(e,t,n){return require("fs").readFile(e,{encoding:t},function(e,t){n&&n(e?"":t)}),""}:function(e,t,n){var r=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return r.open("GET",e,!0),r.setRequestHeader("Content-Type","text/plain; charset="+t),r.overrideMimeType("text/plain; charset="+t),r.responseType="text",r.onload=function(){n&&n(200===r.status?r.responseText:"")},r.send(null),""};return d=function E(e,t){var n=this;return n instanceof E?(n.base="",n.base_url="",n.base_path(e,t),n._classes={},n._assets={},void(n._cache={})):new E(e,t)},d.VERSION="0.2.0",d.BASE="./",d.join_path=f,d[m]={constructor:d,base:null,base_url:null,_classes:null,_assets:null,_cache:null,dispose:function(){var e=this;return e._classes=null,e._assets=null,e._cache=null,e.base=null,e.base_url=null,e},base_path:function(e,n){var r=this;return t(e)&&e.length?r.base=e:!1===e&&(r.base=""),t(n)&&n.length?r.base_url=n:!1===n&&(r.base_url=""),r},get_path:function(e,t){return r(e)?t||"":!r(t)&&(R(e,"./")||R(e,"../")||R(e,".\\")||R(e,"..\\"))?f(t,e):e},path:function(e){var t=this;return t.get_path(e||"",x?t.base:t.base_url)},path_url:function(e){var t=this;return t.get_path(e||"",t.base_url)},register:function(s,a){var l,c,u,o,p,h,f,d,m,g=this,y=g._classes,b=g._assets;if(n(a)&&a.length)if(n(a[0])||(a=[a]),"classes"===s)for(l=0,c=a.length;c>l;l++)o=a[l],u=o[0],p=o[1],h=o[2],f=o[3]?o[3]:[],r(u)||r(p)||r(h)||(y[p]=[u,p,g.path(h),i(f),!1,o[4]&&e(o[4])?o[4]:null]);else if("assets"===s)for(l=0,c=a.length;c>l;l++)o=a[l],d=o[0],p=o[1],m=o[2],f=o[3]?o[3]:[],r(d)||r(p)||r(m)||(b[p]=[d[_](),p,t(m)?g.path_url(m):m,i(f),!1,!1,o[4]&&e(o[4])?o[4]:null]);return g},import_class:function(t,n){var i,s,a,l,c,u,p,h,f=this,d=f._classes,m="class-"+t,y=f._cache;if(y[g](m))e(n)&&n.call(f,y[m]);else{for(s=!1,h=[],i=[t];i.length;)if(t=i[0],d[g](t)&&!d[t][4])if(s=!0,A[g](d[t][0]))y["class-"+t]=A[d[t][0]];else{if(p=d[t][3],!r(p)){for(a=!1,l=p.length,c=l-1;c>=0;c--)u=p[c],d[g](u)&&!d[u][4]&&(a=!0,i.unshift(u));if(a)continue;i.shift()}d[t][4]=!0,h.push({id:t,type:"class",cache_id:"class-"+t,name:d[t][0],path:d[t][2],cb:d[t][5]})}else d[g](t)?(s=!0,i.shift()):i.shift();s&&h.length?o(f,A,y,h,function(){var t,r,i=arguments;for(t=0,r=i.length;r>t;t++)y[h[t].cache_id]=i[t];e(n)&&n.call(f,y[m])}):e(n)&&n.call(f,null)}return f},import_asset:function(e){for(var t,r,i,a,l,c,o,p,h,f,d,m,_,b,v=this,x=[e],j=v._assets,A=[];x.length;)if(e=x[0],j[g](e)&&j[e][4]&&!j[e][5]){if(c=j[e],o=c[0],e=c[1],p=c[2],t=c[3],t&&t.length){for(r=!1,i=t.length,a=i-1;a>=0;a--)l=t[a],j[g](l)&&!j[l][5]&&(j[l][4]=!0,r=!0,x.unshift(l));if(r)continue;x.shift()}f="styles"===o,d="scripts"===o,m="templates"===o,_=n(p),h=e.replace(w,"_"),f?T?(A.push(b=_?s("importer-inline-style-"+h)||u("style",p[0]):s("importer-style-"+h)||u("style-link",v.path_url(p),!0)),b[y]("id",_?"importer-inline-style-"+h:"importer-style-"+h)):A.push(_?'<style id="importer-inline-style-'+h+'" type="text/css" media="all">'+p[0]+"</style>":'<link id="importer-style-'+h+'" type="text/css" rel="stylesheet" href="'+v.path_url(p)+'" media="all" />'):d?T?(A.push(b=_?s("importer-inline-script-"+h)||u("script","/*<![CDATA[*/ "+p[0]+" /*]]>*/"):s("importer-script-"+h)||u("script-link",v.path_url(p),!0)),b[y]("id",_?"importer-inline-script-"+h:"importer-script-"+h)):A.push(_?'<script id="importer-inline-script-'+h+'" type="text/javascript">/*<![CDATA[*/ '+p[0]+" /*]]>*/</script>":'<script id="importer-script-'+h+'" type="text/javascript" src="'+v.path_url(p)+'"></script>'):m?T?(A.push(b=_?s("importer-inline-tpl-"+h)||u("tpl",p[0]):s("importer-inline-tpl-"+h)||u("tpl",v.getFile(p))),b[y]("id",_?"importer-inline-tpl-"+h:"importer-inline-tpl-"+h)):A.push(_?'<script id="importer-inline-tpl-'+h+'" type="text/x-tpl">'+p[0]+"</script>":'<script id="importer-inline-tpl-'+h+'" type="text/x-tpl">'+v.getFile(p)+"</script>"):A.push(c[6]?c[6](v,"output",o,e,p)||"":_?p[0]:v.getFile(p)),c[5]=!0}else x.shift();return A},enqueue:function(e,t,n,i,s){var a=this,l=a._assets;return r(e)||r(t)||(l[g](t)?(l[t][4]=!0,l[t][6]&&l[t][6](a,"enqueue",e,t,l[t][2])):r(n)||(a.register("assets",[e,t,n,i,s]),l[t][4]=!0,l[t][6]&&l[t][6](a,"enqueue",e,t,l[t][2]))),a},assets:function(e){var t,n,r,i,s,a=this,l=a._assets,c=[];arguments.length||(e="scripts"),e=e[_]();for(n in l)l[g](n)&&(r=l[n],e===r[0]&&r[4]&&!r[5]&&c.push(r[1]));if(T){for(i=0,s=c.length;s>i;i++)a.import_asset(c[i]);t=""}else{for(t=[],i=0,s=c.length;s>i;i++)t=t.concat(a.import_asset(c[i]));t=t.join("\n")}return t},getFile:function(t,n,r){var i,s=this;return t=s.path(t),n=n||{},i=n.encoding||"utf8",r=r||n.complete||e(n)&&n,T?N(t,i,function(t){e(r)&&r(t)}):e(r)?N(t,i,r):M(t,i)},importClass:function(t,n,i,s){var a=this,l=arguments.length;return 4>l&&e(i)?(s=i,i=null):3>l&&e(n)&&(s=n,n=null,i=null),a._classes[g](t)||r(n)||a.register("classes",[t,t,a.path(n+".js"),i]),a._classes[g](t)&&!a._classes[t][4]?a.import_class(t,s):e(s)&&s.call(a,a._cache["class-"+t]||null),a},importAll:function(t,n){var r,s,a,l,c=this;return t=i(t),s=t.length,a=new Array(s),r=0,l=function u(i){arguments.length&&(a[r]=i||null,r++),s>r?c.import_class(t[r],u):e(n)&&setTimeout(function(){n.apply(c,a)},10)},l(),c}},d.BASE=x?__dirname:j?this.location.href.split("/").slice(0,-1).join("/"):(l("script",-1).src||"./").split("/").slice(0,-1).join("/"),d});
/**
*  Importer
*  a simple loader manager for classes and assets with dependencies for PHP, Python, Node/XPCOM/JS
*
*  @version 0.3.2
*  https://github.com/foo123/Importer
**/
!function(e,t,n){"use strict";var r;"undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"]?(e.EXPORTED_SYMBOLS=[t])&&(e[t]=n.call(e)):"object"==typeof module&&module.exports?module.exports=n.call(e):"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]?System.register(t,[],function(r){r(t,n.call(e))}):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(){return n.call(e)}):t in e||(e[t]=r=n.call(e))&&"function"==typeof define&&define.amd&&define(function(){return r})}(this,"Importer",function(){"use strict";function e(e,t,n,r,i){var s,c,p,f,h,d,m=r.length,v=new Array(m);if(x||C||T){for(s=0;m>s;s++)n[y](r[s].cache_id)?v[s]=n[r[s].cache_id]:"class"!==r[s].type?v[s]=n[r[s].cache_id]=D(r[s].path,x?"UTF-8":"utf8"):r[s].name in t?v[s]=t[r[s].name]:(v[s]=O(t[(r[s].name,r[s].path,t)])||null,e.trigger("import-class",[e,r[s].id,r[s].name,r[s].path,v[s]]).trigger("import-class-"+r[s].id,[e,r[s].id,r[s].name,r[s].path,v[s]]));return i.apply(t,v)}f=o("head",0),c=0,s=0,h=function(e,t,r,i){var s,o;"style"===t||"script"===t?(o=a(e))&&t===o.tagName[_]()?i():H(r,"utf8",function(r){n[e]=r,u(t,r)[g]("id",e),i()}):"class"!==t?"template"===t&&(o=a(e))&&"script"===o.tagName[_]()?i():H(r,"utf8",function(r){n[e]=r,"template"!==t||a(e)||u("tpl",r)[g]("id",e),i()}):(o=a(e))&&"script"===o.tagName[_]()?i():(s=0,o=l("script"),o[g]("id",e),o[g]("type","text/javascript"),o[g]("language","javascript"),o.onload=o.onreadystatechange=function(){s||o.readyState&&"loaded"!=o.readyState&&"complete"!=o.readyState||(s=1,o.onload=o.onreadystatechange=null),i()},o[g]("src",r),f.appendChild(o))},d=function b(){var a;(a=n[y](r[s].cache_id))||r[s].name in t?(v[s]=(a?n[r[s].cache_id]:t[r[s].name])||null,e.trigger("import-class",[e,r[s].id,r[s].name,r[s].path,v[s]]).trigger("import-class-"+r[s].id,[e,r[s].id,r[s].name,r[s].path,v[s]]),++s>=m?i.apply(t,v):(a=n[y](r[s].cache_id))||r[s].name in t?(v[s]=(a?n[r[s].cache_id]:t[r[s].name])||null,b()):(t[r[s].name]=null,h(r[s].cache_id,r[s].type,r[s].path,b))):++c<4?setTimeout(b,20):(c=0,t[r[s].name]=null,e.trigger("import-class",[e,r[s].id,r[s].name,r[s].path,null]).trigger("import-class-"+r[s].id,[e,r[s].id,r[s].name,r[s].path,null]),s++,b())};for(;m>s&&((p=n[y](r[s].cache_id))||r[s].name in t);)v[s]=(p?n[r[s].cache_id]:t[r[s].name])||null,s++;m>s?h(r[s].cache_id,r[s].type,r[s].path,d):i.apply(t,v)}function t(e){return"function"==typeof e}function n(e){return e instanceof String||"[object String]"===v.call(e)}function r(e){return e instanceof Array||"[object Array]"===v.call(e)}function i(e){if(!e)return!0;var t=v.call(e);return(e instanceof Array||e instanceof String||"[object Array]"===t||"[object String]"===t)&&!e.length}function s(e){return r(e)?e:[e]}function a(e){return document.getElementById(e)}function l(e){return document.createElement(e)}function o(e,t){var n=document.getElementsByTagName(e);return arguments.length>1?0>t?n[n.length+t]:n[t]:n}function c(e,t){var n,r,i,s,a,l=typeof t;if("object"===l){r=0;for(n in t)t[y](n)&&(i=t[n],s=i.selector,a=[].concat(i.rules).join("; "),"insertRule"in e.sheet?(e.sheet.insertRule(s+"{"+a+"}",r),i.css=e.sheet.cssRules[r]):"addRule"in e.sheet&&(e.sheet.addRule(s,a,r),i.css=e.sheet.rules[r]),r++)}else"string"===l&&(e.styleSheet?e.styleSheet.cssText=(e.styleSheet.cssText||"")+t:e.appendChild(document.createTextNode(t)));return t}function u(e,t,n){var r,i,s=null,a=null;switch(e){case"tpl-link":case"tpl":s=l("script"),s[g]("type","text/x-tpl"),s.appendChild(document.createTextNode(t)),document.head.appendChild(s);break;case"script-link":if(n)for(i=o("script"),r=i.length-1;r>=0;r--)if(i[r].src&&t===i[r].src){a=i[r];break}a?s=a:(s=l("script"),s[g]("type","text/javascript"),s[g]("language","javascript"),s[g]("src",t),document.head.appendChild(s));break;case"script":s=l("script"),s[g]("type","text/javascript"),s[g]("language","javascript"),s.appendChild(document.createTextNode(t)),document.head.appendChild(s);break;case"style-link":if(n)for(i=o("link"),r=i.length-1;r>=0;r--)if(t===i[r].href){a=i[r];break}a?s=a:(s=l("link"),s[g]("type","text/css"),s[g]("rel","stylesheet"),s[g]("media","all"),s[g]("href",t),document.head.appendChild(s));break;case"style":default:s=l("style"),s[g]("type","text/css"),s[g]("media","all"),s.appendChild(document.createTextNode("")),document.head.appendChild(s),t&&c(s,t)}return s}function p(e){return e.split(U).join(P)}function f(e){return e.split(P).join(U)}function h(){var e,t=arguments,n=".";return t.length?(x?n=OS.Path.join.apply(OS.Path,t):C?(e=N("path"),n=e.join.apply(e,t)):n=d.apply(null,t),n):n}function d(){var e,t,n,r,i,s,a,l,o,c=arguments,u=c.length,h=M;if(!u)return".";if(e=b.call(c,p).join(h),t=e.length,!t)return".";for(n=e.charAt(0),r=e.charAt(t-1),i=e.split(F).filter(Boolean),s=[],a=0,l=i.length-1;l>=0;)o=i[l],".."===o?a++:"."!==o&&(a?a--:s.push(i[l])),l--;return e=s.reverse().join(h),e||n||(e="."),e&&r===h&&(e+=h),(n===h?h:"")+f(e)}{var m="prototype",y="hasOwnProperty",g="setAttribute",_="toLowerCase",v=Object[m].toString,b=Array[m].map,S=String[m].startsWith?function(e,t,n){return e.startsWith(t,n||0)}:function(e,t,n){return n=n||0,t===e.substr(n,t.length+n)},j=function(){},x="undefined"!=typeof Components&&"object"==typeof Components.classes&&"object"==typeof Components.classesByID&&Components.utils&&"function"==typeof Components.utils["import"],C=!x&&"undefined"!=typeof global&&"[object global]"===v.call(global),T=!x&&!C&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,k=!x&&!C&&!T&&"undefined"!=typeof navigator;"function"==typeof define&&define.amd&&"function"==typeof require,!x&&!C&&"undefined"!=typeof System&&"function"==typeof System.register&&"function"==typeof System["import"]}x&&(N("resource://gre/modules/NetUtil.jsm"),N("resource://gre/modules/osfile.jsm"));var I,A=x?this:C?global:T?this:window,w=x?Components.utils:null,q=x?Components.classes:null,R=x?Components.interfaces:null,N=x?w["import"]:C?require:j,B=C?N("fs"):null,O=x?function(e,t,n){return N(t,n),n[e]}:C?function(e,t){return N(t)}:T?function(e,t,n){return N(t),n[e]}:j,E=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},F=/\/|\\/g,U="://",P="#PROTOCOL#",L=/[\-.\/\\:]+/g,M=x?function(){var e=q["@mozilla.org/file/directory_service;1"].getService(R.nsIProperties).get("ProfD",R.nsIFile);return e.append("abc"),e.append("abc"),e.path.substr(e.path.length-"abc".length-1,1)}():C?N("path").sep:"/",z=function(e){return q["@mozilla.org/network/io-service;1"].getService(R.nsIIOService).newURI(e,null,null).QueryInterface(R.nsIFileURL).file},D=x?function(e,t){var n,r,i,s;if(r=z(e),i=q["@mozilla.org/network/file-input-stream;1"].createInstance(R.nsIFileInputStream),"binary"===t){var a=q["@mozilla.org/binaryinputstream;1"].createInstance(R.nsIBinaryInputStream);i.init(r,-1,-1,!1),s=i.available(),a.setInputStream(i),a.readByteArray(s,n=new Uint8Array(s)),a.close()}else{var l=q["@mozilla.org/intl/converter-input-stream;1"].createInstance(R.nsIConverterInputStream),o={value:""},c=0;n="",i.init(r,-1,0,0),l.init(i,t,0,0);do c=l.readString(4294967295,o),n+=o.value;while(0!=c);l.close()}return n}:C?function(e,t){return B.readFileSync(e,"binary"===t?{}:{encoding:t})}:function(e,t){var n=E();return n.open("GET",e,!1),"binary"===t?T&&(n.responseType="arraybuffer"):(T&&(n.responseType="text"),n.setRequestHeader("Content-Type","text/plain; charset="+t),n.overrideMimeType("text/plain; charset="+t)),n.send(null),200===n.status?"binary"===t?n.response:n.responseText:"binary"===t?null:""},H=x?function(e,t,n){return NetUtil.asyncFetch(z(e),function(e,r){var i;if(Components.isSuccessCode(r))if("binary"===t){var s=q["@mozilla.org/binaryinputstream;1"].createInstance(R.nsIBinaryInputStream),a=e.available();s.setInputStream(e),s.readByteArray(a,i=new Uint8Array(a)),s.close()}else i=NetUtil.readInputStreamToString(e,e.available(),{charset:t});else i="binary"===t?null:"";n&&n(i)}),""}:C?function(e,t,n){return"binary"===t?B.readFile(e,function(e,t){n&&n(e?null:t)}):B.readFile(e,{encoding:t},function(e,t){n&&n(e?"":t)}),""}:function(e,t,n){var r=E();return r.open("GET",e,!0),"binary"===t?(r.responseType="arraybuffer",r.onload=function(){n&&n(200===r.status?r.response:null)}):(r.responseType="text",r.setRequestHeader("Content-Type","text/plain; charset="+t),r.overrideMimeType("text/plain; charset="+t),r.onload=function(){n&&n(200===r.status?r.responseText:"")}),r.send(null),""};return I=function X(e,t){var n=this;return n instanceof X?(n.base="",n.base_url="",n.base_path(e,t),n._classes={},n._assets={},n._hooks={},void(n._cache={})):new X(e,t)},I.VERSION="0.3.2",I.BASE="./",I.path_join=h,I.join_path=d,I[m]={constructor:I,base:null,base_url:null,_classes:null,_assets:null,_hooks:null,_cache:null,dispose:function(){var e=this;return e._classes=null,e._assets=null,e._hooks=null,e._cache=null,e.base=null,e.base_url=null,e},on:function(e,n,r){var s=this;return!i(e)&&t(n)&&(s._hooks[y](e)||(s._hooks[e]=[]),s._hooks[e].push([n,!0===r,0])),s},one:function(e,t){return this.on(e,t,!0)},off:function(e,t){var n,r,s=this;if(!i(e)&&!i(s._hooks[e]))if(!0===t)delete s._hooks[e];else if(t)for(n=s._hooks[e],r=n.length-1;r>=0;r--)t===n[r][0]&&n.splice(r,1);return s},trigger:function(e,t){var n,r,s,a,l=this;if(!i(e)&&!i(l._hooks[e])){for(n=l._hooks[e],t=t||[],r=0;r<n.length&&(s=n[r],s[1]&&s[2]||(s[2]=1,a=s[0].apply(null,t),!1!==a));r++);for(r=n.length-1;r>=0;r--)n[r][1]&&n[r][2]&&n.splice(r,1)}return l},base_path:function(e,t){var r=this;return n(e)&&e.length?r.base=e:!1===e&&(r.base=""),n(t)&&t.length?r.base_url=t:!1===t&&(r.base_url=""),r},get_path:function(e,t){return i(e)?t||"":!i(t)&&(S(e,"./")||S(e,"../")||S(e,".\\")||S(e,"..\\"))?d(t,e):e},path:function(e){var t=this;return t.get_path(e||"",C?t.base:t.base_url)},path_url:function(e){var t=this;return t.get_path(e||"",t.base_url)},register:function(e,t){var a,l,o,c,u,p,f,h,d,m=this,y=m._classes,g=m._assets;if(r(t)&&t.length)if(r(t[0])||(t=[t]),"classes"===e)for(a=0,l=t.length;l>a;a++)c=t[a],o=c[0],u=c[1],p=c[2],f=c[3]?c[3]:[],i(o)||i(u)||i(p)||(y[u]=[o,u,m.path(p),s(f),!1]);else if("assets"===e)for(a=0,l=t.length;l>a;a++)c=t[a],h=c[0],u=c[1],d=c[2],f=c[3]?c[3]:[],i(h)||i(u)||i(d)||(g[u]=[h[_](),u,n(d)?m.path_url(d):d,s(f),!1,!1]);return m},import_class:function(n,r){var s,a,l,o,c,u,p,f,h=this,d=h._classes,m="class-"+n,g=h._cache;if(g[y](m))t(r)&&r.call(h,g[m]);else{for(a=!1,f=[],s=[n];s.length;)if(n=s[0],d[y](n)&&!d[n][4])if(a=!0,A[y](d[n][0]))d[n][4]=!0,g["class-"+n]=A[d[n][0]];else{if(p=d[n][3],!i(p)){for(l=!1,o=p.length,c=o-1;c>=0;c--)u=p[c],d[y](u)&&!d[u][4]&&(l=!0,s.unshift(u));if(l)continue;s.shift()}d[n][4]=!0,f.push({id:n,type:"class",cache_id:"class-"+n,name:d[n][0],path:d[n][2]})}else d[y](n)?(a=!0,s.shift()):s.shift();a&&f.length?e(h,A,g,f,function(){var e,n,i=arguments;for(e=0,n=i.length;n>e;e++)g[f[e].cache_id]=i[e];t(r)&&r.call(h,g[m])}):t(r)&&r.call(h,null)}return h},import_asset:function(e){for(var t,n,i,s,l,o,c,p,f,h,d,m,_,v,b,S=this,j=[e],x=S._assets,C=[];j.length;)if(e=j[0],x[y](e)&&x[e][4]&&!x[e][5]){if(o=x[e],c=o[0],e=o[1],p=o[2],t=o[3],t&&t.length){for(n=!1,i=t.length,s=i-1;s>=0;s--)l=t[s],x[y](l)&&!x[l][5]&&(x[l][4]=!0,n=!0,j.unshift(l));if(n)continue;j.shift()}o[5]=!0,b={},S.trigger("import-asset",[S,e,c,p,b]).trigger("import-asset-"+e,[S,e,c,p,b]),null!=b["return"]?C.push(b["return"]):(h="styles"===c,d="scripts"===c,m="templates"===c,_=r(p),f=e.replace(L,"_"),h?k?(C.push(v=_?a("importer-inline-style-"+f)||u("style",p[0]):a("importer-style-"+f)||u("style-link",S.path_url(p),!0)),v[g]("id",_?"importer-inline-style-"+f:"importer-style-"+f)):C.push(_?'<style id="importer-inline-style-'+f+'" type="text/css" media="all">'+p[0]+"</style>":'<link id="importer-style-'+f+'" type="text/css" rel="stylesheet" href="'+S.path_url(p)+'" media="all" />'):d?k?(C.push(v=_?a("importer-inline-script-"+f)||u("script","/*<![CDATA[*/ "+p[0]+" /*]]>*/"):a("importer-script-"+f)||u("script-link",S.path_url(p),!0)),v[g]("id",_?"importer-inline-script-"+f:"importer-script-"+f)):C.push(_?'<script id="importer-inline-script-'+f+'" type="text/javascript">/*<![CDATA[*/ '+p[0]+" /*]]>*/</script>":'<script id="importer-script-'+f+'" type="text/javascript" src="'+S.path_url(p)+'"></script>'):m?k?(C.push(v=_?a("importer-inline-tpl-"+f)||u("tpl",p[0]):a("importer-inline-tpl-"+f)||u("tpl",S.get(p))),v[g]("id",_?"importer-inline-tpl-"+f:"importer-inline-tpl-"+f)):C.push(_?'<script id="importer-inline-tpl-'+f+'" type="text/x-tpl">'+p[0]+"</script>":'<script id="importer-inline-tpl-'+f+'" type="text/x-tpl">'+S.get(p)+"</script>"):C.push(_?p[0]:S.get(p)))}else j.shift();return C},assets:function(e){var t,n,r,i,s,a=this,l=a._assets,o=[];arguments.length||(e="scripts"),e=e[_]();for(n in l)l[y](n)&&(r=l[n],e===r[0]&&r[4]&&!r[5]&&o.push(r[1]));if(k){for(i=0,s=o.length;s>i;i++)a.import_asset(o[i]);t=""}else{for(t=[],i=0,s=o.length;s>i;i++)t=t.concat(a.import_asset(o[i]));t=t.join("\n")}return t},enqueue:function(e,t,n,r){var s=this,a=s._assets;return i(e)||i(t)||(a[y](t)?(a[t][4]=!0,s.trigger("enqueue-asset",[s,t,e,a[t][2]]).trigger("enqueue-asset-"+t,[s,t,e,a[t][2]])):i(n)||(s.register("assets",[e,t,n,r]),a[t][4]=!0,s.trigger("enqueue-asset",[s,t,e,a[t][2]]).trigger("enqueue-asset-"+t,[s,t,e,a[t][2]]))),s},get:function(e,n,r){var s,a=this;return e=a.path(e),n=n||{},s=n.encoding||(x?"UTF-8":"utf8"),i(n.binary)||(s="binary"),r=r||n.complete||t(n)&&n,k?H(e,s,function(e){t(r)&&r(e)}):t(r)?H(e,s,r):D(e,s)},load:function(e,n,s,a){var l,o,c,u,p=this,f=arguments.length;return r(e)?(a=n,l=e.length,o=new Array(l),c=0,(u=function h(n){arguments.length&&(o[c]=n||null,c++),l>c?p.import_class(e[c],h):t(a)&&setTimeout(function(){a.apply(p,o)},10)})()):(4>f&&t(s)?(a=s,s=null):3>f&&t(n)&&(a=n,n=null,s=null),p._classes[y](e)||i(n)||p.register("classes",[e,e,p.path(n),s]),p._classes[y](e)&&!p._classes[e][4]?p.import_class(e,a):t(a)&&a.call(p,p._cache["class-"+e]||null)),p}},I.BASE=x?"./":C?__dirname:T?this.location.href.split("/").slice(0,-1).join("/"):(o("script",-1).src||"./").split("/").slice(0,-1).join("/"),I});
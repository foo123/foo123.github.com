/**
*
*   ModelView.js
*   @version: 0.30.2
*   @dependencies: jQuery, jQueryUI (optional)
*
*   A micro-MV* (MVVM) jQuery-based framework for complex (UI) screens
*   https://github.com/foo123/modelview.js
*
**/!function(e,t,n,i){"use strict";function r(e,t,n,i,r){var a;return e?{file:__filename,path:__dirname}:t?{file:a=self.location.href,path:a.split("/").slice(0,-1).join("/")}:n&&r&&r.uri?{file:a=r.uri,path:a.split("/").slice(0,-1).join("/")}:i&&(a=document.getElementsByTagName("script"))&&a.length?{file:a=a[a.length-1].src,path:a.split("/").slice(0,-1).join("/")}:{file:null,path:null}}function a(e,t,n,i,r){var a,l=e.length,o=new Array(l);for(a=0;l>a;a++)o[a]=1===i?n[e[a]]||r(t[a]):2===i?r(e[a]):n[e[a]];return o}function l(e,t,n,i,r,a){var l,o,u,s,c,f,d,h=n.length;if(a){for(l=0;h>l;l++)n[l]in e||importScripts(t+i[l]);return r()}f=document.getElementsByTagName("head")[0],d=document.createElement("a"),o=/^\./,u=0,l=0,s=function(e,n){var i=0,r=document.createElement("script");r.type="text/javascript",r.language="javascript",r.onload=r.onreadystatechange=function(){i||r.readyState&&"loaded"!=r.readyState&&"complete"!=r.readyState||(i=1,r.onload=r.onreadystatechange=null,n(),f.removeChild(r),r=null)},o.test(e)&&(d.href=t+e,e=d.protocol+"//"+d.host+d.pathname+d.search+d.hash),r.src=e,f.appendChild(r)},c=function(){n[l]in e?++l>=h?r():n[l]in e?c():s(i[l],c):++u<30?setTimeout(c,30):(u=0,l++,c())};for(;h>l&&n[l]in e;)l++;h>l?s(i[l],c):r()}n=n||[[],[]];var o,u,s,c="undefined"!=typeof global&&"[object global]"==={}.toString.call(global),f=!c&&"undefined"!=typeof navigator,d=!c&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator,h="function"==typeof define&&define.amd,p=c&&"object"==typeof module&&module.exports,m=d?self:e,v=r(c,d,h,f),g=[].concat(n[0]),$=[].concat(n[1]),b=g.length,y=/\.js$/i;if(p)module.$deps=module.$deps||{},module.exports=module.$deps[t]=i.apply(e,[{NODE:module}].concat(a(g,$,module.$deps,1,require)))||1;else if(h&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)){if(!require.defined(t)){for(s={},u=0;b>u;u++)require.specified(g[u])||(s[g[u]]=$[u].replace(y,""));require.config({paths:s}),define(t,["require","exports","module"].concat(g),function(t,n,r){return i.apply(e,[{AMD:r}].concat(a(g,$,arguments,2,t)))})}}else t in m||l(m,v.path+"/",g,$,function(){m[t]=o=i.apply(e,[{}].concat(a(g,$,m)))||1,h&&define(t,["require"],function(){return o})},d)}(this,"ModelView",[["jQuery"],["./jquery.js"]],function(e,t){return!function(e,t,n){"use strict";var i=function(e,t){return e.bind(t)},r="prototype",a=Array,l=a[r],o=RegExp,u=Number,s=Object,c=s[r],f=s.create,d=s.keys,h=Function,p=h[r],m=String,v=m[r],g=p.call,$=(i(g,c.hasOwnProperty),i(g,c.toString)),b=i(g,l.slice),y=function(e,t){return e instanceof t},w=function(e,t){return new h(e,t)},k=1/0,_=(Math.random,parseFloat),x=isNaN,E=isFinite,C=2,R=3,T=4,S=8,V=9,N=16,A=32,D=64,O=128,j=256,M=512,F=1024,I=N|A,L=N|S,P=function(e){var t,i;return null===e?j:!0===e||!1===e?T:(t=typeof e,i=$(e),n===e||"undefined"===t?M:e instanceof u||"number"===t?x(e)?R:C:e instanceof m||"string"===t?1===e.length?V:S:e instanceof a||"[object Array]"===i?N:e instanceof o||"[object RegExp]"===i?O:e instanceof h||"function"===t&&"[object Function]"===i?D:"[object Object]"===i?A:F)},z=function(e,t){return!!(t&P(e))},B="getAttribute",W="setAttribute",H="checked",q="disabled",U="selected",J="name",Y="tagName",K="type",Q="value",X="options",Z="selectedIndex",G="parentNode",et="style",tt="innerHTML",nt="innerText",it="textContent",rt=function(e){return document.createTextNode(e||"")},at=function(e){var t=e.attributes[Q];return!t||t.specified?e[Q]:e.text},lt=function(e){for(var t,n,i=e[X],r=e[Z],a="select-one"===e[K]||0>r,l=a?null:[],o=a?r+1:i.length,u=0>r?o:a?r:0;o>u;u++)if(n=i[u],!(!n[U]&&u!==r||n[q]||n[G][q]&&"optgroup"===n[G][Y])){if(t=at(n),a)return t;l.push(t)}return l},ot=function(e){return m(e)},ut=function(e,t){var n,i,r=[].concat(t).map(ot),a=e[X];for(i=0;i<a.length;i++)n=a[i],n[U]=-1<r.indexOf(at(n));r.length||(e[Z]=-1)},st=function(e){if(e)switch(e[Y].toLowerCase()){case"textarea":case"input":return e[Q];case"select":return lt(e);default:return it in e?e[it]:e[nt]}},ct=function(e,t){if(e)switch(e[Y].toLowerCase()){case"textarea":case"input":e[Q]=m(t);break;case"select":ut(e,t);break;default:it in e?e[it]=m(t):e[nt]=m(t)}},ft=window.getComputedStyle||function(e){return e.currentStyle},dt=function(e){e._displayCached||(e._displayCached=ft(e,null).display||"block"),e[et].display="none"!==e._displayCached?e._displayCached:"block",e._displayCached=n},ht=function(e){e._displayCached||(e._displayCached=ft(e,null).display||"block"),e[et].display="none"},pt=JSON.parse,mt=JSON.stringify,vt=function(){return(new Date).getTime()},gt=t.Event,$t=t.extend;v.trim||(v.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),v.startsWith||(v.startsWith=function(e,t){return t=t||0,e===this.substr(t,e.length+t)}),v.tR=v.trim,v.sW=v.startsWith;var bt="*",yt="modelview",wt=function(e){return!x(_(e))&&E(e)},kt=function(e){return wt(e)&&(e=+e,0===e%1&&e>=0)?!0:!1},_t=function(){var e,t,n,i,r,a,l,o=arguments;for(t=o[0]||{},e=o.length,a=1;e>a;a++)if(n=o[a],A===P(n))for(r in n)i=n[r],l=P(i),t[r]=C&l?0+i:L&l?i.slice(0):i;return t},xt=function(e,t){this.val=e||null,this.next=t||{}},Et=function(e,t){if(!e)return null;var n,i,r=[],a=e.length;for(n=0;a>n;n++)i=e[n],i&&(i[t]&&r.push(i[t].next),i[bt]&&r.push(i[bt].next));return r.length?r:null},Ct=function(e,t){if(!e)return null;var n,i,r=e.length;if(t){for(n=0;r>n;n++)if(i=e[n]){if(i[t]&&i[t].val)return i[t].val;if(i[bt]&&i[bt].val)return i[bt].val}}else for(n=0;r>n;n++)if(i=e[n],i&&i.val)return i.val;return null},Rt=function(e,t,n,i){for(var r,a=n;t.length;)r=t.shift(),r in a||(a[r]=new xt),a=a[r],t.length?a=a.next:i?(bt in a.next||(a.next[bt]=new xt),a.next[bt].val=e):a.val=e;return n},Tt=function(e,t,n,i){for(var r,a,l=t,o=n?[n]:null;e.length;){if(r=e.shift(),a=P(l),!e.length)return o&&Ct(o,r)?!0:a&I&&r in l?!0:A===a&&"length"==r?!0:!1;if(a&I&&r in l){if(l=l[r],l instanceof i)return[i,l,e];o&&(o=Et(o,r))}else if(!o||!(o=Et(o,r)))return!1}return!1},St=function(e,t,n,i){for(var r,a,l=t,o=n?[n]:null;e.length;){if(r=e.shift(),a=P(l),!e.length)return o&&(o=Ct(o,r))?[!1,o]:a&I&&r in l?[!0,l[r]]:A===a&&"length"==r?[!0,d(l).length]:!1;if(a&I&&r in l){if(l=l[r],l instanceof i)return[i,l,e];o&&(o=Et(o,r))}else if(!o||!(o=Et(o,r)))return!1}return!1},Vt=function(e,t,n,i,r,a,l){var o,u,s=t,c=null,f=null,d=null;for(l=!1!==l,l&&(c=[n],f=[i],d=[r]);e.length;)if(o=e.shift(),u=P(s),e.length){if(!(u&I&&o in s))return[!1,s,o,e,null,null,null];if(s=s[o],s instanceof a)return[a,s,e,0,null,null,null];l&&(c=Et(c,o),f=Et(f,o),d=Et(d,o))}else if(u&I)return s[o]instanceof a?[a,s[o],e,0,null,null,null]:o in s?[!0,s,o,e,c,f,d]:[!1,s,o,e,c,f,d];return[!1,s,o,e,null,null,null]},Nt=0,At=function(e){return[e||"UUID",++Nt,vt()].join("_")},Dt=function(e,t){var n=[e||"",yt];return t&&(n=n.concat(t)),n.join(".")},Ot={$PB:null,namespace:null,initPubSub:function(){var e=this;return e.$PB=t({}),e},disposePubSub:function(){var e=this;return e.$PB.off(Dt("")),e.$PB=null,e},trigger:function(e,t,n){var i=this;return i.namespace&&(n=n?[i.namespace].concat(n):[i.namespace]),i.$PB.trigger(Dt(e,n),t),i},on:function(e,t,n){var i=this;return z(t,D)&&(i.namespace&&(n=n?[i.namespace].concat(n):[i.namespace]),i.$PB.on(Dt(e,n),t)),i},onTo:function(e,t,n,r){var a=this;return z(n,D)&&(n=i(n,a)),e.on(t,n,r),a},off:function(e,t,n){var i=this;return i.namespace&&(n=n?[i.namespace].concat(n):[i.namespace]),z(t,D)?i.$PB.off(Dt(e,n),t):i.$PB.off(Dt(e,n)),i},offFrom:function(e,t,n,r){var a=this;return z(n,D)&&(n=i(n,a)),e.off(t,n,r),a}};Ot.publish=Ot.trigger;var jt=function(e,t){var n=this,i=arguments.length;n.$store={},n.$size=k,n.$interval=k,i>0&&e>0&&(n.$size=e),i>1&&t>0&&(n.$interval=t)};jt[r]={constructor:jt,$store:null,$size:null,$interval:null,dispose:function(){var e=this;return e.$store=null,e.$size=null,e.$interval=null,e},reset:function(){return this.$store={},this},size:function(e){return arguments.length?(e>0&&(this.$size=e),this):this.$size},interval:function(e){return arguments.length?(e>0&&(this.$interval=e),this):this.$interval},has:function(e){var t=this,n=e?t.$store[e]:null;return!!(n&&vt()-n.time<=t.$interval)},get:function(e){if(e){var t=this,i=t.$store[e];if(i)return vt()-i.time>t.$interval?(delete t.$store[e],n):i.data}return n},set:function(e,t){var n,i,r,a=this;if(e){for(n=a.$store,i=a.$size,r=d(n);r.length>=i;)delete n[r.shift()];n[e]={data:t,time:vt()}}return a},del:function(e){return e&&this.$store[e]&&delete this.$store[e],this},toString:function(){return"[ModelView.Cache]"}};var Mt=function(e){return e.replace(/\[([^\]]*)\]/g,".$1").replace(/^\.+/,"").replace(/\.+$/,"")},Ft=function(e){return"["+e.split(".").join("][")+"]"},It=function(e){var t=new o("^"+e+"([\\.|\\[])");return function(e,n){var i=e.replace(t,"$1");return n?Mt(i):i}},Lt=function(e){return y(this,Lt)?void(this.f=e||null):new Lt(e)},Pt=function(e){return y(this,Pt)?void(this.f=e||null):new Pt(e)},zt=function(e,t){var n,r;for(n in t)r=t[n],y(r,Pt)?(t[n]=i(r.f,e),t[n].fEach=!0):t[n]=i(r,e);return t},Bt=function(e){return e.BEFORE=function(t){return Bt(function(n,i){var r=this;return t.call(r,e.call(r,n,i),i)})},e.AFTER=function(t){return Bt(function(n,i){var r=this;return e.call(r,t.call(r,n,i),i)})},e},Wt=function(e){return e.NOT=function(){return Wt(function(t,n){return!e.call(this,t,n)})},e.AND=function(t){return Wt(function(n,i){var r=this;return e.call(r,n,i)&&t.call(r,n,i)})},e.OR=function(t){return Wt(function(n,i){var r=this;return e.call(r,n,i)||t.call(r,n,i)})},e.XOR=function(t){return Wt(function(n,i){var r=this,a=e.call(r,n,i),l=t.call(r,n,i);return a&&!l||l&&!a})},e},Ht={TypeCaster:Bt,Cast:{EACH:Pt,FIELDS:function(e){var t=!0;return e=$t({},e||{}),Bt(function(n){var i,r,a,l,o;t&&(zt(this,e),t=!1);for(i in e)if(r=e[i],a=n[i],r.fEach&&z(a,N)){for(l=a.length,o=0;l>o;o++)a[o]=r(a[o]);n[i]=a}else n[i]=r(a);return n})},DEFAULT:function(e){return Bt(function(t){var n=P(t);return(M&n||S&n&&!t.tR().length)&&(t=e),t})},BOOL:Bt(function(e){return!!e}),INT:Bt(function(e){return parseInt(e,10)}),FLOAT:Bt(function(e){return parseFloat(e,10)}),MIN:function(e){return Bt(function(t){return e>t?e:t})},MAX:function(e){return Bt(function(t){return t>e?e:t})},CLAMP:function(e,t){if(e>t){var n=t;t=e,e=n}return Bt(function(n){return e>n?e:n>t?t:n})},TRIM:Bt(function(e){return m(e).tR()}),LCASE:Bt(function(e){return m(e).toLowerCase()}),UCASE:Bt(function(e){return m(e).toUpperCase()}),STR:Bt(function(e){return""+e})},add:function(e,t){return z(e,S)&&z(t,D)&&(Ht.Cast[e]=Bt(t)),Ht},del:function(e){return z(e,S)&&Ht.Cast[e]&&delete Ht.Cast[e],Ht},toString:function(){return"[ModelView.Type]"}},qt={Validator:Wt,Validate:{EACH:Pt,FIELDS:function(e){var t=!0;return e=$t({},e||{}),Wt(function(n){var i,r,a,l,o;t&&(zt(this,e),t=!1);for(i in e)if(r=e[i],a=n[i],r.fEach&&z(a,N)){for(l=a.length,o=0;l>o;o++)if(!r(a[o]))return!1}else if(!r(a))return!1;return!0})},NUMERIC:Wt(function(e){return wt(e)}),NOT_EMPTY:Wt(function(e){return!!(e&&0<m(e).tR().length)}),MAXLEN:function(e){return Wt(w("v","return v.length <= "+e+";"))},MINLEN:function(e){return Wt(w("v","return v.length >= "+e+";"))},MATCH:function(e){return Wt(function(t){return e.test(t)})},NOT_MATCH:function(e){return Wt(function(t){return!e.test(t)})},EQUAL:function(e,t){return Wt(y(e,Lt)?w("v","return this.$data."+e.f+" "+(!1!==t?"===":"==")+" v;"):!1!==t?function(t){return e===t}:function(t){return e==t})},NOT_EQUAL:function(e,t){return Wt(y(e,Lt)?w("v","return this.$data."+e.f+" "+(!1!==t?"!==":"!=")+" v;"):!1!==t?function(t){return e!==t}:function(t){return e!=t})},GREATER_THAN:function(e,t){return y(e,Lt)?e="this.$data."+e.f:z(e,S)&&(e='"'+e+'"'),Wt(w("v","return "+e+" "+(!1!==t?"<":"<=")+" v;"))},LESS_THAN:function(e,t){return y(e,Lt)?e="this.$data."+e.f:z(e,S)&&(e='"'+e+'"'),Wt(w("v","return "+e+" "+(!1!==t?">":">=")+" v;"))},BETWEEN:function(e,t,n){z(e,N)&&(n=t,t=e[1],e=e[0]);var i,r=y(e,Lt),a=y(t,Lt);return!r&&!a&&e>t&&(i=t,t=e,e=i),e=r?"this.$data."+e.f:z(e,S)?'"'+e+'"':e,t=a?"this.$data."+t.f:z(t,S)?'"'+t+'"':t,Wt(!1!==n?w("v","return ( "+e+" < v ) && ( "+t+" > v );"):w("v","return ( "+e+" <= v ) && ( "+t+" >= v );"))},NOT_BETWEEN:function(e,t,n){z(e,N)&&(n=t,t=e[1],e=e[0]);var i,r=y(e,Lt),a=y(t,Lt);return!r&&!a&&e>t&&(i=t,t=e,e=i),e=r?"this.$data."+e.f:z(e,S)?'"'+e+'"':e,t=a?"this.$data."+t.f:z(t,S)?'"'+t+'"':t,Wt(!1!==n?w("v","return ( "+e+" > v ) || ( "+t+" < v );"):w("v","return ( "+e+" >= v ) || ( "+t+" <= v );"))},IN:function(){var e=b(arguments);return z(e[0],N)&&(e=e[0]),Wt(function(t){return-1<e.indexOf(t)})},NOT_IN:function(){var e=b(arguments);return z(e[0],N)&&(e=e[0]),Wt(function(t){return 0>e.indexOf(t)})}},add:function(e,t){return z(e,S)&&z(t,D)&&(qt.Validate[e]=Wt(t)),qt},del:function(e){return z(e,S)&&qt.Validate[e]&&delete qt.Validate[e],qt},toString:function(){return"[ModelView.Validation]"}},Ut=function(e,t,n,r){var a,l,o=!1;if(l=P(n),D&l)o=y(n,Pt),n=o?i(n.f,e):i(n,e),Rt(n,-1<t.indexOf(".")?t.split("."):[t],r,o);else if(I&l)for(a in n)Ut(e,t+"."+a,n[a],r)},Jt=function(e,t,n,r){var a,l;if(l=P(n),D&l)Rt(i(n,e),-1<t.indexOf(".")?t.split("."):[t],r);else if(I&l)for(a in n)Jt(e,t+"."+a,n[a],r)},Yt=function(e,t,n){for(var i,r;t instanceof e;)t=t.data();if(r=n||P(t),t=A&r?$t({},t):N&r?t.slice(0):t,I&r)for(i in t)t[i]instanceof e?t[i]=Yt(e,$t({},t[i].data())):I&(r=P(t[i]))&&(t[i]=Yt(e,t[i],r));return t},Kt=function(e,t,n,i,r,a){var l=this;return l instanceof Kt?(l.namespace=l.id=e||At("Model"),l.key=It(l.id),l.$view=null,l.atomic=!1,l.$atom=null,l.$types={},l.$validators={},l.$getters={},l.$setters={},void l.data(t||{}).types(n).validators(i).getters(r).setters(a).initPubSub()):new Kt(e,t,n,i,r,a)};Kt[r]=_t(f(s[r]),Ot,{constructor:Kt,id:null,$view:null,$data:null,$types:null,$validators:null,$getters:null,$setters:null,atomic:!1,$atom:null,dispose:function(){var e=this;return e.disposePubSub().$view=null,e.$data=null,e.$types=null,e.$validators=null,e.$getters=null,e.$setters=null,e.atomic=!1,e.$atom=null,e.key=null,e},isValid:function(){return!0},view:function(e){var t=this;return arguments.length?(t.$view=e,t):t.$view},data:function(e){var t=this;return arguments.length?(t.$data=e,t):t.$data},types:function(e){var t,n=this;if(z(e,A))for(t in e)Ut(n,t,e[t],n.$types);return n},validators:function(e){var t,n=this;if(z(e,A))for(t in e)Ut(n,t,e[t],n.$validators);return n},getters:function(e){var t,n=this;if(z(e,A))for(t in e)Jt(n,t,e[t],n.$getters);return n},setters:function(e){var t,n=this;if(z(e,A))for(t in e)Jt(n,t,e[t],n.$setters);return n},serialize:function(){return Yt(Kt,this.$data)},toJSON:function(e){var t,n,i,r=this;n=arguments.length?r.get(e):r.data();try{t=mt(Yt(Kt,n))}catch(i){throw i}return t},fromJSON:function(e,t){var n,i,r=this;if(e){try{n=pt(e)}catch(i){throw i}t?r.set(t,n):r.data(n)}return r},count:function(e,t){if(!arguments.length)return 0;var n=e?this.get(e):t,i=P(n);return A===i?d(n).length:N===i?n.length:M!==i?1:0},has:function(e,t){var n,i=this;return 0>e.indexOf(".")&&(e in i.$data||!t&&(n=i.$getters[e])&&n.val)?!0:(n=Tt(e.split("."),i.$data,t?null:i.$getters,Kt))?!0===n?!0:n[1].has(n[2].join(".")):!1},get:function(e,t){var i,r=this;return 0>e.indexOf(".")?!t&&(i=r.$getters[e])&&i.val?i.val(e):r.$data[e]:(i=St(e.split("."),r.$data,t?null:r.$getters,Kt))?Kt===i[0]?i[1].get(i[2].join("."),t):!1===i[0]?i[1](e):i[1]:n},set:function(e,t,n,i){var r,a,l,o,u,s,c,f,d,h,p=this,m=!1;if(p.atomic&&e.sW(p.$atom))return p;if(a=p.$data,c=p.$types,f=p.$validators,d=p.$setters,0>e.indexOf("."))l=e,s=(r=d[l])?r.val:null,o=(r=c[l]||c[bt])?r.val:null,u=(r=f[l]||f[bt])?r.val:null,m=!0;else if(r=Vt(e.split("."),a,c,f,d,Kt)){if(a=r[1],l=r[2],o=Ct(r[4],l),u=Ct(r[5],l),s=Ct(r[6],l),Kt===r[0])return l.length?(l=l.join("."),h=a.get(l),h!==t?a.set(l,t,n,i):n=!1):(h=a.data(),h!==t?a.data(t):n=!1),n&&p.publish("change",{model:p,key:e,value:t,valuePrev:h,$callData:i}),p;if(!s&&!1===r[0]&&r[3].length)return p;m=!0}if(m){if(o&&(t=o(t,e)),u&&!u(t,e))return n&&(i&&(i.error=!0),p.publish("error",{model:p,key:e,value:a[l],$callData:i})),p;if(s)return s(e,t)&&(n&&p.publish("change",{model:p,key:e,value:t,$callData:i}),p.$atom&&e===p.$atom&&(p.atomic=!0)),p;h=a[l],h!==t&&(a[l]=t,n&&p.publish("change",{model:p,key:e,value:t,valuePrev:h,$callData:i}),p.$atom&&e===p.$atom&&(p.atomic=!0))}return p},append:function(e,t,i,r){var a,l,o,u,s,c,f=this,d=!1;if(f.atomic&&e.sW(f.$atom))return f;if(l=f.$data,types=f.$types,validators=f.$validators,setters=f.$setters,0>e.indexOf("."))o=e,c=(a=setters[o])&&a.next[bt]?a.next[bt].val:null,u=(a=types[o]||types[bt])&&a.next[bt]?a.next[bt].val:null,s=(a=validators[o]||validators[bt])&&a.next[bt]?a.next[bt].val:null,d=!0;else if(a=Vt(e.split("."),l,types,validators,setters,Kt)){if(l=a[1],o=a[2],u=Ct(Et(a[4],o),bt),s=Ct(Et(a[5],o),bt),c=Ct(Et(a[6],o),bt),Kt===a[0])return o.length?(o=o.join("."),l.append(o,t,i,r)):l.data(t),i&&f.publish("change",{model:f,key:e,value:t,$callData:r}),f;if(!c&&!1===a[0]&&a[3].length)return f;d=!0}if(d){if(u&&(t=u(t,e)),s&&!s(t,e))return i&&(r&&(r.error=!0),f.publish("error",{model:f,key:e,value:n,$callData:r})),f;if(c)return c(e,t)&&(i&&f.publish("change",{model:f,key:e,value:t,$callData:r}),f.$atom&&e===f.$atom&&(f.atomic=!0)),f;N===P(l[o])?l[o].push(t):l[o]=t,i&&f.publish("change",{model:f,key:e,value:t,$callData:r}),f.$atom&&e===f.$atom&&(f.atomic=!0)}return f},del:function(e,t,n){var i,r,a,l,o=this,u=!1;if(o.atomic&&e.sW(o.$atom))return o;if(r=o.$data,0>e.indexOf("."))a=e,u=!0;else if(i=Vt(e.split("."),r,null,null,null,Kt,!1)){if(r=i[1],a=i[2],Kt===i[0]&&a.length)return a=a.join("."),l=r.get(a),r.del(a,t,n),t&&o.publish("remove",{model:o,key:e,value:l,$callData:n}),o.$atom&&e===o.$atom&&(o.atomic=!0),o;if(i[3].length)return o;u=!0}return u&&(l=r[a],delete r[a],t&&o.publish("remove",{model:o,key:e,value:l,$callData:n}),o.$atom&&e===o.$atom&&(o.atomic=!0)),o},rem:function(e,t,i){var r,a,l,o,u,s=this,c=!1;if(s.atomic&&e.sW(s.$atom))return s;if(a=s.$data,0>e.indexOf("."))l=e,c=!0;else if(r=Vt(e.split("."),a,null,null,null,Kt,!1)){if(a=r[1],l=r[2],Kt===r[0]&&l.length)return l=l.join("."),o=a.get(l),a.rem(l,t,i),t&&s.publish("remove",{model:s,key:e,value:o,$callData:i}),s.$atom&&e===s.$atom&&(s.atomic=!0),s;if(r[3].length)return s;c=!0}return c&&(o=a[l],a[l]=n,u=P(a),N==u&&kt(l)?a.splice(+l,1):A==u&&delete a[l],t&&s.publish("remove",{model:s,key:e,value:o,$callData:i}),s.$atom&&e===s.$atom&&(s.atomic=!0)),s},notify:function(e,t,n){return e&&this.publish(t||"change",{model:this,key:e,$callData:n}),this},atom:function(e){var t=this;return n!==e&&(!1===e?(t.atomic=!1,t.$atom=null):(t.atomic=!1,t.$atom=e)),t},toString:function(){return"[ModelView.Model id: "+this.id+"]"}});var Qt=function(e){return new o(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace("__KEY__","(\\S+?)"),"")},Xt=function(e){var t,n="",i=e.length;for(t=0;i>t;t++)n+=e[t].nodeValue;return n},Zt=function(e,t,n){n=n||[null,null];var i,r,a,l,o,u,s,c,f,d,h,p,m,v,g,$=n[0]||{},b=n[1]||{};if(e){if(i=[],r=[],s=e,s.attributes&&(l=s.attributes.length))for(a=0;l>a;a++)c=s.attributes[a],(o=c.nodeValue.match(t))&&r.push([c,o]);if(3===s.nodeType)(o=s.nodeValue.match(t))&&i.push([s,o,null]);else if(s.firstChild)for(g=[s=s.firstChild];g.length;){if(s.attributes&&(l=s.attributes.length))for(a=0;l>a;a++)c=s.attributes[a],(o=c.nodeValue.match(t))&&r.push([c,o]);if(s.firstChild)g.push(s=s.firstChild);else{for(3===s.nodeType&&(o=s.nodeValue.match(t))&&i.push([s,o]),s=g.pop();g.length&&!s.nextSibling;)s=g.pop();s.nextSibling&&g.push(s=s.nextSibling)}}for(a=0,l=i.length;l>a;a++){u=i[a],v=u[0],o=u[1];do f=o[1],d=v.splitText(o.index),v=d.splitText(o[0].length),($[f]=$[f]||[]).push(d),o=v.nodeValue.match(t);while(o)}for(h={},a=0,l=r.length;l>a;a++)if(u=r[a],c=u[0],o=u[1],m=c.nodeValue,p=m in h)for(o=0;o<h[m][0].length;o++)b[h[m][0][o]].push([c,h[m][1]]);else{v=rt(m),h[m]=[[],[v]];do f=o[1],d=v.splitText(o.index),v=d.splitText(o[0].length),h[m][0].push(f),h[m][1].push(d),h[m][1].push(v),($[f]=$[f]||[]).push(d),(b[f]=b[f]||[]).push([c,h[m][1]]),o=v.nodeValue.match(t);while(o)}}return n[0]=$,n[1]=b,n},Gt=function(e,t,n){return[e?"["+e+"]":null,t?n?'input[name="'+t+'"],textarea[name="'+t+'"],select[name="'+t+'"]':'input[name^="'+t+'"],textarea[name^="'+t+'"],select[name^="'+t+'"]':null]},en=function(e,t){return t&&t[e]?(z(t[e],S)&&(t[e]={action:t[e]}),t[e]):void 0},tn=function(e,n,i,r){var a=e.$model,l="sync"==i.type,o=l?"change":i.type;n.each(function(){var n,l,u,s,c=this,f=t(c);n=en(o,e.attr(c,"bind")),n&&n.action&&(l="do_"+n.action,z(e[l],D)&&(u=c[J],s=n.key||!!u&&a.key(u,1),r&&(!s||!s.sW(r.key)||a.atomic&&s.sW(a.$atom))||e[l](i,f,n)))})},nn=function(e,n,i){{var r=e.$model,a={},l="sync"==i.type;l?"change":i.type}n.each(function(){var n,l=this,o=t(l),u=l[J],s=u?r.key(u,1):0;if(s){if(a[s])n=a[s][0];else{if(!r.has(s))return;a[s]=[n=r.get(s)]}e.do_bind(i,o,{name:u,key:s,value:n})}})},rn=function(e,t,n){var i,r,a,l,o,u,s,c=e.$model,f=e.$keynodes[0],h=e.$keynodes[1];if(t){if(r=f[t])for(n=""+n,i=0,a=r.length;a>i;i++)r[i].nodeValue=n;if(r=h[t])for(i=0,a=r.length;a>i;i++)r[i][0].nodeValue=Xt(r[i][1]);for(l=d(f),o=0,s=l.length;s>o;o++)if(u=l[o],t!==u&&u.sW(t)&&(r=f[u]).length)for(n=""+c.get(u),i=0,a=r.length;a>i;i++)r[i].nodeValue=n;for(l=d(h),o=0,s=l.length;s>o;o++)if(u=l[o],t!==u&&u.sW(t)&&(r=h[u]).length)for(i=0,a=r.length;a>i;i++)r[i][0].nodeValue=Xt(r[i][1])}else{for(l=d(f),o=0,s=l.length;s>o;o++)if(u=l[o],(r=f[u])&&(a=r.length))for(n=""+c.get(u),i=0;a>i;i++)r[i].nodeValue=n;for(l=d(h),o=0,s=l.length;s>o;o++)if(u=l[o],(r=h[u])&&(a=r.length))for(i=0;a>i;i++)r[i][0].nodeValue=Xt(r[i][1])}},an=function(e,t,n,i,r){var a=this;return a instanceof an?(a.namespace=a.id=e||At("View"),"bind"in(n=n||{})||(n.bind="data-bind"),a.$atts=n,i=i||an._CACHE_SIZE,r=r||an._REFRESH_INTERVAL,a.$memoize=new jt(i,r),a.$selectors=new jt(i,r),a.$bind=a.attribute("bind"),void a.inlineTplFormat("$(__KEY__)").model(t||new Kt).initPubSub()):new an(e,t,n,i,r)};an._CACHE_SIZE=600,an._REFRESH_INTERVAL=k,an[r]=_t(f(s[r]),Ot,{constructor:an,id:null,$dom:null,$bind:null,$model:null,$bindbubble:!1,$autobind:!1,$template:null,$atts:null,$memoize:null,$selectors:null,$keynodes:null,$inlineTplFormat:null,dispose:function(){var e=this;return e.unbind().disposePubSub(),e.$model&&e.$model.dispose(),e.$model=null,e.$dom=null,e.$bind=null,e.$template=null,e.$atts=null,e.$memoize.dispose(),e.$memoize=null,e.$selectors.dispose(),e.$selectors=null,e.$keynodes=null,e.$inlineTplFormat=null,e},model:function(e){var t=this;return arguments.length?(t.$model&&t.$model.dispose(),t.$model=e.view(t),t):t.$model},attribute:function(e,t){var i=this;return arguments.length>1?(i.$atts[e]=t,i):e?i.$atts[e]||n:n},inlineTplFormat:function(e){return this.$inlineTplFormat=e,this},template:function(e){var t=this;return arguments.length?(z(e,D)&&(t.$template=e),t):t.$template},event:function(e,t){var i=this,r=e?"on_"+e.split(":").join("_"):null;return r&&n!==t?(i[r]=z(t,D)?t:null,i):r?i[r]:n},action:function(e,t){var n=this,i=e&&"do_"+e;return arguments.length>1?(n[i]=z(t,D)?t:null,n):i&&n[i]},bindbubble:function(e){var t=this;return arguments.length?(t.$bindbubble=!!e,t):t.$bindbubble},autobind:function(e){var t=this;return arguments.length?(t.$autobind=!!e,t):t.$autobind},get:function(e,n,i){var r,a=this,l=a.$selectors;return n=n?t(n):a.$dom,i?n.find(e):(r=l.get(e),r||l.set(e,r=n.find(e)),r)},attr:function(e,t){var i,r,a=this,l=a.$atts[t],o=a.$memoize;return(l=e[B](l))?(i=o.get(l),n===i&&(i=pt(l),i.set&&(i.click=i.set,i.click.action="set",i.set=n,delete i.set),i.show&&(i.change={action:"show",key:i.show},i.show=n,delete i.show),i.hide&&(i.change={action:"hide",key:i.hide},i.hide=n,delete i.hide),i.html?(i.change={action:"html",key:i.html},i.html=n,delete i.html,i.text=n,delete i.text):i.text&&(i.change={action:"html",key:i.text,text:1},i.text=n,delete i.text),i.css&&(i.change={action:"css",css:i.css},i.css=n,delete i.css),i.value&&(i.change&&"prop"==i.change.action?i.change.prop.value=i.value:i.change={action:"prop",prop:{value:i.value}},i.value=n,delete i.value),i.checked&&(i.change&&"prop"==i.change.action?i.change.prop.checked=i.checked:i.change={action:"prop",prop:{checked:i.checked}},i.checked=n,delete i.checked),i.disabled&&(i.change&&"prop"==i.change.action?i.change.prop.disabled=i.disabled:i.change={action:"prop",prop:{disabled:i.disabled}},i.disabled=n,delete i.disabled),i.options&&(i.change&&"prop"==i.change.action?i.change.prop.options=i.options:i.change={action:"prop",prop:{options:i.options}},i.options=n,delete i.options),i["class"]&&(i.change&&"prop"==i.change.action?i.change.prop["class"]=i["class"]:i.change={action:"prop",prop:{"class":i["class"]}},i["class"]=n,delete i["class"]),(r=i.change)&&(!r.domRef&&i.domRef&&(r.domRef=i.domRef),!r.key&&i.key&&(r.key=i.key)),o.set(l,i)),i):n},getDomRef:function(e,n){return n&&n.sW("$this::")?t(n.slice(7),e):t(n)},bind:function(e,n){var i,r,a,l=this,o=l.$model,u=Gt(l.$bind,o.id+"["),s=u[0],c=u[1],f=/^on_model_/;e=e||["change","click"],l.$dom=t(n||window.document),l.on_view_change&&e.length&&(a=function(e){return Dt(e,l.namespace)},l.$dom.on(e.map(a).join(" "),[c,s].join(","),function(e){var n=this,i=t(n),r=!1,a=!1,o=l.$bindbubble?l.attr(n,"bind"):null;return(e.target===n||o&&o.bubble)&&(a=l.$bindbubble?!!o:i.is(s),r=l.$autobind&&"change"==e.type&&i.is(c),(a||r)&&l.on_view_change(e,{$el:i,isBind:a,isAutoBind:r})),!0}));for(i in l)z(l[i],D)&&f.test(i)&&(r=i.replace(f,""),r.length&&l.onTo(o,r,l[i],l.namespace));return l.$keynodes=Zt(l.$dom[0],Qt(l.$inlineTplFormat)),l},unbind:function(e,n){var i,r,a=this,l=a.$model,o=Gt(a.$bind,l.id+"[");return e=e||null,r=n?t(n):a.$dom,a.on_view_change&&(i=function(e){return Dt(e,a.namespace)},r.off(e&&e.length?e.map(i).join(" "):Dt("",a.namespace),[o[1],o[0]].join(","))),a.offFrom(l,"",null,a.namespace),a.$keynodes=null,a},rebind:function(e,t){var n=this;return n.$memoize.reset(),n.$selectors.reset(),n.unbind().bind(e,t)},sync:function(e){var n=this,i=Gt(n.$bind,n.$model.id+"["),r=gt("sync");return e=e?t(e):n.$dom,tn(n,n.get(i[0],e,1),r),rn(n),n.$autobind&&nn(n,n.get(i[1],e,1),r),n},reset:function(){var e=this;return e.$memoize.reset(),e.$selectors.reset(),e},on_view_change:function(e,t){var n,i,r,a,l=this,o=l.$model,u=t.$el,s=u[0],c={};t.isAutoBind&&(n=s[J])&&(i=o.key(n,1),i&&o.has(i)&&("checkbox"===s[K].toLowerCase()?(a=l.get('input[type="checkbox"][name="'+n+'"]'),a.length>1?(r=[],a.each(function(){var e=this;r.push(e[H]?e[Q]:"")})):r=s[H]?s[Q]:""):r=st(s),c.$trigger=u,o.set(i,r,1,c))),!c.error&&t.isBind&&tn(l,u,e),l.publish("change",t)},on_model_change:function(e,t){var n,i,r=this,a=r.$model,l=Gt(r.$bind,a.id+Ft(t.key)),o=r.$autobind;n=r.get(l[0]),o&&(i=r.get(l[1])),t.$callData&&t.$callData.$trigger&&(n=n.not(t.$callData.$trigger),o&&(i=i.not(t.$callData.$trigger)),t.$callData=null),tn(r,n,e,t),rn(r,t.key,t.value),o&&i.length&&nn(r,i,e,t)},on_model_error:function(e,t){var n=this,i=n.$model,r=Gt(n.$bind,i.id+Ft(t.key));tn(n,n.get(r[0]),e,t),rn(n,t.key,t.value),n.$autobind&&nn(n,n.get(r[1]),e,t)},do_nop:null,do_prop:function(e,t,n){if(z(n.prop,A)){var i,r,a,l,o,u=this,s=u.$model,c=n.prop;if(n.domRef&&(t=u.getDomRef(t,n.domRef)),t.length){o=t[0];for(i in c)if(r=c[i],s.has(r))switch(a=s.get(r),l=P(a),i){case"value":ct(o,a);break;case"checked":case"disabled":o[i]=T===l?a:m(a)==o[Q];break;case"options":if("select"===o[Y]&&N===l){var f,d,h=a.length,p="",v=t.find("optgroup");for(f=t.val(),v.length||(v=t),v.find("option").remove(),d=0;h>d;d++)p+=a[d]&&a[d].label?'<option value="'+a[d].value+'">'+a[d].label+"</option>":'<option value="'+a[d]+'">'+a[d]+"</option>";v.append(p),t.val(f)}break;case"class":if(a&&a.length){var g,$=a.charAt(0);"-"==$?t.removeClass(a.slice(1)):"+"==$?t.addClass(a.slice(1)):(g=t.hasClass(a))?t.removeClass(a):g||t.addClass(a)}break;default:o[W](i,a)}}}},do_html:function(e,t,n){if(n.key){var i,r=this,a=r.$model,l=n.key;n.domRef&&(t=r.getDomRef(t,n.domRef)),t.length&&l&&a.has(l)&&((i=t[0])[n.text?it in i?it:nt:tt]=a.get(l))}},do_css:function(e,t,n){if(z(n.css,A)){var i,r,a,l,o=this,u=o.$model,s=n.css;if(n.domRef&&(t=o.getDomRef(t,n.domRef)),t.length){l={};for(r in s)i=s[r],a=u.get(i),a&&(l[r]=a);t.css(l)}}},do_set:function(e,t,n){var i,r=this,a=r.$model,l=n.key||a.key(t[0][J],1);l&&("value"in n?i=n.value:(n.domRef&&(t=r.getDomRef(t,n.domRef)),i=st(t[0])),a.set(l,i,1))},do_tpl:function(e,t,n){var i,r,a,l,o=this,u=n.key,s=n.tpl;o.$template&&u&&s&&(n.domRef&&(t=o.getDomRef(t,n.domRef)),t.length&&(i=o.$model,u&&i.has(u)&&(r=n.mode||"replace",l=t[0],"replace"==r&&(l[tt]=""),a=o.$template(s,i.get(u)),a&&(l[tt]+=a))))},do_show:function(e,t,n){var i,r=this,a=r.$model,l=n.key;n.domRef&&(t=r.getDomRef(t,n.domRef)),t.length&&l&&(i=t[0],"value"in n?n.value===a.get(l)?dt(i):ht(i):a.get(l)?dt(i):ht(i))},do_hide:function(e,t,n){var i,r=this,a=r.$model,l=n.key;n.domRef&&(t=r.getDomRef(t,n.domRef)),t.length&&l&&(i=t[0],"value"in n?n.value===a.get(l)?ht(i):dt(i):a.get(l)?ht(i):dt(i))},do_bind:function(e,t,n){var i,r,a=this,l=(a.$model,n.name),o=n.key,u=t[0],s=u[K].toLowerCase();if(o)if(i=n.value,r=P(i),"radio"===s)m(i)==u[Q]&&(a.get('input[name="'+l+'"]').not(u).prop("checked",!1),u[H]=!0);else if("checkbox"===s){var c=a.get('input[type="checkbox"][name="'+l+'"]');c.length>1&&N===r?c.each(function(){var e=this;e[H]=-1<i.indexOf(e[Q])?!0:!1}):u[H]=T===r?i:m(i)==u[Q]}else ct(u,i)},toString:function(){return"[ModelView.View id: "+this.id+"]"}}),e.ModelView={VERSION:"0.30.2",UUID:At,Extend:_t,Field:Lt,Type:Ht,Validation:qt,Cache:jt,Model:Kt,View:an}}(e,t),!function(e,t){"use strict";var n=Function.prototype.call.bind(Array.prototype.slice),i=t.extend,r=e.View,a=e.Model,l={id:"model",data:{},types:{},validators:{},getters:{},setters:{}},o={viewClass:r,modelClass:a,id:"view",autoSync:!0,autobind:!1,bindbubble:!1,bindAttribute:"data-bind",inlineTplFormat:"$(__KEY__)",cacheSize:r._CACHE_SIZE,refreshInterval:r._REFRESH_INTERVAL,model:null,template:null,events:null,actions:{},handlers:{}};t.ModelView=e,t.fn.modelview=function(e){var r=n(arguments),u=r.length?r.shift():null,s=!0,c=!1,f=[];return this.each(function(){var n,d,h,p=t(this);if(p.data("modelview")){if(s=!1,d=p.data("modelview"),n=d.$model,"view"===u)f.push(d);else if("model"===u){if(r.length)return n.apply(d,r),this;f.push(n)}else if("data"===u){if(r.length)return n.data.apply(d.$model,r),this;f.push(n.data())}else"dispose"===u?(p.data("modelview",null),d.dispose()):"sync"===u?d.sync.apply(d,r):"refresh"===u&&d.refresh.apply(d,r);return this}if(c||(e=i({},o,e),!e.model||e.model instanceof a||(e.model=i({},l,e.model)),c=!0),!e.model)return this;if(n=e.model instanceof a?e.model:new e.modelClass(e.model.id,e.model.data,e.model.types,e.model.validators,e.model.getters,e.model.setters),d=new e.viewClass(e.id,n,{bind:e.bindAttribute||"data-bind"},e.cacheSize,e.refreshInterval),e.template&&d.template(e.template),e.handlers)for(var m in e.handlers)h=e.handlers[m],h&&d.event(m,h);if(e.actions)for(var v in e.actions)h=e.actions[v],h&&d.action(v,h);p.data("modelview",d),d.inlineTplFormat(e.inlineTplFormat).bindbubble(e.bindbubble).autobind(e.autobind).bind(e.events,p),e.autoSync&&d.sync()}),!s&&f.length?1==this.length?f[0]:f:this},t.widget&&t.widget("ModelView",{options:{},$view:null,_create:function(){var e=this;e.element.modelview(e.options),e.$view=e.element.modelview("view")},value:function(e,t){var n=this;return 1<arguments.length?(n.$view.$model.set(e,t,!0),n.element):n.$view.$model.get(e)},_destroy:function(){var e=this.self.$view=null;e.element.modelview("dispose")}})}(e.ModelView,t),e.ModelView});
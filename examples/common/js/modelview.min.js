/**
*
*   ModelView.js
*   @version: 0.22
*   @dependencies: jQuery
*
*   A micro-MV* (MVVM) jQuery-based framework for complex (UI) screens
*   https://github.com/foo123/modelview.js
*
**/!function(e,t,n,i,r){"use strict";n=n?[].concat(n):[];var a,o,u=Array,l=u.prototype,s=n.length,c=new u(s);if("object"==typeof module&&module.exports){if(r===module.exports[t]){for(a=0;s>a;a++)c[a]=module.exports[n[a][0]]||require(n[a][1])[n[a][0]];o=i.apply(e,c),module.exports[t]=o||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(n.map(function(e){return e[1]})),function(a){if(r===a[t]){var u,s=l.slice.call(arguments,1),d=s.length;for(u=0;d>u;u++)c[u]=a[n[u][0]]||s[u];o=i.apply(e,c),a[t]=o||1}});else if(r===e[t]){for(a=0;s>a;a++)c[a]=e[n[a][0]];o=i.apply(e,c),e[t]=o||1}}(this,"ModelView",[["jQuery","jquery"]],function(e){var t={};return!function(e,t,n){"use strict";var i=Array.prototype,r=Object.prototype,a=Function.prototype,o=(a.call.bind(r.hasOwnProperty),a.call.bind(r.toString)),u=a.call.bind(i.slice),l=Object.keys,s=(Math.random,2),c=3,d=4,f=8,h=9,m=16,v=32,g=64,$=128,b=256,y=512,_=1024,k={options:1,html:2,text:3,"class":4,value:5,checked:6,disabled:7},E=function(e){var t=typeof e,i=o(e);return n===e||"undefined"===t?y:"number"===t||e instanceof Number?isNaN(e)?c:s:null===e?b:!0===e||!1===e?d:"string"===t||e instanceof String?1===e.length?h:f:"[object Array]"===i||e instanceof Array?m:"[object RegExp]"===i||e instanceof RegExp?$:"function"===t&&"[object Function]"===i||e instanceof Function?g:"[object Object]"===i?v:_},w=Object.create,C=function(){var e,t,n,i,r,a,o,l=u(arguments);for(t=l.shift()||{},e=l.length,a=0;e>a;a++)if(n=l[a],v===E(n))for(r in n)i=n[r],o=E(i),t[r]=s&o?0+i:(f|m)&o?i.slice(0):i;return t},O=function(e,t){return!!(t&E(e))},A=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},R=function(e){return A(e)&&(e=+e,0===e%1&&e>=0)?!0:!1},L=function(e,t){return n!==e.attr(t)},T=function(e,t){return t===e.substr(0,t.length)},N=function(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")},x=function(e,t){return t.replace(new RegExp("^"+e+"([\\.|\\[])"),"$1")},I=function(e){return"["+e+"]"},S=function(e,t){return null==e?n:(e=""+e,t?e.replace(/\.+$/,"").replace(/^\./,"").split(".").map(I).join(""):e.replace(/\[([^\]]*)\]/g,".$1").replace(/^\./,"").replace(/\.+$/,""))},V=JSON.parse,M=JSON.stringify,j=t.extend,D=function(){return(new Date).getTime()},H="*",F=function(e,t,n,i){for(var r,a=n;t.length;)r=t.shift(),r in a||(a[r]={value:null,next:{}}),a=a[r],t.length?a=a.next:i?(H in a.next||(a.next[H]={value:null,next:{}}),a.next[H].value=e):a.value=e;return n},P=function(e,t){if(!e)return null;var n,i,r=[],a=e.length;for(n=0;a>n;n++)i=e[n],i&&(i[t]&&r.push(i[t].next),i[H]&&r.push(i[H].next));return r.length?r:null},z=function(e,t){if(!e)return null;var n,i,r=e.length;if(t){for(n=0;r>n;n++)if(i=e[n]){if(i[t]&&O(i[t].value,g))return i[t].value;if(i[H]&&O(i[H].value,g))return i[H].value}}else for(n=0;r>n;n++)if(i=e[n],i&&O(i.value,g))return i.value;return null},B=function(e,t,n,i){for(var r,a,o=t,u=[n];e.length;){if(r=e.shift(),a=E(o),!e.length)return z(u,r)?!0:a&(v|m)&&r in o?!0:v===a&&"length"==r?!0:!1;if(a&(v|m)&&r in o){if(o=o[r],o instanceof i)return[i,o,e];u=P(u,r)}else if(u=P(u,r),!u)return!1}return!1},U=function(e,t,n,i){for(var r,a,o=t,u=[n];e.length;){if(r=e.shift(),a=E(o),!e.length)return(u=z(u,r))?[!1,u]:a&(v|m)&&r in o?[!0,o[r]]:v===a&&"length"==r?[!0,l(o).length]:!1;if(a&(v|m)&&r in o){if(o=o[r],o instanceof i)return[i,o,e];u=P(u,r)}else if(u=P(u,r),!u)return!1}return!1},W=function(e,t,n,i,r,a,o){var u,l,s=t,c=null,d=null,f=null;for(o=!1!==o,o&&(c=[n],d=[i],f=[r]);e.length;)if(u=e.shift(),l=E(s),e.length){if(!(l&(v|m)&&u in s))return[!1,s,u,e,null,null,null];if(s=s[u],s instanceof a)return[a,s,e,0,null,null,null];o&&(c=P(c,u),d=P(d,u),f=P(f,u))}else if(l&(v|m))return s[u]instanceof a?[a,s[u],e,0,null,null,null]:u in s?[!0,s,u,e,c,d,f]:[!1,s,u,e,c,d,f];return[!1,s,u,e,null,null,null]},J=function(e,t){var n=this,i=arguments.length;n.$store={},n.$size=1/0,n.$interval=1/0,i>0&&e>0&&(n.$size=e),i>1&&t>0&&(n.$interval=t)};J.prototype={constructor:J,$store:null,$size:null,$interval:null,dispose:function(){var e=this;return e.$store=null,e.$size=null,e.$interval=null,e},reset:function(){return this.$store={},this},size:function(e){return arguments.length?(e>0&&(this.$size=e),this):this.$size},interval:function(e){return arguments.length?(e>0&&(this.$interval=e),this):this.$interval},has:function(e){var t=this,n=e?t.$store[e]:null;return!!(n&&D()-n.time<=t.$interval)},get:function(e){if(e){var t=this,i=t.$store[e];if(i)return D()-i.time>t.$interval?(delete t.$store[e],n):i.data}return n},set:function(e,t){var n,i,r,a=this;if(e){for(n=a.$store,i=a.$size,r=l(n);r.length>=i;)delete n[r.shift()];n[e]={data:t,time:D()}}return a},del:function(e){return e&&this.$store[e]&&delete this.$store[e],this},toString:function(){return"[ModelView.Cache]"}};var Q=0,G="modelview",Z=function(e){return[e||"UUID",++Q,(new Date).getTime()].join("_")},q=t.Event,X=function(e,t){var n=[e||"",G];return t&&(n=n.concat(t)),n.join(".")},Y={$PB:null,namespace:null,initPubSub:function(){return this.$PB=t({}),this},disposePubSub:function(){return this.$PB.off(X("")),this.$PB=null,this},trigger:function(e,t,n){return this.namespace&&(n=n?[this.namespace].concat(n):[this.namespace]),this.$PB.trigger(X(e,n),t),this},on:function(e,t,n){return O(t,g)&&(this.namespace&&(n=n?[this.namespace].concat(n):[this.namespace]),this.$PB.on(X(e,n),t)),this},onTo:function(e,t,n,i){return O(n,g)&&(n=n.bind(this)),e.on(t,n,i),this},off:function(e,t,n){return this.namespace&&(n=n?[this.namespace].concat(n):[this.namespace]),O(t,g)?this.$PB.off(X(e,n),t):this.$PB.off(X(e,n)),this},offFrom:function(e,t,n,i){return O(n,g)&&(n=n.bind(this)),e.off(t,n,i),this}};Y.publish=Y.trigger;var K=function(e){return e.BEFORE=function(t){return K(function(){var n=u(arguments);return n[0]=e.apply(this,n),t.apply(this,n)})},e.AFTER=function(t){return K(function(){var n=u(arguments);return n[0]=t.apply(this,n),e.apply(this,n)})},e},et=function(e){return e.NOT=function(){return et(function(){return!e.apply(this,u(arguments))})},e.AND=function(t){return et(function(){var n=u(arguments);return!(!e.apply(this,n)||!t.apply(this,n))})},e.OR=function(t){return et(function(){var n=u(arguments);return!(!e.apply(this,n)&&!t.apply(this,n))})},e.XOR=function(t){return et(function(){var n=u(arguments),i=e.apply(this,n);return r2=t.apply(this,n),!!(i&&!r2||r2&&!i)})},e},tt={TypeCaster:K,Cast:{EACH:function(e){var t=function(){return e};return t.MODELVIEW_COLLECTION_EACH=!0,t},FIELD:function(e){var t=!0;return e=j({},e||{}),K(function(n){var i,r,a,o,u;if(t){for(i in e)r=e[i],r.MODELVIEW_COLLECTION_EACH?(e[i]=r().bind(this),e[i].MODELVIEW_COLLECTION_EACH=!0):e[i]=r.bind(this);t=!1}for(i in e)if(r=e[i],a=n[i],r.MODELVIEW_COLLECTION_EACH&&O(a,m)){for(o=a.length,u=0;o>u;u++)a[u]=r(a[u]);n[i]=a}else n[i]=r(a);return n})},DEFAULT:function(e){return K(function(t){var n=E(t);return(y&n||f&n&&!N(t).length)&&(t=e),t})},BOOLEAN:K(function(e){return!!e}),CLAMP:function(e,t){if(e>t){var n=t;t=e,e=n}return K(function(n){return e>n?n=e:n>t&&(n=t),n})},INTEGER:K(function(e){return parseInt(e,10)}),FLOAT:K(function(e){return parseFloat(e,10)}),TRIMMED:K(function(e){return N(String(e))}),LCASE:K(function(e){return String(e).toLowerCase()}),UCASE:K(function(e){return String(e).toUpperCase()}),STRING:K(function(e){return String(e)})},add:function(e,t){return O(e,f)&&O(t,g)&&(tt.Cast[e]=K(t)),tt},del:function(e){return O(e,f)&&tt.Cast[e]&&delete tt.Cast[e],tt},toString:function(){return"[ModelView.Type]"}},nt={Validator:et,Validate:{EACH:function(e){var t=function(){return e};return t.MODELVIEW_COLLECTION_EACH=!0,t},FIELD:function(e){var t=!0;return e=j({},e||{}),et(function(n){var i,r,a,o,u;if(t){for(i in e)r=e[i],r.MODELVIEW_COLLECTION_EACH?(e[i]=r().bind(this),e[i].MODELVIEW_COLLECTION_EACH=!0):e[i]=r.bind(this);t=!1}for(i in e)if(r=e[i],a=n[i],r.MODELVIEW_COLLECTION_EACH&&O(a,m)){for(o=a.length,u=0;o>u;u++)if(!r(a[u]))return!1}else if(!r(a))return!1;return!0})},NUMERIC:et(function(e){return A(e)}),NOT_EMPTY:et(function(e){return!!(e&&0<N(String(e)).length)}),EQUAL:function(e,t){return et(!1!==t?function(t){return e===t}:function(t){return e==t})},NOT_EQUAL:function(e,t){return et(!1!==t?function(t){return e!==t}:function(t){return e!=t})},EQUALTO:function(e,t){return e='this.get("'+e+'", true)',et(!1!==t?new Function("v","return ( "+e+" === v );"):new Function("v","return ( "+e+" == v );"))},NOT_EQUALTO:function(e,t){return e='this.get("'+e+'", true)',et(!1!==t?new Function("v","return ( "+e+" !== v );"):new Function("v","return ( "+e+" != v );"))},MATCH:function(e){return et(function(t){return e.test(t)})},NOT_MATCH:function(e){return et(function(t){return!e.test(t)})},GREATER_THAN:function(e,t){return et(!1!==t?function(t){return t>e}:function(t){return t>=e})},LESS_THAN:function(e,t){return et(!1!==t?function(t){return e>t}:function(t){return e>=t})},BETWEEN:function(e,t,n){if(e>t){var i=t;t=e,e=i}return et(!1!==n?function(n){return n>e&&t>n}:function(n){return n>=e&&t>=n})},NOT_BETWEEN:function(e,t,n){if(e>t){var i=t;t=e,e=i}return et(!1!==n?function(n){return e>n||n>t}:function(n){return e>=n||n>=t})},IN:function(){var e=u(arguments);return O(e[0],m)&&(e=e[0]),et(function(t){return-1<e.indexOf(t)})},NOT_IN:function(){var e=u(arguments);return O(e[0],m)&&(e=e[0]),et(function(t){return 0>e.indexOf(t)})}},add:function(e,t){return O(e,f)&&O(t,g)&&(nt.Validate[e]=et(t)),nt},del:function(e){return O(e,f)&&nt.Validate[e]&&delete nt.Validate[e],nt},toString:function(){return"[ModelView.Validation]"}},it=function(e,t,n,i,r,a){var o=this;return o instanceof it?(o.id=e||Z("Model"),o.namespace=o.id,o.$view=null,o.$types={},o.$validators={},o.$getters={},o.$setters={},void o.data(t||{}).types(n).validators(i).getters(r).setters(a).initPubSub().init()):new it(e,t,n,i,r,a)};it.prototype=C(w(Object.prototype),Y,{constructor:it,id:null,$view:null,$data:null,$types:null,$validators:null,$getters:null,$setters:null,_atomic:!1,$atom:null,dispose:function(e){var t=this;return t.$view=null,t.$data=null,t.$types=null,t.$validators=null,t.$getters=null,t.$setters=null,t._atomic=!1,t.$atom=null,e&&t.publish("dispose",{target:t}),t.disposePubSub(),t},init:function(e){var t=this;return t._atomic=!1,t.$atom=null,e&&t.publish("init",{target:t}),t},isValid:function(){return!0},view:function(e){var t=this;return arguments.length?(t.$view=e,t):t.$view},data:function(e){var t=this;return arguments.length?(t.$data=e,t):t.$data},type:function(e,t){var n,i,r=this,a=!1;if(null==e)return r;if(e=S(e),i=E(t),g&i)a=t.MODELVIEW_COLLECTION_EACH,t=a?t().bind(r):t.bind(r),F(t,e.split("."),r.$types,a);else if((v|m)&i)for(n in t)r.type(e+"."+n,t[n]);return r},types:function(e){var t=this;if(e&&O(e,v))for(var n in e)t.type(n,e[n]);return t},validator:function(e,t){var n,i,r=this,a=!1;if(null==e)return r;if(e=S(e),i=E(t),g&i)a=t.MODELVIEW_COLLECTION_EACH,t=a?t().bind(r):t.bind(r),F(t,e.split("."),r.$validators,a);else if((v|m)&i)for(n in t)r.validator(e+"."+n,t[n]);return r},validators:function(e){var t=this;if(e&&O(e,v))for(var n in e)t.validator(n,e[n]);return t},getter:function(e,t){var n,i,r=this;if(null==e)return r;if(e=S(e),i=E(t),g&i)F(t.bind(r),e.split("."),r.$getters);else if((v|m)&i)for(n in t)r.getter(e+"."+n,t[n]);return r},getters:function(e){var t=this;if(e&&O(e,v))for(var n in e)t.getter(n,e[n]);return t},setter:function(e,t){var n,i,r=this;if(null==e)return r;if(e=S(e),i=E(t),g&i)F(t.bind(r),e.split("."),r.$setters);else if((v|m)&i)for(n in t)r.setter(e+"."+n,t[n]);return r},setters:function(e){var t=this;if(e&&O(e,v))for(var n in e)t.setter(n,e[n]);return t},serialize:function(e){for(var t,n,i=this;e&&e instanceof it;)e=e.data();if(n=E(e),v&n?e=j({},e):m&n&&(e=e.slice()),(m|v)&n)for(t in e)n=E(e[t]),e[t]&&e[t]instanceof it?e[t]=i.serialize(j({},e[t].data())):v&n?e[t]=i.serialize(j({},e[t])):m&n&&(e[t]=i.serialize(e[t].slice()));return e},toJSON:function(e){var t,n,i=this;n=arguments.length?i.get(e):i.data();try{t=M(i.serialize(n))}catch(r){throw r}return t},fromJSON:function(e,t){var n,i=this;if(e){try{n=V(e)}catch(r){throw r}t?i.set(t,n):i.data(n)}return i},key:function(e,t){return e&&0>t?e.split(".").slice(0,t).join("."):e},count:function(e,t){if(!arguments.length)return 0;var n=e?this.get(e):t,i=E(n);return v===i?l(n).length:m===i?n.length:y!==i?1:0},has:function(e){var t,n=this;return null==e?!1:(e=S(e))?(t=B(e.split("."),n.$data,n.$getters,it),t?!0===t?!0:t[1].has(t[2].join(".")):!1):!1},get:function(e,t){var i,r=this;return null==e?n:(e=S(e))?(i=U(e.split("."),r.$data,t?null:r.$getters,it),i?it===i[0]?i[1].get(i[2].join("."),t):!1===i[0]?i[1](e):i[1]:n):n},set:function(e,t,n,i){var r,a,o,u,l,s,c,d,f=this;if(!e)return f;if(e=S(e),!e||f._atomic&&T(e,f.$atom))return f;if(r=W(e.split("."),f.$data,f.$types,f.$validators,f.$setters,it),a=r[1],o=r[2],u=z(r[4],o),l=z(r[5],o),s=z(r[6],o),it===r[0])o.length?(o=o.join("."),d=a.get(o),d!==t?a.set(o,t):n=!1):(d=a.data(),d!==t?a.data(t):n=!1),n&&(c={target:f,bracketkey:S(e,1),key:e,value:t,valuePrev:d},i&&(c=j({},i,c)),f.publish("change",c));else{if(!s&&!1===r[0]&&r[3].length)return f;if(u&&(t=u(t,e)),l&&!l(t,e))return n&&(c={target:f,bracketkey:S(e,1),key:e,value:t},i&&(i._error=!0,c=j({},i,c)),f.publish("error",c)),f;if(s)return s(e,t)&&(n&&(c={target:f,bracketkey:S(e,1),key:e,value:t},i&&(c=j({},i,c)),f.publish("change",c)),f.$atom&&e===f.$atom&&(f._atomic=!0)),f;d=a[o],d!==t&&(a[o]=t,n&&(c={target:f,bracketkey:S(e,1),key:e,value:t,valuePrev:d},i&&(c=j({},i,c)),f.publish("change",c)),f.$atom&&e===f.$atom&&(f._atomic=!0))}return f},append:function(e,t,n,i){var r,a,o,u,l,s,c,d,f=this;if(!e)return f;if(e=S(e),!e||f._atomic&&T(e,f.$atom))return f;if(r=W(e.split("."),f.$data,f.$types,f.$validators,f.$setters,it),a=r[1],o=r[2],u=z(P(r[4],o),H),l=z(P(r[5],o),H),s=z(P(r[6],o),H),it===r[0])o.length?(o=o.join("."),d=a.get(o),d!==t?a.set(o,t):n=!1):(d=a.data(),d!==t?a.data(t):n=!1),n&&(c={target:f,bracketkey:S(e,1),key:e,value:t,valuePrev:d},i&&(c=j({},i,c)),f.publish("change",c));else{if(!s&&(!1===r[0]&&r[3].length||!O(a[o],m)))return f;if(u&&(t=u(t,e)),l&&!l(t,e))return n&&(c={target:f,bracketkey:S(e,1),key:e,value:t},i&&(i._error=!0,c=j({},i,c)),f.publish("error",c)),f;if(s)return s(e,t)&&(n&&(c={target:f,bracketkey:S(e,1),key:e,value:t},i&&(c=j({},i,c)),f.publish("change",c)),f.$atom&&e===f.$atom&&(f._atomic=!0)),f;a[o].push(t),n&&(c={target:f,bracketkey:S(e,1),key:e,value:t},i&&(c=j({},i,c)),f.publish("append",c),f.publish("change",c)),f.$atom&&e===f.$atom&&(f._atomic=!0)}return f},del:function(e,t,n){var i,r,a,o,u,l=this;return e?(e=S(e),!e||l._atomic&&T(e,l.$atom)?l:(i=W(e.split("."),l.$data,l.$types,l.$validators,l.$setters,it,!1),r=i[1],a=i[2],it===i[0]&&a.length?(a=a.join("."),u=r.get(a),r.del(a),t&&(o={target:l,bracketkey:S(e,1),key:e,value:u},n&&(o=j({},n,o)),l.publish("remove",o)),l.$atom&&e===l.$atom&&(l._atomic=!0),l):i[3].length?l:(u=r[a],delete r[a],t&&(o={target:l,bracketkey:S(e,1),key:e,value:u},n&&(o=j({},n,o)),l.publish("remove",o)),l.$atom&&e===l.$atom&&(l._atomic=!0),l))):l},rem:function(e,t,i){var r,a,o,u,l,s=this;if(!e)return s;if(e=S(e),!e||s._atomic&&T(e,s.$atom))return s;if(r=W(e.split("."),s.$data,s.$types,s.$validators,s.$setters,it,!1),a=r[1],o=r[2],it===r[0]&&o.length)return o=o.join("."),l=a.get(o),a.rem(o),t&&(u={target:s,bracketkey:S(e,1),key:e,value:l},i&&(u=j({},i,u)),s.publish("remove",u)),s.$atom&&e===s.$atom&&(s._atomic=!0),s;if(r[3].length)return s;if(n!==a[o]){l=a[o],a[o]=n;var c=E(a);v==c?delete a[p]:m==c&&R(o)&&a.splice(+p,1)}return t&&(u={target:s,bracketkey:S(e,1),key:e,value:l},i&&(u=j({},i,u)),s.publish("remove",u)),s.$atom&&e===s.$atom&&(s._atomic=!0),s},notify:function(e,t){return n!==e&&this.publish(t||"change",{target:this,bracketkey:S(e,1),key:S(e),value:null}),this},atom:function(e){var t=this;return n!==e&&(!1===e?(t._atomic=!1,t.$atom=null):(t._atomic=!1,t.$atom=S(e))),t},toString:function(){return this.toJSON()}});var rt=function(e,t,n){var i=this;return i instanceof rt?(i.id=e||Z("View"),i.namespace=i.id,i.$atts=n||{bind:"data-bind"},void i.model(t||new it).initPubSub().init()):new rt(e,t,n)};rt._CACHE_SIZE=600,rt._REFRESH_INTERVAL=1/0,rt.prototype=C(w(Object.prototype),Y,{constructor:rt,id:null,$dom:null,$bind:null,$model:null,$bindbubble:!1,$autobind:!1,$template:null,$atts:null,$memoize:null,$selectors:null,dispose:function(){var e=this;return e.unbind(),e.$model&&(e.$model.dispose(),e.$model=null),e.$dom=null,e.$bind=null,e.$template=null,e.$atts=null,e.$memoize.dispose(),e.$memoize=null,e.$selectors.dispose(),e.$selectors=null,e.disposePubSub(),e},init:function(e){var t=this;return t.$bind=t.attribute("bind"),t.$memoize=new J(rt._CACHE_SIZE,rt._REFRESH_INTERVAL),t.$selectors=new J(rt._CACHE_SIZE,rt._REFRESH_INTERVAL),e&&t.publish("init",{target:t}),t},model:function(e){var t=this;return arguments.length?(t.$model&&t.$model.dispose(),t.$model=e.view(t),t):t.$model},attribute:function(e,t){var i=this;return arguments.length>1?(i.$atts[e]=t,i):e?i.$atts[e]||n:n},template:function(e){var t=this;return arguments.length?(O(e,g)&&(t.$template=e),t):t.$template},event:function(e,t){var i=this,r=e?"on_"+e.split(":").join("_"):null;return r&&n!==t?(i[r]=O(t,g)?t:null,i):r?i[r]:n},action:function(e,t){var i=this;return arguments.length>1?(i["do_"+e]=O(t,g)?t:null,i):e?i["do_"+e]||n:n},bindbubble:function(e){var t=this;return arguments.length?(t.$bindbubble=!!e,t):t.$bindbubble},autobind:function(e){var t=this;return arguments.length?(t.$autobind=!!e,t):t.$autobind},uuid:function(e){return Z(e)},get:function(e,i,r){var a,o=this,u=o.$selectors;return i=i?t(i):o.$dom,r?i.find(e):(a=u.get(e),n===a&&u.set(e,a=i.find(e)),a)},attr:function(e,t){var i,r=this,a=r.$atts[t],o=r.$memoize;return a&&L(e,a)?(a=e.attr(a),i=o.get(a),n===i&&(i=V(a),i.text?(i.change={action:"set",prop:"text",key:i.text,domRef:i.domRef||null},delete i.text):i.html?(i.change={action:"set",prop:"html",key:i.html,domRef:i.domRef||null},delete i.html):i.value?(i.change={action:"set",prop:"value",key:i.value,domRef:i.domRef||null},delete i.value):i.options?(i.change={action:"set",prop:"options",key:i.options,domRef:i.domRef||null},delete i.options):i["class"]?(i.change={action:"set",prop:"class",key:i["class"],domRef:i.domRef||null},delete i["class"]):i.checked?(i.change={action:"set",prop:"checked",key:i.checked,domRef:i.domRef||null},delete i.checked):i.disabled?(i.change={action:"set",prop:"disabled",key:i.disabled,domRef:i.domRef||null},delete i.disabled):i.show?(i.change={action:"show",key:i.show,domRef:i.domRef||null},delete i.show):i.hide?(i.change={action:"hide",key:i.hide,domRef:i.domRef||null},delete i.hide):(i.css||i.attr||i.prop)&&(i.change={action:"set",key:i.key||null,domRef:i.domRef||null},i.css&&(i.change.css=i.css,delete i.css),i.attr&&(i.change.attr=i.attr,delete i.attr),i.prop&&(i.change.prop=i.prop,delete i.prop)),i.change&&"set"===i.change.action&&i.change.prop&&i.change.prop in k&&(i.change.prop=k[i.change.prop]),o.set(a,i)),i):n},eventaction:function(e,t){return e&&t&&t[e]?O(t[e],f)?{event:e,action:t[e]}:j({event:e},t[e]):null},getDomRef:function(e,n){return n&&"$this::"==n.slice(0,7)?t(n.slice(7),e):t(n)},unbind:function(e,n){var i,r,a=this,o=a.$model,u="["+a.$bind+"]",l='input[name^="'+o.id+'["],textarea[name^="'+o.id+'["],select[name^="'+o.id+'["]';return e=e||null,r=n?t(n):a.$dom,a.on_view_change&&(i=function(e){return X(e,a.namespace)},r.off(e&&e.length?e.map(i).join(" "):X("",a.namespace),[l,u].join(","))),a.offFrom(o,"",null,a.namespace),a},uiEventHandler:function(e,n){var i=this,r=i.$model,a="["+i.$bind+"]",o='input[name^="'+r.id+'["],textarea[name^="'+r.id+'["],select[name^="'+r.id+'["]',u=!1,l=!1,s=t(n),c=i.$bindbubble?i.attr(s,"bind"):null;return(e.target===n||i.$bindbubble&&c&&c.bubble)&&(l=i.$bindbubble?!!c:s.is(a),u=i.$autobind&&"change"==e.type&&s.is(o),(l||u)&&i.on_view_change(e,{el:s,_isBind:l,_isAutoBind:u})),!0},bind:function(e,n){var i,r,a,o=this,u=o.$model,l="["+o.$bind+"]",s='input[name^="'+u.id+'["],textarea[name^="'+u.id+'["],select[name^="'+u.id+'["]';e=e||["change","click"],o.$dom=t(n||window.document),o.on_view_change&&e.length&&(a=function(e){return X(e,o.namespace)},o.$dom.on(e.map(a).join(" "),[s,l].join(","),function(e){return o.uiEventHandler(e,this),!0}));for(i in o)O(o[i],g)&&/^on_model_/.test(i)&&(r=i.replace(/^on_model_/,""),r.length&&o.onTo(u,r,o[i],o.namespace));return o},sync:function(e){var n,i,r=this,a=r.$model,o="["+r.$bind+"]",u='input[name^="'+a.id+'["],textarea[name^="'+a.id+'["],select[name^="'+a.id+'["]';return e=e?t(e):r.$dom,n=r.get(o,e,!0),i=r.get(u,e,!0),r.doAction(n,q("change"),{sync:!0}),r.$autobind&&r.doAutoBindAction(i,q("change"),{sync:!0}),r},reset:function(){var e=this;return e.$memoize.reset(),e.$selectors.reset(),e},refresh:function(e,t){var n=this;return n.unbind(),n.$memoize.reset(),n.$selectors.reset(),n.bind(e,t),n},on_view_change:function(e,n){var i,r,a,o,u,l=this,s=l.$model,c=n.el,d={};n._isAutoBind&&c.attr("name")&&(i=c.attr("name"),r=S(x(s.id,i))||!1,r&&s.has(r)&&(o=c.is(":checkbox"),o?(u=l.get('input[type="checkbox"][name="'+i+'"]'),u.length>1?(a=[],u.each(function(){var e,n=t(this);e=n.is(":checked")?n.val():"",a.push(e)})):a=u.is(":checked")?u.val():""):a=c.val(),d._triggerElement=c,s.set(r,a,1,d))),!d._error&&n._isBind&&l.doAction(c,e,n),l.publish("change",n)},on_model_error:function(e,t){var n,i,r=this,a=r.$model,o=a.id+t.bracketkey,u="["+r.$bind+"]",l='input[name^="'+o+'"],textarea[name^="'+o+'"],select[name^="'+o+'"]';n=r.get(u),i=r.get(l),r.doAction(n,e,{model:t}),r.$autobind&&r.doAutoBindAction(i,e,{model:t})},on_model_change:function(e,t){var n,i,r=this,a=r.$model,o=a.id+t.bracketkey,u="["+r.$bind+"]",l='input[name^="'+o+'"],textarea[name^="'+o+'"],select[name^="'+o+'"]';n=r.get(u),i=r.get(l),t._triggerElement&&(n=n.not(t._triggerElement),i=i.not(t._triggerElement)),r.doAction(n,e,{model:t}),r.$autobind&&r.doAutoBindAction(i,e,{model:t})},do_NOP:null,do_render:function(e,t,n){if(this.$template&&n.key&&n.tpl&&(n.domRef&&(t=this.getDomRef(t,n.domRef)),t.length)){var i,r=this,a=r.$model,o=n.key,u=n.tpl,l=n.mode||"replace";o=x(a.id,o)||!1,o&&a.has(o)&&(value=a.get(o),"replace"==l&&t.empty(),i=r.$template(u,value),i&&t.append(i))}},do_set:function(e,t,n){if(n.key||n.css||n.attr){var i,r,a,o,u,l,s=this,c=s.$model,f=n.key||!1;if(n.domRef&&(t=this.getDomRef(t,n.domRef)),t.length){if(n.css&&(i={},O(n.css,v))){for(a in n.css)c.has(n.css[a])&&(i[a]=c.get(n.css[a]));t.css(i)}if(n.attr&&(i={},O(n.attr,v))){for(a in n.attr)c.has(n.attr[a])&&(i[a]=c.get(n.attr[a]));t.attr(i)}if(f&&(o=x(c.id,f)||!1,o&&c.has(o)&&(u=o?c.get(o):"",l=O(u,d),n.prop)))switch(r=n.prop){case k.options:if(t.is("select")&&O(u,m)){var h=t.find("optgroup"),p=t.val(),g="";h.length||(h=t),h.find("option").remove();for(var $=0;$<u.length;$++)g+=u[$]&&u[$].label?'<option value="'+u[$].value+'">'+u[$].label+"</option>":'<option value="'+u[$]+'">'+u[$]+"</option>";h.append(g),t.val(p)}break;case k.html:t.html(u);break;case k.text:t.text(u);break;case k["class"]:if(u&&u.length){var b=u.charAt(0);"-"==b?t.removeClass(u.slice(1)):"+"==b?t.addClass(u.slice(1)):t.hasClass(u)?t.hasClass(u)&&t.removeClass(u):t.addClass(u)}break;case k.value:t.val(u);break;default:k.checked==r?l?t.prop("checked",u):u==t.val()?t.prop("checked",!0):t.prop("checked",!1):k.disabled==r?l?t.prop("disabled",u):u==t.val()?t.prop("disabled",!0):t.prop("disabled",!1):t.attr(r,u)}}}},do_update:function(e,t,n){n.key&&"value"in n&&this.$model.set(x(this.$model.id,n.key),n.value,!0)},do_show:function(e,t,n){var i,r=this,a=r.$model;n.domRef&&(t=this.getDomRef(t,n.domRef)),t.length&&(n.key?(i=x(a.id,n.key),"value"in n?n.value===a.get(i)?t.show():t.hide():a.get(i)?t.show():t.hide()):t.show())},do_hide:function(e,t,n){var i,r=this,a=r.$model;n.domRef&&(t=this.getDomRef(t,n.domRef)),t.length&&(n.key?(i=x(a.id,n.key),"value"in n?n.value===a.get(i)?t.hide():t.show():a.get(i)?t.hide():t.show()):t.hide())},do_bind:function(e,n,i){{var r,a,o,u,l,s=this;s.$model}if(n.is("input,textarea,select")&&(l=n.attr("name")||!1)){if(r=i.key||!1,!r)return;if(a=i.value,o=O(a,d),u=n.val(),n.is(":radio"))a==u&&(s.get('input[name="'+l+'"]').not(n).prop("checked",!1),n.prop("checked",!0));else if(n.is(":checkbox")){var c=s.get('input[type="checkbox"][name="'+l+'"]');c.length>1&&O(a,m)?c.each(function(){var e=t(this);t.inArray(e.val(),a)>-1?e.prop("checked",!0):e.prop("checked",!1)}):o?n.prop("checked",a):a==u?n.prop("checked",!0):n.prop("checked",!1)}else n.val(a)}},doAction:function(e,n,i){var r=this,a=r.$model;return e.each(function(){var e,o,u,l,s,c,d=t(this),f=r.attr(d,"bind");if(f&&(e=r.eventaction(n.type,f),e&&e.action&&(o=e.event,u=e.action,!i.sync||"change"==o))){if(i.model){if(c=d.attr("name")||!1,l=c&&d.is("input,textarea,select")?x(a.id,c):e.key,!l||!T(l,i.model.bracketkey)&&!T(l,i.model.key))return;if(a._atomic&&T(l,a.$atom))return}u&&O(r["do_"+u],g)&&(s=j(!0,{},e),r["do_"+u](n,d,s),e.complete&&O(r["do_"+e.complete],g)&&setTimeout(function(){r["do_"+e.complete](n,d,s)},20))}}),this},doAutoBindAction:function(e,n,i){var r=this,a=r.$model,o={};return r.do_bind&&e.each(function(){var e,u=t(this),l=u.attr("name")||"",s=i&&i.key?i.key:x(a.id,l);if(i&&i.value)e=i.value;else{if(!s)return;if(o[s])e=o[s][0];else{if(!a.has(s))return;e=a.get(s),o[s]=[e]}}r.do_bind(n,u,{key:s,value:e})}),this},toString:function(){return"[ModelView.View id: "+this.id+"]"}}),e.ModelView={VERSION:"0.22",UUID:Z,Extend:C,Type:tt,Validation:nt,Cache:J,Model:it,View:rt}}(t,e),!function(e,t){"use strict";var n=Function.prototype.call.bind(Array.prototype.slice),i={viewClass:e.View,modelClass:e.Model,id:"view",autobind:!1,bindbubble:!1,bindAttribute:"data-bind",model:{id:"model",data:{},types:{},validators:{},getters:{},setters:{}},template:null,events:null,actions:{},handlers:{}};t.ModelView=e,t.fn.modelview=function(e){var r=n(arguments),a=r.length?r.shift():null,o=!0,u=!1,l=[];return this.each(function(){var n,s,c,d=t(this);if(d.data("modelview")){if(o=!1,s=d.data("modelview"),n=s.$model,"view"===a)l.push(s);else if("model"===a){if(r.length)return n.apply(s,r),this;l.push(n)}else if("data"===a){if(r.length)return n.data.apply(s.$model,r),this;l.push(n.data())}else"dispose"===a?(d.data("modelview",null),s.dispose()):"sync"===a?s.sync.apply(s,r):"refresh"===a&&s.refresh.apply(s,r);return this}if(!u){var f=null;e.data&&(f=e.data,delete e.data),e=t.extend(!0,{},i,e),f&&(e.data=f),u=!0}if(!e.model)return this;if(n=new e.modelClass(e.model.id,e.model.data,e.model.types,e.model.validators,e.model.getters,e.model.setters),s=new e.viewClass(e.id,n,{bind:e.bindAttribute||"data-bind"}),e.template&&s.template(e.template),e.handlers)for(var h in e.handlers)c=e.handlers[h],c&&s.event(h,c);if(e.actions)for(var p in e.actions)c=e.actions[p],c&&s.action(p,c);d.data("modelview",s),s.bindbubble(e.bindbubble).autobind(e.autobind).bind(e.events,d)}),!o&&l.length?1==this.length?l[0]:l:this}}(t.ModelView,e),t.ModelView});
/**
*
*   ModelView.js
*   @version: 0.40
*
*   A micro-MV* (MVVM) framework for complex (UI) screens 
*   optionaly integrates into both jQuery as MVVM plugin and jQueryUI as MVC widget
*   https://github.com/foo123/modelview.js
*
**/!function(e,t,n){"use strict";var i,r="object"==typeof module&&module.exports,l="function"==typeof define&&define.amd;r?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||n.call(e,{NODE:module})||1:l&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,i,r){return n.call(e,{AMD:r})}):t in e||(e[t]=i=n.call(e,{})||1)&&l&&define(t,[],function(){return i})}(this,"ModelView",function(e){"use strict";function t(e){return-1<Wt.indexOf(e)}function n(e,t){return e.toLowerCase()===t.tagName.toLowerCase()}function r(e,t){return this.$element===window?t===document:this.$element===t}function l(e,t){return e===t.id}function o(e){return e.length>0}function a(e){var t=e.split("."),n=t[0];return t=t.slice(1).filter(o),[n,t.sort()]}function u(e,t){return new v("(^|\\.)"+t.join("\\.(?:.*\\.|)")+"(\\.|$)").test(e)}function s(e){var t=this;return t instanceof s?(e&&t.element(e),void(t.$handle=s.Handler.bind(t))):new s(e)}var c=void 0,f=function(e,t){return e.bind(t)},d="prototype",h=Array,m=h[d],v=RegExp,p=Number,g=Object,$=g[d],b=g.create,y=g.keys,w=Function,E=w[d],k=String,_=k[d],T=E.call,x=(f(T,$.hasOwnProperty),f(T,$.toString)),C=f(T,m.slice),S=function(e,t){return e instanceof t},R=function(e,t){return new w(e,t)},V=function(e){return k(e)},L=1/0,D=(Math.random,parseFloat),N=isNaN,O=isFinite,A=2,M=3,P=4,j=8,F=9,I=16,z=32,H=64,B=128,W=256,U=512,q=1024,Y=I|z,X=I|j,J=function(e){var t,n;return null===e?W:!0===e||!1===e?P:(t=typeof e,n=x(e),c===e||"undefined"===t?U:e instanceof p||"number"===t?N(e)?M:A:e instanceof k||"string"===t?1===e.length?F:j:e instanceof h||"[object Array]"===n?I:e instanceof v||"[object RegExp]"===n?B:e instanceof w||"function"===t&&"[object Function]"===n?H:"[object Object]"===n?z:q)},Q=function(e,t){return!!(t&J(e))},K=function(e){return!N(D(e))&&O(e)},Z=function(e){return K(e)&&(e=+e,0===e%1&&e>=0)?!0:!1},G="getAttribute",et="setAttribute",tt="checked",nt="disabled",it="selected",rt="name",lt="tagName",ot="type",at="value",ut="options",st="selectedIndex",ct="parentNode",ft="style",dt="innerHTML",ht="innerText",mt="textContent",vt=function(e,t){return m.slice.call((t||document).getElementsByTagName(e),0)},pt=function(e,t,n){return!0===n?[(t||document).querySelector(e)]:m.slice.call((t||document).querySelectorAll(e),0)},gt=function(e){return e?e.matches||e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector:void 0}(Element?Element[d]:null),$t=function(e){return document.createTextNode(e||"")},bt=window.getComputedStyle?function(e){return window.getComputedStyle(e,null)}:function(e){return e.currentStyle},yt=function(e){e._displayCached||(e._displayCached=bt(e).display||"block"),e[ft].display="none"!==e._displayCached?e._displayCached:"block",e._displayCached=c},wt=function(e){e._displayCached||(e._displayCached=bt(e).display||"block"),e[ft].display="none"},Et=function(e){var t=e.attributes[at];return!t||t.specified?e[at]:e.text},kt=function(e){for(var t,n,i=e[ut],r=e[st],l="select-one"===e[ot]||0>r,o=l?null:[],a=l?r+1:i.length,u=0>r?a:l?r:0;a>u;u++)if(n=i[u],!(!n[it]&&u!==r||n[nt]||n[ct][nt]&&"optgroup"===n[ct][lt])){if(t=Et(n),l)return t;o.push(t)}return o},_t=function(e,t){var n,i,r=[].concat(t).map(V),l=e[ut];for(i=0;i<l.length;i++)n=l[i],n[it]=-1<r.indexOf(Et(n));r.length||(e[st]=-1)},Tt=function(e){if(e)switch(e[lt].toLowerCase()){case"textarea":case"input":return e[at];case"select":return kt(e);default:return mt in e?e[mt]:e[ht]}},xt=function(e,t){if(e)switch(e[lt].toLowerCase()){case"textarea":case"input":e[at]=k(t);break;case"select":_t(e,t);break;default:mt in e?e[mt]=k(t):e[ht]=k(t)}},Ct=JSON.parse,St=JSON.stringify,Rt=function(){return(new Date).getTime()};_.trim||(_.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),_.startsWith||(_.startsWith=function(e,t){return t=t||0,e===this.substr(t,e.length+t)}),_.tR=_.trim,_.sW=_.startsWith;var Vt="*",Lt="modelview",Dt=function(){var e,t,n,i,r,l,o,a=arguments;for(t=a[0]||{},e=a.length,l=1;e>l;l++)if(n=a[l],z===J(n))for(r in n)i=n[r],o=J(i),t[r]=A&o?0+i:X&o?i.slice(0):i;return t},Nt=function(e,t){this.val=e||null,this.next=t||{}},Ot=function(e,t){if(!e)return null;var n,i,r=[],l=e.length;for(n=0;l>n;n++)i=e[n],i&&(i[t]&&r.push(i[t].next),i[Vt]&&r.push(i[Vt].next));return r.length?r:null},At=function(e,t){if(!e)return null;var n,i,r=e.length;if(t){for(n=0;r>n;n++)if(i=e[n]){if(i[t]&&i[t].val)return i[t].val;if(i[Vt]&&i[Vt].val)return i[Vt].val}}else for(n=0;r>n;n++)if(i=e[n],i&&i.val)return i.val;return null},Mt=function(e,t,n,i){for(var r,l=n;t.length;)r=t.shift(),r in l||(l[r]=new Nt),l=l[r],t.length?l=l.next:i?(Vt in l.next||(l.next[Vt]=new Nt),l.next[Vt].val=e):l.val=e;return n},Pt=function(e,t,n,i){for(var r,l,o=t,a=n?[n]:null;e.length;){if(r=e.shift(),l=J(o),!e.length)return a&&At(a,r)?!0:l&Y&&r in o?!0:z===l&&"length"==r?!0:!1;if(l&Y&&r in o){if(o=o[r],o instanceof i)return[i,o,e];a&&(a=Ot(a,r))}else if(!a||!(a=Ot(a,r)))return!1}return!1},jt=function(e,t,n,i){for(var r,l,o=t,a=n?[n]:null;e.length;){if(r=e.shift(),l=J(o),!e.length)return a&&(a=At(a,r))?[!1,a]:l&Y&&r in o?[!0,o[r]]:z===l&&"length"==r?[!0,y(o).length]:!1;if(l&Y&&r in o){if(o=o[r],o instanceof i)return[i,o,e];a&&(a=Ot(a,r))}else if(!a||!(a=Ot(a,r)))return!1}return!1},Ft=function(e,t,n,i,r,l,o){var a,u,s=t,c=null,f=null,d=null;for(o=!1!==o,o&&(c=[n],f=[i],d=[r]);e.length;)if(a=e.shift(),u=J(s),e.length){if(!(u&Y&&a in s))return[!1,s,a,e,null,null,null];if(s=s[a],s instanceof l)return[l,s,e,0,null,null,null];o&&(c=Ot(c,a),f=Ot(f,a),d=Ot(d,a))}else if(u&Y)return s[a]instanceof l?[l,s[a],e,0,null,null,null]:a in s?[!0,s,a,e,c,f,d]:[!1,s,a,e,c,f,d];return[!1,s,a,e,null,null,null]},It=0,zt=function(e){return[e||"UUID",++It,Rt()].join("_")},Ht=function(e,t){var n=[e||"",Lt];return t&&(n=n.concat(t)),n.join(".")};this.Element&&Element[d].attachEvent&&!Element[d].addEventListener&&!function(){function e(e,t){Window[d][e]=HTMLDocument[d][e]=Element[d][e]=t}e("addEventListener",function(e,t){var n=this,i=n.addEventListener.listeners=n.addEventListener.listeners||{},r=i[e]=i[e]||[];r.length||n.attachEvent("on"+e,r.event=function(e){var t=n.document&&n.document.documentElement||n.documentElement||{scrollLeft:0,scrollTop:0};e.currentTarget=n,e.pageX=e.clientX+t.scrollLeft,e.pageY=e.clientY+t.scrollTop,e.preventDefault=function(){e.returnValue=!1},e.relatedTarget=e.fromElement||null,e.stopImmediatePropagation=function(){a=!1,e.cancelBubble=!0},e.stopPropagation=function(){e.cancelBubble=!0},e.target=e.srcElement||n,e.timeStamp=+new Date;for(var i,l=0,o=[].concat(r),a=!0;a&&(i=o[l]);++l)for(var u,s=0;u=r[s];++s)if(u==i){u.call(n,e);break}}),r.push(t)}),e("removeEventListener",function(e,t){for(var n,i=this,r=i.addEventListener.listeners=i.addEventListener.listeners||{},l=r[e]=r[e]||[],o=l.length-1;n=l[o];--o)if(n==t){l.splice(o,1);break}!l.length&&l.event&&i.detachEvent("on"+e,l.event)}),e("dispatchEvent",function(e){var t=this,n=e.type,i=t.addEventListener.listeners=t.addEventListener.listeners||{},r=i[n]=i[n]||[];try{return t.fireEvent("on"+n,e)}catch(l){return void(r.event&&r.event(e))}}),Object.defineProperty(Window[d],"CustomEvent",{get:function(){var e=this;return function(t,n){var i,r=e.document.createEventObject();r.type=t,n=n||{bubbles:!1,cancelable:!1,detail:void 0};for(i in n)"cancelable"==i?r.returnValue=!n.cancelable:"bubbles"==i?r.cancelBubble=!n.bubbles:"detail"==i&&(r.detail=n.detail);return r}}})}(),this.CustomEvent||!function(){window.CustomEvent=function(e,t){var n;t=t||{bubbles:!1,cancelable:!1,detail:void 0};try{n=document.createEvent("CustomEvent"),n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail)}catch(i){n=document.createEvent("Event"),n.initEvent(e,t.bubbles,t.cancelable),n.detail=t.detail}return n}}();var Bt="DOMEVENT_STOPPED",Wt=["blur","error","focus","load","resize","scroll"];s.Handler=function(e){if(!e[Bt]){var t,n,i,r,l,o,a,u=this,s=e.type,c=e.target,f=[];switch(c&&3===c.nodeType&&(c=c.parentNode),r=u.$element,i=r.$listeners,l=e.eventPhase||(e.target!==e.currentTarget?3:2)){case 1:f=i[1][s];break;case 2:i[0]&&i[0][s]&&(f=f.concat(i[0][s])),i[1]&&i[1][s]&&(f=f.concat(i[1][s]));break;case 3:f=i[0][s]}for(n=f.length;n&&c;){for(t=0;n>t&&(o=f[t],o);t++)if(o.matcher.call(c,o.matcherParam,c)&&(a=o.handler.call(c,e,c)),!1===a||!1===e.returnValue)return e[Bt]=!0,void e.preventDefault();if(r===c)break;n=f.length,c=c.parentElement}}},s[d]={constructor:s,$element:null,$handle:null,dispose:function(){var e=this;return e.off().element(),e.$element=null,e.$handle=null,e},element:function(e){var t,n,i,r=this,l=r.$element;if(l){for(t=l.$listeners,n=y(t[1]),i=0;i<n.length;i++)l.removeEventListener(n[i],r.$handle,!0);for(n=y(t[0]),i=0;i<n.length;i++)l.removeEventListener(n[i],r.$handle,!1);l.$listeners=c}return e&&e.addEventListener?(r.$element=e,e.$listeners=e.$listeners||[{},{}],r):(r.$element=null,r)},on:function(e,i,o,u){var s,f,d,h,m,v,p,g,$=this;if(!e)throw new TypeError("Invalid event type: "+e);if(p=e.split(/\s+/g).map(a),!p.length)return $;if("function"==typeof i&&(u=o,o=i,i=null),"function"!=typeof o)throw new TypeError("Handler must be a type of Function");for(s=$.$element,h=0,m=p.length;m>h;h++)g=c===u?t(p[h][0]):!!u,f=s.$listeners[g?1:0],f[p[h][0]]||(f[p[h][0]]=[],s.addEventListener(p[h][0],$.$handle,g)),i?/^[a-z]+$/i.test(i)?(v=i,d=n):/^#[a-z0-9\-_]+$/i.test(i)?(v=i.slice(1),d=l):(v=i,d=gt):(v=null,d=r.bind($)),f[p[h][0]].push({selector:i,handler:o,matcher:d,matcherParam:v,namespace:p[h][1].join(".")});return $},off:function(e,t,n,i){var r,l,o,s,f,d,h,m,v,p=this,g=p.$element,$=!1;if("function"==typeof t&&(i=n,n=t,t=null),$=c===i?[0,1]:i?[1]:[0],v=e?e.split(/\s+/g).map(a):[],v.length){for(d=0;d<$.length;d++)for(o=g.$listeners[$[d]],f=0;f<v.length;f++)if(m=v[f][1],h=v[f][0],h.length){if(s=o[h],!s||!s.length)continue;for(r=s.length-1;r>=0;r--)l=s[r],t&&t!==l.selector||n&&n!==l.handler||m.length&&!u(l.namespace,m)||s.splice(r,1);s.length||(delete o[h],g.$element.removeEventListener(h,p.$handle,!!$[d]))}else for(h in o)if(s=o[h],s&&s.length){for(r=s.length-1;r>=0;r--)l=s[r],t&&t!==l.selector||n&&n!==l.handler||m.length&&!u(l.namespace,m)||s.splice(r,1);s.length||(delete o[h],g.$element.removeEventListener(h,p.$handle,!!$[d]))}}else for(d=0;d<$.length;d++){o=g.$listeners[$[d]];for(h in o)if(s=o[h],s&&s.length){for(r=s.length-1;r>=0;r--)l=s[r],t&&t!==l.selector||n&&n!==l.handler||s.splice(r,1);s.length||(delete o[h],g.removeEventListener(h,p.$handle,!!$[d]))}}return p}};var Ut=2,qt=function(e,t,n){var i=this;return i instanceof qt?(i.type=e,i.target=t,i.currentTarget=t,i.timeStamp=Rt(),i.eventPhase=Ut,i.bubbles=!1,i.cancelable=!1,void(i.namespace=n||null)):new qt(e,t,n)};qt[d]={constructor:qt,type:null,target:null,currentTarget:null,timeStamp:null,eventPhase:Ut,bubbles:!1,cancelable:!1,namespace:null,stopPropagation:function(){this.bubbles=!1},preventDefault:function(){}};var Yt={$PB:null,initPubSub:function(){var e=this;return e.$PB={},e},disposePubSub:function(){var e=this;return e.$PB=null,e},trigger:function(e,t){var n,i,r,l=this,o=l.$PB;if((n=o[e])&&(r=n.length))for(e=qt(e,l),i=0;r>i;i++)n[i](e,t);return l},on:function(e,t){var n=this;return Q(t,H)&&(n.$PB[e]||(n.$PB[e]=[]),n.$PB[e].push(t)),n},onTo:function(e,t,n){var i=this;return Q(n,H)&&(n=f(n,i)),e.on(t,n),i},off:function(e,t){var n,i,r,l=this,o=l.$PB;if(e){if((n=o[e])&&(r=n.length))if(Q(t,H))for(i=r-1;i>=0;i--)t===n[i]&&n.splice(i,1);else o[e]=[]}else for(i in o)delete o[e];return l},offFrom:function(e,t,n){var i=this;return Q(n,H)&&(n=f(n,i)),e.off(t,n),i}};Yt.publish=Yt.trigger;var Xt=function(e,t){var n=this,i=arguments.length;n.$store={},n.$size=L,n.$interval=L,i>0&&e>0&&(n.$size=e),i>1&&t>0&&(n.$interval=t)};Xt[d]={constructor:Xt,$store:null,$size:null,$interval:null,dispose:function(){var e=this;return e.$store=null,e.$size=null,e.$interval=null,e},reset:function(){return this.$store={},this},size:function(e){return arguments.length?(e>0&&(this.$size=e),this):this.$size},interval:function(e){return arguments.length?(e>0&&(this.$interval=e),this):this.$interval},has:function(e){var t=this,n=e?t.$store[e]:null;return!!(n&&Rt()-n.time<=t.$interval)},get:function(e){if(e){var t=this,n=t.$store[e];if(n)return Rt()-n.time>t.$interval?(delete t.$store[e],c):n.data}return c},set:function(e,t){var n,i,r,l=this;if(e){for(n=l.$store,i=l.$size,r=y(n);r.length>=i;)delete n[r.shift()];n[e]={data:t,time:Rt()}}return l},del:function(e){return e&&this.$store[e]&&delete this.$store[e],this},toString:function(){return"[ModelView.Cache]"}};var Jt=function(e){return e.replace(/\[([^\]]*)\]/g,".$1").replace(/^\.+/,"").replace(/\.+$/,"")},Qt=function(e){return"["+e.split(".").join("][")+"]"},Kt=function(e){var t=new v("^"+e+"([\\.|\\[])");return function(e,n){var i=e.replace(t,"$1");return n?Jt(i):i}},Zt=function(e){return S(this,Zt)?void(this.f=e||null):new Zt(e)},Gt=function(e){return S(this,Gt)?void(this.f=e||null):new Gt(e)},en=function(e,t){var n,i;for(n in t)i=t[n],S(i,Gt)?(t[n]=f(i.f,e),t[n].fEach=!0):t[n]=f(i,e);return t},tn=function(e){return e.BEFORE=function(t){return tn(function(n,i){var r=this;return t.call(r,e.call(r,n,i),i)})},e.AFTER=function(t){return tn(function(n,i){var r=this;return e.call(r,t.call(r,n,i),i)})},e},nn=function(e){return e.NOT=function(){return nn(function(t,n){return!e.call(this,t,n)})},e.AND=function(t){return nn(function(n,i){var r=this;return e.call(r,n,i)&&t.call(r,n,i)})},e.OR=function(t){return nn(function(n,i){var r=this;return e.call(r,n,i)||t.call(r,n,i)})},e.XOR=function(t){return nn(function(n,i){var r=this,l=e.call(r,n,i),o=t.call(r,n,i);return l&&!o||o&&!l})},e},rn={TypeCaster:tn,Cast:{EACH:Gt,FIELDS:function(e){var t=!0;return e=Dt({},e||{}),tn(function(n){var i,r,l,o,a;t&&(en(this,e),t=!1);for(i in e)if(r=e[i],l=n[i],r.fEach&&Q(l,I)){for(o=l.length,a=0;o>a;a++)l[a]=r(l[a]);n[i]=l}else n[i]=r(l);return n})},DEFAULT:function(e){return tn(function(t){var n=J(t);return(U&n||j&n&&!t.tR().length)&&(t=e),t})},BOOL:tn(function(e){return!!e}),INT:tn(function(e){return parseInt(e,10)}),FLOAT:tn(function(e){return parseFloat(e,10)}),MIN:function(e){return tn(function(t){return e>t?e:t})},MAX:function(e){return tn(function(t){return t>e?e:t})},CLAMP:function(e,t){if(e>t){var n=t;t=e,e=n}return tn(function(n){return e>n?e:n>t?t:n})},TRIM:tn(function(e){return k(e).tR()}),LCASE:tn(function(e){return k(e).toLowerCase()}),UCASE:tn(function(e){return k(e).toUpperCase()}),STR:tn(function(e){return""+e})},add:function(e,t){return Q(e,j)&&Q(t,H)&&(rn.Cast[e]=tn(t)),rn},del:function(e){return Q(e,j)&&rn.Cast[e]&&delete rn.Cast[e],rn},toString:function(){return"[ModelView.Type]"}},ln={Validator:nn,Validate:{EACH:Gt,FIELDS:function(e){var t=!0;return e=Dt({},e||{}),nn(function(n){var i,r,l,o,a;t&&(en(this,e),t=!1);for(i in e)if(r=e[i],l=n[i],r.fEach&&Q(l,I)){for(o=l.length,a=0;o>a;a++)if(!r(l[a]))return!1}else if(!r(l))return!1;return!0})},NUMERIC:nn(function(e){return K(e)}),NOT_EMPTY:nn(function(e){return!!(e&&0<k(e).tR().length)}),MAXLEN:function(e){return nn(R("v","return v.length <= "+e+";"))},MINLEN:function(e){return nn(R("v","return v.length >= "+e+";"))},MATCH:function(e){return nn(function(t){return e.test(t)})},NOT_MATCH:function(e){return nn(function(t){return!e.test(t)})},EQUAL:function(e,t){return nn(S(e,Zt)?R("v","return this.$data."+e.f+" "+(!1!==t?"===":"==")+" v;"):!1!==t?function(t){return e===t}:function(t){return e==t})},NOT_EQUAL:function(e,t){return nn(S(e,Zt)?R("v","return this.$data."+e.f+" "+(!1!==t?"!==":"!=")+" v;"):!1!==t?function(t){return e!==t}:function(t){return e!=t})},GREATER_THAN:function(e,t){return S(e,Zt)?e="this.$data."+e.f:Q(e,j)&&(e='"'+e+'"'),nn(R("v","return "+e+" "+(!1!==t?"<":"<=")+" v;"))},LESS_THAN:function(e,t){return S(e,Zt)?e="this.$data."+e.f:Q(e,j)&&(e='"'+e+'"'),nn(R("v","return "+e+" "+(!1!==t?">":">=")+" v;"))},BETWEEN:function(e,t,n){Q(e,I)&&(n=t,t=e[1],e=e[0]);var i,r=S(e,Zt),l=S(t,Zt);return!r&&!l&&e>t&&(i=t,t=e,e=i),e=r?"this.$data."+e.f:Q(e,j)?'"'+e+'"':e,t=l?"this.$data."+t.f:Q(t,j)?'"'+t+'"':t,nn(!1!==n?R("v","return ( "+e+" < v ) && ( "+t+" > v );"):R("v","return ( "+e+" <= v ) && ( "+t+" >= v );"))},NOT_BETWEEN:function(e,t,n){Q(e,I)&&(n=t,t=e[1],e=e[0]);var i,r=S(e,Zt),l=S(t,Zt);return!r&&!l&&e>t&&(i=t,t=e,e=i),e=r?"this.$data."+e.f:Q(e,j)?'"'+e+'"':e,t=l?"this.$data."+t.f:Q(t,j)?'"'+t+'"':t,nn(!1!==n?R("v","return ( "+e+" > v ) || ( "+t+" < v );"):R("v","return ( "+e+" >= v ) || ( "+t+" <= v );"))},IN:function(){var e=C(arguments);return Q(e[0],I)&&(e=e[0]),nn(function(t){return-1<e.indexOf(t)})},NOT_IN:function(){var e=C(arguments);return Q(e[0],I)&&(e=e[0]),nn(function(t){return 0>e.indexOf(t)})}},add:function(e,t){return Q(e,j)&&Q(t,H)&&(ln.Validate[e]=nn(t)),ln},del:function(e){return Q(e,j)&&ln.Validate[e]&&delete ln.Validate[e],ln},toString:function(){return"[ModelView.Validation]"}},on=function(e,t,n,i){var r,l,o=!1;if(l=J(n),H&l)o=S(n,Gt),n=o?f(n.f,e):f(n,e),Mt(n,-1<t.indexOf(".")?t.split("."):[t],i,o);else if(Y&l)for(r in n)on(e,t+"."+r,n[r],i)},an=function(e,t,n,i){var r,l;if(l=J(n),H&l)Mt(f(n,e),-1<t.indexOf(".")?t.split("."):[t],i);else if(Y&l)for(r in n)an(e,t+"."+r,n[r],i)},un=function(e,t,n){for(var i,r;t instanceof e;)t=t.data();if(r=n||J(t),t=z&r?Dt({},t):I&r?t.slice(0):t,Y&r)for(i in t)t[i]instanceof e?t[i]=un(e,Dt({},t[i].data())):Y&(r=J(t[i]))&&(t[i]=un(e,t[i],r));return t},sn=function(e,t){var n,r=this,l=r.$syncTo,o=t.key,a=t.value;if(o&&o in l)for(n=l[o],i=0;i<n.length;i++)n[i][0].set(n[i][1],a,!0)},cn=function(e,t,n,i,r,l){var o=this;return o instanceof cn?(o.namespace=o.id=e||zt("Model"),o.key=Kt(o.id),o.$view=null,o.atomic=!1,o.$atom=null,o.$types={},o.$validators={},o.$getters={},o.$setters={},o.$syncTo={},void o.data(t||{}).types(n).validators(i).getters(r).setters(l).initPubSub()):new cn(e,t,n,i,r,l)};cn[d]=Dt(b(g[d]),Yt,{constructor:cn,id:null,$view:null,$data:null,$types:null,$validators:null,$getters:null,$setters:null,atomic:!1,$atom:null,$syncTo:null,$syncHandler:null,dispose:function(){var e=this;return e.disposePubSub().$view=null,e.$data=null,e.$types=null,e.$validators=null,e.$getters=null,e.$setters=null,e.atomic=!1,e.$atom=null,e.key=null,e.$syncTo=null,e.$syncHandler=null,e},isValid:function(){return!0},view:function(e){var t=this;return arguments.length?(t.$view=e,t):t.$view},data:function(e){var t=this;return arguments.length?(t.$data=e,t):t.$data},types:function(e){var t,n=this;if(Q(e,z))for(t in e)on(n,t,e[t],n.$types);return n},validators:function(e){var t,n=this;if(Q(e,z))for(t in e)on(n,t,e[t],n.$validators);return n},getters:function(e){var t,n=this;if(Q(e,z))for(t in e)an(n,t,e[t],n.$getters);return n},setters:function(e){var t,n=this;if(Q(e,z))for(t in e)an(n,t,e[t],n.$setters);return n},serialize:function(){return un(cn,this.$data)},toJSON:function(e){var t,n,i,r=this;n=arguments.length?r.get(e):r.data();try{t=St(un(cn,n))}catch(i){throw i}return t},fromJSON:function(e,t){var n,i,r=this;if(e){try{n=Ct(e)}catch(i){throw i}t?r.set(t,n):r.data(n)}return r},count:function(e,t){if(!arguments.length)return 0;var n=e?this.get(e):t,i=J(n);return z===i?y(n).length:I===i?n.length:U!==i?1:0},has:function(e,t){var n,i=this;return 0>e.indexOf(".")&&(e in i.$data||!t&&(n=i.$getters[e])&&n.val)?!0:(n=Pt(e.split("."),i.$data,t?null:i.$getters,cn))?!0===n?!0:n[1].has(n[2].join(".")):!1},get:function(e,t){var n,i=this;return 0>e.indexOf(".")?!t&&(n=i.$getters[e])&&n.val?n.val(e):i.$data[e]:(n=jt(e.split("."),i.$data,t?null:i.$getters,cn))?cn===n[0]?n[1].get(n[2].join("."),t):!1===n[0]?n[1](e):n[1]:c},set:function(e,t,n,i){var r,l,o,a,u,s,c,f,d,h,m=this,v=!1;if(m.atomic&&e.sW(m.$atom))return m;if(l=m.$data,c=m.$types,f=m.$validators,d=m.$setters,0>e.indexOf("."))o=e,s=(r=d[o])?r.val:null,a=(r=c[o]||c[Vt])?r.val:null,u=(r=f[o]||f[Vt])?r.val:null,v=!0;else if(r=Ft(e.split("."),l,c,f,d,cn)){if(l=r[1],o=r[2],a=At(r[4],o),u=At(r[5],o),s=At(r[6],o),cn===r[0])return o.length?(o=o.join("."),h=l.get(o),h!==t?l.set(o,t,n,i):n=!1):(h=l.data(),h!==t?l.data(t):n=!1),n&&m.publish("change",{model:m,key:e,value:t,valuePrev:h,$callData:i}),m;if(!s&&!1===r[0]&&r[3].length)return m;v=!0}if(v){if(a&&(t=a(t,e)),u&&!u(t,e))return n&&(i&&(i.error=!0),m.publish("error",{model:m,key:e,value:l[o],$callData:i})),m;if(s)return s(e,t)&&(n&&m.publish("change",{model:m,key:e,value:t,$callData:i}),m.$atom&&e===m.$atom&&(m.atomic=!0)),m;h=l[o],h!==t&&(l[o]=t,n&&m.publish("change",{model:m,key:e,value:t,valuePrev:h,$callData:i}),m.$atom&&e===m.$atom&&(m.atomic=!0))}return m},append:function(e,t,n,i){var r,l,o,a,u,s,f=this,d=!1;if(f.atomic&&e.sW(f.$atom))return f;if(l=f.$data,types=f.$types,validators=f.$validators,setters=f.$setters,0>e.indexOf("."))o=e,s=(r=setters[o])&&r.next[Vt]?r.next[Vt].val:null,a=(r=types[o]||types[Vt])&&r.next[Vt]?r.next[Vt].val:null,u=(r=validators[o]||validators[Vt])&&r.next[Vt]?r.next[Vt].val:null,d=!0;else if(r=Ft(e.split("."),l,types,validators,setters,cn)){if(l=r[1],o=r[2],a=At(Ot(r[4],o),Vt),u=At(Ot(r[5],o),Vt),s=At(Ot(r[6],o),Vt),cn===r[0])return o.length?(o=o.join("."),l.append(o,t,n,i)):l.data(t),n&&f.publish("change",{model:f,key:e,value:t,$callData:i}),f;if(!s&&!1===r[0]&&r[3].length)return f;d=!0}if(d){if(a&&(t=a(t,e)),u&&!u(t,e))return n&&(i&&(i.error=!0),f.publish("error",{model:f,key:e,value:c,$callData:i})),f;if(s)return s(e,t)&&(n&&f.publish("change",{model:f,key:e,value:t,$callData:i}),f.$atom&&e===f.$atom&&(f.atomic=!0)),f;I===J(l[o])?l[o].push(t):l[o]=t,n&&f.publish("change",{model:f,key:e,value:t,$callData:i}),f.$atom&&e===f.$atom&&(f.atomic=!0)}return f},del:function(e,t,n){var i,r,l,o,a=this,u=!1;if(a.atomic&&e.sW(a.$atom))return a;if(r=a.$data,0>e.indexOf("."))l=e,u=!0;else if(i=Ft(e.split("."),r,null,null,null,cn,!1)){if(r=i[1],l=i[2],cn===i[0]&&l.length)return l=l.join("."),o=r.get(l),r.del(l,t,n),t&&a.publish("remove",{model:a,key:e,value:o,$callData:n}),a.$atom&&e===a.$atom&&(a.atomic=!0),a;if(i[3].length)return a;u=!0}return u&&(o=r[l],delete r[l],t&&a.publish("remove",{model:a,key:e,value:o,$callData:n}),a.$atom&&e===a.$atom&&(a.atomic=!0)),a},rem:function(e,t,n){var i,r,l,o,a,u=this,s=!1;if(u.atomic&&e.sW(u.$atom))return u;if(r=u.$data,0>e.indexOf("."))l=e,s=!0;else if(i=Ft(e.split("."),r,null,null,null,cn,!1)){if(r=i[1],l=i[2],cn===i[0]&&l.length)return l=l.join("."),o=r.get(l),r.rem(l,t,n),t&&u.publish("remove",{model:u,key:e,value:o,$callData:n}),u.$atom&&e===u.$atom&&(u.atomic=!0),u;if(i[3].length)return u;s=!0}return s&&(o=r[l],r[l]=c,a=J(r),I==a&&Z(l)?r.splice(+l,1):z==a&&delete r[l],t&&u.publish("remove",{model:u,key:e,value:o,$callData:n}),u.$atom&&e===u.$atom&&(u.atomic=!0)),u},syncTo:function(e,t){var n,i=this;for(n in t)i.$syncTo[n]=i.$syncTo[n]||[],i.$syncTo[n].push([e,t[n]]);return i.$syncHandler||i.on("change",i.$syncHandler=sn.bind(i)),i},unsyncFrom:function(e){var t,n,i,r=this,l=r.$syncTo;for(t in l)if(n=l[t],n.length)for(i=n.length-1;i>=0;i--)e===n[i][0]&&n.splice(i,1);return r},notify:function(e,t,n){return e&&this.publish(t||"change",{model:this,key:e,$callData:n}),this},atom:function(e){var t=this;return c!==e&&(!1===e?(t.atomic=!1,t.$atom=null):(t.atomic=!1,t.$atom=e)),t},toString:function(){return"[ModelView.Model id: "+this.id+"]"}});var fn=function(e){return new v(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace("__KEY__","(\\S+?)"),"")},dn=function(e){var t,n="",i=e.length;for(t=0;i>t;t++)n+=e[t].nodeValue;return n},hn=function(e,t,n){n=n||[null,null];var i,r,l,o,a,u,s,c,f,d,h,m,v,p,g,$=n[0]||{},b=n[1]||{};if(e){if(i=[],r=[],s=e,s.attributes&&(o=s.attributes.length))for(l=0;o>l;l++)c=s.attributes[l],(a=c.nodeValue.match(t))&&r.push([c,a]);if(3===s.nodeType)(a=s.nodeValue.match(t))&&i.push([s,a,null]);else if(s.firstChild)for(g=[s=s.firstChild];g.length;){if(s.attributes&&(o=s.attributes.length))for(l=0;o>l;l++)c=s.attributes[l],(a=c.nodeValue.match(t))&&r.push([c,a]);if(s.firstChild)g.push(s=s.firstChild);else{for(3===s.nodeType&&(a=s.nodeValue.match(t))&&i.push([s,a]),s=g.pop();g.length&&!s.nextSibling;)s=g.pop();s.nextSibling&&g.push(s=s.nextSibling)}}for(l=0,o=i.length;o>l;l++){u=i[l],p=u[0],a=u[1];do f=a[1],d=p.splitText(a.index),p=d.splitText(a[0].length),($[f]=$[f]||[]).push(d),a=p.nodeValue.match(t);while(a)}for(h={},l=0,o=r.length;o>l;l++)if(u=r[l],c=u[0],a=u[1],v=c.nodeValue,m=v in h)for(a=0;a<h[v][0].length;a++)b[h[v][0][a]].push([c,h[v][1]]);else{p=$t(v),h[v]=[[],[p]];do f=a[1],d=p.splitText(a.index),p=d.splitText(a[0].length),h[v][0].push(f),h[v][1].push(d),h[v][1].push(p),($[f]=$[f]||[]).push(d),(b[f]=b[f]||[]).push([c,h[v][1]]),a=p.nodeValue.match(t);while(a)}}return n[0]=$,n[1]=b,n},mn=function(e,t,n){return[e?"["+e+"]":null,t?n?'input[name="'+t+'"],textarea[name="'+t+'"],select[name="'+t+'"]':'input[name^="'+t+'"],textarea[name^="'+t+'"],select[name^="'+t+'"]':null]},vn=function(e,t){return t&&t[e]?(Q(t[e],j)&&(t[e]={action:t[e]}),t[e]):void 0},pn=function(e,t,n,i){var r,l,o,a,u,s,c=e.$model,f="sync"==n.type,d=f?"change":n.type,h=t.length;for(r=0;h>r;r++)l=t[r],o=vn(d,e.attr(l,"bind")),o&&o.action&&(a="do_"+o.action,Q(e[a],H)&&(u=l[rt],s=o.key||!!u&&c.key(u,1),i&&(!s||!s.sW(i.key)||c.atomic&&s.sW(c.$atom))||e[a](n,l,o)))},gn=function(e,t,n){var i,r,l,o,a,u=e.$model,s={},c="sync"==n.type,f=(c?"change":n.type,t.length);for(i=0;f>i;i++)if(r=t[i],l=r[rt],o=l?u.key(l,1):0){if(s[o])a=s[o][0];else{if(!u.has(o))continue;s[o]=[a=u.get(o)]}e.do_bind(n,r,{name:l,key:o,value:a})}},$n=function(e,t,n){var i,r,l,o,a,u,s,c,f=e.$model,d=e.$keynodes[0],h=e.$keynodes[1];if(t){if(r=d[t])for(n=""+n,i=0,l=r.length;l>i;i++)r[i].nodeValue=n;if(r=h[t])for(i=0,l=r.length;l>i;i++)r[i][0].nodeValue=dn(r[i][1]);for(c=t+".",o=y(d),a=0,s=o.length;s>a;a++)if(u=o[a],t!==u&&u.sW(c)&&(r=d[u]).length)for(n=""+f.get(u),i=0,l=r.length;l>i;i++)r[i].nodeValue=n;for(o=y(h),a=0,s=o.length;s>a;a++)if(u=o[a],t!==u&&u.sW(c)&&(r=h[u]).length)for(i=0,l=r.length;l>i;i++)r[i][0].nodeValue=dn(r[i][1])}else{for(o=y(d),a=0,s=o.length;s>a;a++)if(u=o[a],(r=d[u])&&(l=r.length))for(n=""+f.get(u),i=0;l>i;i++)r[i].nodeValue=n;for(o=y(h),a=0,s=o.length;s>a;a++)if(u=o[a],(r=h[u])&&(l=r.length))for(i=0;l>i;i++)r[i][0].nodeValue=dn(r[i][1])}},bn=function(e,t,n,i,r){var l=this;return l instanceof bn?(l.namespace=l.id=e||zt("View"),"bind"in(n=n||{})||(n.bind="data-bind"),l.$atts=n,i=i||bn._CACHE_SIZE,r=r||bn._REFRESH_INTERVAL,l.$memoize=new Xt(i,r),l.$selectors=new Xt(i,r),l.$bind=l.attribute("bind"),void l.inlineTplFormat("$(__KEY__)").model(t||new cn).initPubSub()):new bn(e,t,n,i,r)};return bn._CACHE_SIZE=600,bn._REFRESH_INTERVAL=L,bn[d]=Dt(b(g[d]),Yt,{constructor:bn,id:null,$dom:null,$bind:null,$model:null,$bindbubble:!1,$autobind:!1,$template:null,$atts:null,$memoize:null,$selectors:null,$keynodes:null,$inlineTplFormat:null,dispose:function(){var e=this;return e.unbind().disposePubSub(),e.$model&&e.$model.dispose(),e.$model=null,e.$dom=null,e.$bind=null,e.$template=null,e.$atts=null,e.$memoize.dispose(),e.$memoize=null,e.$selectors.dispose(),e.$selectors=null,e.$keynodes=null,e.$inlineTplFormat=null,e},model:function(e){var t=this;return arguments.length?(t.$model&&t.$model.dispose(),t.$model=e.view(t),t):t.$model},attribute:function(e,t){var n=this;return arguments.length>1?(n.$atts[e]=t,n):e?n.$atts[e]||c:c},inlineTplFormat:function(e){return this.$inlineTplFormat=e,this},template:function(e){var t=this;return arguments.length?(Q(e,H)&&(t.$template=e),t):t.$template},event:function(e,t){var n=this,i=e?"on_"+e.split(":").join("_"):null;return i&&c!==t?(n[i]=Q(t,H)?t:null,n):i?n[i]:c},action:function(e,t){var n=this,i=e&&"do_"+e;return arguments.length>1?(n[i]=Q(t,H)?t:null,n):i&&n[i]},bindbubble:function(e){var t=this;return arguments.length?(t.$bindbubble=!!e,t):t.$bindbubble},autobind:function(e){var t=this;return arguments.length?(t.$autobind=!!e,t):t.$autobind},get:function(e,t,n){var i,r=this,l=r.$selectors;return t=t||r.$dom,n?pt(e,t):(i=l.get(e),i||l.set(e,i=pt(e,t)),i)},attr:function(e,t){var n,i,r=this,l=r.$atts[t],o=r.$memoize;return(l=e[G](l))?(n=o.get(l),c===n&&(n=Ct(l),n.set&&(n.click=n.set,n.click.action="set",n.set=c,delete n.set),n.show&&(n.change={action:"show",key:n.show},n.show=c,delete n.show),n.hide&&(n.change={action:"hide",key:n.hide},n.hide=c,delete n.hide),n.html?(n.change={action:"html",key:n.html},n.html=c,delete n.html,n.text=c,delete n.text):n.text&&(n.change={action:"html",key:n.text,text:1},n.text=c,delete n.text),n.css&&(n.change={action:"css",css:n.css},n.css=c,delete n.css),n.value&&(n.change&&"prop"==n.change.action?n.change.prop.value=n.value:n.change={action:"prop",prop:{value:n.value}},n.value=c,delete n.value),n.checked&&(n.change&&"prop"==n.change.action?n.change.prop.checked=n.checked:n.change={action:"prop",prop:{checked:n.checked}},n.checked=c,delete n.checked),n.disabled&&(n.change&&"prop"==n.change.action?n.change.prop.disabled=n.disabled:n.change={action:"prop",prop:{disabled:n.disabled}},n.disabled=c,delete n.disabled),n.options&&(n.change&&"prop"==n.change.action?n.change.prop.options=n.options:n.change={action:"prop",prop:{options:n.options}},n.options=c,delete n.options),(i=n.change)&&(!i.domRef&&n.domRef&&(i.domRef=n.domRef),!i.key&&n.key&&(i.key=n.key)),o.set(l,n)),n):c},getDomRef:function(e,t){return t.sW("$this::")?pt(t.slice(7),e,!0):pt(t,null,!0)},bind:function(e,t){var n,i,r,l=this,o=l.$model,a=mn(l.$bind,o.id+"["),u=a[0],c=a[1],f=/^on_model_/;e=e||["change","click"],l.$dom=t||document.body,l.on_view_change&&e.length&&(r=function(e){return Ht(e,l.namespace)},s(l.$dom).on(e.map(r).join(" "),[c,u].join(","),function(e){var t=this,n=!1,i=!1,r=l.$bindbubble?l.attr(t,"bind"):null;return(e.target===t||r&&r.bubble)&&(i=l.$bindbubble?!!r:gt.call(t,u),n=l.$autobind&&"change"==e.type&&gt.call(t,c),(i||n)&&l.on_view_change(e,{el:t,isBind:i,isAutoBind:n})),!0}));for(n in l)Q(l[n],H)&&f.test(n)&&(i=n.replace(f,""),i.length&&l.onTo(o,i,l[n]));return l.$keynodes=hn(l.$dom,fn(l.$inlineTplFormat)),l},unbind:function(e,t){var n,i,r=this,l=r.$model,o=mn(r.$bind,l.id+"[");return e=e||null,i=t||r.$dom,r.on_view_change&&(n=function(e){return Ht(e,r.namespace)},s(i).off(e&&e.length?e.map(n).join(" "):Ht("",r.namespace),[o[1],o[0]].join(","))),r.offFrom(l),r.$keynodes=null,r},rebind:function(e,t){var n=this;return n.$memoize.reset(),n.$selectors.reset(),n.unbind().bind(e,t)},sync:function(e){var t=this,n=mn(t.$bind,t.$model.id+"["),i=qt("sync",t);return e=e||t.$dom,pn(t,t.get(n[0],e,1),i),$n(t),t.$autobind&&gn(t,t.get(n[1],e,1),i),t},reset:function(){var e=this;return e.$memoize.reset(),e.$selectors.reset(),e},on_view_change:function(e,t){var n,i,r,l,o=this,a=o.$model,u=t.el,s={};t.isAutoBind&&(n=u[rt])&&(i=a.key(n,1),i&&a.has(i)&&("checkbox"===u[ot].toLowerCase()?(l=o.get('input[type="checkbox"][name="'+n+'"]'),l.length>1?(r=[],l.forEach(function(e){r.push(e[tt]?e[at]:"")})):r=u[tt]?u[at]:""):r=Tt(u),s.$trigger=u,a.set(i,r,1,s))),!s.error&&t.isBind&&pn(o,[u],e),o.publish("change",t)},on_model_change:function(e,t){var n,i,r,l=this,o=l.$model,a=mn(l.$bind,o.id+Qt(t.key)),u=l.$autobind;n=l.get(a[0]),u&&(i=l.get(a[1])),t.$callData&&t.$callData.$trigger&&(r=function(e){return e!==t.$callData.$trigger},n=n.filter(r),u&&(i=i.filter(r)),t.$callData=null),pn(l,n,e,t),$n(l,t.key,t.value),u&&i.length&&gn(l,i,e,t)},on_model_error:function(e,t){var n=this,i=n.$model,r=mn(n.$bind,i.id+Qt(t.key));pn(n,n.get(r[0]),e,t),$n(n,t.key,t.value),n.$autobind&&gn(n,n.get(r[1]),e,t)},do_nop:null,do_prop:function(e,t,n){if(Q(n.prop,z)){var i,r,l,o,a=this,u=a.$model,s=n.prop;if(n.domRef&&(t=a.getDomRef(t,n.domRef)[0]),t)for(i in s)if(r=s[i],u.has(r))switch(l=u.get(r),o=J(l),i){case"value":xt(t,l);break;case"checked":case"disabled":t[i]=P===o?l:k(l)==t[at];break;case"options":if("select"===t[lt]&&I===o){var c,f,d=l.length,h="",m=vt("optgroup",t);for(c=kt(t),m=m.length?m[0]:t,vt("option",m).forEach(function(e){m.removeChild(e)}),f=0;d>f;f++)h+=l[f]&&l[f].label?'<option value="'+l[f].value+'">'+l[f].label+"</option>":'<option value="'+l[f]+'">'+l[f]+"</option>";
m[dt]=h,_t(t,c)}break;default:t[et](i,l)}}},do_html:function(e,t,n){if(n.key){var i=this,r=i.$model,l=n.key;n.domRef&&(t=i.getDomRef(t,n.domRef)[0]),t&&l&&r.has(l)&&(t[n.text?mt in t?mt:ht:dt]=r.get(l))}},do_css:function(e,t,n){if(Q(n.css,z)){var i,r,l,o=this,a=o.$model,u=n.css;if(n.domRef&&(t=o.getDomRef(t,n.domRef)[0]),t)for(r in u)i=u[r],l=a.get(i),l&&(t.style[r]=l)}},do_set:function(e,t,n){var i,r=this,l=r.$model,o=n.key||l.key(t[rt],1);o&&("value"in n?i=n.value:(n.domRef&&(t=r.getDomRef(t,n.domRef)[0]),i=Tt(t)),l.set(o,i,1))},do_tpl:function(e,t,n){var i,r,l,o=this,a=n.key,u=n.tpl;o.$template&&a&&u&&(n.domRef&&(t=o.getDomRef(t,n.domRef)[0]),t&&(i=o.$model,a&&i.has(a)&&(r=n.mode||"replace","replace"==r&&(t[dt]=""),l=o.$template(u,i.get(a)),l&&(t[dt]+=l))))},do_show:function(e,t,n){var i=this,r=i.$model,l=n.key;n.domRef&&(t=i.getDomRef(t,n.domRef)[0]),t&&l&&("value"in n?n.value===r.get(l)?yt(t):wt(t):r.get(l)?yt(t):wt(t))},do_hide:function(e,t,n){var i=this,r=i.$model,l=n.key;n.domRef&&(t=i.getDomRef(t,n.domRef)[0]),t&&l&&("value"in n?n.value===r.get(l)?wt(t):yt(t):r.get(l)?wt(t):yt(t))},do_bind:function(e,t,n){var i,r,l=this,o=(l.$model,n.name),a=n.key,u=t[ot].toLowerCase();if(a)if(i=n.value,r=J(i),"radio"===u)k(i)==t[at]&&(l.get('input[name="'+o+'"]').forEach(function(e){t!==e&&(e[tt]=!1)}),t[tt]=!0);else if("checkbox"===u){var s=l.get('input[type="checkbox"][name="'+o+'"]');s.length>1&&I===r?s.forEach(function(e){e[tt]=-1<i.indexOf(e[at])?!0:!1}):t[tt]=P===r?i:k(i)==t[at]}else xt(t,i)},toString:function(){return"[ModelView.View id: "+this.id+"]"}}),e.ModelView={VERSION:"0.40",UUID:zt,Extend:Dt,Field:Zt,Type:rn,Validation:ln,Cache:Xt,Model:cn,View:bn},!function(e){e.jquery=function(t){if(!t.ModelView){var n=(Function.prototype.call.bind(Array.prototype.slice),t.extend),i=e.View,r=e.Model,l={id:"model",data:{},types:{},validators:{},getters:{},setters:{}},o={viewClass:i,modelClass:r,id:"view",autoSync:!0,autobind:!1,bindbubble:!1,bindAttribute:"data-bind",inlineTplFormat:"$(__KEY__)",cacheSize:i._CACHE_SIZE,refreshInterval:i._REFRESH_INTERVAL,model:null,template:null,events:null,actions:{},handlers:{}};t.ModelView=e,t.fn.modelview=function(e,i){var a=arguments.length,u=a?e:null,s=e,c=!0,f=!1,d=[];return this.each(function(){var e,h,m,v=t(this);if(v.data("modelview")){if(c=!1,h=v.data("modelview"),e=h.$model,"view"===u)d.push(h);else if("model"===u){if(a>1)return h.model(i),this;d.push(e)}else if("data"===u){if(a>1)return e.data(i),this;d.push(e.data())}else"sync"===u?h.sync(i):"reset"===u?h.reset():"dispose"===u&&(v.data("modelview",null),h.dispose());return this}if(f||(s=n({},o,s),!s.model||s.model instanceof r||(s.model=n({},l,s.model)),f=!0),!s.model)return this;if(e=s.model instanceof r?s.model:new s.modelClass(s.model.id,s.model.data,s.model.types,s.model.validators,s.model.getters,s.model.setters),h=new s.viewClass(s.id,e,{bind:s.bindAttribute||"data-bind"},s.cacheSize,s.refreshInterval),s.template&&h.template(s.template),s.handlers)for(var p in s.handlers)m=s.handlers[p],m&&h.event(p,m);if(s.actions)for(var g in s.actions)m=s.actions[g],m&&h.action(g,m);v.data("modelview",h),h.inlineTplFormat(s.inlineTplFormat).bindbubble(s.bindbubble).autobind(s.autobind).bind(s.events,v[0]),s.autoSync&&h.sync()}),!c&&d.length?1==this.length?d[0]:d:this},t.widget&&t.widget("ModelView",{options:{},$view:null,_create:function(){var e=this;e.element.modelview(e.options),e.$view=e.element.modelview("view")},value:function(e,t){var n=this;return 1<arguments.length?(n.$view.$model.set(e,t,!0),n.element):n.$view.$model.get(e)},_destroy:function(){var e=this.self.$view=null;e.element.modelview("dispose")}})}},"undefined"!=typeof window.jQuery&&e.jquery(window.jQuery)}(e.ModelView),e.ModelView});
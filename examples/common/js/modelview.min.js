/**
*
*   ModelView.js
*   @version: 0.25
*   @dependencies: jQuery
*
*   A micro-MV* (MVVM) jQuery-based framework for complex (UI) screens
*   https://github.com/foo123/modelview.js
*
**/!function(e,t,n,r,i){"use strict";n=n?[].concat(n):[];var a,u,l=Array,o=l.prototype,s=n.length,c=new l(s);if("object"==typeof module&&module.exports){if(i===module.exports[t]){for(a=0;s>a;a++)c[a]=module.exports[n[a][0]]||require(n[a][1])[n[a][0]];u=r.apply(e,c),module.exports[t]=u||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(n.map(function(e){return e[1]})),function(a){if(i===a[t]){var l,s=o.slice.call(arguments,1),f=s.length;for(l=0;f>l;l++)c[l]=a[n[l][0]]||s[l];u=r.apply(e,c),a[t]=u||1}});else if(i===e[t]){for(a=0;s>a;a++)c[a]=e[n[a][0]];u=r.apply(e,c),e[t]=u||1}}(this,"ModelView",[["jQuery","jquery"]],function(e){var t={};return!function(e,t,n){"use strict";var r=function(e,t){return e.bind(t)},i="prototype",a=Array,u=a[i],l=RegExp,o=Number,s=Object,c=s[i],f=s.create,d=s.keys,h=Function,m=h[i],p=String,v=p[i],g=m.call,$=(r(g,c.hasOwnProperty),r(g,c.toString)),b=r(g,u.slice),y=function(e,t){return e instanceof t},k=1/0,_=(Math.random,parseFloat),E=parseInt,w=isNaN,C=isFinite,R=JSON.parse,O=JSON.stringify,A=t.Event,L=t.extend;v.trim||(v.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),v.startsWith||(v.startsWith=function(e,t){return t=t||0,e===this.substr(t,e.length+t)}),v.tR=v.trim,v.sW=v.startsWith;var N="*",x="modelview",T={options:1,html:2,text:3,"class":4,value:5,checked:6,disabled:7},I=2,V=3,S=4,M=8,j=9,H=16,D=32,W=64,z=128,P=256,F=512,B=1024,K=H|D,U=H|M,J=function(e){var t,r;return null===e?P:!0===e||!1===e?S:(t=typeof e,r=$(e),n===e||"undefined"===t?F:e instanceof o||"number"===t?w(e)?V:I:e instanceof p||"string"===t?1===e.length?j:M:e instanceof a||"[object Array]"===r?H:e instanceof l||"[object RegExp]"===r?z:e instanceof h||"function"===t&&"[object Function]"===r?W:"[object Object]"===r?D:B)},G=function(e,t){return!!(t&J(e))},Q=function(e){return!w(_(e))&&C(e)},Z=function(e){return Q(e)&&(e=+e,0===e%1&&e>=0)?!0:!1},q=function(){var e,t,n,r,i,a,u,l=b(arguments);for(t=l.shift()||{},e=l.length,a=0;e>a;a++)if(n=l[a],D===J(n))for(i in n)r=n[i],u=J(r),t[i]=I&u?0+r:U&u?r.slice(0):r;return t},X=function(e,t){return new h(e,t)},Y=function(e,t){return n!==e.attr(t)},et=function(e){var t=new l("^"+e+"([\\.|\\[])");return function(e){return e.replace(t,"$1")}},tt=function(e){return"["+e+"]"},nt=function(e,t){return null==e?n:t?p(e).replace(/\.+$/,"").replace(/^\./,"").split(".").map(tt).join(""):p(e).replace(/\[([^\]]*)\]/g,".$1").replace(/^\./,"").replace(/\.+$/,"")},rt=/[.\[]/,it=function(e,t){if(!e)return null;var n,r,i=[],a=e.length;for(n=0;a>n;n++)r=e[n],r&&(r[t]&&i.push(r[t].next),r[N]&&i.push(r[N].next));return i.length?i:null},at=function(e,t){if(!e)return null;var n,r,i=e.length;if(t){for(n=0;i>n;n++)if(r=e[n]){if(r[t]&&r[t].value)return r[t].value;if(r[N]&&r[N].value)return r[N].value}}else for(n=0;i>n;n++)if(r=e[n],r&&r.value)return r.value;return null},ut=function(e,t,n,r){for(var i,a=n;t.length;)i=t.shift(),i in a||(a[i]={value:null,next:{}}),a=a[i],t.length?a=a.next:r?(N in a.next||(a.next[N]={value:null,next:{}}),a.next[N].value=e):a.value=e;return n},lt=function(e,t,n,r){for(var i,a,u=t,l=[n];e.length;){if(i=e.shift(),a=J(u),!e.length)return l&&at(l,i)?!0:a&K&&i in u?!0:D===a&&"length"==i?!0:!1;if(a&K&&i in u){if(u=u[i],u instanceof r)return[r,u,e];l&&(l=it(l,i))}else if(l&&(l=it(l,i)),!l)return!1}return!1},ot=function(e,t,n,r){for(var i,a,u=t,l=n?[n]:null;e.length;){if(i=e.shift(),a=J(u),!e.length)return l&&(l=at(l,i))?[!1,l]:a&K&&i in u?[!0,u[i]]:D===a&&"length"==i?[!0,d(u).length]:!1;if(a&K&&i in u){if(u=u[i],u instanceof r)return[r,u,e];l&&(l=it(l,i))}else if(l&&(l=it(l,i)),!l)return!1}return!1},st=function(e,t,n,r,i,a,u){var l,o,s=t,c=null,f=null,d=null;for(u=!1!==u,u&&(c=[n],f=[r],d=[i]);e.length;)if(l=e.shift(),o=J(s),e.length){if(!(o&K&&l in s))return[!1,s,l,e,null,null,null];if(s=s[l],s instanceof a)return[a,s,e,0,null,null,null];u&&(c=it(c,l),f=it(f,l),d=it(d,l))}else if(o&K)return s[l]instanceof a?[a,s[l],e,0,null,null,null]:l in s?[!0,s,l,e,c,f,d]:[!1,s,l,e,c,f,d];return[!1,s,l,e,null,null,null]},ct=function(){return(new Date).getTime()},ft=0,dt=function(e){return[e||"UUID",++ft,ct()].join("_")},ht=function(e,t){var n=[e||"",x];return t&&(n=n.concat(t)),n.join(".")},mt={$PB:null,namespace:null,initPubSub:function(){var e=this;return e.$PB=t({}),e},disposePubSub:function(){var e=this;return e.$PB.off(ht("")),e.$PB=null,e},trigger:function(e,t,n){var r=this;return r.namespace&&(n=n?[r.namespace].concat(n):[r.namespace]),r.$PB.trigger(ht(e,n),t),r},on:function(e,t,n){var r=this;return G(t,W)&&(r.namespace&&(n=n?[r.namespace].concat(n):[r.namespace]),r.$PB.on(ht(e,n),t)),r},onTo:function(e,t,n,i){var a=this;return G(n,W)&&(n=r(n,a)),e.on(t,n,i),a},off:function(e,t,n){var r=this;return r.namespace&&(n=n?[r.namespace].concat(n):[r.namespace]),G(t,W)?r.$PB.off(ht(e,n),t):r.$PB.off(ht(e,n)),r},offFrom:function(e,t,n,i){var a=this;return G(n,W)&&(n=r(n,a)),e.off(t,n,i),a}};mt.publish=mt.trigger;var pt=function(e,t){var n=this,r=arguments.length;n.$store={},n.$size=k,n.$interval=k,r>0&&e>0&&(n.$size=e),r>1&&t>0&&(n.$interval=t)};pt[i]={constructor:pt,$store:null,$size:null,$interval:null,dispose:function(){var e=this;return e.$store=null,e.$size=null,e.$interval=null,e},reset:function(){return this.$store={},this},size:function(e){return arguments.length?(e>0&&(this.$size=e),this):this.$size},interval:function(e){return arguments.length?(e>0&&(this.$interval=e),this):this.$interval},has:function(e){var t=this,n=e?t.$store[e]:null;return!!(n&&ct()-n.time<=t.$interval)},get:function(e){if(e){var t=this,r=t.$store[e];if(r)return ct()-r.time>t.$interval?(delete t.$store[e],n):r.data}return n},set:function(e,t){var n,r,i,a=this;if(e){for(n=a.$store,r=a.$size,i=d(n);i.length>=r;)delete n[i.shift()];n[e]={data:t,time:ct()}}return a},del:function(e){return e&&this.$store[e]&&delete this.$store[e],this},toString:function(){return"[ModelView.Cache]"}};var vt=function(e){return e.BEFORE=function(t){return vt(function(){var n=this,r=b(arguments);return r[0]=e.apply(n,r),t.apply(n,r)})},e.AFTER=function(t){return vt(function(){var n=this,r=b(arguments);return r[0]=t.apply(n,r),e.apply(n,r)})},e},gt=function(e){return e.NOT=function(){return gt(function(){return!e.apply(this,arguments)})},e.AND=function(t){return gt(function(){var n=this;return!(!e.apply(n,arguments)||!t.apply(n,arguments))})},e.OR=function(t){return gt(function(){var n=this;return!(!e.apply(n,arguments)&&!t.apply(n,arguments))})},e.XOR=function(t){return gt(function(){var n=this,r=e.apply(n,arguments);return r2=t.apply(n,arguments),!!(r&&!r2||r2&&!r)})},e},$t=function(e){return y(this,$t)?void(this.field=e||null):new $t(e)},bt={TypeCaster:vt,Cast:{EACH:function(e){var t=function(){return e};return t.MODELVIEW_COLLECTION_EACH=!0,t},FIELDS:function(e){var t=!0;return e=L({},e||{}),vt(function(n){var i,a,u,l,o,s=this;if(t){for(i in e)a=e[i],a.MODELVIEW_COLLECTION_EACH?(e[i]=r(a(),s),e[i].MODELVIEW_COLLECTION_EACH=!0):e[i]=r(a,s);t=!1}for(i in e)if(a=e[i],u=n[i],a.MODELVIEW_COLLECTION_EACH&&G(u,H)){for(l=u.length,o=0;l>o;o++)u[o]=a(u[o]);n[i]=u}else n[i]=a(u);return n})},DEFAULT:function(e){return vt(function(t){var n=J(t);return(F&n||M&n&&!t.tR().length)&&(t=e),t})},BOOLEAN:vt(function(e){return!!e}),CLAMP:function(e,t){if(e>t){var n=t;t=e,e=n}return vt(function(n){return e>n?n=e:n>t&&(n=t),n})},INTEGER:vt(function(e){return E(e,10)}),FLOAT:vt(function(e){return _(e,10)}),TRIMMED:vt(function(e){return p(e).tR()}),LCASE:vt(function(e){return p(e).toLowerCase()}),UCASE:vt(function(e){return p(e).toUpperCase()}),STRING:vt(function(e){return p(e)})},add:function(e,t){return G(e,M)&&G(t,W)&&(bt.Cast[e]=vt(t)),bt},del:function(e){return G(e,M)&&bt.Cast[e]&&delete bt.Cast[e],bt},toString:function(){return"[ModelView.Type]"}},yt={Validator:gt,Validate:{EACH:function(e){var t=function(){return e};return t.MODELVIEW_COLLECTION_EACH=!0,t},FIELDS:function(e){var t=!0;return e=L({},e||{}),gt(function(n){var i,a,u,l,o,s=this;if(t){for(i in e)a=e[i],a.MODELVIEW_COLLECTION_EACH?(e[i]=r(a(),s),e[i].MODELVIEW_COLLECTION_EACH=!0):e[i]=r(a,s);t=!1}for(i in e)if(a=e[i],u=n[i],a.MODELVIEW_COLLECTION_EACH&&G(u,H)){for(l=u.length,o=0;l>o;o++)if(!a(u[o]))return!1}else if(!a(u))return!1;return!0})},NUMERIC:gt(function(e){return Q(e)}),NOT_EMPTY:gt(function(e){return!!(e&&0<p(e).tR().length)}),MAXLEN:function(e){return gt(function(t){return t.length<=e})},MINLEN:function(e){return gt(function(t){return t.length>=e})},MATCH:function(e){return gt(function(t){return e.test(t)})},NOT_MATCH:function(e){return gt(function(t){return!e.test(t)})},EQUAL:function(e,t){return gt(y(e,$t)?X("v","return this.$data."+e.field+" "+(!1!==t?"===":"==")+" v;"):!1!==t?function(t){return e===t}:function(t){return e==t})},NOT_EQUAL:function(e,t){return gt(y(e,$t)?X("v","return this.$data."+e.field+" "+(!1!==t?"!==":"!=")+" v;"):!1!==t?function(t){return e!==t}:function(t){return e!=t})},GREATER_THAN:function(e,t){return gt(y(e,$t)?X("v","return this.$data."+e.field+" "+(!1!==t?"<":"<=")+" v;"):!1!==t?function(t){return t>e}:function(t){return t>=e})},LESS_THAN:function(e,t){return gt(y(e,$t)?X("v","return this.$data."+e.field+" "+(!1!==t?">":">=")+" v;"):!1!==t?function(t){return e>t}:function(t){return e>=t})},BETWEEN:function(e,t,n){G(e,H)&&(n=t,t=e[1],e=e[0]);var r,i=y(e,$t),a=y(t,$t);return i||a?(e=i?"this.$data."+e.field:""+e,t=a?"this.$data."+t.field:""+t,gt(!1!==n?X("v","return ( "+e+" < v ) && ( "+t+" > v );"):X("v","return ( "+e+" <= v ) && ( "+t+" >= v );"))):(e>t&&(r=t,t=e,e=r),gt(!1!==n?function(n){return n>e&&t>n}:function(n){return n>=e&&t>=n}))},NOT_BETWEEN:function(e,t,n){G(e,H)&&(n=t,t=e[1],e=e[0]);var r,i=y(e,$t),a=y(t,$t);return i||a?(e=i?"this.$data."+e.field:""+e,t=a?"this.$data."+t.field:""+t,gt(!1!==n?X("v","return ( "+e+" > v ) || ( "+t+" < v );"):X("v","return ( "+e+" >= v ) || ( "+t+" <= v );"))):(e>t&&(r=t,t=e,e=r),gt(!1!==n?function(n){return e>n||n>t}:function(n){return e>=n||n>=t}))},IN:function(){var e=b(arguments);return G(e[0],H)&&(e=e[0]),gt(function(t){return-1<e.indexOf(t)})},NOT_IN:function(){var e=b(arguments);return G(e[0],H)&&(e=e[0]),gt(function(t){return 0>e.indexOf(t)})}},add:function(e,t){return G(e,M)&&G(t,W)&&(yt.Validate[e]=gt(t)),yt},del:function(e){return G(e,M)&&yt.Validate[e]&&delete yt.Validate[e],yt},toString:function(){return"[ModelView.Validation]"}},kt=function(e,t,n,i){var a,u,l=!1;if(t)if(t=nt(t),u=J(n),W&u)l=n.MODELVIEW_COLLECTION_EACH,n=l?r(n(),e):r(n,e),ut(n,t.split("."),i,l);else if(K&u)for(a in n)kt(e,t+"."+a,n[a],i)},_t=function(e,t,n,i){var a,u;if(t)if(t=nt(t),u=J(n),W&u)ut(r(n,e),t.split("."),i);else if(K&u)for(a in n)_t(e,t+"."+a,n[a],i)},Et=function(e,t,n,r,i,a){var u=this;return u instanceof Et?(u.id=e||dt("Model"),u.namespace=u.id,u.getKey=et(u.id),u.$view=null,u.$types={},u.$validators={},u.$getters={},u.$setters={},void u.data(t||{}).types(n).validators(r).getters(i).setters(a).initPubSub().init()):new Et(e,t,n,r,i,a)};Et[i]=q(f(s[i]),mt,{constructor:Et,id:null,$view:null,$data:null,$types:null,$validators:null,$getters:null,$setters:null,_atomic:!1,$atom:null,dispose:function(e){var t=this;return t.$view=null,t.$data=null,t.$types=null,t.$validators=null,t.$getters=null,t.$setters=null,t._atomic=!1,t.$atom=null,t.getKey=null,e&&t.publish("dispose",{target:t}),t.disposePubSub(),t},init:function(e){var t=this;return t._atomic=!1,t.$atom=null,e&&t.publish("init",{target:t}),t},isValid:function(){return!0},view:function(e){var t=this;return arguments.length?(t.$view=e,t):t.$view},data:function(e){var t=this;return arguments.length?(t.$data=e,t):t.$data},types:function(e){var t,n=this;if(G(e,D))for(t in e)kt(n,t,e[t],n.$types);return n},validators:function(e){var t,n=this;if(G(e,D))for(t in e)kt(n,t,e[t],n.$validators);return n},getters:function(e){var t,n=this;if(G(e,D))for(t in e)_t(n,t,e[t],n.$getters);return n},setters:function(e){var t,n=this;if(G(e,D))for(t in e)_t(n,t,e[t],n.$setters);return n},serialize:function(e){for(var t,n,r=this;e instanceof Et;)e=e.data();if(n=J(e),D&n?e=L({},e):H&n&&(e=e.slice()),K&n)for(t in e)n=J(e[t]),e[t]instanceof Et?e[t]=r.serialize(L({},e[t].data())):D&n?e[t]=r.serialize(L({},e[t])):H&n&&(e[t]=r.serialize(e[t].slice()));return e},toJSON:function(e){var t,n,r=this;n=arguments.length?r.get(e):r.data();try{t=O(r.serialize(n))}catch(i){throw i}return t},fromJSON:function(e,t){var n,r=this;if(e){try{n=R(e)}catch(i){throw i}t?r.set(t,n):r.data(n)}return r},key:function(e,t){return e&&0>t?e.split(".").slice(0,t).join("."):e},count:function(e,t){if(!arguments.length)return 0;var n=e?this.get(e):t,r=J(n);return D===r?d(n).length:H===r?n.length:F!==r?1:0},has:function(e){var t,n,r=this;if(n=rt.test(e)?(e=nt(e)).split("."):[e],1===n.length){if(e in r.$data||(t=r.$getters[e]||r.$getters[N])&&t.value)return!0}else if(1<n.length&&(t=lt(n,r.$data,r.$getters,Et)))return!0===t?!0:t[1].has(t[2].join("."));return!1},get:function(e,t){var r,i,a=this;return i=rt.test(e)?(e=nt(e)).split("."):[e],1===i.length?!t&&(r=a.$getters[e]||a.$getters[N])&&r.value?r.value(e):a.$data[e]:1<i.length&&(r=ot(i,a.$data,t?null:a.$getters,Et))?Et===r[0]?r[1].get(r[2].join("."),t):!1===r[0]?r[1](e):r[1]:n},set:function(e,t,n,r){var i,a,u,l,o,s,c,f,d,h,m,p,v=this,g=!1;if(l=rt.test(e)?(e=nt(e)).split("."):[e],v._atomic&&e.sW(v.$atom))return v;if(a=v.$data,f=v.$types,d=v.$validators,h=v.$setters,1===l.length)u=e,c=(i=h[e]||h[N])?i.value:null,o=(i=f[e]||f[N])?i.value:null,s=(i=d[e]||d[N])?i.value:null,g=!0;else if(1<l.length){if(i=st(l,a,f,d,h,Et),a=i[1],u=i[2],o=at(i[4],u),s=at(i[5],u),c=at(i[6],u),Et===i[0])return u.length?(u=u.join("."),p=a.get(u),p!==t?a.set(u,t):n=!1):(p=a.data(),p!==t?a.data(t):n=!1),n&&(m={target:v,bracketkey:nt(e,1),key:e,value:t,valuePrev:p},r&&(m=L({},r,m)),v.publish("change",m)),v;if(!c&&!1===i[0]&&i[3].length)return v;g=!0}if(g){if(o&&(t=o(t,e)),s&&!s(t,e))return n&&(m={target:v,bracketkey:nt(e,1),key:e,value:t},r&&(r._error=!0,m=L({},r,m)),v.publish("error",m)),v;if(c)return c(e,t)&&(n&&(m={target:v,bracketkey:nt(e,1),key:e,value:t},r&&(m=L({},r,m)),v.publish("change",m)),v.$atom&&e===v.$atom&&(v._atomic=!0)),v;p=a[u],p!==t&&(a[u]=t,n&&(m={target:v,bracketkey:nt(e,1),key:e,value:t,valuePrev:p},r&&(m=L({},r,m)),v.publish("change",m)),v.$atom&&e===v.$atom&&(v._atomic=!0))}return v},append:function(e,t,n,r){var i,a,u,l,o,s,c,f,d=this,h=!1;if(l=rt.test(e)?(e=nt(e)).split("."):[e],d._atomic&&e.sW(d.$atom))return d;if(a=d.$data,types=d.$types,validators=d.$validators,setters=d.$setters,1===l.length)u=e,c=(i=setters[e]||setters[N])&&i.next[N]?i.next[N].value:null,o=(i=types[e]||types[N])&&i.next[N]?i.next[N].value:null,s=(i=validators[e]||validators[N])&&i.next[N]?i.next[N].value:null,h=!0;else if(1<l.length){if(i=st(l,a,types,validators,setters,Et),a=i[1],u=i[2],o=at(it(i[4],u),N),s=at(it(i[5],u),N),c=at(it(i[6],u),N),Et===i[0])return u.length?(u=u.join("."),a.append(u,t)):a.data(t),n&&(f={target:d,bracketkey:nt(e,1),key:e,value:t},r&&(f=L({},r,f)),d.publish("change",f)),d;if(!c&&!1===i[0]&&i[3].length)return d;h=!0}if(h){if(o&&(t=o(t,e)),s&&!s(t,e))return n&&(f={target:d,bracketkey:nt(e,1),key:e,value:t},r&&(r._error=!0,f=L({},r,f)),d.publish("error",f)),d;if(c)return c(e,t)&&(n&&(f={target:d,bracketkey:nt(e,1),key:e,value:t},r&&(f=L({},r,f)),d.publish("change",f)),d.$atom&&e===d.$atom&&(d._atomic=!0)),d;H===J(a[u])?a[u].push(t):a[u]=t,n&&(f={target:d,bracketkey:nt(e,1),key:e,value:t},r&&(f=L({},r,f)),d.publish("append",f),d.publish("change",f)),d.$atom&&e===d.$atom&&(d._atomic=!0)}return d},del:function(e,t,n){var r,i,a,u,l,o,s=this,c=!1;if(u=rt.test(e)?(e=nt(e)).split("."):[e],s._atomic&&e.sW(s.$atom))return s;if(i=s.$data,1===u.length)a=e,c=!0;else if(1<u.length){if(r=st(u,i,null,null,null,Et,!1),i=r[1],a=r[2],Et===r[0]&&a.length)return a=a.join("."),o=i.get(a),i.del(a),t&&(l={target:s,bracketkey:nt(e,1),key:e,value:o},n&&(l=L({},n,l)),s.publish("remove",l)),s.$atom&&e===s.$atom&&(s._atomic=!0),s;if(r[3].length)return s;c=!0}return c&&(o=i[a],delete i[a],t&&(l={target:s,bracketkey:nt(e,1),key:e,value:o},n&&(l=L({},n,l)),s.publish("remove",l)),s.$atom&&e===s.$atom&&(s._atomic=!0)),s},rem:function(e,t,r){var i,a,u,l,o,s,c,f=this,d=!1;if(l=rt.test(e)?(e=nt(e)).split("."):[e],f._atomic&&e.sW(f.$atom))return f;if(a=f.$data,1===l.length)u=e,d=!0;else if(1<l.length){if(i=st(l,a,null,null,null,Et,!1),a=i[1],u=i[2],Et===i[0]&&u.length)return u=u.join("."),s=a.get(u),a.rem(u),t&&(o={target:f,bracketkey:nt(e,1),key:e,value:s},r&&(o=L({},r,o)),f.publish("remove",o)),f.$atom&&e===f.$atom&&(f._atomic=!0),f;if(i[3].length)return f;d=!0}return d&&(s=a[u],a[u]=n,c=J(a),D==c?delete a[u]:H==c&&Z(u)&&a.splice(+u,1),t&&(o={target:f,bracketkey:nt(e,1),key:e,value:s},r&&(o=L({},r,o)),f.publish("remove",o)),f.$atom&&e===f.$atom&&(f._atomic=!0)),f},notify:function(e,t){return e&&this.publish(t||"change",{target:this,bracketkey:nt(e,1),key:nt(e),value:null}),this},atom:function(e){var t=this;return n!==e&&(!1===e?(t._atomic=!1,t.$atom=null):(t._atomic=!1,t.$atom=nt(e))),t},toString:function(){return this.toJSON()}});var wt=function(e,t,n){return[e?"["+e+"]":null,t?n?'input[name="'+t+'"],textarea[name="'+t+'"],select[name="'+t+'"]':'input[name^="'+t+'["],textarea[name^="'+t+'["],select[name^="'+t+'["]':null]},Ct=function(e,n,r,i){var a=e.$model,u=i.model;n.each(function(){var n,l,o,s,c,f,d=t(this),h=e.attr(d,"bind");if(h&&(n=e.eventaction(r.type,h),n&&n.action&&(l=n.event,o="do_"+n.action,!i.sync||"change"==l))){if(u){if(f=d.attr("name")||!1,s=f&&d.is("input,textarea,select")?a.getKey(f):n.key,!s||!s.sW(u.bracketkey)&&!s.sW(u.key))return;if(a._atomic&&s.sW(a.$atom))return}G(e[o],W)&&(c=n,e[o](r,d,c),n.complete&&G(e["do_"+n.complete],W)&&setTimeout(function(){e["do_"+n.complete](r,d,c)},10))}})},Rt=function(e,n,r,i){var a=e.$model,u={},l=i.model;e.do_bind&&n.each(function(){var n,i,o,s=t(this);if(n=s.attr("name")||!1){if(i=l&&l.key?l.key:a.getKey(n),l&&"value"in l)o=l.value;else{if(!i)return;if(u[i])o=u[i][0];else{if(!a.has(i))return;o=a.get(i),u[i]=[o]}}e.do_bind(r,s,{name:n,key:i,value:o})}})},Ot=function(e,t,n){var r=this;return r instanceof Ot?(r.id=e||dt("View"),r.namespace=r.id,r.$atts=n||{bind:"data-bind"},void r.model(t||new Et).initPubSub().init()):new Ot(e,t,n)};Ot._CACHE_SIZE=600,Ot._REFRESH_INTERVAL=k,Ot[i]=q(f(s[i]),mt,{constructor:Ot,id:null,$dom:null,$bind:null,$model:null,$bindbubble:!1,$autobind:!1,$template:null,$atts:null,$memoize:null,$selectors:null,dispose:function(){var e=this;return e.unbind(),e.$model&&(e.$model.dispose(),e.$model=null),e.$dom=null,e.$bind=null,e.$template=null,e.$atts=null,e.$memoize.dispose(),e.$memoize=null,e.$selectors.dispose(),e.$selectors=null,e.disposePubSub(),e},init:function(e){var t=this;return t.$bind=t.attribute("bind"),t.$memoize=new pt(Ot._CACHE_SIZE,Ot._REFRESH_INTERVAL),t.$selectors=new pt(Ot._CACHE_SIZE,Ot._REFRESH_INTERVAL),e&&t.publish("init",{target:t}),t},model:function(e){var t=this;return arguments.length?(t.$model&&t.$model.dispose(),t.$model=e.view(t),t):t.$model},attribute:function(e,t){var r=this;return arguments.length>1?(r.$atts[e]=t,r):e?r.$atts[e]||n:n},template:function(e){var t=this;return arguments.length?(G(e,W)&&(t.$template=e),t):t.$template},event:function(e,t){var r=this,i=e?"on_"+e.split(":").join("_"):null;return i&&n!==t?(r[i]=G(t,W)?t:null,r):i?r[i]:n},action:function(e,t){var r=this;return arguments.length>1?(r["do_"+e]=G(t,W)?t:null,r):e?r["do_"+e]||n:n},bindbubble:function(e){var t=this;return arguments.length?(t.$bindbubble=!!e,t):t.$bindbubble},autobind:function(e){var t=this;return arguments.length?(t.$autobind=!!e,t):t.$autobind},uuid:function(e){return dt(e)},get:function(e,r,i){var a,u=this,l=u.$selectors;return r=r?t(r):u.$dom,i?r.find(e):(a=l.get(e),n===a&&l.set(e,a=r.find(e)),a)},attr:function(e,t){var r,i=this,a=i.$atts[t],u=i.$memoize;return a&&Y(e,a)?(a=e.attr(a),r=u.get(a),n===r&&(r=R(a),r.text?(r.change={action:"set",prop:"text",key:r.text,domRef:r.domRef||null},delete r.text):r.html?(r.change={action:"set",prop:"html",key:r.html,domRef:r.domRef||null},delete r.html):r.value?(r.change={action:"set",prop:"value",key:r.value,domRef:r.domRef||null},delete r.value):r.options?(r.change={action:"set",prop:"options",key:r.options,domRef:r.domRef||null},delete r.options):r["class"]?(r.change={action:"set",prop:"class",key:r["class"],domRef:r.domRef||null},delete r["class"]):r.checked?(r.change={action:"set",prop:"checked",key:r.checked,domRef:r.domRef||null},delete r.checked):r.disabled?(r.change={action:"set",prop:"disabled",key:r.disabled,domRef:r.domRef||null},delete r.disabled):r.show?(r.change={action:"show",key:r.show,domRef:r.domRef||null},delete r.show):r.hide?(r.change={action:"hide",key:r.hide,domRef:r.domRef||null},delete r.hide):(r.css||r.attr||r.prop)&&(r.change={action:"set",key:r.key||null,domRef:r.domRef||null},r.css&&(r.change.css=r.css,delete r.css),r.attr&&(r.change.attr=r.attr,delete r.attr),r.prop&&(r.change.prop=r.prop,delete r.prop)),r.change&&"set"===r.change.action&&r.change.prop&&r.change.prop in T&&(r.change.prop=T[r.change.prop]),u.set(a,r)),r):n},eventaction:function(e,t){return e&&t&&t[e]?G(t[e],M)?{event:e,action:t[e]}:L({event:e},t[e]):null},getDomRef:function(e,n){return n&&"$this::"==n.slice(0,7)?t(n.slice(7),e):t(n)},unbind:function(e,n){var r,i,a=this,u=a.$model,l=wt(a.$bind,u.id),o=l[0],s=l[1];return e=e||null,i=n?t(n):a.$dom,a.on_view_change&&(r=function(e){return ht(e,a.namespace)},i.off(e&&e.length?e.map(r).join(" "):ht("",a.namespace),[s,o].join(","))),a.offFrom(u,"",null,a.namespace),a},uiEventHandler:function(e,n){var r=this,i=r.$model,a=wt(r.$bind,i.id),u=a[0],l=a[1],o=!1,s=!1,c=t(n),f=r.$bindbubble?r.attr(c,"bind"):null;return(e.target===n||r.$bindbubble&&f&&f.bubble)&&(s=r.$bindbubble?!!f:c.is(u),o=r.$autobind&&"change"==e.type&&c.is(l),(s||o)&&r.on_view_change(e,{el:c,_isBind:s,_isAutoBind:o})),!0},bind:function(e,n){var r,i,a,u=this,l=u.$model,o=wt(u.$bind,l.id),s=o[0],c=o[1];e=e||["change","click"],u.$dom=t(n||window.document),u.on_view_change&&e.length&&(a=function(e){return ht(e,u.namespace)},u.$dom.on(e.map(a).join(" "),[c,s].join(","),function(e){return u.uiEventHandler(e,this),!0}));for(r in u)G(u[r],W)&&/^on_model_/.test(r)&&(i=r.replace(/^on_model_/,""),i.length&&u.onTo(l,i,u[r],u.namespace));return u},sync:function(e){var n,r,i=this,a=i.$model,u=wt(i.$bind,a.id),l=u[0],o=u[1];return e=e?t(e):i.$dom,n=i.get(l,e,!0),r=i.get(o,e,!0),Ct(i,n,A("change"),{sync:!0}),i.$autobind&&Rt(i,r,A("change"),{sync:!0}),i},reset:function(){var e=this;return e.$memoize.reset(),e.$selectors.reset(),e},refresh:function(e,t){var n=this;return n.unbind(),n.$memoize.reset(),n.$selectors.reset(),n.bind(e,t),n},on_view_change:function(e,n){var r,i,a,u,l,o=this,s=o.$model,c=n.el,f={};n._isAutoBind&&c.attr("name")&&(r=c.attr("name"),i=nt(s.getKey(r))||!1,i&&s.has(i)&&(u=c.is(":checkbox"),u?(l=o.get('input[type="checkbox"][name="'+r+'"]'),l.length>1?(a=[],l.each(function(){var e,n=t(this);e=n.is(":checked")?n.val():"",a.push(e)})):a=l.is(":checked")?l.val():""):a=c.val(),f._triggerElement=c,s.set(i,a,1,f))),!f._error&&n._isBind&&Ct(o,c,e,n),o.publish("change",n)},on_model_error:function(e,t){var n,r,i,a=this,u=a.$model,l=u.id+t.bracketkey,o=wt(a.$bind,l,!0),s=o[0],c=o[1];n=a.get(s),r=a.get(c),i={model:t},Ct(a,n,e,i),a.$autobind&&Rt(a,r,e,i)},on_model_change:function(e,t){var n,r,i,a=this,u=a.$model,l=u.id+t.bracketkey,o=wt(a.$bind,l,!0),s=o[0],c=o[1];n=a.get(s),r=a.get(c),t._triggerElement&&(n=n.not(t._triggerElement),r=r.not(t._triggerElement)),i={model:t},Ct(a,n,e,i),a.$autobind&&Rt(a,r,e,i)},do_NOP:null,do_render:function(e,t,n){var r,i,a,u=this,l=n.key,o=n.tpl;u.$template&&l&&o&&(n.domRef&&(t=u.getDomRef(t,n.domRef)),t.length&&(r=u.$model,i=n.mode||"replace",l=r.getKey(l)||!1,l&&r.has(l)&&(value=r.get(l),"replace"==i&&t.empty(),a=u.$template(o,value),a&&t.append(a))))},do_set:function(e,t,n){if(n.key||n.css||n.attr){var r,i,a,u,l,o,s=this,c=s.$model,f=n.key||!1;if(n.domRef&&(t=s.getDomRef(t,n.domRef)),t.length){if(n.css&&(r={},G(n.css,D))){for(a in n.css)c.has(n.css[a])&&(r[a]=c.get(n.css[a]));t.css(r)}if(n.attr&&(r={},G(n.attr,D))){for(a in n.attr)c.has(n.attr[a])&&(r[a]=c.get(n.attr[a]));t.attr(r)}if(f&&(u=c.getKey(f)||!1,u&&c.has(u)&&(l=u?c.get(u):"",o=G(l,S),n.prop)))switch(i=n.prop){case T.options:if(t.is("select")&&G(l,H)){var d=t.find("optgroup"),h=t.val(),m="";d.length||(d=t),d.find("option").remove();for(var p=0;p<l.length;p++)m+=l[p]&&l[p].label?'<option value="'+l[p].value+'">'+l[p].label+"</option>":'<option value="'+l[p]+'">'+l[p]+"</option>";d.append(m),t.val(h)}break;case T.html:t.html(l);break;case T.text:t.text(l);break;case T["class"]:if(l&&l.length){var v=l.charAt(0);"-"==v?t.removeClass(l.slice(1)):"+"==v?t.addClass(l.slice(1)):t.hasClass(l)?t.hasClass(l)&&t.removeClass(l):t.addClass(l)}break;case T.value:t.val(l);break;default:T.checked==i?o?t.prop("checked",l):l==t.val()?t.prop("checked",!0):t.prop("checked",!1):T.disabled==i?o?t.prop("disabled",l):l==t.val()?t.prop("disabled",!0):t.prop("disabled",!1):t.attr(i,l)}}}},do_update:function(e,t,n){n.key&&"value"in n&&this.$model.set(this.$model.getKey(n.key),n.value,!0)},do_show:function(e,t,n){var r,i=this,a=i.$model;n.domRef&&(t=i.getDomRef(t,n.domRef)),t.length&&(n.key?(r=a.getKey(n.key),"value"in n?n.value===a.get(r)?t.show():t.hide():a.get(r)?t.show():t.hide()):t.show())},do_hide:function(e,t,n){var r,i=this,a=i.$model;n.domRef&&(t=i.getDomRef(t,n.domRef)),t.length&&(n.key?(r=a.getKey(n.key),"value"in n?n.value===a.get(r)?t.hide():t.show():a.get(r)?t.hide():t.show()):t.hide())},do_bind:function(e,n,r){{var i,a,u,l,o,s=this;s.$model}if(o=r.name,i=r.key||!1)if(a=r.value,u=G(a,S),l=n.val(),n.is(":radio"))a==l&&(s.get('input[name="'+o+'"]').not(n).prop("checked",!1),n.prop("checked",!0));else if(n.is(":checkbox")){var c=s.get('input[type="checkbox"][name="'+o+'"]');c.length>1&&G(a,H)?c.each(function(){var e=t(this);t.inArray(e.val(),a)>-1?e.prop("checked",!0):e.prop("checked",!1)}):u?n.prop("checked",a):a==l?n.prop("checked",!0):n.prop("checked",!1)}else n.val(a)},toString:function(){return"[ModelView.View id: "+this.id+"]"}}),e.ModelView={VERSION:"0.25",UUID:dt,Extend:q,Field:$t,Type:bt,Validation:yt,Cache:pt,Model:Et,View:Ot}}(t,e),!function(e,t){"use strict";var n=Function.prototype.call.bind(Array.prototype.slice),r={viewClass:e.View,modelClass:e.Model,id:"view",autobind:!1,bindbubble:!1,bindAttribute:"data-bind",model:{id:"model",data:{},types:{},validators:{},getters:{},setters:{}},template:null,events:null,actions:{},handlers:{}};t.ModelView=e,t.fn.modelview=function(e){var i=n(arguments),a=i.length?i.shift():null,u=!0,l=!1,o=[];return this.each(function(){var n,s,c,f=t(this);if(f.data("modelview")){if(u=!1,s=f.data("modelview"),n=s.$model,"view"===a)o.push(s);else if("model"===a){if(i.length)return n.apply(s,i),this;o.push(n)}else if("data"===a){if(i.length)return n.data.apply(s.$model,i),this;o.push(n.data())}else"dispose"===a?(f.data("modelview",null),s.dispose()):"sync"===a?s.sync.apply(s,i):"refresh"===a&&s.refresh.apply(s,i);return this}if(!l){var d=null;e.data&&(d=e.data,delete e.data),e=t.extend(!0,{},r,e),d&&(e.data=d),l=!0}if(!e.model)return this;if(n=new e.modelClass(e.model.id,e.model.data,e.model.types,e.model.validators,e.model.getters,e.model.setters),s=new e.viewClass(e.id,n,{bind:e.bindAttribute||"data-bind"}),e.template&&s.template(e.template),e.handlers)for(var h in e.handlers)c=e.handlers[h],c&&s.event(h,c);if(e.actions)for(var m in e.actions)c=e.actions[m],c&&s.action(m,c);f.data("modelview",s),s.bindbubble(e.bindbubble).autobind(e.autobind).bind(e.events,f)}),!u&&o.length?1==this.length?o[0]:o:this}}(t.ModelView,e),t.ModelView});
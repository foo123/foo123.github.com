/**
*
*   ModelView.js
*   @version: 0.43
*
*   A simple/extendable MV* (MVVM) framework
*   optionaly integrates into both jQuery as MVVM plugin and jQueryUI as MVC widget
*   https://github.com/foo123/modelview.js
*
**/!function(e,t,n){"use strict";var i,r="object"==typeof module&&module.exports,l="function"==typeof define&&define.amd;r?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||n.call(e,{NODE:module})||1:l&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,i,r){return n.call(e,{AMD:r})}):t in e||(e[t]=i=n.call(e,{})||1)&&l&&define(t,[],function(){return i})}(this,"ModelView",function(e){"use strict";function t(e,t){var n=[e||"",Mt];return t&&(n=n.concat(t)),n.join(".")}function n(e){return-1<zt.indexOf(e)}function i(e,t){return e.toLowerCase()===t.tagName.toLowerCase()}function r(e,t){return e===t.id}function l(e,t){return this.$element===window?t===document:this.$element===t}function o(e){var t=this;return t instanceof o?(e&&t.element(e),void(t.$handle=o.Handler.bind(t))):new o(e)}var a=void 0,u=function(e,t){return e.bind(t)},s="prototype",c=Array,f=c[s],d=RegExp,h=Number,v=Object,m=v[s],$=v.create,g=v.keys,p=Function,y=p[s],b=String,k=b[s],w=y.call,E=(u(w,m.hasOwnProperty),u(w,m.toString)),_=u(w,f.slice),O=function(e,t){return new p(e,t)},S=function(e,t){return e instanceof t},R=function(e){return b(e)},x=1/0,C=(Math.random,function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}),V=function(e,t,n){return e[t]=a,n||delete e[t],e},D=2,L=3,N=4,A=8,M=9,P=16,j=32,I=64,z=128,H=256,F=512,B=1024,U=P|j,q=P|A,W=function(e){var t,n;return null===e?H:!0===e||!1===e?N:(t=typeof e,n=E(e),a===e||"undefined"===t?F:e instanceof h||"number"===t?isNaN(e)?L:D:e instanceof b||"string"===t?1===e.length?M:A:e instanceof c||"[object Array]"===n?P:e instanceof d||"[object RegExp]"===n?z:e instanceof p||"function"===t&&"[object Function]"===n?I:"[object Object]"===n?j:B)},X=function(e,t){return!!(t&W(e))},J=function(e){return!isNaN(parseFloat(e,10))&&isFinite(e)},Q=function(e){return J(e)&&(e=+e,0===e%1&&e>=0)?!0:!1},Y=function(){var e,t,n,i,r,l,o,a=arguments;for(t=a[0]||{},e=a.length,l=1;e>l;l++)if(n=a[l],j===W(n))for(r in n)i=n[r],o=W(i),t[r]=D&o?0+i:q&o?i.slice(0):i;return t},Z="getAttribute",G="setAttribute",K="checked",et="disabled",tt="selected",nt="name",it="tagName",rt="type",lt="value",ot="options",at="selectedIndex",ut="parentNode",st="style",ct="innerHTML",ft="innerText",dt="textContent",ht=function(e,t){return f.slice.call((t||document).getElementsByTagName(e),0)},vt=function(e,t,n){return!0===n?[(t||document).querySelector(e)]:f.slice.call((t||document).querySelectorAll(e),0)},mt=function(e){return e?e.matches||e.matchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector:void 0}(this.Element?this.Element[s]:null),$t=function(e){return document.createTextNode(e||"")},gt=window.getComputedStyle?function(e){return window.getComputedStyle(e,null)}:function(e){return e.currentStyle},pt=function(e){e._displayCached||(e._displayCached=gt(e).display||"block"),e[st].display="none"!==e._displayCached?e._displayCached:"block",e._displayCached=a},yt=function(e){e._displayCached||(e._displayCached=gt(e).display||"block"),e[st].display="none"},bt=function(e){var t=e.attributes[lt];return!t||t.specified?e[lt]:e.text},kt=function(e){for(var t,n,i=e[ot],r=e[at],l="select-one"===e[rt]||0>r,o=l?null:[],a=l?r+1:i.length,u=0>r?a:l?r:0;a>u;u++)if(n=i[u],!(!n[tt]&&u!==r||n[et]||n[ut][et]&&"optgroup"===n[ut][it])){if(t=bt(n),l)return t;o.push(t)}return o},wt=function(e,t){var n,i,r=[].concat(t).map(R),l=e[ot];for(i=0;i<l.length;i++)n=l[i],n[tt]=-1<r.indexOf(bt(n));r.length||(e[at]=-1)},Et=function(e){if(e)switch(e[it].toLowerCase()){case"textarea":case"input":return e[lt];case"select":return kt(e);default:return dt in e?e[dt]:e[ft]}},_t=function(e,t){if(e)switch(e[it].toLowerCase()){case"textarea":case"input":e[lt]=b(t);break;case"select":wt(e,t);break;default:dt in e?e[dt]=b(t):e[ft]=b(t)}},Tt=function(e){return e.length>0},Ot=/\s+/g,St=function(e){var t=e.split("."),n=t[0];return t=t.slice(1).filter(Tt),[n,t.sort()]},Rt=function(e){return e.length?new d("(^|\\.)"+e.join("\\.(?:.*\\.|)")+"(\\.|$)"):!1},xt=JSON.parse,Ct=JSON.stringify,Vt=k.trim?function(e){return e.trim()}:function(e){return e.replace(/^\s+|\s+$/g,"")},Dt=k.startsWith?function(e,t,n){return e.startsWith(t,n)}:function(e,t,n){return n=n||0,t===e.substr(n,t.length+n)},Lt=Date.now?Date.now:function(){return(new Date).getTime()},Nt=function(e,t){this.v=e||null,this.n=t||{}},At="*",Mt="modelview",Pt=0,jt=function(e){return[e||"UUID",++Pt,Lt()].join("_")};this.Element&&this.Element[s].attachEvent&&!this.Element[s].addEventListener&&!function(){function e(e,t){Window[s][e]=HTMLDocument[s][e]=Element[s][e]=t}e("addEventListener",function(e,t){var n=this,i=n.addEventListener.listeners=n.addEventListener.listeners||{},r=i[e]=i[e]||[];r.length||n.attachEvent("on"+e,r.event=function(e){var t=n.document&&n.document.documentElement||n.documentElement||{scrollLeft:0,scrollTop:0};e.currentTarget=n,e.pageX=e.clientX+t.scrollLeft,e.pageY=e.clientY+t.scrollTop,e.preventDefault=function(){e.returnValue=!1},e.relatedTarget=e.fromElement||null,e.stopImmediatePropagation=function(){a=!1,e.cancelBubble=!0},e.stopPropagation=function(){e.cancelBubble=!0},e.target=e.srcElement||n,e.timeStamp=+new Date;for(var i,l=0,o=[].concat(r),a=!0;a&&(i=o[l]);++l)for(var u,s=0;u=r[s];++s)if(u==i){u.call(n,e);break}}),r.push(t)}),e("removeEventListener",function(e,t){for(var n,i=this,r=i.addEventListener.listeners=i.addEventListener.listeners||{},l=r[e]=r[e]||[],o=l.length-1;n=l[o];--o)if(n==t){l.splice(o,1);break}!l.length&&l.event&&i.detachEvent("on"+e,l.event)}),e("dispatchEvent",function(e){var t=this,n=e.type,i=t.addEventListener.listeners=t.addEventListener.listeners||{},r=i[n]=i[n]||[];try{return t.fireEvent("on"+n,e)}catch(l){return void(r.event&&r.event(e))}})}();var It="DOMEVENT_STOPPED",zt=["blur","error","focus","focusin","focusout","load","resize","scroll"];o.Handler=function(e){if(!e[It]){var t,n,i,r,l,o,a,u=this,s=e.type,c=e.target,f=[];switch(c&&3===c.nodeType&&(c=c.parentNode),r=u.$element,i=r.$listeners,l=e.eventPhase||(e.target!==e.currentTarget?3:2)){case 1:f=i[1][s];break;case 2:i[0]&&i[0][s]&&(f=f.concat(i[0][s])),i[1]&&i[1][s]&&(f=f.concat(i[1][s]));break;case 3:f=i[0][s]}for(n=f.length;n&&c;){for(t=0;n>t&&(o=f[t],o);t++)if(o.matcher.call(c,o.matcherParam,c)&&(a=o.handler.call(c,e,c)),!1===a||!1===e.returnValue)return e[It]=!0,void e.preventDefault();if(r===c)break;n=f.length,c=c.parentElement}}},o[s]={constructor:o,$element:null,$handle:null,dispose:function(){var e=this;return e.off().element(),e.$element=null,e.$handle=null,e},element:function(e){var t,n,i,r=this,l=r.$element;if(l){for(t=l.$listeners,n=g(t[1]),i=0;i<n.length;i++)l.removeEventListener(n[i],r.$handle,!0);for(n=g(t[0]),i=0;i<n.length;i++)l.removeEventListener(n[i],r.$handle,!1);l.$listeners=a}return e&&e.addEventListener?(r.$element=e,e.$listeners=e.$listeners||[{},{}],r):(r.$element=null,r)},on:function(e,t,o,u){var s,c,f,d,h,v,m,$,g=this;if(s=g.$element,!s)return g;if(!e)throw new TypeError("Invalid event type: "+e);if(m=e.split(Ot).map(St),!m.length)return g;if("function"==typeof t&&(u=o,o=t,t=null),"function"!=typeof o)throw new TypeError("Handler must be a type of Function");for(d=0,h=m.length;h>d;d++)$=a===u?n(m[d][0]):!!u,c=s.$listeners[$?1:0],c[m[d][0]]||(c[m[d][0]]=[],s.addEventListener(m[d][0],g.$handle,$)),t?/^[a-z]+$/i.test(t)?(v=t,f=i):/^#[a-z0-9\-_]+$/i.test(t)?(v=t.slice(1),f=r):(v=t,f=mt):(v=null,f=l.bind(g)),c[m[d][0]].push({selector:t,handler:o,matcher:f,matcherParam:v,namespace:m[d][1].join(".")});return g},off:function(e,t,n,i){var r,l,o,u,s,c,f,d,h,v,m=this,$=m.$element,g=!1;if(!$)return m;if("function"==typeof t&&(i=n,n=t,t=null),g=a===i?[0,1]:i?[1]:[0],v=e?e.split(/\s+/g).map(St):[],v.length){for(c=0;c<g.length;c++)for(o=$.$listeners[g[c]],s=0;s<v.length;s++)if(d=v[s][1],f=v[s][0],h=Rt(d),f.length){if(u=o[f],!u||!u.length)continue;for(r=u.length-1;r>=0;r--)l=u[r],t&&t!==l.selector||n&&n!==l.handler||h&&!h.test(l.namespace)||u.splice(r,1);u.length||(delete o[f],$.removeEventListener(f,m.$handle,!!g[c]))}else for(f in o)if(u=o[f],u&&u.length){for(r=u.length-1;r>=0;r--)l=u[r],t&&t!==l.selector||n&&n!==l.handler||h&&!h.test(l.namespace)||u.splice(r,1);u.length||(delete o[f],$.removeEventListener(f,m.$handle,!!g[c]))}}else for(c=0;c<g.length;c++){o=$.$listeners[g[c]];for(f in o)if(u=o[f],u&&u.length){for(r=u.length-1;r>=0;r--)l=u[r],t&&t!==l.selector||n&&n!==l.handler||u.splice(r,1);u.length||(delete o[f],$.removeEventListener(f,m.$handle,!!g[c]))}}return m}};var Ht=2,Ft=function(e,t,n){var i=this;return i instanceof Ft?(i.type=e,i.target=t,i.currentTarget=t,i.timeStamp=Lt(),i.eventPhase=Ht,void(i.namespace=n||null)):new Ft(e,t,n)};Ft[s]={constructor:Ft,type:null,target:null,currentTarget:null,timeStamp:null,eventPhase:Ht,bubbles:!1,cancelable:!1,namespace:null,stopPropagation:function(){this.bubbles=!1},preventDefault:function(){}};var Bt={$PB:null,namespace:null,initPubSub:function(){var e=this;return e.$PB={},e},disposePubSub:function(){var e=this;return e.$PB=null,e},trigger:function(e,t){var n,i,r,l,o,a=this,u=a.$PB;if(o=St(e),e=o[0],(n=u[e])&&(l=n.length)){for(i=n.slice(0),o=o[1].join("."),e=new Ft(e,a,o),r=0;l>r&&(i[r][3]=1,!1!==i[r][0](e,t));r++);if((n=u[e])&&(l=n.length))if(n.oneOffs>0)for(r=l-1;r>=0;r--)i=n[r],i[2]&&i[3]&&(n.splice(r,1),n.oneOffs=n.oneOffs>0?n.oneOffs-1:0);else n.oneOffs=0}return a},on:function(e,t,n){var i,r,l,o,a=this,u=a.$PB;if(e&&e.length&&X(t,I)){if(n=!!n,r=e.split(Ot).map(St),!(o=r.length))return a;for(l=0;o>l;l++)e=r[l][0],i=r[l][1].join("."),u[e]||(u[e]=[],u[e].oneOffs=0),u[e].push([t,i,n,0]),n&&u[e].oneOffs++}return a},onTo:function(e,t,n,i){var r=this;return X(n,I)&&(n=u(n,r)),e.on(t,n,i),r},off:function(e,t){var n,i,r,l,o,a,u,s,c,f,d=this,h=d.$PB;if(e&&e.length){for(u=X(t,I),s=e.split(Ot).map(St),c=0,f=s.length;f>c;c++)if(e=s[c][0],a=Rt(s[c][1]),e.length){if((n=h[e])&&(l=n.length))for(r=l-1;r>=0;r--)o=n[r],u&&t!==o[0]||a&&!a.test(o[1])||(o[2]&&(n.oneOffs=n.oneOffs>0?n.oneOffs-1:0),n.splice(r,1))}else if(u||a)for(i in h)if(n=h[i],n&&(l=n.length))for(r=l-1;r>=0;r--)o=n[r],u&&t!==o[0]||a&&!a.test(o[1])||(o[2]&&(n.oneOffs=n.oneOffs>0?n.oneOffs-1:0),n.splice(r,1))}else for(i in h)delete h[i];return d},offFrom:function(e,t,n){var i=this;return e.off(t,n),i}};Bt.publish=Bt.trigger;var Ut=function(e,t){var n=this,i=arguments.length;n.$store={},n.$size=x,n.$interval=x,i>0&&e>0&&(n.$size=e),i>1&&t>0&&(n.$interval=t)};Ut[s]={constructor:Ut,$store:null,$size:null,$interval:null,dispose:function(){var e=this;return e.$store=null,e.$size=null,e.$interval=null,e},reset:function(){return this.$store={},this},size:function(e){return arguments.length?(e>0&&(this.$size=e),this):this.$size},interval:function(e){return arguments.length?(e>0&&(this.$interval=e),this):this.$interval},has:function(e){var t=this,n=e?t.$store[e]:null;return!!(n&&Lt()-n.time<=t.$interval)},get:function(e){if(e){var t=this,n=t.$store[e];if(n)return Lt()-n.time>t.$interval?(delete t.$store[e],a):n.data}return a},set:function(e,t){var n,i,r,l=this;if(e){for(n=l.$store,i=l.$size,r=g(n);r.length>=i;)delete n[r.shift()];n[e]={data:t,time:Lt()}}return l},del:function(e){return e&&this.$store[e]&&delete this.$store[e],this},toString:function(){return"[ModelView.Cache]"}};var qt=function(e){return S(this,qt)?void(this.f=e||null):new qt(e)},Wt=function(e){return S(this,Wt)?void(this.f=e||null):new Wt(e)},Xt=function(e){var t,n;for(t in e)n=e[t],S(n,Wt)?(e[t]=n.f,e[t].fEach=1):e[t]=n;return e},Jt=function Sn(e){return e.BEFORE=function(t){return Sn(function(n,i){var r=this;return t.call(r,e.call(r,n,i),i)})},e.AFTER=function(t){return Sn(function(n,i){var r=this;return e.call(r,t.call(r,n,i),i)})},e},Qt=function Rn(e){return e.NOT=function(){return Rn(function(t,n){return!e.call(this,t,n)})},e.AND=function(t){return Rn(function(n,i){var r=this;return e.call(r,n,i)&&t.call(r,n,i)})},e.OR=function(t){return Rn(function(n,i){var r=this;return e.call(r,n,i)||t.call(r,n,i)})},e.XOR=function(t){return Rn(function(n,i){var r=this,l=e.call(r,n,i),o=t.call(r,n,i);return l&&!o||o&&!l})},e},Yt={TypeCaster:Jt,Cast:{EACH:Wt,FIELDS:function(e){return e=Xt(Y({},e||{})),Jt(function(t){var n,i,r,l,o,a=this;for(n in e)if(i=e[n],r=t[n],i.fEach&&X(r,P)){for(l=r.length,o=0;l>o;o++)r[o]=i.call(a,r[o]);t[n]=r}else t[n]=i.call(a,r);return t})},DEFAULT:function(e){return Jt(function(t){var n=W(t);return(F&n||A&n&&!Vt(t).length)&&(t=e),t})},BOOL:Jt(function(e){return!!e}),INT:Jt(function(e){return parseInt(e,10)}),FLOAT:Jt(function(e){return parseFloat(e,10)}),MIN:function(e){return Jt(function(t){return e>t?e:t})},MAX:function(e){return Jt(function(t){return t>e?e:t})},CLAMP:function(e,t){if(e>t){var n=t;t=e,e=n}return Jt(function(n){return e>n?e:n>t?t:n})},TRIM:Jt(function(e){return Vt(b(e))}),LCASE:Jt(function(e){return b(e).toLowerCase()}),UCASE:Jt(function(e){return b(e).toUpperCase()}),STR:Jt(function(e){return""+e})},add:function(e,t){return X(e,A)&&X(t,I)&&(Yt.Cast[e]=X(t.AFTER,I)?t:Jt(t)),Yt},del:function(e){return X(e,A)&&Yt.Cast[e]&&delete Yt.Cast[e],Yt},toString:function(){return"[ModelView.Type]"}},Zt={Validator:Qt,Validate:{EACH:Wt,FIELDS:function(e){return e=Xt(Y({},e||{})),Qt(function(t){var n,i,r,l,o,a=this;for(n in e)if(i=e[n],r=t[n],i.fEach&&X(r,P)){for(l=r.length,o=0;l>o;o++)if(!i.call(a,r[o]))return!1}else if(!i.call(a,r))return!1;return!0})},NUMERIC:Qt(function(e){return J(e)}),NOT_EMPTY:Qt(function(e){return!!(e&&0<Vt(b(e)).length)}),MAXLEN:function(e){return Qt(O("v","return v.length <= "+e+";"))},MINLEN:function(e){return Qt(O("v","return v.length >= "+e+";"))},MATCH:function(e){return Qt(function(t){return e.test(t)})},NOT_MATCH:function(e){return Qt(function(t){return!e.test(t)})},EQUAL:function(e,t){return Qt(S(e,qt)?O("v","return this.$data."+e.f+" "+(!1!==t?"===":"==")+" v;"):!1!==t?function(t){return e===t}:function(t){return e==t})},NOT_EQUAL:function(e,t){return Qt(S(e,qt)?O("v","return this.$data."+e.f+" "+(!1!==t?"!==":"!=")+" v;"):!1!==t?function(t){return e!==t}:function(t){return e!=t})},GREATER_THAN:function(e,t){return S(e,qt)?e="this.$data."+e.f:X(e,A)&&(e='"'+e+'"'),Qt(O("v","return "+e+" "+(!1!==t?"<":"<=")+" v;"))},LESS_THAN:function(e,t){return S(e,qt)?e="this.$data."+e.f:X(e,A)&&(e='"'+e+'"'),Qt(O("v","return "+e+" "+(!1!==t?">":">=")+" v;"))},BETWEEN:function(e,t,n){X(e,P)&&(n=t,t=e[1],e=e[0]);var i,r=S(e,qt),l=S(t,qt);return!r&&!l&&e>t&&(i=t,t=e,e=i),e=r?"this.$data."+e.f:X(e,A)?'"'+e+'"':e,t=l?"this.$data."+t.f:X(t,A)?'"'+t+'"':t,Qt(!1!==n?O("v","return ( "+e+" < v ) && ( "+t+" > v );"):O("v","return ( "+e+" <= v ) && ( "+t+" >= v );"))},NOT_BETWEEN:function(e,t,n){X(e,P)&&(n=t,t=e[1],e=e[0]);var i,r=S(e,qt),l=S(t,qt);return!r&&!l&&e>t&&(i=t,t=e,e=i),e=r?"this.$data."+e.f:X(e,A)?'"'+e+'"':e,t=l?"this.$data."+t.f:X(t,A)?'"'+t+'"':t,Qt(!1!==n?O("v","return ( "+e+" > v ) || ( "+t+" < v );"):O("v","return ( "+e+" >= v ) || ( "+t+" <= v );"))},IN:function(){var e=_(arguments);return X(e[0],P)&&(e=e[0]),Qt(function(t){return-1<e.indexOf(t)})},NOT_IN:function(){var e=_(arguments);return X(e[0],P)&&(e=e[0]),Qt(function(t){return 0>e.indexOf(t)})}},add:function(e,t){return X(e,A)&&X(t,I)&&(Zt.Validate[e]=X(t.XOR,I)?t:Qt(t)),Zt},del:function(e){return X(e,A)&&Zt.Validate[e]&&delete Zt.Validate[e],Zt},toString:function(){return"[ModelView.Validation]"}},Gt=function(e,t){if(!e)return null;var n,i,r=[],l=e.length;for(n=0;l>n;n++)i=e[n],i&&(i[t]&&r.push(i[t].n),i[At]&&r.push(i[At].n));return r.length?r:null},Kt=function(e,t){if(!e)return null;var n,i,r=e.length;if(t){for(n=0;r>n;n++)if(i=e[n]){if(i[t]&&i[t].v)return i[t].v;if(i[At]&&i[At].v)return i[At].v}}else for(n=0;r>n;n++)if(i=e[n],i&&i.v)return i.v;return null},en=function(e,t,n,i){for(var r,l=n,o=0,a=t.length;a>o;)r=t[o++],r in l||(l[r]=new Nt),l=l[r],a>o?l=l.n:i?(At in l.n||(l.n[At]=new Nt),l.n[At].v=e):l.v=e;return n},tn=function(e,t,n,i){for(var r,l,o=t,a=n?[n]:null,u=0,s=e.length;s>u;){if(r=e[u++],l=W(o),!(s>u))return a&&Kt(a,r)?!0:l&U&&r in o?!0:j===l&&"length"==r?!0:!1;if(l&U&&r in o){if(o=o[r],o instanceof i)return[i,o,e.slice(u)];a&&(a=Gt(a,r))}else if(!a||!(a=Gt(a,r)))return!1}return!1},nn=function(e,t,n,i){for(var r,l,o=t,a=n?[n]:null,u=0,s=e.length;s>u;){if(r=e[u++],l=W(o),!(s>u))return a&&(a=Kt(a,r))?[!1,a]:l&U&&r in o?[!0,o[r]]:j===l&&"length"==r?[!0,g(o).length]:!1;if(l&U&&r in o){if(o=o[r],o instanceof i)return[i,o,e.slice(u)];a&&(a=Gt(a,r))}else if(!a||!(a=Gt(a,r)))return!1}return!1},rn=function(e,t,n,i,r,l,o){var a,u,s=t,c=null,f=null,d=null,h=0,v=e.length;for(o=!1!==o,o&&(c=[n],f=[i],d=[r]);v>h;)if(a=e[h++],u=W(s),v>h)if(u&U&&a in s){if(s=s[a],s instanceof l)return[l,s,e.slice(h),0,null,null,null];o&&(c=Gt(c,a),f=Gt(f,a),d=Gt(d,a))}else{if(!(o&&d&&(d=Gt(d,a))))return[!1,s,a,e,null,null,null];c=Gt(c,a),f=Gt(f,a)}else if(u&U)return s[a]instanceof l?[l,s[a],e.slice(h),0,null,null,null]:a in s?[!0,s,a,e.slice(h),c,f,d]:[!1,s,a,e.slice(h),c,f,d];return[!1,s,a,e.slice(h),null,null,null]},ln=function(e){return e.replace(/\[([^\]]*)\]/g,".$1").replace(/^\.+/,"").replace(/\.+$/,"")},on=function(e){return"["+e.split(".").join("][")+"]"},an=function(e){var t=new d("^"+e+"([\\.|\\[])");return function(e,n){var i=e.replace(t,"$1");return n?ln(i):i}},un=function(e,t,n,i){var r,l,o=!1;if(l=W(n),I&l)o=S(n,Wt),o&&(n=n.f),en(n,-1<t.indexOf(".")?t.split("."):[t],i,o);else if(U&l)for(r in n)un(e,t+"."+r,n[r],i)},sn=function(e,t,n,i){var r,l;if(l=W(n),I&l)en(n,-1<t.indexOf(".")?t.split("."):[t],i);else if(U&l)for(r in n)sn(e,t+"."+r,n[r],i)},cn=function(e,t,n){for(var i,r;t instanceof e;)t=t.data();if(r=n||W(t),t=j&r?Y({},t):P&r?t.slice(0):t,U&r)for(i in t)t[i]instanceof e?t[i]=cn(e,Y({},t[i].data())):U&(r=W(t[i]))&&(t[i]=cn(e,t[i],r));return t},fn=function(e,t){var n,i,r,l,o,a,u,s,c,f,d,h,v,m,$,p=e.target,y=p.$syncTo,b=t.key;if(b){for(i=b+".",r=g(y),l=r.length,v=p.atomic,m=p.$atom,p.atomic=!0,p.$atom=b,s=0;l>s;s++)if(c=r[s],c===b||Dt(c,i))for(f=y[c],n=p.get(c),d=0,h=f.length;h>d;d++)a=f[d][0],o=f[d][1],p.__syncing[a.$id]=p.__syncing[a.$id]||[],$=p.__syncing[a.$id],0>$.indexOf(o)&&($.push(o),(u=f[d][2])?u.call(a,o,n,c,p):a.set(o,n,1),$.pop());p.$atom=m,p.atomic=v}},dn=function(e,t,n,i,r,l){var o=this;return o instanceof dn?(o.$id=jt("Model"),o.namespace=o.id=e||o.$id,o.key=an(o.id),o.$view=null,o.atomic=!1,o.$atom=null,o.$types={},o.$validators={},o.$getters={},o.$setters={},o.$syncTo={},void o.data(t||{}).types(n).validators(i).getters(r).setters(l).initPubSub()):new dn(e,t,n,i,r,l)};dn.count=function(e){if(!arguments.length)return 0;var t=W(e);return j===t?g(e).length:P===t?e.length:F!==t?1:0},dn[s]=Y($(v[s]),Bt,{constructor:dn,id:null,$id:null,$view:null,$data:null,$types:null,$validators:null,$getters:null,$setters:null,atomic:!1,$atom:null,$syncTo:null,$syncHandler:null,__syncing:null,dispose:function(){var e=this;return e.disposePubSub().$view=null,e.$data=null,e.$types=null,e.$validators=null,e.$getters=null,e.$setters=null,e.atomic=!1,e.$atom=null,e.key=null,e.$syncTo=null,e.$syncHandler=null,e.__syncing=null,e},isValid:function(){return!0},view:function(e){var t=this;return arguments.length?(t.$view=e,t):t.$view},data:function(e){var t=this;return arguments.length?(t.$data=e,t):t.$data},types:function(e){var t,n=this;if(X(e,j))for(t in e)un(n,t,e[t],n.$types);return n},validators:function(e){var t,n=this;if(X(e,j))for(t in e)un(n,t,e[t],n.$validators);return n},getters:function(e){var t,n=this;if(X(e,j))for(t in e)sn(n,t,e[t],n.$getters);return n},setters:function(e){var t,n=this;if(X(e,j))for(t in e)sn(n,t,e[t],n.$setters);return n},serialize:function(){return cn(dn,this.$data)},toJSON:function(e){var t,n,i,r=this;n=arguments.length?r.get(e):r.data();try{t=Ct(cn(dn,n))}catch(i){throw i}return t},fromJSON:function(e,t,n){var i,r,l=this;if(e){try{i=xt(e)}catch(r){throw r}t?l.set(t,i,!0===n):l.data(i)}return l},has:function(e,t){var n,i=this,r=i.$getters;return 0>e.indexOf(".")&&(e in i.$data||!t&&(n=r[e]||r[At])&&n.v)?!0:(n=tn(e.split("."),i.$data,t?null:r,dn))?!0===n?!0:n[1].has(n[2].join(".")):!1},get:function(e,t){var n,i=this,r=i.$getters;return 0>e.indexOf(".")?!t&&(n=r[e]||r[At])&&n.v?n.v.call(i,e):i.$data[e]:(n=nn(e.split("."),i.$data,t?null:r,dn))?dn===n[0]?n[1].get(n[2].join("."),t):!1===n[0]?n[1].call(i,e):n[1]:a},set:function(e,t,n,i){var r,l,o,a,u,s,c,f,d,h,v=this,m=!1;if(v.atomic&&Dt(e,v.$atom))return v;if(l=v.$data,c=v.$types,f=v.$validators,d=v.$setters,0>e.indexOf("."))o=e,s=(r=d[o])?r.v:null,a=(r=c[o]||c[At])?r.v:null,u=(r=f[o]||f[At])?r.v:null,m=!0;else if(r=rn(e.split("."),l,c,f,d,dn)){if(l=r[1],o=r[2],a=Kt(r[4],o),u=Kt(r[5],o),s=Kt(r[6],o),dn===r[0])return o.length?(o=o.join("."),h=l.get(o),h!==t?l.set(o,t,n,i):n=!1):(h=l.data(),h!==t?l.data(t):n=!1),n&&v.publish("change",{key:e,value:t,valuePrev:h,$callData:i}),v;if(!s&&!1===r[0]&&r[3].length)return v;m=!0}if(m){if(a&&(t=a.call(v,t,e)),u&&!u.call(v,t,e))return n&&(i&&(i.error=!0),v.publish("error",{key:e,value:l[o],$callData:i})),v;if(s)return s.call(v,e,t,n)&&(n&&v.publish("change",{key:e,value:t,$callData:i}),v.$atom&&e===v.$atom&&(v.atomic=!0)),v;h=l[o],h!==t&&(l[o]=t,n&&v.publish("change",{key:e,value:t,valuePrev:h,$callData:i}),v.$atom&&e===v.$atom&&(v.atomic=!0))}return v},add:function(e,t,n,i){var r,l,o,u,s,c,f=this,d=!1;if(f.atomic&&Dt(e,f.$atom))return f;if(l=f.$data,types=f.$types,validators=f.$validators,setters=f.$setters,0>e.indexOf("."))o=e,c=(r=setters[o])&&r.n[At]?r.n[At].v:null,u=(r=types[o]||types[At])&&r.n[At]?r.n[At].v:null,s=(r=validators[o]||validators[At])&&r.n[At]?r.n[At].v:null,d=!0;else if(r=rn(e.split("."),l,types,validators,setters,dn)){if(l=r[1],o=r[2],u=Kt(Gt(r[4],o),At),s=Kt(Gt(r[5],o),At),c=Kt(Gt(r[6],o),At),dn===r[0])return o.length?(o=o.join("."),l.add(o,t,n,i)):l.data(t),n&&f.publish("append",{key:e,value:t,$callData:i}),f;if(!c&&!1===r[0]&&r[3].length)return f;d=!0}if(d){if(u&&(t=u.call(f,t,e)),s&&!s.call(f,t,e))return n&&(i&&(i.error=!0),f.publish("error",{key:e,value:a,$callData:i})),f;if(c)return c.call(f,e,t,n)&&(n&&f.publish("append",{key:e,value:t,$callData:i}),f.$atom&&e===f.$atom&&(f.atomic=!0)),f;P===W(l[o])?l[o].push(t):l[o]=t,n&&f.publish("append",{key:e,value:t,$callData:i}),f.$atom&&e===f.$atom&&(f.atomic=!0)}return f},del:function(e,t,n,i){var r,l,o,u,s=this,c=!1;if(s.atomic&&Dt(e,s.$atom))return s;if(t=!!t,l=s.$data,0>e.indexOf("."))o=e,c=!0;else if(r=rn(e.split("."),l,null,null,null,dn,!1)){if(l=r[1],o=r[2],dn===r[0]&&o.length)return o=o.join("."),u=l.get(o),l.del(o,t,n,i),n&&s.publish("delete",{key:e,value:u,$callData:i}),s.$atom&&e===s.$atom&&(s.atomic=!0),s;if(r[3].length)return s;c=!0}return c&&(u=l[o],t?(l[o]=a,T=W(l),P==T&&Q(o)?l.splice(+o,1):j==T&&delete l[o]):delete l[o],n&&s.publish("delete",{key:e,value:u,$callData:i}),s.$atom&&e===s.$atom&&(s.atomic=!0)),s},sync:function(e,t){var n,i,r,l,o,a,u=this;for(n in t){for(i=t[n],u.$syncTo[n]=u.$syncTo[n]||[],r=null,P===W(i)&&(r=i[1]||null,i=i[0]),l=u.$syncTo[n],a=1,o=l.length-1;o>=0;o--)if(e===l[o][0]&&i===l[o][1]){l[o][2]=r,a=0;break}a&&l.push([e,i,r])}return u.$syncHandler||(u.__syncing=u.__syncing||{},u.on("change",u.$syncHandler=fn)),u},unsync:function(e){var t,n,i,r=this,l=r.$syncTo;for(t in l)if((n=l[t])&&n.length)for(i=n.length-1;i>=0;i--)e===n[i][0]&&(r.__syncing&&r.__syncing[e.$id]&&V(r.__syncing,e.$id),n.splice(i,1));return r},notify:function(e,t,n){var i,r,l,o,a=this;if(e)if(o=W(e),t=t||"change",A===o)l={key:e},n&&(n.hasOwnProperty("value")&&(l.value=n.value),n.hasOwnProperty("$callData")&&(l.$callData=n.$callData)),a.publish(t,l);else if(P===o)for(l={key:""},n&&(n.hasOwnProperty("value")&&(l.value=n.value),n.hasOwnProperty("$callData")&&(l.$callData=n.$callData)),r=e.length,i=0;r>i;i++)l.key=e[i],a.publish(t,l);return a},atom:function(e){var t=this;return a!==e&&(!1===e?(t.atomic=!1,t.$atom=null):(t.atomic=!1,t.$atom=e)),t},toString:function(){return"[ModelView.Model id: "+this.id+"]"}}),dn[s].append=dn[s].add,dn[s].rem=dn[s].del;var hn=function(e,t){return new d(C(e).replace("__MODEL__",C(t||"")).replace("__KEY__","(\\S+?)"),"")},vn=function(e){var t,n=e.length,i=n?e[0].nodeValue:"";if(n>1)for(t=1;n>t;t++)i+=e[t].nodeValue;return i},mn="mv_namedkey",$n="mv_uuid",gn=0,pn=function(e){return e[$n]=e[$n]||e.id||(++gn).toString(16)},yn=function(e,t,n){var i;return t&&(i=e[$n])&&t[i]&&V(t,i),e[Z](n)&&e.removeAttribute(n),t},bn=function(e,t,n,i){if(!t)return n;var r,l,o,a,u,s,c,f,d,h,v,m,$,p,y,b,k,w,E;if(n=n||{},e){if(r=[],l=[],c=e,c.attributes&&(a=c.attributes.length))for(o=0;a>o;o++)f=c.attributes[o],(u=f.nodeValue.match(t))&&l.push([f,u,c]);if(3===c.nodeType)(u=c.nodeValue.match(t))&&r.push([c,u,c[ut]]);else if(c.firstChild)for(k=[c=c.firstChild];k.length;){if(c.attributes&&(a=c.attributes.length))for(o=0;a>o;o++)f=c.attributes[o],(u=f.nodeValue.match(t))&&l.push([f,u,c]);if(c.firstChild)k.push(c=c.firstChild);else{for(3===c.nodeType&&(u=c.nodeValue.match(t))&&r.push([c,u,c[ut]]),c=k.pop();k.length&&!c.nextSibling;)c=k.pop();c.nextSibling&&k.push(c=c.nextSibling)}}for(v={},o=0,a=r.length;a>o;o++)if(s=r[o],b=s[0],u=s[1],c=s[2],h=pn(c),n[h]=n[h]||{},v[h]=c,n[h].keys=n[h].keys||{},w=n[h].keys,y=b.nodeValue,y.length>u[0].length){do d=u[1],m=b.splitText(u.index),b=m.splitText(u[0].length),(w[d]=w[d]||[]).push(m),u=b.nodeValue.match(t);while(u)}else d=u[1],m=b,(w[d]=w[d]||[]).push(m);for($={},o=0,a=l.length;a>o;o++)if(s=l[o],f=s[0],u=s[1],c=s[2],h=pn(c),n[h]=n[h]||{},v[h]=c,n[h].keys=n[h].keys||{},w=n[h].keys,n[h].atts=n[h].atts||{},E=n[h].atts,y=f.nodeValue,p=y in $)for(u=0;u<$[y][0].length;u++)E[$[y][0][u]].push([f,$[y][1],y]);else if(b=$t(y),$[y]=[[],[b]],y.length>u[0].length){do d=u[1],m=b.splitText(u.index),b=m.splitText(u[0].length),$[y][0].push(d),$[y][1].push(m),$[y][1].push(b),(w[d]=w[d]||[]).push(m),(E[d]=E[d]||[]).push([f,$[y][1],y]),u=b.nodeValue.match(t);while(u)}else m=b,$[y][0].push(d),(w[d]=w[d]||[]).push(m),(E[d]=E[d]||[]).push([f,$[y][1],y]);for(d=g(v),u=0;u<d.length;u++)c=v[h=d[u]],c[G](i,"|"+g(n[h].keys).join("|"))}return n},kn=function(e,t,n){return[e?"["+e+"]":null,t?t[1]?"["+t[0]+'*="|'+t[1]+'"]':"["+t[0]+"]":null,n?n[1]?'input[name="'+n[0]+'"],textarea[name="'+n[0]+'"],select[name="'+n[0]+'"]':'input[name^="'+n[0]+'"],textarea[name^="'+n[0]+'"],select[name^="'+n[0]+'"]':null]},wn=function(e,t){return t&&t[e]?(X(t[e],A)&&(t[e]={action:t[e]}),t[e]):void 0},En=function(e,t,n,i){var r,l,o,a,u,s,c=e.$model,f="sync"==n.type,d=f?"change":n.type,h=t.length,v=i&&i.key?i.key:null,m=v?v+".":null,$=c.atomic,g=c.$atom,p=$?g+".":null;for(r=0;h>r;r++)l=t[r],l&&(o=wn(d,e.attr(l,"bind")),o&&o.action&&(a="do_"+o.action,X(e[a],I)&&(u=l[nt],s=o.key,s||(!l[mn]&&u&&(l[mn]=c.key(u,1)),s=l[mn]),$&&s&&(g===s||Dt(s,p))||v&&!s||(!v||s===v||Dt(s,m))&&e[a](n,l,o))))},_n=function(e,t,n){var i,r,l,o,a,u=e.$model,s={},c=t.length;for(i=0;c>i;i++)if(r=t[i],r&&(l=r[nt],o=0,!r[mn]&&l&&(r[mn]=u.key(l,1)),o=r[mn])){if(s[o])a=s[o][0];else{if(!u.has(o))continue;s[o]=[a=u.get(o)]}e.do_bind(n,r,{name:l,key:o,value:a})}},Tn=function(e,t,n,i,r){var l,o,a,u,s,c,f,d,h,v,m,$,p,y,b,k=e.$model,w=t.length,E="sync"==n.type,_=e.$keynodes,T={};if(_)if(i){for($=i+".",r=""+k.get(i),o=0;w>o;o++)if(l=t[o],l&&(b=l[$n])&&_[b]){if(p=_[b].keys){if(s=p[i])for(u=0,c=s.length;c>u;u++)s[u].nodeValue=r;for(f=g(p),d=0,v=f.length;v>d;d++)if(h=f[d],i!==h&&Dt(h,$)&&(s=p[h]).length)for(T[h]?m=T[h][0]:T[h]=[m=""+k.get(h)],u=0,c=s.length;c>u;u++)s[u].nodeValue=m}if(y=_[b].atts){if(y&&(s=y[i]))for(u=0,c=s.length;c>u;u++)s[u][0].nodeValue=vn(s[u][1]);for(f=g(y),d=0,v=f.length;v>d;d++)if(h=f[d],i!==h&&Dt(h,$)&&(s=y[h]).length)for(u=0,c=s.length;c>u;u++)a=s[u],T[a[2]]?m=T[a[2]][0]:T[a[2]]=[m=vn(a[1])],a[0].nodeValue=m}}}else if(E)for(o=0;w>o;o++)if(l=t[o],l&&(b=l[$n])&&_[b]){if(p=_[b].keys)for(f=g(p),d=0,v=f.length;v>d;d++)if(h=f[d],(s=p[h])&&(c=s.length))for(T[h]?m=T[h][0]:T[h]=[m=""+k.get(h)],u=0;c>u;u++)s[u].nodeValue=m;if(y=_[b].atts)for(f=g(y),d=0,v=f.length;v>d;d++)if(h=f[d],(s=y[h])&&(c=s.length))for(u=0;c>u;u++)a=s[u],T[a[2]]?m=T[a[2]][0]:T[a[2]]=[m=vn(a[1])],a[0].nodeValue=m}},On=function(e,t,n,i,r){var l=this;return l instanceof On?(l.namespace=l.id=e||jt("View"),"bind"in(n=n||{})||(n.bind="data-bind"),"keys"in n||(n.keys="data-mvkeys"+ ++gn),l.$atts=n,i=i||On._CACHE_SIZE,r=r||On._REFRESH_INTERVAL,l.$memoize=new Ut(i,x),l.$selectors=new Ut(i,r),l.$atbind=l.attribute("bind"),l.$atkeys=l.attribute("keys"),void l.model(t||new dn).initPubSub()):new On(e,t,n,i,r)};return On._CACHE_SIZE=600,On._REFRESH_INTERVAL=x,On[s]=Y($(v[s]),Bt,{constructor:On,id:null,$dom:null,$model:null,$livebind:null,$autobind:!1,$bindbubble:!1,$template:null,$atts:null,$memoize:null,$selectors:null,$keynodes:null,$atbind:null,$atkeys:null,dispose:function(){var e=this;return e.unbind().disposePubSub(),e.$model&&e.$model.dispose(),e.$model=null,e.$dom=null,e.$template=null,e.$atts=null,e.$memoize.dispose(),e.$memoize=null,e.$selectors.dispose(),e.$selectors=null,e.$livebind=null,e.$keynodes=null,e.$atbind=null,e.$atkeys=null,e},model:function(e){var t=this;return arguments.length?(t.$model&&t.$model.dispose(),t.$model=e.view(t),t):t.$model},attribute:function(e,t){var n=this;return arguments.length>1?(n.$atts[e]=t,n.$atbind=n.$atts.bind,n.$atkeys=n.$atts.keys,n):e?n.$atts[e]||a:a},template:function(e){var t=this;return arguments.length?(X(e,I)&&(t.$template=e),t):t.$template},events:function(e){var t,n=this;if(X(e,j))for(t in e)X(e[t],I)&&(n["on_"+t.split(":").join("_")]=e[t]);return n},actions:function(e){var t,n=this;if(X(e,j))for(t in e)X(e[t],I)&&(n["do_"+t]=e[t]);return n},livebind:function(e){var t=this;return arguments.length?(t.$livebind=e?hn(e,t.$model?t.$model.id:""):null,t):t.$livebind},autobind:function(e){var t=this;return arguments.length?(t.$autobind=!!e,t):t.$autobind},bindbubble:function(e){var t=this;return arguments.length?(t.$bindbubble=!!e,t):t.$bindbubble},get:function(e,t,n,i){var r,l=this,o=l.$selectors;return t=t||l.$dom,(i||!(r=o.get(e)))&&(r=vt(e,t),n&&mt.call(t,e)&&r.push(t),i||o.set(e,r)),r},attr:function(e,t){var n,i,r=this,l=r.$atts[t],o=r.$memoize;return(l=e[Z](l))?(n=o.get(l),a===n&&(n=xt(l),n.set&&(n.click=n.set,n.click.action="set",V(n,"set")),n.show&&(n.change={action:"show",key:n.show},V(n,"show")),n.hide&&(n.change={action:"hide",key:n.hide},V(n,"hide")),n.html?(n.change={action:"html",key:n.html},V(n,"html"),V(n,"text")):n.text&&(n.change={action:"html",key:n.text,text:1},V(n,"text")),n.css&&(n.change={action:"css",css:n.css},V(n,"css")),n.value&&(n.change&&"prop"==n.change.action?n.change.prop.value=n.value:n.change={action:"prop",prop:{value:n.value}},V(n,"value")),n.checked&&(n.change&&"prop"==n.change.action?n.change.prop.checked=n.checked:n.change={action:"prop",prop:{checked:n.checked}},V(n,"checked")),n.disabled&&(n.change&&"prop"==n.change.action?n.change.prop.disabled=n.disabled:n.change={action:"prop",prop:{disabled:n.disabled}},V(n,"disabled")),n.options&&(n.change&&"prop"==n.change.action?n.change.prop.options=n.options:n.change={action:"prop",prop:{options:n.options}},V(n,"options")),(i=n.change)&&(!i.domRef&&n.domRef&&(i.domRef=n.domRef),!i.key&&n.key&&(i.key=n.key)),o.set(l,n)),n):a},getDomRef:function(e,t){return Dt(t,"$this::")?vt(t.slice(7),e,1):vt(t,null,1)},add:function(e,t){var n=this;return e&&(n.$livebind&&(n.$keynodes=bn(e,n.$livebind,n.$keynodes,n.$atkeys)),!1!==t&&n.sync(null,e)),n},remove:function(e,t){var n=this;return e&&(n.$keynodes=yn(e,n.$keynodes,n.$atkeys),!1!==t&&n.$selectors.reset()),n},bind:function(e,n){var i,r,l,a=this,u=a.$model,s=kn(a.$atbind,[a.$atkeys],[u.id+"["]),c=s[0],f=s[2],d=/^on_model_/,h=a.$autobind,v=!!a.$livebind;e=e||["change","click"],a.$dom=n||document.body,v&&(a.$keynodes=bn(a.$dom,a.$livebind,null,a.$atkeys));for(i in a)X(a[i],I)&&d.test(i)&&(r=i.replace(d,""),r.length&&a.onTo(u,r,a[i]));return a.on_view_change&&e.length&&(l=function(e){return t(e,a.namespace)},o(a.$dom).on(e.map(l).join(" "),h?[f,c].join(","):c,function(e){var t=this,n=!1,i=!1,r=a.$bindbubble?a.attr(t,"bind"):null;
return(e.target===t||r&&r.bubble)&&(i=a.$bindbubble?!!r:mt.call(t,c),n=h&&"change"==e.type&&mt.call(t,f),(i||n)&&a.on_view_change(e,{el:t,isBind:i,isAutoBind:n})),!0})),a},unbind:function(e,n){{var i,r,l=this,a=l.$model,u=kn(l.$atbind,[l.$atkeys],[a.id+"["]),s=l.$autobind;!!l.$livebind}return e=e||null,r=n||l.$dom,l.on_view_change&&(i=function(e){return t(e,l.namespace)},o(r).off(e&&e.length?e.map(i).join(" "):t("",l.namespace),s?[u[2],u[0]].join(","):u[0])),l.offFrom(a),l.$keynodes=null,l},rebind:function(e,t){var n=this;return n.$memoize.reset(),n.$selectors.reset(),n.unbind().bind(e,t)},sync:function(e,t){var n,i,r,l,o=this,a=kn(o.$atbind,[o.$atkeys],[o.$model.id+"["]),u=Ft("sync",o),s=o.$autobind,c=!!o.$livebind;return o.$selectors.reset(),t?(u.currentTarget=t,n=o.get(a[0],t,0,1),c&&(r=o.get(a[1],t,1,1)),s&&(i=o.get(a[2],t,0,1))):(e=e||o.$dom,l=!(e===o.$dom),n=o.get(a[0],e,0,l),c&&(r=o.get(a[1],e,1,l)),s&&(i=o.get(a[2],e,0,l))),n.length&&En(o,n,u),c&&r.length&&Tn(o,r,u),s&&i.length&&_n(o,i,u),o},reset:function(){var e=this;return e.$memoize.reset(),e.$selectors.reset(),e},on_view_change:function(e,t){var n,i,r,l,o=this,a=o.$model,u=t.el,s={};t.isAutoBind&&(n=u[nt])&&(u[mn]||(u[mn]=a.key(n,1)),i=u[mn],i&&a.has(i)&&("checkbox"===u[rt].toLowerCase()?(l=o.get('input[type="checkbox"][name="'+n+'"]'),l.length>1?(r=[],l.forEach(function(e){r.push(e[K]?e[lt]:"")})):r=u[K]?u[lt]:""):r=Et(u),s.$trigger=u,a.set(i,r,1,s))),!s.error&&t.isBind&&En(o,[u],e),o.publish("change",t)},on_model_change:function(e,t){var n,i,r,l,o=this,a=o.$model,u=o.$autobind,s=!!o.$livebind,c=kn(o.$atbind,s?[o.$atkeys,t.key]:0,u?[a.id+on(t.key)]:0);n=o.get(c[0]),s&&(r=o.get(c[1],0,1)),u&&(i=o.get(c[2])),t.$callData&&t.$callData.$trigger&&(l=function(e){return e!==t.$callData.$trigger},n=n.filter(l),u&&(i=i.filter(l)),t.$callData=null),n.length&&En(o,n,e,t),s&&r.length&&Tn(o,r,e,t.key,t.value),u&&i.length&&_n(o,i,e,t)},on_model_error:function(e,t){var n,i,r,l=this,o=l.$model,a=l.$autobind,u=!!l.$livebind,s=kn(l.$atbind,u?[l.$atkeys,t.key]:0,a?[o.id+on(t.key)]:0);(n=l.get(s[0])).length&&En(l,n,e,t),u&&(r=l.get(s[1],0,1)).length&&Tn(l,r,e,t.key,t.value),a&&(i=l.get(s[2])).length&&_n(l,i,e,t)},do_nop:null,do_prop:function(e,t,n){if(X(n.prop,j)){var i,r,l,o,a=this,u=a.$model,s=n.prop;if(n.domRef&&(t=a.getDomRef(t,n.domRef)[0]),t)for(i in s)if(r=s[i],u.has(r))switch(l=u.get(r),o=W(l),i){case"value":_t(t,l);break;case"checked":case"disabled":t[i]=N===o?l:b(l)==t[lt];break;case"options":if("select"===t[it]&&P===o){var c,f,d=l.length,h="",v=ht("optgroup",t);for(c=kt(t),v=v.length?v[0]:t,ht("option",v).forEach(function(e){v.removeChild(e)}),f=0;d>f;f++)h+=l[f]&&l[f].label?'<option value="'+l[f].value+'">'+l[f].label+"</option>":'<option value="'+l[f]+'">'+l[f]+"</option>";v[ct]=h,wt(t,c)}break;default:t[G](i,l)}}},do_html:function(e,t,n){if(n.key){var i=this,r=i.$model,l=n.key;n.domRef&&(t=i.getDomRef(t,n.domRef)[0]),t&&l&&r.has(l)&&(t[n.text?dt in t?dt:ft:ct]=r.get(l))}},do_css:function(e,t,n){if(X(n.css,j)){var i,r,l,o=this,a=o.$model,u=n.css;if(n.domRef&&(t=o.getDomRef(t,n.domRef)[0]),t)for(r in u)i=u[r],l=a.get(i),l&&(t.style[r]=l)}},do_set:function(e,t,n){var i,r=this,l=r.$model,o=null;n.key?o=n.key:t[nt]&&(t[mn]||(t[mn]=l.key(t[nt],1)),o=t[mn]),o&&("value"in n?i=n.value:(n.domRef&&(t=r.getDomRef(t,n.domRef)[0]),i=Et(t)),l.set(o,i,1))},do_tpl:function(e,t,n){var i,r,l,o=this,a=n.key,u=n.tpl;o.$template&&a&&u&&(n.domRef&&(t=o.getDomRef(t,n.domRef)[0]),t&&(i=o.$model,a&&i.has(a)&&(r=n.mode||"replace","replace"==r&&(t[ct]=""),l=o.$template(u,i.get(a)),l&&(t[ct]+=l))))},do_show:function(e,t,n){var i=this,r=i.$model,l=n.key;n.domRef&&(t=i.getDomRef(t,n.domRef)[0]),t&&l&&("value"in n?n.value===r.get(l)?pt(t):yt(t):r.get(l)?pt(t):yt(t))},do_hide:function(e,t,n){var i=this,r=i.$model,l=n.key;n.domRef&&(t=i.getDomRef(t,n.domRef)[0]),t&&l&&("value"in n?n.value===r.get(l)?yt(t):pt(t):r.get(l)?yt(t):pt(t))},do_bind:function(e,t,n){var i,r,l=this,o=(l.$model,n.name),a=n.key,u=t[rt].toLowerCase();if(a)if(i=n.value,r=W(i),"radio"===u)b(i)==t[lt]&&(l.get('input[name="'+o+'"]').forEach(function(e){t!==e&&(e[K]=!1)}),t[K]=!0);else if("checkbox"===u){var s=l.get('input[type="checkbox"][name="'+o+'"]');s.length>1&&P===r?s.forEach(function(e){e[K]=-1<i.indexOf(e[lt])?!0:!1}):t[K]=N===r?i:b(i)==t[lt]}else _t(t,i)},toString:function(){return"[ModelView.View id: "+this.id+"]"}}),e.ModelView={VERSION:"0.43",UUID:jt,Extend:Y,Field:qt,Type:Yt,Validation:Zt,Cache:Ut,Model:dn,View:On},!function(e,t){e.jquery=function(t){if(!t.ModelView){t.ModelView=e;var n=(Function.prototype.call.bind(Array.prototype.slice),t.extend),i=e.View,r=e.Model,l={id:"model",data:{},types:{},validators:{},getters:{},setters:{}},o={viewClass:i,modelClass:r,id:"view",bindAttribute:"data-bind",livebind:null,autobind:!1,bindbubble:!1,events:null,autoSync:!0,cacheSize:i._CACHE_SIZE,refreshInterval:i._REFRESH_INTERVAL,model:null,template:null,actions:{},handlers:{}};t.fn.modelview=function(e,i){var a=arguments.length,u=a?e:null,s=e,c=!0,f=!1,d=[];return this.each(function(){var e,h,v=t(this);if(v.data("modelview")){if(c=!1,h=v.data("modelview"),e=h.$model,"view"===u)d.push(h);else if("model"===u){if(a>1)return h.model(i),this;d.push(e)}else if("data"===u){if(a>1)return e.data(i),this;d.push(e.data())}else"sync"===u?h.sync(i):"reset"===u?h.reset():"dispose"===u&&(v.data("modelview",null),h.dispose());return this}return f||(s=n({},o,s),!s.model||s.model instanceof r||(s.model=n({},l,s.model)),f=!0),s.model?(e=s.model instanceof r?s.model:new s.modelClass(s.model.id,s.model.data,s.model.types,s.model.validators,s.model.getters,s.model.setters),h=new s.viewClass(s.id,e,{bind:s.bindAttribute||"data-bind"},s.cacheSize,s.refreshInterval).template(s.template).events(s.handlers).actions(s.actions).livebind(s.livebind).autobind(s.autobind).bindbubble(s.bindbubble).bind(s.events,v[0]),v.data("modelview",h),void(s.autoSync&&h.sync())):this}),!c&&d.length?1==this.length?d[0]:d:this}}!t.widget||t.mvc&&t.mvc.ModelViewWidget||t.widget("mvc.ModelViewWidget",{options:{},$view:null,_create:function(){var e=this;e.$view=e.element.modelview(e.options).modelview("view")},value:function(e,t){var n=this;return 1<arguments.length?(n.$view.$model.set(e,t,1),n.element):n.$view.$model.get(e)},view:function(){return this.$view},model:function(){return this.$view.$model},_destroy:function(){var e=this.self.$view=null;e.element.modelview("dispose")}})},"undefined"!=typeof t.jQuery&&e.jquery(t.jQuery)}(e.ModelView,this),e.ModelView});
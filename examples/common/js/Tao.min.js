/**
*  Tao
*  A simple, tiny, isomorphic, precise and fast template engine for handling both string and live dom based templates
*
*  @version: 0.3
*  https://github.com/foo123/Tao.js
*
**/
!function(e,t,i){"use strict";var n,s="object"==typeof module&&module.exports,l="function"==typeof define&&define.amd;s?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||i.call(e,{NODE:module})||1:l&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,n,s){return i.call(e,{AMD:s})}):t in e||(e[t]=n=i.call(e,{})||1)&&l&&define(t,[],function(){return n})}(this,"Tao",function(e,t){"use strict";function i(e,t,i){var s;return i=!0===i,e?e.substr&&e.substring?(e=d(e,new RegExp(t.source,"g"),i),s=function l(e){var t,s,r,u,o,p=l.tpl,f=p.length,h=[],c="";for(s=0;f>s;s++)t=p[s],r=t[0],o=t[1],u=t[2],r?(i&&!o&&t[3]>-1&&h.length&&(u=u.slice(0,t[3])+"<!--"+h.join("\n")+"-->"+u.slice(t[3]),h=[]),c+=u):(e[n](u)&&(t[3]=String(e[u])),i?o?(c+=t[3],t[4]&&h.push("att:"+t[4]+"|key:"+u+"|"+[t[5],t[3].length].join(","))):c+="<!--key:"+u+"-->"+t[3]+"<!--/key-->":c+=t[3]);return c}):(e=a(e,new RegExp(t.source,""),i),s=function u(e){var t,i,s,l,o,f,h,c,g,d,a,b,x,S,y=u.tpl,m=y[0];for(l=p(e),h=l.length,f=0;h>f;f++)if(o=l[f],c=String(e[o]),m[n](o)){for(g=m[o][0],i=0,s=g.length;s>i;i++)g[i][r]=c;for(d=m[o][1],i=0,s=d.length;s>i;i++){if(t=d[i],a=t[1],x=a.length,S=x?a[0][r]:"",x>1)for(b=1;x>b;b++)S+=a[b][r];t[0][r]=S}}}):s=function(){},s.tpl=e,s.dispose=function(){s.tpl=null},s}var n="hasOwnProperty",s="lastIndexOf",l="match",r="nodeValue",u="nodeType",o="parentNode",p=Object.keys,f=/[a-zA-Z0-9_\-]/,h=function(e){return parseInt(e,10)},c=0,g=function(e){return e.$TID$=e.$TID$||e.id||"_TID_"+(++c).toString(16)},d=function(e,i,n){for(var l,r,u,o,p,h,c,g,d,a=[],b=0,x=!1,S=-1,y=0,m=!1;l=i.exec(e);){if(r=i.lastIndex-l[0].length,u=e.slice(b,r),d=-1,n&&(c=u[s]("<"),g=u[s](">"),c>g?(d=-1,m=!0):g>c&&(d=g+1,m=!1)),a.push([1,m,u,d]),m)if(-1<(p=u[s]("="))){for(x="",h=p;p>-1&&f.test(o=u.charAt(--p));)x=o+x;S=r-b-h-2,y=S+l[0].length}else x&&(S=y+r-b-2-1,y+=S+l[0].length);else x=!1,y=0,S=-1;a.push([0,m,l[1]?l[1]:l[0],t,x,S]),b=i.lastIndex}return u=e.slice(b),d=-1,n&&(c=u[s]("<"),g=u[s](">"),c>g?(d=-1,m=!0):g>c&&(d=g+1,m=!1)),a.push([1,m,u,d]),a},a=function(e,t,i){var s,p,f,c,d,a,b,x,S,y,m,v,C,T,k,I,$,w,D,O,j,q,E,N,A,R={};if(p=[],f=[],y=e,y.attributes&&(d=y.attributes.length))if(i&&y.firstChild&&8===y.firstChild[u]&&"att:"===y.firstChild[r].slice(0,4))for(x=y.firstChild[r].split("\n"),d=x.length,T={},c=0;d>c;c++)a=x[c].split("|"),D=a[0].slice(4),m=y.attributes[D],T[n](D)||(T[D]=[1,[]],f.push([m,T[D],y])),T[D][1].push([a[1].slice(4),a[2].split(",").map(h)]);else for(c=0;d>c;c++)m=y.attributes[c],(a=m[r][l](t))&&f.push([0,m,a,y]);if(3===y[u])i&&y.previousSibling&&y.nextSibling&&8===y.previousSibling[u]&&8===y.nextSibling[u]&&"key:"===(v=y.previousSibling[r]).slice(0,4)&&"/key"===y.nextSibling[r]?(a=[y[r],v.slice(4)],p.push([y,a,y[o]])):(a=y[r][l](t))&&p.push([y,a,y[o]]);else if(y.firstChild)for(E=[y=y.firstChild];E.length;){if(y.attributes&&(d=y.attributes.length))if(i&&y.firstChild&&8===y.firstChild[u]&&"att:"===y.firstChild[r].slice(0,4))for(x=y.firstChild[r].split("\n"),d=x.length,T={},c=0;d>c;c++)a=x[c].split("|"),D=a[0].slice(4),m=y.attributes[D],T[n](D)||(T[D]=[1,[]],f.push([m,T[D],y])),T[D][1].push([a[1].slice(4),a[2].split(",").map(h)]);else for(c=0;d>c;c++)m=y.attributes[c],(a=m[r][l](t))&&f.push([m,a,y]);if(y.firstChild)E.push(y=y.firstChild);else{for(3===y[u]&&(i&&y.previousSibling&&y.nextSibling&&8===y.previousSibling[u]&&8===y.nextSibling[u]&&"key:"===(v=y.previousSibling[r]).slice(0,4)&&"/key"===y.nextSibling[r]?(a=[y[r],v.slice(4)],p.push([y,a,y[o]])):(a=y[r][l](t))&&p.push([y,a,y[o]])),y=E.pop();E.length&&!y.nextSibling;)y=E.pop();y.nextSibling&&E.push(y=y.nextSibling)}}for(T={},c=0,d=p.length;d>c;c++)if(b=p[c],q=b[0],a=b[1],y=b[2],C=g(y),R[C]=R[C]||[{},{}],T[C]=y,N=R[C][0],w=q[r],w.length>a[0].length){do v=a[1]?a[1]:a[0],k=q.splitText(a.index),q=k.splitText(a[0].length),(N[v]=N[v]||[]).push(k),a=q[r][l](t);while(a)}else v=a[1]?a[1]:a[0],k=q,(N[v]=N[v]||[]).push(k);for(I={},c=0,d=f.length;d>c;c++)if(b=f[c],m=b[0],a=b[1],y=b[2],C=g(y),R[C]=R[C]||[{},{}],T[C]=y,N=R[C][0],A=R[C][1],w=m[r],$=w in I)for(a=0;a<I[w][0].length;a++)A[I[w][0][a]].push([m,I[w][1],w]);else if(q=document.createTextNode(w||""),I[w]=[[],[q]],1===a[0])for(x=a[1],S=x.length,j=0,c=0;S>c;c++)O=x[c],v=O[0],k=q.splitText(O[1][0]-j),q=k.splitText(O[1][1]),I[w][0].push(v),I[w][1].push(k,q),(N[v]=N[v]||[]).push(k),(A[v]=A[v]||[]).push([m,I[w][1],w]),j+=O[1][1]+O[1][0];else if(w.length>a[0].length){do v=a[1]?a[1]:a[0],k=q.splitText(a.index),q=k.splitText(a[0].length),I[w][0].push(v),I[w][1].push(k,q),(N[v]=N[v]||[]).push(k),(A[v]=A[v]||[]).push([m,I[w][1],w]),a=q[r][l](t);while(a)}else k=q,v=a[1]?a[1]:a[0],I[w][0].push(v),(N[v]=N[v]||[]).push(k),(A[v]=A[v]||[]).push([m,I[w][1],w]);s={};for(C in R)if(R[n](C)){for(v in R[C][0])R[C][0][n](v)&&(s[n](v)?s[v][0]=s[v][0].concat(R[C][0][v]):s[v]=[R[C][0][v],R[C][1][v]||[]]);for(v in R[C][1])R[C][1][n](v)&&(s[n](v)?s[v][1]=s[v][1].concat(R[C][1][v]):s[v]=[R[C][0][v]||[],R[C][1][v]])}return[s,e]};return i.VERSION="0.3",i});
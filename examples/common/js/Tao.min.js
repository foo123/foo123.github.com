/**
*  Tao
*  A simple, tiny, isomorphic, precise and fast template engine for handling both string and live dom based templates
*
*  @version: 0.3
*  https://github.com/foo123/Tao.js
*
**/
!function(e,t,i){"use strict";var n,s="object"==typeof module&&module.exports,l="function"==typeof define&&define.amd;s?module.exports=(module.$deps=module.$deps||{})[t]=module.$deps[t]||i.call(e,{NODE:module})||1:l&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(t)?define(t,["require","exports","module"],function(t,n,s){return i.call(e,{AMD:s})}):t in e||(e[t]=n=i.call(e,{})||1)&&l&&define(t,[],function(){return n})}(this,"Tao",function(e,t){"use strict";function i(e,t,i){var s;return i=!0===i,e?e.substr&&e.substring?(e=d(e,new RegExp(t.source,"g"),i),s=function l(e){var t,s,r,u,p,h=l.tpl[1],o=h.length,f=[],c="";for(s=0;o>s;s++)t=h[s],r=t[0],p=t[1],u=t[2],r?(i&&!p&&t[3]>-1&&f.length&&(u=u.slice(0,t[3])+"<!--"+f.join("\n")+"-->"+u.slice(t[3]),f=[]),c+=u):(e[n](u)&&(t[3]=String(e[u])),i?p?(c+=t[3],t[4]&&f.push("att:"+t[4]+"|key:"+u+"|"+[t[5],t[3].length].join(","))):c+="<!--key:"+u+"-->"+t[3]+"<!--/key-->":c+=t[3]);return c}):(e=a(e,new RegExp(t.source,""),i),s=function u(e){var t,i,s,l,p,o,f,c,g,d,a,b,x,S,y=u.tpl[0];for(l=h(e),f=l.length,o=0;f>o;o++)if(p=l[o],c=String(e[p]),y[n](p)){for(g=y[p][0],i=0,s=g.length;s>i;i++)g[i][r]=c;for(d=y[p][1],i=0,s=d.length;s>i;i++){if(t=d[i],a=t[1],x=a.length,S=x?a[0][r]:"",x>1)for(b=1;x>b;b++)S+=a[b][r];t[0][r]=S}}}):s=function(){},s.tpl=e,s.dispose=function(){s.tpl=null},s}var n="hasOwnProperty",s="lastIndexOf",l="match",r="nodeValue",u="nodeType",p="parentNode",h=Object.keys,o=/[a-zA-Z0-9_\-]/,f=function(e){return parseInt(e,10)},c=0,g=function(e){return e.$TID$=e.$TID$||e.id||"_TID_"+(++c).toString(16)},d=function(e,i,l){for(var r,u,p,h,f,c,g,d,a,b,x=[],S=0,y=!1,m=-1,v=0,C=!1,T={};r=i.exec(e);){if(u=i.lastIndex-r[0].length,p=e.slice(S,u),a=-1,l&&(g=p[s]("<"),d=p[s](">"),g>d?(a=-1,C=!0):d>g&&(a=d+1,C=!1)),x.push([1,C,p,a]),C)if(-1<(f=p[s]("="))){for(y="",c=f;f>-1&&o.test(h=p.charAt(--f));)y=h+y;m=u-S-c-2,v=m+r[0].length}else y&&(m=v+u-S-2-1,v+=m+r[0].length);else y=!1,v=0,m=-1;b=r[1]?r[1]:r[0],T[n](b)?T[b].push(x.length):T[b]=[x.length],x.push([0,C,b,t,y,m]),S=i.lastIndex}return p=e.slice(S),a=-1,l&&(g=p[s]("<"),d=p[s](">"),g>d?(a=-1,C=!0):d>g&&(a=d+1,C=!1)),x.push([1,C,p,a]),[T,x]},a=function(e,t,i){var s,h,o,c,d,a,b,x,S,y,m,v,C,T,k,I,$,w,D,O,j,q,E,N,A,R={};if(h=[],o=[],y=e,y.attributes&&(d=y.attributes.length))if(i&&y.firstChild&&8===y.firstChild[u]&&"att:"===y.firstChild[r].slice(0,4))for(x=y.firstChild[r].split("\n"),d=x.length,T={},c=0;d>c;c++)a=x[c].split("|"),D=a[0].slice(4),m=y.attributes[D],T[n](D)||(T[D]=[1,[]],o.push([m,T[D],y])),T[D][1].push([a[1].slice(4),a[2].split(",").map(f)]);else for(c=0;d>c;c++)m=y.attributes[c],(a=m[r][l](t))&&o.push([0,m,a,y]);if(3===y[u])i&&y.previousSibling&&y.nextSibling&&8===y.previousSibling[u]&&8===y.nextSibling[u]&&"key:"===(v=y.previousSibling[r]).slice(0,4)&&"/key"===y.nextSibling[r]?(a=[y[r],v.slice(4)],h.push([y,a,y[p]])):(a=y[r][l](t))&&h.push([y,a,y[p]]);else if(y.firstChild)for(E=[y=y.firstChild];E.length;){if(y.attributes&&(d=y.attributes.length))if(i&&y.firstChild&&8===y.firstChild[u]&&"att:"===y.firstChild[r].slice(0,4))for(x=y.firstChild[r].split("\n"),d=x.length,T={},c=0;d>c;c++)a=x[c].split("|"),D=a[0].slice(4),m=y.attributes[D],T[n](D)||(T[D]=[1,[]],o.push([m,T[D],y])),T[D][1].push([a[1].slice(4),a[2].split(",").map(f)]);else for(c=0;d>c;c++)m=y.attributes[c],(a=m[r][l](t))&&o.push([m,a,y]);if(y.firstChild)E.push(y=y.firstChild);else{for(3===y[u]&&(i&&y.previousSibling&&y.nextSibling&&8===y.previousSibling[u]&&8===y.nextSibling[u]&&"key:"===(v=y.previousSibling[r]).slice(0,4)&&"/key"===y.nextSibling[r]?(a=[y[r],v.slice(4)],h.push([y,a,y[p]])):(a=y[r][l](t))&&h.push([y,a,y[p]])),y=E.pop();E.length&&!y.nextSibling;)y=E.pop();y.nextSibling&&E.push(y=y.nextSibling)}}for(T={},c=0,d=h.length;d>c;c++)if(b=h[c],q=b[0],a=b[1],y=b[2],C=g(y),R[C]=R[C]||[{},{}],T[C]=y,N=R[C][0],w=q[r],w.length>a[0].length){do v=a[1]?a[1]:a[0],k=q.splitText(a.index),q=k.splitText(a[0].length),(N[v]=N[v]||[]).push(k),a=q[r][l](t);while(a)}else v=a[1]?a[1]:a[0],k=q,(N[v]=N[v]||[]).push(k);for(I={},c=0,d=o.length;d>c;c++)if(b=o[c],m=b[0],a=b[1],y=b[2],C=g(y),R[C]=R[C]||[{},{}],T[C]=y,N=R[C][0],A=R[C][1],w=m[r],$=w in I)for(a=0;a<I[w][0].length;a++)A[I[w][0][a]].push([m,I[w][1],w]);else if(q=document.createTextNode(w||""),I[w]=[[],[q]],1===a[0])for(x=a[1],S=x.length,j=0,c=0;S>c;c++)O=x[c],v=O[0],k=q.splitText(O[1][0]-j),q=k.splitText(O[1][1]),I[w][0].push(v),I[w][1].push(k,q),(N[v]=N[v]||[]).push(k),(A[v]=A[v]||[]).push([m,I[w][1],w]),j+=O[1][1]+O[1][0];else if(w.length>a[0].length){do v=a[1]?a[1]:a[0],k=q.splitText(a.index),q=k.splitText(a[0].length),I[w][0].push(v),I[w][1].push(k,q),(N[v]=N[v]||[]).push(k),(A[v]=A[v]||[]).push([m,I[w][1],w]),a=q[r][l](t);while(a)}else k=q,v=a[1]?a[1]:a[0],I[w][0].push(v),(N[v]=N[v]||[]).push(k),(A[v]=A[v]||[]).push([m,I[w][1],w]);s={};for(C in R)if(R[n](C)){for(v in R[C][0])R[C][0][n](v)&&(s[n](v)?s[v][0]=s[v][0].concat(R[C][0][v]):s[v]=[R[C][0][v],R[C][1][v]||[]]);for(v in R[C][1])R[C][1][n](v)&&(s[n](v)?s[v][1]=s[v][1].concat(R[C][1][v]):s[v]=[R[C][0][v]||[],R[C][1][v]])}return[s,e]};return i.VERSION="0.3",i});
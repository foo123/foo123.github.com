<!doctype html>
<!--[if lt IE 7]>
<html lang="en" class="ie lt-ie9 lt-ie8 lt-ie7">
<![endif]-->
<!--[if IE 7]>
<html lang="en" class="ie lt-ie9 lt-ie8">
<![endif]-->
<!--[if IE 8]>
<html lang="en" class="ie lt-ie9">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-ie">
<!--<![endif]-->
<head>
<title>Grammar Template</title>

<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<meta name="description" content="Grammar Template" />


<link rel="stylesheet" type="text/css" href="../common/css/common.min.css" />

<link rel="stylesheet" href="../common/js/codemirror/codemirror.min.css" />
<link rel="stylesheet" href="../common/js/codemirror/addon/lint/lint.css">
<link rel="stylesheet" href="../common/js/codemirror/addon/fold/foldgutter.css" />
<link rel="stylesheet" href="../common/js/codemirror/theme/lesser-dark.css" />
<style type="text/css">
#input,#output,#data {
    position:relative;
    padding:2px;
    width: 90%;
    height: 250px;
}

.button {
    -moz-box-shadow:inset 0px 1px 0px 0px #ffffff;
    -webkit-box-shadow:inset 0px 1px 0px 0px #ffffff;
    box-shadow:inset 0px 1px 0px 0px #ffffff;
    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #ededed), color-stop(1, #dfdfdf) );
    background:-moz-linear-gradient( center top, #ededed 5%, #dfdfdf 100% );
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ededed', endColorstr='#dfdfdf');
    background-color:#ededed;
    -webkit-border-top-left-radius:20px;
    -moz-border-radius-topleft:20px;
    border-top-left-radius:20px;
    -webkit-border-top-right-radius:20px;
    -moz-border-radius-topright:20px;
    border-top-right-radius:20px;
    -webkit-border-bottom-right-radius:20px;
    -moz-border-radius-bottomright:20px;
    border-bottom-right-radius:20px;
    -webkit-border-bottom-left-radius:20px;
    -moz-border-radius-bottomleft:20px;
    border-bottom-left-radius:20px;
    text-indent:0;
    border:1px solid #dcdcdc;
    display:inline-block;
    color:#777777;
    font-family:Arial;
    font-size:15px;
    font-weight:bold;
    font-style:normal;
    height:50px;
    line-height:50px;
    width:86px;
    text-decoration:none;
    text-align:center;
    text-shadow:1px 1px 0px #ffffff;
}
.button:hover {
    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #dfdfdf), color-stop(1, #ededed) );
    background:-moz-linear-gradient( center top, #dfdfdf 5%, #ededed 100% );
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#dfdfdf', endColorstr='#ededed');
    background-color:#dfdfdf;
}.button:active {
    position:relative;
    top:1px;
}
.button {
    width:90px;
    height:30px;
    line-height:30px;
    cursor:pointer;
    position:relative;
}
</style>




<script src="../common/js/codemirror/codemirror.min.js"></script>
<script src="../common/js/codemirror/addon/lint/lint.js"></script>
<script src="../common/js/codemirror/addon/fold/foldcode.js"></script>
<script src="../common/js/codemirror/addon/fold/foldgutter.js"></script>
<script src="../common/js/codemirror/addon/fold/brace-fold.js"></script>
<script src="../common/js/codemirror/addon/fold/comment-fold.js"></script>
<script src="../common/js/codemirror_grammar.min.js"></script>
<script src="../common/js/codemirror/grammar/define_grammar_mode.js"></script>
<script src="../common/js/codemirror/grammar/json.js"></script>
<script src="../common/js/codemirror/grammar/grammartemplate.js"></script>
<script src="../common/js/codemirror/grammar/grammartemplate_postop.js"></script>

<script type="text/javascript" src="../common/js/require.js"></script>
<script type="text/javascript" src="../common/js/require-config.js"></script>



</head>
<body class="responsive-864-container">
    <span id="forkongithub"><a href="https://github.com/foo123/GrammarTemplate">Play on GitHub</a></span>
    
    
<header id="header">
    <h1>Grammar Template</h1>
    <i>A versatile and intuitive grammar-based templating for PHP, Python, Node/XPCOM/JS, ActionScript</i>
</header>

<br /><br />

    
    
<div id="screen" class="fluid col-1-1">
    <div class="fluid col-1-1">
    <div class="fluid col-1-1" style="margin-bottom:10px">
    
        <strong>Grammar Template ($(grammartemplate_version)):</strong>
        &nbsp;&nbsp;<input type="button" class="button" id="render" data-bind='{"click":"render"}' value="Render" />
        &nbsp;&nbsp;<a class="button" id="help" href="https://github.com/foo123/GrammarTemplate" target="_blank">Help</a>&nbsp;&nbsp;<input id="mode" type="checkbox" data-bind='{"change":"setMode"}' />&nbsp;&nbsp;<label id="setmode" for="mode">PostOp Mode</label>
        <br /><br />
<!--
SELECT <column.select>[, <column.select>*]
FROM <table.from>[, <table.from>*][
WHERE (<required.where:EXPR>?) AND (<condition.where:EXPR>?)][
WHERE <required.where:EXPR>?<condition.where:EXPR>?!][
WHERE <required.where:EXPR>?!<condition.where:EXPR>?][
GROUP BY <group>?[, <group>*]][
HAVING (<required.having:EXPR>?) AND (<condition.having:EXPR>?)][
HAVING <required.having:EXPR>?<condition.having:EXPR>?!][
HAVING <required.having:EXPR>?!<condition.having:EXPR>?][
ORDER BY <order>?[, <order>*]][
LIMIT <offset|0>, <count>?][#
    ** recursive sub-templates **
#][#
    single factor sub-template
#]<:FACTOR>:=[<lhs>[ <op>? <rhs|NULL>]][#
    foreach term:factors as factor sub-template
#]<:TERM>:=[(<factor:FACTOR>[ AND <factor:FACTOR>*])][#
    foreach expr:terms as term sub-template
#]<:EXPR>:=[<term:TERM>[ OR <term:TERM>*]]
-->
        <textarea id="input">SELECT &lt;column.select&gt;[, &lt;*column.select&gt;]
FROM &lt;table.from&gt;[, &lt;*table.from&gt;][
WHERE (&lt;?required.where:EXPR&gt;) AND (&lt;?condition.where:EXPR&gt;)][
WHERE &lt;?required.where:EXPR&gt;&lt;?!condition.where:EXPR&gt;][
WHERE &lt;?!required.where:EXPR&gt;&lt;?condition.where:EXPR&gt;][
GROUP BY &lt;?group&gt;[, &lt;*group&gt;]][
HAVING (&lt;?required.having:EXPR&gt;) AND (&lt;?condition.having:EXPR&gt;)][
HAVING &lt;?required.having:EXPR&gt;&lt;?!condition.having:EXPR&gt;][
HAVING &lt;?!required.having:EXPR&gt;&lt;?condition.having:EXPR&gt;][
ORDER BY &lt;?order&gt;[, &lt;*order&gt;]][
LIMIT &lt;offset|0&gt;, &lt;?count&gt;][#
    ** recursive sub-templates **
#][#
    single factor sub-template
#]&lt;:FACTOR&gt;:=[&lt;lhs&gt;[ &lt;?op&gt; &lt;rhs|NULL&gt;]][#
    foreach term:factors as factor sub-template
#]&lt;:TERM&gt;:=[(&lt;factor:FACTOR&gt;[ AND &lt;*factor:FACTOR&gt;])][#
    foreach expr:terms as term sub-template
#]&lt;:EXPR&gt;:=[&lt;term:TERM&gt;[ OR &lt;*term:TERM&gt;]]</textarea>
    </div>
    <div class="fluid col-1-1" style="margin-bottom:10px">
    
        <strong style="display:inline-block;margin-bottom:5px">Data (JSON):</strong><br />
        <textarea id="data">{
"column"        : {
    "select"    : [ "field1", "field2", "field3", "field4" ]
},
"table"         : {
    "from"      : [ "tbl1", "tbl2" ]
},
"condition"     : {
    "where"     : [
        [
            {"lhs": "field1", "op": "=", "rhs": 1},
            {"lhs": "field2", "op": "=", "rhs": 2}
        ],
        [
            {"lhs": "field1", "op": "=", "rhs": 1},
            {"lhs": "field3", "op": "=", "rhs": 4}
        ]
    ],
    "having"    : [
        [
            {"lhs": "field1", "op": "=", "rhs": 1}
        ],
        [
            {"lhs": "field3", "op": "=", "rhs": 4}
        ]
    ]
},
"count"         : 5
}</textarea>
        
    </div>
    </div>
    <br /><br />
    
    <div class="fluid col-1-1">
    
        <strong>Output:</strong><br />
        <textarea id="output"></textarea>
        
    </div>
</div>

    
    
    <footer id="footer">
    <div class="fluid col-1-1 text-right" style="margin-top: 10px; padding-right: 20px;"><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=DP8WED9XW9TAE" class="donate">donate</a> or <a href="https://nikos-web-development.000webhostapp.com/#contact_tab" class="donate">hire me for a job</a></div>
    
<div class="showcase">Syntax Highlight by <a href="http://codemirror.net/" target="_blank">Codemirror</a></div>
<div class="showcase">JSON &amp; GrammarTemplate syntax highlight modes by <a href="https://github.com/foo123/codemirror-grammar" target="_blank">Codemirror Grammar</a></div>

    <div class="showcase">Module management by <a href="http://requirejs.org/" target="_blank">RequireJS</a></div>
    <div class="showcase">Routing by <a href="https://github.com/foo123/Dromeo" target="_blank">Dromeo</a></div>
    <div class="showcase">Templating by <a href="https://github.com/foo123/Contemplate" target="_blank">Contemplate</a></div>
    <div class="showcase">Widgets by <a href="https://github.com/foo123/HtmlWidget" target="_blank">HtmlWidget</a></div>
    <div class="showcase">MVC by <a href="https://github.com/foo123/modelview.js" target="_blank">ModelView</a></div>
    </footer>
    <br /><br />
    
    
<script type="text/javascript">//<![CDATA[
require(['jQuery', 'Dromeo', 'ModelView', 'GrammarTemplate'],
    function( $, $R, $MV, GrammarTemplate ) {
    "use strict";
    
    var undef=undefined, $window = $(window), $screen = $('#screen'), 
        input = document.getElementById('input'),
        output = document.getElementById('output'),
        data = document.getElementById('data'),
        oEditor, vEditor, iEditor,
        appTask, appModel, appView, appRouter, 
        iwidth = input.clientWidth, iheight = input.clientHeight,
        width = output.clientWidth, height = output.clientHeight,
        toJSON = JSON.stringify, fromJSON = JSON.parse,
        cur_tpl = String(input.value), gramTpl = null, prevmode = false, postop = false
    ;
    
    $MV.jquery( $ );
    
    iEditor = CodeMirror.fromTextArea(input, {
        mode: "grammar-template",
        lineWrapping: true,
        lineNumbers : true,
        indentUnit: 4,
        indentWithTabs: false,
        theme: 'lesser-dark',
        foldGutter: true,
        lint: true,  // enable lint validation
        gutters: ["CodeMirror-lint-markers", "CodeMirror-linenumbers", "CodeMirror-foldgutter"]
    });
    iEditor.setSize( iwidth, iheight );
    
    oEditor = CodeMirror.fromTextArea(output, {
        mode: "text",
        lineWrapping: true,
        lineNumbers : true,
        indentUnit: 4,
        indentWithTabs: false,
        theme: 'lesser-dark',
        foldGutter: true,
        gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"]
    });
    oEditor.setSize( width, height );
        
    vEditor = CodeMirror.fromTextArea(data, {
        mode: "application/json",
        lineWrapping: true,
        lineNumbers : true,
        indentUnit: 4,
        indentWithTabs: false,
        theme: 'lesser-dark',
        foldGutter: true,
        // enable token matching
        "json-mode-match": true,
        lint: true,  // enable lint validation
        gutters: ["CodeMirror-lint-markers", "CodeMirror-linenumbers", "CodeMirror-foldgutter"]
    });
    vEditor.setSize( width, height );
        
    appTask = {
        render: function( ) {
            var template = iEditor.getValue();
            if ( !gramTpl || (cur_tpl !== template) || (prevmode !== postop) )
            {
                cur_tpl = template;
                gramTpl = new GrammarTemplate(template, null, postop);
            }
            
            oEditor.setValue(gramTpl.render(fromJSON(vEditor.getValue())));
        }
    };
    
    appRouter = new $R( );
    appRouter.one({route:'#{%ALL%:hash}', handler:function( params ){
        params = params.data;
        params = params && params.hash ? appRouter.unglue( params.hash ) : null;
        if ( !params )
        {
            setTimeout(function(){
                appTask.render( );
            }, 10);
        }
        else if ( params && params.action && appTask.hasOwnProperty(params.action) )
        {
            if ( null != params.input ) iEditor.setValue(params.input);
            if ( null != params.data ) vEditor.setValue(params.data);
            if ( null != params.mode )
            {
                var opmode = 1 === +params.mode;
                if ( opmode !== postop ) $('#setmode').trigger('click');
            }
            appTask[ params.action ]( );
        }
    }});
    
    $screen.modelview({
        //autobind: true
        livebind: '$(__KEY__)'
        ,bindAttribute: 'data-bind'
        
        ,model: {
            id: 'model'
            ,data: {  
                grammartemplate_version: 'v.'+GrammarTemplate.VERSION
            }
        }
        ,actions: { 
            setMode: function(evt, el) {
                prevmode = postop; postop = el.checked ? true : false;
                if ( prevmode !== postop )
                    iEditor.setOption( "mode", postop ? "grammar-template-postop" : "grammar-template" );
            },
            render: function(evt, $el, data) {
                location.hash = '#' + appRouter.glue({
                    action: 'render',
                    input: iEditor.getValue(),
                    mode: postop ? 1 : 0,
                    data: vEditor.getValue()
                });
                appTask.render( );
            }
        }
    });
        
    $window
        .on('resize', function( evt ) {
            var v = output.style.visibility,
                d = output.style.display,
                v2 = data.style.visibility,
                d2 = data.style.display,
                v3 = input.style.visibility,
                d3 = input.style.display
            ;
            data.style.visibility = 'hidden';
            data.style.display = 'block';
            width = data.clientWidth; 
            height = data.clientHeight;
            data.style.display = d2;
            data.style.visibility = v2;
            vEditor.setSize( width, height );
            
            output.style.visibility = 'hidden';
            output.style.display = 'block';
            width = output.clientWidth; 
            height = output.clientHeight;
            output.style.display = d;
            output.style.visibility = v;
            oEditor.setSize( width, height );
            
            input.style.visibility = 'hidden';
            input.style.display = 'block';
            iwidth = input.clientWidth; 
            iheight = input.clientHeight;
            input.style.display = d3;
            input.style.visibility = v3;
            iEditor.setSize( iwidth, iheight );
        })
        /*.one('hashchange', function( evt ) {
            appRouter.route( location.hash );
        })*/
    ;
        if ( location.hash ) appRouter.route( location.hash );/*$window.trigger( 'hashchange' );*/
        else $('#render').trigger( 'click' );
});
//]]></script>

</body>
</html>
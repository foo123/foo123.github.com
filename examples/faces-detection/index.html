<!doctype html>
<!--[if lt IE 7]>
<html lang="en" class="ie lt-ie9 lt-ie8 lt-ie7">
<![endif]-->
<!--[if IE 7]>
<html lang="en" class="ie lt-ie9 lt-ie8">
<![endif]-->
<!--[if IE 8]>
<html lang="en" class="ie lt-ie9">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" class="no-ie">
<!--<![endif]-->
<head>
<title>Many Faces detection with OpenCV cascades in JavaScript</title>

<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<meta name="description" content="Many Faces detection with OpenCV cascades in JavaScript" />


<link rel="stylesheet" type="text/css" href="../common/css/common.min.css" />

<style type="text/css">
div {
    position:relative;
}

.block {
    position:relative;
    display:inline-block;
    margin: 10px;
}

.button {
    -moz-box-shadow:inset 0px 1px 0px 0px #f5978e;
    -webkit-box-shadow:inset 0px 1px 0px 0px #f5978e;
    box-shadow:inset 0px 1px 0px 0px #f5978e;
    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #f24537), color-stop(1, #c62d1f) );
    background:-moz-linear-gradient( center top, #f24537 5%, #c62d1f 100% );
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#f24537', endColorstr='#c62d1f');
    background-color:#f24537;
    -webkit-border-top-left-radius:20px;
    -moz-border-radius-topleft:20px;
    border-top-left-radius:20px;
    -webkit-border-top-right-radius:20px;
    -moz-border-radius-topright:20px;
    border-top-right-radius:20px;
    -webkit-border-bottom-right-radius:20px;
    -moz-border-radius-bottomright:20px;
    border-bottom-right-radius:20px;
    -webkit-border-bottom-left-radius:20px;
    -moz-border-radius-bottomleft:20px;
    border-bottom-left-radius:20px;
    text-indent:0;
    border:1px solid #d02718;
    display:inline-block;
    color:#ffffff;
    font-family:Arial;
    font-size:15px;
    font-weight:bold;
    font-style:normal;
    height:50px;
    line-height:50px;
    width:200px;
    text-decoration:none;
    text-align:center;
    text-shadow:1px 1px 0px #810e05;
}
.button:hover {
    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #c62d1f), color-stop(1, #f24537) );
    background:-moz-linear-gradient( center top, #c62d1f 5%, #f24537 100% );
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#c62d1f', endColorstr='#f24537');
    background-color:#c62d1f;
}.button:active {
    position:relative;
    top:1px;
}        
.button {
    margin: 3px 2px;
    position:relative;
    cursor:pointer;
}
#forkongithub a{background:#c83022;color:#fff;}
</style>




<script type="text/javascript" src="../common/js/require.js"></script>
<script type="text/javascript" src="../common/js/require-config.js"></script>


</head>
<body class="responsive-864-container">
    <span id="forkongithub"><a href="https://github.com/foo123/HAAR.js">Spoon me on GitHub</a></span>
    
    
<header id="header">
    <h1>Many Faces Detection with OpenCV haar cascades in JavaScript</h1>
</header>

    
    
<div id="screen" class="fluid col-1-1">
    <div  class="fluid col-1-3">
        <div id="wait" style="display:none"><img src="../common/assets/ajax-loader.gif" /></div>
        
        <div id="container"><canvas id='image'></canvas></div>
    </div>
    
    <div  class="fluid col-2-3">
        <div id="info" style="font-size:16px;">
            
            If <code>&quot;?parallel&quot;</code> is set in the URL, <strong>Parallel</strong> detection is used
            <br />
            else, <strong>Asynchronous</strong> detection is used
            <br />
            <span style="font-size:12px; font-style:oblique;">( Enable console to see the time statistics for each operation )</span>
            <br /><br />
            
            <span>$(mode)</span>
        </div>
        
        <br />
        
        <button class="button" data-bind='{"click":"detectParallel"}'>Parallel Detection</button>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <button class="button" data-bind='{"click":"detectAsync"}'>Asynchronous Detection</button>
    </div>
</div>

    
    
    <footer id="footer">
    <div class="fluid col-1-1 text-right" style="margin-top: 10px; padding-right: 20px;"><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=DP8WED9XW9TAE" class="donate">donate</a> or <a href="https://nikos-web-development.000webhostapp.com/#contact_tab" class="donate">hire me for a job</a></div>
    
    <div class="showcase">Module management by <a href="http://requirejs.org/" target="_blank">RequireJS</a></div>
    <div class="showcase">Routing by <a href="https://github.com/foo123/Dromeo" target="_blank">Dromeo</a></div>
    <div class="showcase">Templating by <a href="https://github.com/foo123/Contemplate" target="_blank">Contemplate</a></div>
    <div class="showcase">Widgets by <a href="https://github.com/foo123/HtmlWidget" target="_blank">HtmlWidget</a></div>
    <div class="showcase">MVC by <a href="https://github.com/foo123/modelview.js" target="_blank">ModelView</a></div>
    </footer>
    <br /><br />
    
    
<script>//<![CDATA[
require(['jQuery', 'ModelView', 'DatGUI', 'HAAR', 'Parallel', 'cascades/haarcascade_frontalface_alt'], 
    function($, ModelView, DAT, HAAR, Parallel, haarcascade_frontalface_alt) {
    
    var startTime = (window.console && window.console.time) ? function(s) { window.console.time(s); } : function() {},
        endTime = (window.console && window.console.timeEnd) ? function(s) { window.console.timeEnd(s); } : function() {},
        Log = (window.console && window.console.log) ? function(s) { window.console.log(s); } : function() {},
        
        $screen = $('#screen'),
        wait = $('#wait'),
        baseUrl = location.href.split( '?' )[ 0 ],
        useParallel = (/[?&]parallel\b/.test(location.href)) ? Parallel : false,
        image, customImage, imageReader, 
        canvas = $('#image')[0], ctx = canvas.getContext('2d'),
        scaling, cannyL, cannyH, basescale, scaleinc, inc, minneighbours,
        defaultImage = '../common/assets/Group_Faces2.jpg',  customImageSrc = null
    ;
    
    ModelView.jquery( $ );
    
    function DetectFeature( src )
    {
        image = new Image();
        image.onload = function() {
            endTime('Image Load');
            // copy image onto a canvas
            canvas.width = image.width; 
            canvas.height = image.height;
            //canvas.style.width = canvas.width + 'px';
            //canvas.style.height = canvas.height + 'px';
            ctx.drawImage(image, 0, 0);
            
            startTime('Feature Detect');
            // detect the feature
            new HAAR.Detector(haarcascade_frontalface_alt.haarcascade_frontalface_alt, useParallel)
                    .image(canvas, 0.5) // use the image
                    .interval(40) // set detection interval for asynchronous detection (if not parallel)
                    .complete(function() {  // onComplete callback
                        
                        endTime('Feature Detect');
                        var i, rect, l=this.objects.length;
                        // hide loader
                        wait.hide( );
                        
                        // draw selection
                        ctx.strokeStyle = "rgba(220,0,0,1)"; 
                        ctx.lineWidth=2;
                        ctx.strokeRect(this.Selection.x, this.Selection.y, this.Selection.width, this.Selection.height);
                        
                        // draw any features found
                        ctx.strokeStyle = "rgba(75,221,17,1)"; 
                        ctx.lineWidth = 2;
                        for (i=0; i<l; i++)
                        {
                            rect = this.objects[i];
                            ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);
                        }
                        
                        // provide info
                        Log('Selection Rectangle: ');
                        Log(this.Selection.toString());
                        Log('Detected Feature(s) (' + l +') :');
                        Log(this.objects.toString());
                        alert(l+" Object(s) found");
                    })
                    .cannyThreshold({low:90, high:200})  // custom thresholds for canny pruning (for best results)
                    .detect(1, 1.1, 0.12, 1, true); // go
        };
        startTime('Image Load');
        image.src = src; // load it
    }

    $screen.modelview({
        livebind: '$(__KEY__)'
        ,autobind: true
        ,bindAttribute: 'data-bind'
        
        ,model: {
            id: 'model'
            ,data: { 
                mode: useParallel ? "CURRENT MODE: Parallel Detection" : "CURRENT MODE: Asynchronous Detection"
            }
        }
        ,actions: { 
            detectParallel: function(evt, $el, data) {
                document.location = baseUrl + "?parallel=1";
            },
            
            detectAsync: function(evt, $el, data) {
                document.location = baseUrl + "?async=1";
            }
        }
    });
    
    wait.show( );
    DetectFeature( defaultImage );
});
//]]></script>

</body>
</html>